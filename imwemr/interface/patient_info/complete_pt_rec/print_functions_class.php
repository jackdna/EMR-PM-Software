<?php
/*
// The MIT License (MIT)
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

include_once $GLOBALS['srcdir'].'/classes/common_function.php';
include_once $GLOBALS['srcdir'].'/classes/complete_pt_record.class.php';
include_once $GLOBALS['srcdir'].'/classes/work_view/wv_functions.php';
class CmnFunc extends CPR{
	public function __construct($pid=''){
		$this->patient_id = $pid;
		$this->data_file_path = $GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH');
	}

	//Get Patient data
	public function get_pt_data($pid=0){
		$return_arr = array();
		$qry = imw_query("select * from patient_data where id = '$pid'");
		while($row = imw_fetch_array($qry)){
			$patientDetails[] = $row;
		}

		foreach($patientDetails as $obj){
			$pt_dob_yymmdd=$obj['DOB'];
			$obj['DOB'] = get_date_format($obj['DOB']);
			$patientName = $obj['lname'].', '.$obj['fname'].' ';
			$patientName .= $obj['mname'];
			//Encryption Variables//
			$fileNamewith=$obj["lname"]."_".$obj["fname"];
			$AESPatientLName=$obj["lname"];
			$AESPatientDOB=$obj['DOB'];
			$encPassword=core_pt_secret_phrase($_SESSION["patient"], $AESPatientLName, $AESPatientDOB);
			//Encryption Variables//
			$date = substr($obj['date'],0,strpos($obj['date'],' '));
			$created_date = get_date_format($date);
			$date_of_birth = $obj['DOB'];
			$cityAddress = $obj['city'];
			if($obj['state'])
				$cityAddress .= ', '.$obj['state'].' ';
			else
				$cityAddress .= ' ';

			$cityAddress .= $obj['postal_code'];
			list($y,$m,$d) = explode('-',$obj['DOB']);
			$age =get_age($pt_dob_yymmdd) ;//date('Y') - $y ;
			$providerID = $obj['providerID'];
			$primary_care_phy_name = $obj['primary_care_phy_name'];
			$reffPhyId = $obj['primary_care_id'];
			$default_facility = $obj['default_facility'];
			$created_by = $obj['created_by'];
			$p_imagename = $obj['p_imagename'];
			$title = $obj['title'];
			$pt_ss =  $obj['ss'];
			$sex =  $obj['sex'];
			$driving_licence = $obj['driving_licence'];
			$street = $obj['street'];
			$street2 = $obj['street2'];
			$phone_home = $obj['phone_home'];
			$phone_biz = $obj['phone_biz'];
			$phone_cell = $obj['phone_cell'];
			$contact_relationship = $obj['contact_relationship'];
			$phone_contact = $obj['phone_contact'];
			$hipaa_mail = $obj['hipaa_mail'];
			$language = $obj['language'];
			$otherEthnicity = $obj['otherEthnicity'];
			$status = $obj['status'];
			$race = $obj['race'];
			$otherRace = $obj['otherRace'];
			$ethnicity = $obj['ethnicity'];
			$postal_code = $obj['postal_code'];
			$ado_option = $obj['ado_option'];
			$sor_txt = $obj['sor_txt'] . ( $obj['sor_txt'] == 'Other' ? '-'.$obj['other_sor'] : '');
			$gi_txt = $obj['gi_txt']. ( $obj['gi_txt'] == 'Other' ? '-'.$obj['other_gi'] : '');
			$suffix = $obj['suffix'];
			//Get Phy. Details
			if((int)$providerID > 0){
				$phyId = $providerID;
			}
			else{
				$appointmentQryRes = get_patient_last_appointment($this->patient_id);
				$phyId = $appointmentQryRes[0]['sa_doctor_id'];
			}
			if($phyId){
				$qry = imw_query("select concat(fname,', ',lname) as name, mname from users
						where id = '$phyId'");
				$phyDetails = imw_fetch_array($qry);
				$phyName = trim($phyDetails['name'].' '.$phyDetails['mname']);
			}

			//Get Reff. Phy. Details
			$qry = imw_query("select concat(FirstName,', ',LastName) as name, MiddleName from refferphysician
					where physician_Reffer_id = '$reffPhyId'");
			$refPhyDetails = imw_fetch_array($qry);
			$reffPhyName = trim($refPhyDetails['name'].' '.$refPhyDetails['MiddleName']);

			//Get Pt. facility details
			$qry = imw_query("select facilityPracCode from pos_facilityies_tbl
					where pos_facility_id = '$default_facility'");
			$facilityRes = imw_fetch_array($qry);
			$facilityPracCode = $facilityRes['facilityPracCode'];

			//Get who created the Pt.
			$qry = imw_query("select fname, lname, mname from users
					where id = '$created_by'");
			$createByDetail = imw_fetch_array($qry);
			$nameArr['LAST_NAME'] = $createByDetail['lname'];
			$nameArr['FIRST_NAME'] = $createByDetail['fname'];
			$nameArr['MIDDLE_NAME'] = $createByDetail['mname'];
			$createByName = changeNameFormat($nameArr);

			//Get Pt. resp. party details
			$qry = imw_query("select * from resp_party where patient_id = '$pid'
					and fname != '' and lname != ''");
			while($row = imw_fetch_array($qry)){
				$res_party_detail[] = $row;
			}

			//Get default facility details
			$qry = imw_query("select default_group from facility where facility_type = 1");
			if(imw_num_rows($qry)>0){
				while($facilityDetail = imw_fetch_array($qry)){
					$gro_id = $facilityDetail['default_group'];
					$grp_qry = imw_query("select * from groups_new where gro_id = '$gro_id'");
					while($row = imw_fetch_assoc($grp_qry)){
						$groupDetails[] = $row;
					}
				};
			}

			$return_arr['id'] = $obj['id'];
			$return_arr['hipaa_mail'] = $obj['hipaa_mail'];
			$return_arr['hipaa_voice'] = $obj['hipaa_voice'];
			$return_arr['otherEthnicity'] = $obj['otherEthnicity'];
			$return_arr['interpretter'] = $obj['interpretter'];
			$return_arr['genericval1'] = $obj['genericval1'];
			$return_arr['genericval2'] = $obj['genericval2'];
			$return_arr['patientName'] = $patientName;
			$return_arr['fileNamewith'] = $fileNamewith;
			$return_arr['encPassword'] =  $encPassword;
			$return_arr['created_date'] =  $created_date;
			$return_arr['date_of_birth'] =  $date_of_birth;
			$return_arr['street'] =  $street;
			$return_arr['street2'] =  $street2;
			$return_arr['cityAddress'] =  $cityAddress;
			$return_arr['phone_home'] =  $phone_home;
			$return_arr['phone_biz'] =  $phone_biz;
			$return_arr['phone_cell'] =  $phone_cell;
			$return_arr['phone_contact'] =  $phone_contact;
			$return_arr['contact_relationship'] =  $contact_relationship;
			$return_arr['age'] =  $age;
			$return_arr['driving_licence'] =  $driving_licence;
			$return_arr['providerID'] =  $providerID;
			$return_arr['primary_care_phy_name'] =  $primary_care_phy_name;
			$return_arr['reffPhyId'] =  $reffPhyId;
			$return_arr['default_facility'] =  $default_facility;
			$return_arr['language'] =  $language;
			$return_arr['created_by'] =  $created_by;
			$return_arr['p_imagename'] =  $p_imagename;
			$return_arr['title'] =  $title;
			$return_arr['pt_ss'] =  $pt_ss;
			$return_arr['sex'] =  $sex;
			$return_arr['phyName'] =  $phyName;
			$return_arr['phyId'] =  $phyId;
			$return_arr['reffPhyName'] =  $reffPhyName;
			$return_arr['facilityPracCode'] =  $facilityPracCode;
			$return_arr['createByName'] =  $createByName;
			$return_arr['res_party_detail'] =  $res_party_detail;
			$return_arr['groupDetails'] =  $groupDetails;
			$return_arr['status'] =  $status;
			$return_arr['otherRace'] =  $otherRace;
			$return_arr['race'] =  $race;
			$return_arr['ethnicity'] =  $ethnicity;
			$return_arr['postal_code'] =  $postal_code;
			$return_arr['ado_option'] =  $ado_option;
			$return_arr['sexual_orientation'] = $sor_txt;
			$return_arr['gender_identity'] = $gi_txt;
			$return_arr['suffix'] = $suffix;

		}
		return $return_arr;
	}

	public function odLable($flgret="0"){
		$ret='<font class="text_blue">OD</font>';
		if($flgret==1){return $ret;}else{print($ret);}
	}
	public function osLable($flgret="0"){
		$ret='<font class="text_green">OS</font>';
		if($flgret==1){return $ret;}else{print($ret);}
	}
	public function ouLable($flgret="0"){
		$ret='<font class="text_purple">OU</font>';
		if($flgret==1){return $ret;}else{print($ret);}
	}

	//Doctor Name
	public function showDoctorName($id,$flg="0")
	{
		if(($id != 0) && !empty($id))
		{
			$sql = imw_query("SELECT lname, mname, fname, pro_suffix,id
					FROM users
					WHERE id = '$id';
					");
			$rez = imw_fetch_array($sql);
			$lname = !empty($rez["lname"]) ? $rez["lname"].",&nbsp;" : "";
			$mname = !empty($rez["mname"]) ? $rez["mname"]."&nbsp;" : "";
			$fname = !empty($rez["fname"]) ? $rez["fname"]."&nbsp;" : "";
			$ps = $rez["pro_suffix"];

			if($flg=="2"){
				$name = $lname.$fname.$mname.$ps;

			}else if($flg=="1"){
				$name = $rez['fname'];
				$name .= !empty($rez['lname']) ? "&nbsp;".strtoupper(substr($rez['lname'],0,1))."" : "" ;
				$name = (strlen($name) > 30) ? substr($name,0,28).".." : $name;
			}else {
				$name = $lname.$fname.$mname;
			}

			return $name;
		}
		return "";
	}

	//Returns DOS for the chart notes
	public function get_chrt_dos($form_id,$request){
		$formIdToPrint = '';
		// If print dos select form id then form id
		if(is_array($request["chart_nopro"])){
			if(count($request["chart_nopro"])>0){
				$formIdToPrint = $request['formIdToPrint'][0];
				if($formIdToPrint!="" && in_array("Chart Notes",$request["chart_nopro"])){
					$form_id = $formIdToPrint;
				}
			}
		}

		if(intval($form_id)==0 && intval($formIdToPrint)>0){
			$qry1 = imw_query("select date_of_service from  chart_master_table where patient_id='$this->patient_id' and id='$formIdToPrint'");
			$co = imw_num_rows($qry1);
			$databaseDateOfService = '';
			if($co > 0){
				$crow = imw_fetch_array($qry1);
				$databaseDateOfService = $crow["date_of_service"];
			}
		}else{
			$qry1 = imw_query("select date_of_service from  chart_master_table where patient_id='$this->patient_id' and id='$form_id'");
			$co = imw_num_rows($qry1);
			$databaseDateOfService = '';
			if($co > 0){
				$crow=imw_fetch_array($qry1);
				$date_of_service = get_date_format($crow["date_of_service"]);
				$databaseDateOfService = $crow["date_of_service"];
			}
		}

		if(empty($formIdToPrint) === false){
			$return_arr['formIdToPrint'] = $formIdToPrint;
		}
		$return_arr['databaseDateOfService'] = $databaseDateOfService;
		$return_arr['date_of_service'] = $date_of_service;
		return $return_arr;
	}

	//Checking Facesheet
	public function chk_facesheet($request){
		if(count($request['patient_info'])>0){
			$return_val = true;
		}
		foreach($request['patient_info'] as $obj){
			if($obj == 'all'){
				$return_val = false;
			}
			else if($obj == 'printMedicalHistory.php'){
				$return_val = false;
			}
			else if($obj == 'print_legal.php'){
				$return_val = false;
			}
		}
		if(count($request['patient_info']) == 1 && $request['patient_info'][0] != 'face_sheet'){
			$return_val = false;
		}
		if($request['patient_info'][0] == 'print_demographics2.php' && $request['patient_info'][1] == 'insurance_print.php'){
			$return_val = false;
		}
		return $return_val;
	}

	//Check if temp. id exists in Pt. Docs
	public function check_temp_id_in_pt_doc(){
		$ptDocsTemplateId = "";
		$ptDocTempQry = "select pt_docs_template_id from pt_docs_template
					where pt_docs_template_status = '0' and pt_docs_template_enable_facesheet = 'yes' ORDER BY pt_docs_template_id DESC LIMIT 0,1";
		$ptDocTempRes = imw_query($ptDocTempQry);
		if(imw_num_rows($ptDocTempRes)>0){
			$ptDocTempRow = imw_fetch_array($ptDocTempRes);
			$ptDocsTemplateId = $ptDocTempRow["pt_docs_template_id"];
		}
		return $ptDocsTemplateId;
	}

	//Returns pt. past data
	public function get_past_pt_data(){
		$return_array = array();
		$rsGetLastTwoApp = imw_query("SELECT DATE_FORMAT(sa_app_start_date,'%a ".get_sql_date_format('','y','/')."') as pastDate,TIME_FORMAT(sa_app_starttime,'%h:%i %p') as pastTime, sp.acronym as acronym,users.lname, users.fname FROM schedule_appointments sa JOIN users ON users.id = sa.sa_doctor_id JOIN slot_procedures sp ON sa.procedureid = sp.id where sa_patient_id = '".$this->patient_id."' and sa_app_start_date < '".date("Y-m-d")."' and sa.sa_patient_app_status_id NOT IN (203,201,18,19,20) ORDER BY `sa_app_start_date` DESC limit 2");
		if(imw_num_rows($rsGetLastTwoApp) > 0){
			$strPastSite = '';
			while($rowGetLastTwoApp = imw_fetch_array($rsGetLastTwoApp)){
				$strPastSite = ucfirst($rowGetLastTwoApp['fname'][0]);
				$strPastSite .= ucfirst($rowGetLastTwoApp['lname'][0]);
				$strPastSite .= " - ".$rowGetLastTwoApp['pastDate']." ".$rowGetLastTwoApp['pastTime']." ".$rowGetLastTwoApp['acronym'];
				$return_array[] = $strPastSite;
			}
			imw_free_result($rsGetLastTwoApp);
		}
		return $return_array;
	}

	//Returns curr. app. details
	public function get_pt_app_details($appt_id=""){
		$return_arr = array();
		$andSchProvQry="";
		if($appt_id){ $andSchProvQry.= " AND sa.id='".$appt_id."'";}
		$qry_pt_appt = "SELECT DATE_FORMAT(sa.sa_app_start_date,'%a ".get_sql_date_format('','y','/')."') as sa_app_start_date,sp.proc, TIME_FORMAT(sa.sa_app_starttime,'%h:%i %p') as sa_app_starttime from schedule_appointments sa LEFT JOIN slot_procedures sp ON sp.id = sa.procedureid where sa.sa_app_start_date>='".date("Y-m-d")."' and sa.sa_patient_id = '".$this->patient_id."' and sa.sa_patient_app_status_id NOT IN (203,201,18,19,20) $andSchProvQry ORDER BY sa.sa_app_start_date LIMIT 0,1";
		$res_pt_appt = imw_query($qry_pt_appt);
		if(imw_num_rows($res_pt_appt)>0){
			$row_pt_appt=imw_fetch_assoc($res_pt_appt);
			$return_arr['pt_appt_date'] = $row_pt_appt['sa_app_start_date'];
			$return_arr['pt_appt_time'] = $row_pt_appt['sa_app_starttime'];
			$return_arr['pt_proc_get'] = $row_pt_appt['proc'];
		}
		return $return_arr;
	}

	//Returns Pt. Provider data
	public function get_pt_provider($form_id,$provider_id){
		$qry = imw_query("select CONCAT(lname,', ',fname) as name, mname from users where id = '$provider_id'");
		if(imw_num_rows($qry) > 0){
			$providetDetail = imw_fetch_array($qry);
			$provider_name = trim($providetDetail[0]['name'].' '.$providetDetail[0]['mname']);
			$sql_doc = imw_query("SELECT doctorId  FROM chart_assessment_plans WHERE patient_id = '".$this->patient_id."' AND form_id = '".$form_id."'");
			$row_doc = imw_fetch_array($sql_doc);
			$sel_doctorId = $row_doc["doctorId"];
			$return_arr['provider_name'] = $provider_name;
			$return_arr['sel_doctorId'] = $sel_doctorId;
		}
		return $return_arr;
	}


	//Returns Pt. images path
	public function get_pt_images($image){
		$return_arr = array();
		$dir_real_path = $this->data_file_path.$image;
		$copy_dir_path = explode('/',$dir_real_path);
		array_pop($copy_dir_path);
		$copy_dir_path = join("/",$copy_dir_path); //.'/html2pdfprint/'
		$img_name = substr($image,strrpos($image,'/')+1);
			copy($dir_real_path,$copy_dir_path.$img_name);
			$imageNAmeTEMP = $copy_dir_path.$img_name;
			$dirPath = $img_name;
		if(file_exists($dir_real_path)){
			$patient_img['patient'] = $img_name;
			$fileSize = getimagesize($dir_real_path);
			if($fileSize[0]>80 || $fileSize[0]>90){
				$imageWidth2 = $this->imageResize($fileSize[0],$fileSize[1],90);
				$patientImage = "<img style=\"cursor:pointer\" src=\"".$imageNAmeTEMP."\" alt=\"patient Image\" ".$imageWidth2.">";
				$ChartNoteImagesString[]=$imageNAmeTEMP;
			}
			else{
				$patientImage = "<img style=\"cursor:pointer\" src=\"".$imageNAmeTEMP."\" alt=\"patient Image\">";
				$ChartNoteImagesString[]=$imageNAmeTEMP;
			}

			$return_arr['patientImage'] = $patientImage;
			$return_arr['ChartNoteImagesString'] = $ChartNoteImagesString;
			$return_arr['patient_img'] = $patient_img;
		}
		return $return_arr;
	}

	public function imageResize($width, $height, $target) {
		if ($width > $height) {
			$percentage = ($target / $width);
		} else {
			$percentage = ($target / $height);
		}
		$width = round($width * $percentage);
		$height = round($height * $percentage);
		return "width=\"$width\" height=\"$height\"";
	}


	//Chart Glucoma Func.
	public function getMenuValue($str){
        $retStr = "";
        $arrCheck = array("Normal","Border Line", "Increase Abnormal", "Decrease Abnormal", "No Change Abnormal", "Abnormal");
        if(!empty($str)){
            foreach($arrCheck as $key => $val){
                if(strpos($str,$val) !== false){
                    $retStr = $val;
                    break;
                }
            }
        }
        return $retStr;
    }

    public function getPatientInfo($id){
        $str = "";
        $sql = imw_query("SELECT
                id,title,
                fname,lname,mname,
                DOB
                FROM patient_data
                WHERE id = '".$id."'");
        while($row = imw_fetch_array($sql)){
            $patientName = "";
            $patientName .= (!empty($row["title"])) ? $row["title"]." " : "";
            $patientName .= (!empty($row["fname"])) ? $row["fname"] : "";
            $patientName .= (!empty($row["lname"])) ? " ".$row["lname"] : "";
            $patientName .= (!empty($row["mname"])) ? " ".substr($row["mname"],0,1)."." : "";
            $pId = $row["id"];
            if(!empty($row["DOB"])){
                $dob = $row["DOB"];
                $age = get_age($dob);
            }
            $str = "";
            $str .="<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">";
            $str .="<tr>";
            $str .="<td class=\"text_gp9b\">".$patientName." - ".$pId."</td><td width=\"2%\"></td>";
            $str .= (!empty($row["DOB"])) ? "<td class=\"text_gp9b\">DOB:</td><td class=\"text_gp9b\">".get_date_format($dob)."(".$age.")</td>" : "" ;
            $str .="</tr>";
            $str .= "</table>";
			$pt_data['name'] = $patientName." - ".$pId;
			if(!empty($row["DOB"])){
				$pt_data['DOB'] = get_date_format($dob).($age);
			}
			$return_arr[] = $pt_data;
        }
        return $return_arr;
    }

	public function refineMenuValue($str){
       $ret = "";
        if(!empty($str))
        {
            switch($str)
            {
              case "Normal":
              $ret = "NL";
              break;
              case "Border Line":
              $ret = "BL";
              break;
              case "Increase Abnormal":
              $ret = "<span class=\"spechar\">&#8593;</span>Abn";
              break;
              case "Decrease Abnormal":
              $ret = "<span class=\"spechar\">&#8595;</span>Abn";
              break;
              case "No Change Abnormal":
              $ret = "<span class=\"spechar\">&#916;</span>NC";
              break;
              case "Abnormal":
              $ret = "Abn";
              break;
              case "Empty":
              //$ret = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
              break;
              default:
              $ret = "";
              break;
            }
        }
      return $ret;
	}

	public function checkWrongDate($str)
    {
        if(($str == "0000-00-00")||($str == "00-00-0000")){
            return "";
        }
        return $str;
    }

	public function getMediGridPrint(){

		$check_data="select * from lists where pid='".$this->patient_id."'
				AND type='4'
				AND allergy_status='Active' ".
				//"AND (enddate >= '".date('Y-m-d')."' OR enddate = '0000-00-00' OR enddate = '' OR enddate IS NULL) ".
				"ORDER BY allergy_status, begdate DESC";
		$counter = 0;
		$resList =  imw_query($check_data);
		while($row = @imw_fetch_array($resList)){

			$tmp_med = $row["title"];
			$tmp_dtSt = (!empty($row["begdate"]) && ($row["begdate"] != '0000-00-00')) ? get_date_format($row["begdate"]) : "" ;
			$tmp_dtEd = (!empty($row["enddate"]) && ($row["enddate"] != '0000-00-00')) ? get_date_format($row["enddate"]) : "" ;
			$tmp_reason = $row["med_comments"];

			$elem_medicationId = "elem_medication_".($counter+1);
			$$elem_medicationId = $tmp_med;
			$elem_dateStartId = "elem_dateStart_".($counter+1);
			$$elem_dateStartId = $tmp_dtSt;
			$elem_dateStoppedId = "elem_dateStopped_".($counter+1);
			$$elem_dateStoppedId = $tmp_dtEd;
			$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($counter+1);
			$$elem_reasonDiscontinuedId = $tmp_reason;
			$elem_gridId = "elem_grid_".($counter+1);
			$$elem_gridId = 0;//$row["id"];
			$counter++;

		}

		///*OR (allergy_status='Active' AND enddate < '".date('Y-m-d')."' AND enddate != '0000-00-00' AND enddate != '' AND enddate IS NOT NULL)*/
		$check_data="SELECT li.* FROM lists li
					JOIN medicine_data md ON REPLACE(li.title,'* Ocular','') = md.medicine_name
					where pid='".$this->patient_id."' AND type='4' AND (allergy_status='Discontinue' OR allergy_status='Stop' )
					AND md.glucoma='1'
					AND md.del_status = '0'
					ORDER BY allergy_status, begdate DESC";
		$resList =  imw_query($check_data);
		while($row = @imw_fetch_array($resList)){

			$tmp_med = $row["title"];
			$tmp_dtSt = (!empty($row["begdate"]) && ($row["begdate"] != '0000-00-00')) ? get_date_format($row["begdate"]) : "" ;
			$tmp_dtEd = (!empty($row["enddate"]) && ($row["enddate"] != '0000-00-00')) ? get_date_format($row["enddate"]) : "" ;
			$tmp_reason = $row["med_comments"];

			$elem_medicationId = "elem_medication_".($counter+1);
			$$elem_medicationId = $tmp_med;
			$elem_dateStartId = "elem_dateStart_".($counter+1);
			$$elem_dateStartId = $tmp_dtSt;
			$elem_dateStoppedId = "elem_dateStopped_".($counter+1);
			$$elem_dateStoppedId = $tmp_dtEd;
			$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($counter+1);
			$$elem_reasonDiscontinuedId = $tmp_reason;
			$elem_gridId = "elem_grid_".($counter+1);
			$$elem_gridId = 0; //$row["id"];
			$counter++;

		}


		/*
		$sql = imw_query("SELECT
				glucoma_main.glucomaId as glucomaId,
				glucoma_grid.glucomaId as glucoma_id,
				glucoma_grid.id,
				glucoma_grid.medication,
				glucoma_grid.dateStart,
				glucoma_grid.dateStop,
				glucoma_grid.reason
				FROM glucoma_main
				INNER JOIN glucoma_grid ON glucoma_grid.glucomaId = glucoma_main.glucomaId
				WHERE glucoma_main.patientId = '".$this->patient_id."'
				AND glucoma_main.activate = '1'
				AND glucoma_grid.typeGrid = 'Medication'
				ORDER BY glucoma_grid.medication, glucoma_grid.dateStart DESC, glucoma_grid.dateStop DESC");
		$counter = 0;
		while($row = imw_fetch_array($sql)){
			$elem_medicationId = "elem_medication_".($counter+1);
			$$elem_medicationId = $row["medication"];
			$elem_dateStartId = "elem_dateStart_".($counter+1);
			$$elem_dateStartId = $row["dateStart"];
			$elem_dateStoppedId = "elem_dateStopped_".($counter+1);
			$$elem_dateStoppedId = $row["dateStop"];
			$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($counter+1);
			$$elem_reasonDiscontinuedId = $row["reason"];
			$elem_gridId = "elem_grid_".($counter+1);
			$$elem_gridId = $row["id"];
			$counter++;
		}
		*/

		$countR = $counter; // Total Records
		$str = "";
		$str .= "<table style=\"width:100%\" id=\"tblMedication\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"tblgrid\">
				<tr height=\"10\" class=\"tblgrid\">
					<td id=\"clrVoilet\" class=\"text_gp9b\" width=\"26%\">Medication</td>
					<td id=\"clrVoilet\" class=\"text_gp9b\" width=\"19%\">Date Started</td>
					<td id=\"clrVoilet\" class=\"text_gp9b\" width=\"19%\">Date Stopped</td>
					<td id=\"clrVoilet\" class=\"text_gp9b\" >Reason Discontinued</td>
				</tr>";
			$lm=8;
			$lm = ($countR > $lm)? $countR : $lm;
			for($i=0;$i<$lm;$i++)
			{
				$elem_medicationId = "elem_medication_".($i+1);
				$elem_medication = (!empty($$elem_medicationId)) ? $$elem_medicationId : "&nbsp;" ;
				$elem_dateStartId = "elem_dateStart_".($i+1);
				$elem_dateStart = (!empty($$elem_dateStartId)) ? $$elem_dateStartId : "&nbsp;" ;
				$elem_dateStoppedId = "elem_dateStopped_".($i+1);
				$elem_dateStopped = (!empty($$elem_dateStoppedId)) ? $$elem_dateStoppedId : "&nbsp;" ;
				$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($i+1);
				$elem_reasonDiscontinued = (!empty($$elem_reasonDiscontinuedId)) ? $$elem_reasonDiscontinuedId : "&nbsp;" ;
				$elem_gridId = "elem_grid_".($i+1);
				$elem_grid = $$elem_gridId;
				$str .= "<tr height=\"10\" valign=\"top\">";
					$str .= "<td class=\"text_gp9\" >".$elem_medication."</td>";
					$str .= "<td class=\"text_gp9\" >".$elem_dateStart."</td>";
					$str .= "<td class=\"text_gp9\" >".$elem_dateStopped."</td>";
					$str .= "<td class=\"text_gp9\" >".nl2br($elem_reasonDiscontinued)."</td>";
				$str .= "</tr>";
			 }
		$str .="</table>";
		return $str;
	}

	public function getSurgeryGridPrint(){

		// Ocu Surgery
		$sql = "select id,title,type,begdate,
				if((DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' OR DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='0') && (YEAR(STR_TO_DATE(begdate,'%Y-%m-%d'))='0000') && (MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' OR MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='0'),'',
				if((DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' OR DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='0') && (MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' OR MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='0'),date_format(STR_TO_DATE(begdate,'%Y-%m-%d'), '%Y'),
				if(MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' OR MONTH(STR_TO_DATE(begdate,'%Y-%m-%d'))='0',date_format(STR_TO_DATE(begdate,'%Y-%m-%d'),'%Y'),
				if(DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='00' or DAY(STR_TO_DATE(begdate,'%Y-%m-%d'))='0',date_format(STR_TO_DATE(begdate,'%Y-%m-%d'),'%m-%Y'), date_format(STR_TO_DATE(begdate,'%Y-%m-%d'),'%m-%d-%Y') ))))as begdate1
				,referredby,comments,sites,enddate from lists where pid='".$this->patient_id."' AND type='6' and allergy_status != 'Deleted' order by STR_TO_DATE(begdate, '%Y-%m-%d') desc,id desc";
		$rez = sqlStatement($sql);
		$counter = 0;
		while($row=sqlFetchArray($rez)){

			$tmpSurgery = $row["title"];
			$tmpsite = $row["sites"];
			$tmpDtSt = (!empty($row["begdate1"]) && (preg_replace('/[^0-9]/','',$row["begdate1"]) != "00000000")) ? ($row["begdate1"]) : "" ;
			$tmp_dtEd = (!empty($row["enddate"]) && ($row["enddate"] != '0000-00-00')) ? get_date_format($row["enddate"]) : "" ;
			$tmpReason = $row["comments"];

			$elem_surgeryId = "elem_surgery_".($counter+1);
			$$elem_surgeryId = $tmpSurgery;
			$elem_dateStartId = "elem_dateStart_".($counter+1);
			$$elem_dateStartId = $tmpDtSt;
			$elem_dateStoppedId = "elem_dateStopped_".($counter+1);
			$$elem_dateStoppedId = $tmp_dtEd;
			$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($counter+1);
			$$elem_reasonDiscontinuedId = $tmpReason;
			$elem_gridId = "elem_grid_".($counter+1);
			$$elem_gridId = 0; //$row["id"];
			$counter++;

		}

		/*
		$sql = imw_query("SELECT
				glucoma_main.glucomaId as glucomaId,
				glucoma_grid.glucomaId as glucoma_id,
				glucoma_grid.id,
				glucoma_grid.medication,
				glucoma_grid.dateStart,
				glucoma_grid.dateStop,
				glucoma_grid.reason
				FROM glucoma_main
				INNER JOIN glucoma_grid ON glucoma_grid.glucomaId = glucoma_main.glucomaId
				WHERE glucoma_main.patientId = '".$this->patient_id."'
				AND glucoma_main.activate = '1'
				AND glucoma_grid.typeGrid = 'Surgery'
				ORDER BY glucoma_grid.medication, glucoma_grid.dateStart DESC, glucoma_grid.dateStop DESC ");

		$counter = 0;
		while($row = imw_fetch_array($sql)){
			$elem_surgeryId = "elem_surgery_".($counter+1);
			$$elem_surgeryId = $row["medication"];
			$elem_dateStartId = "elem_dateStart_".($counter+1);
			$$elem_dateStartId = $row["dateStart"];
			$elem_dateStoppedId = "elem_dateStopped_".($counter+1);
			$$elem_dateStoppedId = $row["dateStop"];
			$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($counter+1);
			$$elem_reasonDiscontinuedId = $row["reason"];
			$elem_gridId = "elem_grid_".($counter+1);
			$$elem_gridId = $row["id"];
			$counter++;
		}
		*/

		$countR = $counter; // Total Records
		$str = "";
		$str .="<table style=\"width:100%\" id=\"tblSurgery\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"tblgrid\">";
		$str .="<tr height=\"10\" class=\"tblgrid\">
				<td id=\"clrVoilet\" class=\"text_gp9b\" width=\"26%\">Surgery</td>
				<td id=\"clrVoilet\" class=\"text_gp9b\" width=\"19%\">Date</td>
				<td id=\"clrVoilet\" class=\"text_gp9b\" >Comments</td>
			   </tr>
			  ";

			$lm=4;
			$lm = ($countR > $lm)? $countR : $lm;
			for($i=0;$i<$lm;$i++)
			{
				$elem_surgeryId = "elem_surgery_".($i+1);
				$elem_surgery = (!empty($$elem_surgeryId)) ? $$elem_surgeryId :"&nbsp;";
				$elem_dateStartId = "elem_dateStart_".($i+1);
				$elem_dateStart = (!empty($$elem_dateStartId)) ? $$elem_dateStartId : "&nbsp;" ;
				$elem_dateStoppedId = "elem_dateStopped_".($i+1);
				$elem_dateStopped = (!empty($$elem_dateStoppedId)) ? $$elem_dateStoppedId : "&nbsp;" ;
				$elem_reasonDiscontinuedId = "elem_reasonDiscontinued_".($i+1);
				$elem_reasonDiscontinued = (!empty($$elem_reasonDiscontinuedId)) ? $$elem_reasonDiscontinuedId : "&nbsp;" ;
				$elem_gridId = "elem_grid_".($i+1);
				$elem_grid = $$elem_gridId;

				$str .= "<tr height=\"10\" valign=\"top\">";
					$str .= "<td class=\"text_gp9\" >".$elem_surgery."</td>";
					$str .= "<td class=\"text_gp9\" >".$elem_dateStart."</td>";
					$str .= "<td class=\"text_gp9\" >".nl2br($elem_reasonDiscontinued)."</td>";
				$str .= "</tr>";
			}

	   $str .= "</table>";
	   return $str;
	}

	public function getCheckImg($flag){
		$chkImg = ($flag == false) ? $GLOBALS['webroot']."/library/images/chk_not_select.gif" : $GLOBALS['webroot']."/library/images/chk_selected.gif";
		return "<img src='$chkImg' alt='img' align='middle' hspace='4'>";
	}

	public function getGlaucomaLog(){
        $str = "";
        $str .= "<table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"1\" border=\"0\">
                    <tr bgcolor=\"LightGrey\">
                        <td width=\"74\"class=\"text_gp9b\">Date</td>
                        <td width=\"58\"class=\"text_gp9b\">Time</td>
                        <td align=\"center\"width=\"70\"class=\"text_gp9b\">
                            <!-- C:D -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">C:D</td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- C:D -->
                        </td>
                        <td width=\"60\"class=\"text_gp9b\">
                            <!-- TA -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">T<sub>A</sub></td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- TA -->
                        </td>
                        <td width=\"60\"class=\"text_gp9b\">
                            <!-- TP -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">T<sub>P</sub></td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- TP -->
                        </td>
                        <td align=\"center\"width=\"60\"class=\"text_gp9b\">
                            <!-- Disc -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">Disc</td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- Disc -->
                        </td>
                        <!-- Cee -->
                        <td align=\"center\"width=\"52\"class=\"text_gp9b\">CEE</td>
                        <!-- Cee -->
                        <td width=\"60\"align=\"center\"class=\"text_gp9b\">
                            <!-- Gonio -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">Gonio</td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- Gonio -->

                        </td>
                        <td width=\"60\"align=\"center\"class=\"text_gp9b\">
                            <!-- VF -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">VF</td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- VF -->
                        </td>

                        <td width=\"60\"align=\"center\"class=\"text_gp9b\">
                            <!-- NFA -->
                            <table style=\"width:100%\"cellpadding=\"0\"cellspacing=\"0\"border=\"0\">
                                <tr>
                                    <td align=\"center\"colspan=\"2\"class=\"text_gp9b\">NFA</td>
                                </tr>
                                <tr align=\"center\">
                                    <td class=\"text_gp9b\"><font color=\"Blue\">OD</font></td>
                                    <td class=\"text_gp9b\"><font color=\"Green\">OS</font></td>
                                </tr>
                            </table>
                            <!-- NFA -->
                        </td>
                        <td align=\"center\"width=\"22\"class=\"text_gp9b\">TC</td>
                        <td class=\"text_gp9b\">Medication and Recommendations</td>";
                    $str .= "</tr>";

        $sql = imw_query("SELECT
		  glaucoma_past_readings.*,
		  SUBSTRING_INDEX(dateReading,'-',-1) AS strYear,
		  SUBSTRING_INDEX(SUBSTRING_INDEX(dateReading,'-',2),'-',1) AS strDate,
		  SUBSTRING_INDEX(dateReading,'-',1) AS strMonth
                  FROM glaucoma_past_readings
                  WHERE patientId ='".$_SESSION["patient"]."'
                  ORDER BY strYear DESC, strMonth DESC, strDate DESC, timeReading DESC, id DESC");

        //Get Glucoma Reading
        while($row = imw_fetch_array($sql)){
            $logId = $row["id"];
            $logDate = get_date_format(($row["dateReading"]),'mm-dd-yyyy');
            $logTime=$row["timeReading"];
            $logTaOd=$row["taOd"];
            $logTaOs=$row["taOs"];
            $logTpOd=$row["tpOd"];
            $logTpOs=$row["tpOs"];
            $logVfOdOrg=$row["vfOdSummary"];
            $logVfOd = $this->refineMenuValue($this->getMenuValue($logVfOdOrg));
            $logVfOsOrg=$row["vfOsSummary"];
            $logVfOs=$this->refineMenuValue($this->getMenuValue($logVfOsOrg));
            $logNfaOdOrg=$row["nfaOdSummary"];
            $logNfaOd=$this->refineMenuValue($this->getMenuValue($logNfaOdOrg));
            $logNfaOsOrg=$row["nfaOsSummary"];
            $logNfaOs=$this->refineMenuValue($this->getMenuValue($logNfaOsOrg));

            $logGonioOdOrg=$row["gonioOdSummary"];
            $logGonioOd=(!empty($row["gonioOdSummary"]) && ($row["gonioOdSummary"] != "Not Done") && ($row["gonioOdSummary"] != "Empty")) ? $row["gonioOdSummary"] : "";
            $logGonioOsOrg=$row["gonioOsSummary"];
            $logGonioOs=(!empty($row["gonioOsSummary"]) && ($row["gonioOdSummary"] != "Not Done") && ($row["gonioOsSummary"] != "Empty")) ? $row["gonioOsSummary"] : "";

            $logPachyOdReads=$row["pachyOdReads"];
            $logPachyOdAvg=$row["pachyOdAvg"];
            $logPachyOdCorr=$row["pachyOdCorr"];

            $logPachyOd = (!empty($row["pachyOdReads"])) ? $row["pachyOdReads"]."," : "";
            $logPachyOd .= (!empty($row["pachyOdAvg"])) ? $row["pachyOdAvg"]."," : "";
            $logPachyOd .= (!empty($row["pachyOdCorr"])) ? $row["pachyOdCorr"] : "";

            $logPachyOsReads=$row["pachyOsReads"];
            $logPachyOsAvg=$row["pachyOsAvg"];
            $logPachyOsCorr=$row["pachyOsCorr"];

            $logPachyOs = (!empty($row["pachyOsReads"])) ? $row["pachyOsReads"]."," : "";
            $logPachyOs .= (!empty($row["pachyOsAvg"])) ? $row["pachyOsAvg"]."," : "";
            $logPachyOs .= (!empty($row["pachyOsCorr"])) ? $row["pachyOsCorr"] : "";

            $logDiscOdOrg=$row["diskPhotoOd"];
            $logDiscOsOrg=$row["diskPhotoOs"];
            $logDiscOd=($row["diskPhotoOd"] == "Done") ? "Done" : "";
            $logDiscOs=($row["diskPhotoOs"] == "Done") ? "Done" : "";

            $logCdOd=$row["cdOd"];
            $logCdOs=$row["cdOs"];
            $logTC=($row["treatmentChange"] == "1") ? $this->getCheckImg(true) : "" ;
            $logMedication=$row["medication"];
            $logCee = $row["cee"];
            //$logCeeNotes = $row["ceeNotes"];

	   if(empty($logDate))
	   {
		continue;
	   }

       $str .=" <tr valign=\"top\">
                <td  class=\"text_gp9\" nowrap>". $logDate."</td>
                <td  class=\"text_gp9\" nowrap>". $logTime."</td>
                <td  align=\"center\" class=\"text_gp9\">
		<!-- C:D -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logCdOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logCdOs."</td>
                        </tr>
                    </table>
                    <!-- C:D -->
                </td>
                <td  align=\"center\" class=\"text_gp9\">
                    <!-- TA -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logTaOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logTaOs."</td>
                        </tr>
                    </table>
                    <!-- TA -->
                </td>
                <td  align=\"center\" class=\"text_gp9\">
                    <!-- TP -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logTpOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logTpOs."</td>
                        </tr>
                    </table>
                    <!-- TP -->
                </td>
                <td  align=\"center\" class=\"text_gp9\">
                     <!-- Disc -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logDiscOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logDiscOs."</td>
                        </tr>
                    </table>
                    <!-- Disc -->
                </td>
                <!-- Cee -->
                <td  align=\"center\" class=\"text_gp9\">
                    ". $logCee."
                </td>
                <!-- Cee -->
                <td  align=\"center\" class=\"text_gp9\">
                     <!-- Gonio -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logGonioOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logGonioOs."</td>
                        </tr>
                    </table>
                    <!-- Gonio -->
                </td>
                <td  align=\"center\" class=\"text_gp9b\">
                    <!-- VF -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logVfOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logVfOs."</td>
                        </tr>
                    </table>
                    <!-- VF -->
                </td>
                <td  align=\"center\" class=\"text_gp9b\">
                    <!-- NFA -->
                    <table style=\"width:100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">
                        <tr align=\"center\" valign=\"top\">
                            <td width=\"50%\" class=\"text_gp9\">". $logNfaOd."</td>
                            <td width=\"50%\" class=\"text_gp9\">". $logNfaOs."</td>
                        </tr>
                    </table>
                    <!-- NFA -->
                </td>
                <td  align=\"center\" class=\"text_gp9\">
                    ".$logTC."
                </td>
                <td  class=\"text_gp9\">".nl2br($logMedication)."</td>";
          $str .= "</tr> ";
        }
        $str .= "</table>";
        return $str;
    }

	public function getIopTargets($patientId){
		$targetTpOd = $targetTpOs = $targetTaOd = $targetTaOs = "";
		$sql = imw_query("SELECT
			  chart_master_table.id,
			  chart_iop.iop_id,
			  chart_iop.puff_trgt_od,
			  chart_iop.puff_trgt_os,
			  chart_iop.app_trgt_od,
			  chart_iop.app_trgt_os,
			  chart_iop.exam_date
			  FROM chart_master_table
			  INNER JOIN chart_iop ON chart_iop.form_id = chart_master_table.id
			  WHERE chart_master_table.patient_id='".$patientId."'
			  ORDER BY chart_iop.exam_date DESC, chart_master_table.id DESC
			  LIMIT 0,1");
		while($row = imw_fetch_array($sql)){
			$targetTpOd = !empty($row["puff_trgt_od"]) ? $row["puff_trgt_od"] :$targetTpOd ;
			$targetTpOs = !empty($row["puff_trgt_os"]) ? $row["puff_trgt_os"] : $targetTpOs;
			$targetTaOd = !empty($row["app_trgt_od"]) ? $row["app_trgt_od"] : $targetTaOd;
			$targetTaOs = !empty($row["app_trgt_os"]) ? $row["app_trgt_os"] : $targetTaOs;
		};
		return array($targetTaOd,$targetTaOs,$targetTpOd,$targetTpOs);
	}

	public function getAppletImage($id,$tblName,$idFieldName,$pixelFieldName,$imgPath,$alt='Image Here',$saveImg="0", $width="0",$hgt="0"){
		if($saveImg == "1" || $saveImg == "3"){

			$id=$id;
			$tblName=$tblName;
			$idFieldName=$idFieldName;
			$pixelFieldName = $pixelFieldName;
			$imgPath = $imgPath;
			$alt =$alt;
			$saveImg=$saveImg;

			$pixels = "";
			require('imgGd.php');
			return true;
		}else{

			if($width!="0"){
				$strWidth = "width='".$width."'";
			}

			if($hgt!="0"){
				$strHgt = "height='".$hgt."'";
			}

			return "<img src=\"".$GLOBALS['rootdir']."/patient_info/complete_pt_rec/imgGd.php?id=$id&tbl=$tblName&pixelField=$pixelFieldName&idField=$idFieldName&imgName=$imgPath&saveImg=$saveImg\" alt=\"$alt\" ".$strWidth." ".$strHgt." />";
		}
	}

	public function drawOnImage(){
		//If No Image set White Image
		$imgDefault = $GLOBALS['webroot']."/library/images/white.jpg";
		if((!file_exists($imgName)) && (file_exists($imgDefault)))
		{
			$imgName = $imgDefault;
		}

		//Make two array
		$arrstrings = array();
		$arrpixels = array();

		// Color Vars
		$r=0;
		$g=0;
		$b=0;

		$imgcr = imagecreatefromjpeg($imgName);

	 	$arrstrings = explode(";",$pixls);

		$strings_count = count($arrstrings);

		$strings_in = 0;

		$lc = 10;

		while($strings_in < $strings_count) // String 0 Se Count  String tak Chale
		{
			$arrpixels = explode(" ",$arrstrings[$strings_in]);
			$pixels_count = count($arrpixels);
			$pixels_in_0 = 0;
			while($pixels_in_0 < $pixels_count)
			{
				$pixels_in_1 = $pixels_in_0 + 1; // Agle teen set Kiye
				$pixels_in_2 = $pixels_in_0 + 2;
				$pixels_in_3 = $pixels_in_0 + 3;
				if(($arrpixels[$pixels_in_0]) && ($arrpixels[$pixels_in_1]) && ($arrpixels[$pixels_in_2]) && ($arrpixels[$pixels_in_3])){
					$str_val_1 = $arrpixels[$pixels_in_0]; //Sare Pixels Ki values Li
					$str_val_2 = $arrpixels[$pixels_in_1];
					$str_val_3 = $arrpixels[$pixels_in_2];
					$str_val_4 = $arrpixels[$pixels_in_3];
					$tmp_int = strpos($str_val_1,":");
					if($tmp_int === false){
						//Do Nothing
					}
					else{
						$clrstr = "";
						$clrstr = substr($str_val_1,0,$tmp_int);
						$str_val_1 = substr($str_val_1,$tmp_int + 1);
						$arrclr = array();
						$arrclr =  explode("-",$clrstr); //Us Ko Split Kiya '-' se
						$r = $arrclr[0];
						$g = $arrclr[1];
						$b = $arrclr[2];
					}

					$img_clr_all_2 = imagecolorallocate($imgcr,$r,$g,$b);
					$tmp_int = strpos($str_val_3,":");
					if($tmp_int === false){ // Checked if colon exists or not
					}
					else{
						$str_val_3 = substr($str_val_3,$tmp_int + 1);
					}
					$val_1 = $str_val_1;
					$val_2 = $str_val_2;
					$val_3 = $str_val_3;
					$val_4 = $str_val_4;

					imageline($imgcr,$val_1,$val_2,$val_3,$val_4,$img_clr_all_2);
					$pixels_in_0 += 2;
				}
				else{
					$pixels_in_0 += 2;
					continue;
				}

			}
			$strings_in += 1;
		}

		global $gdFilename;
		$gdFilename="";
		$gdFilename2="";
		if($saveImg == "1"){
			//$dir = "images/tmp/";
			 $dir = $this->data_file_path."/html2pdfprint/";
			if(file_exists($dir)){
				$gdFilename2=sprintf($dir."%d.jpg",rand(1,100000));
				//sleep(1);
				$gdFilename=str_replace(dirname(__FILE__)."/html2pdfprint/","",$gdFilename2);
			}
		}

		if($saveImg == "3"){
			//$dir = "images/tmp/";
			 $dir = $this->data_file_path."/html2pdfprint";
			if(file_exists($dir)){
				$gdFilename2=sprintf($dir."%d.jpg",rand(1,100000));
				//sleep(1);
				$gdFilename=str_replace(dirname(__FILE__)."/../common/new_html2pdf/tmp/","",$gdFilename2);
			}
		}

		imagejpeg($imgcr,$gdFilename2,100);
		//imagejpeg($imgcr);
		//imagegif($imgcr,"123.gif");
		imagedestroy($imgcr);
		//echo "Hi";
	}


	//Demographics Func().
	public function getOrignalValComa($Old_Value,$New_Value,$arrMEDHXGenHealth,$Field_Label){
		$OldValueOrignal = "";
		$arrOldVal = explode(',',$Old_Value);
		foreach ($arrOldVal as $key => $value) {
			if ($arrOldVal[$key] == "") {unset($arrOldVal[$key]);}
		}
		foreach ($arrMEDHXGenHealth as $key => $value) {
			if($arrMEDHXGenHealth[$key]['Filed_Label'] == $Field_Label){
				//echo $arrMEDHXOculer[$key]['Filed_Label_Og_Val'].'--'.$Field_Label.'<br>';
				foreach ($arrOldVal as $keyOld => $valueOld) {
					if ($arrOldVal[$keyOld] == $arrMEDHXGenHealth[$key]['Filed_Label_Val']){
						$OldValueOrignal .= $arrMEDHXGenHealth[$key]['Filed_Label_Og_Val']."<br>";
						unset($arrOldVal[$keyOld]);
						break;
					}
				}
			}
		}
		$Old_Value = $OldValueOrignal;

		$newValueOrignal = "";
		$arrNewVal = explode(',',$New_Value);
		foreach ($arrNewVal as $key => $value) {
			if ($arrNewVal[$key] == "") {unset($arrNewVal[$key]);}
		}
		foreach ($arrMEDHXGenHealth as $key => $value) {
			if($arrMEDHXGenHealth[$key]['Filed_Label'] == $Field_Label){
				//echo $arrMEDHXOculer[$key]['Filed_Label_Og_Val'].'--'.$Field_Label.'<br>';
				foreach ($arrNewVal as $keyNew => $valueNew) {
					if ($arrNewVal[$keyNew] == $arrMEDHXGenHealth[$key]['Filed_Label_Val']){
						$newValueOrignal .= $arrMEDHXGenHealth[$key]['Filed_Label_Og_Val']."<br>";
						unset($arrNewVal[$keyNew]);
						break;
					}
				}
			}
		}
		$New_Value = $newValueOrignal;
		return $Old_Value."~~~~".$New_Value;
	}


	public function getOrignalValWt2Sep($Old_Value,$New_Value,$arrMEDHXOculer,$Field_Label){
		$arrTmp = array();
		$OldValueOrignal = "";
		$strSep="~!!~~";
		$strSep2=":*:";
		$arrOldVal = explode($strSep, $Old_Value);
		foreach($arrOldVal as $keyOld => $valueOld){
			$arrTmp[] = explode($strSep2,$valueOld);
		}
		foreach ($arrTmp as $key => $value) {
			foreach ($value as $keyInner => $valueInner) {
				if ($value[$keyInner] == "") {unset($arrTmp[$key]);}
			}
		}
		foreach ($arrMEDHXOculer as $key => $value) {
			if($arrMEDHXOculer[$key]['Filed_Label'] == $Field_Label){
				foreach ($arrTmp as $keyOld => $valueOld) {
					foreach ($valueOld as $keyInner => $valueInner) {
						if ($valueOld[$keyInner] == $arrMEDHXOculer[$key]['Filed_Label_Val']){
							$OldValueOrignal .= $arrMEDHXOculer[$key]['Filed_Label_Og_Val']."&nbsp;".$valueOld[$keyInner+1]."<br>";
							unset($arrTmp[$keyOld]);
							break;
						}
					}
				}
			}
		}

		$Old_Value = $OldValueOrignal;

		$newValueOrignal = "";
		$arrTmp = array();
		$strSep="~!!~~";
		$strSep2=":*:";
		$arrOldVal = explode($strSep, $New_Value);
		foreach($arrOldVal as $keyOld => $valueOld){
			$arrTmp[] = explode($strSep2,$valueOld);
		}
		foreach ($arrTmp as $key => $value) {
			foreach ($value as $keyInner => $valueInner) {
				if ($value[$keyInner] == "") {unset($arrTmp[$key]);}
			}
		}

		foreach ($arrMEDHXOculer as $key => $value) {
			if($arrMEDHXOculer[$key]['Filed_Label'] == $Field_Label){
				foreach ($arrTmp as $keyOld => $valueOld) {
					foreach ($valueOld as $keyInner => $valueInner) {
						if ($valueOld[$keyInner] == $arrMEDHXOculer[$key]['Filed_Label_Val']){
							$newValueOrignal .= $arrMEDHXOculer[$key]['Filed_Label_Og_Val']."&nbsp;".$valueOld[$keyInner+1]."<br>";
							unset($arrTmp[$keyOld]);
							break;
						}
					}
				}
			}
		}
		$New_Value = $newValueOrignal;
		return $Old_Value."~~~~".$New_Value;
	}

	public function get_set_pat_rel_values_retrive($dbValue,$methodFor,$delimiter = "~|~",$hifenOptional= ""){
		$dbValue 	= trim($dbValue);
		$methodFor 	= trim($methodFor);
		$delimiter	= trim($delimiter);
		if($methodFor == "pat"){
			//echo '<br>dbv='.$dbValue;
			if(stristr($dbValue,$delimiter)){
				list($strTxtPat,$strTxtRel) = explode($delimiter,$dbValue);
				$valueToShow = $strTxtPat;
				//echo '<br>'.$valueToShow;
			}
			else{
				$valueToShow = $dbValue;
			}
		}
		elseif($methodFor == "rel"){
			if(stristr($dbValue,$delimiter)){
				list($strTxtPat,$strTxtRel) = explode($delimiter,$dbValue);
				$valueToShow = $strTxtRel;
			}
			else{
				$valueToShow = "";
			}
		}

		if($valueToShow) { $valueToShow = $hifenOptional.$valueToShow; }//FOR FACESHEET PDF

		return $valueToShow;
	}

	public function commonNoMedicalHistoryAddEdit($moduleName,$moduleValue,$mod="save",&$request = array()){
		$query = "select common_id, no_value,comments from commonNoMedicalHistory
							where patient_id='".$this->patient_id."' and module_name='".$moduleName."'";
		$sql=imw_query($query)or die(imw_error());
		$returnVal = "";
		if($sql)
		{
			$numRows=imw_num_rows($sql);
			if($mod=="save")
			{
				$pkId = 0;
				$action = $oldVal = $newVal = $revModuleName = "";
				if($numRows>0)
				{
					$reslutRow=imw_fetch_assoc($sql);
					$oldVal = $reslutRow["no_value"];
					$oldValComments = $reslutRow["comments"];
					$pkId = $reslutRow["common_id"];
					$query = "update commonNoMedicalHistory set patient_id='".$this->patient_id."', module_name='".$moduleName."',no_value='".$moduleValue."',date_time=now(),operator_id='".$_SESSION["authId"]."', compliant='".$request['compliant']."', comments='".addslashes($request['comments'])."' where common_id='".$reslutRow["common_id"]."'";
					$updateRes=imw_query($query)or die(imw_error());
					$action = "update";
				}
				else
				{
					$query = "insert into commonNoMedicalHistory set patient_id='".$this->patient_id."', module_name='".$moduleName."',no_value='".$moduleValue."',date_time=now(),operator_id='".$_SESSION["authId"]."', comments='".addslashes($request['comments'])."'";
					$updateRes=imw_query($query)or die(imw_error());
					$pkId = imw_insert_id();
					$action = "add";
				}

				// Audit Functionality
                $newVal = $moduleValue;
                require_once(dirname(__FILE__).'/../../../library/classes/class.cls_review_med_hx.php');
                $OBJReviewMedHx = new CLSReviewMedHx;
                //pre($OBJReviewMedHx,1);
                $noReviewRrr = array();
                $noReviewRrr[0]["Pk_Id"] = $pkId;
                $noReviewRrr[0]["Table_Name"] = "commonNoMedicalHistory";
                $noReviewRrr[0]["Field_Text"] = "Patient No ".$moduleName;
                $noReviewRrr[0]["Operater_Id"] = $_SESSION['authId'];
                $noReviewRrr[0]["Action"] = $action;
                if($moduleName == "Medication"){
                    $revModuleName = "Medications";
                    if(empty($oldVal) == true){
                        $oldVal = "Medications";
                    }
                    else{
                        $oldVal = "No Medications";
                    }
                    $noReviewRrr[0]["Old_Value"] = $oldVal;
                    if(empty($moduleValue) == true){
                        $newVal = "Medications";
                    }
                    else{
                        $newVal = "No Medications";
                    }
                    $noReviewRrr[0]['New_Value'] = $newVal;
                }
                elseif($moduleName == "Surgery"){
                    $revModuleName = "Sx/Procedure";
                    if(empty($oldVal) == true){
                        $oldVal = "Surgeries";
                    }
                    else{
                        $oldVal = "No Surgeries";
                    }
                    $noReviewRrr[0]["Old_Value"] = $oldVal;
                    if(empty($moduleValue) == true){
                        $newVal = "Surgeries";
                    }
                    else{
                        $newVal = "No Surgeries";
                    }
                    $noReviewRrr[0]['New_Value'] = $newVal;
                }
                elseif($moduleName == "Allergy"){
                    $revModuleName = "Allergies";
                    if(empty($oldVal) == true){
                        $oldVal = "Allergies";
                    }
                    else{
                        $oldVal = "No Allergies";
                    }
                    $noReviewRrr[0]["Old_Value"] = $oldVal;
                    if(empty($moduleValue) == true){
                        $newVal = "Allergies";
                    }
                    else{
                        $newVal = "No Allergies";
                    }
                    $noReviewRrr[0]['New_Value'] = $newVal;
                }
                elseif($moduleName == "Immunizations"){
                    $revModuleName = "Immunizations";
                    if(empty($oldVal) == true){
                        $oldVal = "Immunizations";
                    }
                    else{
                        $oldVal = "No Immunizations";
                    }
                    $noReviewRrr[0]["Old_Value"] = $oldVal;
                    if(empty($moduleValue) == true){
                        $newVal = "Immunizations";
                    }
                    else{
                        $newVal = "No Immunizations";
                    }
                    $noReviewRrr[0]['New_Value'] = $newVal;
                }
                if($moduleName == "Medication"){
                    $noReviewRrr[1]["Pk_Id"] = $pkId;
                    $noReviewRrr[1]["Table_Name"] = "commonNoMedicalHistory";
                    $noReviewRrr[1]["Field_Text"] = "Patient No ".$moduleName." Comments";
                    $noReviewRrr[1]["Operater_Id"] = $_SESSION['authId'];
                    $noReviewRrr[1]["Action"] = $action;
                    $noReviewRrr[1]["Old_Value"] = $oldValComments;
                    $noReviewRrr[1]['New_Value'] = addslashes($_POST['comments']);
                }
                $OBJReviewMedHx->reviewMedHx($noReviewRrr,$_SESSION['authId'],$revModuleName,$_SESSION['patient'],0,0);

			}
			else if($mod=="get" && $numRows>0)
			{
				$reslutRow=imw_fetch_array($sql);
				if(trim($reslutRow["no_value"]) != "")
				{
					$returnVal="checked";//will check the check box//
				}
			}
		}
		return $returnVal;
	}

	public function get_phy_and_tech(){
		$phyTechArray = array();
		$getPhysicianTechStr = "SELECT * FROM users WHERE user_type = 1 OR user_type = 3";
		$getPhysicianTechQry = imw_query($getPhysicianTechStr);
		while($getPhysicianTechRows = imw_fetch_array($getPhysicianTechQry)){
			$phyTechId = $getPhysicianTechRows['id'];
			$phyTechFname = $getPhysicianTechRows['fname'];
			$phyTechMname = $getPhysicianTechRows['mname'];
			$phyTechLname = $getPhysicianTechRows['lname'];
			$physiciansTechs = $getPhysicianTechRows['username'];
			$physiciansTechs = $phyTechFname." ".$phyTechMname." ".$phyTechLname;
			$phyTechArray[$phyTechId] = ucwords($physiciansTechs);
		}
		return $phyTechArray;
	}

	public function getKHeadingName($ID){
		$getKreadingIdStr = "SELECT * FROM kheadingnames WHERE kheadingId = '$ID'";
		$getKreadingIdQry = imw_query($getKreadingIdStr);
		$getKreadingIdRow = imw_fetch_array($getKreadingIdQry);
			$kReadingHeadingName = 'K['.$getKreadingIdRow['kheadingName'].']';
		return $kReadingHeadingName;
	}

	public function getLenseName($lenseID){
		$getLenseTypeStr = "SELECT * FROM lenses_iol_type WHERE iol_type_id = '$lenseID'";
		$getLenseTypeQry = imw_query($getLenseTypeStr);
		$getLenseTypeRow = imw_fetch_array($getLenseTypeQry);
		$lenses_iol_type = $getLenseTypeRow['lenses_iol_type'];
		return $lenses_iol_type;
	}

	public function getFormulaHeadName($id){
		$getFormulaheadingsStr = "SELECT * FROM formulaheadings WHERE formula_id = '$id'";
		$getFormulaheadingsQry = imw_query($getFormulaheadingsStr);
		$getFormulaheadingsRow = imw_fetch_array($getFormulaheadingsQry);
		$formula_heading_name = $getFormulaheadingsRow['formula_heading_name'];
		return $formula_heading_name;
	}

	public function isAppletModified($sign,$bag="0")
	{
		$sign = trim($sign);

		if(empty($sign)){
			$ret = false;
		}else if(!empty($sign) && ((strpos($sign, "/") !== false) ||
			(strpos($sign, "-") === false) || (strpos($sign, ":") === false) || (strpos($sign, ";") === false)) ){
			// for new applet image string, return true
			$ret = true;
		}else{
			$signLength = strlen($sign);
			$bag = ($bag == "0") ? "0-:;" : $bag;
			$ret = false;
			for($i=0;$i<$signLength;$i++)
			{
				$signChar =  substr($sign,$i,1);

				$pos = strpos($bag, $signChar);
				if($pos === false)
				{
					//return true;
					$ret = true;
					break;
				}
			}
		}
		return $ret;
	}

	public function getTestImages($testtid,$sectionImageFrom,$patient_id){
		global $ChartNoteImagesString;
		$scnMultiImage="";
		$sqlScan = "SELECT scan_id, image_name, file_path, file_type,testing_docscan,multi_doc_upload_comment FROM ".constant("IMEDIC_SCAN_DB").".scans ".
					 "WHERE patient_id = '$patient_id' AND image_form = '".$sectionImageFrom."'  AND test_id  = '".$testtid."' ";
		$sqlScanRes = 	imw_query($sqlScan);
		if(imw_num_rows($sqlScanRes)>0) {
			//start code for a-scanned image
			while($sqlScanRow = imw_fetch_array($sqlScanRes)) {
				$scn_img_name = $sqlScanRow['image_name'];
				$s_imagename = $sqlScanRow['file_path'];
				$s_file_type = $sqlScanRow['file_type'];
				if(empty($s_file_type) && !empty($scn_img_name) && stripos($s_imagename,"DICOM_FILES")!==false){
					if(stripos($s_imagename,".jpg")!==false){$s_file_type="image/jpeg";}
				}

				if($s_imagename && ($s_file_type!='application/pdf'  && $s_file_type!="application/octet-stream" && $s_file_type!="text/xml"  && $s_file_type!="")) { //&& $s_file_type!='image/png'
					$scn_dir_real_path = $this->data_file_path.$s_imagename;
					$scn_img_name = substr($s_imagename,strrpos($s_imagename,'/')+1);
					if(file_exists($scn_dir_real_path)){
						if(stristr($scn_dir_real_path,".tif")) { //CONVERT TIF TO JPG
							$scn_dir_old_path	= str_ireplace("\\","/",$scn_dir_real_path);
							$scn_dir_real_path 	= str_ireplace(".tiff",".jpg",$scn_dir_real_path);
							$scn_dir_real_path 	= str_ireplace(".tif",".jpg",$scn_dir_real_path);
							$scn_dir_new_path 	= str_ireplace("\\","/",$scn_dir_real_path);
							exec("convert ".$scn_dir_old_path." ".$scn_dir_new_path);
						}
						$scnfileSize = getimagesize($scn_dir_real_path);
						if($scnfileSize[0]>700 ){
							$scnimageWidth2 = $this->imageResize($scnfileSize[0],$scnfileSize[1],700);
							 if ($scnfileSize['mime'] == 'image/jpeg'){  //for big images
								$opp = filesize($scn_dir_real_path);
								if($opp>="1200000"){
								$scn_dir_real_path_o = $scn_dir_real_path;
								$scn_dir_real_path_dup = str_ireplace(array(".jpg", ".jpeg"), ".dup4print.jpg", $scn_dir_real_path);
								if(!file_exists($scn_dir_real_path_dup)){
									$image_tmp = imagecreatefromjpeg($scn_dir_real_path);
									imagejpeg($image_tmp, $scn_dir_real_path_dup, 90);
								}else{
									$scn_dir_real_path = $scn_dir_real_path_dup;
								}
								}
							}


							$scnMultiImage .= '<tr><td style="width:700px;text-align:center" ><img style="cursor:pointer" src="'.$scn_dir_real_path.'" alt="patient Image" '.$scnimageWidth2.'></td></tr>';
						}
						else{
							$scnMultiImage .= '<tr><td style="width:700px;text-align:center"><img style="cursor:pointer" src="'.$scn_dir_real_path.'" alt="patient Image"></td></tr>';
						}
							if(strip_tags($sqlScanRow["testing_docscan"])!=""){$scnMultiImage .= '<tr>
								<td ><b>Comments:</b>&nbsp;'.strip_tags($sqlScanRow["testing_docscan"]).'</td>
							</tr>';
							}
							if(strip_tags($sqlScanRow["multi_doc_upload_comment"])!=""){$scnMultiImage .= '<tr>
								<td ><b>Comments:</b>&nbsp;'.strip_tags($sqlScanRow["multi_doc_upload_comment"]).'</td>
							</tr>';
							}
						$ChartNoteImagesString[]=$scn_dir_real_path;
					}

				}
			}
		}
		return $scnMultiImage;
	}


	// PDF Printing Functions
	public function print_getDosfromId($arrfid){
		$arrRet = array();
		if(count($arrfid)>0){
			$str_formIdToPrint = implode(", ", $arrfid);
			$sql = imw_query("SELECT date_of_service FROM chart_master_table WHERE id IN ($str_formIdToPrint)");
			while($row = imw_fetch_array($sql)){
				$arrRet[]=$row["date_of_service"];
			}
		}
		return $arrRet;
	}

	public function print_getStyle($flg=""){
		$fontsize = ($flg==2) ? "14" : "8";
		$fontsize_2 = ($flg==2) ? "9" : "6";
		$fontsize_conlen = ($flg==2) ? "12" : "6";
		?>
<style>
table {
	width: 100%;
	border-spacing: 0;
}
td {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: 100;
	background-color: #FFFFFF;
	color: #000000;
	text-align: left;
	vertical-align: top;
	padding: 0;
	border-spacing: 0;
	margin: 0;
	word-wrap: break-word;
}
.pagebreak {
	page-break-before: always
}
.text_b_w {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: bold;
	background-color: white;
	color: #000000;
}
.paddingLeft {
	padding-left: 5px;
}
.paddingTop{
	padding-top: 5px;
}
.paddingTop10 {
	padding-top:10px;
}
.paddingBotm10 {
	padding-bottom: 10px;
}
.paddingBotm5 {
	padding-bottom: 5px;
}
.tb_subheading {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: bold;
	color: #000000;
 <!--background-color: #f3f3f3;-->
}
.tb_heading {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: bold;
	color: #000;
	background-color: #C0C0C0;
	margin-top: 10;
	padding: 3px 0px 3px 0px;
	vertical-align: middle;
	width: 100%;
}
.tb_headingHeader {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: bold;
	color: #FFFFFF;
	background-color: #4684ab;
}
.text_lable {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;
	background-color: #FFFFFF;*/
	font-weight: bold;
}
.text_value {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	font-weight: 100;
	background-color: #FFFFFF;
}
.text_blue {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	color: #0000CC;
	font-weight: bold;
}
.text_green {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	color: #006600;
	font-weight: bold;
}
.text_purple {
 font-size:<?php echo $fontsize;
?>;
	/*font-family:Arial, Helvetica, sans-serif;*/
	color: purple;
	font-weight: bold;
}
.imgCon {
	width: 325;
	height: auto;
}
.imgdraw {
	width: 325;
	height: auto;
}
.lbl {
	width: 10%;
	font-weight: bold;
}
.sum {
	width: 45%;
}
.test td {
	border: 1px solid red;
}
.conlen td {
font-size:<?php echo $fontsize_conlen;
?>;
}
#crgp td {
font-size:<?php echo $fontsize_2;
?>;
}
.headtilt, .grid {
	width: 43%;
	min-height: 150px;
	text-align: left;
}
.grid table {
	width: 100%;
	height: 95%;
	border-spacing: 0;
	border-collapse: collapse;
	margin-top: 3px;
}
.grid table td {
	border-right: 4px solid black;
	border-bottom: 4px solid black;
	width: 33%;
	text-align: center;
	height: 20px;
}
/*.border {
	border: 1px solid #C0C0C0;
}*/
.paddingTop10 {
	/*border-bottom: 1px solid #C0C0C0;*/
	height: 13px;
	vertical-align: top;
	padding-top: 2px;
	padding-left: 3px;
}
.bdrtop {
	border-top: 1px solid #C0C0C0;
	height: 15px;
	vertical-align: top;
}
.pdl5 {
	padding-left: 10px;
}
.bdrright {
	border-right: 1px solid #C0C0C0;
}
<!----CHART NOTE NEW PDF WORK CSS STARTS FROM HERE------>
.usehead{
	color:#000;!important;
	font-size: 18px;
	text-transform:uppercase;!important;
}
.usersubtxt{
	font-size:14px;
	color:#999999;
}
.grytxt_13{
	color:#999999;
}
td{
	height:16px;
	font-size:12px; padding: 1px 0px
}
.bluelne{
	border-bottom:1px solid #012778;!important
	height:1px;
}
.grylne{
	border-bottom:1px solid #ebebeb;
	height:1px;
}
.bluehed{
	font-size:14px;
	color:#012778;
	font-weight:bold;
}
.tdhead{
	font-size:13px;
	font-weight:bold;
}
.style1{
	font-size: 16px;
	color: #000;
	text-transform: uppercase;
	font-weight: bold;
}
.od{ color:#0000cc; }
.os{ color:#006600; }
.ou{ color:#810080; }
.style2{
	color: #006600;
	font-weight: bold;
}
.style3{
	color: #0000cc;
	font-weight: bold;
}
.style4{
	color: #810080;
	font-weight: bold;
}
.alingL{ text-align:left; }
.alingC{ text-align:center; }
.alingR{ text-align:right; }
.text_bold{ font-weight:bold;}
.rowHeight{ line-height:1.5;}
.text_cap{ text-transform: uppercase;}
</style>
<?php
	}

public function print_getPageFooter(){
	?>
<page_footer>
<table>
  <tr>
    <td style="text-align:center;width:100%">Page [[page_cu]]/[[page_nb]]</td>
  </tr>
</table>
</page_footer>
<?php
	}

	//DOS ----------------------------------
	public function print_getChartDetails($pid=0,$form_id=0){
		$arr=array();
		$qry1 = imw_query("select templateId, testing, ptVisit, date_format(date_of_service,'".get_sql_date_format()."') as dateOfService ,
					date_format(create_dt,'".get_sql_date_format()."') as create_dt_2, providerId
					from  chart_master_table c1 where c1.patient_id = '".$pid."' and c1.id = '".$form_id."' ");
		while($crow = imw_fetch_array($qry1)){
			$arr["date_of_service"] = $crow["dateOfService"];
			if(empty($arr["date_of_service"])){
				$arr["date_of_service"] = $crow["create_dt_2"];
			}

			$arr["ptVisit"] = $crow["ptVisit"];
			$arr["testing"] = $crow["testing"];
			$arr["templateId"] = $crow["templateId"];
			$arr["providerId"] = $crow["providerId"];
		};
		return $arr;
	}

	//Print Header Top bar --------------
	public function print_hdrTopbar($patientDetails=array(),$date_of_service="",$arrReq=array(),$exclusion=array()){
		$patientName=$patientDetails["patientName"];
		if(!$patientName) $patientName=$patientDetails["$patientName"];
		$age=trim($patientDetails["age"]);
		$strAge = !empty($age) ? "&nbsp;($age)&nbsp;" : "" ;
		$date_of_birth=!empty($patientDetails["date_of_birth"])&&$patientDetails["date_of_birth"]!="00-00-0000" ? $patientDetails["date_of_birth"] : "";
		?>
<page_header>
  <table cellspacing="0">
    <tr>
		<td style="width:40%;background-color:#dbdbdb;color:#012778;font-weight:bold;padding-top:2px;">
			<?php if(!empty($patientName)){ print $patientDetails['title'].' '.$patientName."- ".$patientDetails['id']; }?>
		</td>
		<td style="width:37%;background-color:#dbdbdb;font-weight:bold;padding-top:2px;" >
			<span style="color:#012778;"><?php print $patientDetails['sex'];?></span>
			<?php if(@!in_array("HIPPA",$arrReq)){ print($strAge.$date_of_birth); }?>
		</td>
		<td style="width:22%;background-color:#dbdbdb;font-weight:bold;padding-top:2px;" >
			<?php if(!empty($date_of_service) && (in_array("Chart Notes",$arrReq)) && !in_array("dos_facility",$exclusion)){ ?>
			<span style="color:#012778;">Date of Service:&nbsp;</span>
			<?php print ''.$date_of_service;} else '&nbsp;'; ?>
		</td>
    </tr>
  </table>
</page_header>
<?php
}

public function print_reportName($reportName="",$date_of_service="",$arrReq=array(),$exclusion=array()){
//$opertator_name
$opertator_name="";
if(!empty($_SESSION["authId"])){
	$sql = imw_query("SELECT fname, lname FROM users WHERE id = '".$_SESSION["authId"]."' ");
	while($res = imw_fetch_array($sql)){
		$fname = strtoupper(substr($res["fname"],0,1));
		$lname = strtoupper(substr($res["lname"],0,1));
		$opertator_name = $fname.$lname;
	}
}
?>
<table  cellpadding="0" cellspacing="0" >
	<tr>
		<td width="158" style="background-color:#012778;color:#fff; font-size:13px;" align="left">
			<strong>
				<?php echo(strtoupper($reportName));?>
			</strong>
		</td>
		<td width="327" style="background-color:#012778;color:#fff; font-size:13px;" align="left">

			<?php
				if(!empty($date_of_service) && (in_array("Chart Notes",$arrReq)) && !in_array("dos_facility",$exclusion))
				{
					print '<strong>&nbsp;DOS:</strong> '.$date_of_service;
				}
				else
				{
					print '&nbsp;';
				}
			?>

		</td>
		<td width="255" style="background-color:#012778;color:#fff; font-size:13px;" align="left">
			<strong>&nbsp;PRINTED BY:&nbsp;</strong>
			<?php echo(strtoupper($opertator_name));?>&nbsp;on&nbsp;<?php echo(get_date_format(date('Y-m-d')).' '.date("H:i:s"));?>
		</td>
	</tr>
</table>
<?php
}

public function print_mainGroup($patientDetails, $chartDetails=array(), $fAct=array(),$exclusion=array())
{
	$patientName=$patientDetails["name"];
	if(!$patientName)
	{
		//GROUP INFO
		if(!in_array("provider_name_and_contact",$exclusion))
		{
			$pat_id=$patientDetails['id'];
			$this->print_groupInfo($pat_id,$chartDetails);
		}
	}
}

public function print_mainHeader($patientDetails=array(), $chartDetails=array(), $fAct=array(),$exclusion=array(),$pid=0,$form_id=0,$date_of_service="",$proid=0)
{
	$patientName=$patientDetails["name"];
	if(!$patientName)
	{
		$patientName=$patientDetails["patientName"];
		$age=trim($patientDetails["age"]);
		$strAge = !empty($age) ? "&nbsp;($age)&nbsp;" : "" ;
		$date_of_birth=!empty($patientDetails["date_of_birth"])&&$patientDetails["date_of_birth"]!="00-00-0000" ? $patientDetails["date_of_birth"] : "";
		$patientImage=$patientDetails["p_imagename"];
		if(!empty($patientImage)){ $patientImage= data_path().$patientImage;}
		//pre($patientDetails); die;
		$chartinfo="";

	if(!empty($chartDetails["ptVisit"]) && in_array("Chart Notes",$chartDetails))
	{
		$chartinfo.="<b>Visit:</b>&nbsp;".$chartDetails["ptVisit"]."&nbsp;&nbsp;&nbsp;&nbsp;";
	}

	if(!empty($chartDetails["testing"])&& in_array("Chart Notes",$chartDetails))
	{
		$chartinfo.="<b>Testing:</b>&nbsp;".$chartDetails["testing"]."&nbsp;&nbsp;&nbsp;&nbsp;";
	}

	if(!empty($elem_chartTempName)&& in_array("Chart Notes",$chartDetails))
	{
		$chartinfo.="<b>Template:</b>&nbsp;".$elem_chartTempName."";
	}
	// IF OPTION IS CHECK FROM CPR OPTIONS
	$colspan = 0;
	if(@!in_array("HIPPA",$fAct))
	{
		$colspan = 3;
	}

 ?>
<table>
	<tr>
		<td  style="width:300px;">
			<table  style="width:300px;" cellpadding="0" cellspacing="0">
				<tr>
					<td colspan="<?php print $colspan; ?>" style="width:300px;" class="text_lable" style="font-size: 16px; color: #000; text-transform: uppercase; font-weight: bold;" >
					<?php if(!empty($patientName)){ print trim($patientDetails['title'].' '.$patientName." ".$patientDetails['suffix'].'-'.$patientDetails['id']); }?>
					</td>
				</tr>
				<tr>
					<td colspan="3" style="width:300px;">
						<?php

							if(@!in_array("HIPPA",$fAct)){
								print '<span style="color:#999999">'.$patientDetails['sex'].'&nbsp;'.trim($strAge.$date_of_birth).'</span>';
								}
						?>&nbsp;
					</td>
				</tr>
				<?php
					if(@!in_array("HIPPA",$fAct) && $patientDetails['language'])
					{
				?>
				<tr>
					<td style="width:60px;">Language</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php print $patientDetails['language']; ?>
					</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && !empty($patientDetails['race']))
					{
				?>
				<tr>
					<td style="width:60px;">Race</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php print $patientDetails['race']; ?>
					</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && !empty($patientDetails['ethnicity']))
					{
				?>
				<tr>
					<td style="width:60px;">Ethnicity</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php print $patientDetails['ethnicity']; ?>
					</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && !empty($patientDetails['street']))
					{
				?>
				<tr>
					<td style="width:60px;">Address</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php { print trim($patientDetails['street']); }?>

					</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && trim($patientDetails['street2']))
					{
				?>
				<tr>
					<td style="width:60px;">Address 2</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php  print $patientDetails['street2'];?> &nbsp;
				</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && !empty($patientDetails['cityAddress']))
					{
				?>
				<tr>
					<td style="width:60px;"></td>
					<td style="width:10px;"></td>
					<td class="grytxt_13" style="width:230px;">
						<?php
							print ($patientDetails['cityAddress']!="")? "<span style='color:#999999;'>".$patientDetails['cityAddress']."</span>":"";
						?>
					</td>
				</tr>
				<?php
					}
					if(@!in_array("HIPPA",$fAct) && !empty($patientDetails['phone_home'])){
				?>
				<tr>
					<td style="width:60px;">Phone No.</td>
					<td style="width:10px;">:&nbsp;</td>
					<td class="grytxt_13" style="width:230px;">
						<?php  print core_phone_format($patientDetails['phone_home']);?>
					</td>
				</tr>
				<?php } ?>
			</table>
		</td>
		<?php if(!empty($patientImage) && file_exists($patientImage)){ ?>
		<td style="width:20%"  >
			<table rules="none" >
				<tr>
					<td align="center"> <br>
						<img src="<?php print $patientImage; ?>" alt="patient image" width="120" height="100" />
					</td>
				</tr>
			</table>
		</td>
		<?php
			}
			else
			{
				echo('<td style="width:20%" >&nbsp;</td>');
			}
		?>
		<td style="width:40%" align="right">
			<?php
				//GET PATIENT FACILITY ID BASED ON THEIR DOS
				$fac_id = $this->print_get_chart_facility($pid,array("date_of_service"=>$date_of_service,"providerId"=>$proid),$cprPrint);

				//GET PATIENT FACILITY INFORMATION BASED ON ID GET BASED ON DOS USING ABOVE CHART FACILITY FUNCTION
				if($fac_id>0)
				{
					$queryFacility = "SELECT id, name,street, city, state, postal_code, phone, fax, zip_ext FROM `facility` WHERE id='".$fac_id."'";
					$queryFacilityExe = imw_query($queryFacility);
					if(imw_num_rows($queryFacilityExe)>0)
					{
						$queryFacilityRes = imw_fetch_assoc($queryFacilityExe);
						$facId = $queryFacilityRes['id'];
						$facName = $queryFacilityRes['name'];
						$facStreet = $queryFacilityRes['street'];
						$facCity = $queryFacilityRes['city'];
						$facState = $queryFacilityRes['state'];
						$facPostalCode = $queryFacilityRes['postal_code'];
						$facPhone = core_phone_format($queryFacilityRes['phone'],"###-###-####");
						$facFax = core_phone_format($queryFacilityRes['fax'],"###-###-####");
						$fac_zip_Ext = $queryFacilityRes['zip_ext'];
						
			?>

			<table  style="width:300px;" cellpadding="0" cellspacing="0">
				<tr>
					<td	style="width:40px;">&nbsp;</td>
					<td colspan="2" style="width:260px;color:#000;font-size: 14px;font-weight:bold; text-transform: uppercase!important; ">
						<?php print strtoupper($facName); ?>
					</td>
				</tr>
				<tr>
					<td	style="width:40px;">&nbsp;</td>
					<td  style="width:60px;">Address</td>
					<td class="grytxt_13" style="width:200px;">:&nbsp; 	<?php print $facStreet; ?>
					</td>
				</tr>
				<tr>
					<td	style="width:40px;">&nbsp;</td>
					<td  style="width:60px;"></td>
					<td class="grytxt_13" style="width:200px;">:&nbsp; 	<?php print $facCity.', '.$facState.'&nbsp;'.$facPostalCode; ?>
					</td>
				</tr>
				<tr>
					<td	style="width:40px;">&nbsp;</td>
					<td  style="width:60px;">Phone No.</td>
					<td class="grytxt_13" style="width:200px;">:&nbsp; 	<?php print $facPhone; ?>
					</td>
				</tr>
				<tr>
					<td	style="width:40px;">&nbsp;</td>
					<td  style="width:60px;">Fax</td>
					<td class="grytxt_13" style="width:200px;">:&nbsp; 	<?php print $facFax; ?>
					</td>
				</tr>
			</table>

			<?php
					}
				}
			?>
		</td>
	</tr>
	<?php if(!empty($chartinfo)){  ?>
	<tr>
		<td colspan="3">
			<?php  print $chartinfo; ?>
		</td>
	</tr>
	<?php } ?>
</table>
<?php
	}
}

function print_get_chart_facility($patient_id,$chrtinfo,$cprPrint=""){
	$ret_facid = 0;

	$chart_dos = $chrtinfo['date_of_service'];
	$mm=$dd=$yy=$appt_date="";
	list($mm,$dd,$yy)=explode("-",$chart_dos);
	$appt_date=$yy."-".$mm."-".$dd;

	//$cprPrint CALLING FROM pt_dos_facility FUNCTION - USED TO STOP THE PRINTING OF DELETED AND CANCELLED APPOINTMENT ADDRESSES
	if($cprPrint!="" && $cprPrint=="yes"){
		$andCPRPrint ="";
		$andCPRPrint = " and sa_patient_app_status_id not in (18,203)";
	}

	$sql = "select sa_facility_id, sa_doctor_id FROM schedule_appointments
			where sa_patient_id='".$patient_id."' and sa_app_start_date='".$appt_date."' and sa_facility_id!='' $andCPRPrint ORDER BY id";

	$rez = sqlStatement($sql);
	for($i=0; $row=sqlFetchArray($rez);$i++){
		if($i==0 || $row["sa_doctor_id"] == $chrtinfo["providerId"]){
			$ret_facid = $row["sa_facility_id"];
		}
	}
	return $ret_facid;
}

public function print_groupInfo($patient_id,$chrtinfo){
	$chart_dos = $chrtinfo['date_of_service'];
	$defGroup = $facId = $facName = $facAddress = $facCity = $facState = $facZipCode = $facPhone = $facFax= $facZipExt = "";
	//--- Get Default Facility Details -------
	$qry = imw_query("select default_group from facility where facility_type = 1");
	$res = imw_fetch_array($qry);
	$defGroup = $res["default_group"];

	//-- Get Group Facility from appointment table----------//
	$mm=$dd=$yy=$appt_date="";
	list($mm,$dd,$yy)=explode("-",$chart_dos);
	$appt_date=$yy."-".$mm."-".$dd;
	if($appt_date && $patient_id){

		$t_fac_id = $this->print_get_chart_facility($patient_id,$chrtinfo,'yes');
		$qry_group_fac="select default_group, id as facId, name as facName, street as facAddress, city as facCity, state as facState, postal_code as facZipCode, phone as facPhone, fax as facFax, zip_ext as facZipExt from facility where id in(".$t_fac_id.") LIMIT 0, 1";
		$res_group_fac=imw_query($qry_group_fac);
		$row_group_fac=imw_fetch_assoc($res_group_fac);
		if(trim($row_group_fac['default_group'])){
			$defGroup=$row_group_fac['default_group'];
		}
		$facId		=	$row_group_fac['facId'];
		$facName	=	$row_group_fac['facName'];
		$facAddress	=	$row_group_fac['facAddress'];
		$facCity	=	$row_group_fac['facCity'];
		$facState	=	$row_group_fac['facState'];
		$facZipCode	=	$row_group_fac['facZipCode'];
		$facPhone	=	$row_group_fac['facPhone'];
		$facFax		=	$row_group_fac['facFax'];
		$facZipExt	=	$row_group_fac['facZipExt'];
	}

	if(constant("PT_SUMMARY_HEADER_INFO")!="" && constant("PT_SUMMARY_HEADER_INFO")=="FACILITY"){

	//-----------------------------------------------------//
	//SCHEDULED APPOINTMENT FACILITY INFORMATION DISPLAYED IF "PT_SUMMARY_HEADER_INFO" DEFINE IN PRACTICE GLOBAL
?>
<table align="right" style="width:300px; ">
	<tr>
	<td class="text_lable" style="width:300px;text-align:right"><?php print $facName; ?></td>
	</tr>
	<tr>
		<td style="width:300px;text-align:right"><?php print ucwords($facAddress); ?></td>
	</tr>
	<tr>
		<td style="width:300px;text-align:right"><?php print $facCity.', '.$facState.' '.$facZipCode; ?></td>
	</tr>
	<?php if($facPhone){ ?>
	<tr>
		<td style="width:300px;text-align:right">Ph.:&nbsp;<?php print $facPhone; ?></td>
	</tr>
	<?php }
		if($facFax){
	 ?>
	<tr>
		<td style="width:300px;text-align:right">Fax:&nbsp;<?php print $facFax; ?></td>
	</tr>
<?php } ?>
</table>
<?php

	//-----------------FACILITY INFORMATION END---------------------------//

	}else{

//------------------DEFAULT GROUP INFORMATION---------------------------//
//Group Info
if(!empty($defGroup)){
	$qry = imw_query("select * from groups_new where gro_id = '".$defGroup."'");
	while($res = imw_fetch_array($qry)){
		$groupDetails[0]['name'] = $res["name"];
		$groupDetails[0]['group_Address1'] = $res["group_Address1"];
		$groupDetails[0]['group_Address2'] = $res["group_Address2"];
		$groupDetails[0]['group_City'] = $res["group_City"];
		$groupDetails[0]['group_State'] = $res["group_State"];
		$groupDetails[0]['group_Zip'] = $res["group_Zip"];
		$groupDetails[0]['group_Telephone'] = core_phone_format($res["group_Telephone"],"###-###-####");
		$groupDetails[0]['group_Fax'] = core_phone_format($res["group_Fax"],"###-###-####");
		$groupDetails[0]['group_zip_ext'] = $res["zip_ext"];
	}
}

//--- Get Default Facility Details -------
		?>
<table style="width:740px;"  cellspacing="0" cellpadding="0">
	<tr>
		<td rowspan="3" style="width:480px;padding-top:10px;">
			<?php
			//FOLLOWING CODE USED TO DISPLAY HQ FACILITY LOGO IN CPR PRINTING AS PER NEW CHART NOTE PDF DESIGN
			$query = "SELECT logo FROM `facility` WHERE facility_type=1";
			$queryExe = imw_query($query);  //QUERY EXECUTION
			if(imw_num_rows($queryExe)>0)
			{
				$queryExeRes = imw_fetch_assoc($queryExe); //QUERY RESULT
				$hqFacLogo = $queryExeRes['logo'];
			}
			if(!empty($hqFacLogo))
			{
				$logFullPath = data_path().'facilitylogo/'.$hqFacLogo;
			?>
				<img src="<?php print $logFullPath ?>" height="60" width="auto" />

			<?php
			}
			?>
			</td>
		<td colspan="2" class="usehead" style="width:260px;color:#000;!important; font-size: 18px; text-transform: uppercase;!important;padding-top:10px; ">
			<?php print ucwords($groupDetails[0]['name']);  ?>
		</td>
	</tr>
	<tr>
		<td colspan="2" valign="top" style="width:260px;text-align:left;vertical-align:top;font-size:12px;">
			<table style="width:260px;"  cellspacing="0" cellpadding="0">
				<tbody>
					<tr>
						<td style="width:55px;"><strong>Address:&nbsp;</strong></td>
						<td style="width:205px;"><?php echo ucwords($groupDetails[0]['group_Address1']).',<br/>'.ucwords($groupDetails[0]['group_City']).', '.ucwords($groupDetails[0]['group_State']).'&nbsp;'.ucwords($groupDetails[0]['group_Zip']); ?></td>
					</tr>
				</tbody>
			</table>
		</td>
	</tr>
	<tr>
		<td width="125" style="font-size:12px;vertical-align:top;text-align:left;">
			<strong>Phone:</strong>
			<?php print core_phone_format($groupDetails[0]['group_Telephone'],"###-###-####"); ?>
		</td>
		<td width="125" style="font-size:12px;vertical-align:top;text-align:left;">
			<strong>Fax:</strong>
			<?php print core_phone_format($groupDetails[0]['group_Fax'],"###-###-####"); ?>
		</td>
	</tr>
</table>
<?php
	}
}

	public function print_getDisclosedDetails($pid,$arr){
		//$date_of_service//
		$sql = imw_query("SELECT * FROM disclosed_details WHERE patient_id = '".$pid."'
					AND disclosedBy = '".addslashes($arr["DisclosedBy"])."'
					AND disclosedTo = '".addslashes($arr["DisclosedTo"])."'
					AND disclosedToSpecialty = '".addslashes($arr["Specialty"])."'
					AND disclosedReason = '".addslashes($arr["Reason"])."'
				");
		if(imw_num_rows($sql) == 0){
			$disclosed_arr = $arr["chart_nopro"];
			//pre($_GET,1);
			$disclosed_str = '';
			foreach($disclosed_arr as $dval){
				if($dval!='All' && $dval!='Record Release'){
					$disclosed_str .= $dval.', ';
				}
			}
			if(strlen($disclosed_str)>3){
				$disclosed_str = substr($disclosed_str,0,-2);
			}

			$disclosed_formIds = implode(',',$arr['formIdToPrint']);
			$nowdt = date('Y-m-d H:i:s');
			$insertQuery = "insert into `disclosed_details` set patient_id = '".$pid."',
					disclosedBy = '".addslashes($arr["DisclosedBy"])."',
					disclosedTo = '".addslashes($arr["DisclosedTo"])."',
					disclosedToSpecialty = '".addslashes($arr["Specialty"])."',
					disclosedReason = '".addslashes($arr["Reason"])."',
					dateRequested = '".$nowdt."',
					operator_id = '".$_SESSION['authId']."',
					savedDateTime = '".$nowdt."',
					disclosed='".$disclosed_str."',
					formid='".$disclosed_formIds."'";
			$insertidTemp = @imw_query($insertQuery);
		}

		$boolDisclose = false;
		$selDisclosedQ = "select DATE_FORMAT(dateRequested,'".get_sql_date_format('','y').") as dateRequestedTEMP,disclosedBy,disclosedTo,
				disclosedToSpecialty,disclosedReason from `disclosed_details` where patient_id = '".$pid."'
				order by dateRequested desc ";
		$resultDisclosed = imw_query($selDisclosedQ);
		if(imw_num_rows($resultDisclosed)>0 && $boolDisclose==true){
	?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="5" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
	 <td colspan="5" height="2"></td>
  </tr>
  <tr>
    <td colspan="5" class="bluehed text_cap ">DISCLOSED DETAILS</td>
  </tr>
  <tr>
    <td class="text_lable" style="width:10%;">Date Requested</td>
    <td class="text_lable" style="width:20%;">Disclosed By</td>
    <td class="text_lable" style="width:20%;">Disclosed To</td>
    <td class="text_lable" >Specialty</td>
    <td class="text_lable" >Reason</td>
  </tr>
  <?php
			while($rowDisclosed=imw_fetch_array($resultDisclosed)){?>
  <tr>
    <td ><?php echo($rowDisclosed["dateRequestedTEMP"]);?></td>
    <td ><?php
						if($rowDisclosed["disclosedBy"]!=""){
							$t_provider = "select id,fname,lname,mname from users where id = '".$rowDisclosed["disclosedBy"]."'";
							$sqlt_provider = imw_query($t_provider);
							while($vrst_provider = imw_fetch_array($sqlt_provider)){
								$phyName_drop="";
								$phyName_drop = $vrst_provider['fname'];
								if($vrst_provider['fname'] != '' && $vrst_provider['lname'] != ''){
									$phyName_drop = $vrst_provider['lname'].', '.$vrst_provider['fname'];
								}
								else if($vrs['fname'] == '' && $vrst_provider['lname'] != ''){
									$phyName_drop = $vrst_provider['lname'];
								}
								$phyName_drop .= $vrst_provider['mname'];
								echo trim(ucwords($phyName_drop));
							}
						}
						?></td>
    <td ><?php echo($rowDisclosed["disclosedTo"]);?></td>
    <td style="width:20%;"><?php echo($rowDisclosed["disclosedToSpecialty"]);?></td>
    <td style="width:30%;"><?php echo($rowDisclosed["disclosedReason"]);?></td>
  </tr>
  <?php
				}
				?>
</table>
<?php
		}
	}

	public function print_getProbList($pid=0,$fTestAct="",$strDosToPrint="",$zFormId='',$arrExclusion=array()){
		//if dos is not empty then display according to dos
		if(!empty($strDosToPrint)){
			$strDosPhrase = " AND onset_date IN (".$strDosToPrint.") ";
		}
		$activeMed="";
		//--- GET ALL PROBLEM LIST ---
		if($zFormId != ''){
			$getProblemListArc = "	select pt_problem_list
								from
								chart_genhealth_archive
								where patient_id='".$pid."' and
								form_id = '".$zFormId."'";//echo "<br>";
		}else if($strDosToPrint != ""){
			$getProblemListArc = "select pt_problem_list from chart_genhealth_archive cgha join chart_master_table cmt on cgha.form_id = cmt.id where cgha.patient_id = '".$pid."' and cmt.date_of_service IN (".$strDosToPrint.")";//echo "<br>";
		}else if($fTestAct == "Active"){
			$activeMed="";


			$getProblemList = "select *, date_format(onset_date,'".get_sql_date_format('','y')."') as DateDiagnosed from pt_problem_list
					where pt_id = '".$pid."' and status = 'Active'  order by id";//echo "<br>";
		}else{
			$getProblemList = "select *, date_format(onset_date,'".get_sql_date_format('','y')."') as DateDiagnosed from pt_problem_list
					where pt_id = '".$pid."'  and status != 'Deleted' order by id";//echo "<br>";
		}
		if($getProblemList != ""){
			$rsGetProblemList = imw_query($getProblemList);
			while($rowProbList = imw_fetch_array($rsGetProblemList)){
				$dataFinal[] = $rowProbList;
			}
		}
		//die();
		if($getProblemListArc != ""){
			$rsGetProblemList = imw_query($getProblemListArc);

			if(imw_num_rows($rsGetProblemList) > 0)
			{
				$dataFinal = array();
				while($row = imw_fetch_assoc($rsGetProblemList)){
					$arrList = (unserialize($row['pt_problem_list']));
					foreach($arrList as $key=>$val)
					{
						if($val!=''){
							if(ucwords($val['status']) != "Deleted"){
								$dataFinal[$key] = $val;
							}
						}
					}
				}
			}
		}
		//pre($dataFinal);die();
		if(count($dataFinal) > 0)
		{
		?>
<table style="width:750px;" cellpadding="0" cellspacing="0" >
  <tr>
    <td colspan="4" class="bluelne" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
	<td colspan="4" height="2"></td>
  </tr>
  <tr>
    <td colspan="4" class="bluehed text_cap paddingTop10" style="width:750px;">PROBLEM LIST&nbsp;</td>
  </tr>
  <tr>
    <td class="text_lable pdl3 paddingTop" style="width:450px;">Patient Problem - Dx Code</td>
    <td class="text_lable paddingTop" style="width:80px;">Date </td>
    <td class="text_lable paddingTop" style="width:80px;">Status</td>
    <td class="text_lable paddingTop" style="width:115px;">SNOMED CT</td>
  </tr>
  <?php
			foreach($dataFinal as $data)
			{
				if(($data["status"]=="Active" || $fTestAct == "All")&& !in_array($data["problem_name"],$arrExclusion)){
				?>
  <tr>
    <td class="rowHeight paddingTop" style="width:450px;" class="pdl5"><?php echo wordwrap(str_ireplace("&lt;br /&gt;","<br>",htmlentities(nl2br($data["problem_name"]),ENT_QUOTES)), 50, "<br>", true); ?>&nbsp; </td>
    <td class="rowHeight paddingTop" style="width:80px;"><?php if(get_number($data["onset_date"])!="00000000"){ echo get_date_format($data["onset_date"],1); } ?>
      &nbsp; </td>
    <td class="rowHeight paddingTop" style="width:80px;"><?php echo ($data["status"]); ?>&nbsp; </td>
    <td class="rowHeight paddingTop" style="width:115px;"><?php echo ($data["ccda_code"]); ?>&nbsp; </td>
  </tr>
  <?php
				}
			}
			?>
</table>
<?php
		}
	}

	public function print_getAllergies($pid=0,$fTestAct="",$arrReq=array(),$strDosToPrint="",$zFormId='',$arrAllergy=array()){
		if(@in_array("Allergies List",$arrReq) || @in_array("Medical History",$arrReq)){
			$flagNo=0;
			//if dos is not empty then display according to dos
			if(!empty($strDosToPrint)){
				$strDosPhrase = " AND begdate IN (".$strDosToPrint.") ";
			}

			//--- GET ALL ALLERGIES DATA ----
			if($fTestAct=="Active"){
				$getAllergies = "select type,title,begdate,acute,allergy_status,chronic,reactions,ag_occular_drug,comments,
						date_format(begdate,'".get_sql_date_format('','y')."') as DateStart from lists where pid = '".$pid."'
						and type in(3,7) and allergy_status = 'Active' ".$strDosPhrase." order by id";
			}else{
				$getAllergies = "select type,title,begdate,acute,allergy_status,chronic,reactions,ag_occular_drug,comments,
						date_format(begdate,'".get_sql_date_format('','y')."') as DateStart from lists where pid = '".$pid."'
						and type in(3,7) and allergy_status != 'Deleted' ".$strDosPhrase." order by id";
			}
			if($getAllergies != ""){
				$rsGetAllergies = imw_query($getAllergies);
				while($rowAllergies = imw_fetch_array($rsGetAllergies))	{
					$dataFinal[] = $rowAllergies;
				}
			}
			if($strDosToPrint != ""){
			$getAllergiesArc = "select lists from chart_genhealth_archive cgha join chart_master_table cmt on cgha.form_id = cmt.id where cgha.patient_id = '".$pid."'
						and cmt.date_of_service IN (".$strDosToPrint.")";

			}
			if($zFormId != ''){
				$getAllergiesArc = "	select lists
									from
									chart_genhealth_archive
									where patient_id='".$pid."' and
									form_id = '".$zFormId."'";
			}
			if($getAllergiesArc != ""){
				$rsGetAllergies = imw_query($getAllergiesArc);

				if (imw_num_rows($rsGetAllergies) > 0 ) {
					$dataFinal = array();
					while($row = imw_fetch_assoc($rsGetAllergies)){
						$arrList = (unserialize($row['lists']));
						foreach($arrList as $arrData){
							foreach($arrData as $data){
								if($fTestAct=="Active"){
									if(($data['type'] == 3 || $data['type'] == 7) && $data['allergy_status'] == 'Active'){
										if($data!='')
										$dataFinal[] = $data;
									}
								}
								else{
									if(($data['type'] == 3 || $data['type'] == 7) && $data['allergy_status'] != 'Deleted'){
										if($data!='')
										$dataFinal[] = $data;
									}
								}
							}
						}
					}
				}
			}
			//pre($dataFinal);die();
			if(count($dataFinal) > 0){
			$flagNo = 1;
			?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="6" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td colspan="6" height="2"></td>
  </tr>
  <tr>
    <td colspan="6" class="bluehed text_cap paddingTop10">ALLERGIES:</td>
  </tr>
  <tr>
    <td class="text_lable paddingTop10" style="width:100px;" >Type</td>
    <td class="text_lable paddingTop10" style="width:160px;" >Name</td>
    <!--<td class="text_lable"  >Adverse Reactions</td>-->
    <td class="text_lable paddingTop10" style="width:170px;"  >Reactions / Comments</td>
    <td class="text_lable paddingTop10" style="width:100px;" >Date Started</td>
    <td class="text_lable paddingTop10" style="width:70px;" >Status</td>
    <td class="text_lable paddingTop10" style="width:103px;" >SNOMED CT</td>
  </tr>
  <?php
				foreach($dataFinal as $data){
					if(!in_array($data["title"],$arrAllergy)){
					$typeAllergy="";
					if($data["ag_occular_drug"] == 'fdbATDrugName'){
						$typeAllergy = 'Drug';
					}
					if($data["ag_occular_drug"] == 'fdbATIngredient'){
						$typeAllergy = 'Ingredient';
					}
					if($data["ag_occular_drug"] == 'fdbATAllergenGroup'){
						$typeAllergy = 'Allergen';
					}

					if(!empty($data["reactions"])){$data["comments"].=", ".$data["reactions"];}

					?>
  <tr>
    <td class="paddingTop" style="width:100px;"><?php echo $typeAllergy; ?>&nbsp;</td>
    <td class="paddingTop" style="width:160px;"><?php echo $data["title"]; ?>&nbsp;</td>
    <!--<td style="width:25%;" ><?php echo ucwords($data["reactions"]); ?>&nbsp;</td>-->
    <td class="paddingTop" style="width:170px;"><?php echo ucwords(str_ireplace(';','',trim($data["comments"]))); ?>&nbsp;</td>
    <td class="paddingTop" style="width:100px;"><?php if($data["begdate"]!="0000-00-00"){echo get_date_format($data["begdate"],1);} ?>
      &nbsp; </td>
    <td class="paddingTop" style="width:70px;"><?php print $data["allergy_status"];?>&nbsp;</td>
    <td class="paddingTop" style="width:103px;"><?php print $data["ccda_code"];?></td>
  </tr>
  <?php }
				}
				?>
</table>
<?php }

			if($flagNo == 0){
				$strNoAllergy = $this->commonNoMedicalHistoryAddEdit($moduleName="Allergy",$moduleValue="",$mod="get");
				if($strNoAllergy == "checked"){ ?>
<table  style="width:750px;" cellpadding="0" cellspacing="0">
 <tr>
    <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td height="2"></td>
  </tr>
 <tr>
    <td class="bluehed text_cap paddingTop10" style="width:750px;">ALLERGIES:</td>
  </tr>
  <tr>
    <td class="paddingTop10 pdl5" >NKDA</td>
  </tr>
</table>
<?php
				}else{ /* ?>
<table  style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
    <td
class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td height="2"></td>
  </tr>
 <tr>
    <td class="bluehed text_cap paddingTop10" style="width:750px;">ALLERGIES:</td>
  </tr>
  <tr>
    <td class="paddingTop10 pdl5">No Allergy</td>
  </tr>
</table>
<?php */
				}
			}
		}
	}


	public function print_getMeds($pid=0,$arrAction=array(),$arrReq=array(),$strDosToPrint="",$zFormId ='',$arrMedExclusion=array()){
		//if dos is not empty then display according to dos
		if(!empty($strDosToPrint)){
			$strDosPhrase = " AND begdate IN (".$strDosToPrint.") ";
		}
		$arrIn = array_keys($arrAction);
		$strIn = implode(',',$arrIn);
		//--- GET MEDICATION DATA ---
		if($fTestAct == "Active"){
			$getMedication = "select type,title,sig,qty,allergy_status,referredby,destination,begdate,enddate,comments, sites ,
					date_format(begdate,'".get_sql_date_format('','y')."') as DateStart,compliant,ccda_code from lists where pid='".$pid."' and
					allergy_status = 'Active' and type in ($strIn) ".$strDosPhrase." order by id";
		}else{
			$getMedication = "select type,title,sig,qty,allergy_status,referredby,destination,begdate,enddate,comments,  sites ,
					date_format(begdate,'".get_sql_date_format('','y')."') as DateStart,compliant,ccda_code from lists where pid='".$pid."'
					and type in ($strIn) and allergy_status != 'Deleted' ".$strDosPhrase." order by id";
		}
		if($getMedication != ""){
			$rsGetMedication = imw_query($getMedication);
			while($rowMedication = imw_fetch_array($rsGetMedication))	{
				$dataFinal[] = $rowMedication;
			}
		}
		if($strDosToPrint != ""){
			$getMedicationArc = "select cgha.lists
									from
									chart_genhealth_archive cgha join chart_master_table cmt
									on cgha.form_id = cmt.id
									where cgha.patient_id='".$pid."' and
									cmt.date_of_service IN (".$strDosToPrint.")";
			if($zFormId != ''){
				$getMedicationArc = "	select lists
									from
									chart_genhealth_archive
									where patient_id='".$pid."' and
									form_id = '".$zFormId."'";
			}
		}
		if($getMedicationArc != ""){
			$rsGetMedication = imw_query($getMedicationArc);

			if(imw_num_rows($rsGetMedication) > 0 && (@in_array("Medication List",$arrReq)|| @in_array("Medical History",$arrReq)) ){
			$dataFinal = array();
			while($row = imw_fetch_assoc($rsGetMedication)){
				$arrList = unserialize($row['lists']);
				foreach($arrList as $arrData){
					foreach($arrData as $data){
								if(in_array($data['type'],$arrIn)){
									if($arrAction[$data['type']] == "Active" && $data['allergy_status'] == 'Active'){
										if($data!='')
										$dataFinal[] = $data;
									}
									elseif($arrAction[$data['type']] == "All" && $data['allergy_status'] != 'Deleted'){
										if($data!='')
										$dataFinal[] = $data;
									}
								}
					}
				}
			}//pre($dataFinal);die();
		}
		}

		if(imw_num_rows($rsGetMedication) > 0){
			if(count($dataFinal) >0 ){
		?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="9" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td colspan="9" height="2"></td>
  </tr>
  <tr>
    <td colspan="9" class="bluehed text_cap paddingTop10">MEDICATION LIST</td>
  </tr>
  <tr>
    <td class="text_lable pdl3" style="width:70px;">Name</td>
    <td class="text_lable" style="width:70px;">Eye</td>
    <td class="text_lable " style="width:60px;">Dosage</td>
    <td class="text_lable " style="width:60px;">Sig</td>
    <td class="text_lable" style="width:60px;">Qty</td>
    <td class="text_lable" style="width:70px;">Compliant</td>
    <td class="text_lable" style="width:80px;">Date Started</td>
    <td class="text_lable" style="width:40px;">Status</td>
    <td class="text_lable" style="width:90px;">RxNorm </td>
  </tr>
  <?php
			$o=$s=0;

			foreach($dataFinal as $data)
			{
				if(!in_array($data["title"],$arrMedExclusion)){
					if($data["type"]==4){
						$OcularArr[] = $data;
					}

					if($data["type"]==1){
						$SystemicArr[] = $data;
					}
				}
			}
					if(count($OcularArr)>0){
					?>
  <tr>
    <td colspan="9" class="tb_subheading">Ocular</td>
  </tr>
  <?php foreach($OcularArr as $data){
								if($data["compliant"] == 2){
									$style = "font-weight:bold; font-style:italic";
								}else $style = "";
					   ?>
  <tr>
    <td style="width:70px;<?php echo $style;?>" class="pdl5"><?php echo wordwrap($data["title"], 10, "\n",true); ?>&nbsp;</td>
    <td style="width:70px;<?php echo $style;?>"><?php
									switch($data["sites"])
									{
										case "1":
										echo "Left Eye";
										break;
										case "2":
										echo "Right Eye";
										break;
										case "3":
										echo "Both Eyes";
										break;
										case "4":
										echo "By Mouth";
										break;
									}
							?>
      &nbsp;</td>
    <td style="width:60px;<?php echo $style;?>"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
    <td style="width:60px;<?php echo $style;?>"><?php echo $data["sig"]; ?>&nbsp;</td>
    <td style="width:60px;<?php echo $style;?>"><?php echo $data["qty"]; ?>&nbsp;</td>
    <td style="width:70px;<?php echo $style;?>" align="center"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0"){ echo "No"; } ?>
      &nbsp;</td>
    <td style="width:80px;<?php echo $style;?>"><?php if(get_number($data["begdate"])!="000000"){echo get_date_format($data["begdate"],1);} ?>
      &nbsp; </td>
    <td style="width:40px;<?php echo $style;?>"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
    <td style="width:90x;<?php echo $style;?>"><?php echo $data["ccda_code"]; ?></td>
  </tr>
  <?php }

			}
			if(count($SystemicArr)>0){?>
  <tr>
    <td colspan="9" class="tb_subheading">Systemic</td>
  </tr>
  <?php  foreach($SystemicArr as $data){
								if($data["compliant"] == 2){
									$style = "font-weight:bold; font-style:italic";
								}else $style = "";
									?>
  <tr>
      <td colspan="2" style="width:140px;<?php echo $style;?>" class="pdl5"><?php echo $data["title"]; ?>&nbsp;</td>
    <!--<td style="width:70px;<?php //echo $style;?>"><?php
									/*		switch($data["sites"])
											{
												case "1":
												echo "Left Eye";
												break;
												case "2":
												echo "Right Eye";
												break;
												case "3":
												echo "Both Eyes";
												break;
												case "4":
												echo "By Mouth";
												break;
											} */
									?>
      &nbsp;</td> -->
    <td style="width:60px;<?php echo $style;?>"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
    <td style="width:60px;<?php echo $style;?>"><?php echo $data["sig"]; ?>&nbsp;</td>
    <td style="width:60px;<?php echo $style;?>"><?php echo $data["qty"]; ?>&nbsp;</td>
    <td style="width:70px;<?php echo $style;?>" align="center"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0") { echo "No"; } ?>
      &nbsp;</td>
    <td style="width:80px;<?php echo $style;?>"><?php if(get_number($data["begdate"])!="000000"){echo get_date_format($data["begdate"],1);} ?>
      &nbsp; </td>
    <td style="width:40px;<?php echo $style;?>"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
    <td style="width:90px;<?php echo $style;?>"><?php echo $data["ccda_code"]; ?></td>
  </tr>
  <?php }

					}?>
</table>
<?php

		}
		}
		else{
			$strNoMedication = $this->commonNoMedicalHistoryAddEdit($moduleName="Medication",$moduleValue="",$mod="get");
			if($strNoMedication == "checked"){
			/* 	?>
<table   style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
    <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td height="2"></td>
  </tr>
  <tr>
    <td class="bluehed text_cap paddingTop10">MEDICATION LIST</td>
  </tr>
  <tr>
    <td >&nbsp;&nbsp;No Medications</td>
  </tr>
</table>
<?php */
			}
		}
	}

	public function print_getMeds_administer($pid=0,$arrAction=array(),$arrReq=array(),$strDosToPrint="",$zFormId =''){
		if(!empty($strDosToPrint)){
			$strDosPhrase = " AND begdate IN (".$strDosToPrint.") ";
		}
		$arrIn = array_keys($arrAction);
		$strIn = implode(',',$arrIn);
		//--- GET MEDICATION DATA ---
			$getMedication = "select type,title,sig,qty,allergy_status,referredby,destination,begdate,enddate,comments, sites ,
						date_format(begdate,'".get_sql_date_format()."') as DateStart,compliant,ccda_code from lists where pid='".$pid."' and
						allergy_status = 'Administered' and type in (1,4) AND begdate=".$strDosToPrint." order by id";

		if($getMedication != ""){
			$rsGetMedication = imw_query($getMedication);
			while($rowMedication = imw_fetch_array($rsGetMedication))	{
				$dataFinal[] = $rowMedication;
			}
		}
	?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
	<?php
		if(imw_num_rows($rsGetMedication) > 0){
	?>
	<tr>
		<td colspan="9" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
	</tr>
	<tr>
		<td colspan="9" height="2"></td>
	</tr>
	<tr>
		<td colspan="9" class="bluehed text_cap paddingTop10" style="width:750px;">ADMINISTERED MEDICATION LIST :</td>
	</tr>
	<tr>
		<td class="text_lable pdl3" style="width:80px;">Name</td>
		<td class="text_lable" style="width:80px;">Eye</td>
		<td class="text_lable" style="width:80px;">Dosage</td>
		<td class="text_lable" style="width:60px;">Sig</td>
		<td class="text_lable" style="width:60px;">Qty</td>
		<td class="text_lable" style="width:80px;">Compliant</td>
		<td class="text_lable" style="width:90px;">Date Started</td>
		<td class="text_lable" style="width:80px;">Status</td>
		<td class="text_lable" style="width:90px;">RxNorm </td>
	</tr>
  <?php
		
			$o=$s=0;

			foreach($dataFinal as $data)
			{
				foreach($data as  $dkey => $dval)
				{
					if(trim($dval) == "")
					{
						$data[$dkey] = "No data";
					}
				}

				if($data["type"]==4){
					$OcularArr[] = $data;
				}

				if($data["type"]==1){
					$SystemicArr[] = $data;
				}

			}
					if(count($OcularArr)>0){
					?>
  <tr>
    <td colspan="9" class="tb_subheading">Ocular</td>
  </tr>
  <?php foreach($OcularArr as $data){

							?>
  <tr>
    <td style="width:80px;" class="pdl5"><?php echo wordwrap($data["title"], 10, "\n",true); ?>&nbsp;</td>
    <td style="width:80px;"><?php
									switch($data["sites"])
									{
										case "1":
										echo "Left Eye";
										break;
										case "2":
										echo "Right Eye";
										break;
										case "3":
										echo "Both Eyes";
										break;
										case "4":
										echo "By Mouth";
										break;
									}
							?>
      &nbsp;</td>
    <td style="width:80px;"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
    <td style="width:60px;"><?php echo $data["sig"]; ?>&nbsp;</td>
    <td style="width:60px;"><?php echo $data["qty"]; ?>&nbsp;</td>
    <td style="width:80px;" align="center"><?php if($data["compliant"]=="1") { echo "Yes"; } else { echo "No"; } ?>
      &nbsp;</td>
    <td style="width:90px;"><?php if($data["begdate"]!="0000-00-00"){echo get_date_format($data["begdate"],1);} ?>
      &nbsp; </td>
    <td style="width:80px;"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
    <td style="width:90x;"><?php echo $data["ccda_code"]; ?></td>
  </tr>
  <?php }

			}
			if(count($SystemicArr)>0){?>
  <tr>
    <td colspan="9" class="tb_subheading">Systemic</td>
  </tr>
  <?php  foreach($SystemicArr as $data){

							?>
  <tr>
    <td style="width:80px;" class="pdl5"><?php echo wordwrap($data["title"], 10, "\n",true); ?>&nbsp;</td>
    <td style="width:80px;"><?php
									switch($data["sites"])
									{
										case "1":
										echo "Left Eye";
										break;
										case "2":
										echo "Right Eye";
										break;
										case "3":
										echo "Both Eyes";
										break;
										case "4":
										echo "By Mouth";
										break;
									}
							?>
      &nbsp;</td>
    <td style="width:80px;"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
    <td style="width:60px;"><?php echo $data["sig"]; ?>&nbsp;</td>
    <td style="width:60px;"><?php echo $data["qty"]; ?>&nbsp;</td>
    <td style="width:80px;" align="center"><?php if($data["compliant"]=="1") { echo "Yes"; } else { echo "No"; } ?>
      &nbsp;</td>
    <td style="width:90px;"><?php if($data["begdate"]!="0000-00-00"){echo get_date_format($data["begdate"],1);} ?>
      &nbsp; </td>
    <td style="width:80px;"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
    <td style="width:90px;"><?php echo $data["ccda_code"]; ?></td>
  </tr>
  <?php }

					}
		}
		else{
			/* 	?>
  <tr>
    <td colspan="9" class="paddingTop10" style="width:750px;">&nbsp;&nbsp;No Medications</td>
  </tr>
  <?php */
		}
		?>
</table>
<?php
	}

	public function print_getSx($pid=0,$fTestAct="",$arrReq=array(),$strDosToPrint="",$zFormId=''){
		if(empty($fTestAct)){ $fTestAct="Active"; }
		//if dos is not empty then display according to dos
		if(!empty($strDosToPrint)){
			$strDosPhrase = " AND begdate IN (".$strDosToPrint.") ";
		}

		//--- GET ALL SX / PROCEDURES ---
		if($fTestAct=="Active"){
		$getSurgeries = "select sites,type,title,begdate,referredby,comments,ccda_code,date_format(begdate,'".get_sql_date_format('','y')."') as surgerydate
				from lists where pid = '".$pid."' and type in (5,6) and allergy_status = 'Active' ".$strDosPhrase." order by id";
		}else{
		$getSurgeries = "select sites,type,title,begdate,referredby,comments,ccda_code,date_format(begdate,'".get_sql_date_format('','y')."') as surgerydate
				from lists where pid = '".$pid."' and type in (5,6) and allergy_status != 'Deleted' ".$strDosPhrase." order by id";
		}
		if($getSurgeries != ""){
			$rsGetSurgeries = imw_query($getSurgeries);
			while($rowSurgeries = imw_fetch_array($rsGetSurgeries))	{
				$dataFinal[] = $rowSurgeries;
			}
		}
		if($strDosToPrint != ""){
		$getSurgeriesArc = "select lists from chart_genhealth_archive cgha join chart_master_table cmt on cgha.form_id = cmt.id where cgha.patient_id = '".$pid."'
					and cmt.date_of_service IN (".$strDosToPrint.")";
		}
		if($zFormId != ''){
			$getSurgeriesArc = "	select lists
								from
								chart_genhealth_archive
								where patient_id='".$pid."' and
								form_id = '".$zFormId."'";
		}
		if($getSurgeriesArc != ""){
			$rsGetSurgeries = imw_query($getSurgeriesArc);

			if(imw_num_rows($rsGetSurgeries) > 0 && (@in_array("All",$arrReq) || @in_array("Medical History",$arrReq)) ) {
				$dataFinal = array();
				while($row = imw_fetch_assoc($rsGetSurgeries)){
				$arrList = (unserialize($row['lists']));
				foreach($arrList as $arrData){
					foreach($arrData as $data){
						if($fTestAct=="Active" || $fTestAct=="All"){
							if(($data['type'] == 5 || $data['type'] == 6) && $data['allergy_status'] != 'Deleted'){
								if($data!='')
								$dataFinal[] = $data;
							}
						}
					}
				}
			}
			}
		}

		if(count($dataFinal) > 0)
		{
		?>
<table style="width:755px;" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="6" class="bluelne" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
	<td colspan="6" height="2"></td>
	</tr>
  <tr>
    <td colspan="6" class="bluehed text_cap paddingTop10">SURGERIES / PROCEDURE</td>
  </tr>
  <tr>
    <!--<td class="text_lable pdl3" style="width:100px;">Ocular</td>-->
    <td class="text_lable" style="width:150px;">Name</td>
    <td class="text_lable" style="width:40px;">Site</td>
    <td class="text_lable" style="width:130px;">Date of Procedure</td>
    <td class="text_lable" style="width:104px;">Physician</td>
    <td class="text_lable" style="width:150px;">Comments</td>
    <td class="text_lable" style="width:100px;">SNOMED CT</td>
  </tr>
  <?php
			//pre($dataFinal);die();
			$ocularProc="";
			$nonOcularProc="";
			$commentsData="";
			foreach($dataFinal as $data){
				if($data["type"]=="6"){
				$ocularProc.='
				<tr>
				<td class="paddingTop pdl5" style="width:150px;">'.$data["title"].'</td>
				<td class="paddingTop pdl5" style="width:40px;">'.(($data["sites"] == 3)?"OU":(($data["sites"]== 2)?"OD":(($data["sites"] == 1)?"OS":(($data["sites"] == 4)?"PO":'')))).'</td>
				<td class="paddingTop" style="width:130px;"  >';
				$arrDate = explode("-",$data["begdate"]);
				if($data["begdate"]!="0000-00-00"){
					if(date('Y',strtotime($data["begdate"])) == '0000'){
					$begDate = '';
					}elseif($arrDate[1] == '00'){
					$begDate = $arrDate[0];
					}elseif($arrDate[2] == '00'){
					$begDate = $arrDate[1]."-".$arrDate[0];
					}else{
					$begDate = $arrDate[1]."-".$arrDate[2]."-".$arrDate[0];
					$begDate = get_date_format($data["begdate"]);
				}
					//echo FormatDate_show($data["begdate"],1);
					$ocularProc.=$begDate;
				}
				//BELOW CONDITION ADDED IN CASE OF MCDONALD SERVER,THEY REQUEST TO IMPORT VERY LARGE DATA FOR MEDICAL HX COMMENTS SECTION WHICH IS NOT SUPPORTABLE WITH THE 1000 LINES LIMIT OF HTML2PDF CLASS
				if(strlen($data["comments"])>1000)
				{
					$commentsData=ucwords(substr($data["comments"],0,200).'...');
				}
				else
				{
					$commentsData=ucwords($data["comments"]);
				}
				$ocularProc.='
					</td>
					<td class="paddingTop" style="width:104px;">'.ucwords($data["referredby"]).'</td>
					<td class="paddingTop" style="width:150px;">'.str_ireplace(';','',trim($commentsData)).'</td>
					<td class="paddingTop" style="width:100px;">'.($data["ccda_code"]).'</td>
				</tr>';
					}
					if(($data["type"]=="5")){
					$nonOcularProc.='
					<tr>
						<td class="paddingTop" style="width:150px;" class="pdl5">'.$data["title"].'</td>
						<td class="paddingTop" style="width:40px;" class="pdl5">'.(($data["sites"] == 3)?"OU":(($data["sites"]== 2)?"OD":(($data["sites"] == 1)?"OS":(($data["sites"] == 4)?"PO":'')))).'</td>
						<td class="paddingTop" style="width:130px;">';
				$arrDate = explode("-",$data["begdate"]);
				if($data["begdate"]!="0000-00-00")
				{
					if(date('Y',strtotime($data["begdate"])) == '0000'){
					$begDate = '';
					}elseif($arrDate[1] == '00'){
					$begDate = $arrDate[0];
					}elseif($arrDate[2] == '00'){
					$begDate = $arrDate[1]."-".$arrDate[0];
					}else{
					$begDate = $arrDate[1]."-".$arrDate[2]."-".$arrDate[0];
					$begDate = get_date_format($data["begdate"]);
				}
					$nonOcularProc.=$begDate;
				}
				//BELOW CONDITION ADDED IN CASE OF MCDONALD SERVER,THEY REQUEST TO IMPORT VERY LARGE DATA FOR MEDICAL HX COMMENTS SECTION WHICH IS NOT SUPPORTABLE WITH THE 1000 LINES LIMIT OF HTML2PDF CLASS
				if(strlen($data["comments"])>1000)
				{
					$commentsData=ucwords(substr($data["comments"],0,200).'...');
				}
				else
				{
					$commentsData=ucwords($data["comments"]);
				}

				$nonOcularProc.='
						</td>
							<td class="paddingTop" style="width:104px;">'.ucwords($data["referredby"]).'</td>
							<td class="paddingTop" style="width:150px;">'.str_ireplace(';','',trim($commentsData)).'</td>
							<td class="paddingTop" style="width:100px;">'.($data["ccda_code"]).'</td>
						</tr>';

					}
					$i++;
				}
				if($ocularProc){
				echo '<tr>
							<td class=" paddingTop" colspan="6" style="padding:5px;" >Ocular</td>
					 </tr>'.$ocularProc;
				}
				if($nonOcularProc){
					echo '<tr>
							<td class="tb_subheading paddingTop" colspan="6" style="padding:5px;">Non Ocular</td>
						</tr>'.$nonOcularProc;
				}
				?>
</table>
<?php
			}
		else
		{
			$strNoSurgery = $this->commonNoMedicalHistoryAddEdit($moduleName="Surgery",$moduleValue="",$mod="get");
			if($strNoSurgery == "checked"){
			/* 	?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
		<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
		<td height="2"></td>
  </tr>
  <tr>
		<td class="bluehed" style="width:750px;">SURGERIES / PROCEDURE:</td>
  </tr>
  <tr>
    <td >&nbsp;&nbsp;No Surgeries</td>
  </tr>
</table>
<?php */
			}
		}
	}
	// }

	// Radiology Print ----------
	public function check_lab_staus($pid=0,$arrExclusion=array()){
		$ret=1;
		$arrLabIds=array();
		if(in_array('diagnostic_tests_pending',$arrExclusion)){
			$sql_select = "select rad_test_data_id from rad_test_data where rad_status='1' and rad_patient_id = '".$pid."'";
			$sql_result = imw_query($sql_select);
			if(imw_num_rows($sql_result)>0){
				while($row_result=imw_fetch_assoc($sql_result)){
					$arrLabIds[]=$row_result['rad_test_data_id'];
				}
			}
		}
		return $arrLabIds;
	}

	public function array_push_assoc($array, $key, $value){
		$array[$key] .= $value;
		return $array;
	}

	public function print_getRadiology($pid=0,$arrExclusion=array()){
		$lab_arr_id=$this->check_lab_staus($pid,$arrExclusion);
		$qryLab="";
		if(count($lab_arr_id)>0){
			$lab_arr_ids=implode(",",$lab_arr_id);
			$qryLab=" AND rad_test_data_id NOT IN (".$lab_arr_ids.")";
		}
		$sql_select = "select * , date_format(rad_order_date,'".get_sql_date_format()."') as ordered_date
				from rad_test_data where rad_status != '3' and rad_patient_id = '".$pid."' ".$qryLab;
		$sql_result = imw_query($sql_select);
		if(imw_num_rows($sql_result)>0){?>
<table style="width:750px;" cellpadding="0" cellspacing="0" >
 <tr>
    <td colspan="7" class="bluelne" style="width:750px;">&nbsp;</td>
  </tr>
 <tr>
    <td colspan="7" class="bluehed text_cap paddingTop10" style="width:750px;">RADIOLOGY RESULTS:</td>
  </tr>
  <tr>
    <td class="text_lable paddingTop10" style="width:120px;">Contact Name</td>
    <td class="text_lable paddingTop10" style="width:120px;">Radiology Name</td>
    <td class="text_lable paddingTop10" style="width:100px;">Results</td>
    <td class="text_lable paddingTop10" style="width:80px;">Indication</td>
    <td class="text_lable paddingTop10" style="width:100px;">Order Date</td>
    <td class="text_lable paddingTop10" style="width:100px;">Status</td>
    <td class="text_lable paddingTop10" style="width:80px;">Order By</td>
  </tr>
  <?php
			while($sql_array = imw_fetch_array($sql_result)){
			?>
  <tr>
    <td style="width:120px;" class="paddingTop10 pdl5"><?php echo($sql_array["rad_fac_name"]);?></td>
    <td style="width:120px;" class="paddingTop10"><?php echo($sql_array["rad_name"]);?></td>
    <td style="width:100px;" class="paddingTop10"><?php echo($sql_array["rad_results"]);?></td>
    <td style="width:80px;" class="paddingTop10"><?php echo($sql_array["rad_indication"]);?></td>
    <td style="width:100px;" class="paddingTop10"><?php echo (get_number($sql_array['ordered_date']) != '00000000')?$sql_array['ordered_date']:"";?></td>
    <td style="width:100px;" class="paddingTop10"><?php echo($sql_array["rad_status"]==1)?"Pending":"Completed";?></td>
    <td style="width:80px;" class="paddingTop10"><?php $retNAmeArr=getUserFirstName($sql_array["rad_order_by"],$flgFull=2); print($retNAmeArr[1]); //echo(getProviderName($sql_array["rad_order_by"]));?></td>
  </tr>
  <?php
		 }
		?>
</table>
<?php
		}else if($qryLab==""){ /*?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
 <tr>
    <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td height="2"></td>
  </tr>
 <tr>
    <td class="bluehed text_cap paddingTop10" style="width:750px;">RADIOLOGY RESULTS:</td>
  </tr>
  <tr>
    <td class="paddingTop10">No Data</td>
  </tr>
</table>
<?php */
		}
	}

	public function return_records_array_mysql($query){
		while($_arr = imw_fetch_array($query)){
			$_arr_[] = $_arr;
		}
		return $_arr_;
	}

	public function getPatientBloodSurger($pid){
		$arrPatientBloodSurger=array();
		if($pid)
		{
			$qryPatientBloodSurger="SELECT sugar_value,is_fasting,time_of_day,time_of_day_other,hba1c,description,creation_date,hba1c_val from patient_blood_sugar WHERE patient_id='".$pid."'";
			$resPatientBloodSurger=imw_query($qryPatientBloodSurger);
			$rowPatientBloodSurger=imw_fetch_assoc($resPatientBloodSurger);
			if(imw_num_rows($resPatientBloodSurger)>0)
			{
				$arrPatientBloodSurger['sugar_value']=$rowPatientBloodSurger['sugar_value'];
				$arrPatientBloodSurger['is_fasting']=$rowPatientBloodSurger['is_fasting'];
				$arrPatientBloodSurger['time_of_day']=$rowPatientBloodSurger['time_of_day'];
				$arrPatientBloodSurger['time_of_day_other']=$rowPatientBloodSurger['time_of_day_other'];
				$arrPatientBloodSurger['hba1c']=$rowPatientBloodSurger['hba1c'];
				$arrPatientBloodSurger['description']=$rowPatientBloodSurger['description'];
				$arrPatientBloodSurger['creation_date']=$rowPatientBloodSurger['creation_date'];
				$arrPatientBloodSurger['hba1c_val']=$rowPatientBloodSurger['hba1c_val'];
			}
		}
		return $arrPatientBloodSurger;
	}

	public function getPatientcholesterol($pid){
		$arrPatientcholesterol=array();
		if($pid)
		{
			$qryPatientCholesterol="SELECT creation_date,cholesterol_total,cholesterol_triglycerides,cholesterol_LDL,cholesterol_HDL,description from patient_cholesterol WHERE patient_id='".$pid."'";
			$resPatientCholesterol=imw_query($qryPatientCholesterol)or die(imw_error());
			$rowPatientCholesterol=imw_fetch_assoc($resPatientCholesterol);
			if(imw_num_rows($resPatientCholesterol)>0)
			{
				$arrPatientcholesterol['creation_date']=$rowPatientCholesterol['creation_date'];
				$arrPatientcholesterol['cholesterol_total']=$rowPatientCholesterol['cholesterol_total'];
				$arrPatientcholesterol['cholesterol_triglycerides']=$rowPatientCholesterol['cholesterol_triglycerides'];
				$arrPatientcholesterol['cholesterol_LDL']=$rowPatientCholesterol['cholesterol_LDL'];
				$arrPatientcholesterol['cholesterol_HDL']=$rowPatientCholesterol['cholesterol_HDL'];
				$arrPatientcholesterol['description']=$rowPatientCholesterol['description'];
			}
		}
		return $arrPatientcholesterol;
	}

	function get_med_ros($ros_pos, $ros_pos_other, $negChkBxValueGH, $cols=""){
	$cols_str_dbl = ' colspan="2" '; $cols_str = '';
	if(!empty($cols)){
		$cols_str =  ' colspan="'.$cols.'" ';
		$cols_str_dbl = ' colspan="'.($cols*2).'" ';
	}

	//ROS dynamic
	$ros_nm=array("Allergic/Immunologic","Cardiovascular",
				"Constitutional","Ear, Nose, Mouth & Throat",
				"Endocrine", "Eyes",
				"Gastrointestinal", "Genitourinary",
				"Hemotologic/Lymphatic", "Integumentary",
				"Musculoskeletal", "Neurological",
				"Psychiatry", "Respiratory");

	$ros_neg=array(
				"Negative for allergic/immunologic", "Negative for cardiovascular",
				"Negative for constitutional", "Negative for ear, nose, mouth & throat",
				"Negative for endocrine", "Negative for eyes",
				"Negative for gastrointenstinal", "Negative for genitourinary",
				"Negative for hemotologic/lymphatic", "Negative for integumentary",
				"Negative for musculoskeletal", "Negative for neurological",
				"Negative for psychiatry","Negative for respiratory");
	$results_pos = ""; $results_neg = "";
	$results = array();

	foreach($ros_nm as $ros_k => $ros_v){
		$tmp_pos = $ros_pos[$ros_k];
		$tmp_pos_other = $ros_pos_other[$ros_k];
		$tmp_neg = $ros_neg[$ros_k];

		$tmp_ros = '<td '.$cols_str.' class="text_lable paddingTop10" style="width:360px;">'.$ros_v.'</td>';

		if(!empty($tmp_pos) || !empty($tmp_pos_other)){

			//
			if(!empty($tmp_pos)){
				//sort
				$tmp_ar_pos = explode("<br>", $tmp_pos);
				asort($tmp_ar_pos);
				$tmp_pos = implode("<br>", $tmp_ar_pos);
				$tmp_pos = trim($tmp_pos, "<br>");

				$tmp_pos = '<td  '.$cols_str.'  style="width:360px;" valign="top" class="paddingTop10">'.$tmp_pos.'</td>';
			}
			if(!empty($tmp_pos_other)){
				$tmp_pos_other = '<td '.$cols_str.' style="width:360px;" class="paddingTop10">Other : '.$tmp_pos_other.'</td>';
			}

			if(!isset($results["pos"][0])){
				$results["pos"][0] = array($tmp_ros, $tmp_pos, $tmp_pos_other);
			}else if(!isset($results["pos"][1])){
				$results["pos"][1] = array($tmp_ros, $tmp_pos, $tmp_pos_other);
			}

			if(isset($results["pos"][0]) && isset($results["pos"][1])){
				for($j=0;$j<3;$j++){
					if(!empty($results["pos"][0][$j]) || !empty($results["pos"][1][$j])){
					$tmp = "";
					$tmp .= (!empty($results["pos"][0][$j])) ? $results["pos"][0][$j] : '<td '.$cols_str.'></td>';
					$tmp .= (!empty($results["pos"][1][$j])) ? $results["pos"][1][$j] : '<td '.$cols_str.'></td>';
					$results_pos .= "<tr>".$tmp."</tr>";
					}
				}
				unset($results["pos"][0]);
				unset($results["pos"][1]);
			}

		}elseif(stristr($negChkBxValueGH,$tmp_neg)){

			$tmp_neg = '<td '.$cols_str.' style="width:360px;" class="paddingTop10">Negative</td>';

			if(!isset($results["neg"][0])){
				$results["neg"][0] = array($tmp_ros,$tmp_neg);
			}else if(!isset($results["neg"][1])){
				$results["neg"][1] = array($tmp_ros,$tmp_neg);
			}

			if(isset($results["neg"][0]) && isset($results["neg"][1])){
				for($j=0;$j<2;$j++){
					$results_neg .= "<tr>".$results["neg"][0][$j].$results["neg"][1][$j]."</tr>";
				}
				unset($results["neg"][0]);
				unset($results["neg"][1]);
			}
		}
	}

	if(isset($results["pos"][0])){
		for($j=0;$j<3;$j++){
			if(!empty($results["pos"][0][$j])){
			$results_pos .= '<tr>'.$results["pos"][0][$j].'<td '.$cols_str.'></td></tr>';
			}
		}
		unset($results["pos"][0]);
	}

	if(isset($results["neg"][0])){
		for($j=0;$j<2;$j++){
			$results_neg .= '<tr>'.$results["neg"][0][$j].'<td '.$cols_str.'></td></tr>';
		}
		unset($results["neg"][0]);
	}

	if(!empty($results_pos)){
		if(!empty($results_neg)){
			$results_pos.='<tr><td '.$cols_str_dbl.' style="width:360px;" class="paddingTop10" >All recorded systems are negative except as noted above.</td></tr>';
		}
		echo $results_pos;
	}else{
		echo $results_neg;
	}
	}

	public function print_getGenMed($pid=0,$arrReq=array(),$strDosToPrint="",$exlusionArr=array()){
		global $ChartNoteImagesString;
		//Include general Health,Immunization and Ocular Medical history//
		//include(dirname(__FILE__)."/immunization_ocular_print.php");
		//Include general Health,Immunization and Ocular Medical history//
		//if dos is not empty then display according to dos
		//--- GET ALL OCULAR DATA ----
		$arrMEDHX = array();
		$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '0',"Filed_Label_Og_Val"=> "None");
		$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Glasses");
		$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Contact Lenses");
		$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glasses And Contact Lenses");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Blurred or Poor Vision");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Poor Night Vision");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Gritty Sensation");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Trouble Reading Signs");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Glare From Lights");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Tearing");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Poor Depth Perception");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Halos Around Lights");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Itching or Burning");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Trouble Identifying Colors");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "See Spots or Floaters");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Eye Pain");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "Double Vision");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "See Light Flashes");
		$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '15',"Filed_Label_Og_Val"=> "Redness or Bloodshot");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration :");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
		$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Keratoconus:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> 'other',"Filed_Label_Og_Val"=> "other:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Keratoconus:");
		$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> 'other',"Filed_Label_Og_Val"=> "other:");

		$numrow = 0;
		if(!empty($strDosToPrint)){
		$getAllergies = "select ocular from chart_genhealth_archive cgha join chart_master_table cmt on cgha.form_id = cmt.id where cgha.patient_id = '".$pid."'
						and cmt.date_of_service = ".$strDosToPrint."";
			$rsGetAllergies = imw_query($getAllergies);
			$numrow = imw_num_rows($rsGetAllergies);
		}

			if ( $numrow > 0 && (@in_array("Medical History",$arrReq)))
			{
			$dataFinal = array();

			while($row = imw_fetch_assoc($rsGetAllergies))
			{

				$arrList = (unserialize($row['ocular']));//pre($arrList);die();

				foreach($arrList as $key=>$val)
				{
								if($val!='')
								$dataFinal[$key] = $val;
				}
			}

			if(count($dataFinal) > 0 && (!in_array("ocular",$exlusionArr)))
			{ ?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
	<tr>
		<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
	</tr>
	<tr>
		<td height="2"></td>
	</tr>
	<tr>
		<td style="width:750px;" class="bluehed text_cap paddingTop10"> OCULAR
	  <?php
							foreach($dataFinal as $k=>$v)
							{
								$getrelval = explode("~|~",$dataFinal['chronicDesc']);
								$chronicRelativeVal = explode("~|~",$dataFinal['chronicRelative']);


								$tArr1 = explode("~!!~~",$getrelval[1]);
								$tArr2 = explode("~!!~~",$chronicRelativeVal[0]);

								unset($dataFinal['chronicRelative']);

								for($j=0;$j<count($tArr1);$j++)
								{
									$a = count($tArr1);
									$b = $a-3;
														$tArr3 = $tArr2[$j].",".$tArr1[$j]."~!!~~";
									if($j==0)
									{
										//$tArr3 = str_replace(($b).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}
									if($j==1)
									{
										//$tArr3 = str_replace(($b+1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}
									if($j==2)
									{
										//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}
									if($j==3)
									{
										//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}
									if($j==4)
									{
										//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}
									if($j==5)
									{
										//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
									}

									$dataFinal = $this->array_push_assoc($dataFinal,'chronicRelative',$tArr3);
								}
								break;
							}
								//pre($dataFinal);
							?></td>
  </tr>
  <?php
				foreach ($dataFinal as $key => $value) {

						switch ($key):
						case "you_wear":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$youWearValue = $orignalValue[0];
						break;
						case "last_exam_date":
							$lastExamDateValue = wv_formatDate($value);
						break;
						case "eye_problems":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$eyeProblemValue = $orignalValue[0];

						break;
						case "any_conditions_you":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyConditionYouValue = $orignalValue[0];
						break;
						case "any_conditions_relative":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyConditionRelativeValue = $orignalValue[0];
							break;
						case "chronicDesc":
							$delimiter = '~|~';
							$orignalValue = $this->get_set_pat_rel_values_retrive($value,"pat",$delimiter);
							$orignalValue = $this->getOrignalValWt2Sep($orignalValue,$orignalValue,$arrMEDHX,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$chronicDescValue = $orignalValue[0];

						break;
						case "chronicRelative":
							$case="chronicRelative";
							$delimiter = '~|~';
							$hifen = ' - ';
							$orignalValue = $this->getOrignalValWt2SepChronicRelative($value,$value,$arrMEDHX,$key,$case);
							$orignalValue = explode("~~~~",$orignalValue);
							$chronicRelativeValue = $orignalValue[0];
						break;
						case "eye_problems_other":
							$eyeProbOtherValue = wv_formatDate($value);
						break;
						case "OtherDesc":
							$otherDescValue = wv_formatDate($value);
						break;

						endswitch;
						?>
  <?php }	if(count($dataFinal)>0){ ?>
  <?php if($lastExamDateValue!="" || $youWearValue!=""){?>
  <tr>
    <td style="width:750px;">
        <table style="width:750px;" cellpadding="0" cellspacing="0">
        <tr>
          <td class="text_lable paddingTop10" style="width:730px;" colspan="4"> Eye History :- </td>
        </tr>
        <tr>
          <td style="width:100px;" class="text_lable paddingTop10"> Patient Wears: </td>
          <td style="width:200px;" class="paddingTop10"><?php echo $youWearValue; ?></td>
          <td style="width:200px; text-align:right;" class="text_lable paddingTop10"></td>
          <td style="width:230px;" class="paddingTop10"></td>
        </tr>
        </table>
    </td>
  </tr>
  <?php } ?>
  <?php

					   if($eyeProblemValue||$eyeProbOtherValue){?>
  <tr>
    <td style="width:750px;">
        <table style="width:750px;" cellpadding="0" cellspacing="0">
        <tr>
          <?php if($eyeProblemValue){ ?>
          <td class="text_lable paddingTop" style="width:300px;"> Eye problems :- </td>
          <td style="width:430px;" class="paddingTop" ><?php echo $eyeProblemValue; ?></td>
          <?php }?>
          <?php if($eyeProbOtherValue){?>
          <td  class="text_lable paddingTop" style="width:300px;"> Other eye problems :- </td>
          <td style="width:430px;" class="paddingTop"><?php echo $eyeProbOtherValue; ?></td>
          <?php }?>
        </tr>
      </table></td>
  </tr>
  <?php }?>
  <?php if($chronicDescValue || $chronicRelativeValue){?>
  <tr>
    <td style="width:730px;">
        <table style="width:730px;" cellpadding="0" cellspacing="0" >
        <tr>
          <?php if($chronicDescValue){?>
          <td class="text_lable paddingTop" style="width:300px;"> Patient:- </td>
          <?php }?>
          <?php if($chronicRelativeValue){?>
          <td class="text_lable paddingTop"  style="width:430px;"> Blood Relative :- </td>
          <?php }	?>
        </tr>
        <tr>
          <?php if($chronicDescValue){ ?>
          <td style="width:300px;"><?php echo $chronicDescValue; ?></td>
          <?php }?>
          <?php if($chronicRelativeValue){ ?>
          <td style="width:430px;"><?php echo $chronicRelativeValue; ?></td>
          <?php }?>
        </tr>
      </table>
    </td>
  </tr>
  <?php }
	}
	//MEDHX -> OCULAR CUSTOM FIELD COMPLETE PATIENT RECORD PRINTING WORK
	$customFieldsOcu=$this->get_customFields_MedHx($pid,'Ocular');
	if(count($customFieldsOcu)>0)
	{
 ?>
	<tr>
		<td style="width:740px;" colspan="2">
			<table style="width:740px;" cellpadding="0" cellspacing="0">
				<tr>
				  <td colspan="4"class="paddingTop10 tb_subheading">Miscellaneous</td>
				</tr>
				<tr>
					<?php
						if(is_array($customFieldsOcu) && count($customFieldsOcu)>0){
							$counter = 0;
							foreach($customFieldsOcu as $v) { $counter++;
								if( $v['adminControlLable'] && (!empty($v['patientControlVal']) && (($v['type'] == 'text') || ($v['type'] == 'checkbox' && $v['cbkControlVal'] == 'checked' )) ))
					?>
								<td style="width:350px;" class="paddingTop10">
									<b><?php echo $v['adminControlLable']; ?>:</b>&nbsp;<?php echo $v['patientControlVal']; ?>
								</td>
					<?php
								if( $counter % 2 == 0) echo '</tr><tr>';
							}
						}
					?>
				</tr>
			</table>
		</td>
	</tr>
	<?php }
	//============CALL AND DISPLAY SPECIALTY QUESTIONS PRINT WORK==============
	$printSpecialtyQues=$this->print_specialty_question($pid);
	if(count($printSpecialtyQues)>0)
	{
	?>
	<tr>
		<td style="width:740px;" colspan="2">
			<table style="width:740px;" cellpadding="0" cellspacing="0">
				<tr>
				  <td colspan="4"class="paddingTop10 tb_subheading">Specialty Questions</td>
				</tr>
				<tr>
					<?php
						if(is_array($printSpecialtyQues) && count($printSpecialtyQues)>0){
							$counter = 0;
							foreach($printSpecialtyQues as $v) { $counter++;
								if(!empty($v['question']) && (!empty($v['answer'])))
					?>
								<td style="width:350px;" class="paddingTop10">
									<?php echo $v['question']; ?>:&nbsp; <b><?php echo $v['answer']; ?> </b>
								</td>
					<?php
								if( $counter % 2 == 0) echo '</tr><tr>';
							}
						}
					?>
				</tr>
			</table>
		</td>
	</tr>
	<?php
	}
	//==============END PRINT SPECIALY QUESTIONS DISPLAY WORK======================
	?>
</table>
<?php	}
	}

		// -----GET GENERAL HEALTH DATA
				$delimiter = '~|~';
				//$hifen = ' - ';
				$hifen="";
				$arrMEDHXGenralHealth = array();
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "High Blood Pressure");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Heart Problem");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Arthritis");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Lung Problems");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Stroke");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Thyroid Problems");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diabetes");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Ulcers");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "LDL");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Cancer");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "High Blood Pressure :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Heart Problem :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Arthritis :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Lung Problems :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Stroke :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Thyroid Problems :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diabetes :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Ulcers :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "LDL :");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Cancer :");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_others_both","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Other");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_others_both","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Other");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Fever");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Weight Loss");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Rash");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Skin Disease");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Fatigue");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Sinus Infection");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Post Nasal Drips");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Runny Nose");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Dry Mouth");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Deafness");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Cough");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Bronchitis");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Shortness of Breath");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Asthma");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Emphysema");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "COPD");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "TB");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Chest Pain");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Congestive Heart Failure");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Irregular Heart beat");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Shortness of Breath");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "High Blood Pressure");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Low Blood Pressure");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Pacemaker/defibrillator");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Vomiting");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Ulcers");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diarrhea");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Bloody Stools");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Hepatitis");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Jaundice");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Constipation");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Genital Ulcers");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Discharge");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Kidney Stones");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Blood in Urine");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_aller","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Seasonal Allergies");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_aller","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Hay Fever");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Headache");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Migraines");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Paralysis Fever");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Joint Ache");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Seizures");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Numbness");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Faints");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Stroke");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Multiple Sclerosis");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Alzeihmer's Disease");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "Parkinson's Disease");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Dimentia");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Rashes");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Wounds");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Breast Lumps");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Eczema");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Dermatitis");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Depression");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Anxiety");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Paranoia");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Sleep Patterns");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Mental and/or emotional factors");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Alzeihmer's Disease");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Parkinson's disease");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Memory Loss");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Anemia");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Blood Transfusions");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Excessive Bleeding");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Purpura");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Infection");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Pain");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Joint Ache");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Stiffness");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Swelling");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Paralysis Fever");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Mood Swings");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Constipation");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Polydipsia");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Hypothyroidism");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Hyperthyroidism");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Vision loss");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Eye pain");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Double vision");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Headache");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Negative for constitutional");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Negative for ear, nose, mouth & throat");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Negative for respiratory");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Negative for cardiovascular");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Negative for gastrointenstinal");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Negative for genitourinary");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Negative for allergic/immunologic");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Negative for neurological");

				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Negative for integumentary");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Negative for psychiatry");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "Negative for hemotologic/lymphatic");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Negative for musculoskeletal");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "Negative for endocrine");
				$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Negative for eyes");


				$medDoctorValueGH=$genMedCommentsValueGH=$anyConditionYouValueGH=$relDescHighBpValueGH=
				$relDescHeartProbValueGH=$relDescLungProbValueGH=$relDescStrokeProbValueGH=$relDescThyroidProbValueGH=
				$relDescArthritisProbValueGH=$relDescUlcersProbValueGH=$relDescLDLValueGH=$relDescCancerProbValueGH=
				$descValueGH=$descRValueGH=$anyConditionOtherValueGH=$ghRelDescOthersValueGH=$anyReviewConstValueGH=
				$reviewHeadValueGH=$reviewConstOtherValueGH=$reviewHeadOtherValueGH=$reviewRespValueGH=$reviewCardValueGH=
				$reviewRespOtherValueGH=$reviewCardOtherValueGH=$reviewGastroValueGH=$reviewGenitValueGH=
				$reviewGastroOtherValueGH=$reviewGenitOtherValueGH=$reviewAllerValueGH=$reviewNeuroValueGH=

				$reviewAllerOtherValueGH=$reviewNeuroOtherValueGH=$descValueDHB=$descValueDA=$descValueDLP=
				$descValueDS=$descValueDTP=$descValueDU=$descValueDC=$descValueDHP=$descValueDGPP=$descValueDLDL=
				$descValueDV=$anyConditionYouValueInDb=$subArthritisProbValueGH='';

		$numrow = 0;
		if(!empty($strDosToPrint)){
		 $getGeneral = "select general_medicine from chart_genhealth_archive cgha join chart_master_table cmt on cgha.form_id = cmt.id where cgha.patient_id = '".$pid."'
						and cmt.date_of_service IN (".$strDosToPrint.")";
			$rsGetGeneral = imw_query($getGeneral)or die(imw_error());
			$numrow = imw_num_rows($rsGetGeneral);
		}

			$dataFinal = array();$arrList = array();
			if ($numrow > 0 && (@in_array("Medical History",$arrReq) || @in_array("Medical History",$arrReq)) ) {

			while($row = imw_fetch_assoc($rsGetGeneral)){
				if(!empty($row['general_medicine'])){
					$arrList[] = (unserialize($row['general_medicine']));
						foreach($arrList as $keyList=>$valList){
							if(is_array($valList)){
								foreach($valList as $keyData=>$valData)
								{
										if(is_array($valData)){
											foreach($valData as $key=>$val)
												if($val != '')
												$dataFinal[$key] = $val;
										}else{
											if($valData != '')
											$dataFinal[$keyData] = $valData;
										}
								}
							}
							else
							if($valList != '')
							$dataFinal[$keyList] = $valList;
						}
				}
			}
			if(count($dataFinal) > 0 ){?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
 <tr>
    <td  colspan="2" height="1" class="bluelne">&nbsp;
      <?php //pre($dataFinal); ?></td>
  </tr>
  <tr>
	<td colspan="2" height="2"></td>
	</tr>
  <tr>
    <td  colspan="2" class="bluehed text_cap paddingTop10"> GENERAL HEALTH
      <?php //pre($dataFinal); ?></td>
  </tr>
  <tr>
    <td style="width:350px;"></td>
    <td style="width:350px;"></td>
  </tr>
  <?php
				foreach ($dataFinal as $key => $value) {
					switch ($key):
						case "med_doctor":
							$medDoctorValueGH = $value;
							break;
						case "any_conditions_you":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyConditionYouValueGH = $orignalValue[0];
							$anyConditionYouValueInDb = $value;
						break;
						case "any_conditions_you_n":
							$orignalValue_n = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,"any_conditions_you");
							$orignalValue_n = explode("~~~~",$orignalValue_n);
							$anyConditionYouValueGH_n = $orignalValue_n[0];
							//echo 'anyConditionYouValueGH_n'.$orignalValue_n[0]; die();
							//$anyConditionYouValueInDb = $value;
						break;
						case "any_conditions_relative":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyConditionRelativeValueGH = $orignalValue[0];
							break;
						case "any_conditions_others_both":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyConditionOtherBothValueGH = $orignalValue[0];
							break;
						case "any_conditions_others":
							$anyConditionOtherValueGH = wv_formatDate($value);
							break;
						case "review_sys":
							$review_sys = $value;
							if(!empty($review_sys)){
								$ar_review_sys = json_decode($review_sys, true);
								$ar_tmp = array('review_intgmntr',	'review_psychiatry', 'review_blood_lymph',
											'review_musculoskeletal','review_endocrine','review_eye');
								foreach($ar_tmp as $k => $v){
									$value = $ar_review_sys[$v];
									if(!empty($value)){
										$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$v);
										$orignalValue = explode("~~~~",$orignalValue);
										$vgh = $v."GH";
										$$vgh = "".$orignalValue[0];
									}
									$vother = $v."_others";
									if(!empty($ar_review_sys[$vother])){
										$vothr = $v."OtherGH";
										$$vothr = $ar_review_sys[$vother];
									}
								}
							}
							break;
						case "review_const":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$anyReviewConstValueGH = $orignalValue[0];
							break;
						case "review_const_others":
							$reviewConstOtherValueGH = wv_formatDate($value);
							break;
						case "review_head":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewHeadValueGH = $orignalValue[0];
							break;
						case "review_head_others":
							$reviewHeadOtherValueGH = wv_formatDate($value);
							break;
						case "review_resp":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewRespValueGH = $orignalValue[0];
							break;
						case "review_resp_others":
							$reviewRespOtherValueGH = wv_formatDate($value);
							break;
						case "review_card":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewCardValueGH = $orignalValue[0];
							break;
						case "review_card_others":
							$reviewCardOtherValueGH = wv_formatDate($value);
							break;
						case "review_gastro":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewGastroValueGH = $orignalValue[0];
							break;
						case "review_gastro_others":
							$reviewGastroOtherValueGH = wv_formatDate($value);
							break;
						case "review_genit":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewGenitValueGH = $orignalValue[0];
							break;
						case "review_genit_others":
							$reviewGenitOtherValueGH = wv_formatDate($value);
							break;
						case "review_aller":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewAllerValueGH = $orignalValue[0];
							break;
						case "review_aller_others":
							$reviewAllerOtherValueGH = wv_formatDate($value);
							break;
						case "review_neuro":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$reviewNeuroValueGH = $orignalValue[0];
							break;
						case "review_neuro_others":
							$reviewNeuroOtherValueGH = wv_formatDate($value);
							break;
						case "desc_u":
							$descValueGH = wv_formatDate($value);
							break;
						case "desc_r":
							$descRValueGH = wv_formatDate($value);
							break;
						case "genMedComments":
							$genMedCommentsValueGH = wv_formatDate($value);
							break;
						case "relDescHighBp":

							$relDescHighBpValueGH =	($value) ? "<b>Yes</b> High Blood Pressure: " : "";
							$relDescHighBpValueGH .= $value;
							break;
						case "relDescHeartProb":
							$relDescHeartProbValueGH = ($value) ? "<b>Yes</b> Heart Problem: " : "";
							$relDescHeartProbValueGH .= $value;
							break;
						case "relDescLungProb":
							$relDescLungProbValueGH = ($value) ? "<b>Yes</b> Lung Problems: " : "";
							$relDescLungProbValueGH .= $value;

							break;
						case "relDescStrokeProb":
							$relDescStrokeProbValueGH = ($value) ? "<b>Yes</b> Stroke: " : "";
							$relDescStrokeProbValueGH .= $value;

							break;
						case "relDescThyroidProb":
							$relDescThyroidProbValueGH = ($value) ? "<b>Yes</b> Thyroid Problems: " : "";
							$relDescThyroidProbValueGH .= $value;
							break;
						case "relDescArthritisProb":
						//echo "<hr>".$value;die();
							$relDescArthritisProbValueGH = ($value) ? "<b>Yes</b> Arthritis: " : "";
							$relDescArthritisProbValueGH .= $value;
							break;
						case "sub_conditions_you":
							$subArthritisProbValueGH = wv_formatDate($value);
							$subArthritisProbValueGH=str_replace(array("7.1","7.2"),array("RA","OA"),$subArthritisProbValueGH);
							break;
						case "relDescUlcersProb":
							$relDescUlcersProbValueGH = ($value) ? "<b>Yes</b> Ulcers: " : "";
							$relDescUlcersProbValueGH .= $value;
							break;
						case "relDescLDL":
							$relDescLDLValueGH = ($value) ? "<b>Yes</b> LDL: " : "";
							$relDescLDLValueGH .= $value;
							break;
						case "relDescCancerProb":
							$relDescCancerProbValueGH = ($value) ? "<b>Yes</b> Cancer: " : "";
							$relDescCancerProbValueGH .= $value;
							break;

						case "ghRelDescOthers":
							$ghRelDescOthersValueGH = $value;
							break;
						case "negChkBx":
							$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
							$orignalValue = explode("~~~~",$orignalValue);
							$negChkBxValueGH = $orignalValue[0];
							break;
						case "desc_high_bp":
							$descValueDHB = wv_formatDate($value);
							break;
						case "desc_arthrities":
							$descValueDA = wv_formatDate($value);
							break;
						case "desc_lung_problem":
							$descValueDLP = wv_formatDate($value);
							break;
						case "desc_stroke":
							$descValueDS = wv_formatDate($value);
							break;
						case "desc_thyroid_problems":
							$descValueDTP = wv_formatDate($value);
							break;
						case "desc_ulcers":
							$descValueDU = wv_formatDate($value);
							break;
						case "desc_cancer":
							$descValueDC = wv_formatDate($value);
							break;
						case "desc_heart_problem":
							$descValueDHP = wv_formatDate($value);
							break;
						case "desc_genPreviousProblem":
							$descValueDGPP = wv_formatDate($value);
							break;
						case "desc_LDL":
							$descValueDLDL = wv_formatDate($value);
							break;
						case "diabetes_values":
							$descValueDV = wv_formatDate($value);
							break;
					endswitch;
				}

				//pre($dataFinal);


				if(count($dataFinal)>0){  ?>
  <?php if($medDoctorValueGH){ ?>
  <tr>
    <td class="paddingTop10" style="width:350px;"><b>Primary Care Provider :- </b><?php echo $medDoctorValueGH; ?></td>
    <td class="paddingTop10" style="width:350px;"><?php
							 $adoValue = $this->get_pt_data($pid);
							 if($adoValue['ado_option'])
							 { ?>
      <b>Advance Directive:</b>&nbsp;
      <?php
								echo $adoValue['ado_option'];

								/* image code start */
								$getScanID = "select * from ".constant("IMEDIC_SCAN_DB").".scans where patient_id = '".$dataFinal['patient_id']."' and form_id='0' and image_form = 'ptInfoMedHxGeneralHealth'";
								//echo $getScanID;

								$queryId = imw_query($getScanID);

								$arr = $this->return_records_array_mysql($queryId);

								$scan_id = $arr[0]["scan_id"];

								//echo  "http://localhost".$GLOBALS['rootdir'].$arr[0]['file_path'];

				$getImageQry = imw_query("SELECT image_name,file_path FROM ".constant("IMEDIC_SCAN_DB").".scans WHERE scan_id = '$scan_id'");
				$getImageRow = imw_fetch_assoc($getImageQry);

				if(!empty($getImageRow["file_path"]))
				{
					$chkPth = urldecode($this->data_file_path.$getImageRow["file_path"]);
					$pth ="";

					if(file_exists($chkPth)){
						$pth = $this->data_file_path.$getImageRow["file_path"];

					}
					else{
						$arrFilePath = explode("/",$getImageRow["file_path"]);
						$fileNameNew = urlencode($getImageRow["image_name"]);
						$totIndices = count($arrFilePath);
						$arrFilePath[$totIndices-1] = $fileNameNew;
						$newFilePath = implode("/",$arrFilePath);
						$chkPth = urldecode($this->data_file_path.$newFilePath);
						if(file_exists($chkPth))
						{
							$pth = $this->data_file_path.$newFilePath;
						}
					}
						if(file_exists($GLOBALS['path_for_pdf'].$pth) && $pth) {
							echo "<br/><br/><div style='clear:both;' align='center'><img style='margin:10px 0;' height='200' width='300' src='".$GLOBALS['path_for_pdf'].$pth."' /></div><br/><br/>";
							$ChartNoteImagesString[]=$GLOBALS['path_for_pdf'].$pth;
						}
				}


								/* image code end */
								?>
      <?php } else { echo "&nbsp;"; }
							 ?></td>
  </tr>
  <?php }
					 $arrBloodSuger = $this->getPatientBloodSurger($pid);
					   if(count($arrBloodSuger)>0){?>
  <tr>
    <td colspan="2" class="paddingTop10" style="width:720px;">
        <table style="width:750px;" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td colspan="6" class="paddingTop10 tb_subheading">BLOOD SUGAR</td>
        </tr>
        <tr>
          <td style="width:100px; font-weight:bold;" class="paddingTop10 pdl5">Date</td>
          <td style="width:150px; font-weight:bold;" class="paddingTop10">Blood Sugar(mg/dl)</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">HbA1c</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">Fasting</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">Time of Day</td>
          <td style="width:160px; font-weight:bold;" class="paddingTop10">Description</td>
        </tr>
        <tr>
          <td style="width:100px;" class="paddingTop10 pdl5"><?php
										 if($arrBloodSuger['creation_date']){
											$dateBloodSuger=$arrBloodSuger['creation_date'];
											$dateBlood=explode(" ",$dateBloodSuger);
											list($yy,$mm,$dd)=explode("-",$dateBlood[0]);
											if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
												//echo $mm."-".$dd."-".$yy;

												echo get_date_format($dateBlood[0]);
											}
										} ?></td>
          <td style="width:150px;" class="paddingTop10"><?php if($arrBloodSuger['sugar_value']){ echo $arrBloodSuger['sugar_value'];} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($arrBloodSuger['hba1c_val']){ echo $arrBloodSuger['hba1c_val'];} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($arrBloodSuger['is_fasting']==1){ echo "Yes";}else if($arrBloodSuger['is_fasting']==0){echo "No";} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($arrBloodSuger['time_of_day']){ echo $arrBloodSuger['time_of_day'];} ?></td>
          <td style="width:160px;" class="paddingTop10"><?php if($arrBloodSuger['description']){ echo $arrBloodSuger['description'];} ?></td>
        </tr>
        <tr>
          <td colspan="6" style="width:720px;" class="paddingTop10"><b>HbA1c Desc:&nbsp;</b>
            <?php if($arrBloodSuger['hba1c']){ echo $arrBloodSuger['hba1c'];} ?></td>
        </tr>
      </table>
    </td>
  </tr>
  <?php
						}
						$patientCholesterol=$this->getPatientcholesterol($pid);
						if(count($patientCholesterol)>0){
						?>
  <tr>
    <td colspan="2" style="width:720px;">
        <table style="width:720px;" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="6" class="paddingTop10 tb_subheading">CHOLESTEROL</td>
        </tr>
        <tr>
          <td style="width:100px; font-weight:bold;" class="paddingTop10 pdl5">Date</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">Total</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">Trig.</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">LDL</td>
          <td style="width:100px; font-weight:bold;" class="paddingTop10">HDL</td>
          <td style="width:200px; font-weight:bold;" class="paddingTop10">Description</td>
        </tr>
        <tr>
          <td style="width:100px;" class="paddingTop10 pdl5"><?php
										 if($patientCholesterol['creation_date']){
											$dateBloodSuger=$patientCholesterol['creation_date'];
											$dateBlood=explode(" ",$dateBloodSuger);
											list($yy,$mm,$dd)=explode("-",$dateBlood[0]);
											if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
												//echo $mm."-".$dd."-".$yy;
												echo get_date_format($dateBlood[0]);
											}
										} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($patientCholesterol['cholesterol_total']){ echo $patientCholesterol['cholesterol_total'];} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($patientCholesterol['cholesterol_triglycerides']){ echo $patientCholesterol['cholesterol_triglycerides'];} ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($patientCholesterol['cholesterol_LDL']){
											 $patientCholesterol['cholesterol_LDL'];
											 } ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($patientCholesterol['cholesterol_HDL']){ echo $patientCholesterol['cholesterol_HDL'];} ?></td>
          <td style="width:200px;" class="paddingTop10"><?php if($patientCholesterol['description']){ echo $patientCholesterol['description'];} ?></td>
        </tr>
      </table></td>
  </tr>
  <?php
						}
						if($genMedCommentsValueGH){?>
  <tr>
    <td class="paddingTop10" colspan="2" style="width:740px;"><b>Comments :-</b><?php echo $genMedCommentsValueGH; ?></td>
  </tr>
  <?php }?>
  <?php
				if(
				(!empty($anyConditionYouValueGH)) ||
				(!empty($anyConditionYouValueGH_n)) ||
				(!empty($relDescHighBpValueGH)) ||
				(!empty($relDescHeartProbValueGH)) ||
				(!empty($relDescLungProbValueGH)) ||
				(!empty($relDescStrokeProbValueGH)) ||
				(!empty($relDescThyroidProbValueGH)) ||
				(!empty($relDescArthritisProbValueGH)) ||
				(!empty($subArthritisProbValueGH)) ||
							(!empty($relDescUlcersProbValueGH)) ||
							(!empty($relDescLDLValueGH)) ||
							(!empty($relDescCancerProbValueGH)) ||
							(!empty($descValueGH)) ||
				(!empty($descRValueGH)) ||
				(!empty($anyConditionOtherValueGH)) ||
				(!empty($ghRelDescOthersValueGH)) ||
				(!empty($anyReviewConstValueGH)) ||
				(!empty($reviewHeadValueGH)) ||
				(!empty($reviewConstOtherValueGH)) ||
				(!empty($reviewHeadOtherValueGH)) ||
				(!empty($reviewRespValueGH)) ||
				(!empty($reviewCardValueGH)) ||
				(!empty($reviewRespOtherValueGH)) ||
				(!empty($reviewCardOtherValueGH)) ||
				(!empty($reviewGastroValueGH)) ||
				(!empty($reviewGenitValueGH)) ||
				(!empty($reviewGastroOtherValueGH)) ||
				(!empty($reviewGenitOtherValueGH)) ||
				(!empty($reviewAllerValueGH)) ||
				(!empty($reviewNeuroValueGH)) ||
				(!empty($reviewAllerOtherValueGH)) ||
				(!empty($reviewNeuroOtherValueGH)) ||
							(!empty($descValueDHB)) ||
							(!empty($descValueDA)) ||
							(!empty($descValueDLP)) ||
							(!empty($descValueDS)) ||
							(!empty($descValueDTP)) ||
							(!empty($descValueDU)) ||
							(!empty($descValueDC)) ||
							(!empty($descValueDHP)) ||
							(!empty($descValueDGPP)) ||
							(!empty($descValueDLDL)) ||
							(!empty($descValueDV))

				){?>
  <?php }?>
  <?php
		 ///  ANY CONDITION

		if($relDescHighBpValueGH || $relDescHeartProbValueGH || $relDescLungProbValueGH || $relDescStrokeProbValueGH ||
		$relDescThyroidProbValueGH || $relDescArthritisProbValueGH || $subArthritisProbValueGH || $relDescUlcersProbValueGH ||
		$relDescLDLValueGH || $relDescCancerProbValueGH||$anyConditionYouValueGH || $anyConditionYouValueGH_n) {

		?>
  <tr>
    <td style="width:370px;" class="text_lable paddingTop10"><?php if($anyConditionYouValueGH || $anyConditionYouValueGH_n){?>
      Patient:-
      <?php }?></td>
    <td style="width:370px;" class="text_lable paddingTop10"><?php if($relDescHighBpValueGH || $relDescHeartProbValueGH || $relDescLungProbValueGH || $relDescStrokeProbValueGH || $relDescThyroidProbValueGH || $relDescArthritisProbValueGH || $subArthritisProbValueGH || $relDescUlcersProbValueGH || $relDescLDLValueGH || $relDescCancerProbValueGH) {?>
      Blood relative :-
      <?php }?></td>
  </tr>
  <?php $arr_yes_no=array();
		$anyConditionYouValueGHExplode=$anyConditionYouValueGHExplode_n='';
		$anyConditionYouValueGHDesc='';
		if($anyConditionYouValueGH || $anyConditionYouValueGH_n) {
			$delimiter='~|~';
			$chk_under_control_pat = $this->get_set_pat_rel_values_retrive($dataFinal["chk_under_control"],'pat',$delimiter);
			$chk_under_control_arr = explode(",",$chk_under_control_pat);
		//pre($chk_under_control_arr);
			$anyConditionYouValueGHDesc.='<table style="width:740px;" cellpadding="0" cellspacing="0">';
			$anyConditionYouValueGHExplode = explode('<br>',$anyConditionYouValueGH);
			foreach($anyConditionYouValueGHExplode as $val_GH){
				if(trim($val_GH)){
					$arr_yes_no[$val_GH]="<b>Yes</b>&nbsp;";
				}
			}
			$anyConditionYouValueGHExplode_n = explode('<br>',$anyConditionYouValueGH_n);
			foreach($anyConditionYouValueGHExplode_n as $val_GH_no){
				if(trim($val_GH_no)){
				$arr_yes_no[$val_GH_no]="<b>No</b>&nbsp;";
				}
			}
			$anyConditionYouValueGHExplode_arr = array_merge($anyConditionYouValueGHExplode,$anyConditionYouValueGHExplode_n);
			//pre($anyConditionYouValueGHExplode_arr); die;
			   foreach($anyConditionYouValueGHExplode_arr as $acyValue) {
				if($acyValue==""){continue;}
				switch ($acyValue):
					case "High Blood Pressure":
						$stroke="";
						if(in_array("1",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$HBP = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDHB,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Heart Problem":
						$stroke="";
						if(in_array("2",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Hrt_Prblem = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDHP,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Arthritis":
						$stroke="";
						if(in_array("3",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Arthrtis = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($subArthritisProbValueGH,"pat",$delimiter,$hifen).$this->get_set_pat_rel_values_retrive($descValueDA,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Lung Problems":
						$stroke="";
						if(in_array("4",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$LPrblm = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDLP,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Stroke":
						$stroke="";
						if(in_array("5",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Strk = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDS,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Thyroid Problems":
						$stroke="";
						if(in_array("6",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$TPrblm = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDTP,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Diabetes":
						$stroke="";
						if(in_array("7",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Diabts = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueGH,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Ulcers":
						$stroke="";
						if(in_array("9",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Ulcr = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDU,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "LDL":
						$stroke="";
						if(in_array("8",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$L_D_L = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDLDL,"pat",$delimiter,$hifen)."</td></tr>";
						break;
					case "Cancer":
						$stroke="";
						if(in_array("11",$chk_under_control_arr)){
							$stroke="&nbsp;UC";
						}
						if(strpos($arr_yes_no[$acyValue],'No')){
							$Cancr = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
						}
						$anyConditionYouValueGHDesc.="<tr><td style='width:140px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:224px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDC,"pat",$delimiter,$hifen)."</td></tr>";
						break;
				endswitch;
			}

			//========================================================================================================================
			//BELOW CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX UNDER MED HX, IF ITS CHECKED, THEN ALL -VE CHECKBOXES WILL BE CHECKED AND NOW IT WILL BE DISPLAY ONLY KEYWORD "No known medical condition" RATHER THAN DISPLAYING ALL -VE VALUES.
			if(strpos($HBP,'No known medical condition')!==false && strpos($Hrt_Prblem,'No known medical condition')!==false && strpos($Arthrtis,'No known medical condition')!==false && strpos($LPrblm,'No known medical condition')!==false && strpos($Strk,'No known medical condition')!==false && strpos($TPrblm,'No known medical condition')!==false && strpos($Diabts,'No known medical condition')!==false && strpos($Ulcr,'No known medical condition')!==false && strpos($L_D_L,'No known medical condition')!==false && strpos($Cancr,'No known medical condition')!==false ){

				$anyConditionYouValueGHDesc = "";

				$anyConditionYouValueGHDesc="<table style='width:740px;' cellpadding='0' cellspacing='0'><tr><td style='width:380px;' class='paddingTop10'>No known medical conditions</td></tr>";
			}
			//========================================================================================================================
			$anyConditionYouValueGHDesc.="</table>";
		}
		if(!$anyConditionYouValueGHDesc) { $anyConditionYouValueGHDesc .= $anyConditionYouValueGH;}
		$arr_no_famliy_blood_relative=explode(",",$dataFinal['any_conditions_relative1_n']);

		$arr_GenHealth_Label=array();
		//echo 'arrMEDHXGenralHealth>>'. print_r($arrMEDHXGenralHealth).'<Br/>';
		//pre($arrMEDHXGenralHealth);die;
		foreach($arrMEDHXGenralHealth as $GenHealtLabel){
			$label_key=$GenHealtLabel['Filed_Label_Val'];
			$label_val=$GenHealtLabel['Filed_Label_Og_Val'];
			if($GenHealtLabel['Filed_Label']=="any_conditions_relative"){
				$arr_GenHealth_Label[$label_key]="&nbsp;".$label_val;
			}
		}$High_Blood_Pressure_no=$Heart_Problem_no=$Diabetes_no=$Lung_Problems_no=$Stroke_no=$Thyroid_Problems_no=$Arthritis_no=$Ulcers_no=$LDL_no=$Cancer_no="";
		//pre($arr_GenHealth_Label[$label_key]); die;
		//pre($arr_no_famliy_blood_relative); die;
		foreach($arr_no_famliy_blood_relative as $famlily_relative_val){

			if($famlily_relative_val==1){
				$High_Blood_Pressure_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}

			if($famlily_relative_val==2){
				$Heart_Problem_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==3){
				$Diabetes_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==4){
				$Lung_Problems_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==5){
				$Stroke_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==6){
				$Thyroid_Problems_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==7){
				$Arthritis_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==8){
				$Ulcers_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==13){
				$LDL_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
			if($famlily_relative_val==14){
				$Cancer_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
			}
		}?>
  <tr>
    <td class="paddingTop10" style="width:370px;"><?php echo $anyConditionYouValueGHDesc; ?></td>
    <td class="paddingTop10" style="width:370px;"><table style="width:370px;" cellpadding="0" cellspacing="0">
        <?php
					$hifen="";
						//echo "<hr>".$relDescHighBpValueGH."".$descValueDHB."<hr>";die();
					$c1=$relDescHighBpValueGH.$this->get_set_pat_rel_values_retrive($descValueDHB,"rel",$delimiter,$hifen);
					//================================================================================================================
				   //BELOW CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX UNDER MED HX, IF ITS CHECKED, THEN ALL -VE CHECKBOXES WILL BE CHECKED AND NOW IT WILL BE DISPLAY ONLY KEYWORD "No known medical condition" RATHER THAN DISPLAYING ALL -VE VALUES.
					if(strpos($High_Blood_Pressure_no,"No") && strpos($Heart_Problem_no,"No") && strpos($Diabetes_no,"No") && strpos($Lung_Problems_no,"No") && strpos($Stroke_no,"No") && strpos($Thyroid_Problems_no,"No") && strpos($Arthritis_no,"No") && strpos($Ulcers_no,"No") && strpos($LDL_no,"No") && strpos($Cancer_no,"No")){

						$High_Blood_Pressure_no = $Heart_Problem_no = $Diabetes_no = $Lung_Problems_no = $Stroke_no = $Thyroid_Problems_no = $Arthritis_no = $Ulcers_no =  $LDL_no =  $Cancer_no = "";

						$High_Blood_Pressure_no = "No known medical conditions";
					}
					//===============================================================================================================
					if($relDescHighBpValueGH==''){$relDescHighBpValueGH=$High_Blood_Pressure_no;}
					if((trim($c1)!="" && $relDescHighBpValueGH) || $High_Blood_Pressure_no){

						if(strpos($relDescHighBpValueGH,"No known medical conditions")){
							echo("<tr><td style='width:370px;'>No known medical conditions</td></tr>");
							//IF MED HX "No known medical conditions"  WILL TRUE THEN IT WILL WORK.
						}else{
							echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescHighBpValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDHB,"rel",$delimiter,$hifen)."</td></tr>");
						}
					}
					$c2=$relDescHeartProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDHP,"rel",$delimiter,$hifen);
					if(($c2!="" && $relDescHeartProbValueGH) || $Heart_Problem_no){
						if(trim($relDescHeartProbValueGH)==''){$relDescHeartProbValueGH=$Heart_Problem_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescHeartProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDHP,"rel",$delimiter,$hifen)."</td></tr>");
					}
					$c3=$relDescLungProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDLP,"rel",$delimiter,$hifen);
					if(($c3!="" && $relDescLungProbValueGH) || $Lung_Problems_no){
						if($relDescLungProbValueGH==''){$relDescLungProbValueGH=$Lung_Problems_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescLungProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDLP,"rel",$delimiter,$hifen)."</td></tr>");
					}
					$c4=$relDescStrokeProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDS,"rel",$delimiter,$hifen);
					if(($c4!="" && $relDescStrokeProbValueGH) || $Stroke_no){
						if($relDescStrokeProbValueGH==''){$relDescStrokeProbValueGH=$Stroke_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescStrokeProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDS,"rel",$delimiter,$hifen)."</td></tr>");
					}
					$c5=$relDescThyroidProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDTP,"rel",$delimiter,$hifen);
					if(($c5!="" && $relDescThyroidProbValueGH) || $Thyroid_Problems_no){
						if($relDescThyroidProbValueGH==""){$relDescThyroidProbValueGH=$Thyroid_Problems_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescThyroidProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDTP,"rel",$delimiter,$hifen)."</td></tr>");
					}
					if($Diabetes_no){
						echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$Diabetes_no)."</td><td style='width:100px;' class='paddingTop10'></td></tr>");
					}
					$c6=$relDescArthritisProbValueGH.$this->get_set_pat_rel_values_retrive($subArthritisProbValueGH,"rel",$delimiter,$hifen).$this->get_set_pat_rel_values_retrive($descValueDA,"rel",$delimiter,$hifen);
					if(($c6!="" && $relDescArthritisProbValueGH) || $Arthritis_no){
						if($relDescArthritisProbValueGH==''){$relDescArthritisProbValueGH=$Arthritis_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescArthritisProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($subArthritisProbValueGH,"rel",$delimiter,$hifen).$this->get_set_pat_rel_values_retrive($descValueDA,"rel",$delimiter,$hifen)."</td></tr>");
					}
					$c7=$relDescUlcersProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDU,"rel",$delimiter,$hifen);
					if(($c7!="" && $relDescUlcersProbValueGH) || $Ulcers_no){
						if($relDescUlcersProbValueGH==''){$relDescUlcersProbValueGH=$Ulcers_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescUlcersProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDU,"rel",$delimiter,$hifen)."</td></tr>");
					}$c8=$relDescLDLValueGH.$this->get_set_pat_rel_values_retrive($descValueDLDL,"rel",$delimiter,$hifen);
					if(($c8!="" && $relDescLDLValueGH) || $LDL_no){
						if($relDescLDLValueGH==''){$relDescLDLValueGH=$LDL_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescLDLValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDLDL,"rel",$delimiter,$hifen)."</td></tr>");
					}
					$c9=$relDescCancerProbValueGH.$this->get_set_pat_rel_values_retrive($descValueDC,"rel",$delimiter,$hifen);
					if(($c9!="" && $relDescCancerProbValueGH) || $Cancer_no){
						if($relDescCancerProbValueGH==''){$relDescCancerProbValueGH=$Cancer_no;}
						echo("<tr><td style='width:140px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:120px;' class='paddingTop10'>",$relDescCancerProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".$this->get_set_pat_rel_values_retrive($descValueDC,"rel",$delimiter,$hifen)."</td></tr>");
					}
				?>
      </table></td>
  </tr>
  <?php

		} //END ANY CONDITION

		?>
  <?php
		//Diabtese
		if((trim($descRValueGH)!="" && trim($descRValueGH)!="~|~") || (trim($descValueGH)!="" && trim($descValueGH)!="~|~")){

		?>
  <tr>
    <td  class="text_lable paddingTop10" style="width:370px;"><?php if($descValueGH!=""){?>
      Patient Diabetes:
      <?php }?></td>
    <td  style="width:370px;"  class="text_lable paddingTop10"><?php if($descRValueGH!=""){?>
      Relative Diabetes:
      <?php }?></td>
  </tr>
  <tr>
    <td style="width:370px;" class="paddingTop10"><?php
					echo $this->get_set_pat_rel_values_retrive($descValueGH,"pat",$delimiter);
					echo $this->get_set_pat_rel_values_retrive($descValueDV,"pat",$delimiter,$hifen);
				?></td>
    <td style="width:370px;" class="paddingTop10"><?php
					echo $descRValueGH;
					echo $this->get_set_pat_rel_values_retrive($descValueGH,"rel",$delimiter,$hifen);
					echo $this->get_set_pat_rel_values_retrive($descValueDV,"rel",$delimiter,$hifen);
				?></td>
  </tr>
  <?php
		}/////Diabtese End

		//ANY CONDITION Other
		$tmp = $this->get_set_pat_rel_values_retrive($anyConditionOtherValueGH,"pat",$delimiter);
		if($anyConditionOtherValueGH!="" && $tmp!=""){

		?>
  <tr>
    <td colspan="2" style="width:730px;" class="text_lable paddingTop10"><?php if($anyConditionOtherValueGH!=""){?>
      Any condition other
      <?php }?></td>
  </tr>
  <tr>
    <td colspan="2" style="width:730px;" class="paddingTop10"><?php echo $tmp;?></td>
  </tr>
  <?php
		} //End ANY CONDITION Other

		//Relative condition other
		$tmp = $this->get_set_pat_rel_values_retrive($anyConditionOtherValueGH,"rel",$delimiter,$hifen);
		if($ghRelDescOthersValueGH!=""||$tmp!=""){?>
  <tr>
    <td colspan="2" class="text_lable paddingTop10" > Relative condition other </td>
  </tr>
  <tr>
    <td colspan="2" class="paddingTop10" style="width:700px;" ><?php echo $ghRelDescOthersValueGH;
					echo "&nbsp;".$tmp;
				?></td>
  </tr>
  <?php
		} //END Relative condition other
		$arrGenMed=$this->get_general_medicine($pid);
		if(count($arrGenMed)>0 && ($arrGenMed['chk_annual_colorectal_cancer_screenings']==1 ||$arrGenMed['chk_receiving_annual_mammogram']==1 || $arrGenMed['nutrition_counseling']==1 || $arrGenMed['nutrition_counseling_date']!="0000-00-00" || $arrGenMed['chk_received_flu_vaccine']==1 || $arrGenMed['chk_high_risk_for_cardiac']==1 || $arrGenMed['physical_activity_counseling']==1 || $arrGenMed['physical_activity_counseling_date']!="0000-00-00") || $arrGenMed['chk_received_pneumococcal_vaccine']==1 || $arrGenMed['chk_fall_risk_assd']==1 || $arrGenMed['chk_blood_pressure']==1 || $arrGenMed['chk_bmi']==1 || $arrGenMed['received_flu_vaccine_type']!=='' || $arrGenMed['received_flu_vaccine_type']!=='' || $arrGenMed['pneumococcal_vaccine_type']!=='' || $arrGenMed['fall_risk_ass_type']!=='' || $arrGenMed['blood_pressure_type']!=='' || $arrGenMed['bmi_type']!==''){

			//==============GET GEN. HEALTH VS DATA================
			$gnHlthVSData ="";
			$gnHlthVSData = $this->getGenHealthVSData($_SESSION['form_id_by_taran']);
			?>
  <tr>
    <td colspan="2" style="width:740px;"><table style="width:740px; " cellpadding="0" cellspacing="0">
        <?php if($arrGenMed['chk_annual_colorectal_cancer_screenings']==1 || $arrGenMed['chk_receiving_annual_mammogram']==1){?>
        <tr>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_annual_colorectal_cancer_screenings']==1){?>
            <b>Annual colorectal cancer screenings:</b>&nbsp;Yes
            <?php } ?></td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_receiving_annual_mammogram']==1){?>
            <b>Receiving annual mammogram:</b>&nbsp;Yes
            <?php } ?></td>
        </tr>
        <?php }
		 if($arrGenMed['chk_receiving_annual_mammogram']==1 || $arrGenMed['nutrition_counseling_date']!="0000-00-00"){
		?>
        <tr>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['nutrition_counseling']==1){?>
            <b>Counseling for Nutrition/Diet:</b>&nbsp;Yes
            <?php }	?></td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['nutrition_counseling_date']!="0000-00-00"){
								$yy=$mm=$dd="";
								list($yy,$mm,$dd)=explode("-",$arrGenMed['nutrition_counseling_date']);
								if($yy!="" && $yy!="0000" && $mm!="00" && $mm!="" && $dd!="" && $dd!="00"){
									//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
									echo "<b>Date:</b>&nbsp;".get_date_format($arrGenMed['nutrition_counseling_date']);
								}
							}
							?></td>
        </tr>
        <?php }
			 if($arrGenMed['chk_received_flu_vaccine']==1 || $arrGenMed['chk_high_risk_for_cardiac']==1){
		 ?>
        <tr>
          <td style="width:370px;" class="paddingTop10">
			<?php if($arrGenMed['chk_received_flu_vaccine']==1){ ?>
				<b>Received flu vaccine:</b>&nbsp;Yes
				<?php
				if($arrGenMed['chk_received_flu_vaccine']==1 && $arrGenMed['received_flu_vaccine_type'] && $arrGenMed['received_flu_vaccine_type']!==''){ ?>
				<b><br>
					Desc:</b>&nbsp; <?php print_r($arrGenMed['received_flu_vaccine_type']);
				}
			 } ?>
		  </td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_high_risk_for_cardiac']==1){?>
            <b>High-risk for cardiac events on aspirin prophylaxis:</b>&nbsp;Yes
            <?php }?></td>
        </tr>
        <?php }
				if($arrGenMed['physical_activity_counseling']==1 || $arrGenMed['physical_activity_counseling_date']){
				 ?>
        <tr>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['physical_activity_counseling']==1){?>
            <b>Counseling for Physical Activity:</b>&nbsp;Yes
            <?php }?></td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['physical_activity_counseling_date']){
								$yy=$mm=$dd="";
								list($yy,$mm,$dd)=explode("-",$arrGenMed['physical_activity_counseling_date']);
								if($yy!="" && $yy!="0000" && $mm!="00" && $mm!="" && $dd!="" && $dd!="00"){
									//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
									echo "<b>Date:</b>&nbsp;".get_date_format($arrGenMed['physical_activity_counseling_date']);
								}
							 } ?></td>
        </tr>
        <?php }
					 if($arrGenMed['chk_received_pneumococcal_vaccine']==1 || $arrGenMed['pneumococcal_vaccine_type']!=='' || $arrGenMed['chk_fall_risk_assd']==1 || $arrGenMed['fall_risk_ass_type']!=''){
				?>
        <tr>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_received_pneumococcal_vaccine']==1){ ?>
            <b>Received Pneumococcal Vaccine:</b>&nbsp;Yes
            <?php }
							if($arrGenMed['chk_received_pneumococcal_vaccine']==1 && $arrGenMed['pneumococcal_vaccine_type'] && $arrGenMed['pneumococcal_vaccine_type']!==''){ ?>
            <b><br>
            Desc:</b>&nbsp; <?php print_r($arrGenMed['pneumococcal_vaccine_type']); } ?></td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_fall_risk_assd']==1){?>
            <b>Falls: Risk Assessment:</b>&nbsp;Yes
            <?php }
							if($arrGenMed['chk_fall_risk_assd']==1 && $arrGenMed['fall_risk_ass_type'] && $arrGenMed['fall_risk_ass_type']!==''){ ?>
            <b><br>
            Desc:</b>&nbsp; <?php print_r($arrGenMed['fall_risk_ass_type']); } ?></td>
        </tr>
        <?php }
					 if($arrGenMed['chk_blood_pressure']==1 || $arrGenMed['blood_pressure_type'] || $arrGenMed['chk_bmi']==1 || $arrGenMed['bmi_type'] || !empty($getSysBP) || !empty($getDysBP) ){
		 ?>
        <tr>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_blood_pressure']==1){ ?>
            <b>Blood Pressure:</b>&nbsp;Yes
            <?php }
							if(!empty($gnHlthVSData[0]) || !empty($gnHlthVSData[1])){
							?>
            <b><br>
            B/P - S/D:</b>&nbsp;
            <?php
							echo $gnHlthVSData[0].'&nbsp;/&nbsp;'.$gnHlthVSData[1].'&nbsp;<i>mmHg</i>';
							}

							if($arrGenMed['chk_blood_pressure']==1 && $arrGenMed['blood_pressure_type'] && $arrGenMed['blood_pressure_type']!==''){ ?>
            <b><br>
            Desc:</b>&nbsp; <?php print_r($arrGenMed['blood_pressure_type']); } ?></td>
          <td style="width:370px;" class="paddingTop10"><?php if($arrGenMed['chk_bmi']==1){?>
            <b>BMI:</b>&nbsp;Yes
            <?php }
							if(!empty($gnHlthVSData[2]) && !empty($gnHlthVSData[3])){
								echo '<b><br>Height:</b>&nbsp;'.$gnHlthVSData[2].'&nbsp;'.$gnHlthVSData[3].'';
							}
							if(!empty($gnHlthVSData[4]) && !empty($gnHlthVSData[5])){
								echo '<b>&nbsp;&nbsp;Weight:</b>&nbsp;'.$gnHlthVSData[4].'&nbsp;'.$gnHlthVSData[5].'';
							}
							if(!empty($gnHlthVSData[6]) && !empty($gnHlthVSData[7])){
								echo '<b>&nbsp;&nbsp;BMI=</b>&nbsp;'.$gnHlthVSData[6].'&nbsp;'.$gnHlthVSData[7].'';
							}
							if($arrGenMed['chk_bmi']==1 && $arrGenMed['bmi_type'] && $arrGenMed['bmi_type']!==''){?>
            <b><br>
            Desc:</b>&nbsp; <?php print_r($arrGenMed['bmi_type']); } ?></td>
        </tr>
        <?php } ?>
      </table></td>
  </tr>
  <?php
		}
		?>
  <?php
				 if(
				(!empty($anyReviewConstValueGH)) ||
				(!empty($reviewHeadValueGH)) ||
				(!empty($reviewConstOtherValueGH)) ||
				(!empty($reviewHeadOtherValueGH)) ||
				(!empty($reviewRespValueGH)) ||
				(!empty($reviewCardValueGH)) ||
				(!empty($reviewRespOtherValueGH)) ||
				(!empty($reviewCardOtherValueGH)) ||
				(!empty($reviewGastroValueGH)) ||
				(!empty($reviewGenitValueGH)) ||
				(!empty($reviewGastroOtherValueGH)) ||
				(!empty($reviewGenitOtherValueGH)) ||
				(!empty($reviewAllerValueGH)) ||
				(!empty($reviewNeuroValueGH)) ||
				(!empty($reviewAllerOtherValueGH)) ||
				(!empty($reviewNeuroOtherValueGH)) ||
				(!empty($review_intgmntrGH)) ||
				(!empty($review_psychiatryGH)) ||
				(!empty($review_blood_lymphGH)) ||
				(!empty($review_musculoskeletalGH)) ||
				(!empty($review_endocrineGH)) ||
				(!empty($review_eyeGH)) ||
				(!empty($negChkBxValueGH))

				){
		?>
  <tr>
    <td colspan="2" class="text_lable paddingTop10" style="width:730px;" > Review of Systems </td>
  </tr>

  <?php

	$ros_pos=array(  $reviewAllerValueGH, $reviewCardValueGH,
				$anyReviewConstValueGH, $reviewHeadValueGH,
				$review_endocrineGH, $review_eyeGH,
				$reviewGastroValueGH, $reviewGenitValueGH,
				$review_blood_lymphGH, $review_intgmntrGH,
				$review_musculoskeletalGH,$reviewNeuroValueGH,
				$review_psychiatryGH,$reviewRespValueGH);
	$ros_pos_other=array(
					$reviewAllerOtherValueGH,$reviewCardOtherValueGH,
					$reviewConstOtherValueGH,$reviewHeadOtherValueGH,
					$review_endocrineOtherGH,$review_eyeOtherGH,
					$reviewGastroOtherValueGH,$reviewGenitOtherValueGH,
					$review_blood_lymphOtherGH,$review_intgmntrOtherGH,
					$review_musculoskeletalOtherGH, $reviewNeuroOtherValueGH,
					$review_psychiatryOtherGH,$reviewRespOtherValueGH);
	$this->get_med_ros($ros_pos, $ros_pos_other, $negChkBxValueGH);

?>

  <?php
		}//End ROS

			$socialHis=$this->get_social_history($pid);
			if(count($socialHis)>0  && ($socialHis['smoking_status']!="")){
				?>
  <tr>
    <td style="width:740px;" colspan="2"><table style="width:740px;" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="4"class="paddingTop10 tb_subheading">SOCIAL HISTORY</td>
        </tr>
        <?php if(!in_array("mu_data_set_smoking",$_REQUEST['chart_exclusion'])){ ?>
        <tr>
          <td style="width:350px;" class="paddingTop10"><?php
									if($socialHis['smoking_status']){
									 ?>
            <b>Smoke:</b>&nbsp;<?php echo str_replace("/","<br><b>SNOMED Code:&nbsp;</b>",$socialHis['smoking_status']);
									}?></td>
          <td style="width:130px;" class="paddingTop10"><?php if($socialHis['source_of_smoke']){ ?>
            <b>Type:</b>&nbsp;
            <?php
										echo $socialHis['source_of_smoke'];
									 } ?></td>
          <td style="width:150px;" class="paddingTop10"><?php if($socialHis['smoke_perday']){ ?>
            <b>Frequency:</b>&nbsp;
            <?php
										echo $socialHis['smoke_perday'];
									 } ?></td>
          <td style="width:100px;" class="paddingTop10"><?php if($socialHis['number_of_years_with_smoke']!="0" && $socialHis['smoke_years_months']){ ?>
            <b>Period:</b>&nbsp;
            <?php
											echo $socialHis['number_of_years_with_smoke']." ".$socialHis['smoke_years_months'];
									 } ?></td>
        </tr>
        <tr>
          <td style="width:350px;" class="paddingTop10"><?php if($socialHis['smoke_counseling']==1){ ?>
            <b>Cessation Counseling:</b>&nbsp;Yes
            <?php }
										$mm=$dd=$yy="";
										if($socialHis['offered_cessation_counselling_date']){
											list($yy,$mm,$dd)=explode("-",$socialHis['offered_cessation_counselling_date']);
											if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
												//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
												echo "<b>Date:</b>&nbsp;".get_date_format($socialHis['offered_cessation_counselling_date']);
											}
										}
									 ?></td>
          <td colspan="3" style="width:350px;" class="paddingTop10"><?php if($socialHis['cessation_counselling_option']){ ?>
            <b>Type:</b>&nbsp;
            <?php
										echo $socialHis['cessation_counselling_option'];
									 } ?></td>
        </tr>
        <tr>
          <td style="width:350px;" class="paddingTop10"><?php if($socialHis['alcohal'] || $socialHis['consumption'] || $socialHis['list_drugs'] || $socialHis['otherSocial']){ ?>
            <table style="width:350px;" cellpadding="0" cellspacing="0">
              <tr>
                <td style="width:350px;" class="paddingTop10 tb_subheading">Alcohol</td>
              </tr>
              <tr>
                <td style="width:350px;" class="paddingTop10"><?php
												if($socialHis['alcohal']){
													echo $socialHis['alcohal'];
												}
												if($socialHis['consumption'] || $socialHis['alcohal_time']){
													echo "&nbsp;<b>Frequency:</b>&nbsp;".$socialHis['consumption']." ".$socialHis['alcohal_time'];
												}
												?></td>
              </tr>
              <tr>
                <td style="width:350px;" class="paddingTop10"><?php
												if($socialHis['list_drugs']){
													echo "<b>List any Drugs:&nbsp;</b>".$socialHis['list_drugs'];
												}
												if($socialHis['otherSocial']){
													echo "&nbsp;<b>More Information:&nbsp;</b>".$socialHis['otherSocial'];
												}
												?></td>
              </tr>
            </table>
            <?php } ?></td>
          <td colspan="3" style="width:380px;" ><?php if($socialHis['family_smoke']=="1" && ($socialHis['smokers_in_relatives'] || $socialHis['smoke_description'])){?>
            <table style="width:380px;" cellpadding="0" cellspacing="0">
              <tr>
                <td style="width:380px;" class="paddingTop10 tb_subheading">FAMILY Hx of SMOKING - Yes</td>
              </tr>
              <tr>
                <td style="width:380px;" class="paddingTop10" ><?php if($socialHis['smokers_in_relatives']){
													 echo "<b>Relation:</b>&nbsp;".$socialHis['smokers_in_relatives'];
												}
												 ?></td>
              </tr>
              <tr>
                <td style="width:380px;" class="paddingTop10	"><b>Description:</b>&nbsp;<?php echo $socialHis['smoke_description']; ?></td>
              </tr>
            </table>
            <?php } ?></td>
        </tr>
        <?php } ?>
      </table></td>
  </tr>
  <?php
				}
			}
	//MEDHX -> GENERAL HEALTH CUSTOM FIELD COMPLETE PATIENT RECORD PRINTING WORK
	$customFieldsGenHlth=$this->get_customFields_MedHx($pid,'general_health');
	if(count($customFieldsGenHlth)>0)
	{
	?>
	<tr>
		<td style="width:740px;" colspan="2">
			<table style="width:740px;" cellpadding="0" cellspacing="0">
				<tr>
				  <td colspan="4"class="paddingTop10 tb_subheading">Miscellaneous</td>
				</tr>
				<tr>
					<?php
						if(is_array($customFieldsGenHlth) && count($customFieldsGenHlth)>0){
							$counter = 0;
							foreach($customFieldsGenHlth as $v) { $counter++;
								if( $v['adminControlLable'] && (!empty($v['patientControlVal']) && (($v['type'] == 'text') || ($v['type'] == 'checkbox' && $v['cbkControlVal'] == 'checked' )) ))
					?>
								<td style="width:350px;" class="paddingTop10">
									<b><?php echo $v['adminControlLable']; ?>:</b>&nbsp;<?php echo $v['patientControlVal']; ?>
								</td>
					<?php
								if( $counter % 2 == 0) echo '</tr><tr>';
							}
						}
					?>
				</tr>
			</table>
		</td>
	</tr>
<?php }	?>
</table>
<?php
			}
		}
	}
	public function get_social_history($pid){
		$arrSocialHistory=array();
		if($pid){
			$qrySocialHistory="select smoking_status,source_of_smoke ,smoke_perday ,number_of_years_with_smoke ,smoke_years_months,smoke_counseling,offered_cessation_counselling_date,cessation_counselling_option,cessation_counselling_other,smoke_description,family_smoke,smokers_in_relatives,alcohal,consumption,alcohal_time,list_drugs,otherSocial from social_history where patient_id='".$pid."'";

			$resSocialHistory=imw_query($qrySocialHistory)or die(imw_error());
			if(imw_num_rows($resSocialHistory)>0){
				$rowSocialHistory=imw_fetch_assoc($resSocialHistory);
				$arrSocialHistory['smoking_status']=$rowSocialHistory['smoking_status'];
				$arrSocialHistory['source_of_smoke']=$rowSocialHistory['source_of_smoke'];
				$arrSocialHistory['smoke_perday']=$rowSocialHistory['smoke_perday'];
				$arrSocialHistory['number_of_years_with_smoke']=$rowSocialHistory['number_of_years_with_smoke'];
				$arrSocialHistory['smoke_years_months']=$rowSocialHistory['smoke_years_months'];
				$arrSocialHistory['smoke_counseling']=$rowSocialHistory['smoke_counseling'];
				$arrSocialHistory['offered_cessation_counselling_date']=$rowSocialHistory['offered_cessation_counselling_date'];
				$arrSocialHistory['cessation_counselling_option']=$rowSocialHistory['cessation_counselling_option'];

				$arrSocialHistory['cessation_counselling_other']=$rowSocialHistory['cessation_counselling_other'];
				$arrSocialHistory['smoke_description']=$rowSocialHistory['smoke_description'];
				$arrSocialHistory['family_smoke']=$rowSocialHistory['family_smoke'];
				$arrSocialHistory['smokers_in_relatives']=$rowSocialHistory['smokers_in_relatives'];
				$arrSocialHistory['family_smoke']=$rowSocialHistory['family_smoke'];

				$arrSocialHistory['alcohal']=$rowSocialHistory['alcohal'];
				$arrSocialHistory['family_smoke']=$rowSocialHistory['family_smoke'];
				$arrSocialHistory['smokers_in_relatives']=$rowSocialHistory['smokers_in_relatives'];
				$arrSocialHistory['alcohal']=$rowSocialHistory['alcohal'];
				$arrSocialHistory['consumption']=$rowSocialHistory['consumption'];
				$arrSocialHistory['alcohal_time']=$rowSocialHistory['alcohal_time'];
				$arrSocialHistory['list_drugs']=$rowSocialHistory['list_drugs'];
				$arrSocialHistory['otherSocial']=$rowSocialHistory['otherSocial'];
			}
		}
		return $arrSocialHistory;
	}

	public function get_general_medicine($pid){
	$arrGeneralMedicine=array();
	if($pid){
		$qry_general_medicine="select chk_annual_colorectal_cancer_screenings,chk_receiving_annual_mammogram,nutrition_counseling,chk_received_flu_vaccine,chk_high_risk_for_cardiac,physical_activity_counseling,physical_activity_counseling_date,nutrition_counseling_date,chk_received_pneumococcal_vaccine,chk_fall_risk_assd,chk_blood_pressure,chk_bmi,received_flu_vaccine_type,pneumococcal_vaccine_type,fall_risk_ass_type,blood_pressure_type,bmi_type from general_medicine where patient_id='".$pid."'";
		$res_general_medicine=imw_query($qry_general_medicine);
		$row_general_medicine=imw_fetch_assoc($res_general_medicine);
		$arrGeneralMedicine['chk_annual_colorectal_cancer_screenings']=$row_general_medicine['chk_annual_colorectal_cancer_screenings'];
		$arrGeneralMedicine['chk_receiving_annual_mammogram']=$row_general_medicine['chk_receiving_annual_mammogram'];
		$arrGeneralMedicine['nutrition_counseling']=$row_general_medicine['nutrition_counseling'];
		$arrGeneralMedicine['chk_received_flu_vaccine']=$row_general_medicine['chk_received_flu_vaccine'];
		$arrGeneralMedicine['chk_high_risk_for_cardiac']=$row_general_medicine['chk_high_risk_for_cardiac'];
		$arrGeneralMedicine['physical_activity_counseling']=$row_general_medicine['physical_activity_counseling'];
		$arrGeneralMedicine['physical_activity_counseling_date']=$row_general_medicine['physical_activity_counseling_date'];
		$arrGeneralMedicine['nutrition_counseling_date']=$row_general_medicine['nutrition_counseling_date'];
		$arrGeneralMedicine['chk_received_pneumococcal_vaccine']=$row_general_medicine['chk_received_pneumococcal_vaccine'];
		$arrGeneralMedicine['chk_fall_risk_assd']=$row_general_medicine['chk_fall_risk_assd'];
		$arrGeneralMedicine['chk_blood_pressure']=$row_general_medicine['chk_blood_pressure'];
		$arrGeneralMedicine['chk_bmi']=$row_general_medicine['chk_bmi'];
		$arrGeneralMedicine['received_flu_vaccine_type']=$row_general_medicine['received_flu_vaccine_type'];
		$arrGeneralMedicine['pneumococcal_vaccine_type']=$row_general_medicine['pneumococcal_vaccine_type'];
		$arrGeneralMedicine['fall_risk_ass_type']=$row_general_medicine['fall_risk_ass_type'];
		$arrGeneralMedicine['blood_pressure_type']=$row_general_medicine['blood_pressure_type'];
		$arrGeneralMedicine['bmi_type']=$row_general_medicine['bmi_type'];
	}
	return $arrGeneralMedicine;
}

	public function getOrignalValWt2SepChronicRelative($Old_Value,$New_Value,$arrMEDHXOculer,$Field_Label,$case){
		$arrTmp = array();
		$OldValueOrignal = "";
		$strSep="~!!~~";
		$strSep2=":*:";
		$arrOldVal = explode($strSep, $Old_Value);
		if($case=="chronicRelative"){
		//pre($arrOldVal);
		}

		foreach($arrOldVal as $keyOld => $valueOld){
			$arrTmp[] = explode($strSep2,$valueOld);
		}
		foreach ($arrTmp as $key => $value) {
			foreach ($value as $keyInner => $valueInner) {
				if ($value[$keyInner] == "") {unset($arrTmp[$key]);}
			}
		}

		if($case=="chronicRelative"){
		}
		$OldValueOrignal.='<table style="width:440px;" cellpadding="0" cellspacing="0">';
		foreach ($arrMEDHXOculer as $key => $value) {
			if($arrMEDHXOculer[$key]['Filed_Label'] == $Field_Label){
				foreach ($arrTmp as $keyOld => $valueOld) {
					foreach ($valueOld as $keyInner => $valueInner) {
						if ($valueOld[$keyInner] == $arrMEDHXOculer[$key]['Filed_Label_Val']){
							$valSplit=explode(",",$valueOld[$keyInner+1]);
							$familySplitVal=end($valSplit);

							$OldValueOrignal .= "<tr><td style='width:130px;' class='paddingTop10'>".$arrMEDHXOculer[$key]['Filed_Label_Og_Val']."</td><td style='width:130px;' class='paddingTop10'>".str_replace(",".$familySplitVal,"",$valueOld[$keyInner+1])."</td>
							<td style='width:130px;' class='paddingTop10'>".$valueOld[2]."</td></tr>";
							unset($arrTmp[$keyOld]);
							break;
						}
					}
				}
			}
		}
		if($case=="chronicRelative"){
			//pre($valueOld);die();
		}

		$OldValueOrignal.='</table>';
		$Old_Value = $OldValueOrignal;

		$newValueOrignal = "";
		$arrTmp = array();
		$strSep="~!!~~";
		$strSep2=":*:";
		$arrOldVal = explode($strSep, $New_Value);
		foreach($arrOldVal as $keyOld => $valueOld){
			$arrTmp[] = explode($strSep2,$valueOld);
		}
		foreach ($arrTmp as $key => $value) {
			foreach ($value as $keyInner => $valueInner) {
				if ($value[$keyInner] == "") {unset($arrTmp[$key]);}
			}
		}
		foreach ($arrMEDHXOculer as $key => $value) {
			if($arrMEDHXOculer[$key]['Filed_Label'] == $Field_Label){
				foreach ($arrTmp as $keyOld => $valueOld) {
					foreach ($valueOld as $keyInner => $valueInner) {
						if ($valueOld[$keyInner] == $arrMEDHXOculer[$key]['Filed_Label_Val']){
							$newValueOrignal .= $arrMEDHXOculer[$key]['Filed_Label_Og_Val']."&nbsp;".$valueOld[$keyInner+1]."<br>";
							unset($arrTmp[$keyOld]);
							break;
						}
					}
				}
			}
		}
		//echo $OldValueOrignal;
		//die;
		$New_Value = $newValueOrignal;
		return $Old_Value."~~~~".$New_Value;
	}

	public function print_getImmunization($pid=0,$form_dos="",$arrExlusions=array()){
		$sql = "select * from immunizations where patient_id='".$pid."'";
		if(in_array("visit_medication_immu",$arrExlusions)){
			$sql.=" AND administered_date!=".$form_dos."";
		}

		$rez =@imw_query($sql);
		$num_rows=@imw_num_rows($rez);

		if($num_rows>0){
		?>
<table style="width:750px;" cellpadding="0" cellspacing="0">
  <tr>
	<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
	<td colspan="3" height="2"></td>
  </tr>
  <tr>
    <td colspan="3" class="bluehed" style="width:750px;">IMMUNIZATIONS</td>
  </tr>
  <tr >
    <td class=" paddingTop10 tb_subheading" style="width:200px" >&nbsp;Name</td>
    <td class=" paddingTop10 tb_subheading" style="width:200px">Manufacturer Info</td>
    <td class=" paddingTop10 tb_subheading" style="width:200px">Reactions &amp; Comments</td>
  </tr>
  <?php
				$cl = 0;
				for($i=1;$i<=$num_rows;$i++) {
					$checkImmunizations="disabled";
					$row = @imw_fetch_array($rez);

					$tmpz = "administered_by_id".$i;
					$$tmpz = $row["administered_by_id"];

					$tmpz = "imnzn_id".$i;//foregin key Id From Table immunizatio_admin
					$$tmpz = $row["imnzn_id"];

					$tmpz = "immzn_dose_id".$i;
					$$tmpz = $row["immzn_dose_id"];

					$tmpz = "manufacturer".$i;
					$$tmpz = $row["manufacturer"];

					$tmpz = "immunization_id".$i;
					$$tmpz = $row["immunization_id"];

					$tmpz = "administered_date".$i;
					$$tmpz = $row["administered_date"];

					$tmpz = "immzn_note".$i;
					$$tmpz = $row["note"];

					$tmpz = "lot_number".$i;
					$$tmpz = $row["lot_number"];

					$tmpz = "imu_autoid".$i;//primary key ID
					$$tmpz = $row["id"];

					$tmpz = "immzn_type".$i;
					$$tmpz = $row["immzn_type"];

					$tmpz = "immzn_type".$i;
					$$tmpz = $row["immzn_type"];

					$tmpz = "immzn_dose".$i;
					$$tmpz = $row["immzn_dose"];

					$tmpz = "immzn_route_site".$i;
					$$tmpz = $row["immzn_route_site"];

					$tmpz = "site".$i;
					$$tmpz = $row["site"];

					$tmpz = "expiration_date".$i;
					$$tmpz = $row["expiration_date"];

					$tmpz = "consent_date".$i;
					$$tmpz = $row["consent_date"];

					$tmpz = "adverse_reaction".$i;
					$$tmpz = $row["adverse_reaction"];


					$administered_by_id="administered_by_id".$i;
					$immunization_id = "immunization_id".$i;
					$expiration_date = "expiration_date".$i;
					$administered_date = "administered_date".$i;
					$consent_date = "consent_date".$i;
					$manufacturer = "manufacturer".$i;
					$lot_number = "lot_number".$i;
					$immzn_note = "immzn_note".$i;
					$adverse_reaction = "adverse_reaction".$i;
					$immzn_route_site = "immzn_route_site".$i;
					$immznsite = "site".$i;
					$immzn_type = "immzn_type".$i;
					$immzn_dose = "immzn_dose".$i;
					$imu_autoid = "imu_autoid".$i;
					$imnzn_id  = "imnzn_id".$i;
					$immzn_dose_id  = "immzn_dose_id".$i;
			?>
  <tr >
    <td style="width:200px;" class="paddingTop10">
        <table style="width:180px;" cellpadding="0" cellspacing="0" >
        <?php if($$immunization_id) {?>
        <tr>
          <td style="width:20px;" class="text_lable">Vaccine:</td>
          <td style="width:160px;" ><?php echo $$immunization_id;?></td>
        </tr>
        <?php }?>
        <?php if($$immzn_type) {?>
        <tr>
          <td style="width:20px;" class="text_lable">Vaccine Type:</td>
          <td style="width:160px;" ><?php echo $$immzn_type;?></td>
        </tr>
        <?php }?>
        <?php if($$immzn_dose) {?>
        <tr>
          <td style="width:20px;" class="text_lable">Amount:</td>
          <td style="width:160px;"><?php echo $$immzn_dose;?></td>
        </tr>
        <?php }?>
        <?php if($$immzn_route_site){?>
        <tr>
          <td style="width:20px;" class="text_lable">Route:</td>
          <td style="width:160px;"><?php echo $$immzn_route_site;?></td>
        </tr>
        <?php }?>
        <?php if($$immznsite){?>
        <tr>
          <td style="width:20px;" class="text_lable">Site:</td>
          <td style="width:160px;"><?php echo $$immznsite;?></td>
        </tr>
        <?php }?>
      </table>
    </td>
    <td style="width:200px;" class="paddingTop10">
        <table style="width:180px;" cellpadding="0" cellspacing="0">
        <?php if($$manufacturer){?>
        <tr>
          <td style="width:20px;" class="text_lable">Name:</td>
          <td style="width:160px;"><?php echo $$manufacturer;?></td>
        </tr>
        <?php }?>
        <?php if($$lot_number) {?>
        <tr>
          <td style="width:20px;" class="text_lable">Lot#:</td>
          <td style="width:160px;"><?php echo $$lot_number;?></td>
        </tr>
        <?php }?>
        <?php if($$expiration_date!="" && $$expiration_date!="0000-00-00") {?>
        <tr>
          <td style="width:20px;" class="text_lable">Expiration Date:</td>
          <td style="width:160px;"><?php echo ($$expiration_date!="" && $$expiration_date!="0000-00-00")? get_date_format($$expiration_date):"";?></td>
        </tr>
        <?php }?>
      </table>
    </td>
    <td  style="width:200px; " class="paddingTop10">
        <table style="width:180px;" cellpadding="0" cellspacing="0" >
        <?php if($$consent_date!="" && $$consent_date!="0000-00-00"){?>
        <tr>
          <td style="width:20px;" class="text_lable">Consent Date:</td>
          <td style="width:160px;"><?php echo ($$consent_date!="" && $$consent_date!="0000-00-00")? get_date_format($$consent_date):"";?></td>
        </tr>
        <?php }?>
        <?php if($$adverse_reaction){?>
        <tr>
          <td style="width:20px;" class="text_lable">Reaction:</td>
          <td style="width:160px;"><?php echo $$adverse_reaction;?></td>
        </tr>
        <?php }?>
        <?php if($$immzn_note){?>
        <tr>
          <td style="width:20px;" class="text_lable">Comments:</td>
          <td style="width:160px;"><?php echo $$immzn_note;?></td>
        </tr>
        <?php }?>
      </table>
    </td>
  </tr>
  <?php
			}
			?>
</table>
<?php
		}else{/* ?>
<table style="width:750px;" cellpadding="0" cellspacing="0"  >
 <tr>
    <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
  </tr>
  <tr>
     <td height="2"></td>
  </tr>
 <tr>
    <td class="bluehed text_cap paddingTop10">IMMUNIZATIONS</td>
  </tr>
  <tr>
    <td>&nbsp;&nbsp;No Immunizations</td>
  </tr>
</table>
<?php */
		}
	}

	public function print_vital_signs($pt_id=0){
		$i=0;
		$ret_html="";
		if($pt_id){
			$arr_include=$arr_date_include=array();$i=0;
			$arrPain = array("","Mild","Moderate","Severe");
			for($counter = 0; $counter <= 10; $counter++){
				array_push($arrPain,"Scale ".$counter);
			}
			$vital_sign_arr=array("1"=>"B/P - S","2"=>"B/P - D","3"=>"PULSE","4"=>"RESP","5"=>"O2SAT","6"=>"TEMP","7"=>"HEIGHT","8"=>"WEIGHT","9"=>"BMI","10"=>"Pain");
			$qry_patientVS="SELECT date_format(vsm.date_vital,'".get_sql_date_format('','y')."') as v_date, vsm.comment as comments,vsm.bp_type as bp_type,vs.vital_sign_id,vs.vital_master_id as masrer_ids,vs.range_vital,vs.unit FROM vital_sign_patient as vs INNER JOIN vital_sign_master as vsm ON vs.vital_master_id=vsm.id WHERE vsm.patient_id='".$pt_id."' AND vsm.status=0 ORDER BY vsm.date_vital DESC";
			$res_patientVS=imw_query($qry_patientVS); ?>
<table style="width:750px;"  cellpadding="0" cellspacing="0">
<tr>
  <td class="bluelne" height="1"  style="width:750px;">&nbsp;</td>
</tr>
<tr>
  <td height="2"></td>
</tr>
<?php
	if(imw_num_rows($res_patientVS)>0){
?>
<tr>
  <td class="bluehed text_cap paddingTop10"  style="width:750px;">VITAL SIGN</td>
</tr>
<tr>
  <td><table style="width:700px; "  cellpadding="0" cellspacing="0">
    <tr>
      <?php
			echo '<td style="font-weight:bold;font-size:12px;width:65px; " class="paddingTop10 ">Date</td>';
			for($t=1;$t<=count($vital_sign_arr);$t++){
				$tdWidth="width:65px;";
					if($t==1 || $t==2 ||  $t==10){
						$tdWidth="width:60px;";
					}
					if($t==3 ){
						$tdWidth="width:85px;";
					}
					if($t==4){
						$tdWidth="width:90px;";
					}
					if($t==5 ||  $t==6 ){
						$tdWidth="width:40px;";
					}
					if($t==9 ){
						$tdWidth="width:95px;";
					}
					if($t==8 || $t==7){
						$tdWidth="width:45px;";
					}
				echo '<td style="font-weight:bold;font-size:12px;'.$tdWidth.'" class="paddingTop10">'.$vital_sign_arr[$t].'</td>';}
			echo "</tr><tr>";
			 while($row_patientVS=imw_fetch_assoc($res_patientVS)){
				$tdWidth="";

					$tdWidth="width:65px;";
					if($row_patientVS['vital_sign_id']==1 || $row_patientVS['vital_sign_id']==2 ||  $row_patientVS['vital_sign_id']==10){
						$tdWidth="width:60px;";
					}
					if($row_patientVS['vital_sign_id']==3 ){
						$tdWidth="width:85px;";
					}
					if($row_patientVS['vital_sign_id']==4){
							$tdWidth="width:90px;";
					}
					if($row_patientVS['vital_sign_id']==5 ||  $row_patientVS['vital_sign_id']==6 ){
						$tdWidth="width:40px;";
					}
					if($row_patientVS['vital_sign_id']==9 ){
						$tdWidth="width:95px;";
					}
					if($row_patientVS['vital_sign_id']==8 || $row_patientVS['vital_sign_id']==7){
						$tdWidth="width:45px;";
					}

				if($row_patientVS['vital_sign_id']==10){$row_patientVS['range_vital']=$arrPain[$row_patientVS['range_vital']];}
				if(!in_array($row_patientVS['masrer_ids'],$arr_include)){echo '</tr><tr>';echo '<td style="'.$tdWidth.'font-size:12px;" class="paddingTop10">'.$row_patientVS['v_date'].'</td>';}
				if($vital_sign_arr[$row_patientVS['vital_sign_id']]){$bdrtop="";
					if($row_patientVS['range_vital']==""){$bdrtop="bdrtop";}
					echo '<td style="'.$tdWidth.'font-size:12px;" class="paddingTop10 ">';
					if($row_patientVS['range_vital']){
						echo $row_patientVS['range_vital'].'&nbsp;'.$row_patientVS['unit'].'&nbsp;';
					}else{echo "<span style='font-size:10px;'>No Data</span>";}
					echo '</td>';
				}
				$i++;
				if($row_patientVS['vital_sign_id']==10 && ($row_patientVS['bp_type'])){echo '</tr><tr><td colspan="11" class="paddingTop10" ><b>BP Comments:</b>&nbsp;'.$row_patientVS['bp_type'].'</td>';}
				if($row_patientVS['vital_sign_id']==10 && ($row_patientVS['comments'])){echo '</tr><tr><td colspan="11" class="paddingTop10" ><b>BMI Comments:</b>&nbsp;'.$row_patientVS['comments'].'</td>';}
				$arr_include[]=$row_patientVS['masrer_ids'];


				}
				echo '</tr></table></td></tr>';
			}else{/* ?>

    <tr>
      <td class="paddingTop10">No Vital Sign</td>
    </tr>
    <?php	 */}
		echo "</table>";
		}
		return $ret_html;
	}

	public function lab_status($pid=0,$arrExclusion=array()){
		$arr_lab_ids=array();
		if(in_array("diagnostic_tests_pending",$arrExclusion)){
			$sql_select = "select lab_test_data_id from lab_test_data where lab_patient_id = '".$pid."'  and lab_status!='3' order by lab_test_data_id";
			$sql_result = imw_query($sql_select);
			if(imw_num_rows($sql_result)>0){
				while($row_result=imw_fetch_assoc($sql_result)){
					$lab_id=$row_result['lab_test_data_id'];
					$sql_result_lab="SELECT result from lab_observation_result WHERE lab_test_id='".$lab_id."' AND del_status=0 AND result=''";
					$res_result_lab=imw_query($sql_result_lab);
					if(imw_num_rows($res_result_lab)>0){
						$row_result_lab=imw_fetch_assoc($res_result_lab);
						$arr_lab_ids[]=	$lab_id;
					}
				}
			}
		}
		return $arr_lab_ids;
	}

	public function print_getLabResults($pid=0,$arrExclusion=array()){
		$arrLab_ids = $this->lab_status($pid,$arrExclusion);
		$qryLab="";
		if(count($arrLab_ids)>0){
			$exclude_lab_id=implode(",",$arrLab_ids);
			$qryLab=" AND lab_test_data_id NOT IN (".$exclude_lab_id.")";
		}
		$sql_select ="select *,date_format(lab_order_date,'".get_sql_date_format()."') as order_date
			from lab_test_data where  lab_patient_id = '".$pid."' and lab_status!='3' ".$qryLab." order by lab_test_data_id";
		$sql_result = imw_query($sql_select);
		if(imw_num_rows($sql_result)>0){?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0">
      <tr>
        <td colspan="3" class="bluelne" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	  </tr>
	  <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10" style="width:750px;">LAB</td>
      </tr>
      <?php $o=0;
			while($sql_array=imw_fetch_array($sql_result)){

				$Orderbynames = explode(',',$sql_array['lab_test_order_by_name']);
				$Orderbylname = strtoupper(substr(trim($Orderbynames[0]),0,1));
				$Orderbyfname = strtoupper(substr(trim($Orderbynames[1]),0,1));
				$Orderbyname = $Orderbyfname.$Orderbylname;
			?>
      <tr>
        <td class="paddingTop10 pdl5" style="width:100px; "><b>Order#:</b>&nbsp;<?php echo $sql_array['lab_test_data_id']; ?></td>
        <td class="paddingTop10" style="width:300px;"><b>Order By:</b>&nbsp;<?php echo $Orderbyname;   ?></td>
        <td class="paddingTop10" style="width:300px;"><b>Order Date/Time:&nbsp;</b>
          <?php if($sql_array['order_date']!="00-00-0000"){ echo $sql_array['order_date']." ".$sql_array['lab_order_time']." ".$sql_array['order_time_zone']; }?></td>
      </tr>
      <?php $o++;
			$qryLabObserv="SELECT service,loinc,date_format(start_date,'".get_sql_date_format().") as start_date,start_time,date_format(end_date,'".get_sql_date_format().") as end_date,end_time,clinical_info FROM lab_observation_requested WHERE lab_test_id='".$sql_array['lab_test_data_id']."' AND del_status=0";
			$resLabObserv=imw_query($qryLabObserv);
			if(imw_num_rows($resLabObserv)>0){?>
      <tr>
        <td colspan="3"><table style="width:714px;"  cellpadding="0" cellspacing="0">
            <tr>
              <td colspan="5" class="paddingTop10 tb_subheading">Observation Requested</td>
            </tr>
            <tr>
              <td style="width:140px;" class="paddingTop10  text_lable">Service</td>
              <td style="width:50px;" class="paddingTop10 text_lable">LOINC</td>
              <td style="width:210px;" class="paddingTop10 text_lable">Observation Date/Time (Start)</td>
              <td style="width:190px;" class="paddingTop10 text_lable">Observation Date/Time (End)</td>
              <td style="width:130px;" class="paddingTop10 text_lable">Clinical Info</td>
            </tr>
            <?php
				while($rowLabObser=imw_fetch_assoc($resLabObserv)){
				?>
            <tr>
              <td style="width:140px;" class="paddingTop10"><?php echo $rowLabObser['service']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabObser['loinc']; ?></td>
              <td style="width:210px;" class="paddingTop10"><?php  if(get_number($rowLabObser['start_date'])!="00000000"){ echo $rowLabObser['start_date']." ".$rowLabObser['start_time']; } ?></td>
              <td style="width:190px;" class="paddingTop10"><?php  if(get_number($rowLabObser['end_date'])!="00000000"){ echo $rowLabObser['end_date']." ".$rowLabObser['end_time']; }?></td>
              <td style="width:130px;" class="paddingTop10"><?php echo $rowLabObser['clinical_info']; ?></td>
            </tr>
            <?php
				} ?>
          </table></td>
      </tr>
      <?php
			}
			$qryLabSepice="SELECT collection_type,date_format(collection_start_date,'".get_sql_date_format()."') as collection_start_date,collection_start_time,date_format(collection_end_date,'".get_sql_date_format()."') as collection_end_date,collection_end_time,collection_condition,collection_rejection,collection_comments from lab_specimen WHERE del_status=0 AND lab_test_id ='".$sql_array['lab_test_data_id']."'";
			$resLabSepice=imw_query($qryLabSepice);
			if(imw_num_rows($resLabSepice)>0){?>
      <tr>
        <td colspan="3"><table style="width:705px;"  cellpadding="0" cellspacing="0">
            <tr>
              <td colspan="6" class="paddingTop10 tb_subheading">Specimen</td>
            </tr>
            <tr>
              <td style="width:130px;" class="paddingTop10 text_lable">Type</td>
              <td style="width:180px;" class="paddingTop10 text_lable">Collection Date/Time(Start)</td>
              <td style="width:180px;" class="paddingTop10 text_lable">Collection Date/Time(End)</td>
              <td style="width:90px;" class="paddingTop10 text_lable">Condition</td>
              <td style="width:50px;" class="paddingTop10 text_lable">Rejection</td>
              <td style="width:50px;" class="paddingTop10 text_lable">Comments</td>
            </tr>
            <?php
							while($rowLabSepice=imw_fetch_assoc($resLabSepice)){
							?>
            <tr>
              <td style="width:130px;" class="paddingTop10"><?php echo $rowLabSepice['collection_type']; ?></td>
              <td style="width:180px;" class="paddingTop10"><?php  if(get_number($rowLabSepice['collection_start_date'])!="00000000"){ echo $rowLabSepice['collection_start_date']." ".$rowLabSepice['collection_start_time']; }?></td>
              <td style="width:180px;" class="paddingTop10"><?php if(get_number($rowLabSepice['collection_end_date'])!="00000000"){ echo $rowLabSepice['collection_end_date']." ".$rowLabObser['collection_end_time']; } ?></td>
              <td style="width:90px;" class="paddingTop10"><?php echo $rowLabSepice['collection_condition']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabSepice['collection_rejection']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabSepice['collection_comments']; ?></td>
            </tr>
            <?php } ?>
          </table></td>
      </tr>
      <?php
			}else{ /*?>
      <tr>
        <td  colspan="3" class="paddingTop10 tb_subheading">Specimen</td>
      </tr>
      <tr>
        <td colspan="3" >No Data</td>
      </tr>
      <?php */
			}
			$qryLabobRes="SELECT observation,result_loinc,result,uom,result_range,status,abnormal_flag,date_format(result_date,'".get_sql_date_format()."') as result_date,result_time,result_comments from lab_observation_result WHERE del_status=0 AND lab_test_id ='".$sql_array['lab_test_data_id']."'";
			$resLabobRes=imw_query($qryLabobRes);
			if(imw_num_rows($resLabobRes)>0){?>
      <tr>
        <td colspan="3"><table style="width:714px;"  cellpadding="0" cellspacing="0">
            <tr>
              <td colspan="9" class="paddingTop10 tb_subheading">Observation Result</td>
            </tr>
            <tr>
              <td style="width:100px;" class="paddingTop10 text_lable">Observation</td>
              <td style="width:50px;" class="paddingTop10 text_lable">LOINC</td>
              <td style="width:50px;" class="paddingTop10 text_lable">Result</td>
              <td style="width:50px;" class="paddingTop10 text_lable">UOM</td>
              <td style="width:50px;" class="paddingTop10 text_lable">Range</td>
              <td style="width:100px;" class="paddingTop10 text_lable">Abnormal Flag</td>
              <td style="width:60px;" class="paddingTop10 text_lable">Status</td>
              <td style="width:150px;" class="paddingTop10 text_lable">Result Date/Time</td>
              <td style="width:80px;" class="paddingTop10 text_lable">Comments</td>
            </tr>
            <?php
				while($rowLabobRes=imw_fetch_assoc($resLabobRes)){
				?>
            <tr>
              <td style="width:100px;" class="paddingTop10"><?php echo $rowLabobRes['observation']; ?></td>
              <td style="width:50px; text-align:center" class="paddingTop10 "><?php echo $rowLabobRes['result_loinc']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabobRes['result']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabobRes['uom']; ?></td>
              <td style="width:50px;" class="paddingTop10"><?php echo $rowLabobRes['result_range']; ?></td>
              <td style="width:100px;" class="paddingTop10"><?php echo $rowLabobRes['abnormal_flag']; ?></td>
              <td style="width:60px;" class="paddingTop10"><?php echo $rowLabobRes['status']; ?></td>
              <td style="width:150px;" class="paddingTop10"><?php if(get_number($rowLabobRes['result_date'])!="00000000"){ echo $rowLabobRes['result_date']." ".$rowLabobRes['result_time']; }?></td>
              <td style="width:80px;" class="paddingTop10"><?php echo $rowLabobRes['result_comments']; ?></td>
            </tr>
            <?php
				} ?>
          </table></td>
      </tr>
      <?php
			}else{ /* ?>
      <tr>
        <td  colspan="3" class="paddingTop10 tb_subheading">Observation Result</td>
      </tr>
      <tr>
        <td colspan="3" >No Data</td>
      </tr>
      <?php */
			}
		 }
		?>
    </table>
    <?php
		}else if($qryLab==""){ /* ?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0">
	<tr>
        <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td height="2"></td>
	  </tr>
	 <tr>
        <td class="bluehed text_cap paddingTop10">LAB</td>
      </tr>
      <tr>
        <td class="paddingTop10">No Data</td>
      </tr>
    </table>
    <?php */
		}
	}

	public function SingleTdData($data,$flgret="0"){
		$ret = '<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10" style="width:750px;" >'.$data.'</td>
					</tr>
			</table>';

		if($flgret==1){return $ret;}else{print($ret);}
	}

	public function print_getCCHx($pid=0,$fid=0){
		$qry1 = imw_query("select reason, ccompliant, date_of_service, dominant, eyeColor, neuroPsych, date_format(date_of_service,'".get_sql_date_format()."') as dateOfService,
							painCc
							from  chart_left_cc_history
							where patient_id = '".$pid."' and form_id = '".$fid."'");
		$crow = imw_fetch_array($qry1);
		$date_of_service = $crow["dateOfService"];

		// CC History//
		$placeholders = array('>o','<o','<1', '<2', '<3', '<4','<5', '<6', '<7', '<8','<9','<0');
		$repLacevals = array('&gt;o','&lt;o','&lt;1', '&lt;2', '&lt;3', '&lt;4','&lt;5', '&lt;6', '&lt;7', '&lt;8','&lt;9','&lt;0');
		if($crow["reason"]!=""||$crow["ccompliant"]!=""){
			$tmp="";
			$tmpCC="";
			$crow["ccompliant"] = checkHPIFormatChars($crow["ccompliant"], "de");
			$crow["ccompliant"]=nl2br(htmlentities(trim($crow["ccompliant"]))); //user can add special characters in medical hx.
			$crow["reason"] = htmlentities(trim($crow["reason"])); //user can add special characters in medical hx.
			$crow["ccompliant"] = checkHPIFormatChars($crow["ccompliant"], "pr");

			if(!empty($crow["ccompliant"])) $tmp =$crow["ccompliant"];
			if(!empty($crow["reason"])) {
				$tmpCC =$crow["reason"];
			}

			$data=$tmp;
			$data = str_ireplace($placeholders, $repLacevals,$data);
			$dataHistory=$tmpCC;
			$dataHistory = str_ireplace($placeholders, $repLacevals,$dataHistory);

			//$data= nl2br($dataCCHistory);
			$ccTitleName="Chief Complaint";
			$historyTitleName="History";
			?>
    <table style="width:750px;" cellpadding="0" cellspacing="0">
		<tr>
			<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
		</tr>
		<tr>
			<td height="2"></td>
		</tr>
		<?php
		if(!empty($data))
		{
		?>
		<tr>
			<td class="bluehed text_cap" ><b><?php echo strtoupper($ccTitleName);?></b></td>
		</tr>
		<tr>
			<td class="rowHeight paddingBotm5"><?php echo addslashes($data);?></td>
		</tr>
		<?php
		}
		if(!empty($dataHistory))
		{
		?>
		<tr>
			<td class="bluehed text_cap paddingTop10"><b><?php echo strtoupper($historyTitleName);?></b></td>
		</tr>
		<tr>
			<td class="rowHeight paddingBotm5"><?php echo addslashes($dataHistory);?></td>
		</tr>
      <?php
		}	
		//TECH & COTECH
			if(!empty($str))
			{
				?>
      <tr>
        <td style="width:750px;"><?php echo $str;?></td>
      </tr>
      <?php
			}
				?>
    </table>
    <div style="clear:both;"></div>
    <?php

		}

		$str="";
		if(!empty($crow["neuroPsych"])){
			$str.="<b>Neuro/Psych:&nbsp;</b>".$crow["neuroPsych"]."";
		}
		if(!empty($crow["dominant"])){
			$str.="&nbsp;&nbsp;<b>Dominant:&nbsp;</b>".$crow["dominant"]."&nbsp;&nbsp;&nbsp;&nbsp;";
		}

		if(!empty($crow["eyeColor"])){
			$str.="<b>Color:&nbsp;</b>".$crow["eyeColor"]."&nbsp;&nbsp;&nbsp;&nbsp;";
		}
		if(!empty($crow["painCc"])){
			$str.="<b>Pain:&nbsp;</b>".$crow["painCc"];
		}
		$advanceDirective = $this->get_advanced_directive($pid);
		if($advanceDirective!="No" && $advanceDirective!=""){
				$str.="&nbsp;<b>Advance Directive:&nbsp;</b>".$advanceDirective;
		}
		$prosthesis_arr = $this->get_prosthesis($pid,$fid);
		if(count($prosthesis_arr)>0){
			$label_pros=$prosthesis_arr['label'];
			$prosthesis=$prosthesis_arr['value'];
			if($label_pros || $prosthesis){
				$str.="&nbsp;&nbsp;&nbsp;<b>".$label_pros.":</b>&nbsp;".$prosthesis;
			}
		}
		if(!empty($str)){
			$this->SingleTdData($str);
		}
	}

	public function print_objective_notes($form_id){
		$objective_table="";
		if($form_id){
			$qry_chart_obj="SELECT obj_notes from chart_objective_notes WHERE obj_form_id='".$form_id."' and obj_notes!=''";
			$res_chart_obj=imw_query($qry_chart_obj);
			if(imw_num_rows($res_chart_obj)>0){
				$row_chart_obj=imw_fetch_assoc($res_chart_obj);
				$objective_notes_val=$row_chart_obj['obj_notes'];
				$placeholders = array('>o','<o','<1', '<2', '<3', '<4','<5', '<6', '<7', '<8','<9','<0');
				$replace_vals = array('&gt;o','&lt;o','&lt;1','&lt;2','&lt;3','&lt;4','&lt;5', '&lt;6', '&lt;7', '&lt;8','&lt;9','&lt;0');
				$objective_notes=str_replace($placeholders,$replace_vals,$objective_notes_val);
				$objective_notes=nl2br(htmlentities($objective_notes));
				$objective_table='<table style="width:750px;"  cellpadding="0" cellspacing="0">
									<tr><td class="bluelne" height="1" style="width:750px;">&nbsp;</td></tr>
									<tr><td height="2"></td></tr>
									<tr><td class="bluehed text_cap paddingTop10">Objective Notes</td></tr>
									<tr><td style="width:730px;padding-left:4px;" class="">'.$objective_notes.'</td></tr>
								  </table>';
			}
		}
		return $objective_table;
	}

	public function get_advanced_directive($pid){
		$returnDirective="";
		if($pid){
			$qryGetAdo="Select ado_option from patient_data where id='".$pid."'";
			$resGetAdo=imw_query($qryGetAdo);
			$rowGetAdo=imw_fetch_assoc($resGetAdo);
			$returnDirective=$rowGetAdo['ado_option'];

		}
		return $returnDirective;
	}

	public function print_getAmendments($pid=0){
		$amendQry = "select amend_body, amend_date, dos from amendments WHERE patient_id='".$pid."' order by amend_date desc";
		$fetch_amend = imw_query($amendQry);
		$total_amend = imw_num_rows($fetch_amend);
		if ($total_amend > 0) { ?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0">
      <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	  </tr>
	   <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10">Previous amendment notes:&nbsp;</td>
      </tr>
      <tr>
        <td class="text_lable paddingTop10" style="width:537px;" >Previous notes</td>
        <td class="text_lable paddingTop10" style="width:100px;">Date</td>
        <td class="text_lable paddingTop10" style="width:100px;">DOS</td>
      </tr>
      <?php
		while ($rowAmend = imw_fetch_array($fetch_amend)) {
		?>
      <tr>
        <td style="width:537px;" class="paddingTop10"><?php echo $rowAmend['amend_body']; ?></td>
        <td style="width:100px;" class="paddingTop10"><?php $datestring = $rowAmend['amend_date']; $d=explode("-",$datestring); echo $d[1]."-".$d[2]."-".$d[0];?></td>
        <td style="width:100px;" class="paddingTop10"><?php echo $rowAmend['dos']; ?></td>
      </tr>
      <?php } ?>
    </table>
    <?php }
	}

	public function get_time_difference( $start, $end ){
		$uts['start']      =    strtotime( $start );
		$uts['end']        =    strtotime( $end );
		if( $uts['start']!==-1 && $uts['end']!==-1 ){
			if( $uts['end'] >= $uts['start'] ){
				$diff    =    $uts['end'] - $uts['start'];
				if( $days=intval((floor($diff/86400))) )
					$diff = $diff % 86400;
				if( $hours=intval((floor($diff/3600))) )
					$diff = $diff % 3600;
				if( $minutes=intval((floor($diff/60))) )
					$diff = $diff % 60;
				$diff    =    intval( $diff );
				return( array('days'=>$days, 'hours'=>$hours, 'minutes'=>$minutes, 'seconds'=>$diff) );
			}
			else{
				trigger_error( "Ending date/time is earlier than the start date/time", E_USER_WARNING );
			}
		}
		else{
			trigger_error( "Invalid date/time data detected", E_USER_WARNING );
		}
		return( false );
	}

	public function FormatDate_insert($dt=""){
		if(!empty($dt))
		{
			if(preg_match("/([0-9]{1,2})-([0-9]{1,2})-([0-9]{4})/",$dt,$regs))
			{
				$dt=$regs[3]."-".$regs[1]."-".$regs[2];
			}else if(preg_match("/([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})/",$dt,$regs)){
				$dt=$regs[1]."-".$regs[2]."-".$regs[3];
			}
		}

		return $dt;
	}

	public function print_getMR($pid,$fid){
		global $arrTempProc;
		if(empty($pid)||empty($fid)) return "";
		$ret_str_main="";
		//Mr ---
		if(!isset($arrTempProc)||in_array("MR 1",$arrTempProc) ||in_array("MR 2",$arrTempProc) ||in_array("MR 3",$arrTempProc)){

			//MR/PC
			$sql = "SELECT
			c1.*,
			c2.sph as sph_r, c2.cyl as cyl_r, c2.axs as axs_r, c2.ad as ad_r, c2.prsm_p as prsm_p_r, c2.prism as prism_r, c2.slash as slash_r, c2.sel_1 as sel_1_r, c2.sel_2 as sel_2_r,
			c2.txt_1 as txt_1_r, c2.txt_2 as txt_2_r, c2.sel2v as sel2v_r,

			c3.sph as sph_l, c3.cyl as cyl_l, c3.axs as axs_l, c3.ad as ad_l, c3.prsm_p as prsm_p_l, c3.prism as prism_l, c3.slash as slash_l, c3.sel_1 as sel_1_l, c3.sel_2 as sel_2_l,
			c3.txt_1 as txt_1_l, c3.txt_2 as txt_2_l, c3.sel2v as sel2v_l,

			c4.status_elements
			FROM chart_vis_master c4
			LEFT JOIN chart_pc_mr c1 ON c1.id_chart_vis_master = c4.id
			LEFT JOIN chart_pc_mr_values c2 ON c1.id = c2.chart_pc_mr_id AND c2.site='OD'
			LEFT JOIN chart_pc_mr_values c3 ON c1.id = c3.chart_pc_mr_id AND c3.site='OS'
			WHERE c4.form_id='".$fid."' AND c4.patient_id = '".$pid."' AND c1.ex_type='MR' AND c1.delete_by='0'
			Order By ex_number;
			";

			$rez = sqlStatement($sql);
			for($i=0; $row= sqlFetchArray($rez); $i++){

			$ret_str="";
			$ex_num = $row["ex_number"];

			$indx1=$indx2="";
			if($ex_num>1){
				$indx1="Other";
				if($ex_num>2){
					$indx2="_".$ex_num;
				}
			}

			$statusElements = $row["status_elements"];

			//val --
			$mr3gp4_GL_PHos=array();
			$mr3gp3_prismos=array();
			$mr3gp2_addos=array();
			$mr3gp1_os=array();
			$mr3gp4_GL_PHod=array();
			$mr3gp3_prismod=array();
			$mr3gp2_addod=array();
			$mr3gp1_od=array();

			//$mrPrism3=$row[""];
			$rd_vis_mr_none_given=(strpos($statusElements, "elem_mrNoneGiven".$ex_num."=1")!== false)?$row["mr_none_given"] : "" ;
			$providerIdOther_3=$row["provider_id"];
			$vis_mr_desc_3COMMENTS=$row["ex_desc"];
			$vis_mr_prism3COMMENTS=$row["prism_desc"];

			$visMrOtherOdS_3=(strpos($statusElements, "elem_visMr".$indx1."OdS".$indx2."=1") !== false)?$row["sph_r"] : "" ;
			$visMrOtherOdC_3=(strpos($statusElements, "elem_visMr".$indx1."OdC".$indx2."=1") !== false)?$row["cyl_r"] : "" ;
			$visMrOtherOdA_3=(strpos($statusElements, "elem_visMr".$indx1."OdA".$indx2."=1") !== false)?$row["axs_r"] : "" ;
			$visMrOtherOdAdd_3=(strpos($statusElements, "elem_visMr".$indx1."OdAdd".$indx2."=1") !== false)?$row["ad_r"] : "" ;
			$visMrOtherOdTxt1_3=(strpos($statusElements, "elem_visMr".$indx1."OdTxt1".$indx2."=1") !== false)?$row["txt_1_r"] : "" ;
			$visMrOtherOdTxt2_3=(strpos($statusElements, "elem_visMr".$indx1."OdTxt2".$indx2."=1") !== false)?$row["txt_2_r"] : "" ;



			$visMrOtherOdP_3=((strpos($statusElements, "elem_visMr".$indx1."OdP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdSel1".$indx2."=1") !== false)
							|| (strpos($statusElements, "elem_visMr".$indx1."OdSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdPrism".$indx2."=1") !== false)
							|| (strpos($statusElements, "elem_visMr".$indx1."OdTxt1".$indx2."=1") !== false)
							)?$row["prsm_p_r"] : "" ;
			$visMrOtherOdPrism_3=((strpos($statusElements, "elem_visMr".$indx1."OdP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OdSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdPrism".$indx2."=1") !== false)
								)?$row["prism_r"] : "" ;
			$visMrOtherOdSlash_3=((strpos($statusElements, "elem_visMr".$indx1."OdP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OdSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdPrism".$indx2."=1") !== false)
								)?$row["slash_r"] : "" ;
			$visMrOtherOdSel1_3=((strpos($statusElements, "elem_visMr".$indx1."OdP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OdSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OdPrism".$indx2."=1") !== false)
								)?$row["sel_1_r"] : "" ;
			$visMrOtherOdSel2_3=(strpos($statusElements, "elem_visMr".$indx1."OdSel2".$indx2."=1") !== false)?$row["sel_2_r"] : "" ;
			$visMrOtherOdSel2Vision_3=(strpos($statusElements, "elem_visMr".$indx1."OdSel2Vision".$indx2."=1") !== false)?$row["sel2v_r"] : "" ;

			$visMrOtherOsS_3=(strpos($statusElements, "elem_visMr".$indx1."OsS".$indx2."=1") !== false)?$row["sph_l"] : "" ;
			$visMrOtherOsC_3=(strpos($statusElements, "elem_visMr".$indx1."OsC".$indx2."=1") !== false)?$row["cyl_l"] : "" ;
			$visMrOtherOsA_3=(strpos($statusElements, "elem_visMr".$indx1."OsA".$indx2."=1") !== false)?$row["axs_l"] : "" ;

			$visMrOtherOsAdd_3=(strpos($statusElements, "elem_visMr".$indx1."OsAdd".$indx2."=1") !== false)?$row["ad_l"] : "" ;
			$visMrOtherOsTxt1_3=(strpos($statusElements, "elem_visMr".$indx1."OsTxt1".$indx2."=1") !== false)?$row["txt_1_l"] : "" ;
			$visMrOtherOsTxt2_3=(strpos($statusElements, "elem_visMr".$indx1."OsTxt2".$indx2."=1") !== false)?$row["txt_2_l"] : "" ;

			$visMrOtherOsP_3=((strpos($statusElements, "elem_visMr".$indx1."OsP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OsSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsPrism".$indx2."=1") !== false)
							)?$row["prsm_p_l"] : "" ;
			$visMrOtherOsPrism_3=((strpos($statusElements, "elem_visMr".$indx1."OsP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OsSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsPrism".$indx2."=1") !== false)
							)?$row["prism_l"] : "" ;
			$visMrOtherOsSlash_3=((strpos($statusElements, "elem_visMr".$indx1."OsP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OsSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsPrism".$indx2."=1") !== false)
							)?$row["slash_l"] : "" ;
			$visMrOtherOsSel1_3=((strpos($statusElements, "elem_visMr".$indx1."OsP".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsSel1".$indx2."=1") !== false)
								|| (strpos($statusElements, "elem_visMr".$indx1."OsSlash".$indx2."=1") !== false) || (strpos($statusElements, "elem_visMr".$indx1."OsPrism".$indx2."=1") !== false)
								)?$row["sel_1_l"] : "" ;
			$visMrOtherOsSel2_3=(strpos($statusElements, "elem_visMr".$indx1."OsSel2".$indx2."=1") !== false)?$row["sel_2_l"] : $visMrOtherOdSel2_3;
			$visMrOtherOsSel2Vision_3=(strpos($statusElements, "elem_visMr".$indx1."OsSel2Vision".$indx2."=1") !== false)?$row["sel2v_l"] : "" ;
			$elem_mr_type3 = (strpos($statusElements, "elem_mr_type".$ex_num."=1") !== false && !empty($row["vis_mr_type1"])) ?$row["mr_type"] : "" ;
			if(!empty($elem_mr_type3)){ $elem_mr_type3 = "(".ucfirst($elem_mr_type3).")"; }
			//val --

			$src_pic_vision_pc = $GLOBALS['fileroot']."/library/images/pic_vision_pc.jpg";

			//if($show_mrList3==true){
				//Start MR3
				if(($visMrOtherOdS_3 || $visMrOtherOdC_3 || $visMrOtherOdA_3 || $visMrOtherOdAdd_3)
				||
				($visMrOtherOdTxt1_3 && $visMrOtherOdTxt1_3!='20/')
				||
				($visMrOtherOsS_3 || $visMrOtherOsC_3 || $visMrOtherOsA_3 || $visMrOtherOsAdd_3)
				||
				($visMrOtherOsTxt1_3 && $visMrOtherOsTxt1_3!='20/')
				|| ($mrPrism3 == 1)
				){
				$MR3rd = true;

				$ret_str.="<tr><td style='width:740px;'>
							<table style='width:740px;' cellpadding='0' cellspacing='0'>";
				$ret_str.="	<tr>";

						$givenMr = ($rd_vis_mr_none_given=="MR ".$ex_num) ? "(Given)" : "";

				$ret_str.="		<td colspan=\"4\" class=\"tb_subheading paddingTop10\" >MR".$ex_num." by ".$givenMr.$this->showDoctorName($providerIdOther_3)."  ".$elem_mr_type3."</td>";
				$ret_str.="	</tr>";
				$ret_str.="	";
				$ret_str.="		";
				$ret_str.="		";
				$ret_str.="		";

							if(
							($mrPrism3 == 1)
							&&
							($visMrOtherOdP_3 || $visMrOtherOdPrism_3 || $visMrOtherOdSlash_3 || $visMrOtherOdSel1_3)
							||
							($visMrOtherOsP_3 || $visMrOtherOsPrism_3 || $visMrOtherOsSlash_3 || $visMrOtherOsSel1_3)
							){
							$ret_str.=""; }
				$ret_str.="	";
				$ret_str.="	"; //<!-- GL/PH -->
				$ret_str.="	 ";
				$ret_str.="	<tr>";

						$mr3gp1_od[]="";
						$mr3gp1_os[]="";
						$mr3gp2_addod[]="";
						$mr3gp2_addos[]="";
						$mr3gp3_prismod[]="";
						$mr3gp3_prismos[]="";
						$mr3gp4_GL_PHod[]="";
						$mr3gp4_GL_PHos[]="";
						if($visMrOtherOdS_3)
						{
							$mr3gp1_od[] = "S";
							$mr3gp1_od[] = "$visMrOtherOdS_3";
						}
						if($visMrOtherOdC_3)
						{
							$mr3gp1_od[] = "C";
							$mr3gp1_od[] = "$visMrOtherOdC_3";
						}
						if($visMrOtherOdA_3)
						{
							$mr3gp1_od[] = "A";
							$mr3gp1_od[] = "$visMrOtherOdA_3";
						}
						if($visMrOtherOdTxt1_3 && $visMrOtherOdTxt1_3!='20/')
						{
							$mr3gp1_od[] = "$visMrOtherOdTxt1_3";
						}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->odLable(1).implode("&nbsp;",$mr3gp1_od)."</td>";

						if($visMrOtherOdAdd_3!="" && ($visMrOtherOdS_3!="" || $visMrOtherOdC_3!="" || $visMrOtherOdA_3!=""))
						{
							$mr3gp2_addod[] = "Add";
							$mr3gp2_addod[] = "$visMrOtherOdAdd_3";
						}
						if($visMrOtherOdTxt2_3 != '' && $visMrOtherOdTxt2_3 != '20/')
						{
							$mr3gp2_addod[] = "$visMrOtherOdTxt2_3";
						}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr3gp2_addod)."</td>";

						if(
						($mrPrism3 == 1)
						&&
						($visMrOtherOdP_3 || $visMrOtherOdPrism_3 || $visMrOtherOdSlash_3 || $visMrOtherOdSel1_3)
						||
						($visMrOtherOsP_3 || $visMrOtherOsPrism_3 || $visMrOtherOsSlash_3 || $visMrOtherOsSel1_3)
						){
							$MR3rdPrism = true;
							$mr3gp3_prismod[] = "";
							if($visMrOtherOdP_3)
							{
								$mr3gp3_prismod[] = "P";
								$mr3gp3_prismod[] = "$visMrOtherOdP_3";
								$mr3gp3_prismod[] = "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>";
							}
							if($visMrOtherOdSel1_3)
							{
								$mr3gp3_prismod[] = "$visMrOtherOdSel1_3";
							}
							if($visMrOtherOdSlash_3)
							{
								$mr3gp3_prismod[] = "/";
								$mr3gp3_prismod[] = "$visMrOtherOdSlash_3";
							}
							if($visMrOtherOdPrism_3)
							{
								$mr3gp3_prismod[] = "$visMrOtherOdPrism_3";
							}

						}
					$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$mr3gp3_prismod)."</td>";

						$mr3gp4_GL_PHod[]="";//"OD";
						if($visMrOtherOdSel2_3 != '')
						{
							//$mr3gp4_GL_PHod[] = "GL/PH";
							$mr3gp4_GL_PHod[] = "$visMrOtherOdSel2_3";
						}
						if($visMrOtherOdSel2Vision_3 != '' && $visMrOtherOdSel2Vision_3 != '20/')
						{
							$mr3gp4_GL_PHod[] = "Vision";
							$mr3gp4_GL_PHod[] = "$visMrOtherOdSel2Vision_3";
						}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr3gp4_GL_PHod)."</td>";
					$ret_str.="</tr>";
					$ret_str.="<tr>";

						if($visMrOtherOsS_3)
						{
							$mr3gp1_os[]="S";
							$mr3gp1_os[]="$visMrOtherOsS_3";
						}
						if($visMrOtherOsC_3)
						{
							$mr3gp1_os[]="C";
							$mr3gp1_os[]="$visMrOtherOsC_3";
						}
						if($visMrOtherOsA_3)
						{
							$mr3gp1_os[]="A";
							$mr3gp1_os[]="$visMrOtherOsA_3";
						}
						if($visMrOtherOsTxt1_3 && $visMrOtherOsTxt1_3!='20/')
						{
							$mr3gp1_os[]="$visMrOtherOsTxt1_3";
						}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->osLable(1). implode("&nbsp;",$mr3gp1_os)."</td>";

							if($visMrOtherOsAdd_3!="" && ($visMrOtherOsS_3!="" || $visMrOtherOsC_3!="" || $visMrOtherOsA_3!=""))
							{
								$mr3gp2_addos[]="Add";
								$mr3gp2_addos[]="$visMrOtherOsAdd_3";
							}
							if($visMrOtherOsTxt2_3 && $visMrOtherOsTxt2_3!='20/')
							{
								$mr3gp2_addos[]="$visMrOtherOsTxt2_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr3gp2_addos)."</td>";

							$mr3gp3_prismos[]="";
							if($visMrOtherOsP_3)
							{
								$mr3gp3_prismos[]="P";
								$mr3gp3_prismos[]="$visMrOtherOsP_3";
								$mr3gp3_prismos[]="<img src=\"$src_pic_vision_pc\"  align=\"top\"/>";
							}

							if($visMrOtherOsSel1_3)
							{
								$mr3gp3_prismos[]="$visMrOtherOsSel1_3";
							}
							if($visMrOtherOsSlash_3)
							{
								$mr3gp3_prismos[]="/";
								$mr3gp3_prismos[]="$visMrOtherOsSlash_3";
							}
							if($visMrOtherOsPrism_3)
							{
								$mr3gp3_prismos[]="$visMrOtherOsPrism_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$mr3gp3_prismos)."</td>";

							$mr3gp4_GL_PHos[] = "";
							if($visMrOtherOsSel2_3)
							{
								//$mr3gp4_GL_PHos[] = "GL/PH";
								$mr3gp4_GL_PHos[] = "$visMrOtherOsSel2_3";
							}
							if($visMrOtherOsSel2Vision_3 && $visMrOtherOsSel2Vision_3!='20/')
							{
								$mr3gp4_GL_PHos[] = "Vision";
								$mr3gp4_GL_PHos[] = "$visMrOtherOsSel2Vision_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr3gp4_GL_PHos)."</td>";
					$ret_str.="</tr>";
				$ret_str.="</table></td></tr>";

				}//End MR3



			if($vis_mr_desc_3COMMENTS!="Desc." && $vis_mr_desc_3COMMENTS!="" ||($vis_mr_prism3COMMENTS)){

			//    <!-- Description -->
			$ret_str.="<tr><td style='width:740px;'> <table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="	<tr>";
			if($vis_mr_desc_3COMMENTS!="Desc." && $vis_mr_desc_3COMMENTS!=""){
				$ret_str.="	    <td style=\"width:340px;\" class=\"paddingTop10\">MR ".$ex_num."-Comments:&nbsp;".htmlentities($vis_mr_desc_3COMMENTS)."</td>";
			}
			if(trim($vis_mr_prism3COMMENTS)){
				$ret_str.="<td style='width:400px;' class=\"paddingTop10\">Prism Comments: ".htmlentities($vis_mr_prism3COMMENTS)."</td>";
			}
			$ret_str.="	</tr>";
			$ret_str.="  </table></td></tr>  ";
				//<!-- Description -->

			}
			//}//END OF MR3
			if(!empty($ret_str)){ $ret_str_main=$ret_str_main."".$ret_str; }
			}//end
		} // end MR3
		//Mr ---

		return $ret_str_main;
	}

	public function print_getPC($pid,$fid){

		global $arrTempProc;
		if(empty($pid)||empty($fid)) return "";

		$ret_str_main="";

		if(!isset($arrTempProc)||in_array("PC 3",$arrTempProc) ||in_array("PC 2",$arrTempProc) ||in_array("PC 1",$arrTempProc)){

		//MR/PC
		$sql = "SELECT
			c1.*,
			c2.sph as sph_r, c2.cyl as cyl_r, c2.axs as axs_r, c2.ad as ad_r, c2.prsm_p as prsm_p_r, c2.prism as prism_r, c2.slash as slash_r, c2.sel_1 as sel_1_r, c2.sel_2 as sel_2_r,
			c2.txt_1 as txt_1_r, c2.txt_2 as txt_2_r, c2.sel2v as sel2v_r,
			c2.ovr_s as ovr_s_r, c2.ovr_c as ovr_c_r, c2.ovr_v as ovr_v_r, c2.ovr_a as ovr_a_r,
			c3.sph as sph_l, c3.cyl as cyl_l, c3.axs as axs_l, c3.ad as ad_l, c3.prsm_p as prsm_p_l, c3.prism as prism_l, c3.slash as slash_l, c3.sel_1 as sel_1_l, c3.sel_2 as sel_2_l,
			c3.txt_1 as txt_1_l, c3.txt_2 as txt_2_l, c3.sel2v as sel2v_l,
			c3.ovr_s as ovr_s_l, c3.ovr_c as ovr_c_l, c3.ovr_v as ovr_v_l, c3.ovr_a as ovr_a_l,
			c4.status_elements as vis_statusElements
			FROM chart_vis_master c4
			LEFT JOIN chart_pc_mr c1 ON c1.id_chart_vis_master = c4.id
			LEFT JOIN chart_pc_mr_values c2 ON c1.id = c2.chart_pc_mr_id AND c2.site='OD'
			LEFT JOIN chart_pc_mr_values c3 ON c1.id = c3.chart_pc_mr_id AND c3.site='OS'
			WHERE c4.form_id='".$fid."' AND c4.patient_id = '".$pid."' AND c1.ex_type='PC' AND c1.delete_by='0'
			Order By ex_number;
			";
		$rez = sqlStatement($sql);
		for($i=0; $row= sqlFetchArray($rez); $i++){
			$ret_str="";
			$ex_num = $row["ex_number"];
			if($ex_num == "1"){ $ex_num = ""; }

			//Pc---
			$statusElements = $row["vis_statusElements"];
			$chk_pc_near_3 = $row["pc_near"];

			$sel_vis_pc_od_sel_1_3 = (strpos($statusElements, "elem_visPcOdSel1".$ex_num."=1") !== false)?$row["sel_1_r"]:"";
			$txt_vis_pc_od_s_3 = (strpos($statusElements, "elem_visPcOdS".$ex_num."=1") !== false)?$row["sph_r"]:"";
			$txt_vis_pc_od_c_3 = (strpos($statusElements, "elem_visPcOdC".$ex_num."=1") !== false)?$row["cyl_r"]:"";
			$txt_vis_pc_od_a_3 =(strpos($statusElements, "elem_visPcOdA".$ex_num."=1") !== false)?$row["axs_r"]:"";

			$sel_vis_pc_od_p_3 =(strpos($statusElements, "elem_visPcOsP".$ex_num."=1") !== false)? $row["prsm_p_r"]:"";
			$sel_vis_pc_od_prism_3 =(strpos($statusElements, "elem_visPcOdPrism".$ex_num."=1") !== false)? $row["prism_r"]:"";
			$sel_vis_pc_od_slash_3 = (strpos($statusElements, "elem_visPcOdSlash".$ex_num."=1") !== false)?$row["slash_r"]:"";
			$sel_vis_pc_od_sel_2_3 = (strpos($statusElements, "elem_visPcOdSel2".$ex_num."=1") !== false)?$row["sel_2_r"]:"";

			$sel_vis_pc_os_sel_1_3 = (strpos($statusElements, "elem_visPcOsSel1".$ex_num."=1") !== false)?$row["sel_1_l"]:"";
			$txt_vis_pc_os_s_3 = (strpos($statusElements, "elem_visPcOsS".$ex_num."=1") !== false)?$row["sph_l"]:"";
			$txt_vis_pc_os_c_3 =(strpos($statusElements, "elem_visPcOsC".$ex_num."=1") !== false)? $row["cyl_l"]:"";
			$txt_vis_pc_os_a_3 = (strpos($statusElements, "elem_visPcOsA".$ex_num."=1") !== false)?$row["axs_l"]:"";
			$sel_vis_pc_os_p_3 = (strpos($statusElements, "elem_visPcOsP".$ex_num."=1") !== false)?$row["prsm_p_l"]:"";
			$sel_vis_pc_os_prism_3 = (strpos($statusElements, "elem_visPcOsPrism".$ex_num."=1") !== false)?$row["prism_l"]:"";
			$sel_vis_pc_os_slash_3 = (strpos($statusElements, "elem_visPcOsSlash".$ex_num."=1") !== false)?$row["slash_l"]:"";
			$sel_vis_pc_os_sel_2_3 =(strpos($statusElements, "elem_visPcOsSel2".$ex_num."=1") !== false)? $row["sel_2_l"]:"";

			$txt_vis_pc_od_near_txt_3 = $row["txt_1_r"];
			$txt_vis_pc_os_near_txt_3 = $row["txt_1_l"];

			$txt_vis_pc_od_overref_s_3 = (strpos($statusElements, "elem_visPcOdOverrefS".$ex_num."=1") !== false)?$row["ovr_s_r"]:"";
			$txt_vis_pc_od_overref_c_3 = (strpos($statusElements, "elem_visPcOdOverrefC".$ex_num."=1") !== false)?$row["ovr_c_r"]:"";
			$txt_vis_pc_od_overref_a_3 = (strpos($statusElements, "elem_visPcOdOverrefA".$ex_num."=1") !== false)?$row["ovr_a_r"]:"";
			$txt_vis_pc_od_overref_v_3 = (strpos($statusElements, "elem_visPcOdOverrefV".$ex_num."=1") !== false)?$row["ovr_v_r"]:"";
			$txt_vis_pc_os_overref_s_3 = (strpos($statusElements, "elem_visPcOsOverrefS".$ex_num."=1") !== false)?$row["ovr_s_l"]:"";
			$txt_vis_pc_os_overref_c_3 = (strpos($statusElements, "elem_visPcOsOverrefC".$ex_num."=1") !== false)?$row["ovr_c_l"]:"";
			$txt_vis_pc_os_overref_a_3 = (strpos($statusElements, "elem_visPcOsOverrefA".$ex_num."=1") !== false)?$row["ovr_a_l"]:"";
			$txt_vis_pc_os_overref_v_3 = (strpos($statusElements, "elem_visPcOsOverrefV".$ex_num."=1") !== false)?$row["ovr_v_l"]:"";

			$txt_vis_pc_desc3=$row["ex_desc"];//
			$txt_vis_pc_od_add_3 = (strpos($statusElements, "elem_visPcOdAdd".$ex_num."=1") !== false)?$row["ad_r"]:"";
			$txt_vis_pc_os_add_3 =(strpos($statusElements, "elem_visPcOsAdd".$ex_num."=1") !== false)? $row["ad_l"]:"";

			//Pc---
			$pc3gp1_os=array();
			$pc3gp2_addos=array();
			$pc3gp2_prismos=array();
			$overrefraction3os=array();

			$overrefraction3od=array();
			$pc3gp2_prismod=array();
			$pc3gp2_addod=array();
			$pc3gp1_od=array();

		if($sel_vis_pc_od_sel_1_3!="" ||($txt_vis_pc_od_s_3!=""||$txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="" || $txt_vis_pc_os_s_3!=""|| $txt_vis_pc_os_c_3!=""||$txt_vis_pc_os_a_3!="" || $txt_vis_pc_os_add_3!="")){

		//<!-- 3rd PC -->
		$ret_str.="<tr><td style='width:740px;'>
					<table style='width:740px;' cellpadding='0' cellspacing='0'>";
		$ret_str.="	<tr>";
		$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:210px;\">PC ".$ex_num."th</td>";
		$ret_str.="		<td  class=\"tb_subheading paddingTop10\" style=\"width:130px;\">&nbsp;</td>";

					$prismTxt3 = '';
					if((($sel_vis_pc_od_prism!="" && $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" && $sel_vis_pc_os_p != "")) ||
				(($sel_vis_pc_od_prism_2!=""  && $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  && $sel_vis_pc_os_p_2 != "")) ||
				(($sel_vis_pc_od_prism_3!="" && $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  && $sel_vis_pc_os_p_3 != ""))
				){
						$prismTxt3 = 'Prism';
					}
					$overRefractionTxt3 = "";
					if($chk_pc_near_3!="Near" && ($txt_vis_pc_os_overref_s_3!="" || $txt_vis_pc_os_overref_c_3!="" || $txt_vis_pc_os_overref_a_3!="")||($txt_vis_pc_os_overref_v_3!="" && $txt_vis_pc_os_overref_v_3!="20/")||($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/")||($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/")){
						$overRefractionTxt3 = "Over Refraction";
					}

		$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:170px;\">". $prismTxt3."</td>";
		$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:220px;\">". $overRefractionTxt3."</td>";
		$ret_str.="	</tr>";
		$ret_str.="	<tr>";

					$pc3gp1_od[]="";
					$pc3gp1_os[]="";
					$pc3gp2_addod[]="";
					$pc3gp2_addos[]="";
					$pc3gp2_prismod[]="";
					$pc3gp2_prismos[]="";
					if(($sel_vis_pc_od_sel_1!="" && $txt_vis_pc_od_s!="" || ($sel_vis_pc_os_sel_1!="" && $txt_vis_pc_os_s!="")) ||
					($sel_vis_pc_od_sel_1_2!="" && $txt_vis_pc_od_s_2!="" || ($sel_vis_pc_os_sel_1_2!="" && $txt_vis_pc_os_s_2!="")) ||
					($sel_vis_pc_od_sel_1_3!="" && $txt_vis_pc_od_s_3!="" || ($sel_vis_pc_os_sel_1_3!="" && $txt_vis_pc_os_s_3!=""))
					){
						$pc3gp1_od[]="$sel_vis_pc_od_sel_1_3";
					}
					if(($txt_vis_pc_od_s!="" || $txt_vis_pc_os_s!="") ||
					($txt_vis_pc_od_s_2!="" || $txt_vis_pc_os_s_2!="") ||
					($txt_vis_pc_od_s_3!="" || $txt_vis_pc_os_s_3!="")
					){
						 if($txt_vis_pc_od_s_3!=""){$pc3gp1_od[]="S"; }
						 $pc3gp1_od[]="$txt_vis_pc_od_s_3";
					}
					if(($txt_vis_pc_od_c!="" || $txt_vis_pc_os_c!="") ||
					($txt_vis_pc_od_c_2!="" || $txt_vis_pc_os_c_2!="") ||
					($txt_vis_pc_od_c_3!="" || $txt_vis_pc_os_c_3!="")
					){
						 if($txt_vis_pc_od_c_3!=""){$pc3gp1_od[]="C";  }
						 $pc3gp1_od[]="".$txt_vis_pc_od_c_3."";
					}
					if(($txt_vis_pc_od_a!="" || $txt_vis_pc_os_a!="") ||
					($txt_vis_pc_od_a_2!="" || $txt_vis_pc_os_a_2!="") ||
					($txt_vis_pc_od_a_3!="" || $txt_vis_pc_os_a_3!="")
					){
						if($txt_vis_pc_od_a_3!="" ){$pc3gp1_od[]="A"; }
						if($txt_vis_pc_od_a_3!="" ){$pc3gp1_od[]="".$txt_vis_pc_od_a_3."&#176;";}
					}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->odLable(1). implode("&nbsp;",$pc3gp1_od)."</td>";

			if(
				($txt_vis_pc_od_add_3!="" || ($txt_vis_pc_od_s_3!="" || $txt_vis_pc_od_c_3!="" || $txt_vis_pc_od_a_3!=""))
			){
				if(strlen($txt_vis_pc_od_add_3)<>1){
					$pc3gp2_addod[]="Add";
					$pc3gp2_addod[]="$txt_vis_pc_od_add_3";
				}
			}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$pc3gp2_addod)."</td>";

				//if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3 )){
					if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
					($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
					($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
					){
					$pc3gp2_prismod[]= (!empty($sel_vis_pc_od_p_3)) ? "P" : "";
					$pc3gp2_prismod[]="$sel_vis_pc_od_p_3";
				}
				if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
				($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
				($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
				){

					$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_sel_2_3) || !empty($sel_vis_pc_od_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
					if(!empty($sel_vis_pc_od_sel_2_3) || !empty($sel_vis_pc_od_slash_3)){$pc3gp2_prismod[]="$sel_vis_pc_od_sel_2_3";}

				}
				if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
				($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
				($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
				){
					//$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
					$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_slash_3)) ? "/" : "";
					$pc3gp2_prismod[]="$sel_vis_pc_od_slash_3";
				}
				if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
				(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
				(($sel_vis_pc_od_prism_3!=""  || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
				){
					$pc3gp2_prismod[]="$sel_vis_pc_od_prism_3";
				}
			//}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$pc3gp2_prismod)."</td>";

			if($sel_vis_pc_od_sel_1_3!="" ||($txt_vis_pc_od_s_3!=""||$txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="")){
				$overrefraction3od[] = "";
				if($chk_pc_near_3=="Near"){
					 if($txt_vis_pc_od_near_txt_3!=""){
					 $overrefraction3od[]="OD";
					 $overrefraction3od[]="$txt_vis_pc_od_near_txt_3";
					 }
				}else{
					$haveValue=0;
					 if($txt_vis_pc_od_overref_s_3!="" || $txt_vis_pc_od_overref_c_3!="" || $txt_vis_pc_od_overref_a_3!="" || $txt_vis_pc_od_overref_v_3!="" ){
						$haveValue=1;
					 }
					if($txt_vis_pc_od_overref_s_3!=""){
						$overrefraction3od[]="S";
						$overrefraction3od[]="$txt_vis_pc_od_overref_s_3";
					}
					if($txt_vis_pc_od_overref_c_3!=""){
						$overrefraction3od[]="C";
						$overrefraction3od[]="$txt_vis_pc_od_overref_c_3";
					}
					if($txt_vis_pc_od_overref_a_3!=""){$overrefraction3od[]="A";
						$overrefraction3od[]="$txt_vis_pc_od_overref_a_3";
					}
					if($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/"){
						$overrefraction3od[]="V";
						$overrefraction3od[]="$txt_vis_pc_od_overref_v_3";
					}
				}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">";
				if($haveValue==1){$ret_str.=$this->odLable(1); $ret_str.= implode("&nbsp;",$overrefraction3od);}
				$ret_str.="</td>";

				}

			$ret_str.="</tr>";
			$ret_str.="<tr>";

				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
				){
					$pc3gp1_os[]="$sel_vis_pc_os_sel_1_3";
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
				){
					 if($txt_vis_pc_os_s_3!="" || $sel_vis_pc_os_sel_1_3!=""){
						$pc3gp1_os[]="S";
						$pc3gp1_os[]="$txt_vis_pc_os_s_3";
					 }
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_c!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_c_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_c_3!="")
				){
					 if($txt_vis_pc_os_c_3!="" || $sel_vis_pc_os_sel_1_3!=""){
						 $pc3gp1_os[]="C";
						 $pc3gp1_os[]="$txt_vis_pc_os_c_3";
					 }
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_a!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_a_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_a_3!="")
				){
					 if($txt_vis_pc_os_a_3!="" || $sel_vis_pc_os_sel_1_3!=""){
						$pc3gp1_os[]="A";
						$pc3gp1_os[]="".$txt_vis_pc_os_a_3."&#176;";
					}
				}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->osLable(1). implode("&nbsp;",$pc3gp1_os)."</td>";

				if(
					($txt_vis_pc_os_add_3!="" || ($txt_vis_pc_os_s_3!="" || $txt_vis_pc_os_c_3!="" || $txt_vis_pc_os_a_3!=""))
				){
					 if(strlen($txt_vis_pc_os_add_3)<>1){
						$pc3gp2_addos[]="Add";
						$pc3gp2_addos[]="$txt_vis_pc_os_add_3";
					}
				}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$pc3gp2_addos)."</td>";

				//if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
					if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
					($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
					($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
					){
						$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_p_3)) ? "P" : "";

						$pc3gp2_prismos[]="$sel_vis_pc_os_p_3";

					}
					if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
					($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
					($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
					){
						$pc3gp2_prismos[]= (!empty($sel_vis_pc_os_sel_2_3) || !empty($sel_vis_pc_os_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
						if(!empty($sel_vis_pc_os_sel_2_3) || !empty($sel_vis_pc_os_slash_3)){$pc3gp2_prismos[]="$sel_vis_pc_os_sel_2_3";}
					}
					if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
					($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
					($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
					){
						//$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_slash_3)) ?"<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
						$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_slash_3)) ? "/" : "";
						$pc3gp2_prismos[]="$sel_vis_pc_os_slash_3";
					}
					if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
					(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
					(($sel_vis_pc_od_prism_3!="" || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
					){
						 $pc3gp2_prismos[]="$sel_vis_pc_os_prism_3";
					}

				//}

			$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$pc3gp2_prismos)."</td> ";

			if($sel_vis_pc_od_sel_1_3!="" || ($txt_vis_pc_od_s_3!="" || $txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="")){
				$overrefraction3os[]="";
				if($chk_pc_near_3=="Near"){
					 if($txt_vis_pc_os_near_txt_3!=""){
						$overrefraction3os[]="OS";
						$overrefraction3os[]="$txt_vis_pc_os_near_txt_3";
					}
				}else{
					$haveValue=0;
					 if($txt_vis_pc_os_overref_s_3!="" || $txt_vis_pc_os_overref_c_3!="" || $txt_vis_pc_os_overref_a_3!="" || $txt_vis_pc_os_overref_v_3!=""){
						$haveValue=1;
					 }
					 if($txt_vis_pc_os_overref_s_3!=""){
						$overrefraction3os[]="S";
						$overrefraction3os[]="$txt_vis_pc_os_overref_s_3";
					 }
					 if($txt_vis_pc_os_overref_c_3!=""){
						$overrefraction3os[]="C";
						$overrefraction3os[]="$txt_vis_pc_os_overref_c_3";
					 }
					 if($txt_vis_pc_os_overref_a_3!=""){
						$overrefraction3os[]="A";
						$overrefraction3os[]="$txt_vis_pc_os_overref_a_3";
					 }
					 if($txt_vis_pc_os_overref_v_3!="" && $txt_vis_pc_os_overref_v_3!="20/" ){
						$overrefraction3os[]="V";
						$overrefraction3os[]="$txt_vis_pc_os_overref_v_3";
					 }
				}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">";
				if($haveValue==1){$ret_str.=$this->osLable(1); $ret_str.= implode("&nbsp;",$overrefraction3os);}
				$ret_str.="</td>";

				}
		$ret_str.="</tr>";
		$ret_str.="</table></td></tr>";
		//<!-- End 3rd PC -->

		}
		if($txt_vis_pc_desc3!=""){

		$ret_str.="";
		$ret_str.="	<tr>";
		$ret_str.="		<td class='text_lable paddingTop10' style='width:700px;'>";
					if($txt_vis_pc_desc3!=""){$ret_str.="PC ".$ex_num."th Desc.&nbsp;". $txt_vis_pc_desc3;}
		$ret_str.="		</td>";
		$ret_str.="	</tr>";
		$ret_str.="";

		}

		if(!empty($ret_str)){ $ret_str_main=$ret_str_main."".$ret_str; }

		}//end for
		}
		//<!-- End 3rd Pc overrefraction-->
		return $ret_str_main;

	}


	public function print_getVision($pid=0,$fid=0){
		global $arrTempProc;
		if(empty($pid)||empty($fid)) return "";
		$row = array();
		$ret_str="";
		// Chart Vision
		/*
		echo "SELECT * FROM chart_vision WHERE patient_id = '".$pid."' AND form_id = '".$fid."' ";exit;
		$sql = imw_query("");
		while($rez = imw_fetch_assoc($sql)){
			$row[] = $rez;
		}
		*/

		$id_chart_vis_master=0;
		$sql = "SELECT *, c5.ex_desc as ex_desc_pam, c2.ex_desc as ex_desc_ak, c1.id AS id_chart_vis_master
				FROM chart_vis_master c1
				LEFT JOIN chart_ak c2 ON c2.id_chart_vis_master = c1.id
				LEFT JOIN chart_exo c3 ON c3.id_chart_vis_master = c1.id
				LEFT JOIN chart_bat c4 ON c4.id_chart_vis_master = c1.id
				LEFT JOIN chart_pam c5 ON c5.id_chart_vis_master = c1.id
				WHERE c1.patient_id = '".$pid."' AND c1.form_id = '".$fid."' ";
		$row = sqlQuery($sql);
		if($row!=false){
			$statusElements = $row["status_elements"];
			$id_chart_vis_master = $row["id_chart_vis_master"];

			//PAM --
			$visPam = (strpos($statusElements, "elem_visPam=1") !== false) ? $row["pam"] : "";
			$vis_pam_od_txt_1 = (strpos($statusElements, "elem_visPamOdTxt1=1") !== false) ? $row["txt1_od"] : "";
			$vis_pam_os_txt_1 = (strpos($statusElements, "elem_visPamOsTxt1=1") !== false) ? $row["txt1_os"] : "";
			$vis_pam_ou_txt_1 = (strpos($statusElements, "elem_visPamOuTxt1=1") !== false) ? $row["txt1_ou"] : "";
			$vis_pam_od_sel_2 = (strpos($statusElements, "elem_visPamOdSel2=1") !== false) ? $row["sel2"] : "";
			$vis_pam_od_txt_2 = (strpos($statusElements, "elem_visPamOdTxt2=1") !== false) ? $row["txt2_od"] : "";
			$vis_pam_os_txt_2 = (strpos($statusElements, "elem_visPamOsTxt2=1") !== false) ? $row["txt2_os"] : "";
			$vis_pam_ou_txt_2 = (strpos($statusElements, "elem_visPamOuTxt2=1") !== false) ? $row["txt2_ou"] : "";
			$vis_pam_desc = (strpos($statusElements, "elem_pamDesc=1") !== false) ? $row["ex_desc_pam"] : "";
			//PAM --

			//BAT --
			$txt_vis_bat_nl_od = (strpos($statusElements, "elem_visBatNlOd=1") !== false)?$row["nl_od"]:"";
			$txt_vis_bat_low_od =(strpos($statusElements, "elem_visBatLowOd=1") !== false)? $row["l_od"]:"";
			$txt_vis_bat_med_od = (strpos($statusElements, "elem_visBatMedOd=1") !== false)? $row["m_od"]:"";
			$txt_vis_bat_high_od =(strpos($statusElements, "elem_visBatHighOd=1") !== false)?$row["h_od"]:"";
			$txt_vis_bat_nl_os = (strpos($statusElements, "elem_visBatNlOs=1") !== false)?$row["nl_os"]:"";
			$txt_vis_bat_low_os = (strpos($statusElements, "elem_visBatLowOs=1") !== false)?$row["l_os"]:"";
			$txt_vis_bat_med_os =(strpos($statusElements, "elem_visBatMedOs=1") !== false)?$row["m_os"]:"";
			$txt_vis_bat_high_os =(strpos($statusElements, "elem_visBatHighOs=1") !== false)?$row["h_os"]:"";

			$txt_vis_bat_nl_ou = (strpos($statusElements, "elem_visBatNlOu=1") !== false)?$row["nl_ou"]:"";
			$txt_vis_bat_low_ou = (strpos($statusElements, "elem_visBatLowOu=1") !== false)?$row["l_ou"]:"";
			$txt_vis_bat_med_ou =(strpos($statusElements, "elem_visBatMedOu=1") !== false)?$row["m_ou"]:"";
			$txt_vis_bat_high_ou =(strpos($statusElements, "elem_visBatHighOu=1") !== false)?$row["h_ou"]:"";
			$txt_vis_bat_desc =(strpos($statusElements, "elem_visBatDesc=1") !== false)?$row["vis_bat_desc"]:""; //removeExamDateStr($row[0]["vis_bat_desc"]);
			$txt_vis_bat_examdate = $row["examDateDistance"];//getExamDateStr($row[0]["vis_bat_desc"]);
			//BAT --

			//AK --
			$txt_vis_ak_od_k = (strpos($statusElements, "elem_visAkOdK=1") !== false)?$row["k_od"]:"";
			$txt_vis_ak_od_slash = (strpos($statusElements, "elem_visAkOdSlash=1") !== false)?$row["slash_od"]:"";
			$txt_vis_ak_od_x = (strpos($statusElements, "elem_visAkOdX=1") !== false)?$row["x_od"]:"";
			$txt_vis_ak_os_k = (strpos($statusElements, "elem_visAkOsK=1") !== false)?$row["k_os"]:"";
			$txt_vis_ak_os_slash =(strpos($statusElements, "elem_visAkOsSlash=1") !== false)? $row["slash_os"]:"";
			$txt_vis_ak_os_x = (strpos($statusElements, "elem_visAkOsX=1") !== false)?$row["x_os"]:"";
			$txt_vis_ar_ak_desc =$row["ex_desc_ak"];//removeExamDateStr($row[0]["vis_ar_ak_desc"]) ;

			//EXO
			$vis_ret_pd = (strpos($statusElements, "elem_visRetPD=1") !== false)?$row["pd"]:"";
			$vis_ret_pd_od =(strpos($statusElements, "elem_visRetOd=1") !== false)? $row["pd_od"]:"";
			$vis_ret_pd_os = (strpos($statusElements, "elem_visRetOs=1") !== false)?$row["pd_os"]:"";

			//Comments --
			//Check For old comments
			if(strpos($txt_vis_ar_ak_desc,"<~ED~>")!== false){
				$commentsArrayTmp=explode("<~ED~>",$txt_vis_ar_ak_desc);
				$txt_vis_ar_ak_desc=$commentsArrayTmp[0];
			}
			//Comments --
			//AK --
		}

		//Acuity
		$sql = "SELECT * FROM chart_vis_master c1
				LEFT JOIN chart_acuity c2 ON c2.id_chart_vis_master = c1.id
				WHERE c1.patient_id = '".$pid."' AND c1.form_id = '".$fid."'
				ORDER BY sec_indx
				";
		$res = sqlStatement($sql);
		for($i=1; $row=sqlFetchArray($res); $i++){

			$sec_name = $row["sec_name"];
			$sec_indx = $row["sec_indx"];
			if($sec_name == "Distance"){
				${"sel_vis_dis_od_sel_".$sec_indx} =(strpos($statusElements, "elem_visDisOdTxt".$sec_indx."=1") !== false)?$row["sel_od"]:"";
				${"txt_vis_dis_od_txt_".$sec_indx} =(strpos($statusElements, "elem_visDisOdTxt".$sec_indx."=1") !== false)?$row["txt_od"]:"";
				${"sel_vis_dis_os_sel_".$sec_indx} =(strpos($statusElements, "elem_visDisOsTxt".$sec_indx."=1") !== false)? $row["sel_os"]:"";
				${"txt_vis_dis_os_txt_".$sec_indx} =(strpos($statusElements, "elem_visDisOsTxt".$sec_indx."=1") !== false)? $row["txt_os"]:"";
				${"sel_vis_dis_ou_sel_".$sec_indx} =(strpos($statusElements, "elem_visDisOuTxt".$sec_indx."=1") !== false)? $row["sel_ou"]:"";
				${"txt_vis_dis_ou_txt_".$sec_indx} =(strpos($statusElements, "elem_visDisOuTxt".$sec_indx."=1") !== false)? $row["txt_ou"]:"";
				$txt_vis_dis_near_desc = (strpos($statusElements, "elem_visNearOdTxt".$sec_indx."=1") !== false || strpos($statusElements, "elem_visNearOsTxt".$sec_indx."=1") !== false)?$row["ex_desc"]:"";

				//Comments --
				//Check For old comments
				if(strpos($txt_vis_dis_near_desc,"<~ED~>")!== false){
					$commentsArrayTmp=explode("<~ED~>",$txt_vis_dis_near_desc);
					$txt_vis_dis_near_desc=$commentsArrayTmp[0];
				}
				//Comments --

			}else if($sec_name == "Near"){
				${"sel_vis_near_od_sel_".$sec_indx} =(strpos($statusElements, "elem_visNearOdTxt".$sec_indx."=1") !== false)? $row["sel_od"]:"";
				${"txt_vis_near_od_txt_".$sec_indx} = (strpos($statusElements, "elem_visNearOdTxt".$sec_indx."=1") !== false)?$row["txt_od"]:"";
				${"sel_vis_near_os_sel_".$sec_indx} = (strpos($statusElements, "elem_visNearOsTxt".$sec_indx."=1") !== false)?$row["sel_os"]:"";
				${"txt_vis_near_os_txt_".$sec_indx} = (strpos($statusElements, "elem_visNearOsTxt".$sec_indx."=1") !== false)?$row["txt_os"]:"";
				${"sel_vis_near_ou_sel_".$sec_indx} =(strpos($statusElements, "elem_visNearOuTxt".$sec_indx."=1") !== false)? $row["sel_ou"]:"";
				${"txt_vis_near_ou_txt_".$sec_indx} =(strpos($statusElements, "elem_visNearOuTxt".$sec_indx."=1") !== false)? $row["txt_ou"]:"";
				$txt_vis_near_desc =(strpos($statusElements, "elem_visNearDesc=1") !== false)?$row["ex_desc"]:"";// removeExamDateStr($row["vis_near_desc"]);
				$txt_vis_near_examdate = $row["examDateDistance "];

			}else if($sec_name == "Ad. Acuity"){
				$vis_dis_od_sel_3=(strpos($statusElements, "elem_visDisOdSel3=1") !== false) ? $row["sel_od"]: "";
				$vis_dis_od_txt_3=(strpos($statusElements, "elem_visDisOdTxt3=1") !== false) ? $row["txt_od"]: "";
				$vis_dis_os_sel_3=(strpos($statusElements, "elem_visDisOsSel3=1") !== false) ? $row["sel_os"]: "";
				$vis_dis_os_txt_3=(strpos($statusElements, "elem_visDisOsTxt3=1") !== false) ? $row["txt_os"]: "";
				$vis_dis_ou_sel_3=(strpos($statusElements, "elem_visDisOuSel3=1") !== false) ? $row["sel_ou"]: "";
				$vis_dis_ou_txt_3=(strpos($statusElements, "elem_visDisOuTxt3=1") !== false) ? $row["txt_ou"]: "";
				$vis_dis_act_3  =(strpos($statusElements, "elem_visDisAct3=1") !== false) ? htmlentities($row["ex_desc"]): "";
			}
		}

		if(!empty($id_chart_vis_master)){
			//sca
			$sql = "SELECT * FROM chart_sca WHERE id_chart_vis_master='".$id_chart_vis_master."' ";
			$res = sqlStatement($sql);
			for($i=1;$row=sqlFetchArray($res);$i++){

				$sec_name = $row["sec_name"];

				switch ($sec_name) {
					case 'AR':
						$txt_vis_ar_od_s =(strpos($statusElements, "elem_visArOdS=1") !== false)? $row["s_od"]:"";
						$txt_vis_ar_od_c =(strpos($statusElements, "elem_visArOdC=1") !== false)? $row["c_od"]:"";
						$txt_vis_ar_od_a = (strpos($statusElements, "elem_visArOdA=1") !== false)?$row["a_od"]:"";
						$sel_vis_ar_od_sel_1 =(strpos($statusElements, "elem_visArOdS=1") !== false)? $row["sel_od"]:"";
						$txt_vis_ar_os_s =(strpos($statusElements, "elem_visArOsS=1") !== false)? $row["s_os"]:"";
						$txt_vis_ar_os_c = (strpos($statusElements, "elem_visArOsC=1") !== false)?$row["c_os"]:"";
						$txt_vis_ar_os_a = (strpos($statusElements, "elem_visArOsA=1") !== false)?$row["a_os"]:"";
						$sel_vis_ar_os_sel_1 = (strpos($statusElements, "elem_visArOsA=1") !== false)?$row["sel_os"]:"";
						break;
					case 'ARC':
						$visCycArOdS =(strpos($statusElements, "elem_visArOdS=1") !== false)? $row["s_od"]:"";
						$visCycArOdC =(strpos($statusElements, "elem_visArOdC=1") !== false)? $row["c_od"]:"";
						$visCycArOdA = (strpos($statusElements, "elem_visArOdA=1") !== false)?$row["a_od"]:"";
						$visCycArOdSel1 =(strpos($statusElements, "elem_visArOdS=1") !== false)? $row["sel_od"]:"";
						$visCycArOsS =(strpos($statusElements, "elem_visArOsS=1") !== false)? $row["s_os"]:"";
						$visCycArOsC = (strpos($statusElements, "elem_visArOsC=1") !== false)?$row["c_os"]:"";
						$visCycArOsA = (strpos($statusElements, "elem_visArOsA=1") !== false)?$row["a_os"]:"";
						$visCycArOsSel1 = (strpos($statusElements, "elem_visArOsA=1") !== false)?$row["sel_os"]:"";
						break;
					case 'RETINOSCOPY':
						$vis_exo_od_s =(strpos($statusElements, "elem_visExoOdS=1") !== false)? $row["s_od"]:"";
						$vis_exo_od_c =(strpos($statusElements, "elem_visExoOdC=1") !== false)? $row["c_od"]:"";
						$vis_exo_od_a = (strpos($statusElements, "elem_visExoOdA=1") !== false)?$row["a_od"]:"";
						$vis_exo_os_s =(strpos($statusElements, "elem_visExoOsS=1") !== false)? $row["s_os"]:"";
						$vis_exo_os_c = (strpos($statusElements, "elem_visExoOsC=1") !== false)?$row["c_os"]:"";
						$vis_exo_os_a = (strpos($statusElements, "elem_visExoOsA=1") !== false)?$row["a_os"]:"";
						break;
					case 'CYCLOPLEGIC RETINO':
						$visCycloOdS =(strpos($statusElements, "elem_visCycloOdS=1") !== false)? $row["s_od"]:"";
						$visCycloOdC =(strpos($statusElements, "elem_visCycloOdC=1") !== false)? $row["c_od"]:"";
						$visCycloOdA = (strpos($statusElements, "elem_visCycloOdA=1") !== false)?$row["a_od"]:"";
						$visCycloOsS =(strpos($statusElements, "elem_visCycloOsS=1") !== false)? $row["s_os"]:"";
						$visCycloOsC = (strpos($statusElements, "elem_visCycloOsC=1") !== false)?$row["c_os"]:"";
						$visCycloOsA = (strpos($statusElements, "elem_visCycloOsA=1") !== false)?$row["a_os"]:"";
						break;
				}

			}
		}




		if(!empty($id_chart_vis_master)){
		//SET MODE
		//RESUME HERE if(strpos( $statusElements, "elem_distanceOd=1") !== false) print $elem_distanceOd//


			//HTML --
			// VISION START//
			if(($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/" && $txt_vis_dis_od_txt_1!="") ||
			($sel_vis_dis_os_sel_1!="" && $txt_vis_dis_os_txt_1!="20/" && $txt_vis_dis_os_txt_1!="") ||
			($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/" && $txt_vis_dis_od_txt_2!="") ||
			($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/" && $txt_vis_dis_os_txt_2!="") ||
			($sel_vis_dis_ou_sel_1!="" && $txt_vis_dis_ou_txt_1!="20/" && $txt_vis_dis_ou_txt_1!="") ||
			($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/" && $txt_vis_dis_ou_txt_2!="")
			){
				$show_vis_dist_val=true;
				$visdateCheckpass=true;
			}

			if(($txt_vis_near_od_txt_1!="" && $txt_vis_near_od_txt_1!="20/" && $sel_vis_near_od_sel_1!="")  ||
			($sel_vis_near_os_sel_1!="" && $txt_vis_near_os_txt_1!="20/" && $txt_vis_near_os_txt_1!="") ||
			($txt_vis_near_od_txt_2!="" && $txt_vis_near_od_txt_2!="20/" && $sel_vis_near_od_sel_2!="")  ||
			($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/" && $txt_vis_near_os_txt_2!="") ||
			($sel_vis_near_ou_sel_1!="" && $txt_vis_near_ou_txt_1!="20/" && $txt_vis_near_ou_txt_1!="") ||
			($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/" && $txt_vis_near_ou_txt_2!="")
			){
				$show_vis_near_val=true;
				$visNeardateCheckpass=true;
			}

			if($date_of_service!="" && $txt_vis_near_examdate!="" && $txt_vis_near_examdate!=0){
				$start2 =$this->FormatDate_insert($date_of_service);
				$end2 =$txt_vis_near_examdate;
				if($start2==$end2){
					$visNeardateCheckpass=true;
					$visdateCheckpass=true;
				}
				if($diff=@$this->get_time_difference($start2, $end2)){
					$visNeardateCheckpass=true;
					$visdateCheckpass=true;

				}
			}
			/* End Code To Compare VISExamDate WITH DOS*/
			$show_vis_BAT_val=false;
			/* Code To Compare VISBATExamDate WITH DOS*/
			$visCRdateCheckpass=false;
			if($date_of_service!="" && $txt_vis_bat_examdate!="" && $txt_vis_bat_examdate!=0){
				$start3 =$this->FormatDate_insert($date_of_service);
				$end3 =$txt_vis_bat_examdate;
				if($start3==$end3){
					$visCRdateCheckpass=true;
				}
				if($diff=@$this->get_time_difference($start3, $end3)){
					$visCRdateCheckpass=true;
					// echo "$start3 You  $end3 have $txt_vis_near_examdate  logged in after <br>".$diff['days']." Days ".$diff['hours']."Hours ".$diff['minutes']."Minutes <br>" ;
				}
			}

			if($visNeardateCheckpass==true || $visdateCheckpass==true){
				$this->HeadingTableHr();
				//HeadingTable($titleName="Vision:");
				$this->HeadingTableHr();
			}
			// End of VISION//

			$src_pic_vision_pc = $GLOBALS['fileroot']."/library/images/pic_vision_pc.jpg";

			//Distance AR AK--
			$ret_str.="<table style='width:750px;'  cellpadding='0' cellspacing='0'>";
			if($visNeardateCheckpass==true || $visdateCheckpass==true)
			{
				$ret_str.="<tr><td class='bluelne' height='1' style='width:750px;'>&nbsp;</td></tr>";
				$ret_str.="<tr><td class='bluehed paddingTop10'>Vision</td></tr>";
			}
			$ret_str.="<tr><td style='width:750px;'><table style='width:750px;' cellspacing='0' cellpadding='0'>";


			if($date_of_service!="" || $txt_vis_near_examdate!="" || $txt_vis_near_examdate!=0){
					$start2 = $this->FormatDate_insert($date_of_service);
					$end2 = $txt_vis_near_examdate;
					if($start2 == $end2){
						$visNeardateCheckpass=true;
						$visdateCheckpass=true;
					}
					if($diff = @$this->get_time_difference($start2, $end2)){
						$visNeardateCheckpass=true;
						$visdateCheckpass=true;

					}
				}

				/* End Code To Compare VISExamDate WITH DOS*/
				$show_vis_BAT_val=false;
				/* Code To Compare VISBATExamDate WITH DOS*/
				$visCRdateCheckpass=false;
				if($date_of_service!="" || $txt_vis_bat_examdate!="" || $txt_vis_bat_examdate!=0){
					$start3 =$this->FormatDate_insert($date_of_service);
					$end3 =$txt_vis_bat_examdate;
					if($start3==$end3){
						$visCRdateCheckpass=true;
					}
					if($diff=$this->get_time_difference($start3, $end3)){
						$visCRdateCheckpass=true;
					}
				}

				/* End Code To Compare VISBATExamDate WITH DOS*/
				$vis_arCheckpass=false;
				if($date_of_service!="" || $txt_vis_ar_ak_examdate!="" || $txt_vis_ar_ak_examdate!=0){
					$startar = $this->FormatDate_insert($date_of_service);
					$endar = $txt_vis_ar_ak_examdate;
					if($startar==$endar){
						$vis_arCheckpass=true;
					}
					if($diff=@$this->get_time_difference($startar, $endar)){
						$vis_arCheckpass=true;
					}
				}


				///CHECK TEMPLATE SETTING FOR SHOW--
				if(isset($arrTempProc)&&!in_array("Distance",$arrTempProc)){
					$visdateCheckpass=false;
					$sel_vis_dis_os_sel_2=$txt_vis_dis_os_txt_2=$sel_vis_dis_od_sel_2=$txt_vis_dis_od_txt_2="";
					$vis_dis_od_sel_3=$vis_dis_od_txt_3 =$vis_dis_os_sel_3 ="";
					$vis_dis_ou_sel_3=$vis_dis_ou_txt_3 ="";
					$txt_vis_dis_desc="";
					$vis_dis_act_3="";
				}

				if(isset($arrTempProc)&&!in_array("Near",$arrTempProc)){
					$visNeardateCheckpass=false;
					$sel_vis_near_od_sel_1= $txt_vis_near_od_txt_1=$sel_vis_near_os_sel_1= $txt_vis_near_os_txt_1="";
					$txt_vis_near_desc="";
				}

				if(isset($arrTempProc)&&!in_array("AR",$arrTempProc)){
					$vis_arCheckpass=false;
					$txt_vis_ar_od_s=$txt_vis_ar_od_c=$txt_vis_ar_od_a=$txt_vis_ar_os_s=$txt_vis_ar_os_c=$txt_vis_ar_os_a="";
				}

				if(isset($arrTempProc)&&!in_array("AK",$arrTempProc)){
					$txt_vis_ak_od_k=$txt_vis_ak_od_slash=$txt_vis_ak_od_x=$txt_vis_ak_os_k=$txt_vis_ak_os_slash=$txt_vis_ak_os_x="";
					$txt_vis_AK_desc="";
				}

				if(isset($arrTempProc)&&!in_array("BAT",$arrTempProc)){
					$txt_vis_bat_nl_od="";
					$txt_vis_bat_nl_os="";
					$txt_vis_bat_nl_ou="";
					$txt_vis_bat_desc="";
					$txt_vis_ar_ak_desc="";
				}
				///CHECK TEMPLATE SETTING FOR SHOW--
			$ret_str.="	<tr>";

						if($visdateCheckpass==true)
						{

			$ret_str.="			<td class=\"text_lable paddingTop10\" style=\"width:160px;\">Distance</td>";

						}
						else{
			$ret_str.="			<td style=\"width:170px;\"></td>";

						}
						if(($visNeardateCheckpass==true)) {

			$ret_str.="			<td class=\"text_lable paddingTop10\" style=\"width:160px;\">Near</td>";

						}
						else{
			$ret_str.="			<td style=\"width:170px;\"></td>";
						}				#Start AR AK Heading
						if( $vis_arCheckpass==true && ($txt_vis_ar_od_s!="" || $txt_vis_ar_od_c!="" || $txt_vis_ar_od_a!="" || $txt_vis_ar_os_s!="" || $txt_vis_ar_os_c!="" || $txt_vis_ar_os_a!="")){
							if($txt_vis_ar_od_s!="" || $txt_vis_ar_od_c!="" || $txt_vis_ar_od_a!="" || $txt_vis_ar_os_s!="" || $txt_vis_ar_os_c!="" || $txt_vis_ar_os_a!=""){
							$tmp = ($vis_ar_ref_place!="") ? "Refraction Place: ".$vis_ar_ref_place : "";
			$ret_str.="				<td class=\"text_lable paddingLeft paddingTop10\" style=\"width:200px;\">AR ".$tmp."</td>";

							}
						/*	else{
			$ret_str.="				<td class=\"text_lable paddingLeft paddingTop10\" style=\"width:200px;\">&nbsp;</td>";
						}*/
							if($txt_vis_ak_od_k!="" ||$txt_vis_ak_od_slash!="" || $txt_vis_ak_od_x!="" ||$txt_vis_ak_os_k!="" ||$txt_vis_ak_os_slash!="" || $txt_vis_ak_os_x!=""){
			$ret_str.="				<td class=\"text_lable paddingLeft paddingTop10\" style=\"width:155px;\">AK</td>";
							 }
							/* else{
			$ret_str.="			<td class=\"text_lable paddingLeft paddingTop10\" style=\"width:155px;\">AK</td>";
						} */
						}
						#End AR AK Heading

			$ret_str.="	</tr>";
			$ret_str.=" <tr>";

			if($visdateCheckpass==true){

				if(($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/" && $txt_vis_dis_od_txt_1!="")){
					$odinfo_vis_dis[]=($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/")?$sel_vis_dis_od_sel_1:"";
					//$osinfo_vis_dis.=($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/")?$sel_vis_dis_od_sel_1."RM":"jj";
					$odinfo_vis_dis[]=($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/")?"".$txt_vis_dis_od_txt_1."":"";
				}

				if(($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/" && $txt_vis_dis_os_txt_2!="") || ($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/" && $txt_vis_dis_od_txt_2!="")){
					$odinfo_vis_dis[]=($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/")?$sel_vis_dis_od_sel_2:"";
					$odinfo_vis_dis[]=($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/")?"".$txt_vis_dis_od_txt_2."":"";
				}
			}
			elseif(($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/" && $txt_vis_dis_os_txt_2!="") || ($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/" && $txt_vis_dis_od_txt_2!="")){
				$odinfo_vis_dis[]="";
				$odinfo_vis_dis[]=($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/")?$sel_vis_dis_od_sel_2:"";
				$odinfo_vis_dis[]=($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/")?"".$txt_vis_dis_od_txt_2."":"";
			}
			$class1="";
			if(count($odinfo_vis_dis)>0){$class1="paddingTop10";}
			$ret_str.="<td style=\"width:160px;\" class=\"".$class1."\">";
						if(count($odinfo_vis_dis)>0){
			$ret_str.=	$this->odLable(1)."&nbsp;";
						}
			$arr_find=array(">","<");$arr_repl=array("&gt;","&lt;");
			$ret_str.= str_replace($arr_find,$arr_repl,@implode("&nbsp;",$odinfo_vis_dis));
			$ret_str.=		"</td>";


			$haveValue = 0;
			if(($visNeardateCheckpass==true) &&(($sel_vis_near_od_sel_1!="" && $txt_vis_near_od_txt_1!="" && $txt_vis_near_od_txt_1!="20/") )){
			 $haveValue = 1;
			 $odinfo_vis_near[]="";
			 $odinfo_vis_near[]=($sel_vis_near_od_sel_1!="" && $txt_vis_near_od_txt_1!="20/")?$sel_vis_near_od_sel_1:"";
			 $odinfo_vis_near[]=($sel_vis_near_od_sel_1!="" && $txt_vis_near_od_txt_1!="" && $txt_vis_near_od_txt_1!="20/")?"".$txt_vis_near_od_txt_1."":"";
			 if(($sel_vis_near_od_sel_2!="" && $txt_vis_near_od_txt_2!="20/" && $txt_vis_near_od_txt_2!="") || ($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/" && $txt_vis_near_os_txt_2!="")){
				$odinfo_vis_near[]=($sel_vis_near_od_sel_2!="" && $txt_vis_near_od_txt_2!="20/")?$sel_vis_near_od_sel_2:"";
				$odinfo_vis_near[]=($txt_vis_near_od_txt_2!="" && $txt_vis_near_od_txt_2!="20/")?"".$txt_vis_near_od_txt_2."":"";
				}
			}
			elseif(($sel_vis_near_od_sel_2!="" && $txt_vis_near_od_txt_2!="20/" && $txt_vis_near_od_txt_2!="")  || ($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/" && $txt_vis_near_os_txt_2!="")){
				$odinfo_vis_near[]=($sel_vis_near_od_sel_2!="" && $txt_vis_near_od_txt_2!="20/")?$sel_vis_near_od_sel_2:"";
				$odinfo_vis_near[]=($txt_vis_near_od_txt_2!="" && $txt_vis_near_od_txt_2!="20/")?"".$txt_vis_near_od_txt_2."":"";
			}
			$class="";
			if($haveValue == 1){$class="paddingLeft paddingTop10";}
			$ret_str.="<td style=\"width:210px;\"  class=\"".$class."\">";
			if($haveValue == 1){$ret_str.=$this->odLable(1); $ret_str.= str_replace($arr_find,$arr_repl,implode("&nbsp;",$odinfo_vis_near));}
			$ret_str.="</td>";

			#start AR AK (OD)
			// $vis_arCheckpass==true &&
			if(($txt_vis_ar_od_s!="" || $txt_vis_ar_od_c!="" || $txt_vis_ar_od_a!="" || $txt_vis_ar_os_s!="" || $txt_vis_ar_os_c!="" || $txt_vis_ar_os_a!="")){

			$odinfo_vis_ar[]="";
				if($txt_vis_ar_od_s!=""){$odinfo_vis_ar[]="S"; }
				$odinfo_vis_ar[]="".$txt_vis_ar_od_s."";
				if($txt_vis_ar_od_c!=""){$odinfo_vis_ar[]="C"; }
					$odinfo_vis_ar[]="".$txt_vis_ar_od_c."";
					if($txt_vis_ar_od_a!=""){$odinfo_vis_ar[]="A"; }
					if($txt_vis_ar_od_a!=""){$odinfo_vis_ar[]="".$txt_vis_ar_od_a."&#176;";}
					if($txt_vis_ar_od_a!=""){$odinfo_vis_ar[]="".$sel_vis_ar_od_sel_1."";}

			$ret_str.="<td style=\"width:200px;\" class=\"paddingLeft paddingTop10\">";
			$ret_str.= $this->odLable(1); $ret_str.= implode("&nbsp;",$odinfo_vis_ar);
			$ret_str.="</td>"	;

			}



			if($txt_vis_ak_od_k!="" ||$txt_vis_ak_od_slash!="" || $txt_vis_ak_od_x!=""){
			$odinfo_vis_ak[]="";
			if($txt_vis_ak_od_k!=""){$odinfo_vis_ak[]="K:";}
			$odinfo_vis_ak[]="".$txt_vis_ak_od_k."";
			//if($txt_vis_ak_od_slash!=""){$odinfo_vis_ak[]="/"; }
			$odinfo_vis_ak[]="/";
			$odinfo_vis_ak[]="".$txt_vis_ak_od_slash."";
			//if($txt_vis_ak_od_x!=""){$odinfo_vis_ak[]="X"; }
			$odinfo_vis_ak[]="X";
			if($txt_vis_ak_od_x!=""){$odinfo_vis_ak[]="".$txt_vis_ak_od_x."&#176; ";}

			//echo "=".$odinfo_vis_ak."<br/>";

			if($odinfo_vis_ak!="")
			{
				$ret_str.="<td style=\"width:155px;\" class=\"paddingLeft paddingTop10\">";
				$ret_str.= $this->odLable(1); $ret_str.= implode("&nbsp;",$odinfo_vis_ak);
				$ret_str.="</td>";
			}
			else if($odinfo_vis_ak=="")
			{

				$ret_str.="<td style=\"width:155px;\"></td>";
			}
			}$ret_str.="</tr>";
			$ret_str.="<tr>";

			if(($sel_vis_dis_od_sel_1!="" && $txt_vis_dis_od_txt_1!="20/" && $txt_vis_dis_od_txt_1!="") || ($sel_vis_dis_os_sel_1!="" && $txt_vis_dis_os_txt_1!="20/" && $txt_vis_dis_os_txt_1!="")){
				if($sel_vis_dis_os_sel_1!="" && $txt_vis_dis_os_txt_1!="20/" && $txt_vis_dis_os_txt_1!=""){
				$osinfo_vis_dis[]=($sel_vis_dis_os_sel_1!="" && $txt_vis_dis_os_txt_1!="20/" && $txt_vis_dis_os_txt_1!="")?$sel_vis_dis_os_sel_1:"";
				$osinfo_vis_dis[]=($sel_vis_dis_os_sel_1!="" && $txt_vis_dis_os_txt_1!="20/" && $txt_vis_dis_os_txt_1!="")?"".$txt_vis_dis_os_txt_1."":"";
				}
				if(($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/" && $txt_vis_dis_os_txt_2!="") || ($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/" && $txt_vis_dis_od_txt_2!="")){
					$osinfo_vis_dis[]=($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/")?$sel_vis_dis_os_sel_2:"";
					$osinfo_vis_dis[]=($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/")?"".$txt_vis_dis_os_txt_2."" :"";
				}
			}
			elseif(($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/" && $txt_vis_dis_os_txt_2!="") || ($sel_vis_dis_od_sel_2!="" && $txt_vis_dis_od_txt_2!="20/" && $txt_vis_dis_od_txt_2!="")){
				$osinfo_vis_dis[]=($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/")?$sel_vis_dis_os_sel_2:"";
				$osinfo_vis_dis[]=($sel_vis_dis_os_sel_2!="" && $txt_vis_dis_os_txt_2!="20/")?"".$txt_vis_dis_os_txt_2."" :"";
			}
			$class2="";
			if(count($osinfo_vis_dis)>0){$class2="paddingTop10";}
			$ret_str.="<td style=\"width:165px;\" class=\"".$class2."\">";
			if(count($osinfo_vis_dis)>0){$ret_str.=$this->osLable(1); $ret_str.= str_replace($arr_find,$arr_repl,"&nbsp;".implode("&nbsp;",$osinfo_vis_dis));}
			$ret_str.="</td>";


			$haveValue = 0;
			if(( $visNeardateCheckpass==true) &&(($sel_vis_near_os_sel_1!="" && $txt_vis_near_os_txt_1!="" && $txt_vis_near_os_txt_1!="20/"))){
				$osinfo_vis_near[]="";
				$haveValue = 1;
				$osinfo_vis_near[]=($sel_vis_near_os_sel_1!="" && $txt_vis_near_os_txt_1!="20/")?$sel_vis_near_os_sel_1:"";
				$osinfo_vis_near[]=($sel_vis_near_os_sel_1!="" && $txt_vis_near_os_txt_1!="" && $txt_vis_near_os_txt_1!="20/")?"".$txt_vis_near_os_txt_1."":"";

				if(($sel_vis_near_od_sel_2!="" and $txt_vis_near_od_txt_2!="20/") || ($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/")){
					$osinfo_vis_near[]=($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/")?$sel_vis_near_os_sel_2:"";
					$osinfo_vis_near[]=($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="" && $txt_vis_near_os_txt_2!="20/")?"".$txt_vis_near_os_txt_2."":"";
				}
			 }
			elseif(($sel_vis_near_od_sel_2!="" and $txt_vis_near_od_txt_2!="20/") || ($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/")){
					$osinfo_vis_near[]=($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="20/")?$sel_vis_near_os_sel_2:"";
					$osinfo_vis_near[]=($sel_vis_near_os_sel_2!="" && $txt_vis_near_os_txt_2!="" && $txt_vis_near_os_txt_2!="20/")?"".$txt_vis_near_os_txt_2."":"";
			}
			$class3="";
			if($haveValue == 1){$class3="paddingLeft paddingTop10";}
			$ret_str.="<td class=\"".$class3."\" style=\"width:210px;\">";
			if($haveValue == 1){$ret_str.=$this->osLable(1); $ret_str.= str_replace($arr_find,$arr_repl,implode("&nbsp;",$osinfo_vis_near));}
			$ret_str.= "</td>";

			#start AR AK (OS)
			if($txt_vis_ar_os_s!="" || $txt_vis_ar_os_c!="" || $txt_vis_ar_os_a!=""){
					$osinfo_vis_ar[]="";
					if($txt_vis_ar_os_s!=""){
						$osinfo_vis_ar[]="S";
						$osinfo_vis_ar[]="".$txt_vis_ar_os_s."";
					}
					if($txt_vis_ar_os_c!=""){
						$osinfo_vis_ar[]="C";
						$osinfo_vis_ar[]="".$txt_vis_ar_os_c."";
					}
					if($txt_vis_ar_os_a!=""){
						$osinfo_vis_ar[]="A";
						$osinfo_vis_ar[]="".$txt_vis_ar_os_a."&#176; ";
						$osinfo_vis_ar[]="".$sel_vis_ar_os_sel_1."";

					}

			$ret_str.="<td class=\"paddingLeft paddingTop10\" style=\"width:200px;\">";
			$ret_str.= $this->osLable(1); $ret_str.= str_replace($arr_find,$arr_repl,implode("&nbsp;",$osinfo_vis_ar));
			$ret_str.="</td>";

			 }
			if($txt_vis_ak_os_k!="" ||$txt_vis_ak_os_slash!="" || $txt_vis_ak_os_x!=""){
			$osinfo_vis_ak[]="";
			if($txt_vis_ak_os_k!=""){$osinfo_vis_ak[]="K:"; }
			$osinfo_vis_ak[]="".$txt_vis_ak_os_k."";
			//if($txt_vis_ak_os_slash!=""){$osinfo_vis_ak[]="/";}
			$osinfo_vis_ak[]="/";
			$osinfo_vis_ak[]="".$txt_vis_ak_os_slash."";
			//if($txt_vis_ak_os_x!=""){$osinfo_vis_ak[]="X"; }
			$osinfo_vis_ak[]="X";
			if($txt_vis_ak_os_x!=""){$osinfo_vis_ak[]="".$txt_vis_ak_os_x."&#176;";}

			$ret_str.="<td class=\"paddingLeft paddingTop10\" style=\"width:155px;\">";
			$ret_str.= $this->osLable(1); $ret_str.= implode("&nbsp;",$osinfo_vis_ak);
			$ret_str.=" </td>";
			}
		  # End AR AK (OS)

			$ret_str.="</tr>";
			$ret_str.="<tr>";
			//=====VISION DISTANCE OU SECTION DATA FOR Complete Patient Record PRINTING==========
			if(($sel_vis_dis_ou_sel_1!="" && $txt_vis_dis_ou_txt_1!="20/" && $txt_vis_dis_ou_txt_1!="") ){
				if($sel_vis_dis_ou_sel_1!="" && $txt_vis_dis_ou_txt_1!="20/" && $txt_vis_dis_ou_txt_1!=""){
				$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_1!="" && $txt_vis_dis_ou_txt_1!="20/" && $txt_vis_dis_ou_txt_1!="")?$sel_vis_dis_ou_sel_1:"";
				$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_1!="" && $txt_vis_dis_ou_txt_1!="20/" && $txt_vis_dis_ou_txt_1!="")?"".$txt_vis_dis_ou_txt_1."":"";
				}
				if(($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/" && $txt_vis_dis_ou_txt_2!="")){
					$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/")?$sel_vis_dis_ou_sel_2:"";
					$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/")?"".$txt_vis_dis_ou_txt_2."" :"";
				}
			}
			elseif(($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/" && $txt_vis_dis_ou_txt_2!="")){
				$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/")?$sel_vis_dis_ou_sel_2:"";
				$ouinfo_vis_dis[]=($sel_vis_dis_ou_sel_2!="" && $txt_vis_dis_ou_txt_2!="20/")?"".$txt_vis_dis_ou_txt_2."" :"";
			}
			$class4="";
			if(count($ouinfo_vis_dis)>0){$class4="paddingTop10";}
			$ret_str.="<td style=\"width:165px;\" class=\"".$class4."\">";
			if(count($ouinfo_vis_dis)>0){$ret_str.=ouLable(1); $ret_str.= str_replace($arr_find,$arr_repl,"&nbsp;".implode("&nbsp;",$ouinfo_vis_dis));}
			$ret_str.="</td>";
			//=====================END TASK====================================================

			//=====VISION NEAR OU SECTION DATA FOR Complete Patient Record PRINTING==========
			if(($sel_vis_near_ou_sel_1!="" && $txt_vis_near_ou_txt_1!="20/" && $txt_vis_near_ou_txt_1!="") ){
				if($sel_vis_near_ou_sel_1!="" && $txt_vis_near_ou_txt_1!="20/" && $txt_vis_near_ou_txt_1!=""){
				$ouinfo_vis_near[]=($sel_vis_near_ou_sel_1!="" && $txt_vis_near_ou_txt_1!="20/" && $txt_vis_near_ou_txt_1!="")?$sel_vis_near_ou_sel_1:"";
				$ouinfo_vis_near[]=($sel_vis_near_ou_sel_1!="" && $txt_vis_near_ou_txt_1!="20/" && $txt_vis_near_ou_txt_1!="")?"".$txt_vis_near_ou_txt_1."":"";
				}
				if(($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/" && $txt_vis_near_ou_txt_2!="")){
					$ouinfo_vis_near[]=($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/")?$sel_vis_near_ou_sel_2:"";
					$ouinfo_vis_near[]=($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/")?"".$txt_vis_near_ou_txt_2."" :"";
				}
			}
			elseif(($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/" && $txt_vis_near_ou_txt_2!="")){
				$ouinfo_vis_near[]=($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/")?$sel_vis_near_ou_sel_2:"";
				$ouinfo_vis_near[]=($sel_vis_near_ou_sel_2!="" && $txt_vis_near_ou_txt_2!="20/")?"".$txt_vis_near_ou_txt_2."" :"";
			}

			//BELOW CONDITION IMPLEMENT BECAUSE WHEN NEAR OU HAVE DATA, DISTANCE OU IS EMPTY.. NEAR STARTED TO DISPLAY UNDER THE DISTANCE SECTION FROM.. FROM NOW AN EMPTY CELL WILL BE ADD BEFORE NEAR OU DATA, SO THAT NEAR OU DATA DISPLAY UNDER THE NEAR SECTION
			if(empty($ouinfo_vis_dis) && $ouinfo_vis_dis==0 && count($ouinfo_vis_near)>0)
			{
				$ret_str.="<td style=\"width:165px;\" class=\"".$class4."\">";
				$ret_str.="</td>";
			}
			//CONDITION END
			$class4="";
			if(count($ouinfo_vis_near)>0){$class4="paddingTop10";}
			$ret_str.="<td style=\"width:165px;\" class=\"".$class4."\">";
			if(count($ouinfo_vis_near)>0){$ret_str.=ouLable(1); $ret_str.= str_replace($arr_find,$arr_repl,"&nbsp;".implode("&nbsp;",$ouinfo_vis_near)); }
			$ret_str.="</td>";
				//=====================END TASK====================================================
			$ret_str.="</tr>";
			$ret_str.="</table></td></tr>";
			////Distance AR AK--

			//<!--Additional Acuity && BAT Start-->
			 if( 	$vis_dis_od_sel_3!="" || (!empty($vis_dis_od_txt_3) && $vis_dis_od_txt_3 !="20/" ) ||
				$vis_dis_os_sel_3 !="" || (!empty($vis_dis_os_txt_3) && $vis_dis_os_txt_3!="20/") ||
				$vis_dis_ou_sel_3 !="" || (!empty($vis_dis_ou_txt_3) && $vis_dis_ou_txt_3!="20/") ||
					($txt_vis_bat_nl_od!="" && $txt_vis_bat_nl_od!="20/")
					 ||($txt_vis_bat_low_od!="" && $txt_vis_bat_low_od!="20/" ) || ($txt_vis_bat_med_od!="" && $txt_vis_bat_med_od!="20/") ||($txt_vis_bat_high_od!="" && $txt_vis_bat_high_od!="20/")
					 ||($txt_vis_bat_low_os!="" && $txt_vis_bat_low_os!="20/") || ($txt_vis_bat_med_os!="" && $txt_vis_bat_med_os!="20/") || ($txt_vis_bat_high_os!="" && $txt_vis_bat_high_os!="20/")

					){


			$ret_str.="<tr><td style='width:100%;'><table style='width:100%;' cellspacing='0' cellpadding='0'>";
			$ret_str.=	"<tr>";
					if($vis_dis_od_sel_3!="" || (!empty($vis_dis_od_txt_3) && $vis_dis_od_txt_3 !="20/" ) ||
						$vis_dis_os_sel_3 !="" || (!empty($vis_dis_os_txt_3) && $vis_dis_os_txt_3!="20/") ||
						$vis_dis_ou_sel_3 !="" || (!empty($vis_dis_ou_txt_3) && $vis_dis_ou_txt_3!="20/")){
					$ret_str.="<td class=\"text_lable paddingTop10 bdrtop \"  style='width:50%;'>Additional Acuity</td>";
					$flg_shw_addac=1;
					}


					if(($txt_vis_bat_nl_od!="" && $txt_vis_bat_nl_od!="20/")||($txt_vis_bat_nl_os!="" && $txt_vis_bat_nl_os!="20/") ||($txt_vis_bat_nl_ou!="" && $txt_vis_bat_nl_ou!="20/") || $txt_vis_bat_nl_od || $txt_vis_bat_low_od || $txt_vis_bat_med_od || $txt_vis_bat_high_od|| $txt_vis_bat_nl_os || $txt_vis_bat_low_os || $txt_vis_bat_med_os || $txt_vis_bat_high_os || $txt_vis_bat_nl_ou || $txt_vis_bat_low_ou || $txt_vis_bat_med_ou || $txt_vis_bat_high_ou){
			$ret_str.="		<td class=\"text_lable paddingTop10 bdrtop\" style='width:370px;'>BAT</td>";
					$flg_shw_bat=1;
					 }


			$ret_str.="	</tr>";
			$ret_str.="	<tr>";
			         if(($vis_dis_ou_sel_3!=""  || (!empty($vis_dis_od_txt_3) && $vis_dis_od_txt_3 !="20/")))
					{
					    if(empty($vis_dis_ou_sel_3)) $vis_dis_od_sel_3="&nbsp;";
						if(empty($vis_dis_od_txt_3)) $vis_dis_od_txt_3="&nbsp;";

			$ret_str.="	<td class=\"paddingTop10\" style='width:50%;'>";
			$ret_str.= $this->odLable(1); $ret_str.="&nbsp;".$vis_dis_ou_sel_3." ".$vis_dis_od_txt_3;
			$ret_str.="</td>";
					}else if(!empty($flg_shw_addac) && !empty($flg_shw_bat)){$ret_str.="	<td class=\"paddingTop10\" style='width:50%;'></td>";}


					if(($txt_vis_bat_nl_od!="" && $txt_vis_bat_nl_od!="20/") ||($txt_vis_bat_low_od!="" && $txt_vis_bat_low_od!="20/" ) || ($txt_vis_bat_med_od!="" && $txt_vis_bat_med_od!="20/") ||($txt_vis_bat_high_od!="" && $txt_vis_bat_high_od!="20/")){
					  $odinfo_vis_bat[]="";
					 if($txt_vis_bat_nl_od!="" && $txt_vis_bat_nl_od!="20/" ){$odinfo_vis_bat[]="NL"; }
					 if($txt_vis_bat_nl_od!="" && $txt_vis_bat_nl_od!="20/"){ $odinfo_vis_bat[]="".$txt_vis_bat_nl_od.""; }
					 if($txt_vis_bat_low_od!="" && $txt_vis_bat_low_od!="20/" ){$odinfo_vis_bat[]="L"; }
					 if($txt_vis_bat_low_od!="" && $txt_vis_bat_low_od!="20/"){$odinfo_vis_bat[]="".$txt_vis_bat_low_od.""; }
					 if($txt_vis_bat_med_od!="" && $txt_vis_bat_med_od!="20/"){$odinfo_vis_bat[]= "M"; }
					 if($txt_vis_bat_med_od!="" && $txt_vis_bat_med_od!="20/"){$odinfo_vis_bat[]="".$txt_vis_bat_med_od.""; }
					 if($txt_vis_bat_high_od!="" && $txt_vis_bat_high_od!="20/"){$odinfo_vis_bat[]="H"; }
					 if($txt_vis_bat_high_od!="" && $txt_vis_bat_high_od!="20/" ){ $odinfo_vis_bat[]="".$txt_vis_bat_high_od."";}

			$ret_str.="<td class=\"paddingLeft paddingTop10\" style='width:50%;'>";
			$ret_str.= $this->odLable(1); $ret_str.= implode("&nbsp;",$odinfo_vis_bat);
			$ret_str.="</td>";
					 }
			$ret_str.="	</tr>";

			$ret_str.="	<tr>";
			if(($vis_dis_ou_sel_3 !="" && (!empty($vis_dis_os_txt_3) &&  $vis_dis_os_txt_3!="20/"))){
			    if(empty($vis_dis_ou_sel_3))$vis_dis_os_sel_3="&nbsp;";
					if(empty($vis_dis_os_txt_3))$vis_dis_os_txt_3="&nbsp;";

			$ret_str.="<td class=\"paddingLeft paddingTop10\" style='width:50%;'>";
			$ret_str.= $this->osLable(1); $ret_str.="&nbsp;".$vis_dis_ou_sel_3." ".$vis_dis_os_txt_3;
			$ret_str.="</td>";
					 }else if(!empty($flg_shw_addac) && !empty($flg_shw_bat)){$ret_str.="	<td class=\"paddingTop10\" style='width:50%;'></td>";}

					if(($txt_vis_bat_nl_os!="" && $txt_vis_bat_nl_os!="20/") || ($txt_vis_bat_low_os!="" && $txt_vis_bat_low_os!="20/") || ($txt_vis_bat_med_os!="" && $txt_vis_bat_med_os!="20/") || ($txt_vis_bat_high_os!="" && $txt_vis_bat_high_os!="20/")){
					$ouinfo_vis_bat[]="";
					if($txt_vis_bat_nl_os!="" && $txt_vis_bat_nl_os!="20/"){$ouinfo_vis_bat[]="NL"; }
					if($txt_vis_bat_nl_os!="" && $txt_vis_bat_nl_os!="20/" ){ $ouinfo_vis_bat[]="".$txt_vis_bat_nl_os."";}
					if($txt_vis_bat_low_os!="" && $txt_vis_bat_low_os!="20/"){$ouinfo_vis_bat[]="L"; }
					if($txt_vis_bat_low_os!="" && $txt_vis_bat_low_os!="20/" ){$ouinfo_vis_bat[]="".$txt_vis_bat_low_os."";}
					if($txt_vis_bat_med_os!="" && $txt_vis_bat_med_os!="20/"){$ouinfo_vis_bat[]="M";}
					if($txt_vis_bat_med_os!="" && $txt_vis_bat_med_os!="20/" ){ $ouinfo_vis_bat[]="".$txt_vis_bat_med_os."";}
					if($txt_vis_bat_high_os!="" && $txt_vis_bat_high_os!="20/"){$ouinfo_vis_bat[]="H"; }
					if($txt_vis_bat_high_os!="" && $txt_vis_bat_high_os!="20/" ){ $ouinfo_vis_bat[]="".$txt_vis_bat_high_os."";}

					$ret_str.="<td class=\"paddingLeft paddingTop10\" style='width:50%'>";
					$ret_str.= $this->osLable(1); $ret_str.= implode("&nbsp;",$ouinfo_vis_bat);
					$ret_str.="</td>";
					 }
			$ret_str.="	</tr>";

			//BAT OU--
			$ret_str.="	<tr>";
					if(($vis_dis_ou_sel_3 !="" || (!empty($vis_dis_ou_txt_3) && $vis_dis_ou_txt_3!="20/"))){
					if(empty($vis_dis_ou_sel_3))$vis_dis_ou_sel_3="&nbsp;";
					if(empty($vis_dis_ou_txt_3))$vis_dis_ou_txt_3="&nbsp;";

			$ret_str.="<td class=\"paddingLeft paddingTop10\" style='width:50%;'>";
			$ret_str.= $this->ouLable(1); $ret_str.="&nbsp;".$vis_dis_ou_sel_3." ".$vis_dis_ou_txt_3;
			$ret_str.="</td>";
					 }else if(!empty($flg_shw_addac) && !empty($flg_shw_bat)){$ret_str.="	<td class=\"paddingTop10\" style='width:50%;'></td>";}

					if(($txt_vis_bat_nl_ou!="" && $txt_vis_bat_nl_ou!="20/") || ($txt_vis_bat_low_ou!="" && $txt_vis_bat_low_ou!="20/") || ($txt_vis_bat_med_ou!="" && $txt_vis_bat_med_ou!="20/") || ($txt_vis_bat_high_ou!="" && $txt_vis_bat_high_ou!="20/")){
					$osinfo_vis_bat[]="";
					if($txt_vis_bat_nl_ou!="" && $txt_vis_bat_nl_ou!="20/"){$osinfo_vis_bat[]="NL"; }
					if($txt_vis_bat_nl_ou!="" && $txt_vis_bat_nl_ou!="20/" ){ $osinfo_vis_bat[]="".$txt_vis_bat_nl_ou."";}
					if($txt_vis_bat_low_ou!="" && $txt_vis_bat_low_ou!="20/"){$osinfo_vis_bat[]="L"; }
					if($txt_vis_bat_low_ou!="" && $txt_vis_bat_low_ou!="20/" ){$osinfo_vis_bat[]="".$txt_vis_bat_low_ou."";}
					if($txt_vis_bat_med_ou!="" && $txt_vis_bat_med_ou!="20/"){$osinfo_vis_bat[]="M";}
					if($txt_vis_bat_med_ou!="" && $txt_vis_bat_med_ou!="20/" ){ $osinfo_vis_bat[]="".$txt_vis_bat_med_ou."";}
					if($txt_vis_bat_high_ou!="" && $txt_vis_bat_high_ou!="20/"){$osinfo_vis_bat[]="H"; }
					if($txt_vis_bat_high_ou!="" && $txt_vis_bat_high_ou!="20/" ){ $osinfo_vis_bat[]="".$txt_vis_bat_high_ou."";}

					$ret_str.="<td class=\"paddingLeft paddingTop10\" style='width:50%;'>";
					$ret_str.= $this->ouLable(1); $ret_str.= implode("&nbsp;",$osinfo_vis_bat);
					$ret_str.="</td>";
					 }
			$ret_str.="	</tr>";
			//BAT OU--

			$ret_str.="</table></td></tr>";
			}
			//<!--Additional Acuity && BAT End-->



			//CycLo AR ----
			if($visCycArOdS || $visCycArOdC || $visCycArOdA || $visCycArOdSel1 ||
				$visCycArOsS || $visCycArOsC || $visCycArOsA || $visCycArOsSel1 || $visCycArDesc){
				$ret_str.="";
				$ret_str.=	"<tr>";
				$ret_str.="<td style='width:700px;' class=\"text_lable paddingTop10\">Cycloplegic AR</td>";
				$ret_str.="	</tr>";
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.= $this->odLable(1);
				$ret_str.="&nbsp;".$visCycArOdS." ".$visCycArOdC." ".$visCycArOdA." ".$visCycArOdSel1;
				$ret_str.="</td>";
				$ret_str.="	</tr>";

				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.= $this->osLable(1);
				$ret_str.="&nbsp;".$visCycArOsS." ".$visCycArOsC." ".$visCycArOsA." ".$visCycArOsSel1;
				$ret_str.="</td>";
				$ret_str.="	</tr>";

				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.="<b>Cycloplegic AR Desc.:</b>&nbsp;".htmlentities($visCycArDesc);
				$ret_str.="</td>";
				$ret_str.="	</tr>";

				$ret_str.="";

			}
			//CycLo AR ----

			if($txt_vis_dis_desc!="" )
			{
			$ret_str.="";
			$ret_str.="<tr>";
			$ret_str.="<td style='width:width:100%;' class='paddingTop10'>Distance Desc.&nbsp;".$txt_vis_dis_desc;
			$ret_str.="</td>";
			$ret_str.="</tr>";
			$ret_str.="";
			}
			if($txt_vis_near_desc!="" )
			{
			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="	<td style='width:100%;' class='paddingTop10'>Near Desc.&nbsp;".$txt_vis_near_desc."</td>";
			$ret_str.="	</tr>";
			$ret_str.="";
			}
			if($txt_vis_bat_desc!="" ){

			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="	<td style='width:100%;' class='paddingTop10'><b>B.A.T Desc.</b>&nbsp;". $txt_vis_bat_desc."</td>";
			$ret_str.="	</tr>";
			$ret_str.="";

			}

			if($vis_dis_act_3!="" ){

			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="	<td class='paddingTop10'><b>Acuity Desc.:</b>&nbsp;". $vis_dis_act_3."</td>";
			$ret_str.="	</tr>";
			$ret_str.="	";

			}

			//PAM ---
			if(!empty($visPam) || (!empty($vis_pam_od_txt_1) || !empty($vis_pam_os_txt_1) || !empty($vis_pam_ou_txt_1) || !empty($vis_pam_od_sel_2)||
				!empty($vis_pam_od_txt_2) || !empty($vis_pam_os_txt_2) || !empty($vis_pam_ou_txt_2) || !empty($vis_pam_desc))){
				$ret_str.="";
				$ret_str.=	"<tr>";
				$ret_str.="<td style='width:700px;' class=\"text_lable paddingTop10\">PAM</td>";
				$ret_str.="	</tr>";
				if(!empty($visPam) || !empty($vis_pam_od_sel_2)){
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.="&nbsp;".$visPam."&nbsp;&nbsp;&nbsp; P<sub>SC</sub>:".$vis_pam_od_sel_2;
				$ret_str.="</td>";
				$ret_str.="	</tr>";
				}
				if(!empty($vis_pam_od_txt_1) || !empty($vis_pam_od_txt_2)){
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.= $this->odLable(1);
				$ret_str.="&nbsp;".$vis_pam_od_txt_1." ".$vis_pam_od_txt_2;
				$ret_str.="</td>";
				$ret_str.="	</tr>";
				}
				if(!empty($vis_pam_os_txt_1) || !empty($vis_pam_os_txt_2)){
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.= $this->osLable(1);
				$ret_str.="&nbsp;".$vis_pam_os_txt_1." ".$vis_pam_os_txt_2;
				$ret_str.="</td>";
				$ret_str.="	</tr>";
				}
				if(!empty($vis_pam_ou_txt_1) || !empty($vis_pam_ou_txt_2)){
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.= $this->ouLable(1);
				$ret_str.="&nbsp;".$vis_pam_ou_txt_1." ".$vis_pam_ou_txt_2;
				$ret_str.="</td>";
				$ret_str.="	</tr>";
				}

				if(!empty($vis_pam_desc)){
				$ret_str.="	<tr>";
				$ret_str.="	<td style='width:700px;' class=\"paddingTop10\">";
				$ret_str.="<b>PAM Desc.:</b>&nbsp;".$vis_pam_desc;
				$ret_str.="</td>";
				$ret_str.="	</tr>";
				}

				$ret_str.="";

			}

			//PAM ---

			//<!-- Vision Table Row 2-->

			$vis_arCheckpass=false;
			if($date_of_service!="" || $txt_vis_ar_ak_examdate!="" || $txt_vis_ar_ak_examdate!=0){
				$startar = $this->FormatDate_insert($date_of_service);
				$endar = $txt_vis_ar_ak_examdate;
			if($startar==$endar){
				$vis_arCheckpass=true;
			}
			if($diff=@$this->get_time_difference($startar, $endar)){
				$vis_arCheckpass=true;
			}
			}


			if($txt_vis_ar_ak_desc!="" && $vis_arCheckpass==true ){

			$ret_str.="";
			$ret_str.="<tr>";
			$ret_str.="	<td class='paddingTop10'>";
				 if($txt_vis_ar_ak_desc!=""){
					$ret_str.="<span class=\"text_lable\">AR Desc.&nbsp;</span>".str_ireplace('<OD','&lt;OD',$txt_vis_ar_ak_desc);
				}
			$ret_str.="	</td>";
			$ret_str.="	</tr>	";
			$ret_str.="";

			}


			if($txt_vis_AK_desc!="" && $vis_arCheckpass==true )
			{
			$ret_str.="";
			$ret_str.="<tr>";
			$ret_str.="<td class='paddingTop10'>";
			if($txt_vis_AK_desc!=""){$ret_str.="<span class=\"text_lable\">AK Desc.&nbsp;</span>".$txt_vis_AK_desc;}
			$ret_str.="</td>";
			$ret_str.="</tr>";
			$ret_str.="";

			}

			// Start PC Code//

			//<!-- Initial -->
			if(!isset($arrTempProc)||in_array("PC 1",$arrTempProc)){
			if(($sel_vis_pc_od_sel_1!="" || $sel_vis_pc_os_sel_1!="") || ($txt_vis_pc_od_s!=""||$txt_vis_pc_od_c!=""||$txt_vis_pc_od_a!="" || $txt_vis_pc_od_add!="" || $txt_vis_pc_os_s!=""||$txt_vis_pc_os_c!="" || $txt_vis_pc_os_a!="" || $txt_vis_pc_os_add!="")){

			//<!-- 1st PC -->
			$ret_str.="<tr>
						<td style='width:740px;'>
							<table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="  <tr>";
			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:210px;\">PC 1st</td>";
			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:130px;\">&nbsp;</td>";

				$prismTxt = '';
				if($elem_prismPc1 && ($sel_vis_pc_od_sel_2!="" && $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" && $sel_vis_pc_os_slash != "") ||
								($sel_vis_pc_od_sel_2_2!="" && $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" && $sel_vis_pc_os_slash_2 != "") ||
								($sel_vis_pc_od_sel_2_3!="" && $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" && $sel_vis_pc_os_slash_3 != "")
								){
					$prismTxt = 'Prism';
				}

				$overRefractionTxt = "";
				$overRefractionOD ="";
				if($chk_pc_near != "Near" && $txt_vis_pc_os_overref_s!="" || $txt_vis_pc_os_overref_c!="" || $txt_vis_pc_os_overref_a!="" || $txt_vis_pc_os_overref_v!="" || ($txt_vis_pc_od_overref_v!="" && $txt_vis_pc_od_overref_v!="20/")){
					$overRefractionTxt = "Over Refraction";
					$overRefractionOD =$this->odLable(1);
				}
			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:170px;\">".$prismTxt."</td>";
			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:220px;\">".$overRefractionTxt."</td>";

			$ret_str.="  </tr>";
			//  <!-- OD -->
			$ret_str.="  <tr>";

				$pc1gp1_od[]="";
				$pc1gp1_os[]="";
				$pc1gp2_addod[]="";
				$pc1gp2_addos[]="";
				$pc1gp3_prismod[]="";
				$pc1gp3_prismos[]="";
				/*$pc1gp1_od[]="OD";*/

				if(($sel_vis_pc_od_sel_1!="" && $txt_vis_pc_od_s!="" || ($sel_vis_pc_os_sel_1!="" && $txt_vis_pc_os_s!="")) ||
				($sel_vis_pc_od_sel_1_2!="" && $txt_vis_pc_od_s_2!="" || ($sel_vis_pc_os_sel_1_2!="" && $txt_vis_pc_os_s_2!="")) ||
				($sel_vis_pc_od_sel_1_3!="" && $txt_vis_pc_od_s_3!="" || ($sel_vis_pc_os_sel_1_3!="" && $txt_vis_pc_os_s_3!=""))
				){
					$pc1gp1_od[]="$sel_vis_pc_od_sel_1";

				}
				if(($txt_vis_pc_od_s!="" || $txt_vis_pc_os_s!="") ||
				($txt_vis_pc_od_s_2!="" || $txt_vis_pc_os_s_2!="") ||
				($txt_vis_pc_od_s_3!="" || $txt_vis_pc_os_s_3!="")
				){
					if($txt_vis_pc_od_s!=""){$pc1gp1_od[]="S"; }
					$pc1gp1_od[]="$txt_vis_pc_od_s";

				}
				if(($txt_vis_pc_od_c!="" || $txt_vis_pc_os_c!="") ||
				($txt_vis_pc_od_c_2!="" || $txt_vis_pc_os_c_2!="") ||
				($txt_vis_pc_od_c_3!="" || $txt_vis_pc_os_c_3!="")
				){
					if($txt_vis_pc_od_c!=""){$pc1gp1_od[]="C" ; }
					$pc1gp1_od[]="$txt_vis_pc_od_c";
				}
				if(($txt_vis_pc_od_a!="" || $txt_vis_pc_os_a!="") ||
				($txt_vis_pc_od_a_2!="" || $txt_vis_pc_os_a_2!="") ||
				($txt_vis_pc_od_a_3!="" || $txt_vis_pc_os_a_3!="")
				){
					 if($txt_vis_pc_od_a!="" ){$pc1gp1_od[]="A"; }
					 if($txt_vis_pc_od_a!="" ){ $pc1gp1_od[]="".$txt_vis_pc_od_a."&#176;";}
				}

			$ret_str.="<td class=\"paddingTop10\" style='width:210px;'>".$this->odLable(1)."".implode("&nbsp;",$pc1gp1_od)."</td>";

				if(
				($txt_vis_pc_od_add!="" and ($txt_vis_pc_od_s!="" || $txt_vis_pc_od_c!="" || $txt_vis_pc_od_a!=""))
				){
					$pc1gp2_addod[]="Add";
					$pc1gp2_addod[]="$txt_vis_pc_od_add";
				}
			$ret_str.="    <td class=\"paddingTop10\" style='width:130px;'>".implode("&nbsp;",$pc1gp2_addod)."</td>";

				if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
					if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
					($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
					($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
					){
					 $pc1gp3_prismod[]=(!empty($sel_vis_pc_od_p)) ? "P" : "";

					$pc1gp3_prismod[]="$sel_vis_pc_od_p";

					}
					if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
					($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
					($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
					){
						$pc1gp3_prismod[]=(!empty($sel_vis_pc_od_sel_2) || !empty($sel_vis_pc_od_slash)) ? "<img src=\"".$src_pic_vision_pc."\"  align=\"top\"/>" : "";
					if(!empty($sel_vis_pc_od_sel_2) || !empty($sel_vis_pc_od_slash)){$pc1gp3_prismod[]="$sel_vis_pc_od_sel_2";}
					}

					if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
					($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
					($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
					){

						//$pc1gp3_prismod[]=(!empty($sel_vis_pc_od_slash)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
						$pc1gp3_prismod[]=(!empty($sel_vis_pc_od_slash)) ? "/" : "";
						$pc1gp3_prismod[]="$sel_vis_pc_od_slash";

					}
					if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
					(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
					(($sel_vis_pc_od_prism_3!=""  || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
					){

						$pc1gp3_prismod[]="$sel_vis_pc_od_prism";

					}

				}

				$ret_str.=" <td class=\"paddingTop10\" style='width:170px;'>". implode("&nbsp;",$pc1gp3_prismod)."</td>";

				if($sel_vis_pc_od_sel_1!="" || ($txt_vis_pc_od_s!=""||$txt_vis_pc_od_c!=""||$txt_vis_pc_od_a!="" || $txt_vis_pc_od_add!="" ||$txt_vis_pc_od_s!=""||$txt_vis_pc_os_c!=""||$txt_vis_pc_os_a!="" || $txt_vis_pc_os_add!="")){
					$overrefraction1od[]="";
					if($chk_pc_near == "Near"){
						 if($txt_vis_pc_od_near_txt!=""){$overrefraction1od[]="OD"; }
						 $overrefraction1od[]="$txt_vis_pc_od_near_txt";
						 $ret_str.="<td style='width:170px;'></td>";
					}else{
						 if($txt_vis_pc_od_overref_s!="" || $txt_vis_pc_od_overref_c!="" || $txt_vis_pc_od_overref_a!="" || $txt_vis_pc_od_overref_v!="" ){/*$overrefraction1od[]="OD";*/}
						 if($txt_vis_pc_od_overref_s!=""){ $overrefraction1od[]="S";}
						 $overrefraction1od[]="".trim($txt_vis_pc_od_overref_s)."";
						 if($txt_vis_pc_od_overref_c!=""){ $overrefraction1od[]="C";}
						 $overrefraction1od[]="".trim($txt_vis_pc_od_overref_c)."";
						 if($txt_vis_pc_od_overref_a!=""){ $overrefraction1od[]="A";}
						 $overrefraction1od[]="".trim($txt_vis_pc_od_overref_a)."";
						 if($txt_vis_pc_od_overref_v!="" && $txt_vis_pc_od_overref_v!="20/"){ $overrefraction1od[]="V";}
						 if($txt_vis_pc_od_overref_v!="" && $txt_vis_pc_od_overref_v!="20/" ){ $overrefraction1od[]="".trim($txt_vis_pc_od_overref_v)."";}

			   $ret_str.="<td class=\"paddingTop10\" style='width:220px;'>".$overRefractionOD." ".implode("&nbsp;",$overrefraction1od)."</td>";

				}

			//	<!-- Prism -->
			$ret_str.="	</tr>";
			$ret_str.="	<tr>";

				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="")||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
				){
					$pc1gp1_os[]="$sel_vis_pc_os_sel_1";
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="")||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
				){
					if($txt_vis_pc_os_s!="" || $sel_vis_pc_os_sel_1!=""){
						$pc1gp1_os[]="S";
						$pc1gp1_os[]="$txt_vis_pc_os_s";
					}
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_c!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_c_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_c_3!="")
				){
					if($txt_vis_pc_os_c!="" || $sel_vis_pc_os_sel_1!=""){
						$pc1gp1_os[]="C";
						$pc1gp1_os[]="$txt_vis_pc_os_c";
					}
				}
				if(
					($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_a!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_a_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_a_3!="")
				){
					 if($txt_vis_pc_os_a!="" || $sel_vis_pc_os_sel_1!=""){
						$pc1gp1_os[]="A";
						$pc1gp1_os[]="".$txt_vis_pc_os_a."&#176;";
					 }
				}

			$ret_str.="		<td class='paddingTop10' style='width:210px;'>". $this->osLable(1)."". implode("&nbsp;",$pc1gp1_os)."</td>";

				if(
				($txt_vis_pc_os_add!="" || ($txt_vis_pc_os_s!="" || $txt_vis_pc_os_c!="" || $txt_vis_pc_os_a!=""))
				){
				 if(strlen($txt_vis_pc_os_add)<>1){
					$pc1gp2_addos[]="Add";
					$pc1gp2_addos[]="$txt_vis_pc_os_add";
				}
				}
			$ret_str.="		<td class='paddingTop10' style='width:130px;'>". implode("&nbsp;",$pc1gp2_addos)."</td>";

				if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
				if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
				($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
				($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
				){
					$pc1gp3_prismos[]=(!empty($sel_vis_pc_os_p)) ? "P" : "";
					$pc1gp3_prismos[]="$sel_vis_pc_os_p";

				}
				if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
				($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
				($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
				)

				{
					$pc1gp3_prismos[]=(!empty($sel_vis_pc_os_sel_2) || !empty($sel_vis_pc_os_slash)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
					if(!empty($sel_vis_pc_os_sel_2) || !empty($sel_vis_pc_os_slash)){$pc1gp3_prismos[]="$sel_vis_pc_os_sel_2";}
				}
				if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
				($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
				($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
				){

					//$pc1gp3_prismos[]=(!empty($sel_vis_pc_os_slash)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
					$pc1gp3_prismos[]=(!empty($sel_vis_pc_os_slash)) ? "/" : "";
					$pc1gp3_prismos[]="$sel_vis_pc_os_slash";

				}
				if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
				(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
				(($sel_vis_pc_od_prism_3!=""  || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
				){

					$pc1gp3_prismos[]="$sel_vis_pc_os_prism";

				}

				}

				$ret_str.="	<td class='paddingTop10' style='width:170px;'>". implode("&nbsp;",$pc1gp3_prismos)."</td>";
				$haveValue=0;
				if($sel_vis_pc_os_sel_1!="" || ($txt_vis_pc_os_s!=""||$txt_vis_pc_os_c!=""||$txt_vis_pc_os_a!="" || $txt_vis_pc_os_add!="")){
					$overrefraction1os[]="";
					if($chk_pc_near == "Near"){
						 if($txt_vis_pc_os_near_txt!=""){
							//$overrefraction1os[]="OS";
							//$overrefraction1os[]="$txt_vis_pc_os_near_txt";
						 }
					}else{
						$haveValue=0;
						if($txt_vis_pc_os_overref_s!="" || $txt_vis_pc_os_overref_c!="" || $txt_vis_pc_os_overref_a!="" || $txt_vis_pc_os_overref_v!=""){
							$haveValue=1;
						}
						if($txt_vis_pc_os_overref_s!=""){
							$overrefraction1os[]="S";
							$overrefraction1os[]="".trim($txt_vis_pc_os_overref_s)."";
						}
						if($txt_vis_pc_os_overref_c!=""){
							$overrefraction1os[]="C";
							$overrefraction1os[]="".trim($txt_vis_pc_os_overref_c)."";
						}
						if($txt_vis_pc_os_overref_a!=""){
							$overrefraction1os[]="A";
							$overrefraction1os[]="".trim($txt_vis_pc_os_overref_a)."";
						}
						if($txt_vis_pc_os_overref_v!="" && $txt_vis_pc_os_overref_v!="20/" ){
							$overrefraction1os[]="V";
							$overrefraction1os[]="". trim($txt_vis_pc_os_overref_v)."";
						}
					}

				$ret_str.="	<td class='paddingTop10' style='width:220px;'>";
				if($haveValue==1){
					$ret_str.=$this->osLable(1); $ret_str.=implode("&nbsp;",$overrefraction1os);
				}
				$ret_str.="</td>";

				}

				$ret_str.="</tr>";
				//  <!-- OS -->

				}else{
				$ret_str.="</tr>";

				}
				if(($sel_vis_pc_od_sel_1!="" || $sel_vis_pc_os_sel_1!="") || ($txt_vis_pc_od_s!=""||$txt_vis_pc_od_c!=""||$txt_vis_pc_od_a!="" || $txt_vis_pc_od_add!="" || $txt_vis_pc_os_s!=""||$txt_vis_pc_os_c!="" || $txt_vis_pc_os_a!="" || $txt_vis_pc_os_add!="")){

				$ret_str.="</table></td></tr>";
				}
			}

			if($txt_vis_pc_desc!="" ){
			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="	<td style='width:740px;' class='paddingTop10 text_lable'>";
						 if($txt_vis_pc_desc!=""){$ret_str.="PC 1st Desc.&nbsp;". htmlentities($txt_vis_pc_desc);}
			$ret_str.="	</td>";
			$ret_str.="	</tr>	";
			$ret_str.="";
			}
			}//PC 1
			//<!--End 1st PC -->

			//<!-- 2nd PC -->
			if(!isset($arrTempProc)||in_array("PC 2",$arrTempProc)){
			if(($sel_vis_pc_od_sel_1_2!="" || $sel_vis_pc_os_sel_1_2!="") || ($txt_vis_pc_od_s_2!=""||$txt_vis_pc_od_c_2!=""||$txt_vis_pc_od_a_2!="" || $txt_vis_pc_od_add_2!="" || $txt_vis_pc_os_s_2!=""||$txt_vis_pc_os_c_2!=""||$txt_vis_pc_os_a_2!="" || $txt_vis_pc_os_add_2!="")){

			//<!-- Start 2nd PC -->
			$ret_str.="<tr>
						<td style='width:740px;'>
						<table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="	<tr>";
			$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:210px;\">PC 2nd</td>";
			$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:130px;\">&nbsp;</td>";

						$prismTxt2 = '';
						if((($sel_vis_pc_od_prism!="" && $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" && $sel_vis_pc_os_p != "")) ||
						(($sel_vis_pc_od_prism_2!=""  && $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  && $sel_vis_pc_os_p_2 != "")) ||
						(($sel_vis_pc_od_prism_3!="" && $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  && $sel_vis_pc_os_p_3 != ""))
						){
							$prismTxt2 = 'Prism';
						}

						$overRefractionTxt2 = "";
						$odLabelOverR="";
						if($chk_pc_near_2!="Near" && ($txt_vis_pc_od_overref_v_2!="" && $txt_vis_pc_od_overref_v_2!="20/" )||($txt_vis_pc_od_overref_s_2!="" || $txt_vis_pc_od_overref_c_2!="" || $txt_vis_pc_od_overref_a_2!="")||($txt_vis_pc_os_overref_s_2!="" || $txt_vis_pc_os_overref_c_2!="" )||($txt_vis_pc_os_overref_v_2!="" && $txt_vis_pc_os_overref_v_2!="20/")){
							$overRefractionTxt2 = "Over Refraction";
							 $odLabelOverR=$this->osLable(1);
						}

			$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:170px;\">". $prismTxt2."</td>";
			$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:220px;\">". $overRefractionTxt2."</td>";
			$ret_str.="	</tr>";
			//	<!-- OD -->
			$ret_str.="	<tr>";

					$pc2gp1_od[]="";
					$pc2gp1_os[]="";
					$pc2gp2_addod[]="";
					$pc2gp2_addos[]="";
					$pc2gp3_prismod[]="";
					$pc2gp3_prismos[]="";
					if(($sel_vis_pc_od_sel_1!="" && $txt_vis_pc_od_s!="" || ($sel_vis_pc_os_sel_1!="" && $txt_vis_pc_os_s!="")) ||
					($sel_vis_pc_od_sel_1_2!="" && $txt_vis_pc_od_s_2!="" || ($sel_vis_pc_os_sel_1_2!="" && $txt_vis_pc_os_s_2!="")) ||
					($sel_vis_pc_od_sel_1_3!="" && $txt_vis_pc_od_s_3!="" || ($sel_vis_pc_os_sel_1_3!="" && $txt_vis_pc_os_s_3!=""))
					){
						$pc2gp1_od[]="$sel_vis_pc_od_sel_1_2";
					}
					if(($txt_vis_pc_od_s!="" || $txt_vis_pc_os_s!="") ||
					($txt_vis_pc_od_s_2!="" || $txt_vis_pc_os_s_2!="") ||
					($txt_vis_pc_od_s_3!="" || $txt_vis_pc_os_s_3!="")
					){
						if($txt_vis_pc_od_s_2!=""){$pc2gp1_od[]="S"; }
						$pc2gp1_od[]="$txt_vis_pc_od_s_2";
					}
					if(($txt_vis_pc_od_c!="" || $txt_vis_pc_os_c!="") ||
					($txt_vis_pc_od_c_2!="" || $txt_vis_pc_os_c_2!="") ||
					($txt_vis_pc_od_c_3!="" || $txt_vis_pc_os_c_3!="")
					){
						if($txt_vis_pc_od_c_2!=""){$pc2gp1_od[]="C"; }
						$pc2gp1_od[]="$txt_vis_pc_od_c_2";
					}
					if(($txt_vis_pc_od_a!="" || $txt_vis_pc_os_a!="") ||
					($txt_vis_pc_od_a_2!="" || $txt_vis_pc_os_a_2!="") ||
					($txt_vis_pc_od_a_3!="" || $txt_vis_pc_os_a_3!="")
					){
						 if($txt_vis_pc_od_a_2!="" ){$pc2gp1_od[]="A"; }
						 if($txt_vis_pc_od_a_2!="" ){ $pc2gp1_od[]="".$txt_vis_pc_od_a_2."&#176;";}
					}

					$ret_str.="	<td class='paddingTop10' style='width:210px;'>".$this->odLable(1)."".implode("&nbsp;",$pc2gp1_od)."</td>";

					if(
						($txt_vis_pc_od_add_2!="" and ($txt_vis_pc_od_s_2!="" || $txt_vis_pc_od_c_2!="" || $txt_vis_pc_od_a_2!=""))
					){
						 $pc2gp2_addod[]="Add";
						 $pc2gp2_addod[]="$txt_vis_pc_od_add_2";
					}

					$ret_str.="	<td class='paddingTop10' style='width:130px;'>". implode("&nbsp;",$pc2gp2_addod)."</td>";

					if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
						if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
						($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
						($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
						){
							$pc2gp3_prismod[]= (!empty($sel_vis_pc_od_p_2)) ? "P" : "";
							$pc2gp3_prismod[]="$sel_vis_pc_od_p_2";
						}
						if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
						($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
						($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
						){
							$pc2gp3_prismod[]=(!empty($sel_vis_pc_od_sel_2_2) || !empty($sel_vis_pc_od_slash_2)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
							if(!empty($sel_vis_pc_od_sel_2_2) || !empty($sel_vis_pc_od_slash_2)){$pc2gp3_prismod[]="$sel_vis_pc_od_sel_2_2";}
						}
						if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
						($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
						($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
						){
							//$pc2gp3_prismod[]= (!empty($sel_vis_pc_od_slash_2)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
							$pc2gp3_prismod[]= (!empty($sel_vis_pc_od_slash_2)) ? "/" : "";
							$pc2gp3_prismod[]="$sel_vis_pc_od_slash_2";
						}
						if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
						(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
						(($sel_vis_pc_od_prism_3!="" || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
						){
							$pc2gp3_prismod[]="$sel_vis_pc_od_prism_2";
						}

					}

					$ret_str.="<td class='paddingTop10' style='width:170px;'>". implode("&nbsp;",$pc2gp3_prismod)."</td>";

			$haveValue=0;
			if($sel_vis_pc_od_sel_1_2!="" ||($txt_vis_pc_od_s_2!=""||$txt_vis_pc_od_c_2!=""||$txt_vis_pc_od_a_2!="" || $txt_vis_pc_od_add_2!="")){
				$overrefraction2od[]="";
				if($chk_pc_near_2=="Near"){
					if($txt_vis_pc_od_near_txt_2!=""){
						$overrefraction2od[]="OD";
						$overrefraction2od[]="$txt_vis_pc_od_near_txt_2";
					}
				}else{
					 if($txt_vis_pc_od_overref_s_2!="" || $txt_vis_pc_od_overref_c_2!="" || $txt_vis_pc_od_overref_a_2!="" || $txt_vis_pc_od_overref_v_2!="" ){
						$haveValue=1;
					 }
					 if($txt_vis_pc_od_overref_s_2!=""){
						$overrefraction2od[]="S";
						$overrefraction2od[]="$txt_vis_pc_od_overref_s_2";
					 }
					 if($txt_vis_pc_od_overref_c_2!=""){
						$overrefraction2od[]="C";
						$overrefraction2od[]="$txt_vis_pc_od_overref_c_2";
					 }
					 if($txt_vis_pc_od_overref_a_2!=""){
						$overrefraction2od[]="A";
						 $overrefraction2od[]="$txt_vis_pc_od_overref_a_2";
					 }
					 if($txt_vis_pc_od_overref_v_2!="" && $txt_vis_pc_od_overref_v_2!="20/"){
						$overrefraction2od[]="V" ;
						$overrefraction2od[]=" $txt_vis_pc_od_overref_v_2";
					}
				}

				$ret_str.="<td class='paddingTop10' style='width:220px;'>";
				if($haveValue==1){$ret_str.=$this->odLable(1); $ret_str.= implode("&nbsp;",$overrefraction2od);}
				$ret_str.= "</td>";

			}

			$ret_str.=	"</tr>";
			//	<!-- OD -->
			//	<!-- OS -->
			$ret_str.="	<tr>";

					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
					){
						$pc2gp1_os[]="$sel_vis_pc_os_sel_1_2";

					}
					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
					){
						if($txt_vis_pc_os_s_2!="" || $sel_vis_pc_os_sel_1_2!=""){
							$pc2gp1_os[]="S";
							$pc2gp1_os[]= "$txt_vis_pc_os_s_2";
						}
					}
					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_c!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_c_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_c_3!="")
					){
						if($txt_vis_pc_os_c_2!="" || $sel_vis_pc_os_sel_1_2!=""){
							$pc2gp1_os[]="C";
							$pc2gp1_os[]="$txt_vis_pc_os_c_2";
						}
					}
					if(($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_a!="") ||
					($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_a_2!="") ||
					($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_a_3!="")
					){
						if($txt_vis_pc_os_a_2!="" || $sel_vis_pc_os_sel_1_2!=""){
							$pc2gp1_os[]="A";
							$pc2gp1_os[]="".$txt_vis_pc_os_a_2."&#176;";
						}
					}

				$ret_str.="	<td class='paddingTop10' style='width:210px;'>".$this->osLable(1)."". implode("&nbsp;",$pc2gp1_os)."</td>";

					if(
						($txt_vis_pc_os_add_2!="" || ($txt_vis_pc_os_s_2!="" || $txt_vis_pc_os_c_2!="" || $txt_vis_pc_os_a_2!=""))
					){
						 if(strlen($txt_vis_pc_os_add_2)<>1){
							 $pc2gp2_addos[]="Add";
							 $pc2gp2_addos[]="$txt_vis_pc_os_add_2";
						 }
					}

				$ret_str.="	<td class='paddingTop10' style='width:130px;'>".implode("&nbsp;",$pc2gp2_addos)."</td>";
				//	<!-- Prism -->

					if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
						if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
						($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
						($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
						){
							$pc2gp3_prismos[] = (!empty($sel_vis_pc_os_p_2)) ? "P" : "";
							$pc2gp3_prismos[] = "$sel_vis_pc_os_p_2";
						}
						if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
						($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
						($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
						){
							$pc2gp3_prismos[]= (!empty($sel_vis_pc_os_sel_2_2) || !empty($sel_vis_pc_os_slash_2)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
							if(!empty($sel_vis_pc_os_sel_2_2) || !empty($sel_vis_pc_os_slash_2)){$pc2gp3_prismos[]="$sel_vis_pc_os_sel_2_2";}
						}
						if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
						($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
						($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
						){
							//$pc2gp3_prismos[]=(!empty($sel_vis_pc_os_slash_2)) ? "<img src=\"".$src_pic_vision_pc."\"  align=\"top\"/>" : "";
							$pc2gp3_prismos[]=(!empty($sel_vis_pc_os_slash_2)) ? "/" : "";
							$pc2gp3_prismos[]="$sel_vis_pc_os_slash_2";

						}
						if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
						(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
						(($sel_vis_pc_od_prism_3!=""  || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
						){
							$pc2gp3_prismos[]="$sel_vis_pc_os_prism_2";
						}

					}

				$ret_str.="	<td class='paddingTop10' style='width:170px;'>". implode("&nbsp;",$pc2gp3_prismos)."</td>";

					if($sel_vis_pc_od_sel_1_2!="" ||($txt_vis_pc_od_s_2!=""||$txt_vis_pc_od_c_2!=""||$txt_vis_pc_od_a_2!="" || $txt_vis_pc_od_add_2!="")){
						$overrefraction2os[]="";
						if($chk_pc_near_2=="Near"){
							if($txt_vis_pc_os_near_txt_2!=""){
								$overrefraction2os[]="OS";
								$overrefraction2os[]="$txt_vis_pc_os_near_txt_2";
							}
						}else{
							$haveValue=0;
							 if($txt_vis_pc_os_overref_s_2!="" || $txt_vis_pc_os_overref_c_2!="" || $txt_vis_pc_os_overref_a_2!="" || $txt_vis_pc_os_overref_v_2!=""){
								$haveValue=1;

							 }
							 if($txt_vis_pc_os_overref_s_2!=""){
								$overrefraction2os[]="S";
								$overrefraction2os[]="".trim($txt_vis_pc_os_overref_s_2)."";
							 }
							 if($txt_vis_pc_os_overref_c_2!=""){
								$overrefraction2os[]="C";
								$overrefraction2os[]="$txt_vis_pc_os_overref_c_2";
							 }
							 if($txt_vis_pc_os_overref_a_2!=""){
								$overrefraction2os[]="A";
								$overrefraction2os[]="$txt_vis_pc_os_overref_a_2";
							 }
							 if($txt_vis_pc_os_overref_v_2!="" && $txt_vis_pc_os_overref_v_2!="20/"){
								$overrefraction2os[]="V";
								$overrefraction2os[]="$txt_vis_pc_os_overref_v_2";
							 }

						}

						$ret_str.="	<td class='paddingTop10' style='width:220px;'>";
						if($haveValue==1){$ret_str.=$odLabelOverR; $ret_str.= implode("&nbsp;",$overrefraction2os);}
						$ret_str.="</td>";
					}
			$ret_str.="</tr>";
			$ret_str.="</table></td></tr>";
			//<!-- End  2nd Pc-->
			}
			if($txt_vis_pc_desc2!="" ){
			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="	<td class='paddingTop10' style='width:700px;'>";
			if($txt_vis_pc_desc2!=""){$ret_str.="<span class=\"text_lable\">PC 2nd Desc.&nbsp;</span>".$txt_vis_pc_desc2;}
			$ret_str.="	</td>";
			$ret_str.="	</tr>	";
			$ret_str.="";
			}
			//<!-- 2nd PC -->
			//<!-- End OverRefraction 2nd Pc-->
			} //PC 2

			if(!isset($arrTempProc)||in_array("PC 3",$arrTempProc)){
			if($sel_vis_pc_od_sel_1_3!="" ||($txt_vis_pc_od_s_3!=""||$txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="" || $txt_vis_pc_os_s_3!=""|| $txt_vis_pc_os_c_3!=""||$txt_vis_pc_os_a_3!="" || $txt_vis_pc_os_add_3!="")){

			//<!-- 3rd PC -->
			$ret_str.="<tr><td style='width:740px;'>
						<table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="	<tr>";
			$ret_str.="		<td class=\"tb_subheading paddingTop10\" style=\"width:210px;\">PC 3rd</td>";
			$ret_str.="		<td  class=\"tb_subheading paddingTop10\" style=\"width:130px;\">&nbsp;</td>";

						$prismTxt3 = '';
						if((($sel_vis_pc_od_prism!="" && $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" && $sel_vis_pc_os_p != "")) ||
					(($sel_vis_pc_od_prism_2!=""  && $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  && $sel_vis_pc_os_p_2 != "")) ||
					(($sel_vis_pc_od_prism_3!="" && $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  && $sel_vis_pc_os_p_3 != ""))
					){
							$prismTxt3 = 'Prism';
						}
						$overRefractionTxt3 = "";
						if($chk_pc_near_3!="Near" && ($txt_vis_pc_os_overref_s_3!="" || $txt_vis_pc_os_overref_c_3!="" || $txt_vis_pc_os_overref_a_3!="")||($txt_vis_pc_os_overref_v_3!="" && $txt_vis_pc_os_overref_v_3!="20/")||($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/")||($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/")){
							$overRefractionTxt3 = "Over Refraction";
						}

			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:170px;\">". $prismTxt3."</td>";
			$ret_str.="	<td class=\"tb_subheading paddingTop10\" style=\"width:220px;\">". $overRefractionTxt3."</td>";
			$ret_str.="	</tr>";
			$ret_str.="	<tr>";

						$pc3gp1_od[]="";
						$pc3gp1_os[]="";
						$pc3gp2_addod[]="";
						$pc3gp2_addos[]="";
						$pc3gp2_prismod[]="";
						$pc3gp2_prismos[]="";
						if(($sel_vis_pc_od_sel_1!="" && $txt_vis_pc_od_s!="" || ($sel_vis_pc_os_sel_1!="" && $txt_vis_pc_os_s!="")) ||
						($sel_vis_pc_od_sel_1_2!="" && $txt_vis_pc_od_s_2!="" || ($sel_vis_pc_os_sel_1_2!="" && $txt_vis_pc_os_s_2!="")) ||
						($sel_vis_pc_od_sel_1_3!="" && $txt_vis_pc_od_s_3!="" || ($sel_vis_pc_os_sel_1_3!="" && $txt_vis_pc_os_s_3!=""))
						){
							$pc3gp1_od[]="$sel_vis_pc_od_sel_1_3";
						}
						if(($txt_vis_pc_od_s!="" || $txt_vis_pc_os_s!="") ||
						($txt_vis_pc_od_s_2!="" || $txt_vis_pc_os_s_2!="") ||
						($txt_vis_pc_od_s_3!="" || $txt_vis_pc_os_s_3!="")
						){
							 if($txt_vis_pc_od_s_3!=""){$pc3gp1_od[]="S"; }
							 $pc3gp1_od[]="$txt_vis_pc_od_s_3";
						}
						if(($txt_vis_pc_od_c!="" || $txt_vis_pc_os_c!="") ||
						($txt_vis_pc_od_c_2!="" || $txt_vis_pc_os_c_2!="") ||
						($txt_vis_pc_od_c_3!="" || $txt_vis_pc_os_c_3!="")
						){
							 if($txt_vis_pc_od_c_3!=""){$pc3gp1_od[]="C";  }
							 $pc3gp1_od[]="".$txt_vis_pc_od_c_3."";
						}
						if(($txt_vis_pc_od_a!="" || $txt_vis_pc_os_a!="") ||
						($txt_vis_pc_od_a_2!="" || $txt_vis_pc_os_a_2!="") ||
						($txt_vis_pc_od_a_3!="" || $txt_vis_pc_os_a_3!="")
						){
							if($txt_vis_pc_od_a_3!="" ){$pc3gp1_od[]="A"; }
							if($txt_vis_pc_od_a_3!="" ){$pc3gp1_od[]="".$txt_vis_pc_od_a_3."&#176;";}
						}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->odLable(1). implode("&nbsp;",$pc3gp1_od)."</td>";

				if(
					($txt_vis_pc_od_add_3!="" || ($txt_vis_pc_od_s_3!="" || $txt_vis_pc_od_c_3!="" || $txt_vis_pc_od_a_3!=""))
				){
					if(strlen($txt_vis_pc_od_add_3)<>1){
						$pc3gp2_addod[]="Add";
						$pc3gp2_addod[]="$txt_vis_pc_od_add_3";
					}
				}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$pc3gp2_addod)."</td>";

					if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3 )){
						if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
						($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
						($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
						){
						$pc3gp2_prismod[]= (!empty($sel_vis_pc_od_p_3)) ? "P" : "";
						$pc3gp2_prismod[]="$sel_vis_pc_od_p_3";
					}
					if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
					($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
					($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
					){

						$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_sel_2_3) || !empty($sel_vis_pc_od_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
						if(!empty($sel_vis_pc_od_sel_2_3) || !empty($sel_vis_pc_od_slash_3)){$pc3gp2_prismod[]="$sel_vis_pc_od_sel_2_3";}

					}
					if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
					($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
					($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
					){
						//$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
						$pc3gp2_prismod[]=(!empty($sel_vis_pc_od_slash_3)) ? "/" : "";
						$pc3gp2_prismod[]="$sel_vis_pc_od_slash_3";
					}
					if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
					(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
					(($sel_vis_pc_od_prism_3!=""  || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
					){
						$pc3gp2_prismod[]="$sel_vis_pc_od_prism_3";
					}
				}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$pc3gp2_prismod)."</td>";

				if($sel_vis_pc_od_sel_1_3!="" ||($txt_vis_pc_od_s_3!=""||$txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="")){
					$overrefraction3od[] = "";
					if($chk_pc_near_3=="Near"){
						 if($txt_vis_pc_od_near_txt_3!=""){
						 $overrefraction3od[]="OD";
						 $overrefraction3od[]="$txt_vis_pc_od_near_txt_3";
						 }
					}else{
						$haveValue=0;
						 if($txt_vis_pc_od_overref_s_3!="" || $txt_vis_pc_od_overref_c_3!="" || $txt_vis_pc_od_overref_a_3!="" || $txt_vis_pc_od_overref_v_3!="" ){
							$haveValue=1;
						 }
						if($txt_vis_pc_od_overref_s_3!=""){
							$overrefraction3od[]="S";
							$overrefraction3od[]="$txt_vis_pc_od_overref_s_3";
						}
						if($txt_vis_pc_od_overref_c_3!=""){
							$overrefraction3od[]="C";
							$overrefraction3od[]="$txt_vis_pc_od_overref_c_3";
						}
						if($txt_vis_pc_od_overref_a_3!=""){$overrefraction3od[]="A";
							$overrefraction3od[]="$txt_vis_pc_od_overref_a_3";
						}
						if($txt_vis_pc_od_overref_v_3!="" && $txt_vis_pc_od_overref_v_3!="20/"){
							$overrefraction3od[]="V";
							$overrefraction3od[]="$txt_vis_pc_od_overref_v_3";
						}
					}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">";
					if($haveValue==1){$ret_str.=$this->odLable(1); $ret_str.= implode("&nbsp;",$overrefraction3od);}
					$ret_str.="</td>";

					}

				$ret_str.="</tr>";
				$ret_str.="<tr>";

					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
					){
						$pc3gp1_os[]="$sel_vis_pc_os_sel_1_3";
					}
					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_s!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_s_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_s_3!="")
					){
						 if($txt_vis_pc_os_s_3!="" || $sel_vis_pc_os_sel_1_3!=""){
							$pc3gp1_os[]="S";
							$pc3gp1_os[]="$txt_vis_pc_os_s_3";
						 }
					}
					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_c!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_c_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_c_3!="")
					){
						 if($txt_vis_pc_os_c_3!="" || $sel_vis_pc_os_sel_1_3!=""){
							 $pc3gp1_os[]="C";
							 $pc3gp1_os[]="$txt_vis_pc_os_c_3";
						 }
					}
					if(
						($sel_vis_pc_os_sel_1!="" || $txt_vis_pc_os_a!="") ||
						($sel_vis_pc_os_sel_1_2!="" || $txt_vis_pc_os_a_2!="") ||
						($sel_vis_pc_os_sel_1_3!="" || $txt_vis_pc_os_a_3!="")
					){
						 if($txt_vis_pc_os_a_3!="" || $sel_vis_pc_os_sel_1_3!=""){
							$pc3gp1_os[]="A";
							$pc3gp1_os[]="".$txt_vis_pc_os_a_3."&#176;";
						}
					}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->osLable(1). implode("&nbsp;",$pc3gp1_os)."</td>";

					if(
						($txt_vis_pc_os_add_3!="" || ($txt_vis_pc_os_s_3!="" || $txt_vis_pc_os_c_3!="" || $txt_vis_pc_os_a_3!=""))
					){
						 if(strlen($txt_vis_pc_os_add_3)<>1){
							$pc3gp2_addos[]="Add";
							$pc3gp2_addos[]="$txt_vis_pc_os_add_3";
						}
					}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$pc3gp2_addos)."</td>";

					if(($elem_prismPc1) || ($elem_prismPc2) || ($elem_prismPc3)){
						if(($sel_vis_pc_od_p!="") || ($sel_vis_pc_os_p!="") ||
						($sel_vis_pc_od_p_2!="") || ($sel_vis_pc_os_p_2!="") ||
						($sel_vis_pc_od_p_3!="") || ($sel_vis_pc_os_p_3!="")
						){
							$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_p_3)) ? "P" : "";

							$pc3gp2_prismos[]="$sel_vis_pc_os_p_3";

						}
						if(($sel_vis_pc_od_sel_2!="" || $sel_vis_pc_od_slash != "") || ($sel_vis_pc_os_sel_2!="" || $sel_vis_pc_os_slash != "") ||
						($sel_vis_pc_od_sel_2_2!="" || $sel_vis_pc_od_slash_2 != "") || ($sel_vis_pc_os_sel_2_2!="" || $sel_vis_pc_os_slash_2 != "") ||
						($sel_vis_pc_od_sel_2_3!="" || $sel_vis_pc_od_slash_3 != "" ) || ($sel_vis_pc_os_sel_2_3!="" || $sel_vis_pc_os_slash_3 != "")
						){
							$pc3gp2_prismos[]= (!empty($sel_vis_pc_os_sel_2_3) || !empty($sel_vis_pc_os_slash_3)) ? "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
							if(!empty($sel_vis_pc_os_sel_2_3) || !empty($sel_vis_pc_os_slash_3)){$pc3gp2_prismos[]="$sel_vis_pc_os_sel_2_3";}
						}
						if(($sel_vis_pc_od_slash!="") || ($sel_vis_pc_os_slash!="") ||
						($sel_vis_pc_od_slash_2!="") || ($sel_vis_pc_os_slash_2!="") ||
						($sel_vis_pc_od_slash_3!="") || ($sel_vis_pc_os_slash_3!="")
						){
							//$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_slash_3)) ?"<img src=\"$src_pic_vision_pc\"  align=\"top\"/>" : "";
							$pc3gp2_prismos[]=(!empty($sel_vis_pc_os_slash_3)) ? "/" : "";
							$pc3gp2_prismos[]="$sel_vis_pc_os_slash_3";
						}
						if((($sel_vis_pc_od_prism!="" || $sel_vis_pc_od_p != "") || ($sel_vis_pc_os_prism!="" || $sel_vis_pc_os_p != "")) ||
						(($sel_vis_pc_od_prism_2!=""  || $sel_vis_pc_od_p_2 != "" ) || ($sel_vis_pc_os_prism_2!=""  || $sel_vis_pc_os_p_2 != "")) ||
						(($sel_vis_pc_od_prism_3!="" || $sel_vis_pc_od_p_3 != "") || ($sel_vis_pc_os_prism_3!=""  || $sel_vis_pc_os_p_3 != ""))
						){
							 $pc3gp2_prismos[]="$sel_vis_pc_os_prism_3";
						}

					}

				$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$pc3gp2_prismos)."</td> ";

				if($sel_vis_pc_od_sel_1_3!="" || ($txt_vis_pc_od_s_3!="" || $txt_vis_pc_od_c_3!=""||$txt_vis_pc_od_a_3!="" || $txt_vis_pc_od_add_3!="")){
					$overrefraction3os[]="";
					if($chk_pc_near_3=="Near"){
						 if($txt_vis_pc_os_near_txt_3!=""){
							$overrefraction3os[]="OS";
							$overrefraction3os[]="$txt_vis_pc_os_near_txt_3";
						}
					}else{
						$haveValue=0;
						 if($txt_vis_pc_os_overref_s_3!="" || $txt_vis_pc_os_overref_c_3!="" || $txt_vis_pc_os_overref_a_3!="" || $txt_vis_pc_os_overref_v_3!=""){
							$haveValue=1;
						 }
						 if($txt_vis_pc_os_overref_s_3!=""){
							$overrefraction3os[]="S";
							$overrefraction3os[]="$txt_vis_pc_os_overref_s_3";
						 }
						 if($txt_vis_pc_os_overref_c_3!=""){
							$overrefraction3os[]="C";
							$overrefraction3os[]="$txt_vis_pc_os_overref_c_3";
						 }
						 if($txt_vis_pc_os_overref_a_3!=""){
							$overrefraction3os[]="A";
							$overrefraction3os[]="$txt_vis_pc_os_overref_a_3";
						 }
						 if($txt_vis_pc_os_overref_v_3!="" && $txt_vis_pc_os_overref_v_3!="20/" ){
							$overrefraction3os[]="V";
							$overrefraction3os[]="$txt_vis_pc_os_overref_v_3";
						 }
					}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">";
					if($haveValue==1){$ret_str.=$this->osLable(1); $ret_str.= implode("&nbsp;",$overrefraction3os);}
					$ret_str.="</td>";

					}
			$ret_str.="</tr>";
			$ret_str.="</table></td></tr>";
			//<!-- End 3rd PC -->

			}
			if($txt_vis_pc_desc3!=""){

			$ret_str.="";
			$ret_str.="	<tr>";
			$ret_str.="		<td class='text_lable paddingTop10' style='width:700px;'>";
						if($txt_vis_pc_desc3!=""){$ret_str.="PC 3rd Desc.&nbsp;". $txt_vis_pc_desc3;}
			$ret_str.="		</td>";
			$ret_str.="	</tr>";
			$ret_str.="";

			}
			}

			//<!-- End 3rd Pc overrefraction-->
			$ret_str .= $this->print_getPC($pid,$fid); //Multiple PC
			//End Pc Code

			//MR Code//
			$show_mrval=false;
			if($show_mrList1==true || $show_mrList2==true || $show_mrList3==true){
				$show_mrval=true;
			}

			/*** STOPPED
			if($show_mrval==true){
				$sqlVisionQry = imw_query("SELECT * FROM chart_vision WHERE patient_id = '$patient_id' AND form_id = '$form_id'");
				if(imw_num_rows($sqlVisionQry)>0){
					$sqlVisionRow = imw_fetch_assoc($sqlVisionQry);
					extract($sqlVisionRow);
				}
			}
			***/

			if(!isset($arrTempProc)||in_array("MR 1",$arrTempProc)){
			if($show_mrList1==true){

			$ret_str.="<tr><td style='width:740px;'><table style='width:100%;' cellpadding='0' cellspacing='0'>";

				if(
				$vis_mr_od_s || $vis_mr_od_c || $vis_mr_od_a || $vis_mr_od_add || ($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
				||
				($vis_mr_od_txt_2 && $vis_mr_od_txt_2!='20/')
				||
				$vis_mr_os_s || $vis_mr_os_c || $vis_mr_os_a || $vis_mr_os_add || ($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
				||
				($vis_mr_os_txt_2 && $vis_mr_os_txt_2!='20/')
				||
				($mrGLPH1 == 1)
				||($vis_mr_od_sel_2 || ($visMrOdSel2Vision && $visMrOdSel2Vision!='20/'))
				||($vis_mr_os_sel_2 || ($visMrOsSel2Vision && $visMrOsSel2Vision!='20/'))
				){
				$Mr1st = true;



			$ret_str.="		<tr>";

				$givenMr = ($rd_vis_mr_none_given=="MR 1") ? "(Given)" : "";

			$ret_str.="			<td colspan=\"3\" class=\"tb_subheading paddingTop10\">MR 1st by ".$givenMr.$this->showDoctorName($provider_id)."  ".$elem_mr_type1."</td>";
            if($vis_mr_od_sel_2) {
                $ret_str.="<td colspan=\"1\" class=\"tb_subheading paddingTop10\">Glare VA</td>";
            }
			$ret_str.="		</tr>";
			$ret_str.="";
			$ret_str.="";
			$ret_str.="";

						}
						if(
							($prism_mr == 1)
							||
							(
							($vis_mr_od_p || $vis_mr_od_prism || $vis_mr_od_slash || $vis_mr_od_sel_1)
							||
							($vis_mr_os_p || $vis_mr_os_prism || $vis_mr_os_slash || $vis_mr_os_sel_1)
							)
							){
							$Mr1stPrism = true;

			$ret_str.="";
						 }

						if(($mrGLPH1 == 1)
							||
							($vis_mr_od_sel_2 || ($visMrOdSel2Vision && $visMrOdSel2Vision!='20/'))
							||
							($vis_mr_os_sel_2 || ($visMrOsSel2Vision && $visMrOsSel2Vision!='20/'))
							){
							$Mr1stPrismGlPH = true;

			$ret_str.="";//<!-- GL/PH -->
					 }
					if($Mr1stPrismGlPH==true || $Mr1st){

			$ret_str.="	";

					}
					$mr1gp1_od[]="";
					$mr1gp1_os[]="";
					$mr1gp2_addod[]="";
					$mr1gp2_addos[]="";
					$mr1gp3_prismod[]="";
					$mr1gp3_prismos[]="";
					$mr1gp4_GL_PHod[]="";
					$mr1gp4_GL_PHos[]="";
					if(
						$vis_mr_od_s || $vis_mr_od_c || $vis_mr_od_a || $vis_mr_od_add || ($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
						||
						($vis_mr_od_txt_2 && $vis_mr_od_txt_2!='20/')
						||
						$vis_mr_os_s || $vis_mr_os_c || $vis_mr_os_a || $vis_mr_os_add || ($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
						||
						($vis_mr_os_txt_2 && $vis_mr_os_txt_2!='20/')
						||
						($mrGLPH1 == 1)
						||($vis_mr_od_sel_2 || ($visMrOdSel2Vision && $visMrOdSel2Vision!='20/'))
						||($vis_mr_os_sel_2 || ($visMrOsSel2Vision && $visMrOsSel2Vision!='20/'))

						){
							$Mr1st = true;
							if($vis_mr_od_s)
							{
								$mr1gp1_od[] = "S";
								$mr1gp1_od[] = "$vis_mr_od_s";
							}
							if($vis_mr_od_c)
							{
								$mr1gp1_od[] = "C";
								$mr1gp1_od[] = "$vis_mr_od_c";
							}
							if($vis_mr_od_a)
							{
								$mr1gp1_od[] = "A";
								$mr1gp1_od[] = "$vis_mr_od_a";
							}
							if($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
							{
								$mr1gp1_od[] = "$vis_mr_od_txt_1";
							}

			$ret_str.="		<tr>";
			$ret_str.="			<td class=\"paddingTop10\" style='width:250px;'>";
			$ret_str.=			 $this->odLable(1); $ret_str.= implode("&nbsp;",$mr1gp1_od);
			$ret_str.="			</td>";

							if($vis_mr_od_add!="")
							{
								$mr1gp2_addod[] = "Add";
								$mr1gp2_addod[] = "$vis_mr_od_add";
							}
							if($vis_mr_od_txt_2 != '' && $vis_mr_od_txt_2!='20/')
							{
								$mr1gp2_addod[] = "$vis_mr_od_txt_2";
							}

			$ret_str.="			<td class=\"paddingTop10\" style='width:130px;'>";
							$ret_str.= implode("&nbsp;",$mr1gp2_addod);
			$ret_str.="			</td>";

                        }else{
                            $ret_str .= '<tr><td class="paddingTop10"></td><td class="paddingTop10"></td>';
                        }

						if(
						($prism_mr == 1)
						||
						(
						($vis_mr_od_p || $vis_mr_od_prism || $vis_mr_od_slash || $vis_mr_od_sel_1)
						||
						($vis_mr_os_p || $vis_mr_os_prism || $vis_mr_os_slash || $vis_mr_os_sel_1)
						)
						){
							$Mr1stPrism = true;

							if($vis_mr_od_p)
							{
								$mr1gp3_prismod[] = "P";
								$mr1gp3_prismod[] = "$vis_mr_od_p";
							}
							if($vis_mr_od_p || $vis_mr_od_prism){
								$mr1gp3_prismod[] = "<img src=\"$src_pic_vision_pc\"/>";
							}
							if($vis_mr_od_sel_1)
							{
								$mr1gp3_prismod[] = "$vis_mr_od_sel_1";
							}
							if($vis_mr_od_slash)
							{
								$mr1gp3_prismod[] = "/";
								$mr1gp3_prismod[] = "$vis_mr_od_slash";
							}
							if($vis_mr_od_prism)
							{
								$mr1gp3_prismod[] = "$vis_mr_od_prism";
							}
							$ret_str.="<td class=\"paddingTop10\" style='width:170px;'>".implode("&nbsp;",$mr1gp3_prismod)."</td>";

						}else{$ret_str.="<td class=\"paddingTop10\"></td>";}

						  if(
							($mrGLPH1 == 1)
							||
							(
								($vis_mr_od_sel_2)
								||
								($visMrOdSel2Vision && $visMrOdSel2Vision!='20/')
								||
								(
									($vis_mr_os_sel_2)
									||
									($visMrOsSel2Vision && $visMrOsSel2Vision!='20/')
								)
							)
							){
							$Mr1stPrismGlPH = true;
							if($vis_mr_od_sel_2<>"")
							{
								//$mr1gp4_GL_PHod[]="GL/PH";
								$mr1gp4_GL_PHod[]="$vis_mr_od_sel_2";
							}
							if($visMrOdSel2Vision && $visMrOdSel2Vision!='20/')
							{
								$mr1gp4_GL_PHod[]="Vision";
								$mr1gp4_GL_PHod[]=htmlentities("$visMrOdSel2Vision");
							}

				$ret_str.="	<td class=\"paddingTop10\" style='width:220px;'>";
				$ret_str.=	 implode("&nbsp;",$mr1gp4_GL_PHod);
				$ret_str.="	</td>";

				}else{
					$ret_str.="<td class=\"paddingTop10\"></td>";
				}
				if(
					$vis_mr_od_s || $vis_mr_od_c || $vis_mr_od_a || $vis_mr_od_add || ($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
					||
					($vis_mr_od_txt_2 && $vis_mr_od_txt_2!='20/')
					||
					$vis_mr_os_s || $vis_mr_os_c || $vis_mr_os_a || $vis_mr_os_add || ($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
					||
					($vis_mr_os_txt_2 && $vis_mr_os_txt_2!='20/')
					||
					($mrGLPH1 == 1)
					||
					($vis_mr_od_sel_2 || ($visMrOdSel2Vision && $visMrOdSel2Vision!='20/'))
					||
					($vis_mr_os_sel_2 || ($visMrOsSel2Vision && $visMrOsSel2Vision!='20/'))
				 ){
					$Mr1st = true;
					$ret_str.="	</tr>";
                }else{
                    $ret_str .= '</tr>';
                }
				if(
					$vis_mr_od_s || $vis_mr_od_c || $vis_mr_od_a || $vis_mr_od_add || ($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
					||
					($vis_mr_od_txt_2 && $vis_mr_od_txt_2!='20/')
					||
					$vis_mr_os_s || $vis_mr_os_c || $vis_mr_os_a || $vis_mr_os_add || ($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
					||
					($vis_mr_os_txt_2 && $vis_mr_os_txt_2!='20/')
					|| ($mrGLPH1 == 1)
					){
					$Mr1st = true;

				$ret_str.="<tr>";

					if($vis_mr_os_s)
					{
					$mr1gp1_os[]="S";
					$mr1gp1_os[]="$vis_mr_os_s";
					}
					if($vis_mr_os_c)
					{
					$mr1gp1_os[]="C";
					$mr1gp1_os[]="$vis_mr_os_c";
					}
					if($vis_mr_os_a)
					{
					$mr1gp1_os[]="A";
					$mr1gp1_os[]="$vis_mr_os_a";
					}
					if($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
					{
					$mr1gp1_os[]="$vis_mr_os_txt_1";
					}

				$ret_str.="    <td class=\"paddingTop10\" style='width:230px;'>".$this->osLable(1). implode("&nbsp;",$mr1gp1_os)."</td>";

					if($vis_mr_os_add!=""){
					$mr1gp2_addos[]="Add";
					$mr1gp2_addos[]="$vis_mr_os_add";
					}
					if($vis_mr_os_txt_2!="" && $vis_mr_os_txt_2!='20/'){
					$mr1gp2_addos[]="$vis_mr_os_txt_2";
					}

				$ret_str.="    <td class=\"paddingTop10\" style='width:130px;'>". implode("&nbsp;",$mr1gp2_addos)."</td>";
				//    <!-- MR 1st -->

						}else {
                            $ret_str.="<tr><td class=\"paddingTop10\"></td><td class=\"paddingTop10\"></td>";
                        }

				//    <!-- MR 1st Prism -->

						if(
							($prism_mr == 1)
							||
							(
							($vis_mr_od_p || $vis_mr_od_prism || $vis_mr_od_slash || $vis_mr_od_sel_1)
							||
							($vis_mr_os_p || $vis_mr_os_prism || $vis_mr_os_slash || $vis_mr_os_sel_1)
							)
							){
							$Mr1stPrism = true;

							if($vis_mr_os_p)
							{
								$mr1gp3_prismos[]="P";
								$mr1gp3_prismos[]="$vis_mr_os_p";
							}
							if($vis_mr_os_p || $vis_mr_os_prism){
								$mr1gp3_prismos[]="<img src=\"$src_pic_vision_pc\"/>";
							}
							if($vis_mr_os_sel_1)
							{
								$mr1gp3_prismos[]="$vis_mr_os_sel_1";
							}
							if($vis_mr_os_slash)
							{
								$mr1gp3_prismos[]="/";
								$mr1gp3_prismos[]="$vis_mr_os_slash";
							}
							if($vis_mr_os_prism)
							{
								$mr1gp3_prismos[]="$vis_mr_os_prism";
							}

				$ret_str.="		<td class=\"paddingTop10\" style='width:170px;'>". implode("&nbsp;",$mr1gp3_prismos)."</td>";

						}else{		$ret_str.="<td class=\"paddingTop10\"></td>";	}
						if(($mrGLPH1 == 1)
						||
						(
						($vis_mr_od_sel_2)
						||
						($visMrOdSel2Vision && $visMrOdSel2Vision!='20/')
						||
						($vis_mr_os_sel_2)
						||
						($visMrOsSel2Vision && $visMrOsSel2Vision!='20/')
						)
						){
							$Mr1stPrismGlPH = true;
                            if($vis_mr_od_sel_2<>"")
							{
								$vis_mr_os_sel_2="$vis_mr_od_sel_2";
							}
							if($vis_mr_os_sel_2)
							{
								//$mr1gp4_GL_PHos[] = "GL/PH";
								$mr1gp4_GL_PHos[] = "$vis_mr_os_sel_2";
							}
							if($visMrOsSel2Vision && $visMrOsSel2Vision!='20/')
							{
								$mr1gp4_GL_PHos[] = "Vision";
								$mr1gp4_GL_PHos[] = htmlentities("$visMrOsSel2Vision");
							}

					$ret_str.="		<td class=\"paddingTop10\" style='width:220px;'>". implode("&nbsp;",$mr1gp4_GL_PHos)."</td>";



						}else{$ret_str.="<td class=\"paddingTop10\"></td>";	}

					if(
					$vis_mr_od_s || $vis_mr_od_c || $vis_mr_od_a || $vis_mr_od_add || ($vis_mr_od_txt_1 && $vis_mr_od_txt_1!='20/')
					||
					($vis_mr_od_txt_2 && $vis_mr_od_txt_2!='20/')
					||
					$vis_mr_os_s || $vis_mr_os_c || $vis_mr_os_a || $vis_mr_os_add || ($vis_mr_os_txt_1 && $vis_mr_os_txt_1!='20/')
					||
					($vis_mr_os_txt_2 && $vis_mr_os_txt_2!='20/') ||($mrGLPH1 == 1)
					){
					$Mr1st = true;
				$ret_str.=" </tr>";

                    }else {$ret_str.=" </tr>";}

			$ret_str.="</table></td></tr>";


			if($vis_mr_desc1COMMENTS!="" || trim($vis_mr_prismCOMMENTS)){
			//    <!-- Description -->
			$ret_str.=" <tr><td style='width:700px;'><table style='width:700px;' cellpadding='0' cellspacing='0'>  ";
			$ret_str.="	<tr>";
			if($vis_mr_desc1COMMENTS!=""){
				$ret_str.="<td style=\"width:340px;\" class=\"paddingTop10\">MR 1-Comments:&nbsp;". htmlentities($vis_mr_desc1COMMENTS)."</td>";
			}
			if(trim($vis_mr_prismCOMMENTS)){
				$ret_str.="		<td style='width:400px;' class=\"paddingTop10\">Prism Comments: ".htmlentities($vis_mr_prismCOMMENTS)."</td>";
			}
			$ret_str.="	</tr>";
			$ret_str.="  </table></td></tr> ";
			//    <!-- Description -->

			}
			}//END OF MR1
			}//MR 1

			//Start MR2
			if(!isset($arrTempProc)||in_array("MR 2",$arrTempProc)){
			if($show_mrList2==true){
				if(($vis_mr_od_given_s || $vis_mr_od_given_c || $vis_mr_od_given_a || $vis_mr_od_given_add)
				||
				($vis_mr_od_given_txt_1 && $vis_mr_od_given_txt_1!='20/')
				||
				($vis_mr_od_given_txt_2 && $vis_mr_od_given_txt_2!='20/')
				||
				($vis_mr_os_given_s || $vis_mr_os_given_c || $vis_mr_os_given_a || $vis_mr_os_given_add)
				||
				($vis_mr_os_given_txt_1 && $vis_mr_os_given_txt_1!='20/')
				||
				($vis_mr_os_given_txt_2 && $vis_mr_os_given_txt_2!='20/')
				||
				($mrGLPH2 == 1)
				){
					$MR2nd = true;
					$mr2gp1_od[]="";
					$mr2gp1_os[]="";
					$mr2gp2_addod[]="";
					$mr2gp2_addos[]="";
					$mr2gp3_prismod[]="";
					$mr2gp3_prismos[]="";
					$mr2gp4_GL_PHod[]="";
					$mr2gp4_GL_PHos[]="";

			$ret_str.="<tr><td style='width:740px;'><table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="	    <tr>";

						$givenMr = ($rd_vis_mr_none_given=="MR 2") ? "(Given)" : "";

					$ret_str.="	<td colspan=\"3\" class=\"tb_subheading paddingTop10\">MR 2nd by ". $givenMr.$this->showDoctorName($providerIdOther)."  ".$elem_mr_type2."</td>";
                    if($vis_mr_od_given_sel_2) {
                        $ret_str.="<td colspan=\"1\" class=\"tb_subheading paddingTop10\">Glare VA</td>";
                    }
			$ret_str.="	    </tr>";
			$ret_str.="	    ";
			$ret_str.="		";
			$ret_str.="		";

					 if(($mrPrism2 == 1)
					&&
					($vis_mr_od_given_p || $vis_mr_od_given_prism || $vis_mr_od_given_slash || $vis_mr_od_given_sel_1)
					||
					($vis_mr_os_given_p || $vis_mr_os_given_prism || $vis_mr_os_given_slash || $vis_mr_os_given_sel_1)
					){
					$MR2ndPrism = true;

			$ret_str.="	   ";

					}
					if(($mrGLPH2 == 1)
					&&
					($vis_mr_od_given_sel_2 || ($visMrOtherOdSel2Vision && $visMrOtherOdSel2Vision!='20/'))
					||
					($vis_mr_os_given_sel_2 || ($visMrOtherOsSel2Vision && $visMrOtherOsSel2Vision!='20/'))
					){
					$MR2ndPrismGLPH = true;

			$ret_str.="	    "; //<!-- GL/PH -->

					}

			$ret_str.="	";
			$ret_str.="	<tr>";

				if(($vis_mr_od_given_s || $vis_mr_od_given_c || $vis_mr_od_given_a || $vis_mr_od_given_add)
				||
				($vis_mr_od_given_txt_1 && $vis_mr_od_given_txt_1!='20/')
				||
				($vis_mr_od_given_txt_2 && $vis_mr_od_given_txt_2!='20/')
				||
				($vis_mr_os_given_s || $vis_mr_os_given_c || $vis_mr_os_given_a || $vis_mr_os_given_add)
				||
				($vis_mr_os_given_txt_1 && $vis_mr_os_given_txt_1!='20/')
				||
				($vis_mr_os_given_txt_2 && $vis_mr_os_given_txt_2!='20/')
					|| ($mrGLPH2 == 1)

					){
						$MR2nd = true;
						if($vis_mr_od_given_s)
						{
							$mr2gp1_od[] = "S";
							$mr2gp1_od[] = "$vis_mr_od_given_s";
						}
						if($vis_mr_od_given_c)
						{
							$mr2gp1_od[] = "C";
							$mr2gp1_od[] = "$vis_mr_od_given_c";
						}
						if($vis_mr_od_given_a)
						{
							$mr2gp1_od[] = "A";
							$mr2gp1_od[] = "$vis_mr_od_given_a";
						}
						if($vis_mr_od_given_txt_1 && $vis_mr_od_given_txt_1!='20/')
						{
							$mr2gp1_od[]="$vis_mr_od_given_txt_1";
						}

				$ret_str.="		<td class=\"paddingTop10\" style=\"width:250px;\">".$this->odLable(1). implode("&nbsp;",$mr2gp1_od)."</td>";

						if($vis_mr_od_given_add!='' and ($vis_mr_od_given_s!="" || $vis_mr_od_given_c!="" || $vis_mr_od_given_a!=""))
						{
							$mr2gp2_addod[]="Add";
							$mr2gp2_addod[]="$vis_mr_od_given_add";
						}
						if($vis_mr_od_given_txt_2 && $vis_mr_od_given_txt_2!='20/')
						{
							$mr2gp2_addod[]="$vis_mr_od_given_txt_2";
						}

				$ret_str.="		<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr2gp2_addod)."</td>";

                        }else{$ret_str.="<td class=\"paddingTop10\"></td><td class=\"paddingTop10\"></td>";}
						if(($mrPrism2 == 1)
						&&
						($vis_mr_od_given_p || $vis_mr_od_given_prism || $vis_mr_od_given_slash || $vis_mr_od_given_sel_1)
						||
						($vis_mr_os_given_p || $vis_mr_os_given_prism || $vis_mr_os_given_slash || $vis_mr_os_given_sel_1)
						){
							$MR2ndPrism = true;
							if($vis_mr_od_given_p)
							{
								$mr2gp3_prismod[]="P";
								$mr2gp3_prismod[]="$vis_mr_od_given_p";
								$mr2gp3_prismod[]="<img src=\"$src_pic_vision_pc\"/>";
							}
							if($vis_mr_od_given_sel_1)
							{
								$mr2gp3_prismod[]="$vis_mr_od_given_sel_1";
							}
							if($vis_mr_od_given_slash)
							{
								$mr2gp3_prismod[]="/";
								$mr2gp3_prismod[]="$vis_mr_od_given_slash";
							}
							if($vis_mr_od_given_prism)
							{
								$mr2gp3_prismod[]="$vis_mr_od_given_prism";
							}

					$ret_str.="		<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$mr2gp3_prismod)."</td>";

                        }else {$ret_str.="<td class=\"paddingTop10\"></td>";}
						if(($mrGLPH2 == 1)
						&&
						($vis_mr_od_given_sel_2 || ($visMrOtherOdSel2Vision && $visMrOtherOdSel2Vision!='20/'))
						||
						($vis_mr_os_given_sel_2 || ($visMrOtherOsSel2Vision && $visMrOtherOsSel2Vision!='20/'))
						){
							$MR2ndPrismGLPH = true;
							if($vis_mr_od_given_sel_2)
							{
								//$mr2gp4_GL_PHod[] = "GL/PH";
								$mr2gp4_GL_PHod[] = "$vis_mr_od_given_sel_2";
							}
							if($visMrOtherOdSel2Vision && $visMrOtherOdSel2Vision!='20/')
							{
								$mr2gp4_GL_PHod[] = "Vision";
								$mr2gp4_GL_PHod[] = "$visMrOtherOdSel2Vision";
							}

					$ret_str.="		<td class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr2gp4_GL_PHod)."</td>";

                        }else {$ret_str.="<td class=\"paddingTop10\"></td>";}

				$ret_str.="</tr>";
				$ret_str.="<tr>";

				if(($vis_mr_od_given_s || $vis_mr_od_given_c || $vis_mr_od_given_a || $vis_mr_od_given_add)
				||
				($vis_mr_od_given_txt_1 && $vis_mr_od_given_txt_1!='20/')
				||
				($vis_mr_od_given_txt_2 && $vis_mr_od_given_txt_2!='20/')
				||
				($vis_mr_os_given_s || $vis_mr_os_given_c || $vis_mr_os_given_a || $vis_mr_os_given_add)
				||
				($vis_mr_os_given_txt_1 && $vis_mr_os_given_txt_1!='20/')
				||
				($vis_mr_os_given_txt_2 && $vis_mr_os_given_txt_2!='20/')
				){
					$MR2nd = true;
						if($vis_mr_os_given_s)
						{
							$mr2gp1_os[] = "S";
							$mr2gp1_os[] = "$vis_mr_os_given_s";
						}
						if($vis_mr_os_given_c)
						{
							$mr2gp1_os[] = "C";
							$mr2gp1_os[] = "$vis_mr_os_given_c";
						}
						if($vis_mr_os_given_a)
						{
							$mr2gp1_os[] = "A";
							$mr2gp1_os[] = "$vis_mr_os_given_a";
						}
						if($vis_mr_os_given_txt_1 && $vis_mr_os_given_txt_1!='20/')
						{
							$mr2gp1_os[] = "$vis_mr_os_given_txt_1";
						}

				$ret_str.="		<td  class=\"paddingTop10\" style=\"width:210px;\">".$this->osLable(1). implode("&nbsp;",$mr2gp1_os)."</td>";

						if($vis_mr_os_given_add!='' and ($vis_mr_os_given_s!="" || $vis_mr_os_given_c!="" || $vis_mr_os_given_a!=""))
						{
							$mr2gp2_addos[] = "Add";
							$mr2gp2_addos[] = "$vis_mr_os_given_add";
						}
						if($vis_mr_os_given_txt_2 && $vis_mr_os_given_txt_2!='20/')
						{
							$mr2gp2_addos[] = "$vis_mr_os_given_txt_2";
						}

				$ret_str.="		<td  class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr2gp2_addos)."</td>";

                        }else {$ret_str.="<td class=\"paddingTop10\"></td><td class=\"paddingTop10\"></td>";}
						if(($mrPrism2 == 1)
						&&
						($vis_mr_od_given_p || $vis_mr_od_given_prism || $vis_mr_od_given_slash || $vis_mr_od_given_sel_1)
						||
						($vis_mr_os_given_p || $vis_mr_os_given_prism || $vis_mr_os_given_slash || $vis_mr_os_given_sel_1)
						){
							$MR2ndPrism = true;
							if($vis_mr_os_given_p)
							{
								$mr2gp3_prismos[] ="P";
								$mr2gp3_prismos[] = "$vis_mr_os_given_p";
							}
							if($vis_mr_os_given_p || $vis_mr_os_given_prism){
								$mr2gp3_prismos[] = "<img src=\"$src_pic_vision_pc\"/>";
							}
							if($vis_mr_os_given_sel_1)
							{
								$mr2gp3_prismos[] = "$vis_mr_os_given_sel_1";
							}
							if($vis_mr_os_given_slash)
							{
								$mr2gp3_prismos[] = "/";
								$mr2gp3_prismos[] = "$vis_mr_os_given_slash";
							}
							if($vis_mr_os_given_prism)
							{
								$mr2gp3_prismos[] = "$vis_mr_os_given_prism";
							}

					$ret_str.="		<td class=\"paddingTop10\" style=\"width:170px;\" >". implode("&nbsp;",$mr2gp3_prismos)."</td>";

                        }else{$ret_str.="<td class=\"paddingTop10\"></td>";}
						if(($mrGLPH2 == 1)
						&&
						($vis_mr_od_given_sel_2 || ($visMrOtherOdSel2Vision && $visMrOtherOdSel2Vision!='20/'))
						||
						($vis_mr_os_given_sel_2 || ($visMrOtherOsSel2Vision && $visMrOtherOsSel2Vision!='20/'))
						){
							$MR2ndPrismGLPH = true;
							if($vis_mr_od_given_sel_2)
							{
								$vis_mr_os_given_sel_2 = "$vis_mr_od_given_sel_2";
							}
							if($vis_mr_os_given_sel_2)
							{
								//$mr2gp4_GL_PHos[] = "GL/PH";
								$mr2gp4_GL_PHos[] = "$vis_mr_os_given_sel_2";
							}
							if($visMrOtherOsSel2Vision && $visMrOtherOsSel2Vision!='20/')
							{
								$mr2gp4_GL_PHos[] = "Vision";
								$mr2gp4_GL_PHos[] = "$visMrOtherOsSel2Vision";
							}

					$ret_str.="		<td  class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr2gp4_GL_PHos)."</td>";

                    }else{$ret_str.="<td class=\"paddingTop10\"></td>";}

					$ret_str.="	</tr>";
				$ret_str.="</table></td></tr>";

				}

			if($vis_mr_desc_other2COMMENTS!="" || trim($vis_mr_prism2COMMENTS)){

				//<!-- Description -->
				$ret_str.="<tr><td style='width:700px;'><table style='width:700px;' cellpadding='0' cellspacing='0'>";
				$ret_str.="<tr>";
				if($vis_mr_desc_other2COMMENTS!=""){
					$ret_str.="<td style=\"width:340px;\" class=\"paddingTop10\" >MR 2-Comments:&nbsp;".htmlentities($vis_mr_desc_other2COMMENTS)."</td>";
				}
				if(trim($vis_mr_prism2COMMENTS)){
					$ret_str.="<td style='width:400px;' class=\"paddingTop10\">Prism Comments:&nbsp;".htmlentities($vis_mr_prism2COMMENTS)."</td>";
				}
				$ret_str.="</tr>";
				$ret_str.="</table></td></tr>";
				//<!-- Description -->

			}
			}//END OF MR2
			} // end MR2

			if(!isset($arrTempProc)||in_array("MR 3",$arrTempProc)){
			if($show_mrList3==true){
				//Start MR3
				if(($visMrOtherOdS_3 || $visMrOtherOdC_3 || $visMrOtherOdA_3 || $visMrOtherOdAdd_3)
				||
				($visMrOtherOdTxt1_3 && $visMrOtherOdTxt1_3!='20/')
				||
				($visMrOtherOsS_3 || $visMrOtherOsC_3 || $visMrOtherOsA_3 || $visMrOtherOsAdd_3)
				||
				($visMrOtherOsTxt1_3 && $visMrOtherOsTxt1_3!='20/')
				|| ($mrPrism3 == 1)
				){
				$MR3rd = true;

				$ret_str.="<tr><td style='width:740px;'>
							<table style='width:740px;' cellpadding='0' cellspacing='0'>";
				$ret_str.="	<tr>";

						$givenMr = ($rd_vis_mr_none_given=="MR 3") ? "(Given)" : "";

				$ret_str.="		<td colspan=\"4\" class=\"tb_subheading paddingTop10\" >MR3 by ". $givenMr.$this->showDoctorName($providerIdOther_3)."  ".$elem_mr_type3."</td>";
				$ret_str.="	</tr>";
				$ret_str.="	";
				$ret_str.="		";
				$ret_str.="		";
				$ret_str.="		";

							if(
							($mrPrism3 == 1)
							&&
							($visMrOtherOdP_3 || $visMrOtherOdPrism_3 || $visMrOtherOdSlash_3 || $visMrOtherOdSel1_3)
							||
							($visMrOtherOsP_3 || $visMrOtherOsPrism_3 || $visMrOtherOsSlash_3 || $visMrOtherOsSel1_3)
							){
							$ret_str.=""; }
				$ret_str.="	";
				$ret_str.="	"; //<!-- GL/PH -->
				$ret_str.="	 ";
				$ret_str.="	<tr>";

						$mr3gp1_od[]="";
						$mr3gp1_os[]="";
						$mr3gp2_addod[]="";
						$mr3gp2_addos[]="";
						$mr3gp3_prismod[]="";
						$mr3gp3_prismos[]="";
						$mr3gp4_GL_PHod[]="";
						$mr3gp4_GL_PHos[]="";
						if($visMrOtherOdS_3)
						{
							$mr3gp1_od[] = "S";
							$mr3gp1_od[] = "$visMrOtherOdS_3";
						}
						if($visMrOtherOdC_3)
						{
							$mr3gp1_od[] = "C";
							$mr3gp1_od[] = "$visMrOtherOdC_3";
						}
						if($visMrOtherOdA_3)
						{
							$mr3gp1_od[] = "A";
							$mr3gp1_od[] = "$visMrOtherOdA_3";
						}
						if($visMrOtherOdTxt1_3 && $visMrOtherOdTxt1_3!='20/')
						{
							$mr3gp1_od[] = "$visMrOtherOdTxt1_3";
						}

				$ret_str.="			<td class=\"paddingTop10\" style=\"width:210px;\">". $this->odLable(1).implode("&nbsp;",$mr3gp1_od)."</td>";

						if($visMrOtherOdAdd_3!="" && ($visMrOtherOdS_3!="" || $visMrOtherOdC_3!="" || $visMrOtherOdA_3!=""))
						{
							$mr3gp2_addod[] = "Add";
							$mr3gp2_addod[] = "$visMrOtherOdAdd_3";
						}
						if($visMrOtherOdTxt2_3 != '' && $visMrOtherOdTxt2_3 != '20/')
						{
							$mr3gp2_addod[] = "$visMrOtherOdTxt2_3";
						}

				$ret_str.="		<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr3gp2_addod)."</td>";

						if(
						($mrPrism3 == 1)
						&&
						($visMrOtherOdP_3 || $visMrOtherOdPrism_3 || $visMrOtherOdSlash_3 || $visMrOtherOdSel1_3)
						||
						($visMrOtherOsP_3 || $visMrOtherOsPrism_3 || $visMrOtherOsSlash_3 || $visMrOtherOsSel1_3)
						){
							$MR3rdPrism = true;
							$mr3gp3_prismod[] = "";
							if($visMrOtherOdP_3)
							{
								$mr3gp3_prismod[] = "P";
								$mr3gp3_prismod[] = "$visMrOtherOdP_3";
								$mr3gp3_prismod[] = "<img src=\"$src_pic_vision_pc\"  align=\"top\"/>";
							}
							if($visMrOtherOdSel1_3)
							{
								$mr3gp3_prismod[] = "$visMrOtherOdSel1_3";
							}
							if($visMrOtherOdSlash_3)
							{
								$mr3gp3_prismod[] = "/";
								$mr3gp3_prismod[] = "$visMrOtherOdSlash_3";
							}
							if($visMrOtherOdPrism_3)
							{
								$mr3gp3_prismod[] = "$visMrOtherOdPrism_3";
							}

					$ret_str.="		<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$mr3gp3_prismod)."</td>";

						}
						$mr3gp4_GL_PHod[]="";//"OD";
						if($visMrOtherOdSel2_3 != '')
						{
							//$mr3gp4_GL_PHod[] = "GL/PH";
							$mr3gp4_GL_PHod[] = "$visMrOtherOdSel2_3";
						}
						if($visMrOtherOdSel2Vision_3 != '' && $visMrOtherOdSel2Vision_3 != '20/')
						{
							$mr3gp4_GL_PHod[] = "Vision";
							$mr3gp4_GL_PHod[] = "$visMrOtherOdSel2Vision_3";
						}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr3gp4_GL_PHod)."</td>";
					$ret_str.="</tr>";
					$ret_str.="<tr>";

						if($visMrOtherOsS_3)
						{
							$mr3gp1_os[]="S";
							$mr3gp1_os[]="$visMrOtherOsS_3";
						}
						if($visMrOtherOsC_3)
						{
							$mr3gp1_os[]="C";
							$mr3gp1_os[]="$visMrOtherOsC_3";
						}
						if($visMrOtherOsA_3)
						{
							$mr3gp1_os[]="A";
							$mr3gp1_os[]="$visMrOtherOsA_3";
						}
						if($visMrOtherOsTxt1_3 && $visMrOtherOsTxt1_3!='20/')
						{
							$mr3gp1_os[]="$visMrOtherOsTxt1_3";
						}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:210px;\">". $this->osLable(1). implode("&nbsp;",$mr3gp1_os)."</td>";

							if($visMrOtherOsAdd_3!="" && ($visMrOtherOsS_3!="" || $visMrOtherOsC_3!="" || $visMrOtherOsA_3!=""))
							{
								$mr3gp2_addos[]="Add";
								$mr3gp2_addos[]="$visMrOtherOsAdd_3";
							}
							if($visMrOtherOsTxt2_3 && $visMrOtherOsTxt2_3!='20/')
							{
								$mr3gp2_addos[]="$visMrOtherOsTxt2_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:130px;\">". implode("&nbsp;",$mr3gp2_addos)."</td>";

							$mr3gp3_prismos[]="";
							if($visMrOtherOsP_3)
							{
								$mr3gp3_prismos[]="P";
								$mr3gp3_prismos[]="$visMrOtherOsP_3";
								$mr3gp3_prismos[]="<img src=\"$src_pic_vision_pc\"  align=\"top\"/>";
							}

							if($visMrOtherOsSel1_3)
							{
								$mr3gp3_prismos[]="$visMrOtherOsSel1_3";
							}
							if($visMrOtherOsSlash_3)
							{
								$mr3gp3_prismos[]="/";
								$mr3gp3_prismos[]="$visMrOtherOsSlash_3";
							}
							if($visMrOtherOsPrism_3)
							{
								$mr3gp3_prismos[]="$visMrOtherOsPrism_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:170px;\">". implode("&nbsp;",$mr3gp3_prismos)."</td>";

							$mr3gp4_GL_PHos[] = "";
							if($visMrOtherOsSel2_3)
							{
								//$mr3gp4_GL_PHos[] = "GL/PH";
								$mr3gp4_GL_PHos[] = "$visMrOtherOsSel2_3";
							}
							if($visMrOtherOsSel2Vision_3 && $visMrOtherOsSel2Vision_3!='20/')
							{
								$mr3gp4_GL_PHos[] = "Vision";
								$mr3gp4_GL_PHos[] = "$visMrOtherOsSel2Vision_3";
							}

					$ret_str.="	<td class=\"paddingTop10\" style=\"width:220px;\">". implode("&nbsp;",$mr3gp4_GL_PHos)."</td>";
					$ret_str.="</tr>";
				$ret_str.="</table></td></tr>";

				}//End MR3



			if($vis_mr_desc_3COMMENTS!="Desc." && $vis_mr_desc_3COMMENTS!="" ||($vis_mr_prism3COMMENTS)){

			//    <!-- Description -->
			$ret_str.="<tr><td style='width:740px;'> <table style='width:740px;' cellpadding='0' cellspacing='0'>";
			$ret_str.="	<tr>";
			if($vis_mr_desc_3COMMENTS!="Desc." && $vis_mr_desc_3COMMENTS!=""){
				$ret_str.="	    <td style=\"width:340px;\" class=\"paddingTop10\">MR 3-Comments:&nbsp;".htmlentities($vis_mr_desc_3COMMENTS)."</td>";
			}
			if(trim($vis_mr_prism3COMMENTS)){
				$ret_str.="<td style='width:400px;' class=\"paddingTop10\">Prism Comments: ".htmlentities($vis_mr_prism3COMMENTS)."</td>";
			}
			$ret_str.="	</tr>";
			$ret_str.="  </table></td></tr>  ";
				//<!-- Description -->

			}
			}//END OF MR3
			} // end MR3

			$ret_str .= $this->print_getMR($pid,$fid); //Multiple PC

			$ret_str.="    </table>";


			//-- COLOR PLATE --
			//-- Color Plate Data----//
			/*
			$vis_controlValueOd = (strpos($vis_statusElements, "elem_controlValueOd=1") !== false)?$vis_controlValueOd:"";
			$vis_controlValueOs = (strpos($vis_statusElements, "elem_controlValueOs=1") !== false)?$vis_controlValueOs:"";
			$vis_steropsis = (strpos($vis_statusElements, "elem_steropsis=1") !== false)?$vis_steropsis:"";
			*/
			$vis_exo_od_s = (strpos($statusElements, "elem_visExoOdS=1") !== false)?$vis_exo_od_s:"";
			$vis_exo_od_c = (strpos($statusElements, "elem_visExoOdC=1") !== false)?$vis_exo_od_c:"";
			$vis_exo_od_a = (strpos($statusElements, "elem_visExoOdA=1") !== false)?$vis_exo_od_a:"";
			$vis_exo_os_s = (strpos($statusElements, "elem_visExoOsS=1") !== false)?$vis_exo_os_s:"";
			$vis_exo_os_c = (strpos($statusElements, "elem_visExoOsC=1") !== false)?$vis_exo_os_c:"";
			$vis_exo_os_a = (strpos($statusElements, "elem_visExoOsA=1") !== false)?$vis_exo_os_a:"";
			$vis_ret_pd_od = (strpos($statusElements, "elem_visRetOd=1") !== false)?$vis_ret_pd_od:"";
			$vis_ret_pd_os = (strpos($statusElements, "elem_visRetOs=1") !== false)?$vis_ret_pd_os:"";
			$vis_ret_pd = (strpos($statusElements, "elem_visRetPD=1") !== false)?$vis_ret_pd:"";


			//Check ICP values in Separete tables---

			$arrICP = $this->print_getICPinfo($pid,$fid);
			if(count($arrICP)>0){
				$vis_control = $arrICP[0];
				$vis_controlValueOd	= $arrICP[1];
				$vis_controlValueOd_denom= $arrICP[2];

				$vis_control_os	= $arrICP[3];
				$vis_controlValueOs= $arrICP[4];
				$vis_controlValueOs_denom= $arrICP[5];

				$vis_control_desc= $arrICP[6];

				$vis_control_ou	= $arrICP[7];
				$vis_controlValueOu= $arrICP[8];
				$vis_controlValueOu_denom= $arrICP[9];
			}

			//Check ICP values in Separete tables---

			//Check steropsis in Separete tables---

			$vis_steropsis = $this->print_getStereopsis($pid,$fid);

			//Check steropsis in Separete tables---


			/*
			if($vis_controlValueOd || $vis_controlValueOs || $vis_steropsis
				||
				$vis_exo_od_s || $vis_exo_od_c || $vis_exo_od_a || $vis_exo_os_s || $vis_exo_os_c || $vis_exo_os_a
				||
				$vis_ret_pd_od || $vis_ret_pd_os || $vis_ret_pd
				){
			*/

			//CVF
			$ret_strCVFAMS="";
			$ret_strCVFAMS.="<table style='width:730px;'  cellpadding='0' cellspacing='0'><tr>";
			if(!isset($arrTempProc)||in_array("CVF",$arrTempProc)){
				$ret_strCVFAMS.="<td style='width:350px;vertical-align:top;'>".$this->print_getCVF($pid,$fid)."</td>";
			}

			if(!isset($arrTempProc)||in_array("Amsler Grid",$arrTempProc)){
				$ret_strCVFAMS.="<td style='width:380px;vertical-align:top;'>".$this->print_AmslerGrid($pid,$fid)."</td>";
			}
			$ret_strCVFAMS.="</tr></table>";
			$ret_str.=$ret_strCVFAMS;

				$ret_str.="	<table style='width:740px;'  cellpadding='0' cellspacing='0'>";
				//Color Plate
				if(!isset($arrTempProc)||in_array("ICP Color Plate",$arrTempProc)){
				$colorPlate = true;
				if($vis_controlValueOd || $vis_controlValueOs || $vis_steropsis){

			$ret_str.="<tr><td colspan=\"5\" class='bluelne' height='1' style='width:750px;'>&nbsp;</td></tr>";
			$ret_str.="<tr><td colspan=\"5\" height='2'></td></tr>";
			$ret_str.="	<tr>";
			$ret_str.="	<td colspan=\"5\" class=\"bluehed paddingTop10\" >Color Plate:</td>";
			$ret_str.="	</tr>";

					if($vis_controlValueOd || $vis_controlValueOs || $vis_steropsis)
					{

					$ret_str.="	<tr>";
					$ret_str.="	<td style=\"width:150px;\" class=\"paddingTop10\">ICP&nbsp;Control</td>";
					$ret_str.="	<td style=\"width:150px;\" class=\"paddingTop10\">". $this->odLable(1)."</td>";
					$ret_str.="	<td style=\"width:100px;\" class=\"paddingTop10\">ICP&nbsp;Control</td>";
					$ret_str.="	<td style=\"width:100px;\" class=\"paddingTop10\">". $this->osLable(1)."</td>";
					$ret_str.="	<td style=\"width:225px;\" class=\"paddingTop10\">Stereopsis</td>";
					$ret_str.="	</tr>";

					}

					if($vis_controlValueOd || $vis_controlValueOs || $vis_steropsis){
					//<!-- vis_controlValueOs vis_control_os  -->
					$ret_str.="	<tr>";
					$ret_str.="<td style=\"width:150px;\" class=\"paddingTop10\">";
					if($vis_control == 'plus'||$vis_control == '+') $ret_str.= "+"; elseif($vis_control == 'minus'||$vis_control == '-') $ret_str.= "-";
					$ret_str.="</td>";
					$ret_str.="<td style=\"width:150px;\" class=\"paddingTop10\">";
					if($vis_controlValueOd || $vis_control) $ret_str.= $vis_controlValueOd."/".$vis_controlValueOd_denom; elseif($vis_controlValueOd=="" and $vis_control) $ret_str.= "N/A";
					$ret_str.="</td>";
					$ret_str.="<td style=\"width:100px;\" class=\"paddingTop10\">";
					if($vis_control_os == 'plus'||$vis_control_os == '+') $ret_str.= "+"; elseif($vis_control_os == 'minus' || $vis_control_os == '-') $ret_str.= "-";
					$ret_str.="</td>";
					$ret_str.="<td style=\"width:100px;\" class=\"paddingTop10\">";
					if($vis_controlValueOs || $vis_control_os) $ret_str.= $vis_controlValueOs."/".$vis_controlValueOs_denom ;
					$ret_str.="</td>";
					$ret_str.="<td  style=\"width:225px;\" class=\"paddingTop10\">";
					if($vis_steropsis) $ret_str.= $vis_steropsis; else $ret_str.= "&nbsp;";
					$ret_str.="</td>";
					$ret_str.="	</tr>";
					}
					//OU FIELD WORK STARTS FROM HERE
					if($vis_controlValueOu)
					{
					//=====	ICP OU LABEL WORK=====
						$ret_str.="	<tr>";
						$ret_str.="	<td style=\"width:150px;padding-top:10px;\" class=\"paddingTop10\">ICP&nbsp;Control</td>";
						$ret_str.="	<td style=\"width:150px;padding-top:10px;\" class=\"paddingTop10\">".$this->ouLable(1)."</td>";
						$ret_str.="	<td style=\"width:100px;padding-top:10px;\" class=\"paddingTop10\"></td>";
						$ret_str.="	<td style=\"width:100px;padding-top:10px;\" class=\"paddingTop10\"></td>";
						$ret_str.="	<td style=\"width:225px;padding-top:10px;\" class=\"paddingTop10\"></td>";
						$ret_str.="	</tr>";
					//=====	ICP OU DATA DISPLAY WORK=====
						$ret_str.="	<tr>";
						$ret_str.="<td style=\"width:150px;\" class=\"paddingTop10\">";

					if($vis_control_ou == 'plus'||$vis_control_ou == '+') $ret_str.= "+"; elseif($vis_control_ou == 'minus'||$vis_control_ou == '-')$ret_str.= "-";
					$ret_str.="</td>";
					$ret_str.="<td colspan=\"4\" style=\"width:575px;\" class=\"paddingTop10\">";

					if($vis_controlValueOu || $vis_control_ou) $ret_str.= $vis_controlValueOu."/".$vis_controlValueOu_denom; elseif($vis_controlValueOu=="" and $vis_control_ou) $ret_str.= "N/A";
					$ret_str.="</td>";
					$ret_str.="	</tr>";

					}

					//ICP DESC.
					if(!empty($vis_control_desc))
					{
						$ret_str.="<tr><td colspan=\"5\" style=\"width:700px;padding-top:10px;\" class=\"paddingTop10\"><b>Desc.</b> ".$vis_control_desc."</td></tr>";
					}

				}
				}

			$ret_str.="</table>";
			$ret_str.="<table style='width:740px;'  cellpadding='0' cellspacing='0'>";
			$ret_str.="<tr><td colspan=\"3\" class=\"bluelne\" height=\"1\" style=\"width:740px;\">&nbsp;</td></tr>";
			$ret_str.="<tr><td colspan=\"3\" height=\"2\"></td></tr>";
			$ret_str.="<tr>";

				//End Color Plate
				if(($vis_exo_od_s || $vis_exo_od_c || $vis_exo_od_a || $vis_exo_os_s || $vis_exo_os_c || $vis_exo_os_a))
				{

				if(!isset($arrTempProc)||in_array("Retinoscopy",$arrTempProc))
				{

				$ret_str.="<td><table style=\"width:300px;\" class='bdrright' cellpadding=\"0\" cellspacing=\"0\">";
				$ret_str.="<tr>";
				$ret_str.="<td class=\"text_lable paddingTop10\">RETINOSCOPY</td>";
				$ret_str.="</tr>";

					if($vis_exo_od_s || $vis_exo_od_c || $vis_exo_od_a || $vis_exo_os_s || $vis_exo_os_c || $vis_exo_os_a)
					{
							$RetinoscopyAray[]="";
							$RetinoscopyArays[]="";

				$ret_str.="<tr>";
						if($vis_exo_od_s) $RetinoscopyAray[]="S";$RetinoscopyAray[]="".$vis_exo_od_s."";
						 if($vis_exo_od_c) $RetinoscopyAray[]="C";$RetinoscopyAray[]="".$vis_exo_od_c."";
						 if($vis_exo_od_a) $RetinoscopyAray[]="A";$RetinoscopyAray[]="".$vis_exo_od_a."";
				$ret_str.="<td style=\"width:300px;\" class=\"paddingTop10\">". $this->odLable(1). implode("&nbsp;",$RetinoscopyAray)."</td>";
				$ret_str.="</tr>";
						}

					if($vis_exo_od_s || $vis_exo_od_c || $vis_exo_od_a || $vis_exo_os_s || $vis_exo_os_c || $vis_exo_os_a){

				$ret_str.="<tr>";
						if($vis_exo_os_s) $RetinoscopyArays[]="S";$RetinoscopyArays[]="".$vis_exo_os_s."";
						 if($vis_exo_os_c) $RetinoscopyArays[]="C";$RetinoscopyArays[]="".$vis_exo_os_c."";
						 if($vis_exo_os_a) $RetinoscopyArays[]="A";$RetinoscopyArays[]="".$vis_exo_os_a."";
				$ret_str.="<td style=\"width:300px;\" class=\"paddingTop10\">".$this->osLable(1).implode("&nbsp;",$RetinoscopyArays)."</td>";
				$ret_str.="</tr>";
						}
				$ret_str.="</table></td>";
						}
				}

				//Cyclo Retino --
				$colInsert=false;
				if($visCycloOdS || $visCycloOdC || $visCycloOdA || $visCycloOsS || $visCycloOsC || $visCycloOsA)
				{
					$ret_str.="<td>";
					$ret_str.="<table style=\"width:200px;\" class='bdrright' cellpadding=\"0\" cellspacing=\"0\"><tr>";
					$ret_str.="<td style=\"width:200px;\" class=\"text_lable paddingTop10\">Cycloplegic Retinoscopy</td>";
					$ret_str.="</tr>";

					$cycRetinoscopyAray[]="";
					$cycRetinoscopyArays[]="";

					$ret_str.="	<tr>";
							if($visCycloOdS) $cycRetinoscopyAray[]="S";$cycRetinoscopyAray[]="".$visCycloOdS."";
							 if($visCycloOdC) $cycRetinoscopyAray[]="C";$cycRetinoscopyAray[]="".$visCycloOdC."";
							 if($visCycloOdA) $cycRetinoscopyAray[]="A";$cycRetinoscopyAray[]="".$visCycloOdA."";
					$ret_str.="<td style=\"width:200px;\" class=\"paddingTop10\">".$this->odLable(1).implode("&nbsp;",$cycRetinoscopyAray)."</td>";
					$ret_str.="</tr>";

					$ret_str.="<tr>";
							if($visCycloOsS) $cycRetinoscopyArays[]="S";$cycRetinoscopyArays[]="".$visCycloOsS."";
							 if($visCycloOsC) $cycRetinoscopyArays[]="C";$cycRetinoscopyArays[]="".$visCycloOsC."";
							 if($visCycloOsA) $cycRetinoscopyArays[]="A";$cycRetinoscopyArays[]="".$visCycloOsA."";
					$ret_str.="<td style=\"width:200px;\" class=\"paddingTop10\">".$this->osLable(1).implode("&nbsp;",$cycRetinoscopyArays)."</td>";
					$ret_str.="</tr></table></td>";

					$ret_str.="";
					$colInsert=true;
				}

				//Cyclo Retino --


				//Exophtha
				if(!isset($arrTempProc)||in_array("Exophthalmometer",$arrTempProc))
				{

				if($vis_ret_pd_od || $vis_ret_pd_os || $vis_ret_pd)
				{	$colSpan="";
					if($colInsert==false){
						$colSpan="colspan=\"3\"";
					}

				$ret_str.="<td><table style=\"width:220px\"  class='bdrright' cellspacing=\"0\" cellpadding=\"0\">";
				$ret_str.="<tr>";
				$ret_str.="<td colspan=\"2\" style=\"width:220px;\" class=\"text_lable paddingTop10\">Exopholmalmeter</td>";
				$ret_str.="</tr>";

				if($vis_ret_pd_od || $vis_ret_pd_os || $vis_ret_pd){

				$ret_str.="<tr>";
				$ret_str.="<td colspan=\"2\" style=\"width:220px;\" class=\"paddingTop10\">PD ";
				if($vis_ret_pd) $ret_str.= $vis_ret_pd; //else echo '&nbsp';
				$ret_str.="</td>";
				$ret_str.="</tr>";
				}

				$ret_str.="<tr>";

					if($vis_ret_pd_od || $vis_ret_pd_os || $vis_ret_pd)
					{
					$ret_str.="<td style=\"width:110px;\" class=\"paddingTop10\">". $this->odLable(1); if($vis_ret_pd_od) {$ret_str.= "&nbsp;".$vis_ret_pd_od;}; $ret_str.="</td>";
					$ret_str.="<td style=\"width:110px;\" class=\"paddingTop10\">". $this->osLable(1); if($vis_ret_pd_os) {$ret_str.= "&nbsp;".$vis_ret_pd_os;}; $ret_str.="</td>";
					}

					$ret_str.="</tr></table></td>";

					if($vis_comments)
					{
					$ret_str.="</tr><tr>";
					$ret_str.="<td colspan=\"5\" class=\"paddingTop10\"><strong>Comments:</strong>"; if($vis_comments) $ret_str.=$vis_comments."</td>";
					$ret_str.="";
					}
				$ret_str.="";

				}
				}//Exophtha
			//}
			//-- COLOR PLATE -->
			$ret_str.="</tr></table>";

			//Diplopia
			if(!isset($arrTempProc)||in_array("Diplopia",$arrTempProc)){
				$ret_str.=$this->print_getDiplopia($pid,$fid);
			}

			//-- W4Dot  --
			if(!isset($arrTempProc)||in_array("W4Dot",$arrTempProc)){

				if($elem_worth4dot){
				$ret_str.="<table style=\"width:740px;\"  cellpadding=\"0\" cellspacing=\"0\">";
				$ret_str.="<tr>";
				$ret_str.="<td colspan=\"2\" style=\"width:740px;\" class=\"tb_heading\" >W4Dot</td>";
				$ret_str.="	</tr>";
				$ret_str.="	<tr>";
				$ret_str.="	<td style=\"width:100px;\" class=\"paddingTop10\">&nbsp;</td>";
				$ret_str.="	<td style=\"width:640px;\" class=\"paddingTop10\">".$elem_worth4dot."</td>";
				$ret_str.="	</tr>	";
				$ret_str.="</table>";
				}else{
					//Check in new Version
					$ret_str.=$this->print_getW4Dot($pid,$fid);
				}
			}
			//HTML --
		}

		//End Chart Vision
		return $ret_str;
	}

	public function print_getW4Dot($pid,$fid){
		$ret_str="";
		$sql = "SELECT * FROM chart_w4dot WHERE form_id= '".$fid."' AND patient_id='".$pid."' AND purged='0'  ";
		$row = sqlQuery($sql);
		if($row!=false){

			$dis=$row["distance"];
			$nr =$row["near"];
			$desc=$row["desc_w4dot"];

			$ret_str.="<table style=\"width:755px;\"  cellpadding='0' cellspacing='0'>";
			$ret_str.="<tr>";
			$ret_str.="<td colspan=\"2\" class=\"bluelne\" height=\"1\" style=\"width:750px;\" >&nbsp;</td>";
			$ret_str.="</tr>";
			$ret_str.="<tr><td colspan=\"2\" height=\"2\"></td></tr>";
			$ret_str.="<tr>";
			$ret_str.="<td colspan=\"2\" class=\"bluehed paddingTop10\">W4Dot</td>";
			$ret_str.="</tr>";
			$ret_str.="<tr>";
			$ret_str.="<td style=\"width:350px;\" class=\"paddingTop10\" >Distance : ".$dis."</td>";
			$ret_str.="<td style=\"width:350px;\" class=\"paddingTop10\" >Near. : ".$nr."</td></tr>";
			$ret_str.="<tr><td colspan=\"2\" style=\"width:700px;\" class=\"paddingTop10\">".$desc."</td>";
			$ret_str.="</tr>	";
			$ret_str.="</table>";
		}
		return $ret_str;
	}

	public function print_getDiplopia($pid,$fid){
		$retstr="";
		//-- Diplopia --//
		$sql = "SELECT * FROM chart_diplopia WHERE patientId = '".$pid."' AND formId = '".$fid."' ";
		$row = sqlQuery($sql);
		if($row != false){
			extract($row);

			$retstr.="<table>";
			$retstr.="	<tr>";
			$retstr.="		<td colspan=\"3\" class=\"bluelne\" height=\"1\" style=\"width:750px;\">&nbsp;</td>";
			$retstr.="	</tr>";
			$retstr.="	<tr>";
			$retstr.="		<td colspan=\"3\" class=\"bluehed paddingTop10\">Diplopia</td>";
			$retstr.="	</tr>";
			$retstr.="	<tr>";
			$retstr.="		<td class=\"lbl\">&nbsp;</td>";
			$retstr.="		<td class=\"sum\">".$this->odLable(1)."</td>";
			$retstr.="		<td class=\"sum\">".$this->osLable(1)."</td>";
			$retstr.="	</tr>";
			$retstr.="	<tr>";
			$retstr.="		<td class=\"lbl\">&nbsp;</td>";
			$retstr.="		<td class=\"sum\">". $summaryOd."</td>";
			$retstr.="		<td class=\"sum\">". $summaryOs."</td>";
			$retstr.="	</tr>";

				if($drawing!=""){
					$retstr.="<tr>";
					$retstr.="<td class=\"lbl\">&nbsp;</td>";
					$retstr.="<td align=\"center\" colspan=\"2\">";
					global $ChartNoteImagesString;
					$imageNAme=$this->drawOnImageImage($drawing);
					$imageNAme = $this->data_file_path."/html2pdfprint/".$imageNAme;
					if(file_exists($imageNAme) && is_file($imageNAme) ){
						$retstr.="<img src=\"".$imageNAme."\"  height=\"80\" />"; //width=\"300\" height=\"100\"
						$ChartNoteImagesString[] = $imageNAme;
						$ChartNoteImagesString[] = $gdFilename;
					}

			$retstr.="		</td>";
			$retstr.="	</tr>";

				}

			$retstr.="</table>";

		}
		//-- Diplopia --
		return $retstr;
	}

	public function print_AmslerGrid($pid,$fid){
	$retunAmslerGrid="";
	$sql = "SELECT * ".
		 "FROM amsler_grid WHERE patient_id='".$pid."' AND form_id='".$fid."' ";
	$row=sqlQuery($sql);
	if($row!=false){
		extract($row);

		$facility_id = $row["facility_id"];
		$facility_name = $this->getFacilityName($facility_id);
		$exam_date = get_date_format($row["exam_date"]);
		$app_os = $row["amsler_os"];
		$app_od = $row["amsler_od"];
		$doctor_name = $row["doctor_name"];
		$doctor_sign = $row["doctor_sign"];
		$notes=trim($row["notes"]);
		$idAmsler = $row["id"];
		$drwpth_od=$row["drwpth_od"];
		$drwpth_os=$row["drwpth_os"];


if($idAmsler != ""){

		$retunAmslerGrid.='
			<table style="width:380px;"  cellpadding="0" cellspacing="0" >
				<tr>
					<td class="bluelne" height="1" style="width:380px;" colspan="3" >&nbsp;</td>
				</tr>
				<tr>
					<td height="2" style="width:380px;" colspan="3" ></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" colspan="3" >Amsler Grid</td>
				</tr>
				';

if(!empty($drwpth_os)){
	$flg_drw_os =  true;
}else{
	$flg_drw_os =  $this->isAppletModified($app_os);
}

if(!empty($drwpth_od)){
	$flg_drw_od =  true;
}else{
	$flg_drw_od =  $this->isAppletModified($app_od);
}

if($flg_drw_os || $flg_drw_od || $wnl_flagOd || $wnl_flagOs){
	$retunAmslerGrid.='

		<tr>
			<td class="lbl paddingTop10" style="width:50px;">&nbsp;</td>
			<td class="sum paddingTop10" style="width:150px; color:blue;font-weight:bold;">OD</td>
			<td class="sum paddingTop10" style="width:150px; color:green;font-weight:bold;">OS</td>
		</tr>';

  if($flg_drw_os || $flg_drw_od){
		$retunAmslerGrid.='
		<tr>
			<td class="lbl paddingTop10" style="width:50px;">&nbsp;</td>
			<td class="sum paddingTop10" style="width:150px;">';

				//Amsler Od

				if(!empty($drwpth_od)){
					global $ChartNoteImagesString;
					$tmp = $this->data_file_path;
					$tmp .=$drwpth_od;

					$tmp=str_replace(".png","_b.png",$tmp);
					if(file_exists($tmp)){
						$retunAmslerGrid.="<img src=\"".$tmp."\" height=\"40\"/>";
						$ChartNoteImagesString[]=$tmp;
					}


				}else{

				$amslerTable = 'amsler_grid';
				$amslerIdName = 'id';
				$amslerOd = 'amsler_od';
				$amslerOdImage = realpath(dirname(__FILE__).'/../../../library/images/amsler.jpg');
				$amslerAlt = 'OD';
				global $gdFilename,$ChartNoteImagesString;
				//echo('<img src="amsler.jpg" height="100" width="200">');
				$this->getAppletImage($idAmsler,$amslerTable,$amslerIdName,$amslerOd,$amslerOdImage,$amslerAlt,"1");
				//$gdFilename = $this->data_file_path."/html2pdfprint/".$gdFilename;
				$gdFilename = $this->data_file_path."/tmp/".$gdFilename;
				if( file_exists($gdFilename)  && is_file($gdFilename) ){
				$retunAmslerGrid.=("<img src=\"".$gdFilename."\" width=\"40\"  />");//height=\"200\" width=\"200\"
				$ChartNoteImagesString[]=$gdFilename;
				}

				}
			$retunAmslerGrid.='
			</td>
			<td class="sum paddingTop10" style="width:150px;">';

				//Amsler OS
				if(!empty($drwpth_os)){
					global $ChartNoteImagesString;
					$tmp = $this->data_file_path;
					$tmp .=$drwpth_os;

					$tmp=str_replace(".png","_b.png",$tmp);
					if(file_exists($tmp)){
						$retunAmslerGrid.="<img src=\"".$tmp."\" height=\"40\"/>";
						$ChartNoteImagesString[]=$tmp;
					}

				}else{
					$amslerTable = 'amsler_grid';
					$amslerIdName = 'id';
					$amslerOs = 'amsler_os';
					$amslerOsImage = realpath(dirname(__FILE__).'/../../../library/images/amsler.jpg');
					$amslerAlt = 'OS';
					global $gdFilename,$ChartNoteImagesString;
					$this->getAppletImage($idAmsler,$amslerTable,$amslerIdName,$amslerOs,$amslerOsImage,$amslerAlt,"1");
					//$gdFilename = $this->data_file_path."/html2pdfprint/".$gdFilename;
					$gdFilename = $this->data_file_path."/tmp/".$gdFilename;
					if( file_exists($gdFilename)  && is_file($gdFilename) ){
					$retunAmslerGrid.=("<img src=\"".$gdFilename."\" width=\"40\" />"); //height=\"200\" width=\"200\"
					$ChartNoteImagesString[]=$gdFilename;
					}
				}
				$retunAmslerGrid.='
			</td>
		</tr>';
  }
    if($wnl_flagOd || $wnl_flagOs){
	$wnlString =  !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("Amsler Grid", $pid, $fid);
$retunAmslerGrid.='
		<tr>
			<td class="lbl paddingTop10" style="width:50px;">&nbsp;</td>
			<td class="sum paddingTop10" style="width:150px;">';

				//Amsler Od
				$retunAmslerGrid.=($wnl_flagOd) ? $wnlString : ""; //WNL
			$retunAmslerGrid.='
			</td>
			<td class="sum paddingTop10" style="width:150px;">';

				//Amsler OS
				$retunAmslerGrid.= ($wnl_flagOs) ? $wnlString : "";
			$retunAmslerGrid.='
			</td>
		</tr>';

  }


}

	if($notes<>"") {
		$retunAmslerGrid.='
		<tr>
			<td colspan="3" style="width:300px;" class="paddingTop10"><b>Notes:&nbsp;</b>'.$notes.'</td>
		</tr>';

	}
	$retunAmslerGrid.='
	<tr>
		<td colspan="3" style="width:300px;" class="paddingTop10">
			<b>Performed By:&nbsp;</b>'.$this->showDoctorName($doctor_name).'
		</td>
	</tr>
	<tr>
		<td></td>
		<td></td>
		<td></td>
	</tr>
</table>';

}

	}
	return $retunAmslerGrid;
}


public function drawOnImageImage($pixls){
		//If No Image set White Image
		$imgDefault = $GLOBALS['webroot']."/library/images/Diplopia.png";
		if((file_exists($imgDefault))){
			$imgName = $imgDefault;
		}
		//Make two array
		$arrstrings = array();
		$arrpixels = array();
		$imgcr =imagecreatefrompng($imgName);
		imagealphablending($imgcr, false);
		imagesavealpha($imgcr, true);
	 	$arrstrings = explode(";",$pixls);
		$strings_count = count($arrstrings);
		$strings_in = 0;
		$lc = 10;
		while($strings_in < $strings_count) // String 0 Se Count  String tak Chale
		{
			if(empty($arrstrings[$strings_in])){
				$strings_in++;
				continue;
			}
			//Explode by : to separete image and pixels
			list($icoCode,$strPixel) = explode(":",$arrstrings[$strings_in]);
			// get Pixels in array
			$arrpixels = explode(",",$strPixel);
			$pixels_count = count($arrpixels);
			$addImgName = "";
			$addImgName = $this->data_file_path.'/html2pdfprint/'.$icoCode.'.jpeg';
			$addImgNameJPG = $this->data_file_path.'/html2pdfprint/'.$icoCode.'.jpeg';

			if(file_exists($addImgName)){
				list($sImgWidth,$sImgHeight) = getimagesize($addImgName);
				$sourcImg = imagecreatefromjpeg($addImgName);
				// Copy and merge
				imagecopymerge($imgcr, $sourcImg, $arrpixels[0], $arrpixels[1], 0, 0, $sImgWidth, $sImgHeight, 75); //$sImgWidth, $sImgHeight
			}else{
			if(file_exists($addImgNameJPG)){
				list($sImgWidth,$sImgHeight) = getimagesize($addImgNameJPG);
				$sourcImg = imagecreatefromjpeg($addImgNameJPG);
				// Copy and merge
				imagecopymerge($imgcr, $sourcImg, $arrpixels[0], $arrpixels[1], 0, 0, $sImgWidth, $sImgHeight, 75); //$sImgWidth, $sImgHeight
				}
			}
			$strings_in++;
		}
		$fname=rand(10,100000).".jpg";
		$fname3=$this->data_file_path."/html2pdfprint/".$fname;
		imagejpeg($imgcr,$fname3);
		//imagepng($imgcr,$fname);
		//@copy($fname,$fname3);
		//imagegif($imgcr,"123.gif");
		imagedestroy($imgcr);
		return $fname;
	}

public function getLensManufacturer(){
	$arrLensManuf= array();
	$lensListQry= "SELECT clmk.*, cpttbl.cpt_fee_id, cpttbl.cpt4_code, cpttbl.cpt_prac_code, cpttbl.cpt_prac_code FROM contactlensemake clmk
LEFT JOIN cpt_fee_tbl cpttbl ON cpttbl.cpt_fee_id = clmk.cpt_fee_id order by clmk.make_id";
	$lensListRes = imw_query($lensListQry) or die(imw_error());
	$lensListNumRow = imw_num_rows($lensListRes);
	if($lensListNumRow>0) {
		$i=0;
		while($lensListRow=imw_fetch_array($lensListRes)) {
				$lensManuf='';
				$arrLensManuf[$lensListRow['make_id']]['cpt_fee_id'] = $lensListRow['cpt_fee_id'];
				$arrLensManuf[$lensListRow['make_id']]['cpt4Code'] = $lensListRow['cpt4_code'];
				$arrLensManuf[$lensListRow['make_id']]['cpt_prac_code'] = $lensListRow['cpt_prac_code'];
				if($lensListRow['type']==''){
					$lensManuf = $lensListRow['style'];
				}else{
					$lensManuf = $lensListRow['style'].'-'.$lensListRow['type'];
				}
				$arrLensManuf[$lensListRow['make_id']]['det'] = $lensManuf;

				if($lensListRow['price']<=0){
					$cptQry 	= "SELECT cpt_fee FROM cpt_fee_table WHERE cpt_fee_id ='".$lensListRow['cpt_fee_id']."' AND fee_table_column_id=1";
					$cptRes 	= imw_query($cptQry) or die(imw_error());
					$cptNumRow	= imw_num_rows($cptRes);
					if($cptNumRow>0) {
						$cptRow	=imw_fetch_array($cptRes);
						$arrLensManuf[$lensListRow['make_id']]['price'] = $cptRow['cpt_fee'];
					}
				}else{
					$arrLensManuf[$lensListRow['make_id']]['price'] = $lensListRow['price'];
				}
		}
	}
	return $arrLensManuf;
}



public function print_contectLens($pid,$fid){

	//GET ALL LENS MANUFACTURER IN ARRAY
	$arrLensManuf = $this->getLensManufacturer();

	$sql=imw_query("SELECT clws_id, provider_id, clGrp, clws_type, clws_trial_number, DATE_FORMAT(clws_savedatetime,'".get_sql_date_format()."') AS worksheetdate,
				DATE_FORMAT(dos, '".get_sql_date_format()."') AS dos, AverageWearTime,Solutions,Age, DisposableSchedule FROM contactlensmaster
				WHERE patient_id='".$pid."' AND form_id='".$fid."' ORDER BY clws_id desc");

	$tempArr=array();
	$final_clws_id=0;
	while($row= imw_fetch_assoc($sql)){
	  if(strpos($row['clws_type'],"Final")!== false){
		$final_clws_id = $row['clws_id'];
		break;
      }
	  $tempArr[]=$row['clws_id'];
	}

	$clws_id=0;
	if($final_clws_id>0){
		$clws_id=$final_clws_id;
	}else{
		$clws_id=$tempArr[0];
	}

	if($clws_id>0){

		$sql2="SELECT clws_id, provider_id, clGrp, clws_type, clws_trial_number, DATE_FORMAT(clws_savedatetime,'".get_sql_date_format()."') AS worksheetdate,
				DATE_FORMAT(dos, '".get_sql_date_format()."') AS dos, AverageWearTime,Solutions,Age, DisposableSchedule FROM contactlensmaster
				WHERE clws_id ='".$clws_id."' ORDER BY clws_id desc LIMIT 0,1";

		$row=sqlQuery($sql2);
	}

	$pdf_data='<table style="width:750px;"  cellpadding="0" cellspacing="0"  >';
	if($row!=false){
		extract($row);
		$pdf_data.='<tr><td class="bluelne" height="1" style="width:750px;">&nbsp;</td></tr>';
		$pdf_data.='<tr><td height="2"></td></tr>';
		$pdf_data.='<tr><td class="bluehed text_cap paddingTop10">CONTACT LENS ('.$clws_type.')</td></tr>';
	}

	if(($clws_type =="Evaluation" || $clws_type =="Fit" || $clws_type =="Refit") &&
		($AverageWearTime!="" || $Solutions!="" || $Age!="" || $DisposableSchedule!="" ))
	{
		$pdf_data .= '<tr><td style="width:740px;">
		<table class="conlen" style="width:740px;" cellpadding="0" cellspacing="0">
			<tr>
				<td style="width:125px;" class="paddingTop10 lbl">Evaluation / Refit</td>';
				if($AverageWearTime!=""){
					$pdf_data .= '
					<td class="lbl paddingTop10" style="width:120px;">Average Wear Time: </td>
					<td style="width:50px;" class="paddingTop10">'.$AverageWearTime.'</td>';
				}
				if($Solutions!=""){
					$pdf_data .= '
					<td class="lbl paddingTop10" style="width:60px;">Solutions: </td>
					<td class="paddingTop10" style="width:50px;">'.$Solutions.'</td>
					';
				}
				if($Age!=""){
					$pdf_data .= '
					<td class="lbl paddingTop10" style="width:30px;">Age: </td>
					<td class="paddingTop10" style="width:30px;" >'.$Age.'</td>';
				}
				if($DisposableSchedule!=""){
					$pdf_data .= '
					<td class="lbl paddingTop10" style="width:130px;">Disposable Schedule: </td>
					<td class="paddingTop10" style="width:100px;">'.$DisposableSchedule.'</td>';
				}
			$pdf_data .= '</tr>
		</table></td></tr>';
	}
	if(!empty($pdf_data)){

	//START CODE TO GET WORKSHEET DETAIL
	$sclprintHeader = 0;	$rgpprintHeader = 0;	$crgpprintHeader = 0;	$clEye_flag = '';	$scl_flag = false; $rgp_flag = false;
	$sql= "SELECT clw.* FROM contactlensworksheet_det clw JOIN contactlensmaster clm ON (clw.clws_id = clm.clws_id)
						WHERE clw.clws_id='".$clws_id."' order by clEye";
	$rez=sqlStatement($sql);
	for($i=0;$row=sqlFetchArray($rez);$i++){

		$clType=$row['clType']=='scl'?'SCL':($row['clType']=='rgp'?'RGP':($row['clType']=='cust_rgp'?'Custom RGP':''));
		$clEye = $row['clEye'];
		$cleyeClass = $clEye=='OD' ? 'text_blue' : ($clEye=='OS' ? 'text_green' : '');
		if($clEye_flag != $clEye){
			$clEye_flag = $clEye;
			$sclprintHeader = 1;			$rgpprintHeader = 1;			$crgpprintHeader = 1;
		}

		if($row['clType']=='scl'){
			//$pdf_data .= '<style> .sctable td{ border:1px solid red; } </style>	';
			$pdf_data .= '<tr><td style="width:740px;">
			<table class="sctable conlen" cellpadding="0" cellspacing="0" style="width:740px;">';
			if($sclprintHeader == 1){
				$pdf_data .= '
				  <tr >
					<td style="width:30px;">&nbsp;</td>
					<td style="width:30px;">&nbsp;</td>
					<td style="width:65px;" class="paddingTop10 lbl">Sphere</td>
					<td style="width:65px;" class="paddingTop10 lbl">Cylinder</td>
					<td style="width:65px;" class="paddingTop10 lbl">Axis</td>
					<td style="width:65px;" class="paddingTop10 lbl">B.Curve</td>
					<td style="width:65px;" class="paddingTop10 lbl">Diameter</td>
					<td style="width:65px;" class="paddingTop10 lbl">ADD</td>
					<td style="width:65px;" class="paddingTop10 lbl">DVA</td>
					<td style="width:65px;" class="paddingTop10 lbl">NVA</td>
					<td style="width:90px;" class="paddingTop10 lbl">Type</td>
				   </tr>';
				$sclprintHeader = 0;
			}
			$scl_flag = true;
			$pdf_data .= '
			<tr>
				<td style="width:30px;" class="paddingTop10 lbl" >'.$clType.'</td>
				<td style="width:30px;" class="paddingTop10'.$cleyeClass.'">'.$clEye.'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['Sclsphere'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclCylinder'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['Sclaxis'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclBcurve'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclDiameter'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclAdd'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclDva'.$clEye].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['SclNva'.$clEye].'</td>
				<td style="width:90px;" class="paddingTop10 ">'.$arrLensManuf[$row['SclType'.$clEye.'_ID']]['det'].'</td>
			   </tr>
			</table></td></tr>';
		}//end of scl
		else if($row['clType']=='rgp'){
			$pdf_data .= '<tr><td style="width:740px;">
			<table class="sctable conlen" style="width:740px;" cellpadding="0" cellspacing="0">';
			if($rgpprintHeader == 1){
				$pdf_data .= '
				  <tr >
					<td style="width:30px;" class="paddingTop10lbl" class="lbl">&nbsp;</td>
					<td style="width:30px;" class="paddingTop10lbl>&nbsp;</td>
					<td style="width:41px;" class="paddingTop10lbl">Power</td>
					<td style="width:30px;" class="paddingTop10lbl">BC</td>
					<td style="width:55px;" class="paddingTop10lbl">Diameter</td>
					<td style="width:30px;" class="paddingTop10lbl">OZ</td>
					<td style="width:30px;" class="paddingTop10lbl">CT</td>
					<td style="width:55px;" class="paddingTop10lbl">Color</td>
					<td style="width:55px;" class="paddingTop10lbl">Latitude</td>
					<td style="width:55px;" class="paddingTop10lbl">Add</td>
					<td style="width:55px;" class="paddingTop10lbl">DVA</td>
					<td style="width:55px;" class="paddingTop10lbl">NVA</td>
					<td style="width:60px;" class="paddingTop10lbl">Type</td>
					<td style="width:65px;" class="paddingTop10 lbl">Warranty</td>
				   </tr>';
				$rgpprintHeader = 0;
			}
			$rgp_flag = true;
			$pdf_data .= '
			<tr valign="top">
				<td style="width:30px;vertical-align:top;" class="paddingTop10 lbl">'.$clType.'</td>
				<td style="width:30px;vertical-align:top;" class="paddingTop10'.$cleyeClass.'" >'.$clEye.'</td>
				<td style="width:41px;" class="paddingTop10">'.$row['RgpPower'.$clEye].'</td>
				<td style="width:30px;" class="paddingTop10">'.$row['RgpBC'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpDiameter'.$clEye].'</td>
				<td style="width:30px;" class="paddingTop10">'.$row['RgpOZ'.$clEye].'</td>
				<td style="width:30px;" class="paddingTop10">'.$row['RgpCT'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpColor'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpLatitude'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpAdd'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpDva'.$clEye].'</td>
				<td style="width:55px;" class="paddingTop10">'.$row['RgpNva'.$clEye].'</td>
				<td style="width:60px;" class="paddingTop10">'.$arrLensManuf[$row['RgpType'.$clEye.'_ID']]['det'].'</td>
				<td style="width:65px;" class="paddingTop10">'.$row['RgpWarranty'.$clEye].'</td>
		   </tr>
		</table></td></tr>';
		}//end of rgp
		else if($row['clType']=='cust_rgp'){
			$pdf_data .= '<tr><td style="width:740px;">
			<table id="crgp" class="sctable conlen" style="width:740px;" cellpadding="0" cellspacing="0">';
			if($crgpprintHeader == 1){
				$pdf_data .= '
					  <tr >
						<td style="width:30px;" class="paddingTop10 ">&nbsp;</td>
						<td style="width:30px;" class="paddingTop10">&nbsp;</td>
						<td style="width:35px;" class="paddingTop10lbl">Power</td>
						<td style="width:20px;" class="paddingTop10lbl">BC</td>
						<td style="width:30px;" class="paddingTop10lbl">2&#176;/W</td>
						<td style="width:30px;" class="paddingTop10lbl">3&#176;/W</td>
						<td style="width:35px;" class="paddingTop10lbl">PC/W</td>
						<td style="width:35px;" class="paddingTop10lbl">Diameter</td>
						<td style="width:20px;" class="paddingTop10lbl">OZ</td>
						<td style="width:20px;" class="paddingTop10lbl">CT</td>
						<td style="width:35px;" class="paddingTop10lbl">Color</td>
						<td style="width:35px;" class="paddingTop10lbl">Blend</td>
						<td style="width:35px;" class="paddingTop10lbl">Edge</td>
						<td style="width:35px;" class="paddingTop10lbl">Latitude</td>
						<td style="width:35px;" class="paddingTop10lbl">Add</td>
						<td style="width:35px;" class="paddingTop10lbl">DVA</td>
						<td style="width:35px;" class="paddingTop10lbl">NVA</td>
						<td style="width:35px;" class="paddingTop10lbl">Type</td>
						<td style="width:40px;" class="paddingTop10 lbl">Warranty</td>

					   </tr>';
				$crgpprintHeader = 0;
			}
			$rgp_flag = true;

			if($clType=="Custom RGP"){
				$clType_2 = "C. RGP";
			}else{
				$clType_2 = $clType;
			}

			$pdf_data .= '
			<tr>
				<td style="width:30px;" class="paddingTop10">'.$clType_2.'</td>
				<td style="width:30px;" class="paddingTop10'.$cleyeClass.'" >'.$clEye.'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomPower'.$clEye].'</td>
				<td style="width:20px;" class="paddingTop10">'.$row['RgpCustomBC'.$clEye].'</td>
				<td style="width:30px;" class="paddingTop10">'.$row['RgpCustom2degree'.$clEye].'</td>
				<td style="width:30px;" class="paddingTop10">'.$row['RgpCustom3degree'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomPCW'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomDiameter'.$clEye].'</td>
				<td style="width:20px;" class="paddingTop10">'.$row['RgpCustomOZ'.$clEye].'</td>
				<td style="width:20px;" class="paddingTop10">'.$row['RgpCustomCT'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.trim($row['RgpCustomColor'.$clEye]).'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomBlend'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomEdge'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomLatitude'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomAdd'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomDva'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$row['RgpCustomNva'.$clEye].'</td>
				<td style="width:35px;" class="paddingTop10">'.$arrLensManuf[$row['RgpCustomType'.$clEye.'_ID']]['det'].'</td>
				<td style="width:40px;" class="paddingTop10">'.$row['RgpCustomWarranty'.$clEye].'</td>
		   </tr>
		   ';
		$pdf_data .='</table></td></tr>';
		}//end of custom rgp
	}

	if($i>0){
	$clEye_flag = $clEye;
	}

	if($scl_flag==true || $rgp_flag==true){
	$sql = "SELECT * FROM contactlens_evaluations WHERE clws_id = '".$clws_id."'";
	$row = sqlQuery($sql);
	if($row!=false){

		if($scl_flag==true && (!empty($row['CLSLCEvaluationSphereOD'])||!empty($row['CLSLCEvaluationSphereOS']))){
			$pdf_data .= '<tr><td style="width:740px;">
				<table class="sctable conlen" id="crgp" style="width:740px;" cellpadding="0" cellspacing="0">
				<tr>
					<td  colspan="9" style="width:430px;" class="lbl paddingTop10">Over&nbsp;Refraction</td>
					<td  colspan="5" class="lbl paddingTop10">CL Fittings-SCL</td>
				</tr>
				<tr >
					<td style="width:30px;" class="paddingTop10lbl">&nbsp;</td>
					<td style="width:50px;" class="paddingTop10lbl">Sphere</td>
					<td style="width:50px;" class="paddingTop10lbl">Cylinder</td>
					<td style="width:50px;" class="paddingTop10lbl">Axis</td>
					<td style="width:50px;" class="paddingTop10lbl">DVA</td>
					<td style="width:50px;" class="paddingTop10lbl">Sphere</td>
					<td style="width:50px;" class="paddingTop10lbl">Cylinder</td>
					<td style="width:50px;" class="paddingTop10lbl">Axis</td>
					<td style="width:50px;" class="paddingTop10lbl">NVA</td>
					<td style="width:50px;" class="paddingTop10lbl">Comfort</td>
					<td style="width:50px;" class="paddingTop10lbl">Movement</td>
					<td style="width:55px;" class="paddingTop10lbl">Position</td>';
				if($clws_type =="Evaluation" || $clws_type =="Fit" || $clws_type =="Refit"){
				$pdf_data .= '
					<td style="width:55px;" class="paddingTop10lbl">Condition</td>';
				}
				$pdf_data .= '
				</tr>';

				if($clGrp=="OD" || $clGrp=="OU"){
				$pdf_data .= '
				<tr>
					<td style="width:30px;" class="paddingTop10text_blue">OD</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationSphereOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationCylinderOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationAxisOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationDVAOD'].'</td>

					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationSphereNVAOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationCylinderNVAOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationAxisNVAOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationNVAOD'].'</td>

					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationComfortOD'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationMovementOD'].'</td>
					<td style="width:55px;" class="paddingTop10" >'.$row['CLSLCEvaluationPositionOD'].'</td>';
					if($clws_type =="Evaluation" || $clws_type =="Fit" || $clws_type =="Refit"){
					$pdf_data .= '
					<td style="width:55px;" class="paddingTop10">'.$row['CLSLCEvaluationCondtionOD'].'</td>';
					}
				$pdf_data .= '
				</tr>';
				}

				if($clGrp=="OS" || $clGrp=="OU"){
				$pdf_data .= '
				<tr>
					<td style="width:30px;" class="paddingTop10text_green">OS</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationSphereOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationCylinderOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationAxisOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationDVAOS'].'</td>

					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationSphereNVAOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationCylinderNVAOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationAxisNVAOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationNVAOS'].'</td>

					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationComfortOS'].'</td>
					<td style="width:50px;" class="paddingTop10">'.$row['CLSLCEvaluationMovementOS'].'</td>
					<td style="width:55px;" class="paddingTop10">'.$row['CLSLCEvaluationPositionOS'].'</td>';
					if($clws_type =="Evaluation" || $clws_type =="Fit" || $clws_type =="Refit"){
					$pdf_data .= '
					<td style="width:55px;" class="paddingTop10">'.$row['CLSLCEvaluationCondtionOS'].'</td>';
					}
				$pdf_data .= '
				</tr>';
				}

				if($row['CLSLCEvaluationCommentsOD']!="" &&($clGrp=="OD" || $clGrp=="OU")){
				$pdf_data .= '
				<tr>
					<td class="text_blue paddingTop10">OD</td>
					<td colspan="13" class="paddingTop10"><b>Comments:</b> '.$row['CLSLCEvaluationCommentsOD'].'</td>
				</tr>';
				}
				if($row['CLSLCEvaluationCommentsOS']!="" && ($clGrp=="OS" || $clGrp=="OU")){
				$pdf_data .= '
				<tr>
					<td class="text_green paddingTop10">OS</td>
					<td colspan="13" class="paddingTop10"><b>Comments:</b> '.$row['CLSLCEvaluationCommentsOS'].'</td>
				</tr>';
				}

			$pdf_data .= '
			</table></td></tr>';
		}//if(sclflag==true)

		if($rgp_flag==true && (!empty($row['CLRGPEvaluationComfortOD'])||!empty($row['CLRGPEvaluationComfortOS']))){
			$pdf_data .= '<tr><td style="width:740px;">
				<table class="sctable conlen" id="crgp" style="width:740px;" cellpadding="0" cellspacing="0">';

			$pdf_data .= '
				<tr>
					<td colspan="7" class="lbl paddingTop10" style="width:455px;">CL Evaluation/Fittings - RGP (with or without Custom)</td>
					<td colspan="5" class="lbl paddingTop10" >Over Refraction</td>
				</tr>';

			$pdf_data .='	<tr >
					<td style="width:30px" class="paddingTop10 lbl">&nbsp;</td>
					<td style="width:55px;" class="paddingTop10lbl">Comfort</td>
					<td style="width:55px;" class="paddingTop10lbl">Movement</td>
					<td style="width:80px;" class="paddingTop10lbl">Pos. Before Blink</td>
					<td style="width:80px;" class="paddingTop10lbl">Pos. After Blink</td>
					<td style="width:90px;" class="paddingTop10lbl">Fluorescein Pattern</td>
					<td style="width:65px;" class="paddingTop10lbl">Inverted Lids</td>
					<td style="width:55px;" class="paddingTop10lbl">Sphere</td>
					<td style="width:60px;" class="paddingTop10lbl">Cylinder</td>
					<td style="width:30px;" class="paddingTop10lbl">Axis</td>
					<td style="width:30px;" class="paddingTop10lbl">DVA</td>
					<td style="width:30px;" class="paddingTop10 lbl">NVA</td>
				</tr>';

				if($clGrp=="OD" || $clGrp=="OU"){
				$pdf_data .= '
				<tr>
					<td style="width:30px" class="paddingTop10 text_blue" >OD</td>
					<td style="width:55px;" class="paddingTop10">'.$row['CLRGPEvaluationComfortOD'].'</td>
					<td style="width:55px;" class="paddingTop10">'.$row['CLRGPEvaluationMovementOD'].'</td>
					<td style="width:80px;" class="paddingTop10">'.$row['CLRGPEvaluationPosBeforeOD'].'</td>
					<td style="width:80px;" class="paddingTop10">'.$row['CLRGPEvaluationPosAfterOD'].'</td>

					<td style="width:90px;" class="paddingTop10">'.$row['CLRGPEvaluationFluoresceinPatternOD'].'</td>
					<td style="width:65px;" class="paddingTop10">'.$row['CLRGPEvaluationInvertedOD'].'</td>
					<td style="width:55px;" class="paddingTop10">'.$row['CLRGPEvaluationSphereOD'].'</td>
					<td style="width:60px;" class="paddingTop10">'.$row['CLRGPEvaluationCylinderOD'].'</td>

					<td style="width:30px;" class="paddingTop10">'.$row['CLRGPEvaluationAxisOD'].'</td>
					<td style="width:30px;" class="paddingTop10">'.$row['CLRGPEvaluationDVAOD'].'</td>
					<td style="width:30px;" class="paddingTop10 ">'.$row['CLRGPEvaluationNVAOD'].'</td>
				</tr>';
				}

				if($clGrp=="OS" || $clGrp=="OU"){
				$pdf_data .= '
				<tr>
					<td style="width:30px" class="paddingTop10 text_green" >OS</td>
					<td style="width:55px;" class="paddingTop10" >'.$row['CLRGPEvaluationComfortOS'].'</td>
					<td style="width:55px;" class="paddingTop10" >'.$row['CLRGPEvaluationMovementOS'].'</td>
					<td style="width:80px;" class="paddingTop10">'.$row['CLRGPEvaluationPosBeforeOS'].'</td>
					<td style="width:80px;" class="paddingTop10">'.$row['CLRGPEvaluationPosAfterOS'].'</td>

					<td style="width:90px;" class="paddingTop10">'.$row['CLRGPEvaluationFluoresceinPatternOS'].'</td>
					<td style="width:65px;" class="paddingTop10">'.$row['CLRGPEvaluationInvertedOS'].'</td>
					<td style="width:55px;" class="paddingTop10">'.$row['CLRGPEvaluationSphereOS'].'</td>
					<td style="width:60px;" class="paddingTop10">'.$row['CLRGPEvaluationCylinderOS'].'</td>

					<td style="width:30px;" class="paddingTop10">'.$row['CLRGPEvaluationAxisOS'].'</td>
					<td style="width:30px;" class="paddingTop10">'.$row['CLRGPEvaluationDVAOS'].'</td>
					<td style="width:30px;" class="paddingTop10 ">'.$row['CLRGPEvaluationNVAOS'].'</td>
				</tr>';
				}

				if($row['CLRGPEvaluationCommentsOD']!="" &&($clGrp=="OD" || $clGrp=="OU")){
				$pdf_data .= '
				<tr>
					<td class="text_blue paddingTop10">OD</td>
					<td colspan="11" class="paddingTop10 " ><b>Comments:</b> '.$row['CLRGPEvaluationCommentsOD'].'</td>
				</tr>';
				}
				if($row['CLRGPEvaluationCommentsOS']!="" && ($clGrp=="OS" || $clGrp=="OU")){
				$pdf_data .= '
				<tr>
					<td class="text_green paddingTop10">OS</td>
					<td colspan="11" class="paddingTop10"><b>Comments:</b> '.$row['CLRGPEvaluationCommentsOS'].'</td>
				</tr>';
				}

			$pdf_data .= '
			</table></td></tr>';
		}

	}
	}
	$pdf_data .= '</table>';
	echo $pdf_data ;
}

}


	public function print_getStereopsis($pid,$fid){
		$ret="";

		$sql = "SELECT seconds_of_arc FROM chart_steropsis WHERE form_id= '".$fid."' AND patient_id='".$pid."' AND purged='0' ";
		$row = sqlQuery($sql);
		if($row!= false){

			$ret = $row["seconds_of_arc"];

		}

		return $ret;
	}

	public function print_getCVF($pid,$fid){
		global $gdFilename,$ChartNoteImagesString;

		$retstr="";
		$sql = "SELECT * FROM chart_cvf WHERE patientId = '".$pid."' and formId = '".$fid."' ";
		$row = sqlQuery($sql);
		if($row != false){
			extract($row);

			$retstr.="<table style=\"width:360px\"  cellpadding=\"0\" cellspacing=\"0\">";
			$retstr.="<tr>";
			$retstr.="<td colspan=\"2\" class=\"bluelne\" height=\"1\" style=\"width:360px;\">&nbsp;</td>";
			$retstr.="</tr>";
			$retstr.="<tr>";
			$retstr.="<td colspan=\"2\" height=\"2\" style=\"width:360px;\"></td>";
			$retstr.="</tr>";
			$retstr.="<tr>";
			$retstr.="<td colspan=\"2\" class=\"bluehed paddingTop10\">CVF (Confrontation Field)</td>";
			$retstr.="";
			$retstr.="</tr>";
			$retstr.="<tr>";
			$retstr.="<td class=\"sum paddingTop10\" style=\"width:180px;text-align:center;\" >".$this->odLable(1)."</td>";
			$retstr.="<td class=\"sum paddingTop10\" style=\"width:180px;text-align:center;\" >".$this->osLable(1)."</td>";
			$retstr.="";

			$retstr.="</tr>";
			if(trim($summaryOd) || trim($summaryOs)){
			$retstr.="<tr>";
			$retstr.="<td class=\"sum paddingTop10\" style=\"width:180px;\">"; if($summaryOd) $retstr.= $summaryOd; else $retstr.= "&nbsp;"; $retstr.="</td>";
			$retstr.="<td class=\"sum paddingTop10\" style=\"width:180px;\">"; if($summaryOs) $retstr.= $summaryOs; else $retstr.= "&nbsp;"; $retstr.="</td>";
			$retstr.="";
			$retstr.="</tr>";
			}
			$retstr.="<tr>";
		   // $retstr.="<td class=\"lbl paddingTop10\">&nbsp;</td>";
		   $bdrClass="";
		   if(!empty($drwpth_od) || $this->isAppletModified(trim($drawOd))){$bdrClass="paddingTop10";}
			$retstr.="<td class=\"sum $bdrClass\" style=\"width:180px;\" >";

			if(!empty($drwpth_od)){
			$tmp = $this->data_file_path;
			$tmp .=$drwpth_od;


			$tmp=str_replace(".png","_b.png",$tmp);
			if(file_exists($tmp))
			{
				$retstr.= "<img src=\"".$tmp."\" height=\"40\" align=\"center\" />";
				$ChartNoteImagesString[] = $tmp;
			}

			}else{

				if($this->isAppletModified(trim($drawOd))){
				$imagecvf1 = "";
				$tableLA = 'chart_cvf';
				$idNameLA = 'cvf_id';
				$pixelLaDrawing = 'drawOd';
				$imageLA = '../../../library/images/picEomCvf.jpg';
				$altLA = 'CVF';
					if($this->getAppletImage($cvf_id,$tableLA,$idNameLA,$pixelLaDrawing,$imageLA,$altLA,"1"))
					{
						$gdFilename = $this->data_file_path."/html2pdfprint/".$gdFilename;
						if(file_exists($gdFilename) && is_file($gdFilename) )
						{
							$retstr.="<img src=\"".$gdFilename."\" height=\"40\" align=\"center\" />";
							$ChartNoteImagesString[]=$gdFilename;	//CHECKING
						}
					}
				}
			}

		   $retstr.="</td>";
		   $clssBdr="";
		   if(!empty($drwpth_os)|| $this->isAppletModified(trim($drawOd))){ $clssBdr="paddingTop10";}
		   $retstr.="<td class=\"sum  $clssBdr \" style=\"width:180px;\" >";

		   if(!empty($drwpth_os)){
			$tmp = $this->data_file_path;
			$tmp .=$drwpth_os;

			$tmp=str_replace(".png","_b.png",$tmp);
			if(file_exists($tmp)){
				$retstr.= "<img src=\"".$tmp."\" height=\"40\" align=\"center\" />";
				$ChartNoteImagesString[]=$tmp;
			}

			}else{

				if($this->isAppletModified(trim($drawOd))){
				$imagecvf1 = "";
				$tableLA = 'chart_cvf';
				$idNameLA = 'cvf_id';
				$pixelLaDrawing = 'drawOs';
				$imageLA = '../../../library/images/picEomCvf.jpg';
				$altLA = 'CVF';
				if($this->getAppletImage($cvf_id,$tableLA,$idNameLA,$pixelLaDrawing,$imageLA,$altLA,"1"))
				{
					$gdFilename = $this->data_file_path."/html2pdfprint/".$gdFilename;
					if(file_exists($gdFilename) && is_file($gdFilename) )
					{
						$retstr.="<img src=\"".$gdFilename."\" height=\"40\" align=\"center\" />"; //width=\"200\"
						$ChartNoteImagesString[]=$gdFilename;
					}
				}

				}
			}

		  $retstr.="</td>";
		  $retstr.="";

		  $retstr.="</tr>";
		  $retstr.="</table>";

		}
		//-- CVF --
		return $retstr;
	}

	public function print_getICPinfo($pid,$fid){
		$arr=array();
		$sql = "SELECT * FROM chart_icp_color WHERE form_id= '".$fid."' AND patient_id='".$pid."' AND purged='0' ";
		$row = sqlQuery($sql);
		if($row!=false){

			$arr=array(	$row["control_od"], $row["cval1_od"], $row["cval2_od"],
						$row["control_os"], $row["cval1_os"], $row["cval2_os"],
						$row["icp_desc"],
						$row["control_ou"], $row["cval1_ou"], $row["cval2_ou"]
					  );


		}

		return $arr;
	}

	public function print_EOM($pid=0,$fid=0){
		global $ChartNoteImagesString;
		$sql="SELECT ".
			"chart_eom.isPositive AS flagPosEom, chart_eom.wnl AS flagWnlEom, chart_eom.examined_no_change  AS chEom, chart_eom.statusElem, ".
			"chart_eom.sumEom,chart_eom.eomDrawing,chart_eom.eomDrawing_2, chart_eom.eomDrwNear,chart_eom.eom_id, chart_eom.descEom, ".
			"chart_eom.wnl,chart_eom.eomDrawing_Dis2,chart_eom.eomDrwNear_2, chart_eom.wnl_value, ".
			"chart_eom.gridvals, chart_eom.htvals, chart_eom.ductionvals ".
			"FROM chart_eom WHERE patient_id='".$pid."' AND form_id = '".$fid."'  AND purged='0' ";
		$row=sqlQuery($sql);
		if($row!=false)
			{

			extract($row);
			$eomPrint = (strpos($statusElem, "=1") !== false) ? true:false;

			if(($eomPrint == true) && ($sumEom!='' || $eomDrawing!="" || $flagWnlEom==1 || $eomDrawing_2!="" || $eomDrawing_Dis2!="" || $eomDrwNear_2!="" ))
			{

			?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0">
      <tr>
        <td colspan="2" class="bluelne" height="1" style="width:750px;">EOM</td>
      </tr>
	  <tr>
        <td colspan="2" class="bluehed text_cap paddingTop10">EOM</td>
      </tr>
      <tr>
        <td colspan="2" style="width:750px;" class="paddingTop10"><?php if($sumEom && $sumEom!='WNL') {echo wordwrap(str_replace("</br>","<br>",htmlentities($sumEom)),200);} elseif($flagWnlEom==1) {echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("EOM", $pid, $fid);} ?></td>
      </tr>
      <?php
					//EOM GRIDS + HT Values -----------

					if(!empty($gridvals)){
					$arrGridVals = unserialize($gridvals);
					}
					$lenGrid = count($arrGridVals);

					$arrHTVals=array();
					if(!empty($htvals)){
						$arrHTVals = unserialize($htvals);
					}
					$lenHTVals=count($arrHTVals);
					if($lenGrid<$lenHTVals){$lenGrid=$lenHTVals;}

					if($lenGrid>0){
						$tmp="";
						$arrGridVals = array_values($arrGridVals);
						for($i=0;$i<=$lenGrid;$i++){

						$chkDis = implode("", $arrGridVals[$i]["Distance"]);
						$chkNr = implode("", $arrGridVals[$i]["Near"]);

						if(!empty($chkDis) || !empty($chkNr)){
							if($i>1){$tmp.="<br/>";}
							$tmp.= $this->print_makeDisNearGrid($i,$arrGridVals[$i]);
						}

						$chkRt = implode("", $arrHTVals[$i]["Right"]);
						$chkLt = implode("", $arrHTVals[$i]["Left"]);

						if(!empty($chkRt) || !empty($chkLt)){
							$tmp.= $this->print_makeHTGrid($i,$arrHTVals[$i]);
						}

						}

						if(!empty($tmp)){
							echo "<tr><td colspan='2'>".$tmp."</td></tr>";
						}
					}
					//EOM GRIDS + HT Values ------------
					?>
      <?php
					//Ductions -----------

					$arrDuctionVals=array(); //Default
					if(!empty($ductionvals)){
						$arrDuctionVals=unserialize($ductionvals);
					}

					$chkRt = implode("", $arrDuctionVals[1][1]);
					$chkLt = implode("", $arrDuctionVals[1][2]);

					if((!empty($chkRt) && $chkRt!="00000000") || (!empty($chkLt) && $chkLt!="00000000") )
					{
						echo "<tr><td colspan='2'>";
						$this->print_makeDuctions("1",$arrDuctionVals[1]);
						echo "</td></tr>";
					}
					//Ductions ------------
					?>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <?php
					if($eomDrawing!=""){?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Distance:&nbsp;</td>
        <td class="paddingTop10" style="width:620px; text-align:center"><?php
										$imageEOMNAme=$this->drawOnImageImage($eomDrawing);
										$imageEOMNAme = $this->data_file_path.'/html2pdfprint/'.$imageEOMNAme;
										if(file_exists($imageEOMNAme) && is_file($imageEOMNAme) ){
											echo('<img src="'.$imageEOMNAme.'" style="width:300px;" height="100"/>');
											$ChartNoteImagesString[]=$imageEOMNAme;
										}
									?></td>
      </tr>
      <?php
								if($eomDrwNear!=""){	?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Near:&nbsp;</td>
        <td class="paddingTop10" style="width:620px; text-align:center"><?php
										$imageEOMNear=$this->drawOnImageImage($eomDrwNear);
										$imageEOMNear=$this->data_file_path.'/html2pdfprint/'.$imageEOMNear;
										if(file_exists($imageEOMNear)&& is_file($imageEOMNear)){
										echo('<img src="'.$imageEOMNear.'" style="width:300px;" height="100"/>');
										$ChartNoteImagesString[]=$imageEOMNear;
										}
									?></td>
      </tr>
      <?php
								}


						}

						/// Show Newly added tow aplplet images//
						if($eomDrawing_Dis2!=""){?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Distance 2:&nbsp;</td>
        <td class="paddingTop10" style="width:620px; text-align:center"><?php
										$imageEOMNAmeDIS=$this->drawOnImageImage($eomDrawing_Dis2);
										$imageEOMNAmeDIS = $this->data_file_path.'/html2pdfprint/'.$imageEOMNAmeDIS;
										if(file_exists($imageEOMNAmeDIS)&& is_file($imageEOMNAmeDIS)){
											echo('<img src="'.$imageEOMNAmeDIS.'" style="width:300px;" height="100"/>');
											$ChartNoteImagesString[]=$imageEOMNAmeDIS;
										}
									?></td>
      </tr>
      <?php
								if($eomDrwNear_2!=""){?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Near 2:&nbsp;</td>
        <td class="paddingTop10" style="width:620px; text-align:center"><?php
										$imageEOMNear2=$this->drawOnImageImage($eomDrwNear_2);
										$imageEOMNear2=$this->data_file_path.'/html2pdfprint/'.$imageEOMNear2;
										if(file_exists($imageEOMNear2) && is_file($imageEOMNear2)){
										echo('<img src="'.$imageEOMNear2.'" style="width:300px;" height="100"/>');
										$ChartNoteImagesString[]=$imageEOMNear2;
										}
									?></td>
      </tr>
      <?php
								}

						}

						///End To Show Newl Added Images//
						$eomDrawing_AppletExist=false;
						if($eomDrawing_2!=""){

						if (strpos($eomDrawing_2,"/") !== false ){
								$eomDrawing_Img=SaveAndShowNewAppletImage($eomDrawing_2);
								?>
      <tr>
        <td class="paddingTop10" style="width:700px; text-align:center" ><?php
										$eomDrawing_Img = $this->data_file_path."/html2pdfprint/".$eomDrawing_Img;
										if(file_exists($eomDrawing_Img) && is_file($eomDrawing_Img) ){
										$ChartNoteImagesString[]=$eomDrawing_Img;
										$eomDrawing_AppletExist=true;
										?>
          <img src="<?php echo($eomDrawing_Img);?>" class="imgdraw" style="border:1px solid red;" />
          <?php } ?></td>
      </tr>
      <?php
								}
						}
						if($eom_id!="" && $eomDrawing_AppletExist==false){
							$ar_drw =$this->getIDOCdrawingsBySection($sectionName='EOM',$primaryId=$eom_id) ;
							if(count($ar_drw)>0){
							foreach($ar_drw as $k_drw => $v_drw){
							$eom_idDrwingImage = $v_drw;
							if($eom_idDrwingImage!="" && file_exists($eom_idDrwingImage) && is_file($eom_idDrwingImage) )
								{
								$ChartNoteImagesString[]=$eom_idDrwingImage;
								?>

								<tr>
									<td colspan="2" class="paddingTop10" style=" text-align:center;">
										<img src="<?php echo($eom_idDrwingImage);?>" class="imgdraw" />
									</td>
								</tr>

						<?php	}
								}
							}
						}

					if($descEom){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Comments:&nbsp;</td>
        <td  style="width:620px;"><?php if($descEom) echo htmlentities($descEom); else echo '&nbsp;'; ?></td>
      </tr>
      <?php
					} ?>
    </table>
    <?php
			}
		}
	}

	public function print_Pupil($pid=0,$fid=0){
		$sql= "SELECT ".
			"chart_pupil.isPositive AS flagPosPupil, chart_pupil.wnl AS flagWnlPupil, chart_pupil.examinedNoChange AS chPupil,chart_pupil.other_values as chartpOtherValues, chart_pupil.wnl_value, ".
			"chart_pupil.sumOdPupil, chart_pupil.sumOsPupil, chart_pupil.pupil_id, chart_pupil.descPupil,chart_pupil.wnlPupilOd,chart_pupil.wnlPupilOs,chart_pupil.statusElem as pupilStatusElem ".
			"FROM chart_pupil WHERE patientId='".$pid."' AND formId='".$fid."'  AND purged='0' ";
		$row = sqlQuery($sql);
		if($row!=false){
			extract($row);
			$pupilPrint=(strpos($pupilStatusElem, "elem_chng_divPupil_Od=1") !== false || strpos($pupilStatusElem, "elem_chng_divPupil_Os=1") !== false)?true:false;

			if(($pupilPrint == true)&& (($sumOdPupil) || ($sumOsPupil) || ($wnlPupilOd) || ($wnlPupilOs))){
			?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0">
	 <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp; </td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	  </tr>
	  <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10">PUPIL</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10" style="width:100px;">&nbsp;</td>
        <td class="sum paddingTop10" style="width:320px;"><?php $this->odLable();?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php $this->osLable();?></td>
      </tr>
      <tr>
        <td style="width:100px;" class="paddingTop10">&nbsp;</td>
        <?php
							$newsumOdPupil = $newsumOsPupil = '';
							for($a=0;$a<=strlen($sumOdPupil);$a++){
								$findChar = substr($sumOdPupil,$a,1);
								if($findChar=='.'){
									$newsumOdPupil.=(substr($sumOdPupil,$a,1));
									$newsumOdPupil.='<br>';
								}
								else{
									$newsumOdPupil.=(substr($sumOdPupil,$a,1));
								}
							}

							for($a=0;$a<=strlen($sumOsPupil);$a++){
								$findChar = substr($sumOsPupil,$a,1);
								if($findChar=='.'){
									$newsumOsPupil.=(substr($sumOsPupil,$a,1));
									$newsumOsPupil.='<br>';
								}
								else{
									$newsumOsPupil.=(substr($sumOsPupil,$a,1));
								}
							}
							?>
        <td class="sum paddingTop10" style="width:320px;"><?php if(strpos($pupilStatusElem, "elem_chng_divPupil_Od=1") !== false){if($newsumOdPupil && $newsumOdPupil!='PERRLA') echo $this->clearSumm($newsumOdPupil); elseif($wnlPupilOd){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("Pupil", $pid, $fid);}}?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php if(strpos($pupilStatusElem, "elem_chng_divPupil_Os=1") !== false){if($newsumOsPupil && $newsumOsPupil!='PERRLA') echo $this->clearSumm($newsumOsPupil); elseif($wnlPupilOs){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("Pupil", $pid, $fid);}} ?></td>
      </tr>
      <?php

				if(!empty($chartpOtherValues)){
							$arrOTHER=unserialize($chartpOtherValues);
							foreach($arrOTHER as $key=>$val){
							$chartpOtherValuesSTR.=$val;
							}
						}
					if($chartpOtherValuesSTR){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:100px;">&nbsp;</td>
        <td colspan="2" class="paddingTop10" style="width:640px;"><?php if($chartpOtherValuesSTR) echo $chartpOtherValuesSTR; else echo '&nbsp;'; ?></td>
      </tr>
      <?php }
					?>
      <?php if($descPupil){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:100px;">Comments:&nbsp;</td>
        <td colspan="2" class="paddingTop10" style="width:640px;"><?php if($descPupil) echo htmlentities($descPupil); else echo '&nbsp;'; ?></td>
      </tr>
      <?php }
					?>
    </table>
    <?php
			}
		}
	}

	public function print_makeDisNearGrid($gridNum,$arrVals){

	$arr_grid_type=array("Distance","Near");
	$counterGrid = $gridNum;

	$grid = "<table align=\"center\" ><tr>";

	foreach($arr_grid_type as $key=>$val){

	$labelGrid=$val;

	$elem_apct_val=$arrVals[$labelGrid]["APCT"];


	$elem_sc_chckd=!empty($arrVals[$labelGrid]["SC"]) ? "SC" : "";


	$elem_cc_chckd=!empty($arrVals[$labelGrid]["CC"]) ? "CC" : "";


	$elem_ccprisms_chckd=!empty($arrVals[$labelGrid]["CCPrisms"]) ? "CC Prisms" : "";

	if($labelGrid=="Near"){
		$elem_bifocal_chckd=!empty($arrVals[$labelGrid]["Bifocal"]) ? "Bifocal" : "";
 	}
	//Default is APCT
	//if(count($arrVals)==0 && empty($elem_apct_val)){ $elem_apct_val="APCT"; }


	$indx=0;
	$grid .=	"<td width=\"5%\"></td><td class=\"grid\">
			<b>".$labelGrid."</b> ".
			trim($elem_apct_val." ".$elem_sc_chckd." ".$elem_cc_chckd." ".$elem_ccprisms_chckd." ".$elem_bifocal_chckd);

	$grid .=	"<br/>
			<table>";
	for($tr=1;$tr<=3;$tr++){

	if($tr==3){$csstr="border-bottom:0px;";}else{$csstr="";}

	$grid .=	"<tr >";

		for($td=1;$td<=3;$td++){

			if($td==3){$css="border-right:0px;";}else{$css="";}

			if(!empty($css)||!empty($csstr)){  $css="style=\"".$css.$csstr."\""; }

			$grid .="<td  ".$css." >";
				for($inp=1;$inp<=4;$inp++){
					$elem_gf_val=$arrVals[$labelGrid][$indx]; //Need Work HERE
					$grid .= "".
							$elem_gf_val.
							" ";

					if($inp==2){ $grid .= "<br/>"; }
					$indx++; //Increment
				}
			$grid .="</td>";

		}

	$grid .=	"</tr>";

	}

	$grid .=	"</table>";

	if(!empty($arrVals[$labelGrid]["comments"])){
		$elem_comm_val=htmlentities($arrVals[$labelGrid]["comments"]);
		$grid .=   "Desc.: ".$elem_comm_val."";
	}

	$grid .=   "</td>";
	}

	$grid .= "</tr></table>";

	return $grid;

}

public function print_makeHTGrid($htNum,$arrVals){

	$arr_ht_type=array("Right","Left");
	$counterHT = $htNum;

	$grid = "<table align=\"center\" ><tr>";
	foreach($arr_ht_type as $key=>$val){

	$labelHT= $val;
	$indx=0;

	$grid .=	"<td width=\"5%\"></td><td class=\"headtilt\">
			<table>
			<tr>
			<td>
			<b>".$labelHT." Head Tilt</b>&nbsp;&nbsp;
			</td>";

			$grid .="<td>";

			for($inp=1;$inp<=4;$inp++){
				$elem_ht_val=$arrVals[$labelHT][$indx]; //Need Work HERE
				$grid .= "".$elem_ht_val." ";

				if($inp==2){ $grid .= "<br/>"; }
				$indx++; //Increment
			}

			$grid .="</td>";
			$grid .="</tr></table>";

	$elem_comm_val=htmlentities($arrVals[$labelHT]["comments"]);
	if(!empty($elem_comm_val)){$grid .=   "Desc.: ".$elem_comm_val."";}
	$grid .=   "</td>";

	}

	$grid .= "</tr></table>";
	return $grid;
}

public function print_makeDuctions($ducNum,$arrVals){

	$arrValsDuction=$arrVals;

	$cross="
	<table align=\"center\" >
	<tr>
	<td >
	</td>
	<td><b>Ductions</b>&nbsp;&nbsp;<b>Right</b></td>
	<td></td>
	<td><b>Left</b></td>
	</tr>

	<tr>

	";

	$duction_types = array("1","2");

	foreach($duction_types as $key=>$val){

	$duc_type = $val;

	$cross.="<td width=\"5%\"></td><td class=\"headtilt\"><table>";
	$indx=0;

	for($i=0;$i<3;$i++){

	$cross.="	<tr>";
		for($j=0;$j<5;$j++){

			$flgShow=0;
			$colspn=$style="";
			if(($i!=1&&$j!=0&&$j!=4)||($i==1&&($j==0||$j==4))){
				$flgShow=1;
			}else{

				if($i==1&&($j!=0||$j!=4)){

					if($j==1){
						//realpath(dirname(__FILE__).'/../main/html2pdfprint/'.$imageEOMNAme)
						$colspn=" colspan=\"3\" ";
						//$style = "class=\"duction_cross\" ";
						$style=" style=\" height:50px; width:220px; \" ";
					}else{
						continue;
					}

				}

			}

			$cross.="<td ".$colspn." ".$style." align=\"center\" valign=\"middle\" >";

				if($flgShow==1){
					$cross.="".$arrValsDuction[$duc_type][$indx]." ";
					$indx++;
				}

				if(!empty($colspn)){
					$cross.="<img src=\"".realpath(dirname(__FILE__)."/../chart_notes/images/duction_cross.png")."\" >";
				}

			$cross.="</td>";

		}

	$cross.="</tr>";
	}

	$elem_comments_duc=$arrValsDuction[$duc_type]["comments"];
	if(!empty($elem_comments_duc)){
	$cross.="<tr>	".
		"<td colspan=\"5\">".
			"Desc: ".$elem_comments_duc."".
		"</td>".
		"</tr>";
	}
	$cross.="</table></td>";

	}

	$cross.="</tr></table>";

	echo $cross;

}

public function getExamWnlStr($exam, $pid="", $formId=""){

	$phraseTemp="";
	if(!empty($pid) && !empty($formId)){
		$ocn = new ChartNote($pid, $formId);
		$template_id = $ocn->getTemplateId();
		if(!empty($template_id)){
			$phraseTemp = " AND chart_template_id = '".$template_id."' ";
		}
	}

	$arrDefWnl=array(
		"Pupil" => "PERRLA, Negative APD",
		"EOM" => "Full ductions, alternate cover test - ortho distance and near.",
		"External" =>"WNL",
		"Lids" =>"WNL",
		"Lesion" =>"WNL",
		"Lid Position" =>"WNL",
		"Lacrimal System" => "WNL",
		"Gonio" => "WNL",
		"Conjunctiva"=>"Clear",
		"Cornea"=>"Clear",
		"Ant. Chamber"=>"Deep and quiet",
		"Iris & Pupil"=>"WNL",
		"Lens"=>"Clear",
		"Optic Nerve"=>"Pink & Sharp",
		"Vitreous"=>"Clear",
		"Retinal Exam"=>"Macula normal, vessels normal course and caliber",
		"CVF"=>"WNL",
		"Amsler Grid"=>"WNL",
		"Macula" => "Macula Benign",
		"Blood Vessels" => "Blood Vessels Benign",
		"Periphery"=>"WNL"
	);

	//--
	$res_fellow_sess = trim($_SESSION['res_fellow_sess']);
	if($res_fellow_sess != "" && isset($res_fellow_sess))
	{
		$providerId = $res_fellow_sess;
	}
	else
	{
		$providerId = $_SESSION["authId"];

		//Check if providerId is tech or scribe: if follow to physician, then apply his assessments and policy
		$isTech = $this->getFollowPhyId4Tech($providerId);
		if(!empty($isTech)){
			$providerId = $isTech;
		}
	}
	//--

	$wnl="";

	//Check in physician console
	if(empty($wnl)){
		$sql = "SELECT wnl FROM chart_admin_wnl WHERE deleted = '0' AND UPPER(exam) = '".strtoupper($exam)."' AND phyid='".$providerId."'  ".$phraseTemp." ";
		$row = sqlQuery($sql);
		if($row!=false){
			$wnl=$row["wnl"];
		}
	}

	//Check in admin
	if(empty($wnl)){
		$sql = "SELECT wnl FROM chart_admin_wnl WHERE deleted = '0' AND UPPER(exam) = '".strtoupper($exam)."' AND phyid='0'  ".$phraseTemp." ";
		$row = sqlQuery($sql);
		if($row!=false){
			$wnl=$row["wnl"];
		}
	}

	//get Default wnl
	if(empty($wnl)){
		$wnl=$arrDefWnl[$exam];
	}

	return $wnl;
}

public function getFollowPhyId4Tech($providerId){
	$ret=0;
	if(in_array($_SESSION["logged_user_type"], $GLOBALS['arrValidCNTech']) || $_SESSION["logged_user_type"] == "13"){
		$sql = "SELECT follow_physician FROM users WHERE id = '".$providerId."' ";
		$row = sqlQuery($sql);
		if($row != false){
			$follow_physician = $row["follow_physician"];
			//
			if(!empty($follow_physician)){
				////get physician id from pt scheduler appointment --
				//$ret = $follow_physician;
				if(!empty($_SESSION["patient"])){

					//
					$tmp_form_id = "";
					if(!empty($_SESSION["form_id"])){
						$tmp_form_id = $_SESSION["form_id"];
					}else if(!empty($_SESSION["finalize_id"])){
						$tmp_form_id = $_SESSION["finalize_id"];
					}
					if(!empty($tmp_form_id)){
						//
						$sql = "SELECT c2.sa_doctor_id, c1.date_of_service from chart_master_table c1
								LEFT JOIN schedule_appointments c2 ON c2.sa_patient_id=c1.patient_id AND c1.date_of_service=c2.sa_app_start_date
								WHERE c1.id='".$tmp_form_id."' AND c1.patient_id='".$_SESSION["patient"]."' ";
						$row = sqlQuery($sql);
						if($row!=false){
							$ret = $row["sa_doctor_id"];
						}
					}

					if(empty($ret)){//if still empty then get last appointment doctor id
						$sql = "
								SELECT sa_doctor_id, sa_app_start_date  FROM `schedule_appointments`
								WHERE sa_patient_id = '".$_SESSION["patient"]."'
								ORDER BY sa_app_start_date DESC
								LIMIT 0, 1	";
						$row = sqlQuery($sql);
						if($row!=false){
							$ret = $row["sa_doctor_id"];
						}
					}
				}
			}
		}
	}
	return $ret;
}

function getIDOCdrawingsBySection($sectionName,$primaryId){
	$objImageManipulation = new CLSImageManipulation();
	$ar_returnStrImagePath=array();
	$IDOCdrawingQuery="SELECT red_pixel,green_pixel,blue_pixel, drawing_image_path FROM ".constant("IMEDIC_SCAN_DB").".idoc_drawing where drawing_for='".$sectionName."' and drawing_for_master_id='".$primaryId."'
						AND deletedby ='0'
						ORDER BY id DESC	";
	$IDOCdrawingQueryRes=imw_query($IDOCdrawingQuery);


	//CHECK ARCHIVE DB TBL --
		if($IDOCdrawingQueryRes){
			$IDOCdrawingQueryNumRow=imw_num_rows($IDOCdrawingQueryRes);
			if($IDOCdrawingQueryNumRow==0 && !empty($GLOBALS["IMEDIC_SCAN_DB_ARCHIVE"])){
				$IDOCdrawingQuery="SELECT red_pixel, drawing_image_path,
								DATE_FORMAT(row_created_date_time,'%m-%d-%y') AS drawDate ,
								DATE_FORMAT(row_visit_dos,'%m-%d-%y') AS drawDateDos
								FROM ".$GLOBALS["IMEDIC_SCAN_DB_ARCHIVE"].".idoc_drawing
								where drawing_for='".$sectionName."' and drawing_for_master_id='".$primaryId."' ";
				$IDOCdrawingQueryRes=imw_query($IDOCdrawingQuery);
			}
		}
	//CHECK ARCHIVE DB TBL --


	if($IDOCdrawingQueryRes){
		$IDOCdrawingQueryNumRow=imw_num_rows($IDOCdrawingQueryRes);
		if($IDOCdrawingQueryNumRow>0){
			while($resDrawingArray=imw_fetch_array($IDOCdrawingQueryRes)){
			$returnStrImagePath="";
			if(!empty($resDrawingArray["red_pixel"])||!empty($resDrawingArray["green_pixel"])||!empty($resDrawingArray["blue_pixel"])||!empty($resDrawingArray["drawing_image_path"])){
				$lamDrwingImagePath=$resDrawingArray["drawing_image_path"];
				$lamDrwingImage = $this->data_file_path.$lamDrwingImagePath;
				if(file_exists($lamDrwingImage)){

					$lamDrwingImage_b=str_replace(".png","_b.png",$lamDrwingImage);
					if( file_exists($lamDrwingImage_b) ){
						$lamDrwingImage=$lamDrwingImage_b;
					}

					$objImageManipulation->load($lamDrwingImage);
					$arrPathInfo = pathinfo($lamDrwingImage);
					$arrPathInfo["filename"] = trim($arrPathInfo["filename"]);
					if(!empty($arrPathInfo["filename"])&&$arrPathInfo["filename"]!="uploaddir"){
					$strFilenameJPG = $arrPathInfo["dirname"]."/".$arrPathInfo["filename"].".jpg";
					$objImageManipulation->save($strFilenameJPG);
					$returnStrImagePath = $strFilenameJPG;
					if(!empty($returnStrImagePath)){ $ar_returnStrImagePath[]=$returnStrImagePath; }
					}
				}
			}
			}
		}
	}
	return $ar_returnStrImagePath;
}

public function print_EE($pid=0,$fid=0){

	$sql = "SELECT ".
		 "chart_external_exam.isPositive AS flagPosEe, chart_external_exam.wnl AS flagWnlEe, chart_external_exam.examined_no_change  AS chEe, chart_external_exam.ee_desc, chart_external_exam.wnl_value,  ".
		 "chart_external_exam.ee_drawing, chart_external_exam.external_exam_summary, chart_external_exam.sumOsEE, chart_external_exam.ee_id, chart_external_exam.descExternal,chart_external_exam.wnlEeOd,chart_external_exam.wnlEeOs,chart_external_exam.statusElem as externalStatusElem ".
		 "FROM chart_external_exam WHERE patient_id='".$pid."' AND form_id='".$fid."'  AND purged='0' ";

	$row=sqlQuery($sql);
	//pre($row);
	if($row!=false){
		extract($row);
		$externalPrint=(strpos($externalStatusElem, "elem_chng_divCon_Od=1") !== false || strpos($externalStatusElem, "elem_chng_divCon_Os=1") !== false) ? true:false;
		if(($externalPrint == true) && (($external_exam_summary) || ($sumOsEE) || ($wnlEeOd) || ($wnlEeOs))){

		?>
    <table cellpadding="0" cellspacing="0"  style="width:750px;">
      <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	 </tr>
	  <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10">EXTERNAL</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10">&nbsp;</td>
        <td class="sum bdrright paddingTop10"><?php $this->odLable();?></td>
        <td class="sum paddingTop10"><?php $this->osLable();?></td>
      </tr>
      <tr>
        <td class="lbl paddingTop10">&nbsp;</td>
        <td class="sum paddingTop10"><?php if(strpos($externalStatusElem, "elem_chng_divCon_Od=1") !== false){if(($external_exam_summary && $external_exam_summary!='WNL')){echo $this->clearSumm($external_exam_summary);} elseif($wnlEeOd == 1){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("External", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if(strpos($externalStatusElem, "elem_chng_divCon_Os=1") !== false){if(($sumOsEE && $sumOsEE!='WNL')){echo $sumOsEE;} elseif($wnlEeOs == 1){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("External", $pid, $fid);}} ?></td>
      </tr>
      <?php
					$externalDraw=(strpos($externalStatusElem, "elem_chng_divDraw_Od=1") !== false || strpos($externalStatusElem, "elem_chng_divDraw_Os=1") !== false) ? true:false;
					if($externalDraw){

					$external_drawingAppletImageExist=false;
					if($ee_id!="" && $external_drawingAppletImageExist==false){
						$ar_drw =$this->getIDOCdrawingsBySection($sectionName='EXTERNAL',$primaryId=$ee_id);
						if(count($ar_drw)>0){
						foreach($ar_drw as $k_drw => $v_drw){
						$external_idDrwingImage = $v_drw;
						if($external_idDrwingImage!="" && file_exists($external_idDrwingImage) && is_file($external_idDrwingImage)){
							$ChartNoteImagesString[]=$external_idDrwingImage;
							?>
							<tr>
								<td colspan="4" class="paddingTop10" style="width:640px; text-align:center" >
									<img src="<?php echo($external_idDrwingImage);?>" class="imgdraw"/>
								</td>
							</tr>
					<?php
						}
						}
						}
					}

					if($external_drawingAppletImageExist==false && $this->isAppletModified($ee_drawing))
					{
						//External Exam
						global $gdFilename,$ChartNoteImagesString;
						$idEE = $ee_id;
						$tableEE = 'chart_external_exam';
						$idNameEE = 'ee_id';
						$pixelEeDrawing = 'ee_drawing';
						$imageEE = realpath(dirname(__FILE__).'/../../../library/images/pic_face.jpg');
						$altEE = 'EE';
						?>
      <!--<tr>
							<td class="lbl">&nbsp;</td>
						 	<td class="bdrright"><?php

 							?>
							</td>
						</tr> -->
      <tr>
        <td colspan="3" align="center" class="bdrright"><?php
							if(strpos($sign, "/") === false){
								$this->getAppletImage($idEE,$tableEE,$idNameEE,$pixelEeDrawing,$imageEE,$altEE,"1");

								//echo $gdFilename;
								$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;

								//echo "<img src='".$gdFilename."' />";

								if(file_exists($gdFilename) && is_file($gdFilename) ){
									echo "<img src=\"".$gdFilename."\" class=\"imgdraw\" align=\"center\"/>";
									$ChartNoteImagesString[]=$gdFilename;
								}

							}else{
								$gdFilename = $this->data_file_path.'/html2pdfprint/'.$row['ee_drawing'];
								$ExternalImg=SaveAndShowNewAppletImage($row['ee_drawing']);
								$ExternalImgPath=$this->data_file_path.'/html2pdfprint/'.$ExternalImg;
								if(file_exists($ExternalImgPath) && is_file($ExternalImgPath)){
									$sle_drawingAppletImageExist=true; $ChartNoteImagesString[]=$ExternalImgPath;
									?>
          <img src="<?php echo($ExternalImgPath); ?>"  class="imgdraw" align="center" />
          <?php
								}
							}
 							?></td>
      </tr>
      <?php }
					}//draw
					//die();
				if($ee_desc ){
				?>
      <tr>
        <td class="lbl">&nbsp;</td>
        <td colspan="2" ><?php if($ee_desc) echo $ee_desc; else echo '&nbsp;'; ?></td>
      </tr>
      <?php }
				?>
      <?php
				if($descExternal ){
				?>
      <tr>
        <td class="lbl">Comments:&nbsp;</td>
        <td colspan="2" ><?php if($descExternal ) echo htmlentities($descExternal); else echo '&nbsp;'; ?></td>
      </tr>
      <tr>
        <td class="lbl">&nbsp;</td>
        <td colspan="2"></td>
      </tr>
      <?php }
				?>
    </table>
    <?php
	}


	}
}

public function print_LA($pid=0,$fid=0){
	global $ChartNoteImagesString;
	/**
	* chart_la TABLE SPLITTING TABLES WORK - EVERY SECTION OF L&A EXAM HAS OWN INDEPENDENT TABLES NOW
	*
	*/
	$sql = "SELECT
			  CLA.lid_od,
			  CLA.lid_os,
			  CLA.wnlLids,
			  CLA.posLids,
			  CLA.ncLids,
			  CLA.lid_conjunctiva_summary,
			  CLA.sumLidsOs,
			  CLA.wnlLidsOd,
			  CLA.wnlLidsOs,
			  CLA.ncLids_od,
			  CLA.ncLids_os,
			  CLA.wnl_value_Lids,

			  CL.wnlLesion,
			  CL.ncLesion,
			  CL.lesion_summary,
			  CL.sumLesionOs,
			  CL.wnlLesionOs,
			  CL.posLesion,
			  CL.ncLesion_od,
			  CL.ncLesion_os,
			  CL.wnlLesionOd,
			  CL.lesion_os,
			  CL.lesion_od,
			  CL.wnl_value_Lesion,

			  CLP.wnlLidPos,
			  CLP.sumLidPosOs,
			  CLP.ncLidPos,
			  CLP.wnlLidPosOd,
			  CLP.wnlLidPosOs,
			  CLP.wnl_value_LidPos,
			  CLP.posLidPos,
			  CLP.lidposition_od,
			  CLP.lidposition_os,
			  CLP.ncLidPos_od,
			  CLP.ncLidPos_os,
			  CLS.lacrimal_system_summary,
			  CLP.lid_deformity_position_summary,

			  CLS.lacrimal_od,
			  CLS.sumLacOs,
			  CLS.lacrimal_os,
			  CLS.wnlLacSys,
			  CLS.posLacSys,
			  CLS.ncLacSys,
			  CLS.wnlLacSysOd,
			  CLS.wnlLacSysOs,
			  CLS.ncLacSys_od,
			  CLS.ncLacSys_os,
			  CLS.wnl_value_LacSys,

			  CLD.drw_od_txt AS drawOdTxt,
			  CLD.drw_os_txt AS drawOsTxt,
			  CLD.wnlDraw AS wnlDrawLa,
			  CLD.posDraw AS posDrawLa,
			  CLD.id AS idLa,
			  CLD.ncDraw AS ncDrawLa,
			  CLD.wnlDrawOd AS wnlDrawOd,
			  CLD.wnlDrawOs AS wnlDrawOs,
			  CLD.ncDraw_od AS ncDrawOd,
			  CLD.ncDraw_os AS ncDrawOs,
			  CLD.idoc_drawing_id AS la_id,

			  CONCAT(
				CLA.statusElem,
				CL.statusElem,
				CLP.statusElem,
				CLS.statusElem,
				CLD.statusElem
			  ) AS statusElem
			FROM
			  chart_master_table CMT
			  INNER JOIN chart_lids CLA ON CMT.id = CLA.form_id
			  INNER JOIN chart_lesion CL ON CMT.id = CL.form_id
			  INNER JOIN chart_lid_pos CLP ON CMT.id = CLP.form_id
			  INNER JOIN chart_lac_sys CLS ON CMT.id = CLS.form_id
			  INNER JOIN chart_drawings CLD ON CMT.id = CLD.form_id
			WHERE
			  CMT.patient_id = '".$pid."'
			  AND CMT.id = '".$fid."'
			  AND CMT.purge_status = '0'
			  AND CMT.delete_status = '0'
			  AND CLA.purged = '0'
			  AND CL.purged = '0'
			  AND CLP.purged = '0'
			  AND CLS.purged = '0'
			  AND CLD.purged = '0'
			  AND CLD.exam_name = 'LA'";

		$row=sqlQuery($sql);
		if($row!=false){
		extract($row);
		$Lids_od = (strpos($statusElem, "elem_chng_div1_Od=1") !== false) ? true : false ;
		$Lesion_od = (strpos($statusElem, "elem_chng_div2_Od=1") !== false) ? true : false ;
		$LidPos_od = (strpos($statusElem, "elem_chng_div3_Od=1") !== false) ? true : false ;
		$LacSys_od = (strpos($statusElem, "elem_chng_div4_Od=1") !== false) ? true : false ;
		$Draw_od = (strpos($statusElem, "elem_chng_div5_Od=1") !== false) ? true : false ;

		$Lids_os = (strpos($statusElem, "elem_chng_div1_Os=1") !== false) ? true : false ;
		$Lesion_os = (strpos($statusElem, "elem_chng_div2_Os=1") !== false) ? true : false ;
		$LidPos_os = (strpos($statusElem, "elem_chng_div3_Os=1") !== false) ? true : false ;
		$LacSys_os = (strpos($statusElem, "elem_chng_div4_Os=1") !== false) ? true : false ;
		$Draw_os = (strpos($statusElem, "elem_chng_div5_Os=1") !== false) ? true : false ;

		if($Lids_od || $Lids_os
			||$Lesion_od || $Lesion_os
			||$LidPos_od || $LidPos_os
			||$LacSys_od || $LacSys_os
			||$Draw_od || $Draw_os
		)
		{
			$l_and_a=true;
		}else{
			$l_and_a=false;
		}

		if($l_and_a==true){
		if(
		(($lid_conjunctiva_summary) || ($sumLidsOs) || ($wnlLidsOd)>0)
		||
		(($lesion_summary) || ($sumLesionOs) || ($wnlLesionOd)>0)
		||
		(($lid_deformity_position_summary) || ($sumLidPosOs) || ($wnlLidPosOd)>0)
		||
		(($lacrimal_system_summary) || ($sumLacOs) || ($wnlLacSysOd)>0)
		){
		?>
    <table cellpadding="0" cellspacing="0"  style="width:750px;">
      <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;" ></td>
      </tr>
	 <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10">L &amp; A</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10"></td>
        <td class="sum bdrright paddingTop10"><?php $this->odLable();?></td>
        <td class="sum paddingTop10"><?php $this->osLable();?></td>
      </tr>
      <?php
					if(($Lids_od || $Lids_os) && ($lid_conjunctiva_summary || $sumLidsOs || $wnlLidsOd > 0))
					{
		?>
      <tr>
        <td class="lbl paddingTop10">Lids</td>
        <td class="sum paddingTop10"><?php if($Lids_od){if($lid_conjunctiva_summary) echo $this->clearSumm($lid_conjunctiva_summary); elseif($wnlLidsOd == 1){echo !empty($wnl_value_Lids) ? $wnl_value_Lids : $this->getExamWnlStr("Lids", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($Lids_os){if($sumLidsOs) echo $this->clearSumm($sumLidsOs); elseif($wnlLidsOs == 1){echo !empty($wnl_value_Lids) ? $wnl_value_Lids : $this->getExamWnlStr("Lids", $pid, $fid);}} ?></td>
      </tr>
      <?php
					}
					if(($Lesion_od || $Lesion_os)&&($lesion_summary || $sumLesionOs || $wnlLesionOd > 0)){
						?>
      <tr>
        <td class="lbl paddingTop10">Lesion</td>
        <td class="sum paddingTop10"><?php if($Lesion_od){if($lesion_summary) echo $this->clearSumm($lesion_summary); elseif($wnlLesionOd == 1){echo !empty($wnl_value_Lesion) ? $wnl_value_Lesion : $this->getExamWnlStr("Lesion", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($Lesion_os){if($sumLesionOs ) echo $this->clearSumm($sumLesionOs); elseif($wnlLesionOs == 1){echo !empty($wnl_value_Lesion) ? $wnl_value_Lesion : $this->getExamWnlStr("Lesion", $pid, $fid);}} ?></td>
      </tr>
      <?php
					}
					if(($LidPos_od || $LidPos_os) && ($lid_deformity_position_summary || $sumLidPosOs  || $wnlLidPosOd > 0)){
						?>
      <tr>
        <td class="lbl paddingTop10">Lid&nbsp;Position</td>
        <td class="sum paddingTop10"><?php if($LidPos_od){if($lid_deformity_position_summary) echo $this->clearSumm($lid_deformity_position_summary); elseif($wnlLidPosOd == 1){echo !empty($wnl_value_LidPos) ? $wnl_value_LidPos :  $this->getExamWnlStr("Lid Position", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($LidPos_os){if($sumLidPosOs ) echo $this->clearSumm($sumLidPosOs); elseif($wnlLidPosOs == 1){echo !empty($wnl_value_LidPos) ? $wnl_value_LidPos :  $this->getExamWnlStr("Lid Position", $pid, $fid);}} ?></td>
      </tr>
      <?php
					}
					if(($LacSys_od || $LacSys_os) && ($lacrimal_system_summary || $sumLacOs  || $wnlLacSysOd > 0)){
						?>
      <tr>
        <td class="lbl paddingTop10">Lacrimal System </td>
        <td class="sum bdrright"><?php if($LacSys_od){if($lacrimal_system_summary ) echo $this->clearSumm($lacrimal_system_summary); elseif($wnlLacSysOd == 1){echo !empty($wnl_value_LacSys) ? $wnl_value_LacSys : $this->getExamWnlStr("Lacrimal System", $pid, $fid);}} ?></td>
        <td class="sum"><?php if($LacSys_os){if($sumLacOs ) echo $this->clearSumm($sumLacOs); elseif($wnlLacSysOs == 1){echo !empty($wnl_value_LacSys) ? $wnl_value_LacSys : $this->getExamWnlStr("Lacrimal System", $pid, $fid);}} ?></td>
      </tr>
      <?php
					}
					if($descLa){
					?>
      <tr>
        <td class="lbl paddingTop10">Comments:&nbsp;</td>
        <td colspan="2"><?php if($descLa) echo $descLa; else echo '&nbsp;'; ?></td>
      </tr>
      <tr>
        <td class="lbl">&nbsp;</td>
        <td colspan="2"></td>
      </tr>
      <?php
					}

					if($Draw_od || $Draw_os){

					$la_drawingAppletImageExist=false;
					?>
      <?php
					if($idLa!="" && $la_drawingAppletImageExist==false){
						$ar_drw =$this->getIDOCdrawingsBySection($sectionName='LA',$primaryId=$idLa) ;
						if(count($ar_drw)>0){
						foreach($ar_drw as $k_drw => $v_drw){
						$laDrwingImage = $v_drw;
						if($laDrwingImage!="" && file_exists($laDrwingImage) && is_file($laDrwingImage) ){
							$ChartNoteImagesString[]=$laDrwingImage;
							$la_drawingAppletImageExist=true;
							?>
							<tr>
								<td colspan="3" style=" text-align:center;" >
									<img src="<?php echo($laDrwingImage);?>" class="imgdraw"/>
								</td>
							</tr>
					<?php 	}
							}
							}
						}

					?>
      <?php
					if($la_drawing!="" && $la_drawingAppletImageExist==false ){

						if (strpos($la_drawing,"/") !== false )
						{
							$laImg=SaveAndShowNewAppletImage($la_drawing);
							?>
      <tr>
        <!--<td class="lbl bdrright">&nbsp;</td> -->
        <td colspan="3" align="center" style="border-top:#c0c0c0 1px solid; text-align:center;"><?php
									$laImg = $this->data_file_path."/html2pdfprint/".$laImg;
									if(file_exists($laImg) && is_file($laImg) ){
									$ChartNoteImagesString[]=$laImg;
									$la_drawingAppletImageExist=true;
									?>
          <img src="<?php echo($laImg);?>" class="imgdraw" />
          <?php } ?></td>
      </tr>
      <?php
							}else{
						?>
      <tr>
        <!--<td class="lbl">&nbsp;</td> -->
        <td colspan="3" align="center"  style="border-top:#c0c0c0 1px solid; text-align:center;"><?php
									if($this->isAppletModified($la_drawing))
									{	$idLa = $la_id;
										$tableLA = 'chart_drawings';
										$idNameLA = 'id';
										$pixelLaDrawing = 'exm_drawing';
										$imageLA = realpath(dirname(__FILE__).'/../../../library/images/La.jpg');
										$altLA = 'LA';
										$this->getAppletImage($idLa,$tableLA,$idNameLA,$pixelLaDrawing,$imageLA,$altLA,"1");
										$gdFilename = $this->data_file_path."/html2pdfprint/".$gdFilename;
										if( file_exists($gdFilename) && is_file($gdFilename)  )
										{
											echo('<img src="'.$gdFilename.'" height="164" width="370" />');
											$ChartNoteImagesString[]=$gdFilename;
										}
									}
								?></td>
      </tr>
      <?php
						}
					}
					?>
      <?php
					if($la_od_txt<>"" || $la_os_txt<>""){?>
      <tr>
        <td class="lbl">Description</td>
        <td class="sum"><?php echo($la_od_txt);?></td>
        <td class="sum"><?php echo($la_os_txt);?></td>
      </tr>
      <?php }
					}//End Draw
					?>
    </table>
    <?php
		}
		}

	}
}

public function clearSumm($str){
	//Remove last semi colon
	$str = trim($str);
	$ptrn = '/(\s)*\;(\s)*$/i';
	$str = preg_replace($ptrn, "", $str);
	$str=str_replace(array("<OD","Comments:"),array(" less than OD",""),$str);
	return $str;
}

public function print_IOPGonio($pid=0,$fid=0){
	global $ChartNoteImagesString;
	$sql = "SELECT ".
		 "chart_iop.isPositive AS flagPosIop, chart_iop.wnl AS flagWnlIop, chart_iop.examined_no_change AS chIop,chart_iop.anesthetic,chart_iop.anesthetic,chart_iop.multiple_pressure, chart_iop.iop_id,".
		 "chart_iop.sumOdIop, chart_iop.sumOsIop, chart_iop.gonio_od_drawing,chart_iop.gonio_od_desc,chart_iop.gonio_os_desc, chart_iop.iop_id,chart_iop.desc_ig,chart_iop.wnlIopOd,chart_iop.wnlIopOs, chart_iop.descTa,chart_iop.descTp,chart_iop.descTx, chart_iop.hold_lids, ".
		 "chart_dialation.dilation, chart_dialation.warned_n_advised, chart_dialation.patient_not_driving, chart_dialation.patientAllergic, chart_dialation.allergicComments, chart_dialation.unableDilation, chart_dialation.unableDilateComments, chart_dialation.dilated_mm,chart_dialation.eyeSide, chart_dialation.rev_eyes,chart_dialation.permiBy,  ".
		 "chart_gonio.wnlOd AS wnlGonioOd, chart_gonio.wnlOs AS wnlGonioOs, chart_gonio.desc_ig, chart_gonio.gonio_od_summary, chart_gonio.gonio_os_summary,chart_gonio.gonio_od_drawing, chart_gonio.gonio_id, ".
		 "chart_gonio.statusElem AS statusElemGonio, chart_gonio.wnl_value, ".
		 "chart_ood.ood, chart_ood.statusElem AS statusElemOOD  ".
		 "FROM chart_master_table ".
		 "LEFT JOIN chart_iop ON chart_iop.form_id = chart_master_table.id AND chart_iop.purged = '0'  ".
		 "LEFT JOIN chart_gonio ON chart_gonio.form_id = chart_master_table.id AND chart_gonio.purged = '0' ".
		 "LEFT JOIN chart_dialation ON chart_dialation.form_id=chart_master_table.id AND chart_dialation.purged = '0' ".
		 "LEFT JOIN chart_ood ON chart_ood.form_id=chart_master_table.id AND chart_ood.purged = '0' ".
		 "WHERE chart_master_table.patient_id='".$pid."' AND chart_master_table.id='".$fid."' ";
	$row=sqlQuery($sql);
	if($row!=false)
	{

		 extract($row);
		 $IOPPrint = true;
		if(($IOPPrint == true) && ((($sumOdIop) || ($sumOsIop )) || (($gonio_od_summary ) || ($gonio_os_summary )) || !empty($anesthetic)) || ($warned_n_advised== 1 || $patient_not_driving==1 ||$patientAllergic== 1 || $allergicComments!="" || $unableDilation==1||$unableDilateComments!="" || ($dilated_mm !="~!!~~!!~" && $dilated_mm!="") || ($dilation) || $hold_lids>0)){

		?>
    <table style="width:750px;"  cellpadding="0" cellspacing="0" >
      <tr>
        <td colspan="4" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="4" height="2"></td>
	 </tr>
	  <tr>
        <td colspan="4" class="bluehed text_cap paddingTop10" >IOP/Gonio</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">&nbsp;</td>
        <td class="sum paddingTop10" style="width:225px;"><?php $this->odLable();?></td>
        <td class="sum paddingTop10" style="width:225px;"><?php $this->osLable();?></td>
        <td class="lbl paddingTop10" style="width:150px;">Time</td>
      </tr>
      <?php
					if($sumOdIop || $sumOsIop)
					{
						$placeholders = array('<1', '<2', '<3', '<4','<5', '<6', '<7', '<8','<9','<0');
						$repLacevals = array('&lt;1', '&lt;2', '&lt;3', '&lt;4','&lt;5', '&lt;6', '&lt;7', '&lt;8','&lt;9','&lt;0');
						$sumOdIop = str_replace($placeholders, $repLacevals, $sumOdIop);
						$sumOsIop = str_replace($placeholders, $repLacevals, $sumOsIop);

						//-----BELOW FIELD COMMENTED DUE TO NEW METHOD TYPE DEFINE FOR IOP SECTIONS-----
						$showTime=unserialize($row['multiple_pressure']);
							//pre($showTime);

						$elem_appMethod		= $showTime['multiplePressuer']['elem_appMethod'];
						$elem_puffMethod	= $showTime['multiplePressuer']['elem_puffMethod'];
						$elem_tactMethod	= $showTime['multiplePressuer']['elem_tactMethod'];
						$elem_ttMethod		= $showTime['multiplePressuer']['elem_ttMethod'];

						(!empty($elem_appMethod)) ? $elem_appMethod : "T<sub>A</sub>" ;
						(!empty($elem_puffMethod)) ? $elem_puffMethod : "T<sub>p</sub>" ;
						(!empty($elem_tactMethod)) ? $elem_tactMethod : "T<sub>x</sub>" ;
						(!empty($elem_ttMethod)) ? $elem_ttMethod : "T<sub>T</sub>" ;

							foreach($showTime as $key=>$value)
							{
								foreach($value as $k=>$v)
								{
									if($k=="elem_appTime")
									{
										$TA_Time = $elem_appMethod.': '.$v;
									}
									if($k=="elem_puffTime")
									{
										$TP_Time = $elem_puffMethod.': '.$v;
									}
									if($k=="elem_xTime")
									{
										$TX_Time = $elem_tactMethod.': '.$v;
									}
									if($k=="elem_ttTime")
									{
										$TT_Time = $elem_ttMethod.': '.$v;
									}
								}
							}

		?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">IOP </td>
        <td class="sum paddingTop10" style="width:225px;"><?php if($sumOdIop ) echo str_replace("<br> ","<br/>",$sumOdIop); else echo '&nbsp;'; ?></td>
        <td class="sum paddingTop10" style="width:225px;"><?php if($sumOsIop) echo str_replace("<br>","<br/>",$sumOsIop); else echo '&nbsp;'; ?></td>
        <td class="lbl paddingTop10" style="width:150px; ">

          <div style="font-weight:normal;"><?php echo $TA_Time; ?>
			<br/>
            <?php echo $TP_Time; ?>
			<br/>
            <?php echo $TX_Time; ?>
			<br/>
            <?php echo $TT_Time; ?>
		  </div>
		</td>
      </tr>
      <?php
					}
					if(!empty($anesthetic)){
						$arrAnes=unserialize($anesthetic);

						foreach($arrAnes as $key=>$val){
						$tmp="";
						if(!empty($arrAnes[$key]["anes"])) $tmp.="".$arrAnes[$key]["anes"];
						if(!empty($arrAnes[$key]["other"])) $tmp.=",".$arrAnes[$key]["other"];
						$tmp.="&nbsp;&nbsp;".$arrAnes[$key]["eye"]."&nbsp;&nbsp;".$arrAnes[$key]["time"];
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">Anesthetic</td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php echo($tmp); ?></td>
      </tr>
      <?php }
					}
					if(!empty($dilation) ){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">Dilation&nbsp;</td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php if($eyeSide!=""){ echo($eyeSide);} if($rev_eyes==1){echo("&nbsp;Rev-Eyes: Yes");} if($rev_eyes==0){echo("&nbsp;Rev-Eyes: No");}?></td>
      </tr>
      <?php
					}
					if(!empty($dilation)){
						$arrDilate=unserialize($dilation);
						foreach($arrDilate as $key=>$val){
						$tmp="";
						if(!empty($arrDilate[$key]["dilate"])) $tmp.=$arrDilate[$key]["dilate"];
						//
						$tmp = str_replace(array('pheny25','mydiacyl5','mydiacyl1','Cyclogyl','Paremyd',','), array('Phenylephrine 2.5%', 'Mydriacyl 1/2%', 'Mydriacyl 1%', 'Cyclogyl 1%', 'Paremyd',', '), $tmp);
						$tmp = trim($tmp); $tmp = trim($tmp,",");
						if(!empty($arrDilate[$key]["other_desc"])) $tmp.="&nbsp;".$arrDilate[$key]["other_desc"];
						$tmp.="&nbsp;&nbsp;".$arrDilate[$key]["time"];
						?>
      <tr>
        <td class="lbl"></td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php echo($tmp);?></td>
      </tr>
      <?php }
					}
					if(!empty($dilated_mm)&&$dilated_mm!="~!!~~!!~"){
			 			$dilated_mmARRAY=explode("~!!~",$dilated_mm);
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">Dilated</td>
        <td class="sum paddingTop10" style="width:300px;"><?php if($dilated_mmARRAY[0]!="") echo $dilated_mmARRAY[0]; else echo '&nbsp;'; ?></td>
        <td colspan="2" class="sum paddingTop10" style="width:300px;"><?php if($dilated_mmARRAY[1]!="") echo $dilated_mmARRAY[1]; else echo '&nbsp;'; ?></td>
        <td>&nbsp;</td>
      </tr>
      <?php }
					if($permiBy!=""){?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;"></td>
        <td class="sum paddingTop10" colspan="3" style="width:600px;"><strong>Permission given by:</strong>&nbsp;
          <?php if($permiBy!="") echo str_replace("~!!~",' ',$permiBy); else echo '&nbsp;'; ?></td>
      </tr>
      <?php }
					if($warned_n_advised== 1 || $patient_not_driving==1){
					$tmp = "";
					if($warned_n_advised== 1) {$tmp .= "Patient warned of blurred vision from dilation and offered/advised to wear sunglasses.";}
					if($patient_not_driving==1) {$tmp .= "Patient not driving.";}

					?>
      <tr>
        <td class="lbl paddingTop10">&nbsp;</td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php echo $tmp; ?></td>
      </tr>
      <?php
					}

					if($patientAllergic==1 && $allergicComments !=""){
					?>
      <tr>
        <td class="lbl"></td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php if($patientAllergic == 1) echo "<strong>Patient allergic to Dilation drops.</strong>"; else echo '&nbsp;';  if($unableDilateComments!="") echo "<br><strong>Comments: </strong>".$allergicComments;  ?></td>
      </tr>
      <?php
					}

					if($unableDilation==1 && $unableDilateComments!=""){
					?>
      <tr>
        <td class="lbl"></td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php if($unableDilation == 1) echo "<strong>Patient refuses/unable to dilate.</strong>"; else echo '&nbsp;';  if($unableDilateComments!="") echo "<br><strong>Comments: </strong>".$unableDilateComments; else echo '&nbsp;';?></td>
      </tr>
      <?php
					}
					?>
      <?php
						if($statusElemOOD=="1"&&!empty($ood))
						{
						$arrOOD = unserialize($ood);
						foreach($arrOOD as $key=>$val){
						$tmp="";
						if(!empty($arrOOD[$key]["ood"])) $tmp.=$arrOOD[$key]["ood"];
						//
						$tmp = str_replace(array('Piol','Alphagan','Iopidine','Diamox',','), array('Pilo 1%', 'Alphagan P 0.1%', 'Iopidine 0.5%', 'Diamox',', '), $tmp);
						$tmp = trim($tmp); $tmp = trim($tmp,",");
						if(!empty($arrOOD[$key]["other_desc"])) $tmp.="&nbsp;".$arrOOD[$key]["other_desc"];
						$tmp.="&nbsp;&nbsp;".$arrOOD[$key]["eye"]."&nbsp;&nbsp;".$arrOOD[$key]["time"];
						?>
      <tr>
        <td class="lbl paddingTop10">Ophth. Drops</td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php  echo($tmp);?></td>
      </tr>
      <?php
						}
					}
					//elem_chng_divIop_Od=1,elem_chng_divIop_Os=1,elem_chng_divIop3_Od=1,elem_chng_divIop3_Os=1,
					//if(strpos($statusElemGonio, "elem_chng_divIop_Od=1") !== false)
					$gonioPrint1= (strpos($statusElemGonio, "elem_chng_divIop_Od=1") !== false || strpos($statusElemGonio, "elem_chng_divIop_Os=1") !== false) ? true : false;

					if($gonioPrint1==true && ($gonio_od_summary || $gonio_os_summary || $wnlGonioOd || $wnlGonioOs)){
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;" >Gonio</td>
        <td class="sum paddingTop10" style="width:300px;" ><?php if(strpos($statusElemGonio, "elem_chng_divIop_Od=1") !== false){if($gonio_od_summary) echo $this->clearSumm($gonio_od_summary); elseif($wnlGonioOd == 1){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("Gonio", $pid, $fid);}} ?></td>
        <td colspan="2" class="sum paddingTop10" style="width:300px;" ><?php if(strpos($statusElemGonio, "elem_chng_divIop_Os=1") !== false){if($gonio_os_summary ) echo $this->clearSumm($gonio_os_summary); elseif($wnlGonioOs == 1){echo !empty($wnl_value) ? $wnl_value : $this->getExamWnlStr("Gonio", $pid, $fid);}} ?></td>
      </tr>
      <?php
					}

					$gonioPrint3= (strpos($statusElemGonio, "elem_chng_divIop3_Od=1") !== false || strpos($statusElemGonio, "elem_chng_divIop3_Os=1") !== false) ? true : false;
					if($gonioPrint3==true){
					$gonio_drawingAppletImageExist=false;
					if(strpos($gonio_od_drawing,"/") !== false ){
						$GonioIMg=SaveAndShowNewAppletImage($gonio_od_drawing);
						$GonioIMg = $this->data_file_path.'/html2pdfprint/'.$GonioIMg;

						?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">Drawing</td>
        <td colspan="3" class="paddingTop10" style="width:600px;" align="center"><?php if(file_exists($GonioIMg) && is_file($GonioIMg) ){
								$gonio_drawingAppletImageExist=true; $ChartNoteImagesString[]=$GonioIMg; ?>
          <img src="<?php echo($GonioIMg);?>" class="imgdraw" />
          <?php } ?></td>
      </tr>
      <?php
						}
						if($gonio_id!="" && $gonio_drawingAppletImageExist==false){
						$ar_drw =$this->getIDOCdrawingsBySection($sectionName='IOP_GONIO',$primaryId=$gonio_id);
						if(count($ar_drw)>0){
						foreach($ar_drw as $k_drw => $v_drw){
						$gonio_idDrwingImage = $v_drw;
						if($gonio_idDrwingImage!="" && file_exists($gonio_idDrwingImage) && is_file($gonio_idDrwingImage)){
							$ChartNoteImagesString[]=$gonio_idDrwingImage;
							?>
							<tr>
								<td colspan="4" class="paddingTop10" style="width:640px; text-align:center" >
									<img src="<?php echo($gonio_idDrwingImage);?>" class="imgdraw"/>
								</td>
							</tr>
					<?php 	}
							}
							}
						}
						if($gonio_od_desc!="" || $gonio_os_desc!=""){
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;">&nbsp;</td>
        <td class="sum paddingTop10" style="width:300px;" ><?php if($gonio_od_desc ) echo $gonio_od_desc; else echo '&nbsp;'; ?></td>
        <td colspan="2" class="sum paddingTop10" style="width:300px;" ><?php if($gonio_os_desc) echo $gonio_os_desc; else echo '&nbsp;'; ?></td>
      </tr>
      <?php
					}
					}

					if($desc_ig){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:40px;" >Comments:&nbsp;</td>
        <td colspan="3" class="paddingTop10" style="width:600px;"><?php if($desc_ig) echo htmlentities($desc_ig); else echo '&nbsp;'; ?></td>
      </tr>
      <?php
					}
					?>
    </table>
    <?php
		}

	}
}

public function print_SLE($pid=0,$fid=0){
	global $arrTempProc;
	global $ChartNoteImagesString;
	/**
	 * chart_slit_lamp_exam TABLE SPLITTING TABLES WORK - NOW EVERY SECTION OF SLE EXAM HAS OWN INDEPENDENT TABLES
	 *
	 */
	$sql = "SELECT
			  CON.ncConj,
			  CON.posConj,
			  CON.wnlConj,
			  CON.wnlConjOd,
			  CON.wnlConjOs,
			  CON.conjunctiva_od_summary,
			  CON.conjunctiva_os_summary,
			  CON.wnl_value_Conjunctiva,

			  COR.ncCorn,
			  COR.posCorn,
			  COR.wnlCorn,
			  COR.wnlCornOd,
			  COR.wnlCornOs,
			  COR.cornea_od_summary,
			  COR.cornea_os_summary,
			  COR.wnl_value_Cornea,

			  CAC.ncAnt,
			  CAC.posAnt,
			  CAC.wnlAnt,
			  CAC.wnlAntOd,
			  CAC.wnlAntOs,
			  CAC.wnl_value_Ant,
			  CAC.anf_chamber_od_summary,
			  CAC.anf_chamber_os_summary,

			  CIR.ncIris,
			  CIR.posIris,
			  CIR.wnlIris,
			  CIR.wnlIrisOd,
			  CIR.wnlIrisOs,
			  CIR.wnl_value_Iris,
			  CIR.iris_pupil_od_summary,
			  CIR.iris_pupil_os_summary,

			  CLE.ncLens,
			  CLE.posLens,
			  CLE.wnlLens,
			  CLE.wnlLensOd,
			  CLE.wnlLensOs,
			  CLE.wnl_value_Lens,
			  CLE.lens_od_summary,
			  CLE.lens_os_summary,

			  CLD.id AS sle_id,
			  CLD.ncDraw AS ncDrawSle,
			  CLD.posDraw AS posDrawSle,
			  CLD.wnlDraw AS wnlDrawSle,
			CONCAT
			(
				IFNULL(CON.statusElem,''),
				IFNULL(COR.statusElem,''),
				IFNULL(CAC.statusElem,''),
				IFNULL(CIR.statusElem,''),
				IFNULL(CLE.statusElem,''),
				IFNULL(CLD.statusElem,'')
			)  AS chart_slitStatusElem
			FROM
			  chart_master_table CMT
			  LEFT JOIN chart_conjunctiva CON ON CMT.id = CON.form_id AND CON.purged = '0'
			  LEFT JOIN chart_cornea COR ON CMT.id = COR.form_id AND COR.purged = '0'
			  LEFT JOIN chart_ant_chamber CAC ON CMT.id = CAC.form_id AND CAC.purged = '0'
			  LEFT JOIN chart_iris CIR ON CMT.id = CIR.form_id AND CIR.purged = '0'
			  LEFT JOIN chart_lens CLE ON CMT.id = CLE.form_id AND CLE.purged = '0'
			  LEFT JOIN chart_drawings CLD ON CMT.id = CLD.form_id AND CLD.exam_name = 'SLE' AND CLD.purged = '0'
			WHERE
			  CMT.patient_id = '".$pid."'
			  AND CMT.id = '".$fid."'
			  AND CMT.purge_status = '0'
			  AND CMT.delete_status = '0'
			";

	$row=sqlQuery($sql);
	//------ Check in archive tables for chart_slit_lamp_exam/chart_la/chart_rv For Merged NSE Server
	$sle_id_arc="";
	if(!empty($GLOBALS["CHK_ARCHIVE_TABLE"])){
		if($row == false){
			$sql = str_replace("chart_slit_lamp_exam","chart_slit_lamp_exam_archive",$sql);
			$row=sqlQuery($sql);
			if($row!=false){
				$sle_id_arc="_archive";
			}
		}
	}
	//-------- End ----------------------------------------------------------------------------------
	if($row!=false){
		extract($row);

		$Conj_od = (strpos($chart_slitStatusElem, "elem_chng_div1_Od=1") !== false) ? true : false;
		$Corn_od = (strpos($chart_slitStatusElem, "elem_chng_div2_Od=1") !== false) ? true : false;
		$Ant_od = (strpos($chart_slitStatusElem, "elem_chng_div3_Od=1") !== false) ? true : false;
		$Iris_od = (strpos($chart_slitStatusElem, "elem_chng_div4_Od=1") !== false) ? true : false;
		$Lens_od = (strpos($chart_slitStatusElem, "elem_chng_div5_Od=1") !== false) ? true : false;
		$Draw_od = (strpos($chart_slitStatusElem, "elem_chng_div6_Od=1") !== false) ? true : false;

		$Conj_os = (strpos($chart_slitStatusElem, "elem_chng_div1_Os=1") !== false) ? true : false;
		$Corn_os = (strpos($chart_slitStatusElem, "elem_chng_div2_Os=1") !== false) ? true : false;
		$Ant_os = (strpos($chart_slitStatusElem, "elem_chng_div3_Os=1") !== false) ? true : false;
		$Iris_os = (strpos($chart_slitStatusElem, "elem_chng_div4_Os=1") !== false) ? true : false;
		$Lens_os = (strpos($chart_slitStatusElem, "elem_chng_div5_Os=1") !== false) ? true : false;
		$Draw_os = (strpos($chart_slitStatusElem, "elem_chng_div6_Os=1") !== false) ? true : false;


		if(  $Conj_od || $Conj_os
			||$Corn_od || $Corn_os
			||$Ant_od || $Ant_os
			||$Iris_od || $Iris_os
			||$Lens_od || $Lens_os
			||$Draw_od || $Draw_os
		)
		{
		$SLEPrint=true;
		}else{
			$SLEPrint=false;
		}

		if($SLEPrint == true){
		?>
    <table cellpadding="0" cellspacing="0"  style="width:750px;">
	 <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	</tr>
	 <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10" >Slit Lamp Exam</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10">&nbsp;</td>
        <td class="sum bdrright paddingTop10"><?php $this->odLable();?></td>
        <td class="sum paddingTop10"><?php $this->osLable();?></td>
      </tr>
      <?php
					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Conjunctiva",$arrTempProc) )){
					if( ($Conj_od || $Conj_os) &&
						($conjunctiva_od_summary || $conjunctiva_os_summary  || $wnlConjOd || $wnlConjOs) ){
						?>
      <tr>
        <td class="lbl paddingTop10">Conjunctiva&nbsp;</td>
        <td class="sum paddingTop10"><?php if($Conj_od){if($conjunctiva_od_summary){echo $this->clearSumm($conjunctiva_od_summary);}elseif($wnlConjOd == 1){echo !empty($wnl_value_Conjunctiva) ? $wnl_value_Conjunctiva : $this->getExamWnlStr("Conjunctiva", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10" ><?php if($Conj_os){if($conjunctiva_os_summary){echo $this->clearSumm($conjunctiva_os_summary);} elseif($wnlConjOs ==1){echo !empty($wnl_value_Conjunctiva) ? $wnl_value_Conjunctiva :  $this->getExamWnlStr("Conjunctiva", $pid, $fid);}}  ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Conjuctiva

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Cornea",$arrTempProc) )){
					if(($Corn_od || $Corn_os)&&($cornea_od_summary || $cornea_os_summary || $wnlCornOd || $wnlCornOs)){
						?>
      <tr>
        <td  class="lbl paddingTop10">Cornea</td>
        <td class="sum paddingTop10"><?php if($Corn_od){if($cornea_od_summary){echo $this->clearSumm($cornea_od_summary);} elseif($wnlCornOd == 1){echo !empty($wnl_value_Cornea) ? $wnl_value_Cornea :  $this->getExamWnlStr("Cornea", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($Corn_os){if($cornea_os_summary){echo $this->clearSumm($cornea_os_summary);} elseif($wnlCornOs == 1){echo !empty($wnl_value_Cornea) ? $wnl_value_Cornea :  $this->getExamWnlStr("Cornea", $pid, $fid);}} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Cornea

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Ant. Chamber",$arrTempProc) ))
					{
					if(($Ant_od || $Ant_os)&&($anf_chamber_od_summary || $anf_chamber_os_summary || $wnlAntOd || $wnlAntOs)){
						?>
      <tr>
        <td  class="lbl paddingTop10">Chamber</td>
        <td class="sum paddingTop10"><?php if($Ant_od){if($anf_chamber_od_summary){echo $this->clearSumm($anf_chamber_od_summary);}elseif($wnlAntOd  == 1){echo !empty($wnl_value_Ant) ? $wnl_value_Ant :  $this->getExamWnlStr("Ant. Chamber", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($Ant_os){if($anf_chamber_os_summary){echo $this->clearSumm($anf_chamber_os_summary);}elseif($wnlAntOs  == 1){echo !empty($wnl_value_Ant) ? $wnl_value_Ant :  $this->getExamWnlStr("Ant. Chamber", $pid, $fid);}} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Chamber

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Iris & Pupil",$arrTempProc) )){
					if(($Iris_od || $Iris_os) && ($iris_pupil_od_summary || $iris_pupil_os_summary || $wnlIrisOd || $wnlIrisOs)){
						?>
      <tr>
        <td  class="lbl paddingTop10">Iris&nbsp;&amp;&nbsp;Pupil</td>
        <td class="sum paddingTop10"><?php if($Iris_od){if($iris_pupil_od_summary){echo $this->clearSumm($iris_pupil_od_summary);} elseif($wnlIrisOd == 1){echo !empty($wnl_value_Iris) ? $wnl_value_Iris :  $this->getExamWnlStr("Iris & Pupil", $pid, $fid);}} ?></td>
        <td class="sum paddingTop10"><?php if($Iris_os){if($iris_pupil_os_summary){echo $this->clearSumm($iris_pupil_os_summary);} elseif($wnlIrisOs == 1){echo !empty($wnl_value_Iris) ? $wnl_value_Iris : $this->getExamWnlStr("Iris & Pupil", $pid, $fid);}} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Iris Pupil

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Lens",$arrTempProc) )){
					if(($Lens_od || $Lens_os) && ($lens_od_summary || $lens_os_summary || $wnlLensOd || $wnlLensOs)){
						?>
      <tr>
        <td  class="lbl paddingTop10">Lens</td>
        <td class="sum  bdrright"><?php if($Lens_od){if($lens_od_summary){echo $this->clearSumm($lens_od_summary);} elseif($wnlLensOd == 1){echo !empty($wnl_value_Lens) ? $wnl_value_Lens : $this->getExamWnlStr("Lens", $pid, $fid);}} ?></td>
        <td class="sum "><?php if($Lens_os){if($lens_os_summary){echo $this->clearSumm($lens_os_summary);} elseif($wnlLensOs == 1){echo !empty($wnl_value_Lens) ? $wnl_value_Lens : $this->getExamWnlStr("Lens", $pid, $fid);}} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Lens

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("DrawSLE",$arrTempProc) )){
					if($Draw_od || $Draw_os){
					$sle_drawingAppletImageExist=false;

					if($sle_id!="" && $sle_drawingAppletImageExist==false){

						$ar_drw = $this->getIDOCdrawingsBySection($sectionName='SLE',$primaryId=$sle_id);
						if(count($ar_drw)>0){
						foreach($ar_drw as $k_drw => $v_drw){
						$sle_idDrwingImage = $v_drw;
						if($sle_idDrwingImage!="" && file_exists($sle_idDrwingImage) && is_file($sle_idDrwingImage) )
						{
							$ChartNoteImagesString[]=$sle_idDrwingImage;
							?>
				  <tr>
				    <td colspan="3" style=" text-align:center;">
				      <img src="<?php echo($sle_idDrwingImage);?>" class="imgdraw"/>
				      </td>
				    </tr>
				  <?php 	}
						}
						}
						}

					if(strpos($conjunctiva_od_drawing,"/") !== false ){
						$conjuncImg=SaveAndShowNewAppletImage($conjunctiva_od_drawing);
						$conjuncImg=$this->data_file_path.'/html2pdfprint/'.$conjuncImg;

						?>
    </table>
    <table cellpadding="0" cellspacing="0"  style="width:100%;">
      <tr>
        <td class="lbl paddingTop10">Drawing</td>
        <td colspan="2" bgcolor="#99CCFF"><?php
							if(file_exists($conjuncImg) && is_file($conjuncImg))
							{
								$sle_drawingAppletImageExist=true; $ChartNoteImagesString[]=$conjuncImg;
								?>
          <img src="<?php echo($conjuncImg);?>" style="float:left; margin-left:-80px;" class="imgdraw" width="879" height="781" />
          <?php } ?></td>
      </tr>
    </table>
    <table cellpadding="0" cellspacing="0"  style="width:750px;">
      <?php
					 }
					 else if($this->isAppletModified($conjunctiva_od_drawing) || $this->isAppletModified($conjunctiva_os_drawing))
					 {
					?>
      <tr>
        <td class="lbl paddingTop10">Drawing</td>
        <td class="sum" align="center"><?php
										if($this->isAppletModified($conjunctiva_od_drawing))
										{
											//Sle
											$idSle = $sle_id;
											$tableSle = 'chart_drawings';//'chart_slit_lamp_exam'.$sle_id_arc;
											$idNameSle = 'id';
											$pixelSleConjunctivaOd = 'exm_drawing';
											$imageSle = realpath(dirname(__FILE__).'/../../../library/images/pic_con_od.jpg');
											$altSle = 'SLE';
											$this->getAppletImage($idSle,$tableSle,$idNameSle,$pixelSleConjunctivaOd,$imageSle,$altSle,"1");
											$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;
											if(file_exists($gdFilename) && is_file($gdFilename) ){
											echo('<img src="'.$gdFilename.'" height="140" width="220"/>');
											$ChartNoteImagesString[]=$gdFilename;
										 }
										}
								?></td>
        <td class="sum" align="center"><?php
									if($this->isAppletModified($conjunctiva_os_drawing)){
										$idSle = $sle_id ;
										$tableSle = 'chart_drawings';//'chart_slit_lamp_exam'.$sle_id_arc;
										$idNameSle = 'id';
										$pixelSleConjunctivaOs = 'exm_drawing';
										$imageSle = realpath(dirname(__FILE__).'/../../../library/images/pic_con_os.jpg');
										$altSle = 'SLE';
										$this->getAppletImage($idSle,$tableSle,$idNameSle,$pixelSleConjunctivaOs,$imageSle,$altSle,"1");
										$gdFilename = $this->data_file_path.'/../main/html2pdfprint/'.$gdFilename;
										if(file_exists($gdFilename) && is_file($gdFilename)){
											echo('<img src="'.$gdFilename.'" height="140" width="220" />');
											$ChartNoteImagesString[]=$gdFilename;
										}
									}
								?></td>
      </tr>
      <?php
					}
					if($this->isAppletModified($lens_od_drawing) || $this->isAppletModified($lens_os_drawing)){
						?>
      <tr>
        <td>&nbsp;</td>
        <td class="sum" align="center" ><?php
									if($this->isAppletModified($lens_od_drawing)){
										$idSle = $idSle;
										$tableSle = 'chart_drawings';//'chart_slit_lamp_exam'.$sle_id_arc;
										$idNameSle = 'id';
										$pixelSleLensOd = 'exm_drawing';
										$imageSle = realpath(dirname(__FILE__).'/../../../library/images/sleLensOd.jpg');
										$altSle = 'SLE';
										$this->getAppletImage($idSle,$tableSle,$idNameSle,$pixelSleLensOd,$imageSle,$altSle,"1");
										$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;
										if(file_exists($gdFilename) && is_file($gdFilename) ){
										echo('<img src="'.$gdFilename.'" height="105" width="150"/>');
										$ChartNoteImagesString[]=$gdFilename;
										}
									}
								?></td>
        <td class="sum" align="center" ><?php
									if($this->isAppletModified($lens_os_drawing)){
										$idSle = $idSle;
										$tableSle = 'chart_drawings';//'chart_slit_lamp_exam'.$sle_id_arc;
										$idNameSle = 'id';
										$pixelSleLensOs = 'lens_os_drawing';
										$imageSle = realpath(dirname(__FILE__).'/../../../library/images/sleLensOs.jpg');
										$altSle = 'SLE';
										$this->getAppletImage($idSle,$tableSle,$idNameSle,$pixelSleLensOs,$imageSle,$altSle,"1");
										$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;
										if(file_exists($gdFilename) && is_file($gdFilename) ){
										echo('<img src="'.$gdFilename.'" height="105" width="150"/>');
										$ChartNoteImagesString[]=$gdFilename;
										}
									}
								?></td>
      </tr>
      <?php
					}

					}
					} //End Draw

					if($descSle){
					?>
      <tr>
        <td  class="lbl">Comments:&nbsp;</td>
        <td colspan="2" ><?php if($descSle) echo htmlentities($descSle); else echo '&nbsp;'; ?></td>
      </tr>
      <tr>
        <td >&nbsp;</td>
        <td colspan="2" ></td>
      </tr>
      <?php
					} ?>
    </table>
    <?php
		}
	}
}

public function print_RV($pid=0,$fid=0){
	global $arrTempProc;
	global $ChartNoteImagesString;

	//optic nerve
	$strON = $this->print_OpticNerve($pid,$fid);
	/**
	 * chart_rv TABLE SPLITTING TABLES WORK - NOW EVERY SECTION OF FUNDUS EXAM HAS OWN INDEPENDENT TABLES
	 *
	 *
	 * SOME FIELDS WHICH HAS NO MORE FURTHER USE NOW, THAT ARE REMOVED AS MENTION BELOW
	 * CRE.examined_no_change AS chRv,  chart_rv.wnlRetinal(REPEAT), chart_rv.descRv, chart_rv.rv_id, CLD.od_drawing as   RVod_drawing,chart_rv.os_drawing as RVos_drawing,
	*/
	$sql = "SELECT
			  CRE.posRetinal AS flagPosRv,
			  CRE.wnlRetinal AS flagWnlRv,
			  CRE.wnlRetinalOd,
			  CRE.wnlRetinalOs,
			  CRE.periNotExamined,
			  CRE.peri_ne_eye,
			  CRE.ncRetinal,
			  CRE.retinal_od_summary,
			  CRE.retinal_os_summary,
			  CRE.wnl_value_RetinalExam,

    		  CV.wnlVitreous,
			  CV.posVitreous,
			  CV.ncVitreous,
			  CV.vitreous_od_summary,
			  CV.vitreous_os_summary,
			  CV.wnlVitreousOd,
			  CV.wnlVitreousOs,
			  CV.wnl_value_Vitreous,

			  CM.wnlMacula,
			  CM.posMacula,
			  CM.ncMacula,
			  CM.macula_od_summary,
			  CM.macula_os_summary,
			  CM.wnlMaculaOd,
			  CM.wnlMaculaOs,
			  CM.wnl_value_Macula,

 			  CBV.wnlBV,
			  CBV.posBV,
			  CBV.ncBV,
			  CBV.blood_vessels_od_summary,
			  CBV.blood_vessels_os_summary,
			  CBV.wnlBVOd,
			  CBV.wnlBVOs,
			  CBV.wnl_value_BV,

			  CP.wnlPeri,
			  CP.posPeri,
			  CP.ncPeri,
			  CP.periphery_od_summary,
			  CP.periphery_os_summary,
			  CP.wnlPeriOd,
			  CP.wnl_value_Peri,
			  CP.wnlPeriOs,

			  CLD.id AS rv_id,
			  CLD.wnlDraw AS wnlDrawRv,
			  CLD.posDraw AS posDrawRv,
			  CLD.idoc_drawing_id,
			  CLD.ncDraw,
			  CLD.exm_drawing,

			  CONCAT(
				IFNULL(CRE.statusElem,''),
				IFNULL(CV.statusElem,''),
				IFNULL(CBV.statusElem,''),
				IFNULL(CM.statusElem,''),
				IFNULL(CP.statusElem,''),
				IFNULL(CLD.statusElem,'')
			  ) AS chart_rvStatusElem
			FROM
			  chart_master_table CMT
			  LEFT JOIN chart_retinal_exam CRE ON CMT.id = CRE.form_id AND CRE.purged = '0'
			  LEFT JOIN chart_vitreous CV ON CMT.id = CV.form_id AND CV.purged = '0'
			  LEFT JOIN chart_blood_vessels CBV ON CMT.id = CBV.form_id  AND CBV.purged = '0'
			  LEFT JOIN chart_macula CM ON CMT.id = CM.form_id  AND CM.purged = '0'
			  LEFT JOIN chart_periphery CP ON CMT.id = CP.form_id  AND CP.purged = '0'
			  LEFT JOIN chart_drawings CLD ON CMT.id = CLD.form_id AND CLD.purged = '0'
			WHERE
			  CMT.patient_id = '".$pid."'
			  AND CMT.id = '".$fid."'
			  AND CMT.purge_status = '0'
			  AND CMT.delete_status = '0'";

		$row=sqlQuery($sql);
		$rv_id_arc="";
		//------ Check in archive tables for chart_slit_lamp_exam/chart_la/chart_rv For Merged NSE Server
		if(!empty($GLOBALS["CHK_ARCHIVE_TABLE"])){
			if($row==false){
				$sql = str_replace("chart_rv","chart_rv_archive",$sql);
				$row=sqlQuery($sql);
				if($row!=false){
					$rv_id_arc=	'_archive';
				}
			}
		}
		//-------- End ----------------------------------------------------------------------------------
		if($row!=false){

		extract($row);

		$vit_od = (strpos($chart_rvStatusElem, "elem_chng_div1_Od=1") !== false ) ? true : false ;
		$mac_od = (strpos($chart_rvStatusElem, "elem_chng_div2_Od=1") !== false ) ? true : false ;
		$peri_od = (strpos($chart_rvStatusElem, "elem_chng_div3_Od=1") !== false ) ? true : false ;
		$bv_od = (strpos($chart_rvStatusElem, "elem_chng_div4_Od=1") !== false ) ? true : false ;
		$draw_od = (strpos($chart_rvStatusElem, "elem_chng_div5_Od=1") !== false ) ? true : false ;
		$retinal_od = (strpos($chart_rvStatusElem, "elem_chng_div7_Od=1") !== false ) ? true : false ;

		$vit_os = (strpos($chart_rvStatusElem, "elem_chng_div1_Os=1") !== false ) ? true : false ;
		$mac_os = (strpos($chart_rvStatusElem, "elem_chng_div2_Os=1") !== false ) ? true : false ;
		$peri_os = (strpos($chart_rvStatusElem, "elem_chng_div3_Os=1") !== false ) ? true : false ;
		$bv_os = (strpos($chart_rvStatusElem, "elem_chng_div4_Os=1") !== false ) ? true : false ;
		$draw_os = (strpos($chart_rvStatusElem, "elem_chng_div5_Os=1") !== false ) ? true : false ;
		$retinal_os = (strpos($chart_rvStatusElem, "elem_chng_div7_Os=1") !== false ) ? true : false ;

		if(  $vit_od || $vit_os
			||$mac_od || $mac_os
			||$peri_od || $peri_os
			||$bv_od || $bv_os
			||$draw_od || $draw_os||$retinal_od||$retinal_os||$strON)
		{
		$RandVPrint=true;
		}else{
			$RandVPrint=false;
		}

		if(($RandVPrint == true) && (($vitreous_od_summary || $vitreous_os_summary) || ($macula_od_summary || $macula_os_summary) ||
							($periphery_od_summary || $periphery_os_summary) || ($blood_vessels_od_summary || $blood_vessels_od_summary) ||
							($wnlVitreousOd || $wnlVitreousOs) || ($wnlMaculaOd || $wnlMaculaOs) || ($wnlPeriOd || $wnlPeriOs) || ($wnlBVOd || $wnlBVOs) ||
							($retinal_od_summary || $retinal_os_summary || $periNotExamined==1)||$strON
							)){
		?>
    <table style="width:750px;" cellpadding="0" cellspacing="0" >
        <tr >
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	 </tr>
	  <tr>
        <td colspan="3" class="bluehed text_cap paddingTop10">FUNDUS EXAM</td>
      </tr>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">&nbsp;</td>
        <td class="sum paddingTop10" style="width:320px;"><?php $this->odLable();?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php $this->osLable();?></td>
      </tr>
      <?php

					//Show Optic nerve as a part of Fundus Exam ; --

					echo $strON;

					//Show Optic nerve as a part of Fundus Exam ; --

					?>
      <?php
					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Macula",$arrTempProc) )){
					if(($mac_od || $mac_os) && ($macula_od_summary || $macula_os_summary || $wnlMaculaOd || $wnlMaculaOs)){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Macula</td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($mac_od){if($macula_od_summary) echo $this->clearSumm($macula_od_summary); elseif($wnlMaculaOd==1) echo !empty($wnl_value_Macula) ? $wnl_value_Macula : $this->getExamWnlStr("Macula", $pid, $fid);} //'Macula Benign'; ?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($mac_os){if($macula_os_summary) echo $this->clearSumm($macula_os_summary); elseif($wnlMaculaOs==1) echo !empty($wnl_value_Macula) ? $wnl_value_Macula :  $this->getExamWnlStr("Macula", $pid, $fid);} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					}//End Macula

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Vitreous",$arrTempProc) )){
					if(($vit_od || $vit_os)&&($vitreous_od_summary || $vitreous_os_summary || $wnlVitreousOd || $wnlVitreousOs)){
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Vitreous</td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($vit_od){if($vitreous_od_summary) echo $this->clearSumm($vitreous_od_summary); elseif($wnlVitreousOd==1)echo !empty($wnl_value_Vitreous) ? $wnl_value_Vitreous :  $this->getExamWnlStr("Vitreous", $pid, $fid);} //'Clear';?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($vit_os){if($vitreous_os_summary) echo $this->clearSumm($vitreous_os_summary); elseif($wnlVitreousOs==1)echo !empty($wnl_value_Vitreous) ? $wnl_value_Vitreous :   $this->getExamWnlStr("Vitreous", $pid, $fid);} //'Clear'; ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					}//End Vit

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Periphery",$arrTempProc) )){
					if(($peri_od || $peri_os) && ($periphery_od_summary || $periphery_os_summary || $wnlPeriOd || $wnlPeriOs)){
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Periphery</td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($peri_od){if($periphery_od_summary) echo $this->clearSumm($periphery_od_summary); elseif($wnlPeriOd==1) echo !empty($wnl_value_Peri) ? $wnl_value_Peri :  $this->getExamWnlStr("Periphery", $pid, $fid);} ?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php  if($peri_os){if($periphery_os_summary) echo $this->clearSumm($periphery_os_summary); elseif($wnlPeriOs==1) echo !empty($wnl_value_Peri) ? $wnl_value_Peri :  $this->getExamWnlStr("Periphery", $pid, $fid);}  ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					} //End Peri

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Blood Vessels",$arrTempProc) )){
					if(($bv_od || $bv_os) && ($blood_vessels_od_summary || $blood_vessels_os_summary || $wnlBVOd || $wnlBVOs)){
						?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Vessels</td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($bv_od){if($blood_vessels_od_summary) echo $this->clearSumm($blood_vessels_od_summary); elseif($wnlBVOd==1) echo !empty($wnl_value_BV) ? $wnl_value_BV : $this->getExamWnlStr("Blood Vessels", $pid, $fid);} ?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($bv_os){if($blood_vessels_os_summary) echo $this->clearSumm($blood_vessels_os_summary); elseif($wnlBVOs==1) echo !empty($wnl_value_BV) ? $wnl_value_BV :  $this->getExamWnlStr("Blood Vessels", $pid, $fid);} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					}//End BV

					//Retinal Exam
					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("Retinal Exam",$arrTempProc) )){
					if(($retinal_od || $retinal_os) && ($retinal_od_summary || $retinal_os_summary || $wnlRetinalOd || $wnlRetinalOs || $periNotExamined==1)){
						if(isset($GLOBALS["ADD_PERI_WNL_2_RETINAL"])&&!empty($GLOBALS["ADD_PERI_WNL_2_RETINAL"])){
							if($periNotExamined!=1){$wnlPeri="periphery normal";}else{$wnlPeri="periphery not examined";}
						}

						//if PERI NOT EXAM
						if($periNotExamined==1){
							if($wnlRetinalOd!=1 && ($peri_ne_eye=="OU" || $peri_ne_eye=="OD")){ if(!empty($retinal_od_summary)){ $retinal_od_summary .="; ";  }	$retinal_od_summary.=" periphery not examined";	}
							if($wnlRetinalOs!=1 && ($peri_ne_eye=="OU" || $peri_ne_eye=="OS")){ if(!empty($retinal_os_summary)){ $retinal_os_summary .="; ";  }	$retinal_os_summary.=" periphery not examined";	}
						}

						?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Retinal Exam</td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($retinal_od){if($retinal_od_summary) echo $this->clearSumm($retinal_od_summary); elseif($wnlRetinalOd==1) {echo !empty($wnl_value_RetinalExam) ? $wnl_value_RetinalExam." ".$wnlPeri :  $this->getExamWnlStr("Retinal Exam", $pid, $fid)." ".$wnlPeri;  }} ?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php if($retinal_os){if($retinal_os_summary) echo $this->clearSumm($retinal_os_summary); elseif($wnlRetinalOs==1) {echo !empty($wnl_value_RetinalExam) ? $wnl_value_RetinalExam." ".$wnlPeri :   $this->getExamWnlStr("Retinal Exam", $pid, $fid)." ".$wnlPeri;  }} ?></td>
      </tr>
      <?php
						/*<tr>
							<td class="text_value" align="left" valign="top" colspan="3" height="5">&nbsp;</td>
						</tr>
						*/
						?>
      <?php
					}
					}//End Retinal Exam

					if(!isset($arrTempProc) || (in_array("Fundus Exam",$arrTempProc) || in_array("DrawFundus",$arrTempProc) )){
					if($draw_od || $draw_os){
					$rv_drawingImageExist=false;

					if(!empty($idoc_drawing_id) && $rv_drawingImageExist==false){
						$ar_drw = $this->getIDOCdrawingsBySection($sectionName='Fundus_Exam',$primaryId=$rv_id);
						if(count($ar_drw)>0){
						foreach($ar_drw as $k_drw => $v_drw){
						$rv_idDrwingImage = $v_drw;
						if($rv_idDrwingImage!="" && file_exists($rv_idDrwingImage)  && is_file($rv_idDrwingImage) )
						{
							$ChartNoteImagesString[]=$rv_idDrwingImage;
							$rv_drawingImageExist=true;
							?>
							<tr>
								<td colspan="3" class="paddingTop10" style="width:700px;">
									<img src="<?php echo($rv_idDrwingImage);?>" class="imgdraw" style="width:760px; height:484px;"  />
								</td>
							</tr>
					<?php
						}
						}
						}

					}

					if($rv_drawingImageExist==false){
					if($RVod_drawing!="" || $this->isAppletModified($RVod_drawing)){
					if (strpos($RVod_drawing,"/") !== false){
						$MMlaImgRV = SaveAndShowNewAppletImage($RVod_drawing);
						$MMlaImgRV = $this->data_file_path.'/html2pdfprint/'.$MMlaImgRV;

						?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Drawing</td>
        <td colspan="2" align="center" class="paddingTop10" style="width:600px; text-align:center" ><?php if(file_exists($MMlaImgRV) && is_file($MMlaImgRV) ){
								$rv_drawingAppletImageExist=true; $ChartNoteImagesString[]=$MMlaImgRV; ?>
          <img src="<?php echo($MMlaImgRV);?>" class="imgdraw">
          <?php } ?></td>
      </tr>
      <?php }
						else{?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Drawing</td>
        <td class="sum paddingTop10" style="width:320px;" align="center" ><?php
							if($this->isAppletModified($RVod_drawing,"2550-:;")){
								$rv_id = $rv_id;
								$tableRv = 'chart_drawings';//'chart_rv'.$rv_id_arc;
								$idNameRv = 'id';
								$pixelRvOd = 'exm_drawing';
								$imageRv = realpath(dirname(__FILE__).'/../../../library/images/LeftEyeOpticNerve.jpg');
								$altRv = 'RV';
								$this->getAppletImage($rv_id,$tableRv,$idNameRv,$pixelRvOd,$imageRv,$altRv,"1");
								$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;
								if(file_exists($gdFilename) && is_file($gdFilename) ){
								echo('<img src="'.$gdFilename.'" height="100" width="133" />');
								$ChartNoteImagesString[]=$gdFilename;
								}

							}
							?></td>
        <td class="sum paddingTop10" style="width:320px;"><?php

							if($this->isAppletModified($RVos_drawing,"2550-:;"))
							{
								$rv_id = $rv_id;
								$tableRv = 'chart_drawings';//'chart_rv'.$rv_id_arc;
								$idNameRv = 'id';
								$pixelRvOs = 'exm_drawing';
								$imageRv = realpath(dirname(__FILE__).'/../../../library/images/RightEyeOpticNerve.jpg');
								$altRv = 'RV';
								$this->getAppletImage($rv_id,$tableRv,$idNameRv,$pixelRvOs,$imageRv,$altRv,"1");

								$gdFilename = $this->data_file_path.'/html2pdfprint/'.$gdFilename;

								if(file_exists($gdFilename)  && is_file($gdFilename) ){
								echo('<img src="'.$gdFilename.'" height="100" width="133" />');
								$ChartNoteImagesString[]=$gdFilename;
								}

							}

							?></td>
      </tr>
      <?php
						}//end of else
					}
					}
					?>
      <?php
					}
					}//End Draw


					if($descRv){
					?>
      <tr>
        <td class="lbl paddingTop10" style="width:80px;">Comments:&nbsp;</td>
        <td colspan="2" class="paddingTop10" style="width:600px;"><?php if($descRv) echo htmlentities($descRv); else echo '&nbsp;'; ?></td>
      </tr>
      <?php
					}
					?>
    </table>
    <?php
		}
	}
}

public function print_OpticNerve($pid,$fid){

	$ret = "";
	$sql = "SELECT
			  chart_optic.isPositive AS flagPosOptic,
			  chart_optic.wnl AS flagWnlOptic,
			  chart_optic.examined_no_change AS chOptic,
			  chart_optic.cd_val_od,
			  chart_optic.cd_val_os,
			  chart_optic.od_text,
			  chart_optic.os_text,
			  chart_optic.optic_nerve_od_summary,
			  chart_optic.optic_nerve_os_summary,
			  chart_optic.optic_id,
			  chart_optic.statusElem as opticstatusElem,
			  chart_optic.wnlOpticOd,
			  chart_optic.wnlOpticOs,
			  chart_optic.wnl_value_Optic,
			  chart_optic.cdr_od_summary,
			  chart_optic.cdr_os_summary
			FROM
			  chart_optic
			WHERE
			  patient_id = '".$pid."'
			  AND form_id = '".$fid."'
			  AND purged = '0' ";

	$row=sqlQuery($sql);
	if($row!=false){
		extract($row);
		$OptNevPrint=(strpos($opticstatusElem, "elem_chng_div6_Od=1") !== false || strpos($opticstatusElem, "elem_chng_div6_Os=1") !== false)?true:false;

		if(($OptNevPrint == true) && (($od_text || $os_text) || ($optic_nerve_od_summary || $optic_nerve_os_summary || $cdr_od_summary || $cdr_os_summary || $wnlOpticOd || $wnlOpticOs))){
	?>
    <?php
				/*
				<table >
					<tr >
						<td colspan="3" class="tb_heading">Opt.Nev/Disc</td>
					</tr>
					<tr>
						<td class="lbl">&nbsp;</td>
						<td class="sum"><?php $this->odLable();?></td>
						<td class="sum"><?php $this->osLable();?></td>
					</tr>
				*/
				?>
    <?php
					if($cdr_od_summary!="" || $cdr_os_summary!=""){

						if(strpos($opticstatusElem, "elem_chng_div6_Od=1") !== false && ($cdr_od_summary)){ $echoOD= trim($cdr_od_summary); }else{ $echoOD= '&nbsp;'; }
						if(strpos($opticstatusElem, "elem_chng_div6_Os=1") !== false && ($cdr_os_summary)){ $echoOS= trim($cdr_os_summary); }else{ $echoOS= '&nbsp;'; }

						$ret .= "<tr>
							<td  class=\"lbl paddingTop10\">C:D</td>
							<td class=\"sum paddingTop10\">".html_entity_decode($echoOD, ENT_QUOTES | ENT_HTML5)."</td>
							<td class=\"sum paddingTop10\">".html_entity_decode($echoOS, ENT_QUOTES | ENT_HTML5)."</td>
						</tr>";


					}
					if($optic_nerve_od_summary || $optic_nerve_os_summary || $wnlOpticOd || $wnlOpticOs){

						if(strpos($opticstatusElem, "elem_chng_div6_Od=1") !== false && $optic_nerve_od_summary){ $echoOD= $this->clearSumm($optic_nerve_od_summary); }else if($wnlOpticOd==1){ $echoOD= !empty($wnl_value_Optic) ? $wnl_value_Optic : $this->getExamWnlStr("Optic Nerve", $pid, $fid);} //'Pink & Sharp';
						if(strpos($opticstatusElem, "elem_chng_div6_Os=1") !== false && $optic_nerve_os_summary){ $echoOS= $this->clearSumm($optic_nerve_os_summary); }else if($wnlOpticOs==1){ $echoOS= !empty($wnl_value_Optic) ? $wnl_value_Optic : $this->getExamWnlStr("Optic Nerve", $pid, $fid);} //'Pink & Sharp';

						$ret .= "<tr>
							<td class=\"lbl paddingTop10\">Opt.Nev</td>
							<td class=\"sum paddingTop10\">".$echoOD."</td>
							<td class=\"sum paddingTop10\">".$echoOS."</td>
						</tr>";

					}
					?>
    <?php
				//</table>
				?>
    <?php
		}

	}

	return $ret;
}

	public function get_prosthesis($pid,$fid){
		$eyePr=array();$phth_pros=$eyePr="";
		if($pid && $fid){
			$qryProsthesis="SELECT phth_pros,eyePrPh from chart_left_cc_history where patient_id='".$pid."' AND form_id='".$fid."'";
			$resProsthesis=imw_query($qryProsthesis);
			if(imw_num_rows($resProsthesis)>0){
				$rowProsthesis=imw_fetch_assoc($resProsthesis);
				$phth_pros=$rowProsthesis['phth_pros'];
				$eyePr=$rowProsthesis['eyePrPh'];
			}
		}
		return array("label"=>$phth_pros,"value"=>$eyePr);
	}

	public function print_RefractSurgery($pid=0,$fid=0){
		$sql="SELECT * FROM chart_ref_surgery WHERE patient_id='".$pid."' AND form_id='".$fid."' AND purged='0' ";
		$row = sqlQuery($sql);
		if($row!=false){
			extract($row);
			$flgPrint=(strpos($statusElem, "elem_chng_div1_Od=1") !== false || strpos($statusElem, "elem_chng_div1_Os=1") !== false)?true:false;

			if(($flgPrint == true) && !empty($sumOdRefSurg) || !empty($sumOsRefSurg)){
			?>
    <table >
      <tr>
        <td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="3" height="2"></td>
	  </tr>
	  <tr >
        <td colspan="3" class="bluehed text_cap paddingTop10">Refractive Surgery</td>
      </tr>
      <tr>
        <td class="lbl">&nbsp;</td>
        <td class="sum"><?php $this->odLable();?></td>
        <td class="sum"><?php $this->osLable();?></td>
      </tr>
      <tr>
        <td class="lbl">&nbsp;</td>
        <td class="sum" ><?php if(strpos($statusElem, "elem_chng_div1_Od=1") !== false&&!empty($sumOdRefSurg)) echo $this->clearSumm($sumOdRefSurg); else {echo "";} ?></td>
        <td class="sum"><?php if(strpos($statusElem, "elem_chng_div1_Os=1") !== false&&!empty($sumOsRefSurg)) echo $this->clearSumm($sumOsRefSurg); else {echo "";} ?></td>
      </tr>
      <?php if($descRefSurg)
					{
					?>
      <tr>
        <td class="lbl">Comments:&nbsp;</td>
        <td colspan="2"><?php if($descRefSurg) echo htmlentities($descRefSurg); else echo '&nbsp;'; ?></td>
      </tr>
      <?php }
					?>
    </table>
    <?php

			}
		}
	}

	public function print_cn_progress_notes($pid,$fid, $dt=""){
		$str_table="";
		$sql = "SELECT ".
			 " notes, usr_id, form_id  ".
			 " FROM chart_progress_notes WHERE patient_id='".$pid."' AND form_id='".$fid."' ";

		$row=sqlQuery($sql);
		if($row!=false){
			extract($row);

			$notes_val=$notes;
			$user_nm = getUserFirstName($usr_id,1);
			if(!empty($user_nm)){ $user_nm=" - ".$user_nm; }

			$str_dos="";
			if(!empty($dt)){
				$ardos = $this->print_getChartDetails($pid,$fid);
				$str_dos = " DOS: ".$ardos["date_of_service"];
			}

				$placeholders = array('>o','<o','<1', '<2', '<3', '<4','<5', '<6', '<7', '<8','<9','<0');
				$replace_vals = array('&gt;o','&lt;o','&lt;1','&lt;2','&lt;3','&lt;4','&lt;5', '&lt;6', '&lt;7', '&lt;8','&lt;9','&lt;0');
				$notes_val=str_replace($placeholders,$replace_vals,$notes_val);
				$notes_val=nl2br(htmlentities($notes_val));
				$str_table='<table style="width:100%;"  cellpadding="0" cellspacing="0">
									<tr><td class="tb_heading">Progress Note '.$user_nm.$str_dos.'</td></tr>
									<tr><td style="width:100%;padding-left:4px;" class="">'.$notes_val.'</td></tr>
									<tr><td style="height:5px"></td></tr>
								  </table>';

		}
		if(!empty($dt)){
			return $str_table;
		}else{
			echo $str_table;
		}
	}

	function getFacilityName($id)
	{
		$sql = "SELECT name FROM facility ".
			   "WHERE id = '$id' ";

		$row = sqlQuery($sql);

		if($row != false)
		{
			$ret = $row["name"];
			return $ret;
		}
		else
		{
			return false;
		}
	}

	public function print_Ophtha($pid=0,$fid=0){

		$sql = "SELECT * ".
			 " FROM ophtha WHERE patient_id='".$pid."' AND form_id='".$fid."' ";
		$row=sqlQuery($sql);
		if($row!=false){
			extract($row);

			$facility_id = $row["facility_id"];
			$facility_name = $this->getFacilityName($facility_id);
			$exam_date = get_date_format($row["exam_date"]);
			$app_os = $row["ophtha_os"];
			$app_od = $row["ophtha_od"];
			$doctor_name = $row["doctor_name"];
			$doctor_sign = $row["doctor_sign"];
			$notes=$row["notes"];
			$idOptha = $row["ophtha_id"];

		if($idOptha != "")
		{
		?>
    <table cellpadding="0" cellspacing="0" style="width:755px;" >
      <tr>
        <td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
      </tr>
	  <tr>
		<td colspan="2" height="2"></td>
	  </tr>
	  <tr>
        <td colspan="2" class="bluehed text_cap paddingTop10">Ophthamoscopy</td>
      </tr>
      <?php
		if($this->isAppletModified($app_os) || $this->isAppletModified($app_od))
		{
		?>
      <tr>
        <td class="sum paddingTop10"  style="width:300px; text-align:center;"><?php $this->odLable();?></td>
        <td class="sum paddingTop10" style="width:300px; text-align:left;"><?php $this->osLable();?></td>
      </tr>
      <tr>
        <td  style="width:350px; text-align:center;" class="sum paddingTop10"><?php
				$tableOptha = 'ophtha';
				$idNameOptha = 'ophtha_id';
				$pixelOpthaOd = 'ophtha_od';
				$imageOptha = realpath(dirname(__FILE__).'/../../../library/images/ophtha.jpg');
				$altOptha = 'OD';
				global $gdFilename,$ChartNoteImagesString;
				$this->getAppletImage($idOptha,$tableOptha,$idNameOptha,$pixelOpthaOd,$imageOptha,$altOptha,"1");
				$gdFilenamePath =$this->data_file_path."/html2pdfprint/".$gdFilename;
				//$gdFilenameThumbPath = "../common/new_html2pdf/".$gdFilename;
				//$gdFilename=$objectSaveFile->createThumbs($gdFilenamePath,$gdFilenamePath,$thumbWidth="342",$thumbHeight="342","jpg");
				if( file_exists($gdFilenamePath)  && is_file($gdFilenamePath) ){
				echo("<img src=\"".$gdFilenamePath."\" height=\"80\" />"); //width=\"342\"
				$ChartNoteImagesString[]=$gdFilenamePath;
				}
				?></td>
        <td class="sum paddingTop10" style="width:300px; text-align:left;"><?php
				if($this->isAppletModified($app_os) || $this->isAppletModified($app_od)){
				$tableOptha = 'ophtha';
				$idNameOptha = 'ophtha_id';
				$pixelOpthaOs = 'ophtha_os';
				$imageOptha = realpath(dirname(__FILE__).'/../../../library/images/ophtha.jpg');
				$altOptha = 'OS';
				$this->getAppletImage($idOptha,$tableOptha,$idNameOptha,$pixelOpthaOs,$imageOptha,$altOptha,"1");
				$gdFilenamePath = $this->data_file_path."/html2pdfprint/".$gdFilename;
				if( file_exists($gdFilenamePath)  && is_file($gdFilenamePath) ){
				echo("<img src=\"".$gdFilenamePath."\" height=\"80\" />"); //width=\"342\"
				$ChartNoteImagesString[]=$gdFilenamePath;
				}
				}
				?></td>
      </tr>
      <?php
			}
		?>
      <?php
		if($notes<>"") {
		?>
      <tr>
        <td colspan="2" class="paddingTop10"><b>Notes:&nbsp;</b><?php echo($notes);?></td>
      </tr>
      <?php }	?>
      <?php

			if(isset($_SESSION["finalize_id"]) && !empty($_SESSION["finalize_id"]) && (1==2))
			{
		?>
      <tr>
        <td colspan="2"><b>Finalized Signature:</b>
          <?php
				//Doctor Sign
				$idPlan = $_SESSION["finalize_id"];
				$tablePlan = 'chart_assessment_plans';
				$idNamePlan = 'form_id';
				$pixelPlan = 'sign_coords';
				$imagePlan = realpath(dirname(__FILE__).'/../../../library/images/white.jpg');
				$altPlan = 'Doctor Sign';
				echo $this->getAppletImage($idPlan,$tablePlan,$idNamePlan,$pixelPlan,$imagePlan,$altPlan);
			?></td>
      </tr>
      <?php
			}
		?>
      <tr>
        <td colspan="2"><b>Performed By:&nbsp;</b><?php echo ($this->showDoctorName($doctor_name));?></td>
      </tr>
    </table>
    <?php
		}

		}
	}

	public function print_phyInitial($phyid){
		$phyname="";
		$getNameQry = imw_query("SELECT `fname`,`lname` FROM `users` WHERE id = '".$phyid."'");
		if(imw_num_rows($getNameQry)>0){
			$getNameRow = imw_fetch_assoc($getNameQry);
			$phyFname 	= substr(trim($getNameRow['fname']),0,1);
			$phyLname 	= substr(trim($getNameRow['lname']),0,1);
			$phyname 	= strtoupper($phyFname.$phyLname);
		}
		return $phyname;
	}

	public function print_vf($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sqlVFFormQry = imw_query("SELECT * FROM vf WHERE patientId = '".$patient_id."' AND vf_id in (".implode(",",$req).")");
		}else if($form_id!=""){
			$sqlVFFormQry = imw_query("SELECT * FROM vf WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ");
		}


		if(imw_num_rows($sqlVFFormQry)>0){
			while($sqlVFFormRow = imw_fetch_assoc($sqlVFFormQry)){
			extract($sqlVFFormRow);
			if($performedBy){
				/*$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as namePerformer FROM users WHERE id = '$performedBy'");
				$getNameRow = imw_fetch_assoc($getNameQry);
				$namePerformer = $getNameRow['namePerformer'];*/
				$namePerformer = $this->print_phyInitial($performedBy);
			}

				$orderByName="";
				if($ordrby){
				/*$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as orderByName FROM users WHERE id = '$ordrby '");
				$getNameRow = imw_fetch_assoc($getNameQry);
				$orderByName = $getNameRow['orderByName'];*/
				$orderByName = $this->print_phyInitial($ordrby);
				}
				if($orderByName){
					$orderByName = "<span class=\"text_lable\">Order By:&nbsp;</span>".$orderByName;
					if($ordrdt && $ordrdt!="0000-00-00") {$orderByName .= "&nbsp;&nbsp;".get_date_format($ordrdt);}
				}
			?>

					<table style="width:750px;"  cellpadding="0" cellspacing="0">
						<tr>
							<td colspan="2" class="bluelne" height="1" style="width:750px;" >&nbsp;</td>
						</tr>
						<tr>
							<td colspan="2" class="bluehed text_cap paddingTop10" style="width:750px;" >VF (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)&nbsp;<?php echo $orderByName;?></td>
						</tr>

						<tr>
							<td colspan="2" style="width:700px;" class="paddingTop10">
							<b>VF</b>&nbsp;<?php echo($vf_eye."&nbsp;".$elem_gla_mac); ?>
							</td>
						</tr>

						<?php
						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if($namePerformer || $ptUnderstanding || $diagnosis )
						{
							?>

						<?php if($techComments!=""){?>
							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><b>Technician Comments:</b>&nbsp;<?php echo($techComments);?></td>
							</tr>
						<?php } ?>
							<tr>
								<td  colspan="2" style="width:700px;" class="paddingTop10">
									<span class="text_lable">Performed By:&nbsp;</span> <?php echo $namePerformer; ?>
									&nbsp;&nbsp;
									<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;<?php echo $ptUnderstanding; ?>
									&nbsp;&nbsp;
									<span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?>
								</td>
							</tr>


						<?php
						}
						if($reliabilityOd || $reliabilityOs)
						{
						?>
						<tr>
							<td colspan="2" style="width:700px;">
						<table style="width:740px;" cellpadding="0" cellspacing="0">
							<tr>
								<td class="text_lable paddingTop10" style="width:180px;">Physician Interpretation:&nbsp;</td>
								<td class="text_lable paddingTop10" style="width:80px;">Reliability</td>
								<td class="text_lable paddingTop10" style="width:50px;"><?php $this->odLable();?></td>
								<td style="width:100px;" class="paddingTop10"><?php echo $reliabilityOd; ?></td>
								<td class="text_lable paddingTop10" style="width:50px;"><?php $this->osLable(); ?></td>
								<td style="width:100px;" class="paddingTop10"><?php echo $reliabilityOs; ?></td>
							</tr>
						</table>
						</td>
						</tr>
						<?php
						}
						// OD DATA
						$odData ="";
						if($Normal_OD_T) $odData = 'Normal&nbsp; ';
						if($Normal_OD_PoorStudy == 1) $odData .= '<br>Poor Study&nbsp; ';
						if($BorderLineDefect_OD_T == 1 || $BorderLineDefect_OD_1 == 1 || $BorderLineDefect_OD_2 == 1 || $BorderLineDefect_OD_3 == 1 || $BorderLineDefect_OD_4 == 1)
						{
							$odData.= '<br>Border Line Defect ';
							$odData.= '&nbsp; ';
							if($BorderLineDefect_OD_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($BorderLineDefect_OD_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($BorderLineDefect_OD_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($BorderLineDefect_OD_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($BorderLineDefect_OD_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($Abnormal_OD_T == 1 || $Abnormal_OD_1 == 1 || $Abnormal_OD_2 == 1 || $Abnormal_OD_3 == 1 || $Abnormal_OD_4 == 1)
						{
							$odData.= '<br>Abnormal ';
							$odData.= '&nbsp; ';
							if($Abnormal_OD_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($Abnormal_OD_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($Abnormal_OD_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($Abnormal_OD_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($Abnormal_OD_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($NasalSteep_OD_Superior == 1 || $NasalSteep_OD_S_T == 1 || $NasalSteep_OD_S_1 == 1 || $NasalSteep_OD_S_2 == 1 || $NasalSteep_OD_S_3 == 1 || $NasalSteep_OD_S_4 == 1)
						{
							$odData.= '<br>Nasal Step ';
							if($NasalSteep_OD_Superior == 1) $odData.= 'Superior ';
							if($NasalSteep_OD_S_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($NasalSteep_OD_S_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($NasalSteep_OD_S_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($NasalSteep_OD_S_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($NasalSteep_OD_S_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($NasalSteep_OD_Inferior == 1 || $NasalSteep_OD_I_T == 1 || $NasalSteep_OD_I_1 == 1 || $NasalSteep_OD_I_2 == 1 || $NasalSteep_OD_I_3 == 1 || $NasalSteep_OD_I_4 == 1){
							$odData.= '<br>Nasal Step ';
							if($NasalSteep_OD_Inferior == 1) $odData.= 'Inferior ';
							if($NasalSteep_OD_I_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($NasalSteep_OD_I_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($NasalSteep_OD_I_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($NasalSteep_OD_I_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($NasalSteep_OD_I_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($Arcuatedefect_OD_Superior == 1 || $Arcuatedefect_OD_S_T == 1 || $Arcuatedefect_OD_S_1 == 1 || $Arcuatedefect_OD_S_2 == 1 || $Arcuatedefect_OD_S_3 == 1 || $Arcuatedefect_OD_S_4 == 1){
							$odData.= '<br>Arcuate defect ';
							if($Arcuatedefect_OD_Superior == 1) $odData.= 'Superior ';
							if($Arcuatedefect_OD_S_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($Arcuatedefect_OD_S_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($Arcuatedefect_OD_S_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($Arcuatedefect_OD_S_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($Arcuatedefect_OD_S_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($Arcuatedefect_OD_Inferior == 1 || $Arcuatedefect_OD_I_T == 1 || $Arcuatedefect_OD_I_1 == 1 || $Arcuatedefect_OD_I_2 == 1 || $Arcuatedefect_OD_I_3 == 1 || $Arcuatedefect_OD_I_4 == 1){
							$odData.= '<br>Arcuate defect ';
							if($Arcuatedefect_OD_Inferior == 1) $odData.= 'Inferior ';
							if($Arcuatedefect_OD_I_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($Arcuatedefect_OD_I_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($Arcuatedefect_OD_I_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($Arcuatedefect_OD_I_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($Arcuatedefect_OD_I_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($Defect_OD_Central == 1 || $Defect_OD_Superior == 1 || $Defect_OD_Inferior == 1 || $Defect_OD_Scattered == 1
							||
							$Defect_OD_T == 1 || $Defect_OD_1 == 1 || $Defect_OD_2 == 1 || $Defect_OD_3 == 1 || $Defect_OD_4 == 1
							){
							$odData.= '<br>Defect ';
							if($Defect_OD_Central == 1) $odData.= 'Central ';
							if($Defect_OD_Superior == 1) $odData.= 'Superior ';
							if($Defect_OD_Inferior == 1) $odData.= 'Inferior ';
							if($Defect_OD_Scattered == 1) $odData.= 'Scattered ';
							if($Defect_OD_Central == 1 || $Defect_OD_Superior == 1 || $Defect_OD_Inferior == 1 || $Defect_OD_Scattered == 1)
								$odData.= '<br>&nbsp; ';
							if($Defect_OD_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($Defect_OD_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($Defect_OD_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($Defect_OD_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($Defect_OD_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($blindSpot_OD_T == 1 || $blindSpot_OD_1 == 1 || $blindSpot_OD_2 == 1 || $blindSpot_OD_3 == 1 || $blindSpot_OD_4 == 1){
							$odData.= '<br>Increase size of Blind&nbsp;spot ';
							if($blindSpot_OD_T == 1) $odData.= '&nbsp;T&nbsp; ';
							if($blindSpot_OD_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
							if($blindSpot_OD_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
							if($blindSpot_OD_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
							if($blindSpot_OD_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
						}
						if($NoSigChange_OD == 1) $odData.= '<br/>No Sig. Change&nbsp; ';
							if($Improved_OD == 1) $odData.= '&nbsp;Improved&nbsp; ';
							if($IncAbn_OD == 1) $odData.= '&nbsp;Inc. Abn&nbsp; ';
						if($iopTrgtOd  !="") $odData.= '<br/>IOP Target:'.$iopTrgtOd.'&nbsp; ';
						// OS DATA
						$osData = "";
						if($Normal_OS_T) $osData = 'Normal&nbsp; ';
						if($Normal_OS_PoorStudy == 1) $osData .= '<br>Poor Study&nbsp; ';
						if($BorderLineDefect_OS_T == 1 || $BorderLineDefect_OS_1 == 1 || $BorderLineDefect_OS_2 == 1 || $BorderLineDefect_OS_3 == 1 || $BorderLineDefect_OS_4 == 1){
							$osData.= '<br>Border Line Defect ';
							$osData.= '&nbsp; ';
							if($BorderLineDefect_OS_T == 1) $osData.= '&nbsp;T&nbsp; ';
							if($BorderLineDefect_OS_1 == 1) $osData.= '&nbsp;+1&nbsp; ';
							if($BorderLineDefect_OS_2 == 1) $osData.= '&nbsp;+2&nbsp; ';
							if($BorderLineDefect_OS_3 == 1) $osData.= '&nbsp;+3&nbsp; ';
							if($BorderLineDefect_OS_4 == 1) $osData.= '&nbsp;+4&nbsp; ';
						}
						if($Abnormal_OS_T == 1 || $Abnormal_OS_1 == 1 || $Abnormal_OS_2 == 1 || $Abnormal_OS_3 == 1 || $Abnormal_OS_4 == 1){
							$osData.= '<br>Abnormal ';
							$osData.= '&nbsp; ';
							if($Abnormal_OS_T == 1) $osData.= '&nbsp;T&nbsp; ';
							if($Abnormal_OS_1 == 1) $osData.= '&nbsp;+1&nbsp; ';
							if($Abnormal_OS_2 == 1) $osData.= '&nbsp;+2&nbsp; ';
							if($Abnormal_OS_3 == 1) $osData.= '&nbsp;+3&nbsp; ';
							if($Abnormal_OS_4 == 1) $osData.= '&nbsp;+4&nbsp; ';
						}
						if($NasalSteep_OS_Superior == 1 || $NasalSteep_OS_S_T == 1 || $NasalSteep_OS_S_1 == 1 || $NasalSteep_OS_S_2 == 1 || $NasalSteep_OS_S_3 == 1 || $NasalSteep_OS_S_4 == 1){
							$osData.= '<br>Nasal Step ';
							if($NasalSteep_OS_Superior == 1) $osData.= 'Superior ';
							if($NasalSteep_OS_S_T == 1) $osData.= '&nbsp;T&nbsp; ';
							if($NasalSteep_OS_S_1 == 1) $osData.= '&nbsp;+1&nbsp; ';
							if($NasalSteep_OS_S_2 == 1) $osData.= '&nbsp;+2&nbsp; ';
							if($NasalSteep_OS_S_3 == 1) $osData.= '&nbsp;+3&nbsp; ';
							if($NasalSteep_OS_S_4 == 1) $osData.= '&nbsp;+4&nbsp; ';
						}
						if($NasalSteep_OS_Inferior == 1 || $NasalSteep_OS_I_T == 1 || $NasalSteep_OS_I_1 == 1 || $NasalSteep_OS_I_2 == 1 || $NasalSteep_OS_I_3 == 1 || $NasalSteep_OS_I_4 == 1){
							$osData.= '<br>Nasal Step ';
							if($NasalSteep_OS_Inferior == 1) $osData.= 'Inferior ';
							if($NasalSteep_OS_I_T == 1) $osData.= '&nbsp;T&nbsp; ';
							if($NasalSteep_OS_I_1 == 1) $osData.= '&nbsp;+1&nbsp; ';
							if($NasalSteep_OS_I_2 == 1) $osData.= '&nbsp;+2&nbsp; ';
							if($NasalSteep_OS_I_3 == 1) $osData.= '&nbsp;+3&nbsp; ';
							if($NasalSteep_OS_I_4 == 1) $osData.= '&nbsp;+4&nbsp; ';
						}
						if($Arcuatedefect_OS_Superior == 1 || $Arcuatedefect_OS_S_T == 1 || $Arcuatedefect_OS_S_1 == 1 || $Arcuatedefect_OS_S_2 == 1 || $Arcuatedefect_OS_S_3 == 1 || $Arcuatedefect_OS_S_4 == 1){
							$osData.= '<br>Arcuate defect ';
							if($Arcuatedefect_OS_Superior == 1) $osData.= 'Superior ';
							if($Arcuatedefect_OS_S_T == 1) $osData.= '&nbsp;T&nbsp; ';
							if($Arcuatedefect_OS_S_1 == 1) $osData.= '&nbsp;+1&nbsp; ';
							if($Arcuatedefect_OS_S_2 == 1) $osData.= '&nbsp;+2&nbsp; ';
							if($Arcuatedefect_OS_S_3 == 1) $osData.= '&nbsp;+3&nbsp; ';
							if($Arcuatedefect_OS_S_4 == 1) $osData.= '&nbsp;+4&nbsp; ';
						}
						if($Arcuatedefect_OS_Inferior == 1 || $Arcuatedefect_OS_I_T == 1 || $Arcuatedefect_OS_I_1 == 1 || $Arcuatedefect_OS_I_2 == 1 || $Arcuatedefect_OS_I_3 == 1 || $Arcuatedefect_OS_I_4 == 1){
							$osData.= '<br>Arcuate defect ';
							if($Arcuatedefect_OS_Inferior == 1) $osData.= 'Inferior ';
							if($Arcuatedefect_OS_I_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Arcuatedefect_OS_I_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Arcuatedefect_OS_I_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Arcuatedefect_OS_I_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Arcuatedefect_OS_I_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Defect_OS_Central == 1 || $Defect_OS_Superior == 1 || $Defect_OS_Inferior == 1 || $Defect_OS_Scattered == 1
							||
							$Defect_OS_T == 1 || $Defect_OS_1 == 1 || $Defect_OS_2 == 1 || $Defect_OS_3 == 1 || $Defect_OS_4 == 1
							){
							$osData.= '<br>Defect ';
							if($Defect_OS_Central == 1) $osData.= 'Central ';
							if($Defect_OS_Superior == 1) $osData.= 'Superior ';
							if($Defect_OS_Inferior == 1) $osData.= 'Inferior ';
							if($Defect_OS_Scattered == 1) $osData.= 'Scattered ';
							if($Defect_OS_Central == 1 || $Defect_OS_Superior == 1 || $Defect_OS_Inferior == 1 || $Defect_OS_Scattered == 1)
								$osData.= '<br>&nbsp;';
							if($Defect_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Defect_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Defect_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Defect_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Defect_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($blindSpot_OS_T == 1 || $blindSpot_OS_1 == 1 || $blindSpot_OS_2 == 1 || $blindSpot_OS_3 == 1 || $blindSpot_OS_4 == 1){
							$osData.= '<br>Increase size of Blind&nbsp;spot';
							if($blindSpot_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($blindSpot_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($blindSpot_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($blindSpot_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($blindSpot_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($NoSigChange_OS == 1) $osData.= '<br/>No Sig. Change&nbsp;';
							if($Improved_OS == 1) $osData.= '&nbsp;Improved&nbsp;';
							if($IncAbn_OS == 1) $osData.= '&nbsp;Inc. Abn&nbsp;';
							if($iopTrgtOs  !="") $osData.= '<br/>IOP Target:'.$iopTrgtOs.'&nbsp;';
					if($osData!="" || $odData!="" || $Others_OD!="" || $Others_OS!=""){
							?>
							<tr>
								<td class="tb_subheading paddingTop10" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:360px;" class="paddingTop10"><?php $this->odLable();?></td>
								<td style="width:360px;" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:360px;" class="paddingTop10"><?php echo  $odData; ?></td>
								<td style="width:360px;" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						if($Others_OD!="" || $Others_OS!=""){
							?>
								<tr>
									<td style="width:360px;" class="paddingTop10"><?php echo htmlentities($Others_OD); ?></td>
									<td style="width:360px;" class="paddingTop10"><?php echo htmlentities($Others_OS); ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}
							$Others_OD = '';
							$Others_OS = '';
							$treatment = '';



							if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
							if($contiMeds == 1) $treatment.= '&nbsp;Continue Meds &nbsp;';
							if($monitorIOP == 1) $treatment.= '&nbsp;Monitor IOP &nbsp;';
							if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
							if($tech2InformPt == 1) $treatment.= '&nbsp;Tech to inform Pt.&nbsp;';
							if($ptInformed == 1) $treatment.= 'Pt informed of results';
							if($ptInformedNv==1)$treatment.= '&nbsp;Informed Pt. result next visit.&nbsp;';
							if($rptTst1yr==1){$treatment.= '&nbsp;Repeat test 1 year &nbsp;';}


							if($stable == 1 || $fuApa == 1 || $ptInformed == 1 || $rptTst1yr==1 || $tech2InformPt == 1 || $contiMeds==1 || $monitorIOP==1 || $ptInformedNv==1){
								?>
								<tr>
									<td colspan="2" style="width:700px;" class="paddingTop10" ><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>

								<?php
							}
						if($loss_sup_degree_od && $improve_degree_od)
						{
							?>

								<tr>
									<td style="width:700px;" class="paddingTop10" colspan="2">
									Visual field in the Right Eye shows loss of the superior (<?php echo $loss_sup_degree_od;?>) degrees. This improves by (<?php echo $improve_degree_od;?>) degrees when the lid is taped in the elevated position. This documents functional ptosis in the Right Eye.
									</td>
								</tr>

							<?php
						}

						if($loss_sup_degree_os && $improve_degree_os)
						{
							?>

								<tr>
									<td style="width:700px;" class="paddingTop10" colspan="2">
									Visual field in the Left Eye shows loss of the superior (<?php echo $loss_sup_degree_os;?>) degrees. This improves by (<?php echo $improve_degree_os;?>) degrees when the lid is taped in the elevated position. This documents functional ptosis in the Left Eye.
									</td>
								</tr>

							<?php
						}
						if($comments!=""){
						?>

								<tr>
									<td colspan="2" style="width:700px;" class="paddingTop10" ><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
								</tr>

						<?php
						}

						///Add VF Images//
						$imagesHtml = $this->getTestImages($vf_id,$sectionImageFrom="VF",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($vf_id!=""){
							$arrPDFs = $this->getAllTestPdf($vf_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo("<tr><td colspan='2'><table >
									".$imagesHtml."
								</table></td></tr>");
						}

						$imagesHtml="";
						//End VF Images
						$comments = '';
						if($phyName){
							/*$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '$phyName'");
							$getNameRow = imw_fetch_assoc($getNameQry);
							$phyName = str_replace(", ,"," ",$getNameRow['phyName']);*/
							$phyName = $this->print_phyInitial($phyName);
							?>

			<tr>
				<td colspan="2" ><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
			</tr>

							<?php
						}
						?>
						<tr><td></td><td></td></tr>

	</table>
			<?php
		}//End of while
	  }/* else{ ?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">VF</td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>
		<?php
		} */
	}

	public function print_vf_gl_fun($patient_id,$form_id,$req){
		if(is_array($req) && count($req)>0){
			$sqlVFFormQry = imw_query("SELECT * FROM vf_gl WHERE patientId = '".$patient_id."' AND vf_gl_id in (".implode(",",$req).")");
		}else if($form_id!=""){
			$sqlVFFormQry = imw_query("SELECT * FROM vf_gl WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ");
		}


		if(imw_num_rows($sqlVFFormQry)>0){
			while($sqlVFFormRow = imw_fetch_assoc($sqlVFFormQry)){
			extract($sqlVFFormRow);
			if($performedBy){
				$namePerformer = $this->print_phyInitial($performedBy);
			}

				$orderByName="";
				if($ordrby){
				$orderByName = $this->print_phyInitial($ordrby);
				}
				if($orderByName){
					$orderByName = "<span class=\"text_lable\">Order By:&nbsp;</span>".$orderByName;
					if($ordrdt && $ordrdt!="0000-00-00") {$orderByName .= "&nbsp;&nbsp;".get_date_format($ordrdt);}
				}
			?>

					<table style="width:750px;"  cellpadding="0" cellspacing="0">
						<tr>
							<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
						</tr>
						<tr>
							<td colspan="3" height="2"></td>
						</tr>
						<tr>
							<td colspan="3" class="bluehed text_cap paddingTop10">VF-GL (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)&nbsp;<?php echo $orderByName;?></td>
						</tr>

						<tr>
							<td colspan="3" style="width:700px;" class="paddingTop10">
							<b>VF-GL:</b>&nbsp;<?php echo($vf_gl_eye."&nbsp;".$elem_gla_mac."&nbsp;".$gla_mac_os); ?>
							</td>
						</tr>

						<?php if($namePerformer || $ptUnderstanding || $diagnosis ){ ?>

						<?php if($techComments!=""){ ?>
						<tr>
							<td colspan="3" style="width:700px;" class="paddingTop10">
								<b>Technician Comments:</b>&nbsp;<?php echo($techComments);?>
							</td>
						</tr>
						<?php } ?>
						<tr>
							<td colspan="3" style="width:700px;" class="paddingTop10">
								<b>Performed By:</b>&nbsp;<?php echo $namePerformer; ?>
								&nbsp;&nbsp;
								<b>Patient Understanding & Cooperation:</b>&nbsp;<?php echo $ptUnderstanding; ?>
							 </td>
						</tr>

				<?php
				if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
				if($diagnosis_os=="Other"&&!empty($diagnosisOther_os)){$diagnosis_os=$diagnosisOther_os;}
				?>

						<tr>
							<td colspan="3" style="width:700px;" class="paddingTop10">
								<b>Diagnosis:</b>&nbsp;<?php echo ($diagnosis!="--Select--") ? "OD: ".$diagnosis : "";
								 echo ($diagnosis_os!="--Select--") ? "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OS: ".$diagnosis_os : "";
								 ?>
							</td>
						</tr>
						<tr>
							<td colspan="3" style="width:700px;font-weight:bold;" class="paddingTop10">Physician Interpretation</td>
						</tr>


						<?php
						if($descOd || $descOs){ ?>
						<tr>
							<td colspan="3" style="width:700px;font-weight:bold;" class="paddingTop10">Test Results</td>
						</tr>
						<tr>
							<td style="width:100px" class="paddingTop10 tb_subheading">&nbsp;</td>
							<td style="width:300px;font-weight:bold;" class="paddingTop10 tb_subheading bdrright">OD</td>
							<td style="width:300px;font-weight:bold;" class="paddingTop10 tb_subheading">OS</td>
						</tr>
						<?php if($reliabilityOd || $reliabilityOs){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Reliability:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $reliabilityOd; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $reliabilityOs; ?></td>
						</tr>
						<?php } ?>
						<?php if($mdOd || $psdOd || $vfiOd || $mdOs || $psdOs || $vfiOs){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo $mdOdVal=($mdOd)?"MD ".$mdOd." dB":"";
								  echo $psdOdVal=($psdOd)?"&nbsp;&nbsp;PSD ".$psdOd." dB":"";
								  echo $vfiOdVal=($vfiOd)?"&nbsp;&nbsp;VFI ".$psdOd." %":"";
							?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo $mdOsVal=($mdOs)?"MD ".$mdOs." dB":"";
								  echo $psdOsVal=($psdOs)?"&nbsp;&nbsp;PSD ".$psdOs." dB":"";
								  echo $vfiOsVal=($vfiOs)?"&nbsp;&nbsp;VFI ".$psdOs."%":"";
							?>
							</td>
						</tr>
						<?php }
						if($details_high_od || $details_high_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Details:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $details_high_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $details_high_os; ?></td>
						</tr>
						<?php }
						if($poor_study_od || $poor_study_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Poor Study:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $poor_study_od." ".$poor_study_od_desc; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $poor_study_os." ".$poor_study_os_desc; ?></td>
						</tr>
						<?php }

						if($intratest_fluctuation_od || $intratest_fluctuation_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $intratest_fluctuation_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $intratest_fluctuation_os; ?></td>
						</tr>
						<?php }
						if($artifact_od || $artifact_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $artifact_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $artifact_os; ?></td>
						</tr>
						<?php }
						if($details_lids_od || $details_lids_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Details:&nbsp;</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $details_lids_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $details_lids_os; ?></td>
						</tr>
						<?php }
						if($normal_os || $normal_od){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $normal_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $normal_os; ?></td>
						</tr>
						<?php }
						if($nonspecific_od || $nonspecific_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $nonspecific_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $nonspecific_os; ?></td>
						</tr>
						<?php }
						if($nasal_step_od || $nasal_step_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Nasal Step:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $nasal_step_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $nasal_step_os; ?></td>
						</tr>
						<?php }
						if($arcuate_od || $arcuate_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Arcuate:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $arcuate_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $arcuate_os; ?></td>
						</tr>
						<?php }
						if($hemifield_od || $hemifield_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Hemifield:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $hemifield_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $hemifield_os; ?></td>
						</tr>
						<?php }
						if($paracentral_od || $paracentral_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Paracentral:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $paracentral_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $paracentral_os; ?></td>
						</tr>
						<?php }
						if($into_fixation_od || $into_fixation_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Into Fixation:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $into_fixation_od; ?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $into_fixation_os; ?></td>
						</tr>
						<?php }
						if($central_island_od || $central_island_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Central Island:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $central_island_od_val=($central_island_od)?"Remaining ".$central_island_od." degrees":""; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $central_island_os_val=($central_island_os)?"Remaining ".$central_island_os." degrees":""; ?>

							</td>
						</tr>
						<?php }
						if($enlarged_blind_spot_od || $enlarged_blind_spot_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $enlarged_blind_spot_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $enlarged_blind_spot_os; ?>
							</td>
						</tr>
						<?php }
						if($cecocentral_scotone_od || $cecocentral_scotone_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $cecocentral_scotone_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $cecocentral_scotone_os; ?>
							</td>
						</tr>
						<?php }
						if($central_scotoma_od || $central_scotoma_os){ ?>

						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">&nbsp;</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $central_scotoma_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $central_scotoma_os; ?>
							</td>
						</tr>
						<?php }
						if($hemianopsia_od || $hemianopsia_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Hemianopsis:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $hemianopsia_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $hemianopsia_os; ?>
							</td>
						</tr>
						<?php }
						if($quadrantanopsia_od || $quadrantanopsia_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Quadranopsia:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $quadrantanopsia_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $quadrantanopsia_os; ?>
							</td>
						</tr>
						<?php }
						if($homonomous_od || $homonomous_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Congruity:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $homonomous_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $homonomous_os; ?>
							</td>
						</tr>
						<?php }
						if($synthesis_od || $synthesis_os){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Synthesis:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $synthesis_od; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $synthesis_os; ?>
							</td>
						</tr>
						<?php }
						if($interpretation_OD || $interpretation_OS){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Interpretation:</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $interpretation_OD; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $interpretation_OS; ?>
							</td>
						</tr>
						<?php }
						if($comments_interp){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Comments:</td>
							<td colspan="2" style="width:600px;" class="paddingTop10">
								<?php echo $comments_interp; ?>
							</td>
						</tr>
						<?php }
						if($glaucoma_stage_opt_OD || $glaucoma_stage_opt_OS){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Glaucoma&nbsp;Stage:</td>
							 <td style="width:300px;" class="paddingTop10">
								<?php echo $glaucoma_stage_opt_OD; ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
								<?php echo $glaucoma_stage_opt_OS; ?>
							</td>
						</tr>
						<?php }
						if($plan){ ?>
						<tr>
							<td style="width:100px; font-weight:bold;" class="paddingTop10">Plan:</td>
							 <td colspan="2" style="width:600px;" class="paddingTop10">
								<?php
							$arr_find=array("Pt informed of results by physician today","to be called by technician","by letter","will inform next visit","Continue meds","Monitor findings","Repeat test time");
							$arr_rep=array("Pt informed of results by physician today, ","to be called by technician, ","by letter, ","will inform next visit, ","Continue meds, ","Monitor findings, ","Repeat test time: ".$repeatTestVal1." ".$repeatTestVal2." ".$repeatTestEye);
							echo str_replace($arr_find,$arr_rep,$plan); ?>
							</td>
						</tr>
						<?php }

						}
						}
						if($comments!=""){ ?>
						<tr>
							<td colspan="3" style="width:700px;" class="paddingTop10" ><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
						</tr>
						<?php
						}
						///Add VF Images//
						$imagesHtml=$this->getTestImages($vf_gl_id,$sectionImageFrom="VF-GL",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($vf_gl_id!=""){
							$arrPDFs = $this->getAllTestPdf($vf_gl_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo("<tr><td colspan='3' class='paddingTop10'><table >
									".$imagesHtml."
								</table></td></tr>");
						}
						$imagesHtml="";
						//End VF Images
						$comments = '';
						if($phyName){
							$phyName = $this->print_phyInitial($phyName);
							?>

						<tr>
							<td colspan="3" ><b>Interpreted By:</b>&nbsp;<?php echo $phyName; ?></td>
						</tr>

							<?php
						}
						?>
						<tr>
							<td style="width:100px;"></td>
							<td style="width:300px;">&nbsp;</td>
							<td style="width:300px;">&nbsp;</td>
						</tr>
				</table>
			<?php
		}//End of while
	  }
	}

	public function print_hrt($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM nfa WHERE patient_id = '".$patient_id."' AND nfa_id in(".implode(",",$req).")";
		}else if($form_id!=""){
			$sql = "SELECT * FROM nfa WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}

		$rowResTemp = imw_query($sql);
		if($rowResTemp){
			while($row=imw_fetch_array($rowResTemp)){
			extract($row);
			?>

					<table style="width:750px;"  cellpadding="0" cellspacing="0">
						<tr>
							<td colspan="2" style="width:750px;" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
						</tr>
						<tr>
							<td colspan="2" height="2"></td>
						</tr>
						<tr>
							<td colspan="2" style="width:750px;" class="bluehed text_cap paddingTop10">HRT (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
						</tr>

						<?php
						if($scanLaserEye){
							if($scanLaserEye == 'OU') $scanLaserEye = '<span style="color:purple;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OD') $scanLaserEye = '<span style="color:blue;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OS') $scanLaserEye = '<span style="color:green;">'.$scanLaserEye.'</span>';
							?>

							<tr>
								<td colspan="2" style="width:740px;" class="text_lable paddingTop10">Scanning Laser/NFA:&nbsp; <?php echo $scanLaserEye; ?></td>
							</tr>

							<?php
						}
						if($performedBy || $ptUndersatnding){
							/*$performedByQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as performedBy FROM users WHERE id = '$performedBy'");
							$performedByRow = imw_fetch_assoc($performedByQry);
							$performedBy = str_replace(", ,"," ",$performedByRow['performedBy']);*/
							$performedBy = $this->print_phyInitial($performedBy);
							?>

						<?php if($techComments!=""){?>
							<tr>
								<td class="text_lable paddingTop10" style="width:740px;" colspan="2">Technician Comments:&nbsp;<span class="text_value"><?php echo($techComments);?></span> </td>
							</tr>
						<?php }?>
							<tr>

								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Performed By:&nbsp;</span> <?php echo $performedBy; ?></td>
								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;<?php echo $ptUndersatnding; ?></td>
							</tr>

							<?php
						}

						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if($diagnosis && $diagnosis!="--Select--"){
							?>

							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
							</tr>

						<?php
						}
						if($reliabilityOd || $reliabilityOs){
						?>
						<tr>
							<td colspan="2" style="width:740px;">
								<table style="width:740px;" cellpadding="0" cellspacing="0">
									<tr>
										<td class="text_lable paddingTop10"  style="width:180px;">Physician Interpretation:&nbsp;</td>
										<td class="text_lable paddingTop10"  style="width:80px;">Reliability</td>
										<td class="text_lable paddingTop10"  style="width:30px;"><?php $this->odLable();?></td>
										<td class="paddingTop10" style="width:100px;" ><?php echo $reliabilityOd; ?></td>
										<td class="text_lable paddingTop10" style="width:30px;" ><?php $this->osLable();?></td>
										<td class="paddingTop10" style="width:250px;" ><?php echo $reliabilityOs; ?></td>
									</tr>
								</table>
							</td>
						</tr>
						<?php
						}
						$odData = '';
						$osData = '';

						// OD DATA
						if($Normal_OD_T) $odData = 'Normal&nbsp;<br>';
						if($Normal_OD_PoorStudy == 1) $odData .= 'Poor Study&nbsp;<br>';
						if($BorderLineDefect_OD_T == 1 || $BorderLineDefect_OD_1 == 1 || $BorderLineDefect_OD_2 == 1 || $BorderLineDefect_OD_3 == 1 || $BorderLineDefect_OD_4 == 1){
							$odData.= 'Border Line Defect';
							$odData.= '&nbsp;';
							if($BorderLineDefect_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($BorderLineDefect_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($BorderLineDefect_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($BorderLineDefect_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($BorderLineDefect_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Abnorma_OD_T == 1 || $Abnorma_OD_1 == 1 || $Abnorma_OD_2 == 1 || $Abnorma_OD_3 == 1 || $Abnorma_OD_4 == 1){
							$odData.= '<br>Abnormal';
							$odData.= '&nbsp;';
							if($Abnorma_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Abnorma_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Abnorma_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Abnorma_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Abnorma_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}

						if(!empty($decreaseOd)){
							$odData.= '<br>Decreased<br/>';
							//$odData.= '&nbsp;';
							$odData.=str_replace(",","<br/>",$decreaseOd);
						}

						if(!empty($thinOd)){
							$odData.= '<br>Thin';
							$odData.= '&nbsp;'.$thinOd;
						}

						if(!empty($totalThinOd)){
							$odData.= '<br>Total Thin';
							$odData.= '&nbsp;'.$totalThinOd;
						}

						if($NoSigChange_OD == 1||$Improved_OD == 1||$IncAbn_OD == 1){
							$odData.= '<br/>';
							if($NoSigChange_OD == 1) $odData.= 'No Sig. Change&nbsp;';
							if($Improved_OD == 1) $odData.= 'Improved&nbsp;';
							if($IncAbn_OD == 1) $odData.= 'Inc. Abn&nbsp;';
						}

						if($iopTrgtOd){
							$odData.= '<br>IOP Target';
							$odData.= '&nbsp;'.$iopTrgtOd;
						}

						// OS DATA
						if($Normal_OS_T) $osData = 'Normal&nbsp;<br>';
						if($Normal_OS_PoorStudy == 1) $osData .= 'Poor Study&nbsp;<br>';

						if($BorderLineDefect_OS_T == 1 || $BorderLineDefect_OS_1 == 1 || $BorderLineDefect_OS_2 == 1 || $BorderLineDefect_OS_3 == 1 || $BorderLineDefect_OS_4 == 1 || $NoSigChange_OD == 1 || $Improved_OD == 1 || $IncAbn_OD == 1){
							$osData.= 'Border Line Defect';
							$osData.= '&nbsp;';
							if($BorderLineDefect_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($BorderLineDefect_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($BorderLineDefect_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($BorderLineDefect_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($BorderLineDefect_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Abnorma_OS_T == 1 || $Abnorma_OS_1 == 1 || $Abnorma_OS_2 == 1 || $Abnorma_OS_3 == 1 || $Abnorma_OS_4 == 1 || $NoSigChange_OS == 1 || $Improved_OS == 1 || $IncAbn_OS == 1){
							$osData.= '<br>Abnormal';
							$osData.= '&nbsp;';
							if($Abnorma_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Abnorma_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Abnorma_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Abnorma_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Abnorma_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}

						if(!empty($decreaseOs)){
							$osData.= '<br/>Decreased<br/>';
							//$osData.= '&nbsp;';
							$osData.=str_replace(",","<br/>",$decreaseOs);
						}

						if(!empty($thinOs)){
							$osData.= '<br>Thin';
							$osData.= '&nbsp;'.$thinOs;
						}

						if(!empty($totalThinOs)){
							$osData.= '<br>Total Thin';
							$osData.= '&nbsp;'.$totalThinOs;
						}

						if($NoSigChange_OS == 1||$Improved_OS == 1||$IncAbn_OS == 1){
							$osData.= '<br/>';
							if($NoSigChange_OS == 1) $osData.= 'No Sig. Change&nbsp;';
							if($Improved_OS == 1) $osData.= 'Improved&nbsp;';
							if($IncAbn_OS == 1	) $osData.= 'Inc. Abn&nbsp;';
						}

						if($iopTrgtOs){
							$osData.= '<br>IOP Target';
							$osData.= '&nbsp;'.$iopTrgtOs;
						}

					if($osData!="" || $odData!="" || $Others_OD!="" || $Others_OS!=""){
							?>
							<tr>
								<td style="width:700px;" class="paddingTop10 tb_subheading" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:380px;" class="paddingTop10"><?php $this->odLable();?></td>
								<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:380px;" class="paddingTop10" ><?php echo  $odData; ?></td>
								<td style="width:350px;" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						if($Others_OD!="" || $Others_OS!=""){
							?>
								<tr>
									<td style="width:380px;" class="paddingTop10"><?php echo $Others_OD; ?></td>
									<td style="width:350px;" class="paddingTop10"><?php echo $Others_OS; ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}
					if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
						if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
						if($ptInformed == 1) $treatment.= 'Pt informed of results &nbsp;';
						if($monitorIOP == 1) $treatment.= 'monitor IOP &nbsp;';
						if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.';

						if($stable == 1 || $fuApa == 1 || $ptInformed == 1 || $monitorIOP == 1 || $tech2InformPt == 1){
							?>

								<tr>
									<td style="width:700px;" class="paddingTop10" colspan="2"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>

							<?php
						}
					if($comments){
						?>

							<tr>
								<td style="width:700px;" class="paddingTop10" colspan="2"><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
							</tr>
							<?php
						}///Add OCT Images//
						$imagesHtml = $this->getTestImages($nfa_id,$sectionImageFrom="NFA",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($nfa_id!=""){
							$arrPDFs = $this->getAllTestPdf($nfa_id);
							$str_alternative_images = $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px; text-align:center;" class="paddingTop10"><table style="width:700px;text-align:center;" cellspacing="0" cellpadding="0">
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End NFA Images
						if($phyName){
							/*$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '$phyName'");
							$getNameRow = imw_fetch_assoc($getNameQry);
							$phyName = str_replace(", ,"," ",$getNameRow['phyName']);*/
							$phyName = $this->print_phyInitial($phyName);
							?>
							<tr>
								<td style="width:700px;" class="paddingTop10" colspan="2"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
							</tr>
							<?php
						}
						?>
					</table>
			<?php
		}
		}/* else{ ?>
			<table style="width:740px;"  cellpadding="0" cellspacing="0">
						<tr>
							<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
						</tr>
						<tr>
							<td height="2"></td>
						</tr>
						<tr>
							<td class="bluehed text_cap paddingTop10">HRT</td>
						</tr>
						<tr>
							<td>No Data</td>
						</tr>
				   </table>
			<?php
		} */
	}

	public function print_oct($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM oct WHERE patient_id = '".$patient_id."' AND oct_id in(".implode(",",$req).") ";
		}else if($form_id!=""){
			$sql = "SELECT * FROM oct WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}
		$rowOct = imw_query($sql);
		if($rowOct){
		while($row=imw_fetch_array($rowOct)){
			extract($row);
		?>
						<table style="width:750px;"  cellpadding="0" cellspacing="0" >
							<tr>
								<td colspan="2" style="width:750px;" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
							</tr>
							<tr>
								<td height="2"></td>
							</tr>
							<tr>
								<td colspan="2" style="width:750px;" class="bluehed text_cap paddingTop10">OCT:&nbsp; (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
							</tr>
		<?php
						if($scanLaserEye){
							if($scanLaserEye == 'OU') $scanLaserEye = '<span style="color:purple;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OD') $scanLaserEye = '<span style="color:blue;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OS') $scanLaserEye = '<span style="color:green;">'.$scanLaserEye.'</span>';

							if($scanLaserOct=="3"){
								$scanLaserOct = "Anterior Segment";
							}else if($scanLaserOct=="2"){
								$scanLaserOct = "Retina";
							}else if($scanLaserOct=="1"){
								$scanLaserOct = "Optic Nerve";
							}

							?>

						<tr>
							<td colspan="2" style="width:700px;" class="paddingTop10" >
							<b>OCT</b>&nbsp;<?php echo($scanLaserOct." ".$scanLaserEye); ?>
							</td>
						</tr>

							<?php
						}
						if($performBy || $ptUndersatnding){

							$performedBy = $this->print_phyInitial($performBy);
							?>

							<?php if($techComments!=""){
							?>
							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><b>Technician Comments:</b>&nbsp;<?php echo($techComments); ?></td>
							</tr>
							<?php }?>
							<tr>
								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Performed By:&nbsp;</span> <?php echo $performedBy; ?></td>
								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp; <?php echo $ptUndersatnding; ?></td>
							</tr>

							<?php
						}
						if($diagnosis && $diagnosis!="--Select--"){if(trim(strtolower($diagnosis))=="other"){ $diagnosis=$diagnosisOther;}
							?>

							<tr>
								<td colspan="2" style="width:750px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
							</tr>

							<?php
						}
						if($reliabilityOd || $reliabilityOs){
							?>

					<tr>
						<td colspan="2" style="width:700px;">
						<table style="width:700px;" cellpadding="0" cellspacing="0">
							<tr>
								<td style="width:180px;" class="text_lable paddingTop10">Physician Interpretation:&nbsp;</td>
								<td style="width:80px;" class="text_lable paddingTop10">Reliability</td>
								<td style="width:50px;" class="text_lable paddingTop10"><?php $this->odLable();?></td>
								<td style="width:150px;" class="text_value paddingTop10"><?php echo $reliabilityOd; ?></td>
								<td style="width:50px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
								<td style="width:200px;" class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
							</tr>
						</table>
						</td>
					   </tr>
							<?php
						}
						$odData = '';
						$osData = '';

						// OD DATA
						if($Normal_OD_T) $odData = 'Normal&nbsp;<br>';
						if($Normal_OD_PoorStudy == 1) $odData .= 'Poor Study&nbsp;<br>';
						if($BorderLineDefect_OD_T == 1 || $BorderLineDefect_OD_1 == 1 || $BorderLineDefect_OD_2 == 1 || $BorderLineDefect_OD_3 == 1 || $BorderLineDefect_OD_4 == 1){
							$odData.= 'Border Line Defect';
							$odData.= '&nbsp;';
							if($BorderLineDefect_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($BorderLineDefect_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($BorderLineDefect_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($BorderLineDefect_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($BorderLineDefect_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Abnorma_OD_T == 1 || $Abnorma_OD_1 == 1 || $Abnorma_OD_2 == 1 || $Abnorma_OD_3 == 1 || $Abnorma_OD_4 == 1){
							$odData.= '<br>Abnormal';
							$odData.= '&nbsp;';
							if($Abnorma_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Abnorma_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Abnorma_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Abnorma_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Abnorma_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
							if($NoSigChange_OD == 1) $odData.= '<br/>No Sig. Change&nbsp;';
							if($Improved_OD == 1) $odData.= 'Improved&nbsp;';
							if($IncAbn_OD == 1) $odData.= 'Inc. Abn&nbsp;';

						}

						// OS DATA
						if($Normal_OS_T) $osData = 'Normal&nbsp;<br>';
						if($Normal_OS_PoorStudy == 1) $osData .= 'Poor Study&nbsp;<br>';

						if($BorderLineDefect_OS_T == 1 || $BorderLineDefect_OS_1 == 1 || $BorderLineDefect_OS_2 == 1 || $BorderLineDefect_OS_3 == 1 || $BorderLineDefect_OS_4 == 1 || $NoSigChange_OD == 1 || $Improved_OD == 1 || $IncAbn_OD == 1){
							$osData.= 'Border Line Defect';
							$osData.= '&nbsp;';
							if($BorderLineDefect_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($BorderLineDefect_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($BorderLineDefect_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($BorderLineDefect_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($BorderLineDefect_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Abnorma_OS_T == 1 || $Abnorma_OS_1 == 1 || $Abnorma_OS_2 == 1 || $Abnorma_OS_3 == 1 || $Abnorma_OS_4 == 1 || $NoSigChange_OS == 1 || $Improved_OS == 1 || $IncAbn_OS == 1){
							$osData.= '<br>Abnormal';
							$osData.= '&nbsp;';
							if($Abnorma_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Abnorma_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Abnorma_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Abnorma_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Abnorma_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
							if($NoSigChange_OS == 1) $osData.= '<br/>No Sig. Change&nbsp;';
							if($Improved_OS == 1) $osData.= 'Improved&nbsp;';
							if($IncAbn_OS == 1) $osData.= 'Inc. Abn&nbsp;';
						}
					if($osData!="" || $odData!="" || $Others_OD!="" || $Others_OS!="" || $fovea_thick_OD!="" || $fovea_thick_OS!="" || $test_res_od!="" || $test_res_os!="" || $avg_nfl_Thick_OD!="" || $avg_nfl_Thick_OS!="") {
							?>

							<tr>
								<td class="tb_subheading paddingTop10" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:350px;" class="paddingTop10"><?php $this->odLable();?></td>
								<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:350px;" class="paddingTop10"><?php echo  $odData; ?></td>
								<td style="width:350px;" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						?>
						<?php
						if($test_res_od!="" || $test_res_os!="" ){
							?>
								<tr>
									<td style="width:350px;" class="paddingTop10"><?php echo $test_res_od; ?></td>
									<td style="width:350px;" class="paddingTop10"><?php echo $test_res_os; ?></td>
								</tr>

							<?php
						}
						?>

						<?php
						if($fovea_thick_OD!="" || $fovea_thick_OS!="" ){
							?>
								<tr>
								<td style="width:350px;" class="paddingTop10"><?php echo "Foveal Thickness &nbsp;".$fovea_thick_OD; ?></td>
								<td style="width:350px;" class="paddingTop10"><?php echo "Foveal Thickness &nbsp;".$fovea_thick_OS; ?></td>
								</tr>
							<?php
						}

						if($avg_nfl_Thick_OD!="" || $avg_nfl_Thick_OS!="" ){
							?>
								<tr>
									<td style="width:350px;" class="paddingTop10"><?php echo "AVG NFL Thickness&nbsp;".$avg_nfl_Thick_OD; ?></td>
									<td style="width:350px;" class="paddingTop10"><?php echo "AVG NFL Thickness&nbsp;".$avg_nfl_Thick_OS; ?></td>
								</tr>

							<?php
						}

							if($iopTrgtOd !="" || $iopTrgtOs !="" ){
							?>
								<tr>
									<td style="width:350px;" class="paddingTop10"><?php echo "IOP Comments&nbsp;".$iopTrgtOd; ?></td>
									<td style="width:350px;" class="paddingTop10"><?php echo "IOP Comments&nbsp;".$iopTrgtOs; ?></td>
								</tr>
							<?php
						}
						?>

						<?php
						if($Others_OD!="" || $Others_OS!=""){
							?>
								<tr>
									<td style="width:350px;" class="paddingTop10"><?php echo $Others_OD; ?></td>
									<td style="width:350px;" class="paddingTop10"><?php echo $Others_OS; ?></td>
								</tr>
							<?php
						}
						?>


							<?php
						}

						if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
						if($contiMeds == 1) $treatment.= '&nbsp;Continue Meds &nbsp;';
						if($monitorIOP == 1) $treatment.= 'Monitor IOP &nbsp;';
						if($mon_finding == 1) $treatment.= 'Monitor findings &nbsp;';
						if($fuApa == 1) $treatment.= 'F/U APA&nbsp;';
						if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
						if($ptInformed == 1) $treatment.= ' Pt informed of results &nbsp;';
						if($ptInformedNv==1)$treatment.= '&nbsp;Informed Pt. result next visit.&nbsp;';

						if($stable == 1 || $fuApa == 1 || $ptInformed == 1 || $monitorIOP == 1 || $mon_finding == 1 || $tech2InformPt == 1){
							?>

								<tr>
									<td colspan="2" style="width:700px;" class="paddingTop10"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>

							<?php
						}
						if($comments){
							?>

								<tr>
									<td colspan="2" style="width:700px;" class="paddingTop10"><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
								</tr>

							<?php
						}
						?>

						<?php
						///Add OCT Images//
						$imagesHtml=$this->getTestImages($oct_id,$sectionImageFrom="OCT",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($oct_id!=""){
							$arrPDFs = $this->getAllTestPdf($oct_id);
							$str_alternative_images = $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End OCT Images

						if($phyName){
							/*$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '$phyName'");
							$getNameRow = imw_fetch_assoc($getNameQry);
							$phyName = str_replace(", ,"," ",$getNameRow['phyName']);*/
							$phyName = $this->print_phyInitial($phyName);
							?>

								<tr>
									<td colspan="2"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
								</tr>

							<?php
						}
						?>
					</table>
			<?php
		}//End oct While
	 }/* else{ ?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">OCT</td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>
		<?php
		} */
	}

	public function print_oct_rnfl($patient_id,$form_id,$req){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM oct_rnfl WHERE patient_id = '".$patient_id."' AND oct_rnfl_id  in(".implode(",",$req).") ";
		}else if($form_id!=""){
			$sql = "SELECT * FROM oct_rnfl WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}
		$rowOct = imw_query($sql);
		if($rowOct){
	while($row=imw_fetch_array($rowOct)){
			extract($row);
		?>
						<table style="width:750px;"  cellpadding="0" cellspacing="0" >
							<tr>
								<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
							</tr>
							<tr>
								<td height="2"></td>
							</tr>
							<tr>
								<td colspan="3" style="width:750px;" class="bluehed text_cap paddingTop10">OCT-RNFL:&nbsp; (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
							</tr>
		<?php
						if($scanLaserEye){
							if($scanLaserEye == 'OU') $scanLaserEye = '<span style="color:purple;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OD') $scanLaserEye = '<span style="color:blue;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OS') $scanLaserEye = '<span style="color:green;">'.$scanLaserEye.'</span>';

							if($scanLaserOct_rnfl=="3"){
								$scanLaserOct_rnfl = "Anterior Segment";
							}else if($scanLaserOct_rnfl =="2"){
								$scanLaserOct_rnfl = "Retina";
							}else if($scanLaserOct_rnfl =="1"){
								$scanLaserOct_rnfl = "Optic Nerve";
							}

							?>

						<tr>
							<td colspan="2" style="width:400px;" class="paddingTop10" >
							<b>OCT - Optic Nerve / RNFL</b>&nbsp;<?php echo($scanLaserEye); ?>
							</td>
							<td style="width:300px;" class="paddingTop10" >
							Dilated&nbsp;<?php echo $dilated; ?>
							</td>
						</tr>

							<?php
						}
						if($performBy || $ptUndersatnding){
							$performedBy = $this->print_phyInitial($performBy);
							?>

							<?php if($techComments!=""){
							?>
							<tr>
								<td colspan="3" style="width:700px;" class="paddingTop10"><b>Technician Comments:</b>&nbsp;<?php echo($techComments); ?></td>
							</tr>
							<?php }?>
							<tr>
								<td colspan="2" style="width:400px;" class="paddingTop10"><span class="text_lable">Performed By:&nbsp;</span> <?php echo $performedBy; ?></td>
								<td style="width:300px;" class="paddingTop10"><span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp; <?php echo $ptUndersatnding; ?></td>
							</tr>

							<?php
						}

						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if($diagnosis_os=="Other"&&!empty($diagnosisOther_os)){$diagnosis_os=$diagnosisOther_os;}

						if(($diagnosis && $diagnosis!="--Select--") ||($diagnosis_os && $diagnosis_os!="--Select--")){
							?>

							<tr>

							   <?php
								if($diagnosis && $diagnosis!="--Select--"){ ?>
								<td colspan="2" style="width:400px;" class="paddingTop10">
									<b>Diagnosis OD:</b>&nbsp;<?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?>
								</td>
								<?php
								}
								if($diagnosis_os && $diagnosis_os!="--Select--"){ ?>
								<td style="width:300px;" class="paddingTop10">
									<b>Diagnosis OS:</b>&nbsp;
								 <?php echo $diagnosis_os; ?>
								</td>
								<?php	} ?>
							</tr>
						<?php } ?>

						<tr><td colspan="3" style="width:700px;font-weight:bold;" class="paddingTop10">Physician Interpretation</td></tr>
						<tr><td colspan="3" style="width:700px;font-weight:bold;" class="paddingTop10">Test Results</td></tr>

						<tr>
							<td style="width:100px;" class="paddingTop10 tb_subheading">&nbsp;</td>
							<td style="width:300px;font-size:14px;font-weight:bold;" class="paddingTop10 tb_subheading bdrright">&nbsp;OD</td>
							<td style="width:300px;font-size:14px;font-weight:bold;" class="paddingTop10 tb_subheading">&nbsp;OS</td>
						</tr>
						<?php
						if($reliabilityOd || $reliabilityOs){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Reliability:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $reliabilityOd;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $reliabilityOs;?></td>
						</tr>
						<?php
						}
						if($signal_strength_od || $signal_strength_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Signal&nbsp;Strength:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $signal_strength_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $signal_strength_od;?></td>
						</tr>
						<?php
						}
						if($quality_od || $quality_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Quality:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $quality_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $quality_os;?></td>
						</tr>
						<?php
						}
						if($details_od || $details_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Details:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo str_ireplace("!","",$details_od);?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo str_ireplace("!","",$details_od);?></td>
						</tr>
						<?php
						}
						if($disc_area_od || $disc_area_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Disc area:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_area_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_area_os;?></td>
						</tr>
						<?php
						}
						if($disc_size_od || $disc_size_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Disc size:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_size_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_size_os;?></td>
						</tr>
						<?php
						}
						if($verti_cd_od || $verti_cd_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Vertical C:D:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $verti_cd_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $verti_cd_os;?></td>
						</tr>
						<?php
						}
						if($disc_edema_od || $disc_edema_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Disc edema:</td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_edema_od;?></td>
							<td style="width:300px;" class="paddingTop10"><?php echo $disc_edema_os;?></td>
						</tr>
						<?php
						}
						if($rnfl_od || $rnfl_od){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">RNFL:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($rnfl_od_val=($rnfl_od)?"Avg&nbsp;".$rnfl_od:"&nbsp;"); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($rnfl_od_val=($rnfl_os)?"Avg&nbsp;".$rnfl_os:"&nbsp;"); ?>
							</td>
						</tr>
						<?php
						}

						if($contour_overall_od || $contour_overall_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Overall:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_overall_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_overall_os); ?>
							</td>
						</tr>
						<?php
						}
						if($contour_superior_od || $contour_superior_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Superior:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_superior_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_overall_os); ?>
							</td>
						</tr>
						<?php
						}
						if($contour_inferior_od  || $contour_inferior_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Inferior:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_inferior_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_inferior_os); ?>
							</td>
						</tr>
						<?php
						}
						if($contour_temporal_od  || $contour_temporal_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Temporal:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_temporal_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_temporal_os); ?>
							</td>
						</tr>
						<?php
						}
						if($contour_nasal_od  || $contour_nasal_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Nasal:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_nasal_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_nasal_os); ?>
							</td>
						</tr>
						<?php
						}
						if($contour_gcc_od  || $contour_gcc_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">GCC:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_gcc_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($contour_gcc_os); ?>
							</td>
						</tr>
						<?php
						}
						if($symmetric_od  || $symmetric_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Symmetric:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($symmetric_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($symmetric_os); ?>
							</td>
						</tr>
						<?php
						}
						if($gpa_od  || $gpa_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">GPA:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($gpa_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($gpa_os); ?>
							</td>
						</tr>
						<?php
						}
						if($synthesis_od  || $synthesis_os){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Synthesis:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($synthesis_od); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($synthesis_os); ?>
							</td>
						</tr>
						<?php
						}
						if($interpretation_OD  || $interpretation_OS){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Interpretation:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($interpretation_OD); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($interpretation_OS); ?>
							</td>
						</tr>
						<?php
						}
						if($glaucoma_stage_opt_OD  || $glaucoma_stage_opt_OS){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Glaucoma&nbsp;Stage:</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($glaucoma_stage_opt_OD); ?>
							</td>
							<td style="width:300px;" class="paddingTop10">
							<?php echo ($glaucoma_stage_opt_OS); ?>
							</td>
						</tr>
						<?php
						}
						if($plan){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Plan:</td>
							<td colspan="2" style="width:600px;" class="paddingTop10">
							<?php
							$arr_find=array("Pt informed of results by physician today","to be called by technician","by letter","will inform next visit","Continue meds");
							$arr_rep=array("Pt informed of results by physician today, ","to be called by technician, ","by letter, ","will inform next visit, ","Continue meds, ");
							echo str_replace($arr_find,$arr_rep,$plan); ?>
							</td>
						</tr>
						<?php
						}
						if($comments){
						?>
						<tr>
							<td style="width:100px;font-weight:bold;" class="paddingTop10">Comments:</td>
							<td colspan="2" style="width:600px;" class="paddingTop10">
							<?php echo ($comments); ?>
							</td>
						</tr>
						<?php
						}

						///Add OCT Images//
						$imagesHtml=$this->getTestImages($oct_rnfl_id,$sectionImageFrom="OCT-RNFL",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($oct_rnfl_id!=""){
							$arrPDFs = $this->getAllTestPdf($oct_rnfl_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="3"  class="paddingTop10"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						?>

						<?php
						if($phyName){
							$phyName = $this->print_phyInitial($phyName);
							?>

								<tr>
									<td colspan="3"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
								</tr>

							<?php
						}
						?>
					</table>
			<?php
		}//End oct While
		}
	}

	public function print_gdx($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM test_gdx WHERE patient_id = '".$patient_id."' AND gdx_id in(".implode(",",$req).") ";
		}else if($form_id!=""){
			$sql = "SELECT * FROM test_gdx WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}
		$rowOct = imw_query($sql);
		if($rowOct){
	while($row=imw_fetch_array($rowOct)){
			extract($row);
			?>
			<table style="width:750px;"  cellpadding="0" cellspacing="0">
			<?php

						if($scanLaserEye){
							if($scanLaserEye == 'OU') $scanLaserEye = '<span style="color:purple;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OD') $scanLaserEye = '<span style="color:blue;">'.$scanLaserEye.'</span>';
							if($scanLaserEye == 'OS') $scanLaserEye = '<span style="color:green;">'.$scanLaserEye.'</span>';
							?>
							<tr>
								<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
							</tr>
							<tr>
								<td colspan="2" height="2"></td>
							</tr>
							<tr>
								<td colspan="2" class="bluehed text_cap paddingTop10">GDX:&nbsp; <?php echo $scanLaserEye; ?> (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
							</tr>

							<?php
						}
						if($performBy || $ptUndersatnding){
							$performedBy = $this->print_phyInitial($performBy);
							?>

							<?php if($techComments!=""){
							?>
							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><b>Technician Comments:</b>&nbsp;<?php echo($techComments); ?></td>
							</tr>
							<?php }?>
							<tr>
								<td style="width:360px;" class="paddingTop10"><span class="text_lable">Performed By:&nbsp;</span> <?php echo $performedBy; ?></td>
								<td style="width:360px;" class="paddingTop10"><span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp; <?php echo $ptUndersatnding; ?></td>
							</tr>

							<?php
						}
						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if($diagnosis && $diagnosis!="--Select--"){
							?>
							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
							</tr>
							<?php
						}
						if($reliabilityOd || $reliabilityOs){
							?>

						<tr>
							<td style="width:740px;" colspan="2">
						<table style="width:700px;" cellpadding="0" cellspacing="0" >
							<tr>
								<td style="width:180px;" class="text_lable paddingTop10">Physician Interpretation:&nbsp;</td>
								<td style="width:80px;" class="text_lable paddingTop10">Reliability</td>
								<td style="width:50px;" class="text_lable paddingTop10"><?php $this->odLable();?></td>
								<td style="width:100px;" class="text_value paddingTop10"><?php echo $reliabilityOd; ?></td>
								<td style="width:50px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
								<td  style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
							</tr>
						</table>
							</td>
							</tr>
							<?php
						}
						$odData = '';
						$osData = '';

						// OD DATA
						if(!empty($normal_OD)){
							$odData .= (strpos($normal_OD, "Normal")!==false) ? 'Normal&nbsp;' : "" ;
							$odData .= (strpos($normal_OD, "Poor Study")!==false) ? 'Poor Study&nbsp;' : "" ;
							$odData .= "<br/>";
						}
						if(!empty($nf_Thick_OD)){
							$odData .= 'Nerve Fiber Thickness Map <br/>';
							$odData .= (strpos($nf_Thick_OD, "Normal Appearing Nerve Fiber Layer")!==false) ? 'Normal Appearing Nerve Fiber Layer<br/>' : "" ;
							$odData .= (strpos($nf_Thick_OD, "Suspicious Nerve Fiber Layer Thinning")!==false) ? 'Suspicious Nerve Fiber Layer Thinning<br/>' : "" ;
							$odData .= (strpos($nf_Thick_OD, "Definite Nerve Fiber Layer Thinning")!==false) ? 'Definite Nerve Fiber Layer Thinning<br/>' : "" ;
						}
						if(!empty($quad_devi_OD)){
							$odData .= 'Quadrant Deviation Map Outside Normal <br/>';
							$odData .= (strpos($quad_devi_OD, "Superior Quardrant")!==false) ? 'Superior Quardrant<br/>' : "" ;
							$odData .= (strpos($quad_devi_OD, "Nasal Quadrant")!==false) ? 'Nasal Quadrant<br/>' : "" ;
							$odData .= (strpos($quad_devi_OD, "Temporal Quadrant")!==false) ? 'Temporal Quadrant<br/>' : "" ;
							$odData .= (strpos($quad_devi_OD, "Inferior Quadrant")!==false) ? 'Inferior Quadrant<br/>' : "" ;
						}
						if(!empty($nf_Indic_OD)){
							$odData .= 'Nerve Fiber Indicator <br/>';
							$odData .= (strpos($nf_Indic_OD, "0-30 Normal (Low risk of Glaucoma)")!==false) ? '0-30 Normal (Low risk of Glaucoma)<br/>' : "" ;
							$odData .= (strpos($nf_Indic_OD, "31-50 Borderline")!==false) ? '31-50 Borderline<br/>' : "" ;
							$odData .= (strpos($nf_Indic_OD, "51+ (Abnormal risk of Glaucoma)")!==false) ? '51+ (Abnormal risk of Glaucoma)<br/>' : "" ;
						}

						// OS DATA
						if(!empty($normal_OS)){
							$osData .= (strpos($normal_OS, "Normal")!==false) ? 'Normal&nbsp;' : "" ;
							$osData .= (strpos($normal_OS, "Poor Study")!==false) ? 'Poor Study&nbsp;' : "" ;
							$osData .= "<br/>";
						}
						if(!empty($nf_Thick_OS)){
							$osData .= 'Nerve Fiber Thickness Map <br/>';
							$osData .= (strpos($nf_Thick_OS, "Normal Appearing Nerve Fiber Layer")!==false) ? 'Normal Appearing Nerve Fiber Layer<br/>' : "" ;
							$osData .= (strpos($nf_Thick_OS, "Suspicious Nerve Fiber Layer Thinning")!==false) ? 'Suspicious Nerve Fiber Layer Thinning<br/>' : "" ;
							$osData .= (strpos($nf_Thick_OS, "Definite Nerve Fiber Layer Thinning")!==false) ? 'Definite Nerve Fiber Layer Thinning<br/>' : "" ;
						}
						if(!empty($quad_devi_OS)){
							$osData .= 'Quadrant Deviation Map Outside Normal <br/>';
							$osData .= (strpos($quad_devi_OS, "Superior Quardrant")!==false) ? 'Superior Quardrant<br/>' : "" ;
							$osData .= (strpos($quad_devi_OS, "Nasal Quadrant")!==false) ? 'Nasal Quadrant<br/>' : "" ;
							$osData .= (strpos($quad_devi_OS, "Temporal Quadrant")!==false) ? 'Temporal Quadrant<br/>' : "" ;
							$osData .= (strpos($quad_devi_OS, "Inferior Quadrant")!==false) ? 'Inferior Quadrant<br/>' : "" ;
						}
						if(!empty($nf_Indic_OS)){
							$osData .= 'Nerve Fiber Indicator <br/>';
							$osData .= (strpos($nf_Indic_OS, "0-30 Normal (Low risk of Glaucoma)")!==false) ? '0-30 Normal (Low risk of Glaucoma)<br/>' : "" ;
							$osData .= (strpos($nf_Indic_OS, "31-50 Borderline")!==false) ? '31-50 Borderline<br/>' : "" ;
							$osData .= (strpos($nf_Indic_OS, "51+ (Abnormal risk of Glaucoma)")!==false) ? '51+ (Abnormal risk of Glaucoma)<br/>' : "" ;
						}

					if($osData!="" || $odData!="" || $Others_OD!="" || $Others_OS!="") {
							?>

							<tr>
								<td style="width:700px;" class="tb_subheading paddingTop10" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:360px;" class="paddingTop10"><?php $this->odLable();?></td>
								<td style="width:360px;" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:360px;" class="paddingTop10"><?php echo  $odData; ?></td>
								<td style="width:360px;" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						if($others_OD!="" || $others_OS!=""){
							?>
								<tr>
									<td style="width:360px;" class="paddingTop10"><?php echo $others_OD; ?></td>
									<td style="width:360px;" class="paddingTop10"><?php echo $others_OS; ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}

						if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
						if($contiMeds == 1) $treatment.= '&nbsp;Continue Meds &nbsp;';
						if($monitorIOP == 1) $treatment.= 'monitor IOP &nbsp;';
						if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
						if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.';
						if($ptInformed == 1) $treatment.= 'Pt informed of results &nbsp;';
						if($ptInformedNv==1)$treatment.= '&nbsp;Informed Pt. result next visit.&nbsp;';

						if($stable == 1 || $fuApa == 1 || $ptInformed == 1 || $monitorIOP == 1 || $tech2InformPt == 1){
							?>
								<tr>
									<td style="width:740px;" class="paddingTop10" colspan="2"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>
							<?php
						}
						if($comments){
							?>
								<tr>
									<td style="width:740px;" class="paddingTop10" colspan="2" ><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
								</tr>
							<?php
						}
						///Add OCT Images//
						$imagesHtml=$this->getTestImages($gdx_id,$sectionImageFrom="GDX",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($gdx_id!=""){
							$arrPDFs = $this->getAllTestPdf($gdx_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End OCT Images

						if($phyName){
							$phyName = $this->print_phyInitial($phyName);
							?>
								<tr>
									<td colspan="2" style="width:700px;" class="paddingTop10" ><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
								</tr>
							<?php
						}
						?>
					</table>
			<?php
		}//End oct While
	 }/* else{ ?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">GDX</td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>
		<?php
		}
	*/
	}

	public function print_pachy($patient_id=0,$form_id=0,$req=array()){
		$stable = "";
		$fuApa= "";
		$ptInforme = "";
		$monitorIOP = "";
		$tech2InformPt = "";
		if(is_array($req) && count($req)>0){
			$sqlPachy = "SELECT * FROM pachy WHERE patientId = '".$patient_id."' AND pachy_id in (".implode(",",$req).")";
		}else if($form_id!=""){
			$sqlPachy = "SELECT * FROM pachy WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ";
		}

		$resPachy = imw_query($sqlPachy);
		if(imw_num_rows($resPachy)>0){
		while($row=imw_fetch_array($resPachy)){
			extract($row);
			?>

					<table style="width:760px;"  cellpadding="0" cellspacing="0">
						<tr>
							<td colspan="2"  class="bluelne" height="1" style="width:750px;">&nbsp;</td>
						</tr>
						<tr>
							<td colspan="2"  height="2"></td>
						</tr>
						<tr>
							<td colspan="2"  class="bluehed text_cap paddingTop10" style="width:750px;">PACHY (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
						</tr>

						<?php
						if($pachyMeterEye){
							if($pachyMeterEye == 'OU') $pachyMeterEye = '<span style="color:purple;">'.$pachyMeterEye.'</span>';
							if($pachyMeterEye == 'OD') $pachyMeterEye = '<span style="color:blue;">'.$pachyMeterEye.'</span>';
							if($pachyMeterEye == 'OS') $pachyMeterEye = '<span style="color:green;">'.$pachyMeterEye.'</span>';
							?>

							<tr>
								<td colspan="2" class="text_lable paddingTop10">Pachymeter:&nbsp; <?php echo $pachyMeterEye; ?></td>
							</tr>

							<?php
						}
						if($performedBy || $ptUnderstanding){
							$performedBy = $this->print_phyInitial($performedBy);
							?>
						<?php
				if($techComments!=""){
				?>

							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10">
									<span class="text_lable">Technician Comments:&nbsp;</span><?php echo $techComments; ?>
								</td>
							</tr>

				<?php }?>

							<tr>
								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Performed By:&nbsp;</span> <?php echo $performedBy; ?></td>
								<td style="width:350px;" class="paddingTop10"><span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;<?php echo $ptUnderstanding; ?></td>
							</tr>

							<?php
						}
						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if($diagnosis){
							?>

							<tr>
								<td  colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo $diagnosis; ?></td>
							</tr>

							<?php
						}
						if($reliabilityOd || $reliabilityOs){
							?>
							<tr>
								<td colspan="2" style="width:740px;">
							<table style="width:740px;" cellpadding="0" cellspacing="0">
								<tr>
									<td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
									<td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
									<td style="width:50px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
									<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOd; ?></td>
									<td style="width:50px;"  class="paddingTop10 text_lable"><?php $this->osLable();?></td>
									<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
								</tr>
							</table>
							</td>
						</tr>
							<?php
						}
						$odData = '';
						$osData = '';

						// OD DATA
						if($Central_OD || $Nasal_OD || $pachy_od_readings || $pachy_od_average || $pachy_od_correction_value){
							$odData.= 'Pachy';
							if($Central_OD == 1) $odData.= '&nbsp;Central&nbsp;';
							if($Nasal_OD == 1) $odData.= '&nbsp;Nasal&nbsp;';
							if($pachy_od_readings) $odData.= '&nbsp;'.$pachy_od_readings.'&nbsp;';
							if($pachy_od_average) $odData.= '&nbsp;'.$pachy_od_average.'&nbsp;';
							if($pachy_od_correction_value) $odData.= '&nbsp;'.$pachy_od_correction_value.'&nbsp;';
							if($Central_OD == 1 || $Nasal_OD == 1 || $pachy_od_readings || $pachy_od_average || $pachy_od_correction_value)
								$odData.= '<br>';
							if($Inferior_OD) $odData.= '&nbsp;Inferior&nbsp;';
							if($Temporal_OD) $odData.= '&nbsp;Temporal&nbsp;';
							if($Superior_OD) $odData.= '&nbsp;Superior&nbsp;';
						}
						if($iris_iridec_od){
							$odData.= '<br/>Iris/Iridectomy at '.$iris_iridec_od.' o\' clock&nbsp;';
						}

						// OS DATA
						if($Central_OS || $Nasal_OS || $pachy_os_readings || $pachy_os_average || $pachy_os_correction_value){
							$osData.= 'Pachy';
							if($Central_OS == 1) $osData.= '&nbsp;Central&nbsp;';
							if($Nasal_OS == 1) $osData.= '&nbsp;Nasal&nbsp;';
							if($pachy_os_readings) $osData.= '&nbsp;'.$pachy_os_readings.'&nbsp;';
							if($pachy_os_average) $osData.= '&nbsp;'.$pachy_os_average.'&nbsp;';
							if($pachy_os_correction_value) $osData.= '&nbsp;'.$pachy_os_correction_value.'&nbsp;';
							if($Central_OS == 1 || $Nasal_OS == 1 || $pachy_os_readings || $pachy_os_average || $pachy_os_correction_value)
								$osData.= '<br>';
							if($Inferior_OS) $osData.= '&nbsp;Inferior&nbsp;';
							if($Temporal_OS) $osData.= '&nbsp;Temporal&nbsp;';
							if($Superior_OS) $osData.= '&nbsp;Superior&nbsp;';
						}
						if($iris_iridec_os){
							$osData.= '<br/>Iris/Iridectomy at '.$iris_iridec_os.' o\' clock&nbsp;';
						}

					if($osData!="" || $odData!="" || $descOd!="" || $descOs!=""){
							?>

							<tr>
								<td style="width:700px;" class="tb_subheading paddingTop10" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:350px;" class="paddingTop10"><?php $this->odLable();?></td>
								<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:350px;" class="paddingTop10"><?php echo  $odData; ?></td>
								<td style="width:350px;" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						if($descOd!="" || $descOs!=""){
							?>
								<tr>
									<td style="width:350px;" class="paddingTop10"><span class="text_lable">Description:&nbsp;</span><?php echo $descOd; ?></td>
									<td style="width:350px;" class="paddingTop10"><span class="text_lable">Description:&nbsp;</span><?php echo $descOs; ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}

						$treatment = "";
						if($stable == 1) $treatment= 'Stable&nbsp;&nbsp;';
						if($contiMeds == 1) $treatment.= 'Continue Meds&nbsp;&nbsp;';
						if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
						if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt. &nbsp;';
						if($ptInformed == 1) $treatment.= 'Pt informed of results&nbsp;';
						if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit';


						if($stable == 1 || $fuApa == 1 || $ptInformed == 1){
							?>
								<tr>
									<td colspan="2"  class="paddingTop10 text_lable" style="width:700px;">Treatment/Prognosis:&nbsp;<span class="text_value"><?php echo $treatment; ?></span></td>
								</tr>
							<?php
								}
								if($comments)
								{
							?>
							<tr>
								<td colspan="2" class="paddingTop10 text_lable" style="width:700px;">Comments:&nbsp;<span class="text_value"><?php echo $comments; ?></span></td>
							</tr>
							<?php
						}
						///Add IVFA Images//
						$imagesHtml=$this->getTestImages($pachy_id,$sectionImageFrom="Pacchy",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($pachy_id!=""){
							$arrPDFs = $this->getAllTestPdf($pachy_id);
							$str_alternative_images = $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td style="width:700px;" colspan="2" class="paddingTop10"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End Pacchy Images
						if($phyName){
							$phyName = $this->print_phyInitial($phyName);
							?>

							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $phyName; ?></td>
							</tr>

							<?php
						}
						?>
					</table>
			<?php
		}//End of Pachy While
	 }/* else{ ?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" style="width:750px;">PACHY</td>
				</tr>
				<tr>
					<td>No Data</td>
				</tr>
		   </table>
		<?php
		} */

	}

	public function print_ivfa($patient_id=0,$form_id=0,$req=array()){
		$stable = "";
		$fuApa= "";
		$ptInforme = "";
		$monitorIOP = "";
		$tech2InformPt = "";
		if(is_array($req) && count($req)>0){
			$sqlIVFA = "SELECT * FROM ivfa WHERE patient_id = '".$patient_id."' AND vf_id in(".implode(",",$req).") ";
		}else if($form_id){
			$sqlIVFA = "SELECT * FROM ivfa WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}
		$rowIVFA = imw_query($sqlIVFA);
		if(imw_num_rows($rowIVFA)>0){
		while($row=imw_fetch_array($rowIVFA))
		{
			extract($row);
			$osData = '';
			$odData = '';
			?>
			<table  cellpadding="0" cellspacing="0" style="width:750px;">
			<tr>
				<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2" height="2"></td>
			</tr>
			<tr>
				<td colspan="2" class="bluehed text_cap paddingTop10" style="width:750px;">IVFA (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($exam_date);?></span>)</td>
			</tr>

					<?php
						if($ivfa_od == "1") $ivfa_od = '<span style="color:purple;">OU</span>';
						if($ivfa_od == "2" || $ivfa_od == "3") $ivfa_od = '<span style="color:blue;">OD</span> > <span style="color:green;">OS</span>';
						if($ivfa_early == 1) $ivfa_early = 'Early and late shots&nbsp;&nbsp;';
						if($ivfa_extra == 1) $ivfa_extra = 'Extra Copy';
						if($ivfa_od || $ivfa_early == 1 || $ivfa_extra == 1)
						{
					?>

	<tr>
	<td colspan="2" class="text_lable paddingTop10" style="width:700px;" ><?php if($ivfa_od) echo '<span class="text_lable">IVFA:&nbsp;</span>'.$ivfa_od.'&nbsp;'; if($ivfa_early) echo $ivfa_early; if($ivfa_extra) echo $ivfa_extra; ?></td>
						</tr>

					<?php
					}
					if($comments_ivfa)
					{
						?>
							<tr>
								<td colspan="2" class="paddingTop10" style="width:700px;">Description:&nbsp; <?php echo $comments_ivfa; ?></td>
							</tr>
					<!--	</table> -->
						<?php
						}
						if($performed_by || $pa_under)
						{
							$performed_by = $this->print_phyInitial($performed_by);
							?>
							<!--<table> -->
							<?php if($techComments!=""){?>
								<tr>
									<td  colspan="2" class="text_lable paddingTop10" style="width:700px;"><b>Technician Comments:</b>&nbsp;<?php echo($techComments);?></td>
								</tr>
							<?php }?>
								<tr>

									<td colspan="2" class="paddingTop10">
										<?php
											if($performed_by) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performed_by.'&nbsp;&nbsp;';
											if($pa_under) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$pa_under;
											if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
											if(!empty($diagnosis) && $diagnosis!="--Select--") echo '&nbsp;&nbsp;<span class="text_lable">Diagnosis</span>:&nbsp;'.$diagnosis;
										?>
									</td>
								</tr>

							<?php
							}
							if($pa_inter || $pa_inter1)
							{
							?>
						<tr>
							<td  style="width:700px;" colspan="2">
							<table cellpadding="0" cellspacing="0" style="width:700px;">
								<tr>
									<td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
									<td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
									<td style="width:50px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
									<td style="width:150px;" class="paddingTop10 text_value"><?php echo $pa_inter; ?></td>
									<td style="width:50px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
									<td style="width:150px;" class="paddingTop10 text_value"><?php echo $pa_inter1; ?></td>
								</tr>
							</table>
							</td>
						</tr>
						<?php
							}


						if($Sharp_Pink_OD || $Pale_OD || $Large_Cap_OD || $Sloping_OD || $Notch_OD || $NVD_OD || $Leakage_OD){
							$odData.= 'Disc';
							if($Sharp_Pink_OD == 1){ $odData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
							if($Pale_OD == 1){ $odData.= '&nbsp;Pale&nbsp;'; ++$c;}
							if($Large_Cap_OD == 1){ $odData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
								if($c>=3){ $c = 0; $odData.= '<br>'; $c = 0; }
							if($Sloping_OD == 1){ $odData.= '&nbsp;Sloping&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Notch_OD == 1){ $odData.= '&nbsp;Notch&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($NVD_OD == 1){ $odData.= '&nbsp;NVD&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Leakage_OD == 1) $odData.= '&nbsp;Leakage&nbsp;';
						}

						if($Retina_Hemorrhage_OD || $Retina_Microaneurysms_OD || $Retina_Exudates_OD || $Retina_Laser_Scars_OD
							|| $Retina_NEVI_OD || $Retina_SRVNM_OD || $Retina_Edema_OD
							|| $Retina_BDR_OD_T || $Retina_BDR_OD_1 || $Retina_BDR_OD_2 || $Retina_BDR_OD_3 || $Retina_BDR_OD_4
							|| $Retina_Druse_OD_T || $Retina_Druse_OD_1 || $Retina_Druse_OD_2 || $Retina_Druse_OD_3 || $Retina_Druse_OD_4
							|| $Retina_RPE_Change_OD_T || $Retina_RPE_Change_OD_1 || $Retina_RPE_Change_OD_2 || $Retina_RPE_Change_OD_3 || $Retina_RPE_Change_OD_4
							|| $Retina_Ischemia_OD || 	$Retina_BRVO_OD || $Retina_CRVO_OD ||  $Retina_Nevus_OD){
							$odData.= '<br>Retina';
						}

						if($Retina_Hemorrhage_OD || $Retina_Microaneurysms_OD || $Retina_Exudates_OD || $Retina_Laser_Scars_OD || $Retina_NEVI_OD || $Retina_SRVNM_OD || $Retina_Edema_OD || $Retina_Nevus_OD || $Retina_Ischemia_OD || 	$Retina_BRVO_OD || $Retina_CRVO_OD  )
						{
							$c=0;
							if($Retina_Hemorrhage_OD == 1){ $odData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
							if($Retina_Microaneurysms_OD == 1){ $odData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
							if($Retina_Exudates_OD == 1){ $odData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Laser_Scars_OD == 1){ $odData.= '&nbsp;Laser Scars&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_NEVI_OD == 1){ $odData.= '&nbsp;NVE&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_SRVNM_OD == 1){ $odData.= '&nbsp;SRVNM&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Edema_OD == 1){ $odData.= '&nbsp;Edema&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Nevus_OD==1){$odData.= '&nbsp;Nevus&nbsp;' ; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Ischemia_OD==1){$odData.= '&nbsp;Ischemia&nbsp;' ;	++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Retina_BRVO_OD==1){$odData.= '&nbsp;BRVO&nbsp;' ;	++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Retina_CRVO_OD==1){$odData.= '&nbsp;CRVO&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }


						}
						if($Retina_BDR_OD_T || $Retina_BDR_OD_1 || $Retina_BDR_OD_2 || $Retina_BDR_OD_3 || $Retina_BDR_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;BDR';
							if($Retina_BDR_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_BDR_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_BDR_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_BDR_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_BDR_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_Druse_OD_T || $Retina_Druse_OD_1 || $Retina_Druse_OD_2 || $Retina_Druse_OD_3 || $Retina_Druse_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;Drusen';
							if($Retina_Druse_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_Druse_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_Druse_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_Druse_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_Druse_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_RPE_Change_OD_T || $Retina_RPE_Change_OD_1 || $Retina_RPE_Change_OD_2 || $Retina_RPE_Change_OD_3 || $Retina_RPE_Change_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;RPE&nbsp;Change';
							if($Retina_RPE_Change_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_RPE_Change_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_RPE_Change_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_RPE_Change_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_RPE_Change_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Druse_OD || $RPE_Changes_OD || $SRNVM_OD || $Edema_OD || $Scars_OD || $Hemorrhage_OD || $Microaneurysms_OD || $Exudates_OD
							|| $Macula_BDR_OD_T || $Macula_BDR_OD_1 || $Macula_BDR_OD_2 || $Macula_BDR_OD_3 || $Macula_BDR_OD_4
							|| $Macula_SMD_OD_T || $Macula_SMD_OD_1 || $Macula_SMD_OD_2 || $Macula_SMD_OD_3 || $Macula_SMD_OD_4 ||
								$PED_OD || $SR_Heme_OD || $Classic_CNV_OD || $Occult_CNV_OD ){
								$odData.= '<br>Macula';
						}
						if($Druse_OD || $RPE_Changes_OD || $SRNVM_OD || $Edema_OD || $Scars_OD || $Hemorrhage_OD || $Microaneurysms_OD || $Exudates_OD ||
								$PED_OD || $SR_Heme_OD || $Classic_CNV_OD || $Occult_CNV_OD ){
							$c = 0;
							if($Druse_OD == 1){ $odData.= '&nbsp;Drusen&nbsp;' ; ++$c; }
							if($RPE_Changes_OD == 1){ $odData.= '&nbsp;RPE Changes&nbsp;' ; ++$c; }
							if($SRNVM_OD == 1){ $odData.= '&nbsp;SRNVM&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Edema_OD == 1){ $odData.= '&nbsp;Edema&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							//if($Retina_Nevus_OD == 1){ $odData.= '&nbsp;Nevus&nbsp;' ; ++$c; }
							///	if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Scars_OD == 1){ $odData.= '&nbsp;Scars&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Hemorrhage_OD == 1){ $odData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Microaneurysms_OD == 1){ $odData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Exudates_OD == 1){ $odData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($PED_OD==1){	$odData.= '&nbsp;PED&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($SR_Heme_OD==1){	$odData.= '&nbsp;SR Heme&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Classic_CNV_OD==1){	$odData.= '&nbsp;Classic CNV&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Occult_CNV_OD==1){$odData.= '&nbsp;Occult CNV&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }


						}
						if($Macula_BDR_OD_T || $Macula_BDR_OD_1 || $Macula_BDR_OD_2 || $Macula_BDR_OD_3 || $Macula_BDR_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;BDR';
							if($Macula_BDR_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Macula_BDR_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Macula_BDR_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Macula_BDR_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Macula_BDR_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Macula_SMD_OD_T || $Macula_SMD_OD_1 || $Macula_SMD_OD_2 || $Macula_SMD_OD_3 || $Macula_SMD_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;SMD';
							if($Macula_SMD_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Macula_SMD_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Macula_SMD_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Macula_SMD_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Macula_SMD_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}


						// OS DATA
						if($Sharp_Pink_OS || $Pale_OS || $Large_Cap_OS || $Sloping_OS || $Notch_OS || $NVD_OS || $Leakage_OS){
							$osData.= 'Disc';
							if($Sharp_Pink_OS == 1){ $osData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
							if($Pale_OS == 1){ $osData.= '&nbsp;Pale&nbsp;'; ++$c;}
							if($Large_Cap_OS == 1){ $osData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
								if($c>=3){ $c = 0; $osData.= '<br>'; $c = 0; }
							if($Sloping_OS == 1){ $osData.= '&nbsp;Sloping&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Notch_OS == 1){ $osData.= '&nbsp;Notch&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($NVD_OS == 1){ $osData.= '&nbsp;NVD&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Leakage_OS == 1) $osData.= '&nbsp;Leakage&nbsp;';
						}
						if($Retina_Hemorrhage_OS || $Retina_Microaneurysms_OS || $Retina_Exudates_OS || $Retina_Laser_Scars_OS
							|| $Retina_NEVI_OS || $Retina_SRVNM_OS || $Retina_Edema_OS
							|| $Retina_BDR_OS_T || $Retina_BDR_OS_1 || $Retina_BDR_OS_2 || $Retina_BDR_OS_3 || $Retina_BDR_OS_4
							|| $Retina_Druse_OS_T || $Retina_Druse_OS_1 || $Retina_Druse_OS_2 || $Retina_Druse_OS_3 || $Retina_Druse_OS_4
							|| $Retina_RPE_Change_OS_T || $Retina_RPE_Change_OS_1 || $Retina_RPE_Change_OS_2 || $Retina_RPE_Change_OS_3 || $Retina_RPE_Change_OS_4
							|| $Retina_Ischemia_OS ||$Retina_BRVO_OS || $Retina_CRVO_OS||$Retina_Nevus_OS ){
							$osData.= '<br>Retina';
						}
						if($Retina_Hemorrhage_OS || $Retina_Microaneurysms_OS || $Retina_Exudates_OS || $Retina_Laser_Scars_OS || $Retina_NEVI_OS || $Retina_SRVNM_OS || $Retina_Edema_OS || $Retina_Nevus_OS ||$Retina_Ischemia_OS ||$Retina_BRVO_OS || $Retina_CRVO_OS ){
							$c = 0;
							if($Retina_Hemorrhage_OS == 1){ $osData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
							if($Retina_Microaneurysms_OS == 1){ $osData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
							if($Retina_Exudates_OS == 1){ $osData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Laser_Scars_OS == 1){ $osData.= '&nbsp;Laser Scars&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_NEVI_OS == 1){ $osData.= '&nbsp;NVE&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_SRVNM_OS == 1){ $osData.= '&nbsp;SRVNM&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Edema_OS == 1){ $osData.= '&nbsp;Edema&nbsp;' ; ++$c; }
							if($Retina_Nevus_OS==1){$osData.= '&nbsp;Nevus&nbsp;' ; ++$c;}
							if($Retina_Ischemia_OS== 1){$osData.= '&nbsp;Ischemia&nbsp;' ;	++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_BRVO_OS==1){		$osData.= '&nbsp;BRVO&nbsp;' ;	++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_CRVO_OS==1){		$osData.= '&nbsp;CRVO&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

						}
						if($Retina_BDR_OS_T || $Retina_BDR_OS_1 || $Retina_BDR_OS_2 || $Retina_BDR_OS_3 || $Retina_BDR_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;BDR';
							if($Retina_BDR_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_BDR_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_BDR_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_BDR_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_BDR_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_Druse_OS_T || $Retina_Druse_OS_1 || $Retina_Druse_OS_2 || $Retina_Druse_OS_3 || $Retina_Druse_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;Druse';
							if($Retina_Druse_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_Druse_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_Druse_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_Druse_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_Druse_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_RPE_Change_OS_T || $Retina_RPE_Change_OS_1 || $Retina_RPE_Change_OS_2 || $Retina_RPE_Change_OS_3 || $Retina_RPE_Change_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;RPE&nbsp;Change';
							if($Retina_RPE_Change_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_RPE_Change_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_RPE_Change_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_RPE_Change_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_RPE_Change_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Druse_OS || $RPE_Changes_OS || $SRNVM_OS || $Edema_OS || $Scars_OS || $Hemorrhage_OS || $Microaneurysms_OS || $Exudates_OS
							|| $Macula_BDR_OS_T || $Macula_BDR_OS_1 || $Macula_BDR_OS_2 || $Macula_BDR_OS_3 || $Macula_BDR_OS_4
							|| $Macula_SMD_OS_T || $Macula_SMD_OS_1 || $Macula_SMD_OS_2 || $Macula_SMD_OS_3 || $Macula_SMD_OS_4 ||
							$SR_Heme_OS ||$Classic_CNV_OS||$Occult_CNV_OS){
								$osData.= '<br>Macula';
						}
						if($Druse_OS || $RPE_Changes_OS || $SRNVM_OS || $Edema_OS || $Scars_OS || $Hemorrhage_OS || $Microaneurysms_OS || $Exudates_OS||$SR_Heme_OS ||$Classic_CNV_OS||$Occult_CNV_OS){
							$c = 0;
							if($Druse_OS == 1){ $osData.= '&nbsp;Druse&nbsp;' ; ++$c; }
							if($RPE_Changes_OS == 1){ $osData.= '&nbsp;RPE Changes&nbsp;' ; ++$c; }
							if($SRNVM_OS == 1){ $osData.= '&nbsp;SRNVM&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Edema_OS == 1){ $osData.= '&nbsp;Edema&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Nevus_OS == 1){ $osData.= '&nbsp;Nevus&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Scars_OS == 1){ $osData.= '&nbsp;Scars&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Hemorrhage_OS == 1){ $osData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Microaneurysms_OS == 1){ $osData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Exudates_OS == 1){ $osData.= '&nbsp;Exudates&nbsp;' ; ++$c; }

							if($PED_OS==1){	$osData.= '&nbsp;PED&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

							if($SR_Heme_OS==1){		$osData.= '&nbsp;SR Heme&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Classic_CNV_OS==1){		$osData.= '&nbsp;Classic CNV&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Occult_CNV_OS==1){		$osData.= '&nbsp;Occult CNV&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

						}
						if($Macula_BDR_OS_T || $Macula_BDR_OS_1 || $Macula_BDR_OS_2 || $Macula_BDR_OS_3 || $Macula_BDR_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;BDR';
							if($Macula_BDR_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Macula_BDR_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Macula_BDR_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Macula_BDR_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Macula_BDR_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Macula_SMD_OS_T || $Macula_SMD_OS_1 || $Macula_SMD_OS_2 || $Macula_SMD_OS_3 || $Macula_SMD_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;SMD';
							if($Macula_SMD_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Macula_SMD_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Macula_SMD_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Macula_SMD_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Macula_SMD_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($osData!="" || $odData!="" || $testresults_desc_od!="" || $testresults_desc_os!=""){
							?>
										<tr>
											<td class="tb_subheading paddingTop10" colspan="2">Test Results</td>
										</tr>
										<tr>
											<td class="paddingTop10" style="width:350px"><?php $this->odLable();?></td>
											<td class="paddingTop10" style="width:350px"><?php $this->osLable();?></td>
										</tr>
									<?php
										if($odData || $osData)
										{
										?>
										<tr>
											<td style="width:350px" class="paddingTop10"><?php echo $odData; ?></td>
											<td style="width:350px" class="paddingTop10"><?php echo $osData; ?></td>
										</tr>
									<?php
										}
									if($testresults_desc_od || $testresults_desc_os)
										{
										?>
											<tr>
												<td style="width:350px" class="paddingTop10"><?php echo $testresults_desc_od; ?></td>
												<td style="width:350px" class="paddingTop10"><?php echo $testresults_desc_os; ?></td>
											</tr>
										 <?php
										}
									?>


							<?php
						}
						?>

						<?php
						$treatment = '';

				if($Stable == 1) $treatment.= 'Stable&nbsp;';
				if($ContinueMeds == 1) $treatment.= 'Continue Meds&nbsp;';
				if($FuApa == 1) $treatment.= 'F/U APA&nbsp;';
				if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
				if($PatientInformed == 1) $treatment.= 'Pt informed of results&nbsp;';
				if($MonitorAg  == 1) $treatment.= 'Monitor AG&nbsp;';
				if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';

						if($stable == 1 || $treatment!=""){
							?>
							<!--<table> -->
								<tr>
									<td colspan="2" class="paddingTop10" style="width:700px;"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>
							<!--</table> -->
							<?php
						}
						if($ArgonLaser || $ArgonLaserEye || $ArgonLaserEyeOptions || $FuRetinaComments){
							if($ArgonLaser) {
								$ArgonLaser = 'Argon Laser Surgery&nbsp;&nbsp;';
								if($ArgonLaserEye) $ArgonLaser.= ''.$ArgonLaserEye.'&nbsp;&nbsp;';
								if($ArgonLaserEyeOptions) $ArgonLaser.= $ArgonLaserEyeOptions.'&nbsp;&nbsp;';
							}else{
								$ArgonLaser =  "";
							}
							if($FuRetina == 1) $ArgonLaser.= 'F/U Retina &nbsp;';
							if($FuRetinaComments){
							$ArgonLaser.=$FuRetinaComments;
							}
							if($rptTst1yr==1){$ArgonLaser.= '&nbsp;&nbsp;Repeat test 1 year ';}
							?>

							<!--<table> -->
								<tr>
									<td colspan="2" class="paddingTop10" style="width:700px;">
										<?php echo $ArgonLaser; ?>
									</td>
								</tr>
							<!--</table> -->

							<?php
						}


							if($ivfaComments !=""){
							?>
							<!--<table> -->
								<tr>
									<td colspan="2" class="paddingTop10" style="width:700px;"><strong>Comments:</strong><?php echo $ivfaComments; ?></td>
								</tr>
							<!--</table> -->
							<?php
						}


						///Add IVFA Images//
						$imagesHtml=$this->getTestImages($vf_id,$sectionImageFrom="IVFA",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($vf_id!=""){
							$arrPDFs = $this->getAllTestPdf($vf_id);
							$str_alternative_images = $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px;" class="paddingTop10"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End IVFA Images
						if($phy)
						{
							$physicianName = $this->print_phyInitial($phy);
							?>
						<!--<table > -->
							<tr >
								<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
							</tr>
						<!--</table> -->
							<?php
						}
						?>
						</table>

			<?php
			}//END IVFA WHILE
		}/* else{ ?>
	<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" style="width:750px;">IVFA</td>
				</tr>
				<tr>
					<td>No Data</td>
				</tr>
		   </table>
	<?php
	} */

	}

	public function print_icg($patient_id=0,$form_id=0,$req=array()){
		$stable = "";
		$fuApa= "";
		$ptInforme = "";
		$monitorIOP = "";
		$tech2InformPt = "";
		if(is_array($req) && count($req)>0)
		{
			$sqlICG = "SELECT * FROM icg WHERE patient_id = '".$patient_id."' AND icg_id in(".implode(",",$req).") ";
		}
		else if($form_id)
		{
			$sqlICG = "SELECT * FROM icg WHERE patient_id = '".$patient_id."' AND form_id = '$form_id' AND purged='0' ";
		}
		$rowICG = imw_query($sqlICG);
		if(imw_num_rows($rowICG)>0){
		while($row=imw_fetch_array($rowICG))
		{
			extract($row);
			$osData = '';
			$odData = '';
			?>
				<table cellpadding="0" cellspacing="0"  style="width:750px;">
					<tr>
						<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td colspan="2" class="bluehed text_cap paddingTop10">ICG (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($exam_date);?></span>)</td>
					</tr>


					<?php
					if($icg_od == "1") $icg_od = '<span style="color:purple;">OU</span>';
					if($icg_od == "2" || $icg_od == "3") $icg_od = '<span style="color:blue;">OD</span> > <span style="color:green;">OS</span>';
					if($icg_early == 1) $icg_early = 'Early and late shots&nbsp;&nbsp;';
					if($icg_extra == 1) $icg_extra = 'Extra Copy';
					if($icg_od || $icg_early == 1 || $icg_extra == 1)
					{
						?>

						<tr>
							<td colspan="2" class="paddingTop10 text_lable"><?php if($icg_od) echo '<span class="text_lable">ICG:&nbsp;</span>'.$icg_od.'&nbsp;'; if($icg_early) echo $icg_early; if($icg_extra) echo $icg_extra; ?></td>
						</tr>

						<?php
					}
					if($comments_icg)
					{
						?>

							<tr>
								<td colspan="2" class="paddingTop10" style="width:700px;"><span class="text_lable">Description:&nbsp;</span> <?php echo $comments_icg; ?></td>
							</tr>

							<?php
						}
						if($performed_by || $pa_under){

								$performed_by = $this->print_phyInitial($performed_by);
							?>

							<?php if($techComments!=""){?>
								<tr>
									<td colspan="2" class="paddingTop10" style="width:700px;"><b>Technician Comments:</b>&nbsp;<?php echo($techComments);?></td>
								</tr>
							<?php }?>
								<tr>

									<td colspan="2" class="paddingTop10" style="width:700px;">
										<?php
											if($performed_by) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performed_by.'&nbsp;&nbsp;';
											if($pa_under) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$pa_under;
											if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
											if(!empty($diagnosis) && $diagnosis!="--Select--") echo '&nbsp;&nbsp;<span class="text_lable">Diagnosis</span>:&nbsp;'.$diagnosis;
										?>
									</td>
								</tr>


						<?php
							}
							if($pa_inter || $pa_inter1)
							{
							?>


						<tr>
							<td style="width:700px;" colspan="2">
						<table style="width:700px;" cellpadding="0" cellspacing="0">
							<tr>
							  <td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
							  <td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
							  <td style="width:50px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
							  <td style="width:150px;" class="paddingTop10 text_value"><?php echo $pa_inter; ?></td>
							  <td style="width:50px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
							  <td style="width:150px;" class="paddingTop10 text_value"><?php echo $pa_inter1; ?></td>
							</tr>
						</table>
						</td>
						</tr>
							<?php
							}


						if($Sharp_Pink_OD || $Pale_OD || $Large_Cap_OD || $Sloping_OD || $Notch_OD || $NVD_OD || $Leakage_OD){
							$odData.= 'Disc';
							if($Sharp_Pink_OD == 1){ $odData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
							if($Pale_OD == 1){ $odData.= '&nbsp;Pale&nbsp;'; ++$c;}
							if($Large_Cap_OD == 1){ $odData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
								if($c>=3){ $c = 0; $odData.= '<br>'; $c = 0; }
							if($Sloping_OD == 1){ $odData.= '&nbsp;Sloping&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Notch_OD == 1){ $odData.= '&nbsp;Notch&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($NVD_OD == 1){ $odData.= '&nbsp;NVD&nbsp;'; ++$c;}
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Leakage_OD == 1) $odData.= '&nbsp;Leakage&nbsp;';
						}

						if($Retina_Hemorrhage_OD || $Retina_Microaneurysms_OD || $Retina_Exudates_OD || $Retina_Laser_Scars_OD
							|| $Retina_NEVI_OD || $Retina_SRVNM_OD || $Retina_Edema_OD
							|| $Retina_BDR_OD_T || $Retina_BDR_OD_1 || $Retina_BDR_OD_2 || $Retina_BDR_OD_3 || $Retina_BDR_OD_4
							|| $Retina_Druse_OD_T || $Retina_Druse_OD_1 || $Retina_Druse_OD_2 || $Retina_Druse_OD_3 || $Retina_Druse_OD_4
							|| $Retina_RPE_Change_OD_T || $Retina_RPE_Change_OD_1 || $Retina_RPE_Change_OD_2 || $Retina_RPE_Change_OD_3 || $Retina_RPE_Change_OD_4
							|| $Retina_Ischemia_OD || 	$Retina_BRVO_OD || $Retina_CRVO_OD || $Retina_Nevus_OD){
							$odData.= '<br>Retina';
						}

						if($Retina_Hemorrhage_OD || $Retina_Microaneurysms_OD || $Retina_Exudates_OD || $Retina_Laser_Scars_OD || $Retina_NEVI_OD || $Retina_SRVNM_OD || $Retina_Edema_OD || $Retina_Nevus_OD || $Retina_Ischemia_OD || 	$Retina_BRVO_OD || $Retina_CRVO_OD  ){
							$c = 0;
							if($Retina_Hemorrhage_OD == 1){ $odData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
							if($Retina_Microaneurysms_OD == 1){ $odData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
							if($Retina_Exudates_OD == 1){ $odData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Laser_Scars_OD == 1){ $odData.= '&nbsp;Laser Scars&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_NEVI_OD == 1){ $odData.= '&nbsp;NVE&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_SRVNM_OD == 1){ $odData.= '&nbsp;SRVNM&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Edema_OD == 1){ $odData.= '&nbsp;Edema&nbsp;' ; ++$c; }
							if($Retina_Nevus_OD == 1){ $odData.= '&nbsp;Nevus&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Retina_Ischemia_OD==1){$odData.= '&nbsp;Ischemia&nbsp;' ;	++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Retina_BRVO_OD==1){$odData.= '&nbsp;BRVO&nbsp;' ;	++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Retina_CRVO_OD==1){$odData.= '&nbsp;CRVO&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

						}
						if($Retina_BDR_OD_T || $Retina_BDR_OD_1 || $Retina_BDR_OD_2 || $Retina_BDR_OD_3 || $Retina_BDR_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;BDR';
							if($Retina_BDR_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_BDR_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_BDR_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_BDR_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_BDR_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_Druse_OD_T || $Retina_Druse_OD_1 || $Retina_Druse_OD_2 || $Retina_Druse_OD_3 || $Retina_Druse_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;Drusen';
							if($Retina_Druse_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_Druse_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_Druse_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_Druse_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_Druse_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_RPE_Change_OD_T || $Retina_RPE_Change_OD_1 || $Retina_RPE_Change_OD_2 || $Retina_RPE_Change_OD_3 || $Retina_RPE_Change_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;RPE&nbsp;Change';
							if($Retina_RPE_Change_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Retina_RPE_Change_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Retina_RPE_Change_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Retina_RPE_Change_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Retina_RPE_Change_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Druse_OD || $RPE_Changes_OD || $SRNVM_OD || $Edema_OD || $Scars_OD || $Hemorrhage_OD || $Microaneurysms_OD || $Exudates_OD
							|| $Macula_BDR_OD_T || $Macula_BDR_OD_1 || $Macula_BDR_OD_2 || $Macula_BDR_OD_3 || $Macula_BDR_OD_4
							|| $Macula_SMD_OD_T || $Macula_SMD_OD_1 || $Macula_SMD_OD_2 || $Macula_SMD_OD_3 || $Macula_SMD_OD_4||
								$PED_OD || $SR_Heme_OD || $Classic_CNV_OD || $Occult_CNV_OD ){
								$odData.= '<br>Macula';
						}
						if($Druse_OD || $RPE_Changes_OD || $SRNVM_OD || $Edema_OD || $Scars_OD || $Hemorrhage_OD || $Microaneurysms_OD || $Exudates_OD||
							$PED_OD || $SR_Heme_OD || $Classic_CNV_OD || $Occult_CNV_OD ){
							$c = 0;
							if($Druse_OD == 1){ $odData.= '&nbsp;Drusen&nbsp;' ; ++$c; }
							if($RPE_Changes_OD == 1){ $odData.= '&nbsp;RPE Changes&nbsp;' ; ++$c; }
							if($SRNVM_OD == 1){ $odData.= '&nbsp;SRNVM&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Edema_OD == 1){ $odData.= '&nbsp;Edema&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Scars_OD == 1){ $odData.= '&nbsp;Scars&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Hemorrhage_OD == 1){ $odData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Microaneurysms_OD == 1){ $odData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Exudates_OD == 1){ $odData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($PED_OD==1){	$odData.= '&nbsp;PED&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($SR_Heme_OD==1){	$odData.= '&nbsp;SR Heme&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Classic_CNV_OD==1){	$odData.= '&nbsp;Classic CNV&nbsp;' ;++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

							if($Occult_CNV_OD==1){$odData.= '&nbsp;Occult CNV&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }

						}
						if($Macula_BDR_OD_T || $Macula_BDR_OD_1 || $Macula_BDR_OD_2 || $Macula_BDR_OD_3 || $Macula_BDR_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;BDR';
							if($Macula_BDR_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Macula_BDR_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Macula_BDR_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Macula_BDR_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Macula_BDR_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}
						if($Macula_SMD_OD_T || $Macula_SMD_OD_1 || $Macula_SMD_OD_2 || $Macula_SMD_OD_3 || $Macula_SMD_OD_4){
							$odData.= '<br>';
							$odData.= '&nbsp;SMD';
							if($Macula_SMD_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
							if($Macula_SMD_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
							if($Macula_SMD_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
							if($Macula_SMD_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
							if($Macula_SMD_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						}

						if($Feeder_Vessel_OD || $Central_OD || $Nasal_OD || $Temporal_OD || $Inferior_OD || $Superior_OD || $Hot_Spot_OD){
							$odData.= '<br>';
							if($Feeder_Vessel_OD==1){$odData.= '&nbsp;Feeder  Vessel&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Central_OD==1){$odData.= '&nbsp;Central&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Nasal_OD==1){$odData.= '&nbsp;Nasal&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Temporal_OD==1){$odData.= '&nbsp;Temporal&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Inferior_OD==1){$odData.= '&nbsp;Inferior&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Superior_OD==1){$odData.= '&nbsp;Superior&nbsp;' ; ++$c; }
								if($c>=3){ $odData.= '<br>'; $c = 0; }
							if($Hot_Spot_OD==1){$odData.= '&nbsp;Hot Spot&nbsp;'.$Hot_Spot_Val_OD ; ++$c; }
						}

						// OS DATA
						if($Sharp_Pink_OS || $Pale_OS || $Large_Cap_OS || $Sloping_OS || $Notch_OS || $NVD_OS || $Leakage_OS){
							$osData.= 'Disc';
							if($Sharp_Pink_OS == 1){ $osData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
							if($Pale_OS == 1){ $osData.= '&nbsp;Pale&nbsp;'; ++$c;}
							if($Large_Cap_OS == 1){ $osData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
								if($c>=3){ $c = 0; $osData.= '<br>'; $c = 0; }
							if($Sloping_OS == 1){ $osData.= '&nbsp;Sloping&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Notch_OS == 1){ $osData.= '&nbsp;Notch&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($NVD_OS == 1){ $osData.= '&nbsp;NVD&nbsp;'; ++$c;}
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Leakage_OS == 1) $osData.= '&nbsp;Leakage&nbsp;';
						}
						if($Retina_Hemorrhage_OS || $Retina_Microaneurysms_OS || $Retina_Exudates_OS || $Retina_Laser_Scars_OS
							|| $Retina_NEVI_OS || $Retina_SRVNM_OS || $Retina_Edema_OS
							|| $Retina_BDR_OS_T || $Retina_BDR_OS_1 || $Retina_BDR_OS_2 || $Retina_BDR_OS_3 || $Retina_BDR_OS_4
							|| $Retina_Druse_OS_T || $Retina_Druse_OS_1 || $Retina_Druse_OS_2 || $Retina_Druse_OS_3 || $Retina_Druse_OS_4
							|| $Retina_RPE_Change_OS_T || $Retina_RPE_Change_OS_1 || $Retina_RPE_Change_OS_2 || $Retina_RPE_Change_OS_3 || $Retina_RPE_Change_OS_4
							|| $Retina_Ischemia_OS ||$Retina_BRVO_OS || $Retina_CRVO_OS || $Retina_Nevus_OS ){
							$osData.= '<br>Retina';
						}
						if($Retina_Hemorrhage_OS || $Retina_Microaneurysms_OS || $Retina_Exudates_OS || $Retina_Laser_Scars_OS || $Retina_NEVI_OS || $Retina_SRVNM_OS || $Retina_Edema_OS || $Retina_Nevus_OS || $Retina_Ischemia_OS ||$Retina_BRVO_OS || $Retina_CRVO_OS ){
							$c = 0;
							if($Retina_Hemorrhage_OS == 1){ $osData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
							if($Retina_Microaneurysms_OS == 1){ $osData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
							if($Retina_Exudates_OS == 1){ $osData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Laser_Scars_OS == 1){ $osData.= '&nbsp;Laser Scars&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_NEVI_OS == 1){ $osData.= '&nbsp;NVE&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_SRVNM_OS == 1){ $osData.= '&nbsp;SRVNM&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Edema_OS == 1){ $osData.= '&nbsp;Edema&nbsp;' ; ++$c; }
							if($Retina_Nevus_OS == 1){ $osData.= '&nbsp;Nevus&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_Ischemia_OS== 1){$osData.= '&nbsp;Ischemia&nbsp;' ;	++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_BRVO_OS==1){		$osData.= '&nbsp;BRVO&nbsp;' ;	++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Retina_CRVO_OS==1){		$osData.= '&nbsp;CRVO&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

						}
						if($Retina_BDR_OS_T || $Retina_BDR_OS_1 || $Retina_BDR_OS_2 || $Retina_BDR_OS_3 || $Retina_BDR_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;BDR';
							if($Retina_BDR_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_BDR_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_BDR_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_BDR_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_BDR_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_Druse_OS_T || $Retina_Druse_OS_1 || $Retina_Druse_OS_2 || $Retina_Druse_OS_3 || $Retina_Druse_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;Drusen';
							if($Retina_Druse_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_Druse_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_Druse_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_Druse_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_Druse_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Retina_RPE_Change_OS_T || $Retina_RPE_Change_OS_1 || $Retina_RPE_Change_OS_2 || $Retina_RPE_Change_OS_3 || $Retina_RPE_Change_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;RPE&nbsp;Change';
							if($Retina_RPE_Change_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Retina_RPE_Change_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Retina_RPE_Change_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Retina_RPE_Change_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Retina_RPE_Change_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Druse_OS || $RPE_Changes_OS || $SRNVM_OS || $Edema_OS || $Scars_OS || $Hemorrhage_OS || $Microaneurysms_OS || $Exudates_OS
							|| $Macula_BDR_OS_T || $Macula_BDR_OS_1 || $Macula_BDR_OS_2 || $Macula_BDR_OS_3 || $Macula_BDR_OS_4
							|| $Macula_SMD_OS_T || $Macula_SMD_OS_1 || $Macula_SMD_OS_2 || $Macula_SMD_OS_3 || $Macula_SMD_OS_4||
								$PED_OS || $SR_Heme_OS || $Classic_CNV_OS || $Occult_CNV_OS){
								$osData.= '<br>Macula';
						}
						if($Druse_OS || $RPE_Changes_OS || $SRNVM_OS || $Edema_OS || $Scars_OS || $Hemorrhage_OS || $Microaneurysms_OS || $Exudates_OS||
							$PED_OS || $SR_Heme_OS || $Classic_CNV_OS || $Occult_CNV_OS ){
							$c = 0;
							if($Druse_OS == 1){ $osData.= '&nbsp;Drusen&nbsp;' ; ++$c; }
							if($RPE_Changes_OS == 1){ $osData.= '&nbsp;RPE Changes&nbsp;' ; ++$c; }
							if($SRNVM_OS == 1){ $osData.= '&nbsp;SRNVM&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Edema_OS == 1){ $osData.= '&nbsp;Edema&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

							if($Scars_OS == 1){ $osData.= '&nbsp;Scars&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Hemorrhage_OS == 1){ $osData.= '&nbsp;Hemorrhage&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Microaneurysms_OS == 1){ $osData.= '&nbsp;Microaneurysms&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Exudates_OS == 1){ $osData.= '&nbsp;Exudates&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

							if($PED_OS == 1){ $osData.= '&nbsp;PED&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }

							if($SR_Heme_OS==1){		$osData.= '&nbsp;SR Heme&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Classic_CNV_OS==1){		$osData.= '&nbsp;Classic CNV&nbsp;' ;++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Occult_CNV_OS==1){		$osData.= '&nbsp;Occult CNV&nbsp;' ; ++$c; }

						}
						if($Macula_BDR_OS_T || $Macula_BDR_OS_1 || $Macula_BDR_OS_2 || $Macula_BDR_OS_3 || $Macula_BDR_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;BDR';
							if($Macula_BDR_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Macula_BDR_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Macula_BDR_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Macula_BDR_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Macula_BDR_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Macula_SMD_OS_T || $Macula_SMD_OS_1 || $Macula_SMD_OS_2 || $Macula_SMD_OS_3 || $Macula_SMD_OS_4){
							$osData.= '<br>';
							$osData.= '&nbsp;SMD';
							if($Macula_SMD_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
							if($Macula_SMD_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
							if($Macula_SMD_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
							if($Macula_SMD_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
							if($Macula_SMD_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						}
						if($Feeder_Vessel_OS || $Central_OS || $Nasal_OS || $Temporal_OS || $Inferior_OS || $Superior_OS || $Hot_Spot_OS){
							$osData.= '<br>';
							if($Feeder_Vessel_OS==1){$osData.= '&nbsp;Feeder  Vessel&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Central_OS==1){$osData.= '&nbsp;Central&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Nasal_OS==1){$osData.= '&nbsp;Nasal&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Temporal_OS==1){$osData.= '&nbsp;Temporal&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Inferior_OS==1){$osData.= '&nbsp;Inferior&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Superior_OS==1){$osData.= '&nbsp;Superior&nbsp;' ; ++$c; }
								if($c>=3){ $osData.= '<br>'; $c = 0; }
							if($Hot_Spot_OS==1){$osData.= '&nbsp;Hot Spot&nbsp;'.$Hot_Spot_Val_OD ; ++$c; }
						}

						if($osData!="" || $odData!="" || $testresults_desc_od!="" || $testresults_desc_os!=""){
							?>

							<tr>
								<td class="tb_subheading paddingTop10" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:350px" class="paddingTop10" ><?php $this->odLable();?></td>
								<td style="width:350px" class="paddingTop10" ><?php $this->osLable();?></td>
							</tr>
						<?php
							if($odData || $osData){
							?>
							<tr>
								<td style="width:350px" class="paddingTop10" ><?php echo  $odData; ?></td>
								<td style="width:350px" class="paddingTop10" ><?php echo  $osData; ?></td>
							</tr>
						<?php
							}
						if($testresults_desc_od || $testresults_desc_os){
							?>
								<tr>
									<td style="width:350px" class="paddingTop10" ><?php echo $testresults_desc_od; ?></td>
									<td style="width:350px" class="paddingTop10" ><?php echo $testresults_desc_os; ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}

						$treatment = '';

				if($Stable == 1) $treatment.= 'Stable&nbsp;';
				if($ContinueMeds == 1) $treatment.= 'Continue Meds&nbsp;';
				if($FuApa == 1) $treatment.= 'F/U APA&nbsp;';
				if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
				if($PatientInformed == 1) $treatment.= 'Pt informed of results&nbsp;';
				if($MonitorAg  == 1) $treatment.= 'Monitor AG&nbsp;';
				if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';

						if($stable == 1 || $treatment!=""){
							?>
								<tr>
									<td style="width:700px" colspan="2"  class="paddingTop10" ><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
								</tr>
							<?php
						}
						if($ArgonLaser || $ArgonLaserEye || $ArgonLaserEyeOptions || $FuRetinaComments)
						{
							if($ArgonLaser){
							$ArgonLaser = 'Argon Laser Surgery&nbsp;&nbsp;';
							if($ArgonLaserEye) $ArgonLaser.= ''.$ArgonLaserEye.'&nbsp;&nbsp;';
							if($ArgonLaserEyeOptions) $ArgonLaser.= $ArgonLaserEyeOptions.'&nbsp;&nbsp;';
							}else{
								$ArgonLaser = "";
							}
							if($FuRetina == 1) $ArgonLaser.= 'F/U Retina &nbsp;';
							if($FuRetinaComments){
							$ArgonLaser.=$FuRetinaComments;
							}
							if($rptTst1yr==1){$ArgonLaser.= '&nbsp;&nbsp;Repeat test 1 year ';}
							?>

								<tr >
									<td style="width:700px;" colspan="2" class="paddingTop10" >
										<?php echo $ArgonLaser; ?>
									</td>
								</tr>

							<?php
						}

						if($icgComments !=""){
							?>

								<tr>
									<td style="width:700px;" colspan="2" class="paddingTop10"><strong>Comments:</strong><?php echo $icgComments; ?></td>

								</tr>

							<?php
						}

						///Add IVFA Images//
						$imagesHtml = $this->getTestImages($icg_id,$sectionImageFrom="ICG",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($icg_id!=""){
							$arrPDFs = $this->getAllTestPdf($icg_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px;" class="paddingTop10"><table >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End IVFA Images
						if($phy){

							$physicianName = $this->print_phyInitial($phy);
							?>

							<tr >
								<td style="width:700px;" colspan="2" class="paddingTop10"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
							</tr>

							<?php
						}
						?>
					</table>
			<?php
			}//END ICG WHILE
		}
		/*else{ ?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" >ICG</td>
				</tr>
				<tr>
					<td>No Data</td>
				</tr>
		</table>
	<?php
	}*/

	}

	public function print_external($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM disc_external WHERE patientId = '".$patient_id."' AND disc_id in(".implode(",",$req).")";
		}else if($form_id){
			$sql = "SELECT * FROM disc_external WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ";
		}
		$rowexternal = imw_query($sql);
		if(imw_num_rows($rowexternal)>0){
			while($row=imw_fetch_array($rowexternal)){
			extract($row);
			?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2" height="2"></td>
					</tr>
					<tr>
						<td colspan="2" class="bluehed text_cap paddingTop10">EXTERNAL(<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
					</tr>
					<tr>
						<td colspan="2" class="paddingTop10" style="width:700px;" >
							<?php
							if($fundusDiscPhoto == 1){
								echo 'ES (External)&nbsp;';
							}
							if($fundusDiscPhoto == 2){
								echo 'ASP (Anterior Segment Photos)&nbsp;';
							}
							?>
							<?php
							if($photoEye){

								if($photoEye == 'OD') $photoEyeEXT = '<span style="color:blue;">'.$photoEye.'</span>';
								if($photoEye == 'OS') $photoEyeEXT = '<span style="color:green;">'.$photoEye.'</span>';
								if($photoEye == 'OU') $photoEyeEXT = '<span style="color:purple;">'.$photoEye.'</span>';
								echo ''.$photoEyeEXT.'';
							}
							?>
						</td>
					</tr>

				<?php
				if($discDesc){
				?>

					<tr>
						<td colspan="2" class="paddingTop10" style="width:700px;" ><span class="text_lable">Technician Comments:&nbsp;</span><?php echo $discDesc; ?></td>
					</tr>

				<?php
				}

				?>
				<?php

					$performedBy = $this->print_phyInitial($performedBy);
				?>

					<tr>
					   <td colspan="2" class="paddingTop10" style="width:700px;" >
						<?php
							if($performedBy) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performedBy.'&nbsp;&nbsp;';
							if($ptUnderstanding) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$ptUnderstanding;
						?>
					  </td>
					</tr>

				<?php
				if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
				if($diagnosis && $diagnosis!="--Select--"){
				?>

							<tr>
								<td colspan="2" class="paddingTop10" style="width:700px;" ><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
							</tr>

				<?php
				}
				if($reliabilityOd || $reliabilityOs){
				?>
					<tr>
					<td colspan="2" style="width:700px;">
						<table style="width:700px;" cellpadding="0" cellspacing="0" >
							<tr>
								<td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
								<td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
								<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
								<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOd; ?></td>

								<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
								<td style="width:150px;" class="text_value"><?php echo $reliabilityOs; ?></td>
							</tr>
						</table>
					</td>
				 </tr>
				<?php
				}
				$osData = '';
				$odData = '';
				// OD DATA
				$odData.= 'Ptosis';
				if($ptosisOd_neg == 1) $odData.= '&nbsp;Negative&nbsp;';
				if($ptosisOd_T == 1) $odData.= '&nbsp;T&nbsp;';
				if($ptosisOd_pos1 == 1) $odData.= '&nbsp;+1&nbsp;';
				if($ptosisOd_pos2 == 1) $odData.= '&nbsp;+2&nbsp;';
				if($ptosisOd_pos3 == 1) $odData.= '&nbsp;+3&nbsp;';
				if($ptosisOd_pos4 == 1) $odData.= '&nbsp;+4&nbsp;';
				if($ptosisOd_rul == 1) $odData.= '&nbsp;+RUL&nbsp;';
				if($ptosisOd_rll == 1) $odData.= '&nbsp;+RLL&nbsp;';

				$odData.= '<br>';
				$odData.= 'Dematochalasis';
				if($dermaOd_neg == 1) $odData.= '&nbsp;Negative&nbsp;';
				if($dermaOd_T == 1) $odData.= '&nbsp;+1&nbsp;';
				if($dermaOd_pos1 == 1) $odData.= '&nbsp;+1&nbsp;';
				if($dermaOd_pos2 == 1) $odData.= '&nbsp;+2&nbsp;';
				if($dermaOd_pos3 == 1) $odData.= '&nbsp;+3&nbsp;';
				if($dermaOd_pos4 == 1) $odData.= '&nbsp;+4&nbsp;';
				if($dermaOd_rul == 1) $odData.= '&nbsp;+RUL&nbsp;';
				if($dermaOd_rll == 1) $odData.= '&nbsp;+RLL&nbsp;';

				$odData.= '<br>';
				$odData.= 'Pterygium';
				if($pterygium1mmOd == 1) $odData.= '&nbsp;1mm&nbsp;';
				if($pterygium2mmOd == 1) $odData.= '&nbsp;2mm&nbsp;';
				if($pterygium3mmOd == 1) $odData.= '&nbsp;3mm&nbsp;';
				if($pterygium4mmOd == 1) $odData.= '&nbsp;4mm&nbsp;';
				if($pterygium5mmOd == 1) $odData.= '&nbsp;5mm&nbsp;';
				if($pterygiumNasalOd == 1) $odData.= '&nbsp;Nasal&nbsp;';
				if($pterygiumTemporalOd == 1) $odData.= '&nbsp;Temporal&nbsp;';

				$odData.= '<br>';
				$odData.= 'Vascularization';
				if($vascOd_SubEpithelial == 1) $odData.= '&nbsp;Sub-epithelial&nbsp;';
				if($vascOd_Stromal == 1) $odData.= '&nbsp;Stromal&nbsp;';
				if($vascOd_Superficial == 1) $odData.= '&nbsp;Superficial&nbsp;';
				if($vascOd_Deep == 1) $odData.= '&nbsp;Deep&nbsp;';
				if($vascOd_Endothelial == 1) $odData.= '&nbsp;<br>Endothelial&nbsp;';
				if($vascOd_Peripheral == 1) $odData.= '&nbsp;<br>Peripheral&nbsp;';
				if($vascOd_Central == 1) $odData.= '&nbsp;Central&nbsp;<br>';
				if($vascOd_Pannus == 1) $odData.= '&nbsp;Pannus&nbsp;';
				if($vascOd_GhostBV == 1) $odData.= '&nbsp;Ghost BV&nbsp;';
				if($vascOd_Superior == 1) $odData.= '&nbsp;<br>Superior&nbsp;';
				if($vascOd_Inferior == 1) $odData.= '&nbsp;Inferior&nbsp;<br>';
				if($vascOd_Nasal == 1) $odData.= '&nbsp;Nasal&nbsp;';
				if($vascOd_Temporal  == 1) $odData.= '&nbsp;Temporal&nbsp;';

				$odData.= '<br>';
				$odData.= 'Nevus';
				if($NevusOd_neg == 1) $odData.= '&nbsp;Negative&nbsp;';
				if($NevusOd_Pos == 1) $odData.= '&nbsp;Positive&nbsp;';
				if($NevusOd_Inferior == 1) $odData.= '&nbsp;<br>Inferior&nbsp;';
				if($NevusOd_Superior == 1) $odData.= '&nbsp;Superior&nbsp;<br>';
				if($NevusOd_Temporal == 1) $odData.= '&nbsp;Temporal&nbsp;';
				if($NevusOd_Nasal == 1) $odData.= '&nbsp;Nasal&nbsp;';


				// OS DATA
				$osData = 'Ptosis';
				if($ptosisOs_neg == 1) $osData.= '&nbsp;Negative&nbsp;';
				if($ptosisOs_T == 1) $osData.= '&nbsp;T&nbsp;';
				if($ptosisOs_pos1 == 1) $osData.= '&nbsp;+1&nbsp;';
				if($ptosisOs_pos2 == 1) $osData.= '&nbsp;+2&nbsp;';
				if($ptosisOs_pos3 == 1) $osData.= '&nbsp;+3&nbsp;';
				if($ptosisOs_pos4 == 1) $oData.= '&nbsp;+4&nbsp;';
				if($ptosisOs_rul == 1) $osData.= '&nbsp;+RUL&nbsp;';
				if($ptosisOs_rll == 1) $osData.= '&nbsp;+RLL&nbsp;';

				$osData.= '<br>';
				$osData.= 'Dematochalasis';
				if($dermaOs_neg == 1) $osData.= '&nbsp;Negative&nbsp;';
				if($dermaOs_T == 1) $osData.= '&nbsp;+1&nbsp;';
				if($dermaOs_pos1 == 1) $osData.= '&nbsp;+1&nbsp;';
				if($dermaOs_pos2 == 1) $osData.= '&nbsp;+2&nbsp;';
				if($dermaOs_pos3 == 1) $osData.= '&nbsp;+3&nbsp;';
				if($dermaOs_pos4 == 1) $osData.= '&nbsp;+4&nbsp;';
				if($dermaOs_rul == 1) $osData.= '&nbsp;+RUL&nbsp;';
				if($dermaOs_rll == 1) $osData.= '&nbsp;+RLL&nbsp;';

				$osData.= '<br>';
				$osData.= 'Pterygium';
				if($pterygium1mmOs == 1) $osData.= '&nbsp;1mm&nbsp;';
				if($pterygium2mmOs == 1) $osData.= '&nbsp;2mm&nbsp;';
				if($pterygium3mmOs == 1) $osData.= '&nbsp;3mm&nbsp;';
				if($pterygium4mmOs == 1) $osData.= '&nbsp;4mm&nbsp;';
				if($pterygium5mmOs == 1) $osData.= '&nbsp;5mm&nbsp;';
				if($pterygiumNasalOs == 1) $osData.= '&nbsp;Nasal&nbsp;';
				if($pterygiumTemporalOs == 1) $osData.= '&nbsp;Temporal&nbsp;';

				$osData.= '<br>';
				$osData.= 'Vascularization';
				if($vascOs_SubEpithelial == 1) $osData.= '&nbsp;Sub-epithelial&nbsp;';
				if($vascOs_Stromal == 1) $osData.= '&nbsp;Stromal&nbsp;';
				if($vascOs_Superficial == 1) $osData.= '&nbsp;Superficial&nbsp;';
				if($vascOs_Deep == 1) $osData.= '&nbsp;Deep&nbsp;';
				if($vascOs_Endothelial == 1) $osData.= '&nbsp;<br>Endothelial&nbsp;';
				if($vascOs_Peripheral == 1) $osData.= '&nbsp;<br>Peripheral&nbsp;';
				if($vascOs_Central == 1) $osData.= '&nbsp;Central&nbsp;<br>';
				if($vascOs_Pannus == 1) $osData.= '&nbsp;Pannus&nbsp;';
				if($vascOs_GhostBV == 1) $osData.= 'Ghost BV&nbsp;';
				if($vascOs_Superior == 1) $osData.= '&nbsp;<br>Superior&nbsp;';
				if($vascOs_Inferior == 1) $osData.= '&nbsp;Inferior&nbsp;<br>';
				if($vascOs_Nasal == 1) $osData.= '&nbsp;Nasal&nbsp;';
				if($vascOs_Temporal  == 1) $osData.= '&nbsp;Temporal&nbsp;';

				$osData.= '<br>';
				$osData.= 'Nevus';
				if($irisNevusOs_neg == 1) {$osData.= '&nbsp;Negative&nbsp;';}
				if($irisNevusOs_Pos == 1) $osData.= '&nbsp;Positive&nbsp;';
				if($irisNevusOs_Inferior == 1) $osData.= '&nbsp;<br>Inferior &nbsp;';
				if($irisNevusOs_Superior == 1) $osData.= '&nbsp;Superior &nbsp;<br>';
				if($irisNevusOs_Temporal == 1) $osData.= '&nbsp;Temporal &nbsp;';
				if($irisNevusOs_Nasal == 1) {$osData.= '&nbsp; Nasal &nbsp;';}

				if($osData!="" || $odData!=""  || $resDescOd!="" || $resDescOs!=""){
							?>

							<tr>
								<td  class="paddingTop10 tb_subheading" colspan="2">Test Results</td>
							</tr>
							<tr>
								<td style="width:350px" class="paddingTop10" ><?php $this->odLable();?></td>
								<td style="width:350px" class="paddingTop10"><?php $this->osLable();?></td>
							</tr>
						<?php


							if($odData!="" || $osData!=""){
							?>
							<tr>
								<td style="width:350px" class="paddingTop10"><?php echo  $odData; ?></td>
								<td style="width:350px" class="paddingTop10"><?php echo  $osData; ?></td>
							</tr>

						<?php
							}
						if($resDescOd!="" || $resDescOs!=""){
							?>
								<tr>
									<td style="width:350px" class="paddingTop10"><span class="text_lable">Description:&nbsp;</span><?php echo htmlentities($resDescOd); ?></td>
									<td style="width:350px" class="paddingTop10"><span class="text_lable">Description:&nbsp;</span><?php echo htmlentities($resDescOs); ?></td>
								</tr>
							<?php
						}
						?>

							<?php
						}


				$treatment = '';
				if($stable == 1) $treatment.= 'Stable&nbsp;';
				if($monitorAg == 1) $treatment.= 'Continue Meds&nbsp;';
				if($fuApa == 1) $treatment.= 'F/U APA&nbsp;';
				if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
				if($ptInformed == 1) $treatment.= 'Pt informed of results&nbsp;';
				if($contiMeds == 1) $treatment.= 'Monitor AG&nbsp;';
				if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';

				if($fuRetina == 1) $treatment.= 'F/U Retina&nbsp;'.$fuRetinaDesc.' &nbsp;&nbsp;';
				if($treatment!="" || $fuRetinaDesc!=""){
				?>

					<?php
					if($treatment!=""){
					?>
					<tr>
						<td colspan="2" style="width:700px" class="paddingTop10"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
					</tr>

					<?php
					}
					if($discComments){
					?>
					<tr>
						<td colspan="2" style="width:700px" class="paddingTop10"><?php echo "<span class='text_lable'>Comments:</span>".htmlentities($discComments); ?></td>
					</tr>
					<?php
					}
					?>

					<?php
				}

				///Add discExternal Images//
				$imagesHtml=$this->getTestImages($disc_id,$sectionImageFrom="discExternal",$patient_id);

				//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
				$arr_alternative_images=array();
				$str_alternative_images='';
				if($disc_id!=""){
					$arrPDFs = $this->getAllTestPdf($disc_id);
					$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
					$imagesHtml.=$str_alternative_images;
				}
				//------------------------------------

				if($imagesHtml!=""){
					echo('<tr><td colspan="2" class="paddingTop10" style="width:700px;" ><table style="width:700px;">
							'.$imagesHtml.'
						</table></td></tr>');
				}
				$imagesHtml="";
				//End discExternal Images

				if($phyName){
					$physicianName = $this->print_phyInitial($phyName);
					?>

						<tr >
							<td style="width:700px;" class="paddingTop10" colspan="2"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
						</tr>

					<?php
				}
		?>
		</table>
		<?php
		}//end External While
	 }/* else{ ?>
	<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10">EXTERNAL</td>
				</tr>
				<tr>
					<td>No Data</td>
				</tr>
		   </table>
	<?php
	} */

	}

	public function print_disc($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM disc WHERE patientId = '".$patient_id."' AND disc_id in(".implode(",",$req).")";
		}else if($form_id){
				$sql = "SELECT * FROM disc WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ";
		}
		$rowDISC = imw_query($sql);
		if(imw_num_rows($rowDISC)>0){
			while($row=imw_fetch_array($rowDISC)){
		extract($row);
		?>

			<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td colspan="2" height="2"></td>
				</tr>
				<tr>
					<td colspan="2" class="bluehed text_cap paddingTop10">FUNDUS (<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)</td>
				</tr>
					<tr>
						<td colspan="2" class="paddingTop10 text_lable" style="width:700px;">
							<?php
							if($fundusDiscPhoto == 1){
								echo 'Disc Photo&nbsp;';
							}
							if($fundusDiscPhoto == 2){
								echo 'Macula Photo&nbsp;';
							}
							if($fundusDiscPhoto == 3){
								echo 'Retina Photo&nbsp;';
							}
							if($shots == 1){
								echo 'Early and late shots&nbsp;';
							}
							if($extraCopy == 1){
								echo 'Extra Copy';
							}
							?>&nbsp;
							<?php
							if($photoEye){
								if($photoEye == 'OD') $photoEye = '<span class="text_lable" style="color:blue;">'.$photoEye.'</span>';
								if($photoEye == 'OS') $photoEye = '<span class="text_lable"  style="color:green;">'.$photoEye.'</span>';
								if($photoEye == 'OU') $photoEye = '<span class="text_lable" style="color:purple;">'.$photoEye.'</span>';
								echo ''.$photoEye.'';
							}
							?>
						</td>
					</tr>
					<?php
						$performedBy = $this->print_phyInitial($performedBy);
		if($discDesc!=""){
					?>

					<tr>
						<td colspan="2" class="paddingTop10" style="width:740px;"><b>Technician Comments:</b>&nbsp;<?php echo($discDesc);?></td>
					</tr>
				<?php } ?>

				<tr>
				   <td colspan="2" class="paddingTop10" style="width:740px;">
					<?php
						if($performedBy) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performedBy.'&nbsp;&nbsp;';
						if($ptUnderstanding) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$ptUnderstanding;
						if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
						if(!empty($diagnosis) && $diagnosis!="--Select--") echo '&nbsp;&nbsp;<span class="text_lable">Diagnosis</span>:&nbsp;'.$diagnosis;
					?>
				</td>
			</tr>

		<?php
					if($reliabilityOd || $reliabilityOs){
						?>
                        <tr>
                        <td colspan="2" style="width:700px;">
					<table style="width:700px;" cellpadding="0" cellspacing="0" >
						<tr>
							<td style="width:180px;" class="bdrbrm text_lable">Physician Interpretation:&nbsp;</td>
							<td style="width:80xp;"  class="paddingTop10 text_lable">Reliability</td>
							<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
							<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOd; ?></td>
							<td style="width:40px;"  class="paddingTop10 text_lable"><?php $this->osLable();?></td>
							<td style="width:150px;"  class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
						</tr>
					</table>
						</td>
                        </tr>
						<?php
					}


					$osData = '';
					$odData = '';

					// OD DATA
					if($normal_OD) $odData = 'Normal&nbsp;<br>';
					if($Sharp_Pink_OD || $Pale_OD || $Large_Cap_OD || $Sloping_OD || $Notch_OD || $NVD_OD || $Leakage_OD){
						$odData.= 'Disc';
						if($Sharp_Pink_OD == 1){ $odData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
						if($Pale_OD == 1){ $odData.= '&nbsp;Pale&nbsp;'; ++$c;}
						if($Large_Cap_OD == 1){ $odData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
							if($c>=3){ $c = 0; $odData.= '<br>'; $c = 0; }
						if($Sloping_OD == 1){ $odData.= '&nbsp;Sloping&nbsp;'; ++$c;}
							if($c>=3){ $odData.= '<br>'; $c = 0; }
						if($Notch_OD == 1){ $odData.= '&nbsp;Notch&nbsp;'; ++$c;}
							if($c>=3){ $odData.= '<br>'; $c = 0; }
						if($NVD_OD == 1){ $odData.= '&nbsp;NVD&nbsp;'; ++$c;}
							if($c>=3){ $odData.= '<br>'; $c = 0; }
						if($Leakage_OD == 1) $odData.= '&nbsp;Leakage&nbsp;';
					}
					if($Macula_BDR_OD_T || $Macula_BDR_OD_1 || $Macula_BDR_OD_2 || $Macula_BDR_OD_3 ||$Macula_BDR_OD_4){
						$odData.= '<br>Macula ';
						$odData.= 'BDR ';
						if($Macula_BDR_OD_T == 1) $odData.= '&nbsp;T&nbsp; ';
						if($Macula_BDR_OD_1 == 1) $odData.= '&nbsp;+1&nbsp; ';
						if($Macula_BDR_OD_2 == 1) $odData.= '&nbsp;+2&nbsp; ';
						if($Macula_BDR_OD_3 == 1) $odData.= '&nbsp;+3&nbsp; ';
						if($Macula_BDR_OD_4 == 1) $odData.= '&nbsp;+4&nbsp; ';
					}
					if($Macula_Rpe_OD_T || $Macula_Rpe_OD_1 || $Macula_Rpe_OD_2 || $Macula_Rpe_OD_3 ||$Macula_Rpe_OD_4){
						$odData.= '<br>';
						$odData.= 'Rpe&nbsp;change';
						if($Macula_Rpe_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
						if($Macula_Rpe_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
						if($Macula_Rpe_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
						if($Macula_Rpe_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
						if($Macula_Rpe_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
					}
					if($Macula_Edema_OD_T || $Macula_Edema_OD_1 || $Macula_Edema_OD_2 || $Macula_Edema_OD_3 ||$Macula_Edema_OD_4){
						$odData.= '<br>';
						$odData.= 'Edema';
						if($Macula_Edema_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
						if($Macula_Edema_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
						if($Macula_Edema_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
						if($Macula_Edema_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
						if($Macula_Edema_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
					}
					$arrTmp = array("T","1","2","3","4");
					foreach($arrTmp as $key => $val){
						$tmp = $val;
						$tmpId_od = "Macula_Drusen_OD_".$tmp;
						$tmpId_os = "Macula_Drusen_OS_".$tmp;
						$$tmpId_od = "0";
						$$tmpId_os = "0";
						if(!empty($maculaOd_drusen) && strpos($maculaOd_drusen,$tmp) !== false){
							$$tmpId_od = "1";
						}
						if(!empty($maculaOs_drusen) && strpos($maculaOs_drusen,$tmp) !== false){
							$$tmpId_os = "1";
						}
					}
					if($Macula_Drusen_OD_T || $Macula_Drusen_OD_1 || $Macula_Drusen_OD_2 || $Macula_Drusen_OD_3 ||$Macula_Drusen_OD_4 ||
						$Macula_SRNVM_OD || $Macula_Scars_OD || $Macula_Hemorrhage_OD || $Macula_Microaneurysm_OD || $Macula_Exudates_OD || $Macula_Normal_OD){
						$odData.= '<br>';
						$odData.= 'Drusen';
						if($Macula_Drusen_OD_T == 1) $odData.= '&nbsp;T&nbsp;';
						if($Macula_Drusen_OD_1 == 1) $odData.= '&nbsp;+1&nbsp;';
						if($Macula_Drusen_OD_2 == 1) $odData.= '&nbsp;+2&nbsp;';
						if($Macula_Drusen_OD_3 == 1) $odData.= '&nbsp;+3&nbsp;';
						if($Macula_Drusen_OD_4 == 1) $odData.= '&nbsp;+4&nbsp;';
						$odData.= "<br/>";
						if($Macula_SRNVM_OD == 1) $odData.= '&nbsp;SRNVM&nbsp; ';
						if($Macula_Scars_OD == 1) $odData.= '&nbsp;Scars&nbsp; ';
						if($Macula_Hemorrhage_OD == 1) $odData.= '&nbsp;hemorrhage&nbsp; ';
						$odData.= "<br/>";
						if($Macula_Microaneurysm_OD == 1) $odData.= '&nbsp;Microaneurysm&nbsp; ';
						if($Macula_Exudates_OD == 1) $odData.= '&nbsp;Exudates&nbsp; ';
						if($Macula_Normal_OD == 1) $odData.= '&nbsp;Normal&nbsp; ';
					}

					if($Periphery_Hemorrhage_OD || $Periphery_Microaneurysms_OD || $Periphery_Exudates_OD ||
						$Periphery_Cr_Scars_OD || $Periphery_NV_OD || $Periphery_Nevus_OD || $Periphery_Edema_OD){
						$odData.= '<br>';
						$odData.= 'Periphery:&nbsp;';
						if($Periphery_Hemorrhage_OD == 1) $odData.= '&nbsp;Hemorrhage&nbsp; ';
						if($Periphery_Microaneurysms_OD == 1) $odData.= '&nbsp;Microaneurysm&nbsp; ';
						if($Periphery_Exudates_OD == 1) $odData.= '&nbsp;Exudates&nbsp; ';
						$odData.= "<br/>";
						if($Periphery_Cr_Scars_OD == 1) $odData.= '&nbsp;Cr Scars&nbsp; ';
						if($Periphery_NV_OD == 1) $odData.= '&nbsp;NV&nbsp; ';
						if($Periphery_Nevus_OD == 1) $odData.= '&nbsp;Nevus&nbsp; ';
						if($Periphery_Edema_OD == 1) $odData.= '&nbsp;Edema&nbsp; ';
					}



					// OS DATA
					if($normal_OS) $osData = 'Normal&nbsp;<br>';
					if($Sharp_Pink_OS || $Pale_OS || $Large_Cap_OS || $Sloping_OS || $Notch_OS || $NVD_OS || $Leakage_OS){
						$osData.= 'Disc';
						if($Sharp_Pink_OS == 1){ $osData.= '&nbsp;Sharp &amp; Pink&nbsp;' ; ++$c;}
						if($Pale_OS == 1){ $osData.= '&nbsp;Pale&nbsp;'; ++$c;}
						if($Large_Cap_OS == 1){ $osData.= '&nbsp;Large Cup&nbsp;'; ++$c;}
							if($c>=3){ $c = 0; $osData.= ''; $c = 0; }
						if($Sloping_OS == 1){ $osData.= '&nbsp;Sloping&nbsp;'; ++$c;}
							if($c>=3){ $osData.= ''; $c = 0; }
						if($Notch_OS == 1){ $osData.= '&nbsp;Notch&nbsp;'; ++$c;}
							if($c>=3){ $osData.= ''; $c = 0; }
						if($NVD_OS == 1){ $osData.= '&nbsp;NVD&nbsp;'; ++$c;}
							if($c>=3){ $osData.= ''; $c = 0; }
						if($Leakage_OS == 1) $osData.= '&nbsp;Leakage&nbsp;';
					}
					if($Macula_BDR_OS_T || $Macula_BDR_OS_1 || $Macula_BDR_OS_2 || $Macula_BDR_OS_3){
						$osData.= '<br>Macula ';
						$osData.= 'BDR ';
						if($Macula_BDR_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
						if($Macula_BDR_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
						if($Macula_BDR_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
						if($Macula_BDR_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
						if($Macula_BDR_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
					}
					if($Macula_Rpe_OS_T || $Macula_Rpe_OS_1 || $Macula_Rpe_OS_2 || $Macula_Rpe_OS_3 ||$Macula_Rpe_OS_4){
						$osData.= '<br>';
						$osData.= 'Rpe&nbsp;change';
						if($Macula_Rpe_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
						if($Macula_Rpe_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
						if($Macula_Rpe_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
						if($Macula_Rpe_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
						if($Macula_Rpe_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
					}
					if($Macula_Edema_OS_T || $Macula_Edema_OS_1 || $Macula_Edema_OS_2 || $Macula_Edema_OS_3 ||$Macula_Edema_OS_4){
						$osData.= '<br>';
						$osData.= 'Edema';
						if($Macula_Edema_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
						if($Macula_Edema_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
						if($Macula_Edema_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
						if($Macula_Edema_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
						if($Macula_Edema_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
					}

					if($Macula_Drusen_OS_T || $Macula_Drusen_OS_1 || $Macula_Drusen_OS_2 || $Macula_Drusen_OS_3 ||$Macula_Drusen_OS_4 ||
						$Macula_SRNVM_OS || $Macula_Scars_OS || $Macula_Hemorrhage_OS || $Macula_Microaneurysm_OS || $Macula_Exudates_OS || $Macula_Normal_OS){
						$osData.= '<br>';
						$osData.= 'Drusen';
						if($Macula_Drusen_OS_T == 1) $osData.= '&nbsp;T&nbsp;';
						if($Macula_Drusen_OS_1 == 1) $osData.= '&nbsp;+1&nbsp;';
						if($Macula_Drusen_OS_2 == 1) $osData.= '&nbsp;+2&nbsp;';
						if($Macula_Drusen_OS_3 == 1) $osData.= '&nbsp;+3&nbsp;';
						if($Macula_Drusen_OS_4 == 1) $osData.= '&nbsp;+4&nbsp;';
						$osData.= "<br/>";
						if($Macula_SRNVM_OS == 1) $osData.= '&nbsp;SRNVM&nbsp; ';
						if($Macula_Scars_OS == 1) $osData.= '&nbsp;Scars&nbsp; ';
						if($Macula_Hemorrhage_OS == 1) $osData.= '&nbsp;hemorrhage&nbsp; ';
						$osData.= "<br/>";
						if($Macula_Microaneurysm_OS == 1) $osData.= '&nbsp;Microaneurysm&nbsp; ';
						if($Macula_Exudates_OS == 1) $osData.= '&nbsp;Exudates&nbsp; ';
						if($Macula_Normal_OS == 1) $osData.= '&nbsp;Normal&nbsp; ';
					}

					if($Periphery_Hemorrhage_OS || $Periphery_Microaneurysms_OS || $Periphery_Exudates_OS ||
						$Periphery_Cr_Scars_OS || $Periphery_NV_OS || $Periphery_Nevus_OS || $Periphery_Edema_OS){
						$osData.= '<br>';
						$osData.= 'Periphery:&nbsp;';
						if($Periphery_Hemorrhage_OS == 1) $osData.= '&nbsp;Hemorrhage&nbsp; ';
						if($Periphery_Microaneurysms_OS == 1) $osData.= '&nbsp;Microaneurysm&nbsp; ';
						if($Periphery_Exudates_OS == 1) $osData.= '&nbsp;Exudates&nbsp; ';
						$osData.= "<br/>";
						if($Periphery_Cr_Scars_OS == 1) $osData.= '&nbsp;Cr Scars&nbsp; ';
						if($Periphery_NV_OS == 1) $osData.= '&nbsp;NV&nbsp; ';
						if($Periphery_Nevus_OS == 1) $osData.= '&nbsp;Nevus&nbsp; ';
						if($Periphery_Edema_OS == 1) $osData.= '&nbsp;Edema&nbsp; ';
					}




		if($osData!="" || $odData!="" || $cdOd!="" || $cdOs!="" || $resDescOd!="" || $resDescOs!=""){
						?>

						<tr>
							<td class="paddingTop10 tb_subheading" colspan="2">Test Results</td>
						</tr>
						<tr>
							<td style="width:360px;" class="paddingTop10" ><?php $this->odLable();?></td>
							<td style="width:360px;" class="paddingTop10" ><?php $this->osLable();?></td>
						</tr>
					<?php
						if($cdOd!="" || $cdOd!=""){
						?>
						<tr>
							<td style="width:360px;" class="paddingTop10" ><?php echo 'C:D&nbsp;'.$cdOd; ?></td>
							<td style="width:360px;" class="paddingTop10" ><?php echo 'C:D&nbsp;'.$cdOs; ?></td>
						</tr>
					<?php
						}

						if($odData || $osData){
						?>
						<tr>
							<td style="width:360px;" class="paddingTop10" ><?php echo  $odData; ?></td>
							<td style="width:360px;" class="paddingTop10" ><?php echo  $osData; ?></td>
						</tr>

					<?php
						}
					if($resDescOd!="" || $resDescOs!=""){
						?>
							<tr>
								<td style="width:360px;" class="paddingTop10" ><span class="text_lable">Description:&nbsp;</span><?php echo $resDescOd; ?></td>
								<td style="width:360px;" class="paddingTop10" ><span class="text_lable">Description:&nbsp;</span><?php echo $resDescOs; ?></td>
							</tr>
						<?php
					}
					?>

						<?php
					}
					$treatment = '';
					if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
					if($monitorAg == 1) $treatment.= 'Continue Meds&nbsp;';
					if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
					if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
					if($ptInformed == 1) $treatment.= 'Pt informed of results&nbsp;&nbsp;';
					if($contiMeds == 1) $treatment.= 'Monitor AG&nbsp;&nbsp;';
					if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';
					if($fuRetina == 1) $treatment.= 'F/U Retina &nbsp;&nbsp;';
					if($fuRetinaDesc){$treatment.= $fuRetinaDesc;}

					if($treatment!=""){

						?>

							<tr>
								<td colspan="2" style="width:700px;" class="paddingTop10"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
							</tr>
						<?php
						}
						if($discComments){
						?>

                            <tr>
                                <td colspan="2" style="width:700px;" class="paddingTop10"><?php echo "<span class='text_lable'>Comments:</span>".$discComments; ?></td>
                            </tr>
                    <?php
						}
					///Add Disc Images//
					$imagesHtml=$this->getTestImages($disc_id,$sectionImageFrom="disc",$patient_id);

					//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
					$arr_alternative_images=array();
					$str_alternative_images='';
					if($disc_id!=""){
						$arrPDFs = $this->getAllTestPdf($disc_id);
						$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
						$imagesHtml.=$str_alternative_images;
					}
					//------------------------------------

					if($imagesHtml!=""){
						echo('<tr><td colspan="2" style="width:700px;" class="paddingTop10"><table style="width:700px;" >
							 	'.$imagesHtml.'
							</table></td></tr>');
					}
					$imagesHtml="";
					//End Disc Images

					if($phyName){
						$physicianName = $this->print_phyInitial($phyName);
						?>

							<tr >
								<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
							</tr>

						<?php
					}
					?>
                    </table>
				<?php }//End of Fundus While
			}/* else{ ?>
            <table style="width:740px;"  cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
                        </tr>
						<tr>
							<td height="2"></td>
						</tr>
						<tr>
                            <td class="bluehed text_cap paddingTop10">FUNDUS</td>
                        </tr>
                        <tr>
                            <td>No Data</td>
                        </tr>
                   </table>
            <?php
            } */

	}


	public function print_topo($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM topography WHERE patientId = '".$patient_id."' AND topo_id in(".implode(",",$req).")";
		}else if($form_id){
			$sql = "SELECT * FROM topography WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ";
		}
		$rowtopography = imw_query($sql);
		if(imw_num_rows($rowtopography)>0){
			while($row=imw_fetch_array($rowtopography)){
			extract($row);
			?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2" height="2"></td>
					</tr>
					<tr>
						<td colspan="2" class="bluehed text_cap paddingTop10">TOPOGRAPHY
						<span class="text_lable">
							<?php
							if($topoMeterEye){
								if(trim($topoMeterEye) == 'OD') $topoMeterEye = '<span style="color:blue;">'.$topoMeterEye.'</span>';
								if(trim($topoMeterEye) == 'OS') $topoMeterEye = '<span style="color:green;">'.$topoMeterEye.'</span>';
								if(trim($topoMeterEye) == 'OU') $topoMeterEye = '<span style="color:purple;">'.$topoMeterEye.'</span>';
								echo ''.$topoMeterEye.'';
							}
							?>
						</span>
						(<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)
					</td>
					</tr>
				<?php
				if($techComments!=""){
				?>
				<tr>
					<td colspan="2" style="width:740px;" class="paddingTop10">
						<span class="text_lable">Technician Comments:&nbsp;</span><?php echo htmlentities($techComments); ?>
					</td>
				</tr>
				<?php }?>

				<?php
					$performedBy = $this->print_phyInitial($performedBy);
				?>

					<tr>
					   <td colspan="2" style="width:740px;" class="paddingTop10">
						<?php
							if($performedBy) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performedBy.'&nbsp;&nbsp;';
							if($ptUnderstanding) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$ptUnderstanding;
						?>
					  </td>
					</tr>

				<?php
				if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
				if($diagnosis && $diagnosis!="--Select--"){
				?>

							<tr>
								<td colspan="2" style="width:740px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
							</tr>

				<?php
				}
				if($reliabilityOd || $reliabilityOs || $descOd || $descOs){

						if($reliabilityOd || $reliabilityOs){
						?>
						<tr>
							<td colspan="2" style="width:740px;">
								<table style="width:740px;" cellpadding="0" cellspacing="0" >
									<tr>
											<td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
											<td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
											<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
											<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOd; ?></td>
											<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
											<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
								  </tr>
								</table>
							</td>
					   </tr>
					<?php }
					if($descOd || $descOs){
					?>

						<tr>
							<td  class="tb_subheading" colspan="2">Test Results</td>
						</tr>
						<tr>
							<td style="width:350px;" class="paddingTop10"><?php $this->odLable();?></td>
							<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?></td>
						</tr>
						<tr>
							<td style="width:350px;" class="paddingTop10"><?php echo  $descOd; ?></td>
							<td style="width:350px;" class="paddingTop10"><?php echo  $descOs; ?></td>
						</tr>


					<?php }

				}

				$treatment = '';
				if($treat){
					if($treat=="Other" && $treat_other!=""){$treat=$treat_other;}
					$treatment.=$treat."<br>";
				}

				if(!empty($prog)){
					$arrTmp = explode(",",$prog);
					if(in_array("Stable",$arrTmp)){
						$treatment.= 'Stable&nbsp;&nbsp;';
					}
					if(in_array("Progressive",$arrTmp)){
						$treatment.= 'Progressive&nbsp;&nbsp;';
					}
					if(in_array("Repeat Scan",$arrTmp)){
						$treatment.= 'Repeat Scan&nbsp;&nbsp;';
					}
				}

				if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
				if($monitorAg == 1) $treatment.= 'Continue Meds&nbsp;';
				if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
				if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
				if($ptInformed == 1) $treatment.= 'Pt informed of results&nbsp;&nbsp;';
				if($contiMeds == 1) $treatment.= 'Monitor AG&nbsp;&nbsp;';
				if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';

				if($fuRetina == 1) $treatment.= 'F/U Retina &nbsp;&nbsp;';
				if($treatment!=""  || $comments!=""){
				?>


				<?php if($treatment!=""){	?>
					<tr>
						<td style="width:700px;" colspan="2" class="paddingTop10"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
					</tr>
				<?php
					}
					if($comments!=""){
						?>

							<tr>
								<td style="width:700px;" colspan="2" class="paddingTop10"><b>Comments:</b>&nbsp;<?php echo nl2br(htmlentities(wordwrap($comments,95,"\n",true))); ?></td>
							</tr>

						<?php
						}
						?>

				<?php
				}
				///Add Topogrphy Images//
						$imagesHtml = $this->getTestImages($topo_id,$sectionImageFrom="Topogrphy",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($topo_id!=""){
							$arrPDFs = $this->getAllTestPdf($topo_id);
							$str_alternative_images= $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px;" class="paddingTop10"><table style="width:700px;">
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
				//End Topogrphy Images
				if($phyName){
					$physicianName = $this->print_phyInitial($phyName);
					?>

						<tr >
							<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
						</tr>

					<?php
				}
				?>
				</table>
			<?php
			}		//End Of topogroahy while
		}/* else{ ?>
			<table style="width:740px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">TOPOGRAPHY</td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>
		<?php
		} */

	}

	public function print_cellcount($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM test_cellcnt WHERE patientId = '$patient_id' AND test_cellcnt_id in(".implode(",",$req).")";
		}else if($form_id){
			$sql = "SELECT * FROM test_cellcnt WHERE patientId = '$patient_id' AND formId = '$form_id'";
		}
		$rowCellCount= imw_query($sql);
		if(imw_num_rows($rowCellCount)>0){
			while($row=imw_fetch_array($rowCellCount)){
			$test_cellcnt_id= $row["test_cellcnt_id"] ;
			$elem_examDate =get_date_format($row["examDate"]);
			$elem_examTime =  $row["examTime"] ;
			$elem_cellcntEye = $row["test_cellcnt_eye"];
			$elem_performedBy =  $row["performedBy"];
			$elem_ptUnderstanding = $row["ptUnderstanding"];
			$elem_diagnosis = $row["diagnosis"];
			$elem_diagnosisOther = $row["diagnosisOther"];
			$elem_reliabilityOd = $row["reliabilityOd"];
			$elem_reliabilityOs = $row["reliabilityOs"];
			$elem_descOd = stripslashes($row["descOd"]);
			$elem_descOs = stripslashes($row["descOs"]);
			$elem_stable = $row["stable"];
			$elem_fuApa = $row["fuApa"];
			$elem_ptInformed = $row["ptInformed"];
			$elem_physician = $row["phyName"];
			$elem_tech2InformPt=$row["tech2InformPt"];
			$elem_techComments = stripslashes($row["techComments"]);
			$elem_informedPtNv = $row["ptInformedNv"];
			$elem_contiMeds = $row["contiMeds"];
			$encounterId = $row["encounter_id"];
			$elem_opidTestOrdered = $row["ordrby"];
			if(($row["ordrdt"] != "" && $row["ordrdt"] != "0000-00-00")){
				$elem_opidTestOrderedDate = $row["ordrdt"];
			}
			$elem_numOd = $row["numod"];
			$elem_cdOd = $row["cdod"];
			$elem_avgOd = $row["avgod"];
			$elem_sdOd = $row["sdod"];
			$elem_cvOd = $row["cvod"];
			$elem_mxOd = $row["mxod"];
			$elem_mnOd = $row["mnod"];
			$elem_6aOd = $row["e6aod"];
			$elem_cctOd = $row["cctod"];
			$elem_ppOd = $row["ppod"];

			$elem_numOs = $row["numos"];
			$elem_cdOs = $row["cdos"];
			$elem_avgOs = $row["avgos"];
			$elem_sdOs = $row["sdos"];
			$elem_cvOs = $row["cvos"];
			$elem_mxOs = $row["mxos"];
			$elem_mnOs = $row["mnos"];
			$elem_6aOs = $row["e6aos"];
			$elem_cctOs = $row["cctos"];
			$elem_ppOs = $row["ppos"];

	?>
	<table style="width:740px;"  cellpadding="0" cellspacing="0">
		<tr>
			<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="2" height="2"></td>
		</tr>
		<tr>
			<td colspan="2" class="bluehed text_cap paddingTop10">Cell Count (<span class="text_value">Exam Date:&nbsp;<?php print $elem_examDate;?></span>)</td>
		</tr>

	<?php if($elem_techComments!=""){?>
		<tr  >
			<td  colspan="2" class="paddingTop10" style="width:740px;" ><b>Technician Comments:</b><?php echo $elem_techComments; ?></td>
		</tr>
	<?php }?>
		<tr>
			<?php
			if($elem_performedBy){
			?>
			<td style="width:350px;" class="paddingTop10"><b>Performed By:</b>&nbsp;
			<?php
				if($elem_performedBy!=""){
				   $PerformedBy = $this->print_phyInitial($elem_performedBy);
					print($PerformedBy);
				}
			?>
			</td>
			<?php }?>
			<td style="width:350px;" class="paddingTop10"><b>Patient Understanding & Cooperation:</b>&nbsp;
				<?php echo ($elem_ptUnderstanding);?>
			</td>
		</tr>
		<?php
		if($elem_diagnosis=="Other"&&!empty($elem_diagnosisOther)){$elem_diagnosis=$elem_diagnosisOther;}
		?>
		<tr>
			<td style="width:700px;" class="paddingTop10" colspan="2"><?php if($elem_diagnosis!="--Select--"){
							echo("<b>Diagnosis:</b>&nbsp;".$elem_diagnosis);
					}?></td>
		</tr>
		<tr>
			<td class="paddingTop10 text_lable" colspan="2">Physician Interpretation </td>
		</tr>
		<tr>
			<td style="width:350px;" class="paddingTop10">Reliability:&nbsp;<?php $this->odLable();?>&nbsp;
				 <?php echo ($elem_reliabilityOd);?>
			</td>
			<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?>&nbsp;
				 <?php echo ($elem_reliabilityOs);?>
			</td>

		</tr>
		<tr>
			<td colspan="2" style="width:750px;">
				<table style="width:750px;" cellpadding="0" cellspacing="0">
					<tr>
						<td style="width:150px;" class="text_lable paddingTop10">&nbsp;</td>
						<td style="width:285px;" class=" paddingTop10"><?php $this->odLable();?></td>
						<td style="width:285px;" class=" paddingTop10"><?php $this->osLable();?></td>
					</tr>
					<tr>
						<td style="width:150px;" class="text_lable paddingTop10">NUM</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_numOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_numOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">CD</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cdOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cdOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">AVG</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_avgOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_avgOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">SD</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_sdOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_sdOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">CV</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cvOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cvOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">Max</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_mxOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_mxOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">Min</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_mnOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_mnOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">6A</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_6aOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_6aOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">CCT</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cctOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_cctOs;?></td>
					</tr>
					 <tr>
						<td style="width:150px;" class="text_lable paddingTop10">Pleomorphism Present</td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_ppOd;?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_ppOs;?></td>
					</tr>
					<tr>
						<td style="width:150px;" class="paddingTop10">Comments:</td>
						<td style="width:285px;" class="paddingTop10"><?php echo $elem_descOd; ?></td>
						<td style="width:285px;" class=" paddingTop10"><?php echo $elem_descOs;?></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td colspan="2" class="text_lable paddingTop10" >Treatment/Prognosis:</td>
		</tr>
		<tr>
			<td style="width:350px;" class="paddingTop10">
				<?php echo ($elem_stable == "1") ? "Stable" : "" ;?>
				<?php echo ($elem_contiMeds == "1") ? "Continue Meds" : "" ;?>
				 <?php echo ($elem_fuApa == "1") ? "F/U APA" : "" ;?>
			</td>
			<td style="width:350px;" class="paddingTop10">
				<?php echo ($elem_tech2InformPt == "1") ? "Tech to Inform Pt." : "" ;?>
				 <?php echo ($elem_ptInformed == "1") ? "Pt informed of results" : "" ;?>
				 <?php echo ($elem_informedPtNv == "1") ? "Inform Pt result next visit" : "" ;?>
			</td>
		</tr>

	<?php
	///Add CellCount Images//
						$imagesHtml=$this->getTestImages($test_cellcnt_id,$sectionImageFrom="CellCount",$patient_id);
						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px;"><table style="width:700px;">
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
						//End CellCount Images
	if($elem_physician){?>
				<tr>
					<td colspan="2"  class="paddingTop10" ><b>Interpreted By:</b>&nbsp;
						<?php
							if($elem_physician!=""){
								$InterpretedBy = $this->print_phyInitial($elem_physician);
								print($InterpretedBy);
							}
						?>
					</td>
				</tr>

	<?php }?>
	</table>
	<?php
	}

	//end of cellcount while
	?>

	<?php
	}
	}

	public function print_bscan($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM test_bscan WHERE patientId = '".$patient_id."' AND test_bscan_id in(".implode(",",$req).")";
		}else if($form_id){
			$sql = "SELECT * FROM test_bscan WHERE patientId = '".$patient_id."' AND formId = '$form_id' AND purged='0' ";
		}
		$row = imw_query($sql);
		if(imw_num_rows($row)>0){
			while($row=imw_fetch_array($row)){
			extract($row);
			?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2" height="2"></td>
					</tr>
					<tr>
						<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;>B-SCAN
						<span class="text_lable">
							<?php
							if($test_bscan_eye){
								if(trim($test_bscan_eye) == 'OD') $test_bscan_eye = '<span style="color:blue;">'.$test_bscan_eye.'</span>';
								if(trim($test_bscan_eye) == 'OS') $test_bscan_eye = '<span style="color:green;">'.$test_bscan_eye.'</span>';
								if(trim($test_bscan_eye) == 'OU') $test_bscan_eye = '<span style="color:purple;">'.$test_bscan_eye.'</span>';
								echo ''.$test_bscan_eye.'';
							}
							?>
						</span>
						(<span class="text_value">Exam Date:&nbsp;<?php print get_date_format($examDate);?></span>)
					</td>
					</tr>
				<?php
				if($techComments!=""){
				?>
				<tr>
					<td colspan="2" class="paddingTop10" style="width:700px;">
						<span class="text_lable">Technician Comments:&nbsp;</span><?php echo $techComments; ?>
					</td>
				</tr>
				<?php }?>

				<?php
					$performedBy = $this->print_phyInitial($performedBy);
				?>

					<tr>
					   <td colspan="2" style="width:700px;" class="paddingTop10">
						<?php
							if($performedBy) echo '<span class="text_lable">Performed By:&nbsp;</span> '.$performedBy.'&nbsp;&nbsp;';
							if($ptUnderstanding) echo '<span class="text_lable">Patient Understanding & Cooperation</span>:&nbsp;'.$ptUnderstanding;
						?>
					  </td>
					</tr>

				<?php
				if($diagnosis=="Other"&&!empty($diagnosisOther)){$diagnosis=$diagnosisOther;}
				if($diagnosis && $diagnosis!="--Select--"){
				?>

					<tr>
						<td colspan="2" style="width:700px;" class="paddingTop10"><span class="text_lable">Diagnosis:&nbsp;</span> <?php echo ($diagnosis!="--Select--") ? $diagnosis : ""; ?></td>
					</tr>

				<?php
				}
				if($reliabilityOd || $reliabilityOs || $descOd || $descOs){

						if($reliabilityOd || $reliabilityOs){
						?>
					<tr>
						<td colspan="2" style="width:700px;">
							<table style="width:700px;" cellpadding="0" cellspacing="0" >
								<tr>
										<td style="width:180px;" class="paddingTop10 text_lable">Physician Interpretation:&nbsp;</td>
										<td style="width:80px;" class="paddingTop10 text_lable">Reliability</td>
										<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
										<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOd; ?></td>

										<td style="width:40px;" class="paddingTop10 text_lable"><?php $this->osLable();?></td>
										<td style="width:150px;" class="paddingTop10 text_value"><?php echo $reliabilityOs; ?></td>
							  </tr>
							</table>
						</td>
					</tr>
					<?php }
					if($descOd || $descOs){
					?>

						<tr>
							<td  class="tb_subheading paddingTop10" colspan="2">Test Results</td>
						</tr>
						<tr>
							<td style="width:350px;" class="paddingTop10"><?php $this->odLable();?></td>
							<td style="width:350px;" class="paddingTop10"><?php $this->osLable();?></td>
						</tr>
						<tr>
							<td style="width:350px;" class="paddingTop10"><?php echo  $tstod."<br/>".$descOd; ?></td>
							<td style="width:350px;" class="paddingTop10"><?php echo  $tstos."<br/>".$descOs; ?></td>
						</tr>


					<?php }

				}

				$treatment = '';
				if($stable == 1) $treatment.= 'Stable&nbsp;&nbsp;';
				if($contiMeds == 1) $treatment.= 'Continue Meds&nbsp;';
				if($fuApa == 1) $treatment.= 'F/U APA&nbsp;&nbsp;';
				if($tech2InformPt == 1) $treatment.= 'Tech to Inform Pt.&nbsp;';
				if($ptInformed == 1) $treatment.= 'Pt informed of results&nbsp;&nbsp;';
				if($ptInformedNv == 1) $treatment.= 'Inform Pt result next visit&nbsp;';
				if(!empty($treat)) $treatment.= $treat.'&nbsp;';

				if($treatment!=""  || $comments!=""){
				?>

				<?php if($treatment!=""){	?>
					<tr>
						<td colspan="2" class="paddingTop10" style="width:700px;"><b>Treatment/Prognosis:</b>&nbsp;<?php echo $treatment; ?></td>
					</tr>
				<?php
					}
					if($comments!=""){
						?>
							<tr>
								<td colspan="2" class="paddingTop10" style="width:700px;"><b>Comments:</b>&nbsp;<?php echo $comments; ?></td>
							</tr>
						<?php
						}
						?>

				<?php
				}
				///Add bscan Images//
						$imagesHtml = $this->getTestImages($test_bscan_id,$sectionImageFrom="Bscan",$patient_id);

						//GET IMAGES FOR PDFs THAT ARE HIGHER THAN PDF VERSION 1.4 . HIGHER VERSION IMAGES ARE SKIPPED IN merge_pdf.php FILE.
						$arr_alternative_images=array();
						$str_alternative_images='';
						if($test_bscan_id!=""){
							$arrPDFs = $this->getAllTestPdf($test_bscan_id);
							$str_alternative_images = $this->checknMakeImagesHTML($arrPDFs);
							$imagesHtml.=$str_alternative_images;
						}
						//------------------------------------

						if($imagesHtml!=""){
							echo('<tr><td colspan="2" style="width:700px;" class="paddingTop10"><table style="width:700px;" >
									'.$imagesHtml.'
								</table></td></tr>');
						}
						$imagesHtml="";
				//End bscan Images
				if($phyName){
					$physicianName = $this->print_phyInitial($phyName);
					?>
						<tr >
							<td colspan="2" class="paddingTop10" style="width:700px;" ><span class="text_lable">Interpreted By:&nbsp;</span> <?php echo $physicianName; ?></td>
						</tr>

					<?php
				}
				?>
				</table>
				<?php
			}		//End Of bscan while
		}/* else{ ?>
		  <table style="width:740px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">B-SCAN</td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>
		<?php
		} */

	}

	public function print_testother($patient_id=0,$form_id=0,$req=array()){
		if(is_array($req) && count($req)>0){
			$sql = "SELECT * FROM test_other WHERE patientId = '$patient_id' AND test_other_id in(".implode(",",$req).")";
		}else if($form_id){
			$sql = "SELECT * FROM test_other WHERE patientId = '$patient_id' AND formId = '$form_id'";
		}
		$rowCellCount= imw_query($sql);
		if(imw_num_rows($rowCellCount)>0){
			while($row=imw_fetch_array($rowCellCount)){
			$test_other_id=$row["test_other_id"];
			$elem_examDate = ($topo_mode != "new") ? get_date_format($row["examDate"]) : $elem_examDate;
			$elem_examTime = ($topo_mode != "new") ? $row["examTime"] : $elem_examTime ;
			$elem_testOtherName = $row["test_other"];
			$elem_topoMeterEye = $row["test_other_eye"];
			$elem_performedBy = $row["performedBy"];
			$elem_ptUnderstanding = $row["ptUnderstanding"];
			$elem_diagnosis = $row["diagnosis"];
			$elem_diagnosisOther = $row["diagnosisOther"];
			$elem_reliabilityOd = $row["reliabilityOd"];
			$elem_reliabilityOs = $row["reliabilityOs"];
			$elem_descOd = stripslashes($row["descOd"]);
			$elem_descOs = stripslashes($row["descOs"]);
			$elem_inter_pret_od = stripslashes($row["inter_pret_od"]);
			$elem_inter_pret_os = stripslashes($row["inter_pret_os"]);
			$elem_stable = $row["stable"];
			$elem_fuApa = $row["fuApa"];
			$elem_ptInformed = $row["ptInformed"];
			$elem_physician = $row["phyName"] ;
			$elem_tech2InformPt=$row["tech2InformPt"];
			$elem_techComments = stripslashes($row["techComments"]);
			$elem_informedPtNv = $row["ptInformedNv"];
			$elem_contiMeds = $row["contiMeds"];
			$encounterId = $row["encounter_id"];
			$elem_opidTestOrdered = $row["ordrby"];
			if(($row["ordrdt"] != "" && $row["ordrdt"] != "0000-00-00")){
				$elem_opidTestOrderedDate = get_date_format($row["ordrdt"]);
			}

	?>
	<table style="width:750px;"  cellpadding="0" cellspacing="0" >
		<tr>
			<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="3" height="2"></td>
		</tr>
		<tr>
			<td colspan="3" class="bluehed text_cap paddingTop10">Test (<span class="text_value">Exam Date:&nbsp;<?php print $elem_examDate;?></span>)</td>
		</tr>
	<?php if($elem_testOtherName!=""){?>
		<tr  >
			<td colspan="3" style="width:700px;" class="paddingTop10 text_lable"><?php echo $elem_testOtherName."&nbsp;". $elem_topoMeterEye; ?></td>
		</tr>
	<?php }?>
	<?php if($elem_techComments!=""){?>
		<tr  >
			<td colspan="3" style="width:700px;" class="paddingTop10"><b>Technician Comments:&nbsp;</b><?php echo $elem_techComments; ?></td>
		</tr>
	<?php }?>
		<tr>
			<?php
			if($elem_performedBy){
			?>
			<td colspan="2" style="width:400px;" class="paddingTop10"><b>Performed By:&nbsp;</b>
			<?php
				if($elem_performedBy!=""){
					$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '".$elem_performedBy."'");
					$getNameRow = imw_fetch_assoc($getNameQry);
					$PerformedBy = str_replace(", ,"," ",$getNameRow['phyName']);
					print($PerformedBy);
				}
			?>
			</td>
			<?php }?>
			<td style="width:300px;" class="paddingTop10"><b>Patient Understanding & Cooperation:&nbsp;</b>
				<?php echo ($elem_ptUnderstanding);?>
			</td>
		</tr>

		<tr>
			<td style="width:700px;" class="paddingTop10 text_lable" colspan="3"><?php if($elem_diagnosis!="--Select--"){
							echo("Diagnosis:&nbsp;".$elem_diagnosis);
					}?></td>
		</tr>
		<tr>
			<td style="width:700px;" class="paddingTop10 text_lable" colspan="3">Physician Interpretation </td>
		</tr>
		<tr>
			<td style="width:100px;" class="text_label paddingTop10">Reliability</td>
			<td style="width:300px;" class="paddingTop10">&nbsp;<?php $this->odLable();?>
				 &nbsp;<?php echo ($elem_reliabilityOd);?>
			</td>
			<td style="width:300px;" class="paddingTop10"><?php $this->osLable();?>&nbsp;

				 <?php echo ($elem_reliabilityOs);?>
			</td>
		</tr>
		<tr>
			<td style="width:100px;" class="paddingTop10">&nbsp;</td>
			<td style="width:300px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
			<td style="width:300px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
		</tr>
		<tr>
			<td style="width:100px;" class="paddingTop10 text_label">Comments:</td>
			<td style="width:300px;" class="paddingTop10"><?php echo $elem_descOd;?></td>
			<td style="width:300px;" class="paddingTop10"><?php echo $elem_descOs;?></td>
		</tr>
		 <tr>
			<td style="width:100px;" class="paddingTop10 text_label">Interpretation:</td>
			<td style="width:300px;" class="paddingTop10"><?php echo $elem_inter_pret_od;?></td>
			<td style="width:300px;" class="paddingTop10"><?php echo $elem_inter_pret_os;?></td>
		</tr>

		<tr>
			<td  class="text_lable" colspan="3">Treatment/Prognosis:</td>
		</tr>
		<tr  >
			<td colspan="2" class="paddingTop10" style="width:400px;" >
				<?php echo ($elem_stable == "1") ? "Stable" : "" ;?>
				<?php echo ($elem_contiMeds == "1") ? "Continue Meds" : "" ;?>
				 <?php echo ($elem_fuApa == "1") ? "F/U APA" : "" ;?>
			</td>
			 <td class="paddingTop10" style="width:300px;" >
				<?php echo ($elem_tech2InformPt == "1") ? "Tech to Inform Pt." : "" ;?>
				 <?php echo ($elem_ptInformed == "1") ? "Pt informed of results" : "" ;?>
				 <?php echo ($elem_informedPtNv == "1") ? "Inform Pt result next visit" : "" ;?>
			</td>
		</tr>
		<tr>

					<td colspan="3" style="width:700px;" class="paddingTop10">
			<?php

					///Add TestLabs Images//
					$imagesHtml = $this->getTestImages($test_other_id,$sectionImageFrom="TestOther",$patient_id);
					if($imagesHtml!=""){
						echo('<table >
								'.$imagesHtml.'
							</table>');
					}
					$imagesHtml="";
					//End TestLabs Images

			?>
				 </td>
			</tr>
	<?php
	if($elem_physician){?>
				<tr>
					<td style="width:700px;" colspan="3" class="text_lable paddingTop10" >Interpreted By:&nbsp;
						<?php
							if($elem_physician!=""){
								$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '".$elem_physician."'");
								$getNameRow = imw_fetch_assoc($getNameQry);
								$InterpretedBy = str_replace(", ,"," ",$getNameRow['phyName']);
								print($InterpretedBy);
							}
						?>
					</td>
				</tr>
	<?php }?>
	</table>
	<?php
	}//end of other while
	}
	}

	public function print_testotherTemplate($patient_id,$form_id,$req){
			if(is_array($req) && count($req)>0){
				$sql = "SELECT * FROM test_other WHERE patientId = '$patient_id' AND test_other_id in(".implode(",",$req).") and test_template_id!='0'";
			}else if($form_id){
				$sql = "SELECT * FROM test_other WHERE patientId = '$patient_id' AND formId = '$form_id' and test_template_id!='0'";
			}
			$rowCellCount= imw_query($sql);
			if(imw_num_rows($rowCellCount)>0){
				$arr_test_name=array();
				$qry_tests_name="SELECT id,temp_name FROM tests_name";
				$res_tests_name=imw_query($qry_tests_name);
				while($row_tests_name=imw_fetch_assoc($res_tests_name)){
					$arr_test_name[$row_tests_name['id']]=$row_tests_name['temp_name'];
				}
				while($row=imw_fetch_array($rowCellCount)){
				$test_template_id=$row["test_template_id"];
				$test_other_id=$row["test_other_id"];
				$elem_examDate = ($topo_mode != "new") ? get_date_format($row["examDate"]) : $elem_examDate;
				$elem_examTime = ($topo_mode != "new") ? $row["examTime"] : $elem_examTime ;
				$elem_testOtherName = $row["test_other"];
				$elem_topoMeterEye = $row["test_other_eye"];
				$elem_performedBy = $row["performedBy"];
				$elem_ptUnderstanding = $row["ptUnderstanding"];
				$elem_diagnosis = $row["diagnosis"];
				$elem_diagnosisOther = $row["diagnosisOther"];
				$elem_reliabilityOd = $row["reliabilityOd"];
				$elem_reliabilityOs = $row["reliabilityOs"];
				$elem_descOd = stripslashes($row["descOd"]);
				$elem_descOs = stripslashes($row["descOs"]);
				$elem_inter_pret_od = stripslashes($row["inter_pret_od"]);
				$elem_inter_pret_os = stripslashes($row["inter_pret_os"]);
				$elem_stable = $row["stable"];
				$elem_fuApa = $row["fuApa"];
				$elem_ptInformed = $row["ptInformed"];
				$elem_physician = $row["phyName"] ;
				$elem_tech2InformPt=$row["tech2InformPt"];
				$elem_techComments = stripslashes($row["techComments"]);
				$elem_informedPtNv = $row["ptInformedNv"];
				$elem_contiMeds = $row["contiMeds"];
				$encounterId = $row["encounter_id"];
				$elem_opidTestOrdered = $row["ordrby"];
				if(($row["ordrdt"] != "" && $row["ordrdt"] != "0000-00-00")){
					$elem_opidTestOrderedDate = get_date_format($row["ordrdt"]);
				}

		?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0" >
			<tr>
				<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="3" height="2"></td>
			</tr>
			<tr>
				<td colspan="3" class="bluehed text_cap paddingTop10">Test (<span class="text_value">Exam Date:&nbsp;<?php print $elem_examDate;?></span>)</td>
			</tr>
		<?php if($elem_testOtherName!="" || (isset($arr_test_name[$test_template_id]) && $arr_test_name[$test_template_id]!="") ){?>
			<tr  >
				<td colspan="3" style="width:700px;" class="paddingTop10 text_lable"><?php echo $arr_test_name[$test_template_id]."&nbsp;". $elem_topoMeterEye; ?></td>
			</tr>
		<?php }?>
		<?php if($elem_techComments!=""){?>
			<tr  >
				<td colspan="3" style="width:700px;" class="paddingTop10"><b>Technician Comments:&nbsp;</b><?php echo $elem_techComments; ?></td>
			</tr>
		<?php }?>
			<tr>
				<?php
				if($elem_performedBy){
				?>
				<td colspan="2" style="width:400px;" class="paddingTop10"><b>Performed By:&nbsp;</b>
				<?php
					if($elem_performedBy!=""){
						$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '".$elem_performedBy."'");
						$getNameRow = imw_fetch_assoc($getNameQry);
						$PerformedBy = str_replace(", ,"," ",$getNameRow['phyName']);
						print($PerformedBy);
					}
				?>
				</td>
				<?php }?>
				<td style="width:300px;" class="paddingTop10"><b>Patient Understanding & Cooperation:&nbsp;</b>
					<?php echo ($elem_ptUnderstanding);?>
				</td>
			</tr>

			<tr>
				<td style="width:700px;" class="paddingTop10 text_lable" colspan="3"><?php if($elem_diagnosis!="--Select--"){
								echo("Diagnosis:&nbsp;".$elem_diagnosis);
						}?></td>
			</tr>
			<tr>
				<td style="width:700px;" class="paddingTop10 text_lable" colspan="3">Physician Interpretation </td>
			</tr>
			<tr>
				<td style="width:100px;" class="text_label paddingTop10">Reliability</td>
				<td style="width:300px;" class="paddingTop10">&nbsp;<?php $this->odLable();?>
					 &nbsp;<?php echo ($elem_reliabilityOd);?>
				</td>
				<td style="width:300px;" class="paddingTop10"><?php $this->osLable();?>&nbsp;

					 <?php echo ($elem_reliabilityOs);?>
				</td>
			</tr>
			<tr>
				<td style="width:100px;" class="paddingTop10">&nbsp;</td>
				<td style="width:300px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
				<td style="width:300px;" class="paddingTop10 text_lable"><?php $this->odLable();?></td>
			</tr>
			<tr>
				<td style="width:100px;" class="paddingTop10 text_label">Comments:</td>
				<td style="width:300px;" class="paddingTop10"><?php echo $elem_descOd;?></td>
				<td style="width:300px;" class="paddingTop10"><?php echo $elem_descOs;?></td>
			</tr>
			 <tr>
				<td style="width:100px;" class="paddingTop10 text_label">Interpretation:</td>
				<td style="width:300px;" class="paddingTop10"><?php echo $elem_inter_pret_od;?></td>
				<td style="width:300px;" class="paddingTop10"><?php echo $elem_inter_pret_os;?></td>
			</tr>

			<tr>
				<td  class="text_lable" colspan="3">Treatment/Prognosis:</td>
			</tr>
			<tr  >
				<td colspan="2" class="paddingTop10" style="width:400px;" >
					<?php echo ($elem_stable == "1") ? "Stable" : "" ;?>
					<?php echo ($elem_contiMeds == "1") ? "Continue Meds" : "" ;?>
					 <?php echo ($elem_fuApa == "1") ? "F/U APA" : "" ;?>
				</td>
				 <td class="paddingTop10" style="width:300px;" >
					<?php echo ($elem_tech2InformPt == "1") ? "Tech to Inform Pt." : "" ;?>
					 <?php echo ($elem_ptInformed == "1") ? "Pt informed of results" : "" ;?>
					 <?php echo ($elem_informedPtNv == "1") ? "Inform Pt result next visit" : "" ;?>
				</td>
			</tr>
			<tr>

						<td colspan="3" style="width:700px;" class="paddingTop10">
				<?php

						///Add TestLabs Images//
						$imagesHtml = $this->getTestImages($test_other_id,$sectionImageFrom="TemplateTests",$patient_id);
						if($imagesHtml!=""){
							echo('<table >
									'.$imagesHtml.'
								</table>');
						}
						$imagesHtml="";
						//End TestLabs Images

				?>
					 </td>
				</tr>
		<?php
		if($elem_physician){?>
					<tr>
						<td style="width:700px;" colspan="3" class="text_lable paddingTop10" >Interpreted By:&nbsp;
							<?php
								if($elem_physician!=""){
									$getNameQry = imw_query("SELECT CONCAT_WS(', ', lname, fname) as phyName FROM users WHERE id = '".$elem_physician."'");
									$getNameRow = imw_fetch_assoc($getNameQry);
									$InterpretedBy = str_replace(", ,"," ",$getNameRow['phyName']);
									print($InterpretedBy);
								}
							?>
						</td>
					</tr>
		<?php }?>
		</table>
		<?php
		}//end of other while
		}
	}

	public function print_Memo($pid,$fid){
		$sqlChartMEMO = "SELECT ".
		"chart_memo_text.memo_text_id, ".
		"chart_memo_text.memo_text, ".
		"chart_memo_text.memo_date, ".
		"chart_memo_text.provider_id ".
		"FROM memo_tbl ".
		"INNER JOIN chart_memo_text ON chart_memo_text.memo_id = memo_tbl.memo_id ".
		"WHERE patient_id='".$pid."' AND form_id = '".$fid."' AND deleted_by=0";
		$getMemoQry = imw_query($sqlChartMEMO);
		if(imw_num_rows($getMemoQry)>0){
							?>
		<!-- Chart Memo Table -->
		<table style="width:750px;">
		<tr>
			<td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="2" height="2"></td>
		</tr>
		<tr>
			<td colspan="2" class="bluehed text_cap paddingTop10">Chart Memo</td>
		</tr>
		<?php
		while($getMemoRows = imw_fetch_assoc($getMemoQry)){
			$memo_text_id = $getMemoRows['memo_text_id'];
			$memo_text = ($getMemoRows['memo_text']);
			$memo_date = get_date_format($getMemoRows['memo_date']);
			$memo_providerId = $getMemoRows['provider_id'];
			?>
			<tr>
				<td style="width:30px;" >&nbsp;</td>
				<td style="width:700px;" class='tb_subheading' ><strong>Provider:&nbsp;</strong><?php echo($this->showDoctorName($memo_providerId));?> <strong>Date:&nbsp;</strong> <?php echo($memo_date);?></td>
			</tr>
			<tr>
				<td style="width:30px;"><b>Notes:</b></td>
				<td style="width:700px;"><?php echo($memo_text);?></td>
			</tr>

		<?php
		}
		?>
		<!-- Chart Memo Table -->
		</table>
		<?php
		}
	}

	public function print_getPnote( $pid, $type, $titleDef ){
		$elem_showTitle = $title=$pnotes="";
		$sql = "SELECT showTitle,title,pnotes FROM pnote_cat WHERE pid='".$pid."' AND title = '".$type."'";
		$row=sqlQuery($sql);
		if( $row != false ){
			$elem_showTitle = trim($row["showTitle"]);
			if(empty($elem_showTitle)){
				$elem_showTitle = trim( $row["title"] );
			}
			$pnotes = $row["pnotes"];
		}
		$retTitle = !empty($elem_showTitle) ? $elem_showTitle : $titleDef;
		return array("title"=>$elem_showTitle,"pnotes"=>$pnotes);
	}

	public function print_PNotes($pid=0){
		$tmpOcuDx = $this->print_getPnote( $pid, "Ocular Dx.", "Diagnosis" );
		$tmpOcuSx = $this->print_getPnote( $pid, "Ocular Sx.", "OcularSx" );
		$tmpCon = $this->print_getPnote( $pid, "Consult", "Consult" );
		$tmpMedDx = $this->print_getPnote( $pid, "Med Dx.", "Medical Dx." );

		if($tmpOcuDx["pnotes"]<>"" || $tmpOcuSx["pnotes"]<>"" || $tmpMedDx["pnotes"]<>"" || $tmpCon["pnotes"]<>""){
		?>
		<table style="width:755px;"  cellpadding="0" cellspacing="0">
			<tr>
				<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td height="2"></td>
			</tr>
			<tr>
				<td class="bluehed text_cap paddingTop10">Provider Notes View:&nbsp;</td>
			</tr>

		<?php
		}

		if($tmpMedDx["pnotes"]<>""){
		?>

			<tr>
				<td style="width:700px;" class="paddingTop10 tb_subheading" ><?php  echo($tmpMedDx["title"]);?>.</td>
			</tr>
			<?php
					echo " <tr>";
					echo "  <td style=\"width:700px;\" class=\"paddingTop10\">\n";
					echo  addslashes($tmpMedDx["pnotes"]) ;
					echo "  </td>";
					echo " </tr>";
			?>

			<?php
		}

		if($tmpOcuDx["pnotes"]<>""){
			?>

			<tr>
				<td style="width:700px;" class="paddingTop10 tb_subheading"><?php  echo($tmpOcuDx["title"]);?>.</td>
			</tr>
				<?php
					echo "<tr>";
					echo "<td style=\"width:700px;\" class=\"paddingTop10\">\n";
					echo  addslashes($tmpOcuDx["pnotes"]);
					echo "</td>";
					echo "</tr>";
			?>

			<?php
			$this->HeadingTableHr();
		}

		// ocular sx
		if($tmpOcuSx["pnotes"]<>""){
			?>

			<tr>
				<td style="width:700px;" class="paddingTop10 tb_subheading"><?php  echo($tmpOcuSx["title"]);?></td>
			</tr>
				<?php
				echo "<tr >";
				echo "<td style=\"width:700px;\" class=\"paddingTop10\">\n";
				echo  addslashes($tmpOcuSx["pnotes"]) ;
				echo "</td>";
				echo " </tr>";
			?>

			<?php
			$this->HeadingTableHr();
		}
		// consult
		if($tmpCon["pnotes"]<>""){
			?>

			<tr>
				<td style="width:700px;" class="paddingTop10 tb_subheading"><?php  echo($tmpCon["title"]);?></td>
			</tr>
			<?php
				echo "<tr >";
				echo "<td style=\"width:700px;\" class=\"paddingTop10\">\n";
				echo  addslashes($tmpCon["pnotes"]);
				echo "</td>";
				echo "</tr>";
			?>

			<?php
			$this->HeadingTableHr();
		}
	if($tmpOcuDx["pnotes"]<>"" || $tmpOcuSx["pnotes"]<>"" || $tmpMedDx["pnotes"]<>"" || $tmpCon["pnotes"]<>""){
		?>

	</table>

	<?php
		}
	}


	public function print_AssessPlan($pid=0,$fid=0){
		global $gdFilename;
		global $ChartNoteImagesString;

		$sql = "SELECT * ".
			 " FROM chart_assessment_plans WHERE patient_id='".$pid."' AND form_id='".$fid."' ";
		$row=sqlQuery($sql);
		$vf_drop_val="";
		$qry="SELECT func_status FROM chart_left_cc_history WHERE patient_id='".$pid."' AND form_id='".$fid."'";
		$res=imw_query($qry);
		if(imw_num_rows($res)>0){
			$row1=imw_fetch_assoc($res);
			$vf_drop_val=$row1['func_status'];
			if($vf_drop_val){
				$vf_drop_val="VF-14:&nbsp;".$vf_drop_val;
			}
		}
		if($row!=false){
			extract($row);

			$idPlan = $id;
			$strpixls = $sign_coords;
			$ta_plan_notes_4 = $assess_plan;
			$txt_assessment_4 = $assessment_4;
			$strXml = stripslashes($assess_plan);
			//--- Set Assess Plan Resolve NE Value FROM xml//
			$oChartApXml = new ChartAP($patient_id,$form_id);
			//$arrApVals = $oChartApXml->getVal_Str($strXml);
			$arrApVals = $oChartApXml->getVal();
			$arrAp = $arrApVals["data"]["ap"];
			//print_r($arrAp);
			$lenAssess = count($arrAp);
			if($lenAssess>0)
			{
			?>
				<table style="width:726px;" cellpadding="0" cellspacing="0" >
					<tr>
						<td colspan="4" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					 </tr>
					 <tr>
						<td colspan="4" height="2"></td>
					</tr>
					<tr>
						<td colspan="4" class="bluehed text_cap paddingTop10">ASSESSMENT &amp; PLAN <span style="text-align:right; width:600px;"><?php echo $vf_drop_val; ?></span></td>
					 </tr>
					<tr>
						<td style="width:31px;" class="paddingTop10">&nbsp;</td>
						<td class="text_lable paddingTop10" style="width:225px;">Assessment</td>
						<td class="text_lable paddingTop10" align="center" style="width:50px;">Eye</td>
						<td class="text_lable paddingTop10" style="width:420px;">Plan</td>
					</tr>

					<?php
						for($i=0;$i<$lenAssess;$i++)
						{
							$j=$i+1;
							$elem_assessment = "assessment_".$j;
							$$elem_assessment = $arrAp[$i]["assessment"];
							$elem_plan = "plan_notes_".$j;
							$$elem_plan = $arrAp[$i]["plan"];
							$elem_resolve = "elem_resolve".$j;
							$$elem_resolve = $arrAp[$i]["resolve"];
							$no_change_Assess = "no_change_Assess".$j;
							$$no_change_Assess = $arrAp[$i]["ne"];
							$imgBack="";
							if($$no_change_Assess) $$no_change_Assess = 'NE '.$j.'';
								if($$elem_resolve)
									{
										$imgBack='background:url('.$GLOBALS['fileroot'].'/library/images/resolved.jpg) top center repeat-x';
									if($$no_change_Assess){
										$$no_change_Assess.= ', RES '.$j.'';
									}else{
										$$no_change_Assess = 'RES '.$j.'';
										}
								}
								if(!$$no_change_Assess){
									$$no_change_Assess = ''.$j.'';
								}
								$eye = "eye_".$j;
								$$eye = $arrAp[$i]["eye"];

								//die($$elem_plan);
							$planData="";
							if(strpos(trim($$no_change_Assess),"NE") === false)
							{
								if($$elem_assessment || $$elem_plan )
								{
									?>

										<tr style=" <?php echo $imgBack; ?> ">
											<td class="text_lable paddingTop10" style="width:31px;"><?php echo $$no_change_Assess; ?></td>
											<td class="paddingTop10" style="width:225px;<?php echo $imgBack; ?>"><?php if($$elem_assessment) echo wordwrap(nl2br(htmlentities($$elem_assessment)), 30, "<br>", true); else echo '&nbsp;'; ?></td>
											<td class="paddingTop10" align="center" style="width:50px;"><?php echo($$eye);?></td>
											<td class="paddingTop10" style="width:420px;">

											<?php
											if(strlen($$elem_plan)>3500){
												$planData = str_replace('&Acirc;','',wordwrap($$elem_plan,58,"\n",true));
											}else{
												$planData = str_replace('&Acirc;','',nl2br(wordwrap($$elem_plan,58,"\n",true)));
											}

											if($planData) echo wordwrap($planData,80,"\n"); else echo '&nbsp;'; ?>

											</td>
										</tr>
										<tr>
											<td colspan="4" height="2">&nbsp;</td>
										</tr>
									<?php
								}
							}
					}
					?>
				</table>
			<?php
			}
			//--- Set Assess Plan Resolve NE Value FROM xml//

			//Followup
			if($follow_up_numeric_value){
				$follow_up_numeric_value = str_replace(array("13","14"), array("PRN","PMD"),$follow_up_numeric_value);
			}elseif($followup){
				$arrFollowup = $this->fu_getXmlValsArr($followup);
				//echo '<pre>';
				//echo count($arrFollowup[1]);
				//print_r($arrFollowup[1]);
				//die;
				$FUDatta = "";
				for($a=0;$a<count($arrFollowup[1]);$a++){
					$number= $arrFollowup[1][$a]['number'];//[0];
					$time= $arrFollowup[1][$a]['time'];
					$visit_type= $arrFollowup[1][$a]['visit_type'];
					$ProviderName=$this->showDoctorName($arrFollowup[1][$a]['provider']);
					if(($visit_type!="" || $time!="" || $visit_type!="")){
									$FUDatta .= "<tr><td class=\"text_lable paddingTop10\" >";
									if($a==0 &&($visit_type!="" || $time!="" || $visit_type!=""))
									{
										//$FUDatta.='F/U';
									}
									else
									{
										//$FUDatta.='&nbsp;&nbsp;';
									}

									$FUDatta.='&nbsp;'.$number.'';
									$FUDatta.='&nbsp;'.$time.'';
									if(!empty($visit_type))$FUDatta.='&nbsp;for&nbsp;'.$visit_type.'';
									if(!empty($ProviderName))$FUDatta.='&nbsp;with&nbsp;'.$ProviderName.'';

									$FUDatta .= "</td></tr>";
					}
				}
			}
	?>
			<table cellpadding="0" cellspacing="0"  style="width:745px;">
			<?php
				if($resiHxReviewd==1){
					$titleRxHxRvd = "I personally interviewed and examined the patient and reviewed the resident or fellows note. I agree with the history, exam, assessment and plan as detailed in the resident or fellows note.  I have reviewed and verified that all the information is accurate and true.";
					echo "
						<tr>
							<td class=\"paddingTop10 \" style=\"width:745px;\">
								<strong>".$titleRxHxRvd."</strong>
							</td>
						</tr>
					";
				}
			?>

			<?php
			 if($follow_up_numeric_value!="" || $FUDatta!="")
			{
			?>
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10">Follow Up</td>
				</tr>
					<?php
				} if($follow_up_numeric_value!="")
				{
					?>
						<tr>
							<td class="paddingTop10" style="width:745px;"><?php if($follow_up_numeric_value) echo ''.$follow_up_numeric_value.' - '.$follow_up.' - '.$followUpVistType; ?></td>
						</tr>
					<?php
					}elseif($followup){
						echo $FUDatta;
					}

							///Co signer signautre were here

					?>
					<?php

						if($retina==1) $retinaStr = 'Retina';
						if($neuro_ophth==1){
							if($retinaStr!="")
								$retinaStr.=', Neuro Ophth';
							else
								$retinaStr = 'Neuro Ophth';
						}
						if($id_precation){
							if($retinaStr) $retinaStr.=', ID Precation';
							else $retinaStr.='ID Precation';
						}
						if($rd_precation){
							if($retinaStr) $retinaStr.=', RD Precation';
							else $retinaStr.='RD Precation';
						}
						if($lid_scrubs_oint){
							if($retinaStr) $retinaStr.=', Lid Scrubs & Oint';
							else $retinaStr.='Lid Scrubs & Oint';
						}

						if($continue_meds){
							if($retina) $retinaStr.=', Continue Meds';
							else $retinaStr.='Continue Meds';
						}

						if($doctor_name != ''){
							$doctor_name = '<b>Transition Of Care:</b> '.$doctor_name;
						}
						 if($retinaStr !=""){
						?>
						<tr>

							<td class="paddingTop10" style="width:745px;"> <?php if($retinaStr !=""){ echo $retinaStr; } ?></td>
						</tr>
							<?php
						}
							//scribed by
							$sqlgetScr = imw_query("SELECT CONCAT_WS(',',fname,lname) as ScribedBy FROM users WHERE id = '".$scribedBy."'") or die(imw_error());

							if(imw_num_rows($sqlgetScr)>0)
							{
								$sqlgetScrRows = imw_fetch_assoc($sqlgetScr);
								extract($sqlgetScrRows);
								echo '<tr><td style="width:745px;">&nbsp;<b>Scribed&nbsp;By:&nbsp;</b>'.$ScribedBy.'</td></tr>';
							}

							//Reffer to
							if(!empty($refer_to)){
								echo  "<tr><td class=\"paddingTop10\" style=\"width:745px;\"> <b>Refer To:</b> ".$refer_to."</td></tr>";
							}

							//Reason for Referrals
							if(!empty($consult_reason)){
								echo  "<tr><td class=\"paddingTop10\" style=\"width:745px;\"> <b>Reason For Referrals:</b> ".$consult_reason."</td></tr>";
							}


							//
							if(!empty($plan_notes)){
							$tmp = explode("~||~", $plan_notes);
							$plan_notes = $tmp[0];
							if(!empty($tmp[1])) { $plan_notes_Dt = $tmp[1]; }
							if(!empty($tmp[2])) { $plan_notes_nm = $tmp[2]; }
							}

							//echo substr($plan_notes, 0, 9);exit;
								if(substr($plan_notes, 0, 9) == "Comments:"){
									$plan_notes = substr($plan_notes,9);
									if($plan_notes!="" && $plan_notes!="Comments.." && $plan_notes!="comments..."){
										$plan_notes = "<b>Comments:</b>".htmlentities($plan_notes)."";
									?>
									<tr>
										<td class="paddingTop10" style="width:745px;">
											<?php echo $plan_notes;
												if(!empty($plan_notes_Dt)) { echo " ; Added on ". $plan_notes_Dt; }
												if(!empty($plan_notes_nm)) { echo " by ". $this->showDoctorName($plan_notes_nm); }
											?>
										</td>
									</tr>
									<?php
									}
								}
								else{
									if($plan_notes!="" && $plan_notes!="Comments.." && $plan_notes!="comments..."){
										$plan_notes = "<b>Comments:&nbsp;</b>".htmlentities($plan_notes)."";
								   ?>
									<tr>
										<td class="paddingTop10" style="width:745px;">
											<?php echo $plan_notes;
												if(!empty($plan_notes_Dt)) { echo " ; Added on ". $plan_notes_Dt; }
												if(!empty($plan_notes_nm)) { echo " by ". $this->showDoctorName($plan_notes_nm); }
											?>
										</td>
									</tr>
									<?php
									}
							}

							//transition of care
							if($doctor_name!="")
							{
							?>
								<tr>
									<td class="paddingTop10" style="width:745px;">
										<?php echo $doctor_name;?>
									</td>
								</tr>
						<?php }

						//Reason For Transition Of Care
						if(!empty($transition_reason)){
							echo '<tr><td style="width:745px;">&nbsp;<b>Reason For Transition Of Care: </b>'.$transition_reason.'</td></tr>';
						}

						//Comments
						if(!empty($transition_notes)){
							$tmp = explode("~||~", $transition_notes);
							$transition_notes = $tmp[0];
							if(!empty($tmp[1])) { $transition_notes_Dt = " ; Added on ".$tmp[1]; }
							if(!empty($tmp[2])) { $transition_notes_nm = " by ". $this->showDoctorName($tmp[2]); }

							if($transition_notes!="" && $transition_notes!="Comments.." && $transition_notes!="comments..."){
								echo '<tr><td style="width:745px;">&nbsp;<b>Comments: </b>'.$transition_notes.$transition_notes_Dt.$transition_notes_nm.'</td></tr>';
							}
						}

				//Pt Comments
				if($commentsForPatient!="")
				{

				$tmp = explode("~||~", $commentsForPatient);
				$commentsForPatient = $tmp[0];
				if(!empty($tmp[1])) { $commentsForPatient_Dt = $tmp[1]; }
				if(!empty($tmp[2])) { $commentsForPatient_nm = $tmp[2]; }
				if(!empty($commentsForPatient)){
				?>
				<tr>
					<td class="paddingTop10 " style="width:745px;">
						<strong>Discussion/Comments requested by Pt: &nbsp; </strong>
						<?php

						echo htmlentities($commentsForPatient);
						if(!empty($commentsForPatient_Dt)) { echo " ; Added on ". $commentsForPatient_Dt; }
						if(!empty($commentsForPatient_nm)) { echo " by ". $this->showDoctorName($commentsForPatient_nm); }

						?>
					</td>
				</tr>
			<?php }} ?>

			<tr><td></td></tr>
			</table>
			<?php
		}else{ /* ?>
			<table style="width:700px;" cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10">Assessment &amp; Plan</td>
				</tr>
				<tr>
					<td>No Record</td>
				</tr>
			</table>

	<?php */
		}

	}

		public function print_chartsignatures($pid,$fid){
		global $ChartNoteImagesString;
		$oUser = new User();
		$str="";
		$sql = "SELECT  c2.pro_id, ".
					"c2.sign_coords_dateTime,
					c2.sign_path
				FROM chart_master_table c1
				LEFT JOIN `chart_signatures` c2 ON c1.id = c2.form_id
				WHERE c1.patient_id = '".$pid."' AND c1.id='".$fid."'
				ORDER BY c2.sign_type
				";
		$res = sqlStatement($sql);
		for($i=0;$row=sqlFetchArray($res);$i++){
			$pro_id = $row["pro_id"];
			$sign_coords_dateTime="";
			$sign_coords_dateTime = $row["sign_coords_dateTime"];
			$sign_path = $row["sign_path"];
			if(!empty($pro_id)){
				$tmp_str = "";

				$oUser->uid = $pro_id;
				$username = $oUser->getName(4);

				if(!empty($sign_path))
				{
					$tmp = $this->data_file_path.$sign_path;
					if(file_exists($tmp)){
						$tmp_str.="<b>Signature:</b> <img src=\"".$tmp."\" height=\"45\" width=\"225\"/>";
						$ChartNoteImagesString[]=$tmp;
					}
				}
				else
				{
					$tmp_str.="<b>Signature:</b> <div style=\"width:225px;height:45px;\"></div>";
				}

				$tmp_str .= "<br/><b>Signer:</b> ".$username;

				if(!empty($sign_coords_dateTime)&&strpos($sign_coords_dateTime,"0000")===false)
				{
					$tmpdate = get_date_format(date('Y-m-d',strtotime($sign_coords_dateTime)))." ".date("H:i:s", strtotime($sign_coords_dateTime));
					$tmp_str.= "<br/><b>Signed on:</b> ".$tmpdate."";
				}
				$str .="<tr>";

				$str .="<td style=\"height:75px;\" class=\"paddingTop10\">".$tmp_str."</td>";
				$str .="</tr>";
			}
		}

		if(!empty($str))
		{

			$str="<table cellpadding=\"0\" cellspacing=\"0\" style=\"width:750px;\">
				<tr><td colspan=\"2\" class=\"bluelne\" height=\"1\" style=\"width:750px;\">&nbsp;</td></tr>
				<tr><td colspan=\"2\" height=\"2\"></td></tr>
				<tr><td colspan=\"2\" class=\"bluehed text_cap paddingTop10\">SIGNATURE</td></tr>".
				$str.
				"</table>";
			echo $str;
		}
	}

	public function print_attestation($pid,$fid){
		$sql="SELECT * FROM chart_signatures WHERE form_id='".$fid."' ";
		$rez = sqlStatement($sql);
		for($i=0, $j=1; $row=sqlFetchArray($rez); $i++){
			if(!empty($row["atsd_msg"])){


				$tbl .="<tr><td>".$j.".</td><td>".strip_tags($row["atsd_msg"])."</td></tr>";
				$j+=1;
			}
		}

		//teaching
		$sql="SELECT * FROM chart_assessment_plans WHERE form_id='".$fid."' AND patient_id = '".$pid."' AND resiHxReviewd='1' ";
		$row=sqlQuery($sql);
		if($row!=false){
			$titleRxHxRvd = "I personally interviewed and examined the patient and reviewed the resident or fellows note. I agree with the history, exam, assessment and plan as detailed in the resident or fellows note.  I have reviewed and verified that all the information is accurate and true.";
			$tbl .="<tr><td>".$j.".</td><td>".$titleRxHxRvd."</td></tr>";

		}


		if(!empty($tbl)){
			$tbl = "<table>
						<tr><td colspan=\"2\" class=\"bluelne\" height=\"1\" style=\"width:750px;\">&nbsp;</td></tr>
						<tr><td colspan=\"2\" height=\"2\"></td></tr>
						<tr><td colspan=\"2\" class=\"bluehed text_cap paddingTop10\">ATTESTATION</td></tr>".$tbl."</table>";
			echo $tbl;
		}

	}

	public function print_getPtComm($pid=0){
		//--- Get All Messages of patient Communication --------
		$qry = imw_query("select user_messages.user_message_id as id,
		        user_messages.message_to as mid,
				user_messages.message_send_date as created_date,
				user_messages.message_subject as task_subject,
				users.lname as user_lname,users.fname as user_fname,users.mname as user_mname,
				user_messages.message_text as message_text,
				user_messages.sent_to_groups as sent_to_groups
				from user_messages
				left join patient_data on user_messages.patientId = patient_data.id
				left join users on users.id = user_messages.message_sender_id
				where  patient_data.id = '".$pid."'
				and user_messages.Pt_Communication = '1'
				and user_messages.del_status = '0'
				and user_messages.edit_status = '0'
				order by user_messages.message_send_date desc");
		while($row = imw_fetch_array($qry)){
			$qryRes[] = $row;
		}

		//--- Get All Tasksof patient Communication --------
		$qry1 = imw_query("select phy_todo_task.phy_todo_task_id as id,
				phy_todo_task.task_created_date as created_date,
				users.lname as user_lname,users.fname as user_fname,users.mname as user_mname,
				phy_todo_task.task_text as message_text,phy_todo_task.task_subject
				from phy_todo_task
				left join patient_data on phy_todo_task.patientId = patient_data.id
				left join users on users.id = phy_todo_task.task_by
				where patient_data.id = '".$pid."'
				and phy_todo_task.Pt_Communication = '1'
				order by phy_todo_task.task_created_date desc");
		while($row1 = imw_fetch_array($qry1)){
			$qryRes1[] = $row1;
		}

		$mainRes = array_merge((array)$qryRes,(array)$qryRes1);

		$Communication_data = '';
		for($i=0;$i<count($mainRes);$i++){
			$id = $mainRes[$i]['id'];
			//$created_date = date('m-d-Y g:i A',strtotime($mainRes[$i]['created_date']));
			$created_date = get_date_format(date('Y-m-d',strtotime($mainRes[$i]['created_date']))).' '.date('g:i A',strtotime($mainRes[$i]['created_date']));
			$operator_id = $mainRes[$i]['operator_id'];
			$msg_subject = ucwords(trim($mainRes[$i]['task_subject']));
			//--- Operator Name -----
			$user_name = $mainRes[$i]['user_lname'].', ';
			$user_name .= $mainRes[$i]['user_fname'].' ';
			$user_name .= $mainRes[$i]['user_mname'];
			$user_name = ucwords(trim($user_name));
			if($user_name[0] == ','){
				$user_name = substr($user_name,1);
			}
			//=====SEND TO GROUP RECIPIENTS WORK ADDED FOR PRINTING=======
			$temp_users=array();
            $temp_users = explode('<br>', html_entity_decode($mainRes[$i]['sent_to_groups']));
            $group_list = array_shift($temp_users);
            $Ugroup_arr = explode(',', $group_list);
			$send_to_list='';
            if(!empty($Ugroup_arr)) {
                foreach($Ugroup_arr as $Ugroup) {
                    $tugrp='';
                    if(!empty($Ugroup)) {
                    $tUgroup=explode('--', trim($Ugroup));
                    if(count($tUgroup)>0) {
                        $tugrp.=$tUgroup[0].'; ';

                    } else {
                        $tugrp.=trim($Ugroup).'; ';
                    }
                    $send_to_list.=$tugrp;
                }
                }
            }

            if(count($temp_users)>0)
            $send_to_list = $send_to_list.implode('; ',$temp_users).';';
			//================THE END=======================================

			//Get Recipient ----
		    $get_recipient = imw_query("Select fname, lname from users where id = '".$mainRes[$i]['mid']."'");
			$recipient = imw_fetch_array($get_recipient);

			//--- Patient Name -----
			$message_text = ucfirst($mainRes[$i]['message_text']);
			$Communication_data .= "
				<tr>
					<td class=\"paddingTop10\" style=\"width:100px;\">".$created_date."</td>
					<td class=\"paddingTop10\" style=\"width:160px;\">".htmlentities($msg_subject)."</td>
					<td class=\"paddingTop10\" style=\"width:180px;\">".htmlentities($message_text)."</td>
					<td class=\"paddingTop10\" style=\"width:100px;\">".$user_name."</td>
					<td class=\"paddingTop10\" style=\"width:100px;\">".$recipient['fname']." ".$recipient['lname']." ".$send_to_list."</td>
				</tr>
			";
		}
		if($Communication_data!=""){
		?>
			<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td colspan="5" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td colspan="5" height="2"></td>
				</tr>
				<tr>
					<td colspan="5" class="bluehed text_cap paddingTop10">PATIENT COMMUNICTION:&nbsp;</td>
				</tr>
				<tr>
					<td class="text_lable paddingTop10" style="width:100px;">Date</td>
					<td class="text_lable paddingTop10" style="width:160px;">Subject</td>
					<td class="text_lable paddingTop10" style="width:180px;" >Communication</td>
					<td class="text_lable paddingTop10" style="width:80px;" >Sender</td>
					<td class="text_lable paddingTop10" style="width:80px;" >Recipient</td>
				</tr>
					<?php
						print $Communication_data;
					?>
			</table>
		<?php
		}
	}

	public function print_education_forms($patient_id=0,$form_id=""){
		if($patient_id){
			$qryEducationForm="SELECT name,date_format(date_time,'".get_date_format()."')as save_date from document_patient_rel WHERE p_id='".$patient_id."'".($form_id ? " AND form_id='".$form_id."'" : '' );
			$resEducationForm=imw_query($qryEducationForm);
			if(imw_num_rows($resEducationForm)>0){ ?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="3" height="2"></td>
					</tr>
					<tr>
						<td colspan="3" class="bluehed text_cap paddingTop10">Recommended Patient Decision Aids</td>
					</tr>
					<tr>
						<td style="width:30px; text-align:center;" class="paddingTop10 text_lable">#</td>
						<td style="width:600px;" class="paddingTop10 text_lable">Form Name</td>
						<td style="width:100px;" class="paddingTop10 text_lable">Date</td>
					</tr>

			<?php $i=0;
				while($rowEducationForm=imw_fetch_assoc($resEducationForm)){ $i++;?>
				  <tr>
				  <td style="width:30px; text-align:center;" class="paddingTop10 text_label"><?php echo $i; ?>.</td>
					<td style="width:600px;" class="paddingTop10"><?php echo $rowEducationForm['name']; ?></td>
					<td style="width:100px;" class="paddingTop10"><?php echo $rowEducationForm['save_date']; ?></td>
				  </tr>
			<?php
				}
			?>
				</table>
			<?php
			}else{ /*?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10" style="width:750px;">EDUCATION AND INSTRUCTIONS</td>
					</tr>
					<tr>
						<td class="paddingTop10">No Data</td>
					</tr>
				 </table>
			<?php */
			}
		}
	}

	public function print_provider($patient_id=0,$cprNewPrint=""){

		if($patient_id){

			$qryProvider="SELECT concat(usr.pro_title,' ',usr.lname,', ',usr.fname,' ',usr.mname)as provider_name,usr.default_facility as fac_id from patient_data as pd INNER JOIN users as usr on pd.providerID=usr.id WHERE pd.id='".$patient_id."'";
			$resProvider=imw_query($qryProvider);

				$rowProvider=imw_fetch_assoc($resProvider);
				$facilityId="";
				if($rowProvider['fac_id']){
					$facilityId=$rowProvider['fac_id'];
				}
				$qryFacility=" AND facility_type=1";
				if($facility){
					$qryFacility=" AND id='".$facilityId."'";
				}
				$facility_detail="SELECT name,street,city,state,concat(postal_code)as zip_code,phone FROM facility WHERE 1=1 ".$qryFacility;
				$resfacility=imw_query($facility_detail);
				$rowfacility=imw_fetch_assoc($resfacility);

				$qryReffPhy="SELECT concat(usr.Title ,' ',usr.LastName,', ',usr.FirstName ,' ',usr.MiddleName)as reffering_name,usr.Address1 as address1,usr.Address2 as address2,usr.City as city,usr.State as state,concat(usr.ZipCode)as zip_code,usr.physician_phone as phone,usr.zip_ext as zip_ext from patient_data as pd INNER JOIN refferphysician as usr on pd.primary_care_id=usr.physician_Reffer_id  WHERE pd.id='".$patient_id."'";
				$resReffPhy=imw_query($qryReffPhy);
				$rowReffPhy=imw_fetch_assoc($resReffPhy);

				$qryPCPPhy="SELECT concat(usr.Title ,' ',usr.LastName,', ',usr.FirstName ,' ',usr.MiddleName)as reffering_name,usr.Address1 as address1,usr.Address2 as address2,usr.City as city,usr.State as state,concat(usr.ZipCode)as zip_code,usr.physician_phone as phone,usr.zip_ext as zip_ext from patient_data as pd INNER JOIN refferphysician as usr on pd.primary_care_phy_id=usr.physician_Reffer_id  WHERE pd.id='".$patient_id."'";
				$resPCPPhy=imw_query($qryPCPPhy);
				$rowPCPPhy=imw_fetch_assoc($resPCPPhy);

			if($cprNewPrint!="YES" && ($rowProvider['provider_name'] ||$rowReffPhy['reffering_name'] || $rowPCPPhy['reffering_name'])){
			?>
				<table style="width:725px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="3" height="2"></td>
					</tr>
					<tr>
						<td colspan="3" class="bluehed text_cap paddingTop10">CARE TEAM MEMBERS</td>
					</tr>
					<tr>
						<td style="width:250px;">
							<table style="width:250px;"   cellpadding="0" cellspacing="0">
								<tr>
									<td style="width:250px;" class="tb_subheading paddingTop10">Primary Provider</td>
							   </tr>
						<?php if($rowProvider['provider_name']){ ?>

							   <tr>
									<td style="width:250px;" class="paddingTop10"><?php echo $rowProvider['provider_name'];  ?></td>
							   </tr>
							   <?php if($rowfacility['street']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo  $rowfacility['name'].", ".$rowfacility['street'];  ?></td>
							   </tr>
							   <?php }
							   if($rowfacility['city']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo $rowfacility['city'].", ".$rowfacility['state']." ".$rowfacility['zip_code'];  ?></td>
							   </tr>
							   <?php }
							   if($rowfacility['phone']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo core_phone_format($rowfacility['phone'],"###-###-####");?></td>
							   </tr>
							   <?php } ?>

					   <?php }else{ echo "<tr><td class='paddingTop10'>No Primary Provider</td></tr>"; }  ?>
							</table>
						</td>
						<td style="width:250px;">
							<table style="width:250px;"   cellpadding="0" cellspacing="0">
								<tr>
									<td style="width:250px;" class="tb_subheading paddingTop10">Referring Physician</td>
							   </tr>
					   <?php

					   if($rowReffPhy['reffering_name']){
					   ?>

							   <tr>
									<td style="width:250px;" class="paddingTop10"><?php echo $rowReffPhy['reffering_name'];  ?></td>
							   </tr>
							   <?php if($rowReffPhy['address1']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo $rowReffPhy['address1'];  ?></td>
							   </tr>
							   <?php }
							   if($rowReffPhy['address2']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo  $rowReffPhy['address2']; ?></td>
							   </tr>
							   <?php }
							   if($rowReffPhy['city']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo $rowReffPhy['city'].", ".$rowReffPhy['state']." ".$rowReffPhy['zip_code'];  ?></td>
							   </tr>
							   <?php }
							   if($rowReffPhy['phone']){ ?>
								<tr>
									<td style="width:250px;" class="paddingTop10"><?php echo core_phone_format($rowReffPhy['phone'],"###-###-####");?></td>
							   </tr>
							   <?php } ?>

					  <?php }else{ echo "<tr><td class='paddingTop10'>No Referring Physician</td></tr>";} ?>
						</table>
					   </td>
					  <td style="width:225px;">
							<table style="width:225px;"   cellpadding="0" cellspacing="0">
								<tr>
									<td style="width:225px;" class="tb_subheading paddingTop10">Primary Care Physician</td>
							   </tr>
					  <?php
					  if($rowPCPPhy['reffering_name']){
					  ?>


							   <tr>
									<td style="width:225px;" class="paddingTop10"><?php echo $rowPCPPhy['reffering_name'];  ?></td>
							   </tr>
							   <?php if($rowPCPPhy['address1']){ ?>
								<tr>
									<td style="width:225px;" class="paddingTop10"><?php echo $rowPCPPhy['address1'];  ?></td>
							   </tr>
							   <?php }
							   if($rowPCPPhy['address2']){ ?>
								<tr>
									<td style="width:225px;" class="paddingTop10"><?php echo  $rowPCPPhy['address2']; ?></td>
							   </tr>
							   <?php }
							   if($rowPCPPhy['city']){ ?>
								<tr>
									<td style="width:225px;" class="paddingTop10"><?php echo $rowPCPPhy['city'].", ".$rowPCPPhy['state']." ".$rowPCPPhy['zip_code'];  ?></td>
							   </tr>
							   <?php }
							   if($rowPCPPhy['phone']){ ?>
								<tr>
									<td style="width:225px;" class="paddingTop10">
									<?php echo core_phone_format($rowPCPPhy['phone'],"###-###-####");?>
									</td>
							   </tr>
							   <?php }
								}else{ /* echo "<tr><td class='paddingTop10'>No Record</td></tr>";  */}


								if($cprNewPrint=="YES" && (!empty($rowPCPPhy['reffering_name']) || !empty($rowReffPhy['reffering_name'])) )
								{
									$cprNewPrint = $rowPCPPhy['reffering_name']."~~".$rowReffPhy['reffering_name'];
								}
								?>
						</table>
					   </td>
					</tr>
				</table>
			<?php
			}
			else if($cprNewPrint!="YES")
			{
			/* ?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10" style="width:750px;" >CARE TEAM MEMBERS</td>
					</tr>
					<tr>
						<td class="paddingTop10">No Record</td>
					</tr>
				</table>
			<?php */
			}

				if($cprNewPrint=="YES" )
				{
					if( !empty($rowPCPPhy['reffering_name']) || !empty($rowReffPhy['reffering_name']) )
					{	
				?>
					<table cellpadding="0" cellspacing="0" style="width:750px;">
						<tr>
							<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
						</tr>
						<tr>
							<td style="width:170px;" height="2"></td>
							<td style="width:26px;" height="2"></td>
							<td style="width:567px;" height="2"></td>
						</tr>
						<?php if( !empty($rowPCPPhy['reffering_name']) ) { ?>
						<tr>
							<td colspan="2" class="bluehed text_cap paddingTop10" style="width:193px;">Primary Care Physician: </td>
							<td class="text_bold paddingTop10" style="width:547px;font-size:13px;"><?php print $rowPCPPhy['reffering_name']; ?></td>
						</tr>
						<?php } if( !empty($rowReffPhy['reffering_name']) ) {  ?>
						<tr>
							<td class="bluehed text_cap paddingTop10" style="width:172px;">Referring Physician: </td>
							<td colspan="2" class="text_bold paddingTop10" style="width:568px;font-size:13px;"> <?php print $rowReffPhy['reffering_name'];  ?></td>
						</tr>
						<?php } ?>
					</table>
				<?php
					}
				}

			}
	}

	public function print_provider_info($patient_id=0,$form_id=0){
		if($patient_id){
			//========GET OPERATORS ID WHO PERFORMED ANYTHING FOR PATIENT==================
			$qryProviderId="SELECT provIds FROM chart_master_table WHERE patient_id='".$patient_id."' AND id='".$form_id."'";
			//echo $qryProviderId;
			//COMMA IS SEPARATING FROM COLUMN DATA
			$resProviderId=imw_query($qryProviderId);
			$providerId=imw_fetch_assoc($resProviderId);

			//COMMA SEPARATED ID FILTERED
			$provider = array_filter(array_map('trim',explode(',',$providerId['provIds'])));
			$provider = ($provider) ? implode(',',$provider) : 0;
			//GET USER DETAILS BASED ON PROVIDED ID IN ASCENDING ORDER
			$qryProvider="SELECT concat(pro_title,' ',lname,', ',fname,' ',mname) as provider_name, default_facility as fac_id, user_type FROM users WHERE id IN(".$provider.") ORDER BY user_type ASC";
				//echo $qryProvider; die;
				$resProvider=imw_query($qryProvider);
				if(imw_num_rows($resProvider)>0){
				$td_counter = 0;
				$prev_provider_type = 0;
				while($rowProvider=imw_fetch_assoc($resProvider)){
				  $facilityId="";
				  if($rowProvider['fac_id']){
					  $facilityId=$rowProvider['fac_id'];
				  }
				  $qryFacility=" AND facility_type=1"; //DEFAULT HQ FACILITY QUERY
				  if($facilityId){
					  $qryFacility=" AND id='".$facilityId."'";
				  }

				  if( is_allscripts() && array_key_exists('login_facility', $_SESSION) )
				  {
				  	$qryFacility=" AND id='".$_SESSION['login_facility']."'";
				  }

				  //GET FACILITY DATA BASED ON HQ FACILITY ID
				  $facility_detail="SELECT name,street,city,state,concat(postal_code)as zip_code,phone, zip_ext FROM facility WHERE 1=1 ".$qryFacility;
				  $resfacility=imw_query($facility_detail);
				  $rowfacility=imw_fetch_assoc($resfacility);
				  //GET REFERRING PHYSICIAN DETAILS
				  $qryReffPhy="SELECT concat(usr.Title ,' ',usr.LastName,', ',usr.FirstName ,' ',usr.MiddleName)as reffering_name,usr.Address1 as address1,usr.Address2 as address2,usr.City as city,usr.State as state,concat(usr.ZipCode)as zip_code,usr.physician_phone as phone,concat(usr.zip_ext)as zip_ext from patient_data as pd INNER JOIN refferphysician as usr on pd.primary_care_id=usr.physician_Reffer_id  WHERE pd.id='".$patient_id."'";
				  $resReffPhy=imw_query($qryReffPhy);
				  $rowReffPhy=imw_fetch_assoc($resReffPhy);
				  //GET PRIMARY CARE PHYSICIAN DETAILS
				  $qryPCPPhy="SELECT concat(usr.Title ,' ',usr.LastName,', ',usr.FirstName ,' ',usr.MiddleName)as reffering_name,usr.Address1 as address1,usr.Address2 as address2,usr.City as city,usr.State as state,concat(usr.ZipCode)as zip_code,usr.physician_phone as phone,concat(usr.zip_ext)as zip_ext from patient_data as pd INNER JOIN refferphysician as usr on pd.primary_care_phy_id=usr.physician_Reffer_id  WHERE pd.id='".$patient_id."'";
				  $resPCPPhy=imw_query($qryPCPPhy);
				  $rowPCPPhy=imw_fetch_assoc($resPCPPhy);
				  // USER TYPE 1 IS FOR PHYSICIAN AND OTHER FOR ALL OTHER OPEARTORS i.e. TECHNICIAN/NURSE/SCRIBER ETC
				  $provider_type_custom = ($rowProvider['user_type'] != '1')?'other':$rowProvider['user_type'] ;

				  if($rowProvider['provider_name']){
					if($prev_provider_type != $provider_type_custom && $td_counter!==0){
						for($i=3; $i>$td_counter;$i--){
							echo '<td class="inlinetbl"  style="width:240px;"><table  cellpadding="0" cellspacing="0"></table></td>';
						}
						echo '</tr></table>';
					$td_counter = 0;
					}
				 if($td_counter==0){ ?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<?php } ?>
				<?php if($prev_provider_type != $provider_type_custom){
						 $prev_provider_type = $provider_type_custom;
				?>
					<tr>
						<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="3" height="2"></td>
					</tr>
					<tr>
						<td colspan="3" class="bluehed text_cap paddingTop10"><?php echo ($prev_provider_type=='1')? 'PROVIDERS NAME AND OFFICE CONTACT INFORMATION' :'ADDITIONAL CARE GIVER'; ?> </td>
					</tr>
				<?php } ?>

				<?php if($td_counter==0){ ?>
					<tr>
				<?php } ?>
				<td class="inlinetbl"  style="width:240px;">
					<table  cellpadding="0" cellspacing="0">
					<?php if($rowProvider['provider_name']):
						$td_counter++;
					?>
						<tr>
							 <td style="width:240px;" class="paddingTop10">
							 	<?php
							 	if($rowProvider['user_type'] != 1){
							 	       $providerNameArr = explode(",", $rowProvider['provider_name']); //PROVIDER NAME
							 	       $provFName = strtoupper(substr(trim($providerNameArr[1]),0,1));
							 	       $provLName = strtoupper(substr(trim($providerNameArr[0]),0,1));
							 	       echo $provFName.$provLName;
							 	}else{
							 	    $rowProvider['provider_name'];
							 	}
							 	   ?>
							 </td>
						</tr>
						<!--====HQ FACILITY INFORMATION STARTS FROM HERE====---->
						<?php if($rowfacility['name']): ?>
						<tr><td style="width:240px;" class="paddingTop10"><?php echo $rowfacility['name'];  ?></td></tr>
						<?php endif; ?>

						<?php if($rowfacility['street']): ?>
						<tr><td style="width:240px;" class="paddingTop10"><?php echo  $rowfacility['street'];  ?></td></tr>
						   <?php endif; ?>

						   <?php if($rowfacility['city']): ?>
						<tr><td style="width:240px;" class="paddingTop10"><?php echo $rowfacility['city'].", ".$rowfacility['state']." ".$rowfacility['zip_code'];  ?></td></tr>
						<?php endif; ?>

						<?php if($rowfacility['phone']): ?>
							<tr><td style="width:240px;" ><?php echo 
core_phone_format($rowfacility['phone'],"###-###-####"); ?></td></tr>
						<?php endif; ?>

					<?php else: ?>
						<tr><td class='paddingTop10'>No Primary Provider</td></tr>
					<?php endif; ?>
					</table>
				</td>
				<?php if($td_counter==3):
						$td_counter=0;
				?>
				 </tr>
			</table>
			 <?php endif; ?>
			 <?php
				}else{
			 /* ?>
			 <table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" style="width:750px;" >Providers Name and Office Contact Information</td>
				</tr>
				 <tr>
					<td class="paddingTop10">No Record</td>
				  </tr>
			 </table>
			<?php */
				}  //PROVIDER NAME CONDITION ENDS HERE
			}   //WHILE LOOP ENDS HERE
			if($td_counter!==3 && $td_counter!==0){
				for($i=3; $i>$td_counter;$i--){
					echo '<td class="inlinetbl"  style="width:240px;"><table  cellpadding="0" cellspacing="0"></table></td>';
				}
				echo '</tr></table>';
			}
			//imw_NUM_ROWS ELSE CONDITION, IF THERE'S NO DATA COMING...
			}else{ /* ?>
			<table style="width:750px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10" style="width:750px;" >Providers Name and Office Contact Information</td>
				</tr>
				<tr>
					<td class="paddingTop10">No Record</td>
				</tr>
			</table>
			<?php */
			}
		} //PATIENT ID CONDITION ENDS HERE
	}

	public function userInfo($pt_id,$exclusion){
		if($_SESSION['authId']){
			$qryProvider="SELECT concat(usr.pro_title,' ',usr.lname,', ',usr.fname,' ',usr.mname)as provider_name,usr.default_facility as fac_id from users as usr WHERE id='".$_SESSION['authId']."'";
			$resProvider=imw_query($qryProvider);
			if(imw_num_rows($resProvider)>0){
				$rowProvider=imw_fetch_assoc($resProvider);
				$facilityId="";
				if($rowProvider['fac_id']){
					$facilityId=$rowProvider['fac_id'];
				}
				$qryFacility=" AND facility_type=1";
				if($facility){
					$qryFacility=" AND id='".$facilityId."'";
				}
				$facilityId="";
				if($rowProvider['fac_id']){
					$facilityId=$rowProvider['fac_id'];
				}
				$qryFacility=" AND facility_type=1";
				if($facility){
					$qryFacility=" AND id='".$facilityId."'";
				}

				if( is_allscripts() && array_key_exists('login_facility', $_SESSION) )
				{
					$qryFacility=" AND id='".$_SESSION['login_facility']."'";
				}
				if($_SESSION['login_facility'])
				{
					$qryFacility="";
					$qryFacility=" AND id='".$_SESSION['login_facility']."'";
				}
				$facility_detail1="SELECT name,street,city,state,concat(postal_code)as zip_code,phone,zip_ext FROM facility WHERE 1=1 ".$qryFacility;
				$resfacility1=imw_query($facility_detail1);
				$rowfacility1=imw_fetch_assoc($resfacility1);


				$pt_pos_fac="SELECT default_facility FROM patient_data WHERE id='".$pt_id."'";
				$res_pos_fac=imw_query($pt_pos_fac);

				if(imw_num_rows($res_pos_fac)>0){
					$rowfacility=imw_fetch_assoc($res_pos_fac);
					$pos_id=$rowfacility['default_facility'];
					$facility_detail="SELECT facilityPracCode,pos_facility_address,pos_facility_address2,pos_facility_city ,pos_facility_state,pos_facility_zip FROM pos_facilityies_tbl WHERE pos_facility_id='".$pos_id."'";
					$resfacility=imw_query($facility_detail);
					$rowfacility=imw_fetch_assoc($resfacility);
					$facilitName=$rowfacility['facilityPracCode'];

				}
				if($rowProvider['provider_name']){

				?>
					<table style="width:750px;"  cellpadding="0" cellspacing="0">
						<tr>
							<?php if($rowProvider['provider_name']){ ?>
							<td style="width:380px;">
								<table style="width:380px;"   cellpadding="0" cellspacing="0">
									<tr>
										<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
									</tr>
									<tr>
										<td height="2"></td>
									</tr>
									<tr>
										<td class="bluehed text_cap paddingTop10">LOGGED USER</td>
									</tr>
									<tr>
										<td style="width:350px;"class="paddingTop10">
											<?php
												 $phyname = explode(',',$rowProvider['provider_name']);
												 $phyfname = strtoupper(substr(trim($phyname[1]),0,1));
												 $phylname = strtoupper(substr(trim($phyname[0]),0,1));
												 $physicianname = $phyfname.$phylname;
												 echo $physicianname;
											?>
										 </td>
								   </tr>
								   <?php if($rowfacility1['street']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo  $rowfacility1['name'].", ".$rowfacility1['street'];  ?></td>
								   </tr>
								   <?php }
								   if($rowfacility1['city']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo $rowfacility1['city'].", ".$rowfacility1['state']." ".$rowfacility1['pos_facility_zip'];  ?></td>
								   </tr>
								   <?php }
									if($rowfacility1['phone']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo core_phone_format($rowfacility1['phone'],"###-###-####");?></td>
								   </tr>
								   <?php } ?>
							   </table>
						   </td>
						   <?php }
						   if(!in_array("dos_facility",$exclusion)){
							?>
						   <!--<td style="width:360px;">
								<table style="width:360px;"   cellpadding="0" cellspacing="0">
									<tr>
										<td class="tb_heading">Facility</td>
									</tr>
						   <?php
						   if($facilitName){
						   ?>

									<tr>
										<td style="width:360px;"class="paddingTop10"><?php echo $facilitName;  ?></td>
								   </tr>
								   <?php if($rowfacility['pos_facility_address']){ ?>
									<tr>
										<td style="width:360px;"class="paddingTop10"><?php echo $rowfacility['pos_facility_address'];  ?></td>
								   </tr>
								   <?php }
									if($rowfacility['pos_facility_address2']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo $rowfacility['pos_facility_address2'];  ?></td>
								   </tr>
								   <?php }
								   if($rowfacility['pos_facility_address2']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo $rowfacility['pos_facility_city'].", ".$rowfacility['pos_facility_state']." ".$rowfacility['zip_code'];  ?></td>
								   </tr>
								   <?php }
								   if($rowfacility['phone']){ ?>
									<tr>
										<td style="width:350px;"class="paddingTop10"><?php echo $rowfacility['phone'];?></td>
								   </tr>
								   <?php } ?>

						  <?php }else{echo "<tr><td class='paddingTop10'>No Facility</td></tr>";} ?>

							</table>
						   </td>-->
						 <?php } ?>
						</tr>
					</table>
				<?php
				}
			}
		}
	}

	public function superbill_print($pt_id=0,$form_id=0){
		if($pt_id && $form_id){
			$qrySuperbill="SELECT pi.units as unit,pi.modifier1 as mod1,pi.modifier2 as mod2,pi.modifier3 as mod3,pi.modifier4 as mod4,pi.cptCode as cpt,pi.dx1 as dx1,pi.dx2 as dx2,pi.dx3 as dx3,pi.dx4 as dx4,pi.dx5 as dx5,pi.dx6 as dx6,pi.dx7 as dx7,pi.dx8 as dx8,pi.dx9 as dx9,
			pi.dx10 as dx10,pi.dx11 as dx11,pi.dx12 as dx12,pi.procedureName as proc_name  FROM superbill as sb INNER JOIN procedureinfo as pi on sb.idSuperBill=pi.idSuperBill WHERE sb.patientId='".$pt_id."' AND sb.formId='".$form_id."' AND sb.del_status=0 AND pi.delete_status=0";
			$resSuperbill=imw_query($qrySuperbill);
			if(imw_num_rows($resSuperbill)>0){?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td colspan="14" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				   </tr>
				   <tr>
						<td colspan="14" height="2"></td>
					</tr>
					<tr>
						<td colspan="14" class="bluehed text_cap paddingTop10">SUPERBILL</td>
				   </tr>
				   <tr>
						<td class="paddingTop10 tb_subheading" style="width:50px;">CPT</td>
						<td class="paddingTop10 tb_subheading" style="width:40px;">Unit</td>
						<td class="paddingTop10 tb_subheading" style="width:55px;">Dx1</td>
						<td class="paddingTop10 tb_subheading" style="width:55px;">Dx2</td>
						<td class="paddingTop10 tb_subheading" style="width:55px;">Dx3</td>
						<td class="paddingTop10 tb_subheading" style="width:55px;">Dx4</td>
						<td class="paddingTop10 tb_subheading" style="width:50px;">Dx5</td>
						<td class="paddingTop10 tb_subheading" style="width:50px;">Dx6</td>
						<td class="paddingTop10 tb_subheading" style="width:50px;">Dx7</td>
						<td class="paddingTop10 tb_subheading" style="width:50px;">Dx8</td>
						<td class="paddingTop10 tb_subheading" style="width:40px;">Mod1</td>
						<td class="paddingTop10 tb_subheading" style="width:40px;">Mod2</td>
						<td class="paddingTop10 tb_subheading" style="width:40px;">Mod3</td>
						<td class="paddingTop10 tb_subheading" style="width:40px;">Mod4</td>
				   </tr>
			<?php
				while($rowSuperbill=imw_fetch_assoc($resSuperbill)){ ?>
					<tr>
						<td class="paddingTop10 " style="width:50px;"><?php echo $rowSuperbill['cpt'];?></td>
						<td class="paddingTop10 " style="width:40px;"><?php echo $rowSuperbill['unit']; ?></td>
						<td class="paddingTop10 " style="width:55px;"><?php echo $rowSuperbill['dx1']; ?></td>
						<td class="paddingTop10 " style="width:55px;"><?php echo $rowSuperbill['dx2']; ?></td>
						<td class="paddingTop10 " style="width:55px;"><?php echo $rowSuperbill['dx3']; ?></td>
						<td class="paddingTop10 " style="width:55px;"><?php echo $rowSuperbill['dx4']; ?></td>
						<td class="paddingTop10 " style="width:50px;"><?php echo $rowSuperbill['dx5']; ?></td>
						<td class="paddingTop10 " style="width:50px;"><?php echo $rowSuperbill['dx6']; ?></td>
						<td class="paddingTop10 " style="width:50px;"><?php echo $rowSuperbill['dx7']; ?></td>
						<td class="paddingTop10 " style="width:50px;"><?php echo $rowSuperbill['dx8']; ?></td>
						<td class="paddingTop10 " style="width:40px;"><?php echo $rowSuperbill['mod1']; ?></td>
						<td class="paddingTop10 " style="width:40px;"><?php echo $rowSuperbill['mod2']; ?></td>
						<td class="paddingTop10 " style="width:40px;"><?php echo $rowSuperbill['mod3']; ?></td>
						<td class="paddingTop10 " style="width:40px;"><?php echo $rowSuperbill['mod4']; ?></td>
				   </tr>
			<?php
				}
			?>
				</table>
			<?php
			}/* else{ ?>
				<table style="width:750px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				   </tr>
				   <tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10">SUPERBILL</td>
				   </tr>
				   <tr>
						<td class="paddingTop10">No Record</td>
				   </tr>
				</table>
		   <?php
			} */
		}
	}

	public function print_future_appointment_Int($pid=0,$form_id=0,$dos=""){
		$current_date = date("Y-m-d");
		$current_time = date("H:i:s");
		$upcoming_appt_qry="SELECT * FROM (select id,(Select name from facility WHERE id=sa_facility_id) as sa_facility_id, TIME_FORMAT(sa_app_starttime, '%h:%i %p') as sa_app_starttime, DATE_FORMAT(sa_app_start_date, '%m-%d-%Y') as sa_app_start_date,(SELECT concat(lname,', ',fname,' ',mname )as user_name from users WHERE id=if(facility_type_provider!='0',facility_type_provider,sa_doctor_id) and user_type!='5') as sa_doctor_id, sa_patient_app_status_id, procedureid from schedule_appointments where (sa_patient_id='".$pid."'  and sa_patient_app_status_id NOT IN('18', '201')) AND (sa_app_start_date >'".$current_date."' and sa_patient_id='".$pid."' and sa_patient_app_status_id NOT IN('18', '201','203')) order by sa_app_start_date) as result_data WHERE result_data.sa_doctor_id IS NOT NULL";

		$upcoming_appt_res=imw_query($upcoming_appt_qry);?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
		<?php
			$i=0;
			if(imw_num_rows($upcoming_appt_res)>0){
		?>	
			<tr>
				<td colspan="4" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="4" height="2"></td>
			</tr>
			<tr>
				<td colspan="4" class="bluehed text_cap paddingTop10">FUTURE APPOINTMENT (INTERNAL)</td>
			</tr>
			<tr>
				<td class="paddingTop10 tb_subheading">Physician</td>
				<td class="paddingTop10 tb_subheading">Schedule Date</td>
				<td class="paddingTop10 tb_subheading">Facility</td>
				<td class="paddingTop10 tb_subheading">Procedure</td>
			</tr>
		<?php 
			while($upcoming_appt_row = imw_fetch_array($upcoming_appt_res)){$i++;
			$upcoming_int_appt = ('select `acronym` from `slot_procedures` where id="'.$upcoming_appt_row["procedureid"].'"');
			$upcoming_int_appt_res = imw_query($upcoming_int_appt);
			if(imw_num_rows($upcoming_int_appt_res)>0){
					$upcoming_int_appt = imw_fetch_array($upcoming_int_appt_res);
		?>
			<tr>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_appt_row["sa_doctor_id"];?></td>
				 <td class='paddingTop10' style='width:100px;'><?php echo $upcoming_appt_row["sa_app_start_date"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_appt_row["sa_facility_id"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_int_appt["acronym"];?></td>
			</tr>
		<?php
			}
		}
		}else{	/*echo "<tr><td colspan='4'>No Future Appointment</td></tr>";*/ }
		?>
		</table>
		<?php
	}

	public function print_future_appointment($pid=0,$form_id=0,$dos=""){
		$current_date = date("Y-m-d");
		$current_time = date("H:i:s");
		$upcoming_appt_qry="SELECT test_name,reff_phy,if(schedule_date!='0000-00-00',date_format(schedule_date,'".get_sql_date_format()."'),'') as schedule_date,reason,phy_address FROM chart_schedule_test_external WHERE patient_id='".$pid."' AND form_id='".$form_id."' AND DOS>='".$dos."' AND appoint_test='Appointment' AND deleted_by=0";
		$upcoming_appt_res=imw_query($upcoming_appt_qry);?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
		<?php 
			$i=0;
			if(imw_num_rows($upcoming_appt_res)>0){
		?>
			<tr>
				<td colspan="4" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="4" height="2"></td>
			</tr>
			<tr>
				<td colspan="4" class="bluehed text_cap paddingTop10">FUTURE APPOINTMENT (EXTERNAL)</td>
			</tr>
			<tr>
				<td class="paddingTop10 tb_subheading">Physician</td>
				<td class="paddingTop10 tb_subheading">Schedule Date</td>
				<td class="paddingTop10 tb_subheading">Reason</td>
				<td class="paddingTop10 tb_subheading">Physician Address</td>

			</tr>
		<?php 
			while($upcoming_appt_row = imw_fetch_array($upcoming_appt_res)){$i++;

			?>
			<tr>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_appt_row["reff_phy"];?></td>
				 <td class='paddingTop10' style='width:100px;'><?php echo $upcoming_appt_row["schedule_date"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_appt_row["reason"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $upcoming_appt_row["phy_address"];?></td>
			</tr>
		<?php

			}
		}else{	/*echo "<tr><td colspan='4'>No Future Appointment</td></tr>";*/}
		?>
		</table>
		<?php
	}

	public function print_test_future_appointments($pid=0,$form_id=0,$dos=0){
		$req_qry ="SELECT test_name,reff_phy,if(schedule_date!='0000-00-00',date_format(schedule_date,'".get_sql_date_format()."'),'') as schedule_date,test_type,reason,snomed,cpt,loinc FROM chart_schedule_test_external WHERE patient_id='".$pid."' AND form_id='".$form_id."' AND DOS>='".$dos."' AND appoint_test='Test' AND deleted_by=0";
		$req_qry_obj = imw_query($req_qry);
	?>
		<table style="width:750px;"  cellpadding="0" cellspacing="0">
		<?php
			if(imw_num_rows($req_qry_obj)>0){
		?>	
			<tr>
				<td colspan="5" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="5" height="2"></td>
			</tr>
			<tr>
				<td colspan="5" class="bluehed text_cap paddingTop10">FUTURE SCHEDULED TESTS</td>
			</tr>
			<tr>
				<td class="paddingTop10 tb_subheading" style="width:150px;">Test Name</td>
				<td class="paddingTop10 tb_subheading" style="width:80px;">Test Type</td>
				<td class="paddingTop10 tb_subheading" style="width:130px;">Physician Name</td>
				<td class="paddingTop10 tb_subheading" style="width:140px;">Schedule Date</td>
				<td class="paddingTop10 tb_subheading" style="width:180px;">Code</td>
			</tr>
	<?php
		
			while($upcoming_appt_row = imw_fetch_array($req_qry_obj)){$code_val=$snomed_ct=$cpt_val=$lonic_val="";
					if(trim($upcoming_appt_row["snomed"])){$snomed_ct="SNOMED CT: ".$upcoming_appt_row["snomed"];}
					if(trim($upcoming_appt_row["cpt"])){$cpt_val="CPT: ".$upcoming_appt_row["cpt"];}
					if(trim($upcoming_appt_row["loinc"])){$lonic_val="LONIC: ".$upcoming_appt_row["loinc"];}
					$code_val='';
					if($snomed_ct){$code_val.=$snomed_ct;}
					if($cpt_val){if($code_val){$code_val.="<br>".$cpt_val;}else{$code_val=$cpt_val;}}
					if($lonic_val){if($code_val){$code_val.="<br>".$lonic_val;}else{$code_val=$lonic_val;}}
				?>
			<tr>
				 <td class='paddingTop10' style='width:150px;'><?php echo $upcoming_appt_row["test_name"];?></td>
				 <td class='paddingTop10' style='width:100px;'><?php echo $upcoming_appt_row["test_type"];?></td>
				 <td class='paddingTop10' style='width:150px;'><?php echo $upcoming_appt_row["reff_phy"]; ?></td>
				 <td class='paddingTop10' style='width:140px;'><?php echo $upcoming_appt_row["schedule_date"];   ?></td>
				 <td class='paddingTop10' style='width:180px;'><?php echo $code_val;?></td>
			</tr>
		<?php
			}
		}
		else
		{
			/*echo "<tr><td colspan='5'>No Future Scheduled Tests</td></tr>";*/
		}
		?>
			</table>
	<?php
	}

	public function referrals_to_other_providers($pid=0, $form_id=0){
		$req_qry="SELECT test_name,reff_phy,if(schedule_date!='0000-00-00',date_format(schedule_date,'".get_sql_date_format()."'),'') as schedule_date,reason,phy_address FROM chart_schedule_test_external WHERE patient_id='".$pid."' AND form_id='".$form_id."' AND appoint_test='Referral' AND deleted_by=0";
		$req_qry_obj = imw_query($req_qry);
	?>
		<table style="width:750px;" cellpadding="0" cellspacing="0">
		<?php	
			if(imw_num_rows($req_qry_obj) > 0)
			{
		?>		
			<tr>
				<td colspan="4" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="4" height="2"></td>
			</tr>
			<tr>
				<td colspan="4" class="bluehed text_cap paddingTop10">REFER FOR CONSULT</td>
			</tr>
			 <tr>
				<td class="paddingTop10 tb_subheading">Physician</td>
				<td class="paddingTop10 tb_subheading">Schedule Date</td>
				<td class="paddingTop10 tb_subheading">Reason</td>
				<td class="paddingTop10 tb_subheading">Physician Address</td>

			</tr>
	<?php
		
			while($refer_for_consult = imw_fetch_assoc($req_qry_obj)){
	?>
			<tr>
				 <td class='paddingTop10' style='width:200px;'><?php echo $refer_for_consult["reff_phy"];?></td>
				 <td class='paddingTop10' style='width:100px;'><?php echo $refer_for_consult["schedule_date"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $refer_for_consult["reason"];?></td>
				 <td class='paddingTop10' style='width:200px;'><?php echo $refer_for_consult["phy_address"];?></td>
			</tr>
	<?php
			}
		}
		else
		{
			/*echo "<tr><td colspan='4'>No Records</td></tr>";*/
		}
	?>
	</table>
	<?php
	}

	public function print_clicnic($pat_id=0,$form_id=0){
		$qryClinic="SELECT osacnd.inform as inform, osacnd.template_content ,osacnd.orders_site_text,(SELECT if(snowmed = '',name, concat(name,'|~|',snowmed)) FROM order_details where id=osacnd.order_id and delete_status!=1)as oreder_name  FROM order_set_associate_chart_notes_details osacnd JOIN order_set_associate_chart_notes osacn ON osacnd.order_set_associate_id = osacn.order_set_associate_id WHERE osacn.form_id = '".$form_id."' AND osacn.patient_id = '".$pat_id."' AND osacn.delete_status!=1";
		$resClinic=imw_query($qryClinic);
		if(imw_num_rows($resClinic)>0){ ?>
			<table style="width:725px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td colspan="3" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td colspan="3" height="2"></td>
				</tr>
				<tr>
					<td colspan="3" class="bluehed text_cap paddingTop10">CLINICAL INSTRUCTIONS</td>
				</tr>
				<tr>
					<td style="width:380px;" class="paddingTop10 tb_subheading">Name</td>
					<td style="width:50px;" class="paddingTop10 tb_subheading">Site</td>
					<td style="width:300px;" class="paddingTop10 tb_subheading">Information</td>
				</tr>
				<?php
				while($rowClinic=imw_fetch_assoc($resClinic)){
					$ins_sno=$rowClinic['oreder_name'];
					if(strstr($rowClinic['oreder_name'],"|~|")){
						list($ins_val,$snomed_val)=explode("|~|",$rowClinic['oreder_name']);
						$ins_sno=$ins_val." (SNOMED CT:&nbsp;".$snomed_val.")";
					}
					$tmp="";
					if(!empty($rowClinic['template_content'])){
						if(!empty($rowClinic['inform'])){ $tmp = "<br/>"; }
						$tmp =  htmlspecialchars_decode($rowClinic['template_content']);
						$tmp = strip_tags($tmp);
					}
				?>
				<tr>
					<td style="width:380px;" class="paddingTop10"><?php echo $ins_sno; ?></td>
					<td style="width:50px;" class="paddingTop10 alignCenter"><?php echo $rowClinic['orders_site_text']; ?></td>
					<td style="width:300px;" class="paddingTop10"><?php echo $rowClinic['inform'].$tmp; ?></td>
				</tr>
				<?php
				}
				?>
			</table>
		<?php
		}else{ /*?>
			<table style="width:725px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10">CLINICAL INSTRUCTIONS</td>
				</tr>
				<tr>
					<td class="paddingTop10">No Record</td>
				</tr>
			</table>
		<?php */
		}
	}

	public function pt_dos_facility($pid=0,$form_id=0,$date_of_service="",$proid=0){
		$cprPrint="yes"; //CHANGES AS PER COMPLETE PATIENT RECORD TO NOT PRINT THE DELETED/CANCELLED APPOINTMENTS FACILITY ADDRESS
		$facility = $this->print_get_chart_facility($pid,array("date_of_service"=>$date_of_service,"providerId"=>$proid),$cprPrint);

		/*
		$qry = "SELECT sa.sa_facility_id as facility,date_format(cmt.date_of_service,'".get_sql_date_format()."') as dos
		FROM schedule_appointments sa
		JOIN chart_master_table cmt ON cmt.date_of_service = sa.sa_app_start_date
		WHERE sa.sa_patient_id ='".$pid."'
		AND cmt.id = '".$form_id."'";
		$res = imw_query($qry);
		$row = imw_fetch_assoc($res);
		$dos=$row['dos'];
		$facility = $row['facility'];
		*/
		if( is_allscripts() && array_key_exists('login_facility', $_SESSION) )
		{
			$facility = $_SESSION['login_facility'];
		}

		if($facility > 0){$qry_facility="select name,phone,street,city,state,postal_code from facility where id = '".$facility."'";}
		else{
			$qry_facility="select name,phone,street,city,state,postal_code, zip_ext from facility where facility_type = '1'";
		}
		$res_facility=imw_query($qry_facility);
		$row_facility=imw_fetch_assoc($res_facility);
		$facility_name=$row_facility['name'];
		$facility_phone=core_phone_format($row_facility['phone'],"###-###-####");
		$facility_street=$row_facility['street'];
		$facility_city=$row_facility['city'];
		$facility_state=$row_facility['state'];
		$facility_postal=$row_facility['postal_code'];
		$facility_zip_ext=$row_facility['zip_ext'];
		?>
			<table style="width:740px;"  cellpadding="0" cellspacing="0">
				<tr>
					<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
				</tr>
				<tr>
					<td height="2"></td>
				</tr>
				<tr>
					<td class="bluehed text_cap paddingTop10">DATE AND LOCATION OF VISIT</td>
				</tr>
				<tr>
					<td class="paddingTop10"><b>Date of Service:</b>&nbsp;<?php echo $date_of_service; ?></td>
				</tr>
				<tr>
					<td class="paddingTop10"><?php echo $facility_name; ?></td>
				</tr>
				<?php if($facility_street){ ?>
				<tr>
					<td class="paddingTop10"><?php echo $facility_street; ?></td>
				</tr>
				<?php } ?>
				<tr>
					<td class="paddingTop10"><?php if($facility_city){ echo $facility_city.", ";}if($facility_state){echo $facility_state;} if($facility_postal){ echo " ".$facility_postal;}  ?></td>
				</tr>
				<?php if($facility_phone){ ?>
				<tr>
					<td class="paddingTop10">Ph:&nbsp;<?php echo $facility_phone; ?></td>
				</tr>
				<?php } ?>
			</table>
		   <?php
	}

	public function print_exam_hx($pid,$fid){

		$cls_sub_exm_2 = " class='paddingTop10 tb_subheading' ";
		$cls_sub_exm = " style='font-weight:bold;' ";
		$tbl_header ='<tr><td '.$cls_sub_exm_2.'></td><td colspan="3" '.$cls_sub_exm_2.'>Created</td><td colspan="3" '.$cls_sub_exm_2.'>Modified</td></tr>';
		$tbl_header .= '<tr><td '.$cls_sub_exm.'>Site</td><td '.$cls_sub_exm.'>Date Time</td><td '.$cls_sub_exm.'>User</td><td '.$cls_sub_exm.'>Value</td><td '.$cls_sub_exm.'>Date Time</td><td '.$cls_sub_exm.'>User</td><td '.$cls_sub_exm.'>Value</td></tr>';

		$str_table_header='<table   cellpadding="0" cellspacing="0" >
						<tr >
							<td colspan="7" class="tb_heading">Modification Hx.</td>
						</tr>
						';
		$str_table='';

		$arr_exams = array("Pupil"=>"chart_pupil",
						"External"=>"chart_external_exam",
						"EOM"=>"chart_eom",
						"LA - Lids"=>"chart_lids",
						"LA - Lid Position"=>"chart_lid_pos",
						"LA - Lesion"=>"chart_lesion",
						"LA - Lacrimal System"=>"chart_lac_sys",

						"Gonio"=>"chart_gonio",
						"IOP"=>"chart_iop",
						"Anesthetic"=>"chart_iop",
						"Dilation"=>"chart_dialation",
						"OOD"=>"chart_ood",

						"SLE - Conjunctiva"=>"chart_conjunctiva",
						"SLE - Cornea"=>"chart_cornea",
						"SLE - Ant. Chamber"=>"chart_ant_chamber",
						"SLE - Iris & Pupil"=>"chart_iris",
						"SLE - Lens"=>"chart_lens",

						"CD"=>"chart_optic",
						"Optic Nerve" => "chart_optic",

						"Fundus - Vitreous"=>"chart_vitreous",
						"Fundus - Retinal Exam"=>"chart_retinal_exam",
						"Assessment"=>"chart_assessment_plans"

						);

		foreach($arr_exams as $exam => $dbtbl){


		//modi field
		$modi_fld = "modi_note_Arr";

		if($exam == "LA - Lids"){ $modi_fld = "modi_note_LidsArr"; }
		elseif($exam == "LA - Lid Position"){ $modi_fld = "modi_note_LidPosArr"; }
		elseif($exam == "LA - Lesion"){ $modi_fld = "modi_note_LesionArr"; }
		elseif($exam == "LA - Lacrimal System"){ $modi_fld = "modi_note_LacSysArr"; }
		elseif($exam == "SLE - Conjunctiva"){ $modi_fld = "modi_note_ConjArr"; }
		elseif($exam == "SLE - Cornea"){ $modi_fld = "modi_note_CornArr"; }
		elseif($exam == "SLE - Ant. Chamber"){ $modi_fld = "modi_note_AntArr"; }
		elseif($exam == "SLE - Iris & Pupil"){ $modi_fld = "modi_note_IrisArr"; }
		elseif($exam == "SLE - Lens"){ $modi_fld = "modi_note_LensArr"; }
		elseif($exam == "Optic Nerve"){ $modi_fld = "modi_note_OpticArr"; }
		elseif($exam == "Fundus - Vitreous"){ $modi_fld = "modi_note_vitreousArr"; }
		elseif($exam == "Fundus - Retinal Exam"){ $modi_fld = "modi_note_retinalArr"; }
		elseif($exam == "IOP"){ $modi_fld = "modi_note_iopArr"; }
		elseif($exam == "Anesthetic"){ $modi_fld = "modi_note_AnestheticArr"; }
		elseif($exam == "CD"){ $modi_fld = "modi_note_CDArr"; }
		elseif($exam == "Assessment"){ $modi_fld = "modi_note_AssesArr"; }

		//
		$pid_var = ($exam=="Pupil") ? "patientId" : "patient_id";
		$fid_var = ($exam=="Pupil") ? "formId" : "form_id";

		$sql = "SELECT ".$modi_fld." AS modi_note_Arr FROM ".$dbtbl." where ".$pid_var."='".$pid."' AND ".$fid_var."='".$fid."' ";
		$row = sqlQuery($sql);
		//------ Check in archive tables for chart_slit_lamp_exam/chart_la/chart_rv For Merged NSE Server
		if(!empty($GLOBALS["CHK_ARCHIVE_TABLE"])){
			if($dbtbl=="chart_slit_lamp_exam"){
				if($row == false){
					$sql = str_replace("chart_slit_lamp_exam","chart_slit_lamp_exam_archive",$sql);
					$row=sqlQuery($sql);
				}
			}

			if($dbtbl=="chart_rv"){
				if($row == false){
					$sql = str_replace("chart_rv","chart_rv_archive",$sql);
					$row=sqlQuery($sql);
				}
			}
		}
		//-------- End ----------------------------------------------------------------------------------

		if($row != false){
			$tmp_arr = (!empty($row["modi_note_Arr"])) ? unserialize($row["modi_note_Arr"]) : "" ;

			if(count($tmp_arr) > 0){
				$tbl="";
				foreach($tmp_arr as $k=>$v){
					$eye = ""; $eye_s="";
					if($exam != "Assessment"){
						if(isset($v["OD"])){ $eye = "OD"; $eye_s = $this->odLable(1);}
						if(isset($v["OS"])){ $eye = "OS"; $eye_s = $this->osLable(1);}
						$arr_v = $v[$eye];

						//
						$time_modi = $arr_v["time"];
						$prev_val = $arr_v["preVal"];
						$cur_val = $arr_v["val"];
						$modi_by = $arr_v["modi_by"];
						$prvUid = $arr_v['preUsr'];
						$time_cr = $arr_v['preTime'];

					}else{
						$arr_v = $v;

						$time_modi = date("m-d-y H:i", strtotime($arr_v["time"])); //$arr_v["time"];
						$prev_val = $arr_v["prev"];
						$cur_val = $arr_v["curr"];
						$modi_by = $arr_v["modi_by"];
						$prvUid = $arr_v['preUsr'];
						$time_cr = date("m-d-y H:i", strtotime($arr_v["preTime"])); //$arr_v['preTime'];

						$str_prev_val="";
						if(!empty($prev_val["Res"])){	$str_prev_val.="(Res) ";	}
						if(!empty($prev_val["NE"])){	$str_prev_val.="(NE) ";	}
						if(!empty($prev_val["Asses"])){	$str_prev_val.=$prev_val["Asses"]." ";	}
						if(!empty($prev_val["Site"])){	$str_prev_val.=$prev_val["Site"]." ";	}
						if(!empty($prev_val["Plan"])){	$str_prev_val.=$prev_val["Plan"]." ";	}
						$prev_val = "";
						$prev_val = $str_prev_val;

						$str_cur_val="";
						if(!empty($cur_val["Res"])){	$str_cur_val.="(Res) ";	}
						if(!empty($cur_val["NE"])){	$str_cur_val.="(NE) ";	}
						if(!empty($cur_val["Asses"])){	$str_cur_val.=$cur_val["Asses"]." ";	}
						if(!empty($cur_val["Site"])){	$str_cur_val.=$cur_val["Site"]." ";	}
						if(!empty($cur_val["Plan"])){	$str_cur_val.=$cur_val["Plan"]." ";	}
						$cur_val="";
						$cur_val = $str_cur_val;
					}

					//
					$oUser = new User();
					$oUser->uid = $modi_by;
					$username = $oUser->getName(6);
					$oUser->uid = $prvUid;
					$username_cr = $oUser->getName(6);
					$tbl.="<tr>
						<td style='width:35px;'>&nbsp;".$eye_s."</td>
						<td style='width:100px;'>".$time_cr."</td>
						<td style='width:100px;'>".$username_cr."</td>
						<td style='width:155px;'>".$prev_val."</td>
						<td style='width:100px;'>".$time_modi."</td>
						<td style='width:100px;'>".$username."</td>
						<td style='width:155px;'>".$cur_val."</td>
						</tr>";
				}

				if(!empty($tbl)){
					$exam = str_replace(array("LA - ", "SLE - ", "Fundus - "), "", $exam);
					$exam = trim($exam);
					$str_table.='<tr><td colspan="2" '.$cls_sub_exm_2.'><b>'.$exam.'</b></td><td colspan="2" '.$cls_sub_exm_2.'></td><td colspan="3" '.$cls_sub_exm_2.'></td></tr>';
					$str_table .= $tbl_header00.$tbl."";
				}
			}
		}
		}

		if(!empty($str_table)){ $str_table=$str_table_header.$tbl_header.$str_table."</table>";  }
		echo $str_table;
	}

	public function fu_getXmlValsArr($xfup=""){
		$arr = array();

		if(!empty($xfup)){
			//echo "<xmp>".$xfup."</xmp>";
			$ox = simplexml_load_string($xfup);
			$len = count($ox->fu);
			if($len > 0){
				foreach($ox->fu as $fux){
					if(!empty($fux->number)){
						$arrTmp = array();
						$arrTmp["number"] = "".$fux->number;
						$arrTmp["time"] = "".$fux->time;
						$arrTmp["visit_type"] = "".$fux->visit_type;
						$arrTmp["provider"] = "".$fux->provider;
						$arrTmp["chk_str"] = $this->getChkStr($arrTmp["number"], $arrTmp["time"], $arrTmp["visit_type"]);
						$arr[] = $arrTmp;
					}
				}
			}
		}

		return array($len, $arr);
	}

	public function HeadingTableHr(){

	}

	public function getAllTestPdf($strAllTestIds,$image_from=false){
		$qry = "SELECT file_type, file_path, image_form FROM ".constant("IMEDIC_SCAN_DB").".scans
				WHERE patient_id = '".$_SESSION['patient']."'
				AND test_id in (".$strAllTestIds.")
				AND scan_or_upload = 'upload'
				AND file_type = 'application/pdf'
				";
        if($image_from){
            $qry .= "AND image_form = '".$image_from."' ";
        }
		$res = imw_query($qry);
		$strPDFdata = '';$arrPDFs = array();
		while($row = imw_fetch_assoc($res)){
			$scndirPath = $this->data_file_path.$row['file_path'];
			$scn_dir_real_path = $scndirPath;
			$arrPDFs[] = $scn_dir_real_path;
		}
		return $arrPDFs;
	}

	public function pdfVersion2($filename){
		$fp = @fopen($filename, 'rb');
		if (!$fp) {
			return 0;
		}
		fseek($fp, 0);
		preg_match('/\d\.\d/',fread($fp,20),$match);
		fclose($fp);

		if (isset($match[0])) {
			return $match[0];
		} else {
			return 0;
		}
	}

	public function checknMakeImagesHTML($arrPDFs){
		$str_alternative_images='';
		foreach($arrPDFs as $pdf_file){
			if(file_exists($pdf_file)){

				$version= $this->pdfVersion2($pdf_file);
				if($version>1.4){
					$jpg_name= substr($pdf_file, 0, -4).'.jpg';

					if(file_exists($jpg_name)){
						$scnfileSize = getimagesize($jpg_name);
						if($scnfileSize[0]>700 ){
							$scnimageWidth2 = $this->imageResize($scnfileSize[0],$scnfileSize[1],700);
							$scnMultiImage= '<tr><td style="width:700px;text-align:center" ><img style="cursor:pointer" src="'.$jpg_name.'" alt="patient Image" '.$scnimageWidth2.'></td></tr>';
						}
						else{
							$scnMultiImage= '<tr><td style="width:700px;text-align:center"><img style="cursor:pointer" src="'.$jpg_name.'" alt="patient Image"></td></tr>';
						}

						$arr_alternative_images[]= $scnMultiImage;
					}
				}
			}
		}

		if(sizeof($arr_alternative_images)>0){
			$str_alternative_images=implode(',', $arr_alternative_images);
		}
		return $str_alternative_images;
	}

	//-------------GET VITAL SIGN DATA GENERAL HEALTH BP AND BMI DATA-------------
	public function getGenHealthVSData($formId){

		$formId = $_SESSION['form_id_by_taran'];
		$getSysBP = $getDysBP = $getBmiHeight = $getBmiHeightUnit = $getBmiWeight = $getBmiWeightUnit = $getBmiResult =  $getBmiResultUnit ="";
		if($formId){
			$vsDataQry = "SELECT vsp.vital_master_id, vsp.vital_sign_id, vsp.range_vital, vsp.unit FROM vital_sign_patient as vsp INNER JOIN vital_sign_master as vsm ON vsp.vital_master_id=vsm.id AND vsm.form_id='".$formId."' AND vsp.vital_sign_id IN(1,2,7,8,9)";
			//echo $vsDataQry;die;
			$vsDataRes = imw_query($vsDataQry);
			if(imw_num_rows($vsDataRes)>0){
				while($vsDataRow = imw_fetch_assoc($vsDataRes)){
				  if($vsDataRow['vital_sign_id']==1){
					  $getSysBP = $vsDataRow['range_vital'];
				  }
				  if($vsDataRow['vital_sign_id']==2){
					  $getDysBP = $vsDataRow['range_vital'];
				  }
				  if($vsDataRow['vital_sign_id']==7){
					  $getBmiHeight = $vsDataRow['range_vital'];
					  $getBmiHeightUnit = $vsDataRow['unit'];
				  }
				  if($vsDataRow['vital_sign_id']==8){
					  $getBmiWeight = $vsDataRow['range_vital'];
					  $getBmiWeightUnit = $vsDataRow['unit'];

				  }
				  if($vsDataRow['vital_sign_id']==9){
					  $getBmiResult = $vsDataRow['range_vital'];
					  $getBmiResultUnit = $vsDataRow['unit'];
				  }
				}
			}
		}
		$getGenHlthVSData = array($getSysBP,$getDysBP,$getBmiHeight,$getBmiHeightUnit,$getBmiWeight,$getBmiWeightUnit,$getBmiResult,$getBmiResultUnit);
		return $getGenHlthVSData;
	}

	//Allergies ---------------------------
	//print other Allergies
	public function print_other_allergies($pid=0,$fTestAct="",$arrReq=array(),$strDosToPrint="",$zFormId=''){

		if($fTestAct=="Active"){
			$getAllergies = "select type,title,begdate,acute,allergy_status,chronic,reactions,ag_occular_drug,comments,
				date_format(begdate,'".get_sql_date_format('','y','/')."') as DateStart,ccda_code  from lists where pid = '".$pid."'
				and type in(3,7) and allergy_status = 'Active'  order by id";
		}else{
				$getAllergies = "select type,title,begdate,acute,allergy_status,chronic,reactions,ag_occular_drug,comments,
				date_format(begdate,'".get_sql_date_format('','y','/')."') and allergy_status != 'Deleted' as DateStart,ccda_code from lists where pid = '".$pid."'
				and type in(3,7) order by id";
		}
		if($getAllergies != ""){
			$rsGetAllergies = imw_query($getAllergies);
			while($rowAllergies = imw_fetch_array($rsGetAllergies))	{
				$dataFinal[] = $rowAllergies;
			}
		}

		if(count($dataFinal) > 0){
		$flagNo = 1;
		?>
	   <table  style="width:750px;" cellpadding="0" cellspacing="0">
			<tr>
				<td colspan="6" class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="6" height="2"></td>
			</tr>
			<tr>
				<td colspan="6" class="bluehed text_cap paddingTop10">ALLERGIES:</td>
			</tr>
			<tr>
				<td class="text_lable paddingTop10" style="width:100px;" >Type</td>
				<td class="text_lable paddingTop10" style="width:170px;" >Name</td>
				<!--<td class="text_lable"  >Adverse Reactions</td>-->
				<td class="text_lable paddingTop10" style="width:160px;"  >Reactions / Comments</td>
				<td class="text_lable paddingTop10" style="width:70px;" >Status</td>
				<td class="text_lable paddingTop10" style="width:100px;" >Date Started</td>
				 <td class="text_lable paddingTop10" style="width:103px;" >SNOMED CT</td>

			</tr>
		<?php
			foreach($dataFinal as $data){
				$typeAllergy="";
				if($data["ag_occular_drug"] == 'fdbATDrugName'){
					$typeAllergy = 'Drug';
				}
				if($data["ag_occular_drug"] == 'fdbATIngredient'){
					$typeAllergy = 'Ingredient';
				}
				if($data["ag_occular_drug"] == 'fdbATAllergenGroup'){
					$typeAllergy = 'Allergen';
				}

				if(!empty($data["reactions"])){$data["comments"].=", ".$data["reactions"];}

				?>
				<tr>
					<td style="width:100px;" class="paddingTop10 pdl5"><?php echo $typeAllergy; ?>&nbsp;</td>
					<td style="width:170px;" class="paddingTop10"><?php echo $data["title"]; ?>&nbsp;</td>
					<!--<td style="width:25%;" ><?php echo ucwords($data["reactions"]); ?>&nbsp;</td>-->
					<td style="width:160px;" class="paddingTop10"><?php echo ucwords(str_ireplace(';','',trim($data["comments"]))); ?>&nbsp;</td>

					<td style="width:70px;" class="paddingTop10"><?php print $data["allergy_status"];?>&nbsp;</td>
					<td style="width:100px;" class="paddingTop10">
						<?php if($data["begdate"]!="0000-00-00"){echo get_date_format($data["begdate"],1);} ?>&nbsp;
					</td>
					<td style="width:103px;" class="paddingTop10"><?php print $data["ccda_code"];?></td>
				</tr>
			<?php }?>
		</table>
	   <?php }
	}

	//Medication ---------------------------------
function print_getMeds_clinic($pid=0,$arrAction,$arrReq=array(),$strDosToPrint="",$zFormId =''){

	//if dos is not empty then display according to dos
	if(!empty($strDosToPrint)){
		$strDosPhrase = " AND begdate IN (".$strDosToPrint.") ";
	}
	$arrIn = array_keys($arrAction);
	$strIn = implode(',',$arrIn);
	//--- GET MEDICATION DATA ---
	if($fTestAct == "Active"){
		$getMedication = "select type,title,sig,qty,allergy_status,referredby,destination,begdate,enddate,comments, sites ,compliant,
				date_format(begdate,'".get_sql_date_format('','y','/')."') as begdate from lists where pid='".$pid."' and
				allergy_status = 'Active' and type in ($strIn) ".$strDosPhrase." order by id";
	}else{
		$getMedication = "select type,title,sig,qty,allergy_status,referredby,destination,begdate,enddate,comments,  sites ,compliant,
				date_format(begdate,'".get_sql_date_format('','y','/')."') as begdate from lists where pid='".$pid."'
				and type in ($strIn) and allergy_status != 'Deleted' ".$strDosPhrase." order by id";
	}
	if($getMedication != ""){
		$rsGetMedication = imw_query($getMedication);
		while($rowMedication = imw_fetch_array($rsGetMedication))	{
			$dataFinal[] = $rowMedication;
		}
	}
	if($strDosToPrint != ""){
		$getMedicationArc = "select cgha.lists
								from
								chart_genhealth_archive cgha join chart_master_table cmt
								on cgha.form_id = cmt.id
								where cgha.patient_id='".$pid."' and
								cmt.date_of_service IN (".$strDosToPrint.")";
		if($zFormId != ''){
			$getMedicationArc = "	select lists
								from
								chart_genhealth_archive
								where patient_id='".$pid."' and
								form_id = '".$zFormId."'";
		}
	}
	if($getMedicationArc != ""){
		$rsGetMedication = imw_query($getMedicationArc);

		if(imw_num_rows($rsGetMedication) > 0 && (@in_array("Medication List",$arrReq)|| @in_array("Medical History",$arrReq)) ){
		$dataFinal = array();
		while($row = imw_fetch_assoc($rsGetMedication)){
			$arrList = unserialize($row['lists']);
			foreach($arrList as $arrData){
				foreach($arrData as $data){
					if(in_array($data['type'],$arrIn)){
						if($arrAction[$data['type']] == "Active" && $data['allergy_status'] == 'Active'){
							if($data!='')
							$dataFinal[] = $data;
						}
						elseif($arrAction[$data['type']] == "All" && $data['allergy_status'] != 'Deleted'){
							if($data!='')
							$dataFinal[] = $data;
						}
					}
				}
			}
		}//pre($dataFinal);die();
	}
	}

	if(imw_num_rows($rsGetMedication) > 0){
		if(count($dataFinal) >0 ){
	?>
	<table style="width:750px;" cellpadding="0" cellspacing="0">
		<tr>
			<td colspan="8" class="bluelne" height="1" style="width:750px;">&nbsp;
</td>
		</tr>
		<tr>
			<td colspan="8" height="2"></td>
		</tr>
		<tr>
			<td colspan="8" class="bluehed text_cap paddingTop10">MEDICATION LIST</td>
		</tr>
		<tr>
			<td class="text_lable paddingTop10 pdl3" style="width:8px;">Name</td>
			<td class="text_lable paddingTop10" style="width:80px;">Eye</td>
			<td class="text_lable paddingTop10" style="width:80px;">Dosage</td>
			<td class="text_lable paddingTop10" style="width:80px;">Sig</td>
			<td class="text_lable paddingTop10" style="width:70px;">Qty</td>
            <td class="text_lable paddingTop10" style="width:80px;">Compliant</td>
			<td class="text_lable paddingTop10" style="width:90px;">Date Started</td>
			<td class="text_lable paddingTop10" style="width:80px;">Status</td>
		</tr>
		<?php
		$o=$s=0;

		foreach($dataFinal as $data)
		{
			if($data["type"]==4){
				$OcularArr[] = $data;
			}

			if($data["type"]==1){
				$SystemicArr[] = $data;
			}
		}
		//pre($OcularArr);	die();
		//echo $arrAction[1];die();
				if(count($OcularArr)>0){
				?>
                <tr>
                    	<td colspan="8" class="paddingTop10 tb_subheading">Ocular</td>
                  </tr>
                   <?php foreach($OcularArr as $data){
							if($data["compliant"] == 2){
									$style = "font-weight:bold; font-style:italic";
							}
							else $style = "";
					   if($data['allergy_status']=="Active" && $arrAction[4]!="All" ){
					    ?>

                  <tr>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10 pdl5"><?php echo $data["title"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10">
						<?php
                                switch($data["sites"])
								{
									case "1":
									echo "Left Eye";
									break;
									case "2":
									echo "Right Eye";
									break;
									case "3":
									echo "Both Eyes";
									break;
									case "4":
									echo "By Mouth";
									break;
                                }
                        ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["destination"]; ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["sig"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["qty"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" align="center" class="paddingTop10"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0") { echo "No"; } ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10">
                            <?php if($data["begdate"]!="0000-00-00"){echo $data["begdate"];} ?>&nbsp;
                        </td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
                    </tr>
                   <?php }
				   	else if($arrAction[4]=="All"){
					  ?>

                  <tr>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10 pdl5"><?php echo $data["title"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10">
						<?php
                                switch($data["sites"])
								{
									case "1":
									echo "Left Eye";
									break;
									case "2":
									echo "Right Eye";
									break;
									case "3":
									echo "Both Eyes";
									break;
									case "4":
									echo "By Mouth";
									break;
                                }
                        ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["destination"]; ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?><?php echo $style;?>" class="paddingTop10"><?php echo $data["sig"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["qty"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" align="center" class="paddingTop10"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0") { echo "No"; } ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10">
                            <?php if($data["begdate"]!="0000-00-00"){echo $data["begdate"];} ?>&nbsp;
                        </td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
                    </tr>
                   <?php
					}

				   }

		}
		if(count($SystemicArr)>0){
			?>

				<tr>
                    	<td colspan="8" class="paddingTop10 tb_subheading">Systemic</td>
                  </tr>
                   <?php  foreach($SystemicArr as $data){
				   			if($data["compliant"] == 2){
									$style = "font-weight:bold; font-style:italic";
							}
							else $style = "";
				   		if($data['allergy_status']=="Active" && $arrAction[1]!="All" ){
				   ?>

                  <tr>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10 pdl5"><?php echo $data["title"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10">
						<?php
                                switch($data["sites"])
								{
									case "1":
									echo "Left Eye";
									break;
									case "2":
									echo "Right Eye";
									break;
									case "3":
									echo "Both Eyes";
									break;
									case "4":
									echo "By Mouth";
									break;
                                }
                        ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["sig"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["qty"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" align="center" class="paddingTop10"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0") { echo "No"; } ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10">
                            <?php if($data["begdate"]!="0000-00-00"){echo $data["begdate"];} ?>&nbsp;
                        </td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
                    </tr>
                   <?php }else if($arrAction[1]=="All"){

				   ?>

                  <tr>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10 pdl5"><?php echo $data["title"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10">
						<?php
                                switch($data["sites"])
								{
									case "1":
									echo "Left Eye";
									break;
									case "2":
									echo "Right Eye";
									break;
									case "3":
									echo "Both Eyes";
									break;
									case "4":
									echo "By Mouth";
									break;
                                }
                        ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo str_ireplace('mmg','mg',$data["destination"]); ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["sig"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["qty"]; ?>&nbsp;</td>
                        <td style="width:80px;<?php echo $style;?>" align="center" class="paddingTop10"><?php if($data["compliant"]=="1") { echo "Yes"; } else if($data["compliant"]=="0") { echo "No"; } ?>&nbsp;</td>
                        <td style="width:100px;<?php echo $style;?>" class="paddingTop10">
                            <?php if($data["begdate"]!="0000-00-00"){echo get_date_format($data["begdate"],1);} ?>&nbsp;
                        </td>
                        <td style="width:80px;<?php echo $style;?>" class="paddingTop10"><?php echo $data["allergy_status"]; ?>&nbsp;</td>
                    </tr>
                   <?php

					   }
				   }

				}?>

	</table>
	<?php

	}
	}
	else{
		$strNoMedication = commonNoMedicalHistoryAddEdit($moduleName="Medication",$moduleValue="",$mod="get");
		if($strNoMedication == "checked"){
		/* 	?>
		<table   style="width:740px;" cellpadding="0" cellspacing="0">
		     <tr>
				<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
		    </tr>
			<tr>
				<td height="2"></td>
			</tr>
			<tr>
				<td class="bluehed text_cap paddingTop10">MEDICATION LIST</td>
		    </tr>
		    <tr>
				<td >&nbsp;&nbsp;No Medications</td>
		    </tr>
		</table>
		<?php */
		}
	}
}


function getLegalSignature($form_information_id,$patient_id,$consent_form_id,$consent_form_content){
	global $ChartNoteImagesString;
	//START CODE TO SET NEW CLASS TO CONSENT FORMS
	$htmlFolder = "html2pdf";
	$htmlV2Class = false;
	$htmlFilePth = "html2pdf/index.php";
	if(constant("CONSENT_FORM_VERSION")=="consent_v2") {
		$htmlFolder = "new_html2pdf";
		$htmlV2Class=true;
		$htmlFilePth = "new_html2pdf/createPdf.php";
	}
	//END CODE TO SET NEW CLASS TO CONSENT FORMS
	$qry = imw_query("select signature_image_path,signature_count from consent_form_signature
				where form_information_id = '$form_information_id' and patient_id = '$patient_id'
				and consent_form_id = '$consent_form_id' and signature_status = 'Active' order by signature_count");
	$sigDetail = array();
	while($row = imw_fetch_array($qry)){
		$sigDetail[] = $row;
	}
	if (count($sigDetail) > 0){
	$sig_con = array();
		for($s=0;$s<count($sigDetail);$s++){
			$sig_con[$s] = $sigDetail[$s]['signature_image_path'];
			$signature_count[$s] = $sigDetail[$s]['signature_count'];
		}

	$deletePath=array();
		for($ps=0;$ps<count($sig_con);$ps++){
		$row_arr = explode('{START APPLET ROW}',$consent_form_content);
		$sig_arr = explode('{SIGNATURE}',$row_arr[0]);
		$sig_data = '';
		$ds=0;
		$coun=0;
		for($s=1;$s<count($sig_arr);$s++){
				if($s==$signature_count[$ds]){
					$postData = $sig_con[$coun];
					$path1 = split("/",$postData);
						if(isset($path1[1]) && !empty($path1[1])){
							if($htmlV2Class==true && file_exists($postData)) {
							$sig_data = '<table>
							<tr>
								<td>
									<img src="'.$postData.'" height="80" width="240">
								</td>
							</tr></table>';
							$ChartNoteImagesString[]=$postData	;
							}else{
							$sig_data = '<table>
							<tr>
								<td>
									<img src="'.$path1[1].'" height="80" width="240">
								</td>
							</tr></table>';
							$ChartNoteImagesString[]=$path1[1];
							}
							$str_data = $sig_arr[$s];
							$sig_arr[$s] = $sig_data;
							$sig_arr[$s] .= $str_data;
							$hiddenFields[] = true;

						}
						$coun++;
					$ds++;
				}
		}
		$consent_form_content = implode(' ',$sig_arr);
		$content_row = '';
		for($ro=1;$ro<count($row_arr);$ro++){
			if($row_arr[$ro]){
				$sig_arr1 = explode('{SIGNATURE}',$row_arr[$ro]);
				$td_sign = '';
				for($t=0;$t<count($sig_arr1)-1;$t++,$ds++){
					$sig_arr1[$t] = str_ireplace('&nbsp;','',$sig_arr1[$t]);
					$td_sign .= '
						<td align="left">
							<table >
								<tr><td>'.$sig_arr1[$t].'</td></tr>
								<tr>
									<td style="border:solid 1px" bordercolor="#FF9900">
										{SIGNATURE}
									</td>
								</tr>
							</table>
						</td>
					';
					$s++;
					$hiddenFields[] = true;
				}
				$content_row .= '
					<table width="145"  align="center">
						<tr>
							'.$td_sign.'
						</tr>
					</table>
				';
			}
		}
			$jh = 1;
			$consent_form_content .= $content_row;
			}
	}
	else
	{
		$consent_form_content = str_ireplace('{SIGNATURE}',"",$consent_form_content);
	}
	return $consent_form_content;
}
///////////Get Signautre Signed in Consent Form/////////////



////////Atart Function To Replace To Template TextBoxes With There Values/////////
function formatTextBoxesAndTextArea($consent_form_content){
	//START CODE TO SET NEW CLASS TO CONSENT FORMS
	$htmlFolder = "html2pdf";
	$htmlV2Class = false;
	$htmlFilePth = "html2pdf/index.php";
	if(constant("CONSENT_FORM_VERSION")=="consent_v2") {
		$htmlFolder = "new_html2pdf";
		$htmlV2Class=true;
		$htmlFilePth = "new_html2pdf/createPdf.php";
	}
	//END CODE TO SET NEW CLASS TO CONSENT FORMS
			$consent_form_content = str_ireplace('&nbsp;',' ',$consent_form_content);
			if($htmlV2Class==false) {
				$consent_form_content = str_ireplace('</div>','<br>',$consent_form_content);
			}
			$consent_form_content = str_ireplace("text' name='medium' size='60' maxlength='60'>",'',$consent_form_content);
			$inputVal = explode('<input',$consent_form_content);

			$consent_form_content = $inputVal[0];
			for($i=1;$i<count($inputVal);$i++){
				$pos = strpos($inputVal[$i],'value="');
				$str = substr($inputVal[$i],$pos+7);
				$pos1 = strpos($str,'"');
				$inputVals = substr($str,0,$pos1);
				$pos2 = strpos($str,'>');
				$lastVal = substr($str,$pos2+1);
				$consent_form_content .= $inputVals.' '.$lastVal;
			}
			$inputValTextarea=explode('<textarea rows="2" cols="100" name="large',$consent_form_content);
			if(is_array($inputValTextarea)){
				for($i=1;$i<count($inputValTextarea);$i++){
					$consent_form_content = str_ireplace('<textarea rows="2" cols="100" name="large">','',$consent_form_content);
					$consent_form_content = str_ireplace('<textarea rows="2" cols="100" name="large'.$i.'">','',$consent_form_content);
					$consent_form_content = str_ireplace('</textarea>','',$consent_form_content);
			 }
		}

		return $consent_form_content;
}
////////End Function To Replace To Template TextBoxes With There Values/////////

function printLegal_main(){
?>
	<table  cellpadding="2" cellspacing="0" style="width:700px;">
	<tr>
		<td>
			<?php
			$sqlLegalForm="SELECT * FROM `patient_consent_form_information` where patient_id='".$_SESSION['patient']."' and movedToTrash='0' ORDER BY `form_information_id` DESC";
			$resLegalForm=imw_query($sqlLegalForm) or print(imw_error());
			if($resLegalForm){
			if(imw_num_rows($resLegalForm)>0){
				while($resRowLegalForms=imw_fetch_array($resLegalForm)){?>
					<table>
						 <tr height="25px">
							<td valign="middle" class="bluelne" height="1" style="width:750px;">&nbsp;
							</td>
						  </tr>
						  <tr>
							<td height="2"></td>
						  </tr>
						 <tr height="25px">
							<td valign="middle" class="bluehed text_cap paddingTop10">
								<?php echo strtoupper($resRowLegalForms["consent_form_name"]);?>
							</td>
						  </tr>
					</table>
					<?php
					$form_information_id=$resRowLegalForms["form_information_id"];
					$consent_form_content=stripslashes(html_entity_decode($resRowLegalForms["consent_form_content_data"]));
					$consent_form_content=$this->formatTextBoxesAndTextArea($consent_form_content);
					$consent_form_id=$resRowLegalForms["consent_form_id"];
					$patient_id=$resRowLegalForms["patient_id"];
					$legalData=$this->getLegalSignature($form_information_id,$patient_id,$consent_form_id,$consent_form_content);
					//-------IMAGES PATH REPLACEMENT WORKS STARTS HERE--------
					$legalData = str_ireplace($GLOBALS['webroot']."/data/".PRACTICE_PATH,'../../data/'.PRACTICE_PATH,$legalData);

					$imgALLReplace=$GLOBALS["include_root"].'/common/new_html2pdf/';
					$legalData= str_ireplace($GLOBALS['webroot'].'/interface/common/new_html2pdf/',$imgALLReplace,$legalData);

					$sigPlusimgReplace=$GLOBALS["include_root"].'/SigPlus_images/';
					$legalData= str_ireplace($GLOBALS['webroot'].'/interface/SigPlus_images/',$sigPlusimgReplace,$legalData);
					echo("<p>".stripcslashes(html_entity_decode($legalData))."</p>");
					}
				}
			}

			?>
	</td>
	</tr>
	</table>
<?php

}

public function print_allGen($pid=0,$arrReq=array(),$strDosToPrint="",$exlusionArr=array()){

	global $ChartNoteImagesString;
//Include general Health,Immunization and Ocular Medical history//
//include(dirname(__FILE__)."/immunization_ocular_print.php");
//Include general Health,Immunization and Ocular Medical history//
//if dos is not empty then display according to dos
//--- GET ALL OCULAR DATA ----
$arrMEDHX = array();
$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '0',"Filed_Label_Og_Val"=> "None");
$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Glasses");
$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Contact Lenses");
$arrMEDHX [] = array("Filed_Label"=> "you_wear","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glasses And Contact Lenses");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Blurred or Poor Vision");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Poor Night Vision");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Gritty Sensation");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Trouble Reading Signs");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Glare From Lights");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Tearing");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Poor Depth Perception");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Halos Around Lights");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Itching or Burning");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Trouble Identifying Colors");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "See Spots or Floaters");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Eye Pain");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "Double Vision");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "See Light Flashes");
$arrMEDHX [] = array("Filed_Label"=> "eye_problems","Filed_Label_Val"=> '15',"Filed_Label_Og_Val"=> "Redness or Bloodshot");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration :");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
$arrMEDHX [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Keratoconus:");
$arrMEDHX [] = array("Filed_Label"=> "chronicDesc","Filed_Label_Val"=> 'other',"Filed_Label_Og_Val"=> "other:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Dry Eyes:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Macula Degeneration:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Glaucoma:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Retinal Detachment:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Cataracts:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Keratoconus:");
$arrMEDHX [] = array("Filed_Label"=> "chronicRelative","Filed_Label_Val"=> 'other',"Filed_Label_Og_Val"=> "other:");

	$getAllergies = "Select * from ocular where patient_id='".$pid."' LIMIT 1";
	$rsGetAllergies = imw_query($getAllergies);
	if (imw_num_rows($rsGetAllergies) > 0 && (@in_array("ocular",$arrReq))){
	$dataFinal = array();
	$row=imw_fetch_assoc($rsGetAllergies);
	$arrList[]=$row;//pre($arrList);die();
	foreach($arrList[0] as $key=>$val){
		if($val!=''){
			$dataFinal[$key] = $val;
		}
	}
	if(count($dataFinal) > 0 &&  (!in_array("ocular",$exlusionArr)))
	{ ?>

        <table style="width:700px;"  cellpadding="0" cellspacing="0">
            <tr>
                <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
			</tr>
			<tr>
				<td height="2"></td>
			</tr>
			<tr>
                <td class="bluehed text_cap paddingTop10">
                    Ocular <?php
					foreach($dataFinal as $k=>$v)
					{
						$getrelval = explode("~|~",$dataFinal['chronicDesc']);
						$chronicRelativeVal = explode("~|~",$dataFinal['chronicRelative']);


						$tArr1 = explode("~!!~~",$getrelval[1]);
						$tArr2 = explode("~!!~~",$chronicRelativeVal[0]);

						unset($dataFinal['chronicRelative']);

						for($j=0;$j<count($tArr1);$j++)
						{
							$a = count($tArr1);
							$b = $a-3;
												$tArr3 = $tArr2[$j].",".$tArr1[$j]."~!!~~";
							if($j==0)
							{
								//$tArr3 = str_replace(($b).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}
							if($j==1)
							{
								//$tArr3 = str_replace(($b+1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}
							if($j==2)
							{
								//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}
							if($j==3)
							{
								//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}
							if($j==4)
							{
								//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}
							if($j==5)
							{
								//$tArr3 = str_replace(($j-1).":*:","",$tArr2[$j].",".$tArr1[$j]."~!!~~");
							}

							$dataFinal = $this->array_push_assoc($dataFinal,'chronicRelative',$tArr3);
						}
						break;
					}
						//pre($dataFinal);
					?>
                </td>
            </tr>

        <?php
		foreach ($dataFinal as $key => $value) {

				switch ($key):
				case "you_wear":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$youWearValue = $orignalValue[0];
				break;
				case "last_exam_date":
					$lastExamDateValue = $this->isDate($value);
				break;
				case "eye_problems":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$eyeProblemValue = $orignalValue[0];

				break;
				case "any_conditions_you":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyConditionYouValue = $orignalValue[0];
				break;
				case "any_conditions_relative":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHX,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyConditionRelativeValue = $orignalValue[0];
					break;
				case "chronicDesc":
					$delimiter = '~|~';
					$orignalValue = get_set_pat_rel_values_retrive($value,"pat",$delimiter);
					$orignalValue = $this->getOrignalValWt2Sep($orignalValue,$orignalValue,$arrMEDHX,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$chronicDescValue = $orignalValue[0];

				break;
				case "chronicRelative":
					$case="chronicRelative";
					$delimiter = '~|~';
					$hifen = ' - ';
					$orignalValue = $this->getOrignalValWt2SepChronicRelative($value,$value,$arrMEDHX,$key,$case);
					$orignalValue = explode("~~~~",$orignalValue);
					$chronicRelativeValue = $orignalValue[0];
				break;
				case "eye_problems_other":
					$eyeProbOtherValue = $this->isDate($value);
				break;
				case "OtherDesc":
					$otherDescValue = $this->isDate($value);
				break;

				endswitch;
				?>
	<?php }	if(count($dataFinal)>0){ ?>
         <?php if($lastExamDateValue!="" || $youWearValue!=""){?>
         		<tr>
                	<td style="width:714px;">
                      <table style="width:714px;" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="text_lable paddingTop10" style="width:714px;" colspan="4">
                                Eye History :-
                            </td>
                        </tr>
                        <tr>
                            <td style="width:100px;" class="text_lable paddingTop10">
                                Patient Wears:
                            </td>
                            <td style="width:200px;" class="paddingTop10">
                                <?php echo $youWearValue; ?>
                            </td>
                            <td style="width:200px; text-align:right;" class="text_lable paddingTop10">
                                <!--Last eye exam date:&nbsp;-->
                            </td>
                            <td style="width:232px;" class="paddingTop10">
                                <?php //echo get_date_format($lastExamDateValue,'mm-dd-yyyy'); ?>
                            </td>
                        </tr>
                        </table>
                       </td>
                    </tr>
               <?php } ?>
               <?php

			   if($eyeProblemValue||$eyeProbOtherValue){?>
               	<tr>
                	<td style="width:714px;">

                        <table style="width:714px;" cellpadding="0" cellspacing="0">
                            <tr>
                                <?php if($eyeProblemValue){ ?>
                                <td class="text_lable paddingTop10" style="width:150px;">
                                  Eye problems :-
                                </td>
                                <td style="width:200px;" class="paddingTop10" >
                                    <?php echo $eyeProblemValue; ?>
                                </td>
                                <?php }?>
                                <?php if($eyeProbOtherValue){?>
                                <td  class="text_lable paddingTop10" style="width:150px;">
                                    Other eye problems :-
                                </td>
                                <td style="width:200px;" class="paddingTop10">
                                    <?php echo $eyeProbOtherValue; ?>
                                </td>
                                <?php }?>
                            </tr>
                        </table>
                    </td>
                  </tr>
                    <?php }?>
                    <?php if($chronicDescValue || $chronicRelativeValue){?>
                   	<tr>
                		<td style="width:714px;">

                            <table style="width:714px;" cellpadding="0" cellspacing="0">
                                <tr>
                                    <?php if($chronicDescValue){?>
                                    <td class="text_lable paddingTop10" style="width:300px;">
                                        Patient:-
                                    </td>
                                    <?php }?>
                                    <?php if($chronicRelativeValue){?>
                                    <td class="text_lable paddingTop10"  style="width:370px;">
                                        Blood Relative :-
                                    </td>
                                    <?php }	?>
                                </tr>
                                <tr>
                                    <?php if($chronicDescValue){ ?>
                                    <td style="width:350px;" class="paddingTop10">
                                       <?php echo $chronicDescValue; ?>
                                    </td>
                                    <?php }?>
                                    <?php if($chronicRelativeValue){ ?>
                                    <td style="width:350px;" class="paddingTop10">
                                        <?php echo $chronicRelativeValue; ?>
                                    </td>
                                    <?php }?>
                                </tr>
                            </table>
                        </td>
                     </tr>
                    <?php }?>
		<?php }
	?>
    	</table>
    <?php
	}}

// -----GET GENERAL HEALTH DATA
		$delimiter = '~|~';
		//$hifen = ' - ';
		$hifen="";
		$arrMEDHXGenralHealth = array();
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "High Blood Pressure");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Heart Problem");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Arthritis");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Lung Problems");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Stroke");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Thyroid Problems");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diabetes");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Ulcers");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "LDL");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_you","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Cancer");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "High Blood Pressure :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Heart Problem :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Arthritis :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Lung Problems :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Stroke :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Thyroid Problems :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diabetes :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Ulcers :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "LDL :");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_relative","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Cancer :");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_others_both","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Other");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "any_conditions_others_both","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Other");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Fever");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Weight Loss");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Rash");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Skin Disease");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_const","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Fatigue");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Sinus Infection");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Post Nasal Drips");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Runny Nose");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Dry Mouth");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_head","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Deafness");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Cough");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Bronchitis");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Shortness of Breath");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Asthma");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Emphysema");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "COPD");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_resp","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "TB");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Chest Pain");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Congestive Heart Failure");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Irregular Heart beat");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Shortness of Breath");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "High Blood Pressure");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Low Blood Pressure");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_card","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Pacemaker/defibrillator");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Vomiting");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Ulcers");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Diarrhea");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Bloody Stools");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Hepatitis");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Jaundice");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_gastro","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Constipation");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Genital Ulcers");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Discharge");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Kidney Stones");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_genit","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Blood in Urine");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_aller","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Seasonal Allergies");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_aller","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Hay Fever");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Headache");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Migraines");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Paralysis Fever");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Joint Ache");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Seizures");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Numbness");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Faints");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Stroke");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Multiple Sclerosis");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Alzeihmer's Disease");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "Parkinson's Disease");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_neuro","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Dimentia");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Rashes");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Wounds");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Breast Lumps");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Eczema");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_intgmntr","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Dermatitis");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Depression");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Anxiety");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Paranoia");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Sleep Patterns");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Mental and/or emotional factors");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Alzeihmer's Disease");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Parkinson's disease");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_psychiatry","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Memory Loss");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Anemia");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Blood Transfusions");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Excessive Bleeding");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Purpura");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_blood_lymph","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Infection");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Pain");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Joint Ache");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Stiffness");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Swelling");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_musculoskeletal","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Paralysis Fever");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Mood Swings");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Constipation");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Polydipsia");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Hypothyroidism");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_endocrine","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Hyperthyroidism");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Vision loss");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Eye pain");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Double vision");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "review_eye","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Headache");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '1',"Filed_Label_Og_Val"=> "Negative for constitutional");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '2',"Filed_Label_Og_Val"=> "Negative for ear, nose, mouth & throat");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '3',"Filed_Label_Og_Val"=> "Negative for respiratory");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '4',"Filed_Label_Og_Val"=> "Negative for cardiovascular");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '5',"Filed_Label_Og_Val"=> "Negative for gastrointenstinal");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '6',"Filed_Label_Og_Val"=> "Negative for genitourinary");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '7',"Filed_Label_Og_Val"=> "Negative for allergic/immunologic");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '8',"Filed_Label_Og_Val"=> "Negative for neurological");

		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '9',"Filed_Label_Og_Val"=> "Negative for integumentary");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '10',"Filed_Label_Og_Val"=> "Negative for psychiatry");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '11',"Filed_Label_Og_Val"=> "Negative for hemotologic/lymphatic");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '12',"Filed_Label_Og_Val"=> "Negative for musculoskeletal");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '13',"Filed_Label_Og_Val"=> "Negative for endocrine");
		$arrMEDHXGenralHealth [] = array("Filed_Label"=> "negChkBx","Filed_Label_Val"=> '14',"Filed_Label_Og_Val"=> "Negative for eyes");
		$medDoctorValueGH=$genMedCommentsValueGH=$anyConditionYouValueGH=$relDescHighBpValueGH=
		$relDescHeartProbValueGH=$relDescLungProbValueGH=$relDescStrokeProbValueGH=$relDescThyroidProbValueGH=
		$relDescArthritisProbValueGH=$relDescUlcersProbValueGH=$relDescLDLValueGH=$relDescCancerProbValueGH=
		$descValueGH=$descRValueGH=$anyConditionOtherValueGH=$ghRelDescOthersValueGH=$anyReviewConstValueGH=
		$reviewHeadValueGH=$reviewConstOtherValueGH=$reviewHeadOtherValueGH=$reviewRespValueGH=$reviewCardValueGH=
		$reviewRespOtherValueGH=$reviewCardOtherValueGH=$reviewGastroValueGH=$reviewGenitValueGH=
		$reviewGastroOtherValueGH=$reviewGenitOtherValueGH=$reviewAllerValueGH=$reviewNeuroValueGH=
		$reviewAllerOtherValueGH=$reviewNeuroOtherValueGH=$descValueDHB=$descValueDA=$descValueDLP=
		$descValueDS=$descValueDTP=$descValueDU=$descValueDC=$descValueDHP=$descValueDGPP=$descValueDLDL=
		$descValueDV=$anyConditionYouValueInDb=$subArthritisProbValueGH='';
 		$getGeneral = "Select * from general_medicine where patient_id = '".$pid."'";

		$rsGetGeneral = imw_query($getGeneral)or die(imw_error());

	$rowGen=imw_fetch_assoc($rsGen);
	$arrList1[]=$rowGen;
	$dataFinal = array();$arrList = array();
	if(imw_num_rows($rsGetGeneral) > 0 && (@in_array("general_health",$arrReq))){
		$rowGen = imw_fetch_assoc($rsGetGeneral);

			$arrList[] = ($rowGen);
				foreach($arrList as $keyList=>$valList){
					if(is_array($valList)){
						foreach($valList as $keyData=>$valData)
						{
								if(is_array($valData)){
									foreach($valData as $key=>$val)
										if($val != '')
										$dataFinal[$key] = $val;
								}else{
									if($valData != '')
									$dataFinal[$keyData] = $valData;
								}
						}
					}
					else
					if($valList != '')
					$dataFinal[$keyList] = $valList;
				}

	if(count($dataFinal) > 0){?>
        <table  style="width:750px;" cellpadding="0" cellspacing="0">
			<tr>
                <td  colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;
                </td>
            </tr>
			<tr>
				 <td  colspan="2" height="2"></td>
			</tr>
		   <tr>
                <td colspan="2" class="bluehed text_cap paddingTop10">
                    GENERAL HEATLH <?php //pre($dataFinal); ?>
                </td>
            </tr>
            <tr>
            	<td></td>
                <td></td>
            </tr>

        <?php
		foreach ($dataFinal as $key => $value) {
			switch ($key):
				case "med_doctor":
					$medDoctorValueGH = $value;
					break;
				case "any_conditions_you":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyConditionYouValueGH =$orignalValue[0];
					$anyConditionYouValueInDb = $value;
				break;
				case "any_conditions_you_n":
					$orignalValue_n = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,"any_conditions_you");
					$orignalValue_n = explode("~~~~",$orignalValue_n);
					$anyConditionYouValueGH_n = $orignalValue_n[0];
					//$anyConditionYouValueInDb = $value;
				break;
				case "any_conditions_relative":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyConditionRelativeValueGH = $orignalValue[0];
					break;
				case "any_conditions_others_both":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyConditionOtherBothValueGH = $orignalValue[0];
					break;
				case "any_conditions_others":
					$anyConditionOtherValueGH = $this->isDate($value);
					break;
				case "review_sys":
					$review_sys = $value;
					if(!empty($review_sys)){
						$ar_review_sys = json_decode($review_sys, true);
						$ar_tmp = array('review_intgmntr',	'review_psychiatry', 'review_blood_lymph',
									'review_musculoskeletal','review_endocrine','review_eye');
						foreach($ar_tmp as $k => $v){
							$value = $ar_review_sys[$v];
							if(!empty($value)){
								$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$v);
								$orignalValue = explode("~~~~",$orignalValue);
								$vgh = $v."GH";
								$$vgh = "".$orignalValue[0];
							}
							$vother = $v."_others";
							if(!empty($ar_review_sys[$vother])){
								$vothr = $v."OtherGH";
								$$vothr = $ar_review_sys[$vother];
							}
						}
					}
					break;
				case "review_const":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$anyReviewConstValueGH = $orignalValue[0];
					break;
				case "review_const_others":
					$reviewConstOtherValueGH = $this->isDate($value);
					break;
				case "review_head":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewHeadValueGH = $orignalValue[0];
					break;
				case "review_head_others":
					$reviewHeadOtherValueGH = $this->isDate($value);
					break;
				case "review_resp":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewRespValueGH = $orignalValue[0];
					break;
				case "review_resp_others":
					$reviewRespOtherValueGH = $this->isDate($value);
					break;
				case "review_card":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewCardValueGH = $orignalValue[0];
					break;
				case "review_card_others":
					$reviewCardOtherValueGH = $this->isDate($value);
					break;
				case "review_gastro":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewGastroValueGH = $orignalValue[0];
					break;
				case "review_gastro_others":
					$reviewGastroOtherValueGH = $this->isDate($value);
					break;
				case "review_genit":
					$orignalValue = getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewGenitValueGH = $orignalValue[0];
					break;
				case "review_genit_others":
					$reviewGenitOtherValueGH = $this->isDate($value);
					break;
				case "review_aller":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewAllerValueGH = $orignalValue[0];
					break;
				case "review_aller_others":
					$reviewAllerOtherValueGH = $this->isDate($value);
					break;
				case "review_neuro":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$reviewNeuroValueGH = $orignalValue[0];
					break;
				case "review_neuro_others":
					$reviewNeuroOtherValueGH = $this->isDate($value);
					break;
				case "desc_u":
					$descValueGH = $this->isDate($value);
					break;
				case "desc_r":
					$descRValueGH = $this->isDate($value);
					break;
				case "genMedComments":
					$genMedCommentsValueGH = $this->isDate($value);
					break;
				case "relDescHighBp":

					$relDescHighBpValueGH =	($value) ? "<b>Yes</b> High Blood Pressure: " : "";
					$relDescHighBpValueGH .= $value;
					break;
				case "relDescHeartProb":
					$relDescHeartProbValueGH = ($value) ? "<b>Yes</b> Heart Problem: " : "";
					$relDescHeartProbValueGH .= $value;
					break;
				case "relDescLungProb":
					$relDescLungProbValueGH = ($value) ? "<b>Yes</b> Lung Problems: " : "";
					$relDescLungProbValueGH .= $value;
					break;
				case "relDescStrokeProb":
					$relDescStrokeProbValueGH = ($value) ? "<b>Yes</b> Stroke: " : "";
					$relDescStrokeProbValueGH .= $value;

					break;
				case "relDescThyroidProb":
					$relDescThyroidProbValueGH = ($value) ? "<b>Yes</b> Thyroid Problems: " : "";
					$relDescThyroidProbValueGH .= $value;
					break;
				case "relDescArthritisProb":
				//echo "<hr>".$value;die();
					$relDescArthritisProbValueGH = ($value) ? "<b>Yes</b> Arthritis: " : "";
					$relDescArthritisProbValueGH .= $value;
					break;
				case "sub_conditions_you":
					$subArthritisProbValueGH = $this->isDate($value);
					$subArthritisProbValueGH=str_replace(array("7.1","7.2"),array("RA","OA"),$subArthritisProbValueGH);
					break;
				case "relDescUlcersProb":
					$relDescUlcersProbValueGH = ($value) ? "<b>Yes</b> Ulcers: " : "";
					$relDescUlcersProbValueGH .= $value;
					break;
				case "relDescLDL":
					$relDescLDLValueGH = ($value) ? "<b>Yes</b> LDL: " : "";
					$relDescLDLValueGH .= $value;
					break;
				case "relDescCancerProb":
					$relDescCancerProbValueGH = ($value) ? "<b>Yes</b> Cancer: " : "";
					$relDescCancerProbValueGH .= $value;
					break;

				case "ghRelDescOthers":
					$ghRelDescOthersValueGH = $value;
					break;
				case "negChkBx":
					$orignalValue = $this->getOrignalValComa($value,$value,$arrMEDHXGenralHealth,$key);
					$orignalValue = explode("~~~~",$orignalValue);
					$negChkBxValueGH = $orignalValue[0];
					break;
				case "desc_high_bp":
					$descValueDHB = $this->isDate($value);
					break;
				case "desc_arthrities":
					$descValueDA = $this->isDate($value);
					break;
				case "desc_lung_problem":
					$descValueDLP = $this->isDate($value);
					break;
				case "desc_stroke":
					$descValueDS = $this->isDate($value);
					break;
				case "desc_thyroid_problems":
					$descValueDTP = $this->isDate($value);
					break;
				case "desc_ulcers":
					$descValueDU = $this->isDate($value);
					break;
				case "desc_cancer":
					$descValueDC = $this->isDate($value);
					break;
				case "desc_heart_problem":
					$descValueDHP = $this->isDate($value);
					break;
				case "desc_genPreviousProblem":
					$descValueDGPP = $this->isDate($value);
					break;
				case "desc_LDL":
					$descValueDLDL = $this->isDate($value);
					break;
				case "diabetes_values":
					$descValueDV = $this->isDate($value);
					break;
			endswitch;
		}

		//pre($dataFinal);

		if(count($dataFinal)>0){  ?>
          <?php if($medDoctorValueGH){ ?>
                <tr>
                    <td class="paddingTop10" style="width:350px;">
                        <b>Primary Care Doctor :- </b><?php echo $medDoctorValueGH; ?>
                    </td>
                    <td class="paddingTop10" style="width:350px;">
                    <?php
					 $adoValue = $this->print_getPatientInfo($pid);
					 if($adoValue[0]['ado_option'])
					 { ?>
                    	<b>Advance Directive:</b>&nbsp;<?php
						echo $adoValue[0]['ado_option'];

						/* image code start */
						$getScanID = "select * from ".constant("IMEDIC_SCAN_DB").".scans where patient_id = '".$dataFinal['patient_id']."' and form_id='0' and image_form = 'ptInfoMedHxGeneralHealth'";
						//echo $getScanID;

                        $queryId = imw_query($getScanID);

                        $arr = $this->return_records_array_mysql($queryId);

                        $scan_id = $arr[0]["scan_id"];

						//echo  "http://localhost".$GLOBALS['rootdir'].$arr[0]['file_path'];

		$getImageQry = imw_query("SELECT image_name,file_path FROM ".constant("IMEDIC_SCAN_DB").".scans WHERE scan_id = '$scan_id'");
		$getImageRow = imw_fetch_assoc($getImageQry);

		if(!empty($getImageRow["file_path"]))
		{
			$chkPth = urldecode($GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH').$getImageRow["file_path"]);
			$pth ="";

			if(file_exists($chkPth)){
				$pth = $GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH').$getImageRow["file_path"];

			}
			else{
				$arrFilePath = explode("/",$getImageRow["file_path"]);
				$fileNameNew = urlencode($getImageRow["image_name"]);
				$totIndices = count($arrFilePath);
				$arrFilePath[$totIndices-1] = $fileNameNew;
				$newFilePath = implode("/",$arrFilePath);
				$chkPth = urldecode($GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH').$newFilePath);
				if(file_exists($chkPth))
				{
					$pth = $GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH').$newFilePath;
				}
			}
				if(file_exists($GLOBALS['path_for_pdf'].$pth) && $pth) {
					echo "<br/><br/><div style='clear:both;' align='center'><img style='margin:10px 0;' height='200' width='300' src='".$GLOBALS['path_for_pdf'].$pth."' /></div><br/><br/>";
					$ChartNoteImagesString[]=$GLOBALS['path_for_pdf'].$pth;
				}
		}


						/* image code end */
						?>
					<?php } else { echo "&nbsp;"; }
					 ?>
                    </td>
                </tr>
               <?php }
			 $arrBloodSuger=$this->getPatientBloodSurger($pid);
			   if(count($arrBloodSuger)>0){?>
				<tr>
                	<td colspan="2" style="width:700px;">
                    	<table style="width:700px;" cellpadding="0" cellspacing="0">
                        	<tr>
                            	<td colspan="6" class="paddingTop tb_subheading">BLOOD SUGAR</td>
                            </tr>
                            <tr>
                                <td style="width:100px; font-weight:bold;" class="paddingTop pdl5">Date</td>
                                <td style="width:150px; font-weight:bold;" class="paddingTop">Blood Sugar(mg/dl)</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">HbA1c</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">Fasting</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">Time of Day</td>
                                <td style="width:140px; font-weight:bold;" class="paddingTop">Description</td>
                            </tr>
                            <tr>
                                <td style="width:100px;" class="paddingTop pdl5"><?php
								 if($arrBloodSuger['creation_date']){
									$dateBloodSuger=$arrBloodSuger['creation_date'];
									$dateBlood=explode(" ",$dateBloodSuger);
									list($yy,$mm,$dd)=explode("-",$dateBlood[0]);
									if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
										//echo $mm."-".$dd."-".$yy;
										echo get_date_format($dateBlood[0]);
									}
								} ?></td>
                                <td style="width:150px;" class="paddingTop"><?php if($arrBloodSuger['sugar_value']){ echo $arrBloodSuger['sugar_value'];} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($arrBloodSuger['hba1c_val']){ echo $arrBloodSuger['hba1c_val'];} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($arrBloodSuger['is_fasting']==1){ echo "Yes";}else if($arrBloodSuger['is_fasting']==0){echo "No";} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($arrBloodSuger['time_of_day']){ echo $arrBloodSuger['time_of_day'];} ?></td>
                                <td style="width:140px;" class="paddingTop"><?php if($arrBloodSuger['description']){ echo $arrBloodSuger['description'];} ?></td>
                            </tr>
                             <tr>
                            	<td colspan="6" style="width:700px;" class="paddingTop"><b>HbA1c Desc:&nbsp;</b><?php if($arrBloodSuger['hba1c']){ echo $arrBloodSuger['hba1c'];} ?></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <?php
				}
				$patientCholesterol=$this->getPatientcholesterol($pid);
				if(count($patientCholesterol)>0){
				?>
				<tr>
                	<td colspan="2" style="width:700px;">
                    	<table style="width:700px;"  cellpadding="0" cellspacing="0">
                        	<tr>
                            	<td colspan="6" class="paddingTop tb_subheading">CHOLESTEROL</td>
                            </tr>
                            <tr>
                                <td style="width:100px; font-weight:bold;" class="paddingTop pdl5">Date</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">Total</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">Trig.</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">LDL</td>
                                <td style="width:100px; font-weight:bold;" class="paddingTop">HDL</td>
                                <td style="width:200px; font-weight:bold;" class="paddingTop">Description</td>
                            </tr>
                            <tr>
                                <td style="width:100px;" class="paddingTop pdl5"><?php
								 if($patientCholesterol['creation_date']){
									$dateBloodSuger=$patientCholesterol['creation_date'];
									$dateBlood=explode(" ",$dateBloodSuger);
									list($yy,$mm,$dd)=explode("-",$dateBlood[0]);
									if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
										//echo $mm."-".$dd."-".$yy;
										echo get_date_format($dateBlood[0]);
									}
								} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($patientCholesterol['cholesterol_total']){ echo $patientCholesterol['cholesterol_total'];} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($patientCholesterol['cholesterol_triglycerides']){ echo $patientCholesterol['cholesterol_triglycerides'];} ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($patientCholesterol['cholesterol_LDL']){
									 $patientCholesterol['cholesterol_LDL'];
									 } ?></td>
                                <td style="width:100px;" class="paddingTop"><?php if($patientCholesterol['cholesterol_HDL']){ echo $patientCholesterol['cholesterol_HDL'];} ?></td>
                                <td style="width:200px;" class="paddingTop"><?php if($patientCholesterol['description']){ echo $patientCholesterol['description'];} ?></td>
                            </tr>
                        </table>



                    </td>
                </tr>
                <?php
				}
			    if($genMedCommentsValueGH){?>
                <tr>
                    <td class="paddingTop" colspan="2" style="width:740px;">
                        <b>Comments :-</b><?php echo $genMedCommentsValueGH; ?>
                    </td>
                </tr>
               <?php }?>

	    <?php
	    if(
		(!empty($anyConditionYouValueGH)) ||
		(!empty($anyConditionYouValueGH_n)) ||

		(!empty($relDescHighBpValueGH)) ||
		(!empty($relDescHeartProbValueGH)) ||
		(!empty($relDescLungProbValueGH)) ||
		(!empty($relDescStrokeProbValueGH)) ||
		(!empty($relDescThyroidProbValueGH)) ||
		(!empty($relDescArthritisProbValueGH)) ||
		(!empty($subArthritisProbValueGH)) ||
					(!empty($relDescUlcersProbValueGH)) ||
					(!empty($relDescLDLValueGH)) ||
					(!empty($relDescCancerProbValueGH)) ||
					(!empty($descValueGH)) ||
		(!empty($descRValueGH)) ||
		(!empty($anyConditionOtherValueGH)) ||
		(!empty($ghRelDescOthersValueGH)) ||
		(!empty($anyReviewConstValueGH)) ||
		(!empty($reviewHeadValueGH)) ||
		(!empty($reviewConstOtherValueGH)) ||
		(!empty($reviewHeadOtherValueGH)) ||
		(!empty($reviewRespValueGH)) ||
		(!empty($reviewCardValueGH)) ||
		(!empty($reviewRespOtherValueGH)) ||
		(!empty($reviewCardOtherValueGH)) ||
		(!empty($reviewGastroValueGH)) ||
		(!empty($reviewGenitValueGH)) ||
		(!empty($reviewGastroOtherValueGH)) ||
		(!empty($reviewGenitOtherValueGH)) ||
		(!empty($reviewAllerValueGH)) ||
		(!empty($reviewNeuroValueGH)) ||
		(!empty($reviewAllerOtherValueGH)) ||
		(!empty($reviewNeuroOtherValueGH)) ||
					(!empty($descValueDHB)) ||
					(!empty($descValueDA)) ||
					(!empty($descValueDLP)) ||
					(!empty($descValueDS)) ||
					(!empty($descValueDTP)) ||
					(!empty($descValueDU)) ||
					(!empty($descValueDC)) ||
					(!empty($descValueDHP)) ||
					(!empty($descValueDGPP)) ||
					(!empty($descValueDLDL)) ||
					(!empty($descValueDV))

	    ){?>
	    <!-- <tr>
            <td class="text_lable"  colspan="2">
                Any condition you or blood relative :-
            </td>
        </tr>-->
	<?php }?>

 <?php
 ///  ANY CONDITION

if($relDescHighBpValueGH || $relDescHeartProbValueGH || $relDescLungProbValueGH || $relDescStrokeProbValueGH ||
$relDescThyroidProbValueGH || $relDescArthritisProbValueGH || $subArthritisProbValueGH || $relDescUlcersProbValueGH ||
$relDescLDLValueGH || $relDescCancerProbValueGH||$anyConditionYouValueGH || $anyConditionYouValueGH_n) {

?>
	<tr>
	    <td style="width:370px;" class="text_lable paddingTop10">
	    <?php if($anyConditionYouValueGH || $anyConditionYouValueGH_n){?>
		Patient:-
	    <?php }?>
	    </td>
	    <td style="width:370px;" class="text_lable paddingTop10">
	    <?php if($relDescHighBpValueGH || $relDescHeartProbValueGH || $relDescLungProbValueGH || $relDescStrokeProbValueGH || $relDescThyroidProbValueGH || $relDescArthritisProbValueGH || $subArthritisProbValueGH || $relDescUlcersProbValueGH || $relDescLDLValueGH || $relDescCancerProbValueGH) {?>
		Blood relative :-
	    <?php }?>
	    </td>
	</tr>

<?php $arr_yes_no=array();
$anyConditionYouValueGHExplode=$anyConditionYouValueGHExplode_n='';
$anyConditionYouValueGHDesc='';
if($anyConditionYouValueGH || $anyConditionYouValueGH_n) {
	$delimiter='~|~';
	$chk_under_control_pat = get_set_pat_rel_values_retrive($dataFinal["chk_under_control"],'pat',$delimiter);
	$chk_under_control_arr = explode(",",$chk_under_control_pat);
//pre($chk_under_control_arr);
	$anyConditionYouValueGHDesc.='<table style="width:740px;" cellpadding="0" cellspacing="0">';
	$anyConditionYouValueGHExplode = explode('<br>',$anyConditionYouValueGH);
	foreach($anyConditionYouValueGHExplode as $val_GH){
		if(trim($val_GH)){
			$arr_yes_no[$val_GH]="<b>Yes</b>&nbsp;";
		}
	}
	$anyConditionYouValueGHExplode_n = explode('<br>',$anyConditionYouValueGH_n);
	foreach($anyConditionYouValueGHExplode_n as $val_GH_no){
		if(trim($val_GH_no)){
		$arr_yes_no[$val_GH_no]="<b>No</b>&nbsp;";
		}
	}
	$anyConditionYouValueGHExplode_arr = array_merge($anyConditionYouValueGHExplode,$anyConditionYouValueGHExplode_n);

	foreach($anyConditionYouValueGHExplode_arr as $acyValue) {
		if($acyValue==""){continue;}
		switch ($acyValue):
			case "High Blood Pressure":
				$stroke="";
				if(in_array("1",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$HBP = "No known medical condition"; //CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:170px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:195px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDHB,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Heart Problem":
				$stroke="";
				if(in_array("2",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Hrt_Prblem = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDHP,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Arthritis":
				$stroke="";
				if(in_array("3",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Arthrtis = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}

				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($subArthritisProbValueGH,"pat",$delimiter,$hifen).get_set_pat_rel_values_retrive($descValueDA,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Lung Problems":
				$stroke="";
				if(in_array("4",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$LPrblm = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDLP,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Stroke":
				$stroke="";
				if(in_array("5",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Strk = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDS,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Thyroid Problems":
				$stroke="";
				if(in_array("6",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$TPrblm = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDTP,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Diabetes":
				$stroke="";
				if(in_array("7",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Diabts = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueGH,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Ulcers":
				$stroke="";
				if(in_array("9",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Ulcr = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDU,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "LDL":
				$stroke="";
				if(in_array("8",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$L_D_L = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10 '>".get_set_pat_rel_values_retrive($descValueDLDL,"pat",$delimiter,$hifen)."</td></tr>";
				break;
			case "Cancer":
				$stroke="";
				if(in_array("11",$chk_under_control_arr)){
					$stroke="&nbsp;UC";
				}
				if(strpos($arr_yes_no[$acyValue],'No')){
					$Cancr = "No known medical condition";//CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX TRUE
				}
				$anyConditionYouValueGHDesc.="<tr><td style='width:164px;' class='paddingTop10'>".$arr_yes_no[$acyValue].$acyValue.":".$stroke."</td><td style='width:190px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDC,"pat",$delimiter,$hifen)."</td></tr>";
				break;
		endswitch;
	}

	//========================================================================================================================
	//BELOW CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX UNDER MED HX, IF ITS CHECKED, THEN ALL -VE CHECKBOXES WILL BE CHECKED AND NOW IT WILL BE DISPLAY ONLY KEYWORD "No known medical condition" RATHER THAN DISPLAYING ALL -VE VALUES.

	if(strpos($HBP,'No known medical condition')!==false && strpos($Hrt_Prblem,'No known medical condition')!==false && strpos($Arthrtis,'No known medical condition')!==false && strpos($LPrblm,'No known medical condition')!==false && strpos($Strk,'No known medical condition')!==false && strpos($TPrblm,'No known medical condition')!==false && strpos($Diabts,'No known medical condition')!==false && strpos($Ulcr,'No known medical condition')!==false && strpos($L_D_L,'No known medical condition')!==false && strpos($Cancr,'No known medical condition')!==false ){

		$anyConditionYouValueGHDesc = "";

		$anyConditionYouValueGHDesc="<table style='width:740px;' cellpadding='0' cellspacing='0'><tr><td style='width:380px;' class='paddingTop10'>No known medical conditions</td></tr>";
	}
	//=========================================================================================================================
	$anyConditionYouValueGHDesc.="</table>";
}
if(!$anyConditionYouValueGHDesc) { $anyConditionYouValueGHDesc .= $anyConditionYouValueGH;}
$arr_no_famliy_blood_relative=explode(",",$dataFinal['any_conditions_relative1_n']);
//pre($arr_no_famliy_blood_relative);
$arr_GenHealth_Label=array();

foreach($arrMEDHXGenralHealth as $GenHealtLabel){
	$label_key=$GenHealtLabel['Filed_Label_Val'];
	$label_val=$GenHealtLabel['Filed_Label_Og_Val'];
	if($GenHealtLabel['Filed_Label']=="any_conditions_relative"){
		$arr_GenHealth_Label[$label_key]="&nbsp;".$label_val;
	}
}$High_Blood_Pressure_no=$Heart_Problem_no=$Diabetes_no=$Lung_Problems_no=$Stroke_no=$Thyroid_Problems_no=$Arthritis_no=$Ulcers_no=$LDL_no=$Cancer_no="";
foreach($arr_no_famliy_blood_relative as $famlily_relative_val){
	if($famlily_relative_val==1){
		$High_Blood_Pressure_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==2){
		$Heart_Problem_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==3){
		$Diabetes_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==4){
		$Lung_Problems_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==5){
		$Stroke_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==6){
		$Thyroid_Problems_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==7){
		$Arthritis_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==8){
		$Ulcers_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==13){
		$LDL_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
	if($famlily_relative_val==14){
		$Cancer_no='<b>No</b>'.$arr_GenHealth_Label[$famlily_relative_val];
	}
}

?>
                <tr>
                    <td class="bdrtbm" style="width:370px;">
                        <?php echo $anyConditionYouValueGHDesc; ?>
                    </td>
                    <td class="bdrtbm" style="width:370px;">
                    	<table style="width:370px;"  cellpadding="0" cellspacing="0">
		<?php
			$hifen="";

			$c1=$relDescHighBpValueGH.get_set_pat_rel_values_retrive($descValueDHB,"rel",$delimiter,$hifen);
		     //=========================================================================================================
			//BELOW CONDITION USED TO CHECK "NO KNOWN MEDICAL CONDITION" CHECKBOX UNDER MED HX, IF ITS CHECKED, THEN ALL -VE CHECKBOXES WILL BE CHECKED AND NOW IT WILL BE DISPLAY ONLY KEYWORD "No known medical condition" RATHER THAN DISPLAYING ALL -VE VALUES.
			if(strpos($High_Blood_Pressure_no,"No") && strpos($Heart_Problem_no,"No") && strpos($Diabetes_no,"No") && strpos($Lung_Problems_no,"No") && strpos($Stroke_no,"No") && strpos($Thyroid_Problems_no,"No") && strpos($Arthritis_no,"No") && strpos($Ulcers_no,"No") && strpos($LDL_no,"No") && strpos($Cancer_no,"No")){

				$High_Blood_Pressure_no = $Heart_Problem_no = $Diabetes_no = $Lung_Problems_no = $Stroke_no = $Thyroid_Problems_no = $Arthritis_no = $Ulcers_no =  $LDL_no =  $Cancer_no = "";

				$High_Blood_Pressure_no = "No known medical conditions";
			}
		  //===============================================================================================================
		 	if((trim($c1)!="" && $relDescHighBpValueGH) || $High_Blood_Pressure_no){
				if($relDescHighBpValueGH==''){$relDescHighBpValueGH=$High_Blood_Pressure_no;}
					if(strpos($relDescHighBpValueGH,"No known medical conditions")){
						echo("<tr><td style='width:264px;'>No known medical conditions</td></tr>");
						//IF MED HX "No known medical conditions"  WILL TRUE THEN IT WILL WORK.
					}else{
						echo("<tr><td style='width:264px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescHighBpValueGH)."&nbsp;".get_set_pat_rel_values_retrive($descValueDHB,"rel",$delimiter,$hifen)."</td></tr>");
					}
			}
			$c2=$relDescHeartProbValueGH.get_set_pat_rel_values_retrive($descValueDHP,"rel",$delimiter,$hifen);
			if(($c2!="" && $relDescHeartProbValueGH) || $Heart_Problem_no){
				if(trim($relDescHeartProbValueGH)==''){$relDescHeartProbValueGH=$Heart_Problem_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescHeartProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDHP,"rel",$delimiter,$hifen)."</td></tr>");
			}
			 $c6=$relDescArthritisProbValueGH.get_set_pat_rel_values_retrive($subArthritisProbValueGH,"rel",$delimiter,$hifen).get_set_pat_rel_values_retrive($descValueDA,"rel",$delimiter,$hifen);
		    if(($c6!="" && $relDescArthritisProbValueGH) || $Arthritis_no){
				if($relDescArthritisProbValueGH==''){$relDescArthritisProbValueGH=$Arthritis_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescArthritisProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($subArthritisProbValueGH,"rel",$delimiter,$hifen).get_set_pat_rel_values_retrive($descValueDA,"rel",$delimiter,$hifen)."</td></tr>");
			}

			$c3=$relDescLungProbValueGH.get_set_pat_rel_values_retrive($descValueDLP,"rel",$delimiter,$hifen);
		    if(($c3!="" && $relDescLungProbValueGH) || $Lung_Problems_no){
				if($relDescLungProbValueGH==''){$relDescLungProbValueGH=$Lung_Problems_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescLungProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDLP,"rel",$delimiter,$hifen)."</td></tr>");
			}
			$c4=$relDescStrokeProbValueGH.get_set_pat_rel_values_retrive($descValueDS,"rel",$delimiter,$hifen);
			if(($c4!="" && $relDescStrokeProbValueGH) || $Stroke_no){
				if($relDescStrokeProbValueGH==''){$relDescStrokeProbValueGH=$Stroke_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescStrokeProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDS,"rel",$delimiter,$hifen)."</td></tr>");
			}
			$c5=$relDescThyroidProbValueGH.get_set_pat_rel_values_retrive($descValueDTP,"rel",$delimiter,$hifen);
			if(($c5!="" && $relDescThyroidProbValueGH) || $Thyroid_Problems_no){
				if($relDescThyroidProbValueGH==""){$relDescThyroidProbValueGH=$Thyroid_Problems_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescThyroidProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDTP,"rel",$delimiter,$hifen)."</td></tr>");
			}
			if($Diabetes_no){
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$Diabetes_no)."</td><td style='width:100px;' class='paddingTop10'></td></tr>");
			}


			$c7=$relDescUlcersProbValueGH.get_set_pat_rel_values_retrive($descValueDU,"rel",$delimiter,$hifen);
		    if(($c7!="" && $relDescUlcersProbValueGH) || $Ulcers_no){
				if($relDescUlcersProbValueGH==''){$relDescUlcersProbValueGH=$Ulcers_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescUlcersProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDU,"rel",$delimiter,$hifen)."</td></tr>");
			}$c8=$relDescLDLValueGH.get_set_pat_rel_values_retrive($descValueDLDL,"rel",$delimiter,$hifen);
		    if(($c8!="" && $relDescLDLValueGH) || $LDL_no){
				if($relDescLDLValueGH==''){$relDescLDLValueGH=$LDL_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescLDLValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDLDL,"rel",$delimiter,$hifen)."</td></tr>");
			}
			$c9=$relDescCancerProbValueGH.get_set_pat_rel_values_retrive($descValueDC,"rel",$delimiter,$hifen);
			if(($c9!="" && $relDescCancerProbValueGH) || $Cancer_no){
				if($relDescCancerProbValueGH==''){$relDescCancerProbValueGH=$Cancer_no;}
				echo("<tr><td style='width:160px;' class='paddingTop10'>".str_ireplace(":",":</td><td style='width:100px;' class='paddingTop10'>",$relDescCancerProbValueGH)."</td><td style='width:100px;' class='paddingTop10'>".get_set_pat_rel_values_retrive($descValueDC,"rel",$delimiter,$hifen)."</td></tr>");
			}
		?>
        	</table>
                    </td>
                </tr>
<?php

} //END ANY CONDITION

?>

<?php
//Diabtese
if((trim($descRValueGH)!="" && trim($descRValueGH)!="~|~") || (trim($descValueGH)!="" && trim($descValueGH)!="~|~")){

?>

	 <tr>
                    <td  class="text_lable paddingTop10 bdrtop" style="width:370px;">
                    <?php if($descValueGH!=""){?>
                        Patient Diabetes:
                    <?php }?>
                    </td>
                    <td  style="width:370px;"  class="text_lable paddingTop10 bdrtop">
                    <?php if($descRValueGH!=""){?>
                        Relative Diabetes:
                    <?php }?>
                    </td>
                </tr>

	<tr>
	    <td style="width:370px;" class="paddingTop10">
		<?php
			echo get_set_pat_rel_values_retrive($descValueGH,"pat",$delimiter);
			echo get_set_pat_rel_values_retrive($descValueDV,"pat",$delimiter,$hifen);
		?>
	    </td>
	    <td style="width:370px;" class="paddingTop10">
		<?php
			echo $descRValueGH;
			echo get_set_pat_rel_values_retrive($descValueGH,"rel",$delimiter,$hifen);
			echo get_set_pat_rel_values_retrive($descValueDV,"rel",$delimiter,$hifen);
		?>
	    </td>
	</tr>

<?php
}/////Diabtese End

//ANY CONDITION Other
$tmp = get_set_pat_rel_values_retrive($anyConditionOtherValueGH,"pat",$delimiter);
if($anyConditionOtherValueGH!="" && $tmp!=""){

?>

	<tr>
	    <td colspan="2" style="width:730px;" class="text_lable paddingTop10">
	    <?php if($anyConditionOtherValueGH!=""){?>
		Any condition other
	    <?php }?>
	    </td>
	</tr>

	<tr>
	    <td colspan="2" style="width:730px;" class="paddingTop10">
		<?php echo $tmp;?>
	    </td>
	</tr>
<?php
} //End ANY CONDITION Other

//Relative condition other
$tmp = get_set_pat_rel_values_retrive($anyConditionOtherValueGH,"rel",$delimiter,$hifen);
if($ghRelDescOthersValueGH!=""||$tmp!=""){?>
                <tr>
                    <td colspan="2" class="text_lable paddingTop10" >
                        Relative condition other
                    </td>
                </tr>

                <tr>
                    <td colspan="2" class="paddingTop10" style="width:700px;" >
                    <?php echo $ghRelDescOthersValueGH;
			echo "&nbsp;".$tmp;
		?>
                    </td>
                </tr>
<?php
} //END Relative condition other
$arrGenMed=$this->get_general_medicine($pid);
if(count($arrGenMed)>0 && ($arrGenMed['chk_annual_colorectal_cancer_screenings']==1 ||$arrGenMed['chk_receiving_annual_mammogram']==1 || $arrGenMed['nutrition_counseling']==1 || $arrGenMed['nutrition_counseling_date']!="0000-00-00" || $arrGenMed['chk_received_flu_vaccine']==1 || $arrGenMed['chk_high_risk_for_cardiac']==1 || $arrGenMed['physical_activity_counseling']==1 || $arrGenMed['physical_activity_counseling_date']!="0000-00-00") || $arrGenMed['chk_received_pneumococcal_vaccine']==1 || $arrGenMed['chk_fall_risk_assd']==1 || $arrGenMed['chk_blood_pressure']==1 || $arrGenMed['chk_bmi']==1 || $arrGenMed['received_flu_vaccine_type']!=='' || $arrGenMed['received_flu_vaccine_type']!=='' || $arrGenMed['pneumococcal_vaccine_type']!=='' || $arrGenMed['fall_risk_ass_type']!=='' || $arrGenMed['blood_pressure_type']!=='' || $arrGenMed['bmi_type']!==''){?>
	<tr>
    	<td colspan="2" style="width:740px;">
        	<table style="width:740px; " cellpadding="0" cellspacing="0">
            	  <?php if($arrGenMed['chk_annual_colorectal_cancer_screenings']==1 || $arrGenMed['chk_receiving_annual_mammogram']==1){?>
                <tr>
                	<td style="width:370px;" class="paddingTop10">
                   <?php if($arrGenMed['chk_annual_colorectal_cancer_screenings']==1){?>
                    <b>Annual colorectal cancer screenings:</b>&nbsp;Yes
                	<?php } ?>
                </td>

                	<td style="width:370px;" class="paddingTop10">
					<?php if($arrGenMed['chk_receiving_annual_mammogram']==1){?>
                    <b>Receiving annual mammogram:</b>&nbsp;Yes
	                <?php } ?>
                    </td>
                </tr>
<?php }
 if($arrGenMed['chk_receiving_annual_mammogram']==1 || $arrGenMed['nutrition_counseling_date']!="0000-00-00"){
?>
                <tr>

                	<td style="width:370px;" class="paddingTop10">
                	<?php if($arrGenMed['nutrition_counseling']==1){?>
                    <b>Counseling for Nutrition/Diet:</b>&nbsp;Yes
                	<?php }	?>
                </td>

                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['nutrition_counseling_date']!="0000-00-00"){
						$yy=$mm=$dd="";
						list($yy,$mm,$dd)=explode("-",$arrGenMed['nutrition_counseling_date']);
						if($yy!="" && $yy!="0000" && $mm!="00" && $mm!="" && $dd!="" && $dd!="00"){
							//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
							echo "<b>Date:</b>&nbsp;".get_date_format($arrGenMed['nutrition_counseling_date']);
						}
					}
					?>
	                </td>
                </tr>
<?php }
	 if($arrGenMed['chk_received_flu_vaccine']==1 || $arrGenMed['chk_high_risk_for_cardiac']==1){
 ?>
                <tr>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_received_flu_vaccine']==1){ ?>
                    <b>Received flu vaccine:</b>&nbsp;Yes
					<?php
					if($arrGenMed['chk_received_flu_vaccine']==1 && $arrGenMed['received_flu_vaccine_type'] && $arrGenMed['received_flu_vaccine_type']!==''){ ?>
					<b><br>
					Desc:</b>&nbsp; <?php print_r($arrGenMed['received_flu_vaccine_type']);
						}
					}
				 ?>
                    </td>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_high_risk_for_cardiac']==1){?>
                    <b>High-risk for cardiac events on aspirin prophylaxis:</b>&nbsp;Yes
                    <?php }?>
                    </td>

                </tr>
        <?php }
		if($arrGenMed['physical_activity_counseling']==1 || $arrGenMed['physical_activity_counseling_date']){
		 ?>
                <tr>
                 	<td style="width:370px;" class="paddingTop10">
                    	<?php if($arrGenMed['physical_activity_counseling']==1){?>
                    	<b>Counseling for Physical Activity:</b>&nbsp;Yes
	                	<?php }?>
                	</td>

                	<td style="width:370px;" class="paddingTop10">
                   	 <?php if($arrGenMed['physical_activity_counseling_date']){
					 	$yy=$mm=$dd="";
					 	list($yy,$mm,$dd)=explode("-",$arrGenMed['physical_activity_counseling_date']);
					 	if($yy!="" && $yy!="0000" && $mm!="00" && $mm!="" && $dd!="" && $dd!="00"){
					 		//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
							echo "<b>Date:</b>&nbsp;".get_date_format($arrGenMed['physical_activity_counseling_date']);
					 	}
					 } ?>
                     </td>
                </tr>
         <?php }
		  if($arrGenMed['chk_received_pneumococcal_vaccine']==1 || $arrGenMed['pneumococcal_vaccine_type']!=='' || $arrGenMed['chk_fall_risk_assd']==1 || $arrGenMed['fall_risk_ass_type']!=''){
 ?>
                <tr>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_received_pneumococcal_vaccine']==1){ ?>
                    <b>Received Pneumococcal Vaccine:</b>&nbsp;Yes
                    <?php }
					if($arrGenMed['chk_received_pneumococcal_vaccine']==1 && $arrGenMed['pneumococcal_vaccine_type'] && $arrGenMed['pneumococcal_vaccine_type']!==''){ ?>
					<b><br>Desc:</b>&nbsp;
					<?php print_r($arrGenMed['pneumococcal_vaccine_type']); } ?>
                    </td>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_fall_risk_assd']==1){?>
                    <b>Falls: Risk Assessment:</b>&nbsp;Yes
                    <?php }
					if($arrGenMed['chk_fall_risk_assd']==1 && $arrGenMed['fall_risk_ass_type'] && $arrGenMed['fall_risk_ass_type']!==''){ ?>
					<b><br>Desc:</b>&nbsp;
					<?php print_r($arrGenMed['fall_risk_ass_type']); } ?>
                    </td>

                </tr>
        <?php }
	 		if($arrGenMed['chk_blood_pressure']==1 || $arrGenMed['blood_pressure_type'] || $arrGenMed['chk_bmi']==1 || $arrGenMed['bmi_type']){
 ?>
                <tr>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_blood_pressure']==1){ ?>
                    <b>Blood Pressure:</b>&nbsp;Yes
                    <?php }
					if($arrGenMed['chk_blood_pressure']==1 && $arrGenMed['blood_pressure_type'] && $arrGenMed['blood_pressure_type']!==''){ ?>
					<b><br>Desc:</b>&nbsp;
					<?php print_r($arrGenMed['blood_pressure_type']); } ?>
                    </td>
                	<td style="width:370px;" class="paddingTop10">
                    <?php if($arrGenMed['chk_bmi']==1){?>
                    <b>BMI:</b>&nbsp;Yes
                    <?php }
					if($arrGenMed['chk_bmi']==1 && $arrGenMed['bmi_type'] && $arrGenMed['bmi_type']!==''){?>
                    <b><br>Desc:</b>&nbsp;
                    <?php print_r($arrGenMed['bmi_type']); } ?>
                    </td>

                </tr>
        <?php } ?>
            </table>
        </td>
    </tr>


<?php
}
?>

        <?php
		 if(
		(!empty($anyReviewConstValueGH)) ||
		(!empty($reviewHeadValueGH)) ||
		(!empty($reviewConstOtherValueGH)) ||
		(!empty($reviewHeadOtherValueGH)) ||
		(!empty($reviewRespValueGH)) ||
		(!empty($reviewCardValueGH)) ||
		(!empty($reviewRespOtherValueGH)) ||
		(!empty($reviewCardOtherValueGH)) ||
		(!empty($reviewGastroValueGH)) ||
		(!empty($reviewGenitValueGH)) ||
		(!empty($reviewGastroOtherValueGH)) ||
		(!empty($reviewGenitOtherValueGH)) ||
		(!empty($reviewAllerValueGH)) ||
		(!empty($reviewNeuroValueGH)) ||
		(!empty($reviewAllerOtherValueGH)) ||
		(!empty($reviewNeuroOtherValueGH)) ||
		(!empty($review_intgmntrGH)) ||
		(!empty($review_psychiatryGH)) ||
		(!empty($review_blood_lymphGH)) ||
		(!empty($review_musculoskeletalGH)) ||
		(!empty($review_endocrineGH)) ||
		(!empty($review_eyeGH)) ||
		(!empty($negChkBxValueGH))
	    ){
?>

                <tr>
                    <td colspan="2" class="bluelne" height="1" style="width:750px;">&nbsp;
                    </td>
                </tr>
				<tr>
					<td colspan="2" height="2"></td>
				</tr>
				<tr>
                    <td colspan="2" class="bluehed text_cap paddingTop10" style="width:730px;" >
                       REVIEW OF SYSTEMS
                    </td>
                </tr>

<?php
	//ROS Dyna
	$ros_pos=array(  $reviewAllerValueGH, $reviewCardValueGH,
				$anyReviewConstValueGH, $reviewHeadValueGH,
				$review_endocrineGH, $review_eyeGH,
				$reviewGastroValueGH, $reviewGenitValueGH,
				$review_blood_lymphGH, $review_intgmntrGH,
				$review_musculoskeletalGH,$reviewNeuroValueGH,
				$review_psychiatryGH,$reviewRespValueGH);
	$ros_pos_other=array(
					$reviewAllerOtherValueGH,$reviewCardOtherValueGH,
					$reviewConstOtherValueGH,$reviewHeadOtherValueGH,
					$review_endocrineOtherGH,$review_eyeOtherGH,
					$reviewGastroOtherValueGH,$reviewGenitOtherValueGH,
					$review_blood_lymphOtherGH,$review_intgmntrOtherGH,
					$review_musculoskeletalOtherGH, $reviewNeuroOtherValueGH,
					$review_psychiatryOtherGH,$reviewRespOtherValueGH);
	$this->get_med_ros($ros_pos, $ros_pos_other, $negChkBxValueGH);

?>

<?php
}
	$socialHis=$this->get_social_history($pid);
	if(count($socialHis)>0  && ($socialHis['smoking_status']!="")){
		?>
          <tr>
          		<td style="width:740px;" colspan="2">
                	<table style="width:740px;" cellpadding="0" cellspacing="0">
                    	<tr>
                        	<td colspan="4"class="paddingTop10 tb_subheading">SOCIAL HISTORY</td>
                        </tr>
                        <?php if(!in_array("mu_data_set_smoking",$exlusionArr)){ ?>
                        <tr>
                        	<td style="width:350px;" class="paddingTop10">
							<?php
							if($socialHis['smoking_status']){
							?>
                            	<b>Smoke:</b>&nbsp;<?php echo str_replace("/","<br><b>SNOMED Code:&nbsp;</b>",$socialHis['smoking_status']);
							}?>
                            </td>
                            <td style="width:130px;" class="paddingTop10">
							<?php if($socialHis['source_of_smoke']){ ?>
                            	<b>Type:</b>&nbsp;<?php
								echo $socialHis['source_of_smoke'];
							 } ?>

                            </td>
                            <td style="width:150px;" class="paddingTop10">
							<?php if($socialHis['smoke_perday']){ ?>
                            	<b>Frequency:</b>&nbsp;<?php
								echo $socialHis['smoke_perday'];
							 } ?>

                            </td>
                            <td style="width:100px;" class="paddingTop10">
							<?php if($socialHis['number_of_years_with_smoke']!="0" && $socialHis['smoke_years_months']){ ?>
                            		<b>Period:</b>&nbsp;<?php
									echo $socialHis['number_of_years_with_smoke']." ".$socialHis['smoke_years_months'];
							 } ?>
                            </td>
                        </tr>
                        <?php } ?>
                        <tr>
                        	<td style="width:350px;" class="paddingTop10">
                            <?php if($socialHis['smoke_counseling']==1){ ?>
                            <b>Cessation Counseling:</b>&nbsp;Yes
                            <?php }
								$mm=$dd=$yy="";
								if($socialHis['offered_cessation_counselling_date']){
									list($yy,$mm,$dd)=explode("-",$socialHis['offered_cessation_counselling_date']);
									if($mm!="" && $mm!="00" && $dd!="" && $dd!="00" && $yy!="" && $yy!="00"){
										//echo "<b>Date:</b>&nbsp;".$mm."-".$dd."-".$yy;
										echo "<b>Date:</b>&nbsp;".get_date_format($socialHis['offered_cessation_counselling_date']);
									}
								}
							 ?>
                            </td>
                            <td colspan="3" style="width:350px;" class="paddingTop10">
                            	<?php if($socialHis['cessation_counselling_option']){ ?>
                            	<b>Type:</b>&nbsp;<?php
								echo $socialHis['cessation_counselling_option'];
							 } ?>
                            </td>
                        </tr>
                        <tr>
                        <td style="width:350px;">
                           <?php if($socialHis['alcohal'] || $socialHis['consumption'] || $socialHis['list_drugs'] || $socialHis['otherSocial']){ ?>
                           		<table style="width:350px;" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td style="width:350px;" class="paddingTop10 tb_subheading">Alcohol</td>
                                    </tr>
                                    <tr>
                                        <td style="width:350px;" class="paddingTop10">
										<?php
                                        if($socialHis['alcohal']){
											echo $socialHis['alcohal'];
										}
										if($socialHis['consumption'] || $socialHis['alcohal_time']){
											echo "&nbsp;<b>Frequency:</b>&nbsp;".$socialHis['consumption']." ".$socialHis['alcohal_time'];
										}
										?>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td style="width:350px;" class="paddingTop10">
                                        <?php
										if($socialHis['list_drugs']){
											echo "<b>List any Drugs:&nbsp;</b>".$socialHis['list_drugs'];
										}
										if($socialHis['otherSocial']){
											echo "&nbsp;<b>More Information:&nbsp;</b>".$socialHis['otherSocial'];
										}
										?>
                                        </td>
                                    </tr>
                                </table>
                            <?php } ?>
                           </td>
                        	<td colspan="3" style="width:380px;" >
                            <?php if($socialHis['family_smoke']=="1" && ($socialHis['smokers_in_relatives'] || $socialHis['smoke_description'])){?>
                        		<table style="width:380px;" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td style="width:380px;" class="paddingTop10 tb_subheading">FAMILY Hx of SMOKING - Yes</td>
                                    </tr>
                                    <tr>
                                        <td style="width:380px;" class="paddingTop10" >
                                        <?php if($socialHis['smokers_in_relatives']){
                                             echo "<b>Relation:</b>&nbsp;".$socialHis['smokers_in_relatives'];
                                        }
                                         ?></td>
                                    </tr>
                                    <tr>
                                        <td style="width:380px;" class="paddingTop10">
                                            <b>Description:</b>&nbsp;<?php echo $socialHis['smoke_description']; ?>
                                        </td>
                                    </tr>
                               </table>
                           <?php } ?>
                           </td>

                      </tr>
                    </table>
                </td>
          </tr>
		<?php
		}
	}
	?>
    </table>
    <?php
	}}

}

public function isDate($i_sDate){
		if(preg_match('/^\d{4}-\d{2}-\d{2}$/', $i_sDate)){
			//ereg ("^[0-9]{4}-[0-9]{2}-[0-9]{2}$", $i_sDate)
			//ereg ("^[0-9]{2}/[0-9]{2}/[0-9]{4}$", $i_sDate)
			$arrDate = explode("-", $i_sDate);
			$intYear = $arrDate[0];
			$intMonth = $arrDate[1];
			$intDay = $arrDate[2];
			$intIsDate = checkdate($intMonth, $intDay, $intYear);
			if($intIsDate){
				$date = $intMonth."-".$intDay."-".$intYear;
			}
			return ($date);
		}
		else{
			return $i_sDate;
		}

	} //end function $this->isDate

public function print_getPatientInfo($pid,$fAct="",$patientImage="")
{
	global $ChartNoteImagesString;
	$patientDetails=array();
	//---get Detail For Patient -------
	$qry =imw_query("select * from patient_data where id = '".$pid."' ");
	if(imw_num_rows($qry) > 0)
	{
		$res = imw_fetch_assoc($qry);
		$patientName = $res["lname"].", ".$res["fname"]." ";
		$patientName .= $res["mname"];
		$date = substr($res["date"],0,strpos($res["date"]," "));
		//$arrDate = explode("-",$date);
		//$created_date = $arrDate[1].'-'.$arrDate[2].'-'.$arrDate[0];
		$created_date = get_date_format($date);
		//$arrDate = explode("-",$res['DOB']);
		//$date_of_birth = $arrDate[1].'-'.$arrDate[2].'-'.$arrDate[0];
		$date_of_birth = get_date_format($res['DOB']);
		$cityAddress = $res['city'];
		if($res['state'])
			$cityAddress .= ', '.$res['state'].' ';
		else
			$cityAddress .= ' ';
		$cityAddress .= $res['postal_code'];
		//list($y,$m,$d) = explode('-',$patientDetails[0]['DOB']);
		$age =(!empty($res["DOB"])&& getNumber($res["DOB"])!="00000000") ? get_age($res["DOB"]) : "" ;//date('Y') - $y ; //independent function

		$patientDetails[0]['title']=$res["title"];
		$patientDetails[0]['id']=$res["id"];
		$patientDetails[0]['street']=$res["street"];
		$patientDetails[0]['street2']=$res["street2"];
		$patientDetails[0]['city']=$res["city"];
		$patientDetails[0]['state']=$res["state"];
		$patientDetails[0]['postal_code']=$res["postal_code"];
		$patientDetails[0]['sex']=$res["sex"];
		$patientDetails[0]['providerID']=$res["providerID"];

		$patientDetails[0]['cityAddress']=$cityAddress;
		$patientDetails[0]['DOB']=$date_of_birth;
		$patientDetails[0]['name']=$patientName;
		$patientDetails[0]['age']=$age;
		$patientDetails[0]['lname']=$lname;
		$patientDetails[0]['fname']=$fname;
		$patientDetails[0]['mname']=$mname;
		$patientDetails[0]['suffix']=$suffix;
		$patientDetails[0]['phone_home']=$res["phone_home"];
		$patientDetails[0]['ado_option']=$res["ado_option"]	;
		//$patientImage

		$patientDetails[0]['language']=str_ireplace("Other --","",$res["language"]);
		$patientDetails[0]['race']=$res["race"];
		$patientDetails[0]['otherRace']=$res["otherRace"];
		if($patientDetails[0]['otherRace']){
			$patientDetails[0]['race']=str_ireplace("Other",$patientDetails[0]['otherRace'],$patientDetails[0]['race']);
		}
		$patientDetails[0]['ethnicity']=$res["ethnicity"];
		$patientDetails[0]['otherEthnicity']=$res["otherEthnicity"];
		if($patientDetails[0]['otherEthnicity']){
			$patientDetails[0]['ethnicity']=str_ireplace("Other",$patientDetails[0]['otherEthnicity'],$patientDetails[0]['ethnicity']);
		}

		//--- Get Patient Image ----
		if($patientImage) {
			$patientDetails[0]['img']=$patientImage;
		}else {
			$patientImage = "";
			$p_imagename = $res['p_imagename'];
			if(!empty($p_imagename)){
				$dirPath = $GLOBALS['fileroot']."/data/".constant('PRACTICE_PATH').$p_imagename;
				$dir_real_path = realpath($dirPath);
				$img_name = substr($p_imagename,strrpos($p_imagename,'/')+1);

				if(file_exists($dir_real_path)){

					$patient_img['patient'] = $img_name;
					$fileSize = getimagesize($dir_real_path);

					if($fileSize[0]>80 || $fileSize[1]>90){
						$patientImage = "<img src=\"".$dir_real_path."\" width=\"80\" height=\"80\" alt=\"patient Image\" />";
					}
					else{
						$patientImage = "<img style=\"cursor:pointer\" src=\"".$dir_real_path."\" alt=\"patient Image\"/>";
					}

					//$patientDetails[0]['img']=$patientName;
					$patientDetails[0]['img']=$patientImage;
					$ChartNoteImagesString[]=$dir_real_path;
				}
			}

		}

	}
	return $patientDetails;
}

function print_ConsultLetters($pid, $fid, $clIds){
		$regpattern='|<a id=(.*) class=\"cls_smart_tags_link\" href=(.*)>(.*)<\/a>|U';
		$pdf_data="";
		$sql = "SELECT ".
				"templateData, templateName, DATE_FORMAT(date,'".get_sql_date_format()."') AS doc ".
				"FROM patient_consult_letter_tbl ".
				"WHERE patient_id='".$pid."' AND patient_consult_id IN (".$clIds.") ";
		$row = get_array_records_query($sql);
		for($i=0;$i < count($row); $i++){
			extract($row[$i]);
			//REPLACING SMART TAG OPTONS WITH NON-ANCHOR STRING.
			$consultTemplateData = preg_replace($regpattern, "\\3", $templateData);
			//<tr><td class=\"tb_subheading\" style=\"height:1px;width:100%;\">".$templateName." - ".$doc."</td></tr>
			if(!empty($pdf_data)){ $pdf_data.="<br/><br/>"; }
			$pdf_data.="<table><tr><td class=\"tb_subheading\">".$templateName." - ".$doc."</td></tr>
						<tr><td >".$consultTemplateData."</td></tr></table>";
		}

		if(!empty($pdf_data)){

			$pdf_data=str_ireplace($GLOBALS['webroot']."/data/".constant('PRACTICE_PATH'),"../../data/".constant('PRACTICE_PATH'),$pdf_data);
			$pdf_data='<table style="width:750px;">
						<tr><td class="bluelne" height="1" style="width:750px;">&nbsp;</td></tr>
						<tr><td height="2"></td></tr>
						<tr><td class="bluehed text_cap paddingTop10">CONSULT LETTERS</td></tr>
						</table>'.$pdf_data;
			echo $pdf_data;
		}

	}

	function print_OpNotes($pid, $fid, $clIds){
	global $phpHTTPProtocol, $phpServerIP, $web_RootDirectoryName, $myExternalIP;
	if($protocol == ''){ $protocol=$_SERVER['HTTPS'] == 'on' ? 'https://' : 'http://'; }

	$regpattern='|<a id=(.*) class=\"cls_smart_tags_link\" href=(.*)>(.*)<\/a>|U';
	$pdf_data="";
	$sql = "SELECT ".
		  	 "txt_data, sc_emr_template_name, signature, DATE_FORMAT(pn_rep_date,'".get_sql_date_format()."') AS doc ".
		  	 "FROM pn_reports ".
		  	 "WHERE patient_id='".$pid."' AND pn_rep_id IN (".$clIds.") ";
	$row=get_array_records_query($sql);
	for($i=0; $i < count($row);$i++){
		extract($row[$i]);
		//REPLACING SMART TAG OPTONS WITH NON-ANCHOR STRING.
		$consultTemplateData = preg_replace($regpattern, "\\3", $txt_data);

		//======THIS CODE USED TO REPLACE OPNOTE SIGN WHOSE SIGNED FROM PHYSICIAN CONSOLE==========
		$consultTemplateData = str_ireplace("/".$web_RootDirectoryName."/interface/main/uploaddir/","../../main/uploaddir/",$consultTemplateData);
		$consultTemplateData = str_ireplace($GLOBALS['webroot']."/data/".PRACTICE_PATH,'../../data/'.PRACTICE_PATH,$consultTemplateData);
		//$consultTemplateData = str_ireplace("/".$web_RootDirectoryName."/data/".PRACTICE_PATH,$protocol.$myExternalIP.'/'.$web_RootDirectoryName.'/data/'.PRACTICE_PATH,$consultTemplateData);
		//=========================================================================================
		$consultTemplateData = str_ireplace("&Acirc;","",$consultTemplateData);

		//start code to get opnotes related to scEMR
		if($sc_emr_template_name || $sc_emr_operative_report_id) {
			$consultTemplateData = nl2br($consultTemplateData);
			$consultTemplateData = strip_tags($consultTemplateData,' <p> <br> <img> <strong> </strong> ');
			$consultTemplateData = str_ireplace("</p><br />","</p>",$consultTemplateData);
		}
		//stop code to get opnotes related to scEMR

		if(!empty($pdf_data)){ $pdf_data.="<br/><br/>"; }
		$pdf_data.="<table>
						<tr><td class=\"bluelne\" height=\"1\" style=\"width:750px;\">&nbsp;</td></tr>
						<tr><td colspan=\"2\" height=\"2\"></td></tr>
						<tr><td class=\"bluehed text_cap paddingTop10\">OP NOTE DATE : ".$doc."</td></tr>
						<tr><td >".$consultTemplateData."</td></tr>
					</table>";
	}

		if(!empty($pdf_data)){
			$pdf_data='<table ><tr><td class="bluehed text_cap paddingTop10">Operative Notes</td></tr></table>'.$pdf_data;
			echo $pdf_data;
		}
	}

function getChkStr($nm, $tm, $vt){
	$nm = trim("".$nm);
	$tm = trim($tm);
	$vt = trim($vt);
	if(!empty($nm)||!empty($tm)||!empty($vt)){
		$str = $nm."-".$tm."-".$vt;
	}else{
		$str = "";
	}
	return $str;
}


/******GET MOST RECENT OR SPECIFIC VERSION DETAIL FOR TEMPLATE BASED TESTS*******/
	function get_template_test_version_data($tests_name_pk_id,$tests_version_pk_id=''){
		$q_tests = "SELECT * FROM tests_version WHERE tests_name_id='$tests_name_pk_id' ORDER BY id DESC";
		$tests_version_pk_id = intval($tests_version_pk_id);
		if($tests_version_pk_id>0) $q_tests = "SELECT * FROM tests_version WHERE tests_name_id='$tests_name_pk_id' AND id='$tests_version_pk_id'";
		$res_tests = imw_query($q_tests);
		if($res_tests && imw_num_rows($res_tests)==1){
			return imw_fetch_assoc($res_tests);
		}
		return false;
	}

    /******GET ENABLED TESTS FROM ADMIN, RETURN RESULTSET AS ARRAY*******/
	function get_table_cols_by_test_table_name($tbl,$tbl_type=''){
		$q_tests = "SELECT * FROM tests_name WHERE del_status=0 AND test_table='$tbl' ";
		if($tbl_type=='id') $q_tests = "SELECT * FROM tests_name WHERE id='$tbl' ";
		$res_tests = imw_query($q_tests);
		if($res_tests && imw_num_rows($res_tests)>0){
			$rs_tests = imw_fetch_assoc($res_tests);
			$formid_key = $this->get_test_table_formid_column($rs_tests['test_table']);
			$rs_tests['formid_key'] = $formid_key;
			return $rs_tests;
		}
		return false;
	}

    /********GET TABLE FORM ID COLUMN********/
	function get_test_table_formid_column($test_table_name){
		$formid_key = 'formId';
		if(in_array($test_table_name,array('nfa','oct','oct_rnfl','ivfa','icg','surgical_tbl','iol_master_tbl','test_gdx',''))){
			$formid_key = 'form_id';
		}
		return $formid_key;
	}

    function print_patient_custom_tests($patient_id,$form_id,$req,$temp_name){
        include_once $GLOBALS['srcdir'] . '/classes/class.tests.php';
        $objTests				= new Tests;

        foreach($req as $tId) {
            $test_master_id	=0;
            if($test_master_id==0) 	  $test_master_id = $objTests->get_template_test_id($tId,'custom');
            $this_test_properties	= $objTests->get_table_cols_by_test_table_name($test_master_id,'id');
            $test_table_name		= $this_test_properties['test_table'];
            $this_test_screen_name	= $this_test_properties['temp_name'];


            //GET VERSION HTML DETAILS
            $this_version_data					= $objTests->get_template_test_version_data($this_test_properties['id'],$this_test_properties['version']);
            $elem_version_id					= $this_test_properties['version'];
            $elem_test_main_options 			= $this_version_data['test_main_options'];
            $elem_test_results 					= $this_version_data['test_results'];
            $elem_test_treatment 				= $this_version_data['test_treatment'];

            if(isset($tId) && !empty($tId)){//Get record based on patient id and test id
                $q = "SELECT * FROM ".$test_table_name." WHERE ".$this_test_properties['patient_key']." = '".$patient_id."' AND test_id = '".$tId."' AND test_template_id = '$test_master_id'";
                $res = imw_query($q);
                $row = imw_fetch_assoc($res);
            } else if(!empty($form_id)){
                //Get Form id based on patient id
                $q = "SELECT * FROM ".$test_table_name." WHERE ".$this_test_properties['patient_key']." = '".$patient_id."' AND test_template_id = '$test_master_id' AND formId = '$form_id' AND purged='0' AND del_status='0'";
                $res = imw_query($q);
                $row = imw_fetch_assoc($res);
            }else{
                $row = false; // open new test for patient
            }

            $yes = ' (y)'; 	$no = ' (n)';


            if($row != false){
                $test_pkid = $row["test_id"];
                $test_form_id = $row["formId"];
                $elem_examDate = get_date_format($row["examDate"]);
                $elem_examTime = $row["examTime"];
                $elem_testOtherName = $row["test_other"];
                $elem_topoMeterEye = $row["test_other_eye"];
                $elem_performedBy = $row["performedBy"];
                $elem_ptUnderstanding = $row["ptUnderstanding"];
                $elem_diagnosis = $row["diagnosis"];
                $elem_diagnosisOther = $row["diagnosisOther"];
                $elem_reliabilityOd = $row["reliabilityOd"];
                $elem_reliabilityOs = $row["reliabilityOs"];

                $elem_physician =  $row["phyName"];
                $elem_techComments = stripslashes($row["techComments"]);
                $encounterId = $row["encounter_id"];
                $elem_opidTestOrdered = $row["ordrby"];
                $orderedBy=$order_by_users[$elem_opidTestOrdered];
                if(($row["ordrdt"] != "" && $row["ordrdt"] != "0000-00-00")){
                    $elem_opidTestOrderedDate = get_date_format($row["ordrdt"]);
                }
                $purged=$row["purged"];
                $sign_path = $row["sign_path"];
                $sign_path_date_time = $row["sign_path_date_time"];
                $sign_path_date = $sign_path_time = "";
                if($sign_path && $sign_path_date_time!="0000-00-00 00:00:00" || $sign_path_date_time!=0) {
                    $sign_path_date = date("m-d-Y",strtotime($sign_path_date_time));
                    $sign_path_time = date("h:i A",strtotime($sign_path_date_time));
                }

                //GET VERSION HTML DETAILS
                $this_version_data			= $objTests->get_template_test_version_data($this_test_properties['id'],$row['version']);
                $elem_version_id			= $this_version_data['id'];
                $elem_test_main_options 	= $this_version_data['test_main_options'];
                $elem_test_results 			= $this_version_data['test_results'];
                $elem_test_treatment 		= $this_version_data['test_treatment'];

                //this version data values
                $test_main_options 			= addslashes($row['test_main_options']);
                $test_result				= addslashes($row['test_result']);
                $test_treatment				= addslashes($row['test_treatment']);


                $test_result_data_arr=array();
                $test_result_col = explode('&', $test_result);
                foreach($test_result_col as $trd) {
                    $test_result_data= explode('=', $trd);
                    if(strpos($test_result_data[0],'grade') && $test_result_data[1]=='1'){$str1=$yes;}else{$str1=$no;}
                    if(strpos($test_result_data[0],'txtmo') && $test_result_data[1]=='1'){$str1=$yes;}else{$str1=$no;}
                    if(strpos($test_result_data[0],'numeric') && $test_result_data[1]!=''){$str1=$test_result_data[1];}
                    if(strpos($test_result_data[0],'text') && $test_result_data[1]!=''){$str1=$test_result_data[1];}
                    if(strpos($test_result_data[0],'desc') && $test_result_data[1]!=''){$str1=str_replace(array('+','%2C'),' ',html_entity_decode($test_result_data[1]));}
                    $test_result_data_arr[$test_result_data[0]]= $str1;
                }

                $resulttempArr=array();
                $doc = new DOMDocument();
                libxml_use_internal_errors(true);
                $doc->loadHTML(html_entity_decode($elem_test_results));
                libxml_use_internal_errors(false);

                $colLabel_1 =  '';
                foreach($doc->getElementsByTagName('*') as $element1 ){
                    if($element1->tagName=='input' || $element1->tagName=='textarea' || $element1->tagName=='td'){
                        $elemSite = $rowId = $labelComment = $value = $colRowId = $colLabel = '';

                        $testtagsid = $element1->getAttribute('id');
                        if(empty($testtagsid) == false){
                            //$testtagselm = $doc->getElementById($testtagsid);

                            $tmpArr = array();
                            $tmpArr = explode('-', $testtagsid);
                            if($tmpArr[0] && empty($tmpArr[0]) == false){
                                $rowArr = explode('_', $tmpArr[0]);
                                if($rowArr[1]) $elemSite = $rowArr[1];
                                if(is_numeric(end($rowArr))) $colRowId = end($rowArr);
                            }
                            if(empty($colRowId) == false){
                                $colLabelid = "label_row_".$colRowId;
                                $colLabelelem = $doc->getElementById($colLabelid);
                                $colLabel = trim($colLabelelem->textContent);
                                if(strtolower($testtagsid)==strtolower($colLabelid)){
                                    $colLabel = trim($element1->nodeValue);
                                }
                                if($colLabel)$colLabel_1=$colLabel;
                            }
                            if($colRowId && $tmpArr[2] && empty($tmpArr[2]) == false){
                                $rowArr = explode('_', $tmpArr[2]);
                                if(is_numeric(end($rowArr))) $rowId = end($rowArr);
                            }

                            if(empty($rowId) == false){
                                $labelComment = $element1->parentNode->textContent;
                            }
                        }

                        if($colLabel==''){$colLabel=$colLabel_1;}
                        if($colLabel==''){continue;}
                        if($testtagsid!='' && array_key_exists($testtagsid, $test_result_data_arr)) {
                            $resulttempArr[$colLabel][$elemSite][$labelComment]=$labelComment.' '.$test_result_data_arr[$testtagsid];
                        } else {
                            $tval="(n)";
                            if(stripos($testtagsid,'desc')!=false || stripos($testtagsid,'text')!=false){ $tval=""; }
                            $resulttempArr[$colLabel][$elemSite][$labelComment]=$labelComment.' '.$tval;
                        }
                    }
                }

                $htmlString2='';
                if(count($resulttempArr) > 0){
                    foreach($resulttempArr as $lbl2 => $val2){
                        $htmlString2.= '<tr>';
                        $htmlString2.= '<td style="width:200px;">'.$lbl2.'</td>';
                        $htmlString2.= '<td style="width:250px;" >';
                        foreach($val2['od'] as $lkey3 => $val3){
                            $htmlString2.= $val3."<br>";
                        }
                        $htmlString2.= '</td>';
                        $htmlString2.= '<td style="width:250px;" >';
                        foreach($val2['os'] as $lkey4 => $val4){
                            $htmlString2.= $val4."<br>";
                        }
                        $htmlString2.= '</td>';
                        $htmlString2.= '</tr>';
                    }
                }
                //die;
            ?>

                <table class="alignLeft" style="width:700px;" >
                    <tr>
                        <td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
                    </tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
                        <td class="bluehed text_cap paddingTop10"><?php echo strtoupper($temp_name);?></td>
                    </tr>
                    <tr class="alignLeft alignMiddle">
                        <td colspan="2" class="txt_11b alignLeft">
                            <table style="width:700px"  >
                                <tr style="height:20px">
                                    <td style="width:400px" id="test_main_options"><?php echo $elem_testOtherName;?></td>
                                    <td style="width:300px" align="left">
                                            <span style="color:purple;" class="drak_purple_color">OU</span>
                                            <?php echo ($elem_topoMeterEye == "OU") ? $yes : $no ;?>&nbsp;&nbsp;
                                            <span style="color:blue;" class="blue_color">OD</span>
                                            <?php echo ($elem_topoMeterEye == "OD") ? $yes : $no ;?>&nbsp;&nbsp;
                                            <span style="color:green;" class="green_color ">OS</span>
                                            <?php echo ($elem_topoMeterEye == "OS") ? $yes : $no ;?>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                      <div style="width:100%;"><strong>Technician Comments</strong>&nbsp;:&nbsp;<?php echo $elem_techComments; ?></div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr class="alignLeft alignMiddle">
                        <td  colspan="2" >
                            <strong>Performed By</strong>&nbsp;:&nbsp;<?php echo $objTests->getPersonnal3($elem_performedBy);?><br/>
                            <strong>Patient Understanding & Cooperation</strong>:
                            Good<?php echo ($elem_ptUnderstanding == '' || $elem_ptUnderstanding == "Good") ? " (yes)" : "" ;?>
                            Fair<?php echo ($elem_ptUnderstanding == "Fair") ? " (yes)" : "" ;?>
                            Poor<?php echo ($elem_ptUnderstanding == "Poor") ? " (yes)" : "" ;?>
                            <br/><strong>Diagnosis</strong>: <?php
                             if($elem_diagnosis=='Other') { echo $elem_diagnosisOther; }else { echo $elem_diagnosis;} ?>
                        </td>
                    </tr>
                    <tr class="alignLeft alignMiddle" >
                        <td  colspan="2"><strong>Physician Interpretation</strong>: -</td>
                    </tr>
                    <tr style="width:700px">
                        <td style="width:300px" colspan="2" >
                            <strong>Reliability</strong><br/>
                            <span style="color:blue;" class="blue_color txt_11b">OD</span>
                            Good<?php echo (!$elem_reliabilityOd || $elem_reliabilityOd == "Good") ? " (yes)" : "";?>&nbsp;&nbsp;
                            Fair<?php echo ($elem_reliabilityOd == "Fair") ? " (yes)" : "";?>&nbsp;&nbsp;
                            Poor<?php echo ($elem_reliabilityOd == "Poor") ? " (yes)" : "";?>&nbsp;&nbsp;
                            <br/><span style="color:green;" class="green_color ">OS</span>
                            Good<?php echo (!$elem_reliabilityOs || $elem_reliabilityOs == "Good") ? " (yes)" : "";?>&nbsp;&nbsp;
                            Fair<?php echo ($elem_reliabilityOs == "Fair") ? " (yes)" : "";?>&nbsp;&nbsp;
                            Poor<?php echo ($elem_reliabilityOs == "Poor") ? " (yes)" : "";?>&nbsp;&nbsp;
                        </td>
                    </tr>

                    <tr class="alignLeft alignMiddle">
                        <td  colspan="2" class="txt_11b alignLeft">
                            <table cellpadding="0" cellspacing="0"  style="width:700px">
                                <tr class="alignLeft alignMiddle" >
                                    <td colspan="2" ><strong>Test Results</strong>: -</td>
                                </tr>
                                <tr>
                                    <td style="width:200px;" class="drak_purple_color alignCenter alignMiddle">&nbsp;</td>
                                    <td style="width:250px;color:blue;" class="alignCenter blue_color" >OD</td>
                                    <td style="width:250px;color:green;" class="alignCenter green_color">OS</td>
                                </tr>
                            </table>
                            <table cellpadding="0" cellspacing="0"  style="width:700px">
<!--                                <tbody id="tbl_test_results"><?php //echo str_replace(array('label','div'),'br',html_entity_decode($elem_test_results));?></tbody>-->
                                <tbody id="tbl_test_results"><?php echo $htmlString2;?></tbody>
                            </table>
                        </td>
                    </tr>

                    <tr>
                        <td colspan="2" id="test_treatment_options">
                            <?php
                            $treat_rs=$no;
                            $test_treat_data_arr=array();
                            $test_treat_col = explode('&', $test_treatment);
                            foreach($test_treat_col as $ttd) {
                                $test_treat_data1=  explode('=', $ttd);
                                $test_treat_data_arr[$test_treat_data1[0]]= html_entity_decode($test_treat_data1[1]);
                                $treat_rs=$yes;
                            }
                            $tmpArrFinal1=array();
                            $dom1 = new DOMDocument();
                            $dom1->loadHTML(html_entity_decode($elem_test_treatment));
                            foreach($dom1->getElementsByTagName('*') as $element ){
                                if($element->tagName=='input'){
                                    $elemSite = $rowId = $labelComment = $value = '';

                                    $testtagsid = $element->getAttribute('id');
                                    if(empty($testtagsid)==false) {
                                        $testtags = $dom1->getElementById($testtagsid);

                                        if(empty($testtagsid) == false){
                                            $tmpArr = array();
                                            $tmpArr = explode('-', $testtagsid);
                                            if($tmpArr[1] && empty($tmpArr[1]) == false){
                                                $rowArr = explode('_', $tmpArr[1]);
                                                if(is_numeric(end($rowArr))) $rowId = end($rowArr);
                                            }
                                            if(empty($rowId) == false){
                                                $labelComment = $testtags->parentNode->textContent;
                                            }
                                        }

                                       $value=$testtags->attributes->getNamedItem->value;
                                       if(empty($value)==false) {
                                           if($value=='1')$value=$yes;else $value=$no;
                                       }
                                    }

                                    $tmpArrFinal1[$labelComment] = $value;
                                }
                            }

                            $test_treatment_html='';
                            $htmlString1 = '';
                            if(count($tmpArrFinal1) > 0){
                                $htmlString1 .= '<tr>';
                                $count=0;
                                foreach($tmpArrFinal1 as $lbl => $val){
                                    $count++;
                                    $htmlString1 .= '<td style="width:350px">'.$lbl.''.$val.'</td>';
                                    if($count==2){
                                        $htmlString1 .= '</tr><tr>';
                                        $count=0;
                                    }
                                }
                                $htmlString1 .= '</tr>';
                            }
                            if(empty($htmlString1) == false){
                                $htmlString1 = $htmlString1;
                            }
                            ?>
                            <table class="alignLeft" style="width:700px;" >
                                <tr class="alignLeft alignMiddle">
                                    <td style="height:20px;" colspan="2" class="txt_11b"><strong>Treatment/Prognosis</strong> : -</td>
                                </tr>
                                <tr>
                                    <td style="width:350px;"><span class="label_txt">Stable<?php if($test_treat_data_arr['elem_contiMeds']==1) {  echo '(y)';}else { echo '(n)';}?></span><br></td>
                                    <td style="width:350px;"><span class="label_txt">Continue Meds<?php if($test_treat_data_arr['elem_contiMeds']==1) {  echo '(y)';}else { echo '(n)';}?></span><br></td>
                                </tr>
                                <tr>
                                    <td style="width:350px;"><span class="label_txt" >Tech to Inform Pt.<?php if($test_treat_data_arr['elem_tech2InformPt']==1) {  echo '(y)';}else { echo '(n)';}?></span><br></td>
                                    <td style="width:350px;"><span class="label_txt" >Inform Pt result next visit<?php if($test_treat_data_arr['elem_informedPtNv']==1) { echo '(y)';}else { echo '(n)';}?></span><br></td>
                                </tr>
                                <tr>
                                    <td style="width:350px;"><span class="label_txt" >F/U APA<?php if($test_treat_data_arr['elem_fuApa']==1) { echo '(y)';}else { echo '(n)';}?></span><br></td>
                                    <td style="width:350px;"><span class="label_txt" >Pt informed of results<?php if($test_treat_data_arr['elem_ptInformed']==1) { echo '(y)';}else { echo '(n)';}?></span><br></td>
                                </tr>
                                <tr><?php echo $htmlString1;//str_replace(array('label','div'),'td',html_entity_decode($elem_test_treatment));?></tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
						<td colspan="2" style="height:10px">
							<?php
								///Add TestLabs Images//
								$imagesHtml = $this->getTestImages($test_pkid,$sectionImageFrom="CustomTests",$patient_id);
								if($imagesHtml!=""){
									echo('<table >
											'.$imagesHtml.'
										</table>');
								}
								$imagesHtml="";
								//End TestLabs Images

							?>
						</td>
					</tr>
                    <tr>
                       <td  class="alignLeft" ><strong>Interpreted By:</strong> &nbsp;&nbsp;
                            <?php
                                if($elem_physician){
                                    $getPersonnal3 = $objTests->getPersonnal3($elem_physician);
                                }else{
                                    $getPersonnal3 = '';
                                }
                                echo $getPersonnal3;
                            ?>
                        <br/><strong>Future Appointments:</strong>&nbsp;&nbsp;<?php $data = $objTests->getFutureApp($patient_id);echo $data;?></td>
                    </tr>
                    <tr><td colspan="2" id="insert_sign_html_here"></td></tr>
                </table>

           <?php } else { /* ?>
                <table style="width:740px;"  cellpadding="0" cellspacing="0">
					<tr>
						<td class="bluelne" height="1" style="width:750px;">&nbsp;</td>
					</tr>
					<tr>
						<td height="2"></td>
					</tr>
					<tr>
						<td class="bluehed text_cap paddingTop10"><?php echo strtoupper($temp_name);?></td>
					</tr>
					<tr>
						<td>No Data</td>
					</tr>
			   </table>

           <?php */ }
        }

    }


    function print_all_history_physical($pid,$arrReq) {
        include_once($GLOBALS['srcdir']."/classes/medical_hx/history_physical.class.php");

        $historyPhysical = new HistoryPhysical($medical->current_tab);
        $getAddQuestions=$pt_custom_quesArr=$historyPhysical->pt_custom_ques;
        if(empty($pt_custom_quesArr)==true)
        $getAddQuestions=$custom_quesArr=$historyPhysical->custom_ques;

        extract($historyPhysical->data);

        $table_main.='<table style="width:700px;font-size:14px; margin-top:10px;" cellpadding="0" cellspacing="0">
				<tr>
                <td style="width:700px;vertical-align:top;" >
						<table style="width:700px; font-size:14px;" cellpadding="0" cellspacing="0">
							<tr>
								<td style="width:600px;font-weight:bold; padding-top:5px;">History And Physical</td>
								<td style="width:100px;font-weight:bold;text-align:center; padding-top:5px;">Yes/No</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">CAD/MIN(W/ WO Stent OR CABG)/PVD)';
								if($cadMI=="Yes" && trim($cadMIDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($cadMIDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($cadMI!=""){$table_main.=$cadMI;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">CVA/TIA/ Epilepsy, Neurological';
								if($cvaTIA=="Yes" && trim($cvaTIADesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($cvaTIADesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($cvaTIA!=""){$table_main.=$cvaTIA;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">HTN/ +/- CP/SOB on Exertion';
								if($htnCP=="Yes" && trim($htnCPDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($htnCPDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($htnCP!=""){$table_main.=$htnCP;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Anticoagulation therapy (i.e. Blood Thinners)';
								if($anticoagulationTherapy=="Yes" && trim($anticoagulationTherapyDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($anticoagulationTherapyDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($anticoagulationTherapy!=""){$table_main.=$anticoagulationTherapy;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Respiratory - Asthma / COPD / Sleep Apnea';
								if($respiratoryAsthma=="Yes" && trim($respiratoryAsthmaDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($respiratoryAsthmaDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($respiratoryAsthma!=""){$table_main.=$respiratoryAsthma;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Arthritis';
								if($arthritis=="Yes" && trim($arthritisDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($arthritisDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($arthritis!=""){$table_main.=$arthritis;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Diabetes';
								if($diabetes=="Yes" && trim($diabetesDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($diabetesDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($diabetes!=""){$table_main.=$diabetes;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Recreational Drug Use';
								if($recreationalDrug=="Yes" && trim($recreationalDrugDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($recreationalDrugDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($recreationalDrug!=""){$table_main.=$recreationalDrug;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">GI - GERD / PUD / Liver Disease / Hepatitis';
								if($giGerd=="Yes" && trim($giGerdDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($giGerdDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($giGerd!=""){$table_main.=$giGerd;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Ocular';
								if($ocular=="Yes" && trim($ocularDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($ocularDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($ocular!=""){$table_main.=$ocular;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Kidney Disease, Dialysis, G-U';
								if($kidneyDisease=="Yes" && trim($kidneyDiseaseDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($kidneyDiseaseDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($kidneyDisease!=""){$table_main.=$kidneyDisease;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">HIV, Autoimmune Diseases, Contagious Diseases';
								if($hivAutoimmune=="Yes" && trim($hivAutoimmuneDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($hivAutoimmuneDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($hivAutoimmune!=""){$table_main.=$hivAutoimmune;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">History of Cancer';
								if($historyCancer=="Yes" && trim($historyCancerDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($historyCancerDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($historyCancer!=""){$table_main.=$historyCancer;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Organ Transplant';
								if($organTransplant=="Yes" && trim($organTransplantDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($organTransplantDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($organTransplant!=""){$table_main.=$organTransplant;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>';
							$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">A Bad Reaction to Local or General Anesthesia';
								if($badReaction=="Yes" && trim($badReactionDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.stripslashes($badReactionDesc).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($badReaction!=""){$table_main.=$badReaction;}else{$table_main.="____";}
								$table_main.='</td>
							</tr>

							<tr>
								<td colspan="2" style="width:600px;padding-top:5px;">Other:&nbsp;'.stripslashes($otherHistoryPhysical).'</td>
							</tr>';


							//if($version_num > 1)
							//{

								// Heart Exam Field
								$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Heart Exam done with stethoscope - Normal';
								if($heartExam=="No" && trim($heartExamDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.htmlentities(stripslashes($heartExamDesc)).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px;text-align:center; padding-top:5px;">';
								if($heartExam!=""){$table_main.=$heartExam;}else{$table_main.="____";}
								$table_main.='</td>
								</tr>';


								//Lung Exam
								$table_main.='<tr>
								<td style="width:600px; padding-top:5px;">Lung Exam done with stethoscope - Normal';
								if($lungExam=="No" && trim($lungExamDesc)){
									$table_main.='<br>
									<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
										<tr>
											<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
											<td style="width:400px;">'.htmlentities(stripslashes($lungExamDesc)).'</td>
										</tr>
									</table>';
								}
								$table_main.='</td>
								<td style="width:100px; text-align:center; padding-top:5px;">';
								if($lungExam!=""){$table_main.=$lungExam;}else{$table_main.="____";}
								$table_main.='</td>
								</tr>';

							//}
							//if($version_num > 2) {
								$table_main.='
								<tr>
									<td style="width:600px; padding-top:5px;">Discussed Advanced Directives and Patient Rights and Responsibilities</td>
									<td style="width:100px;text-align:center; padding-top:5px;">';
										if($discussedAdvancedDirective!=""){$table_main.=$discussedAdvancedDirective;}else{$table_main.="____";}
								$table_main.='
									</td>
								</tr>';
							//}

							// Start Printing H&P Dynamic questions
							//$getAddQuestions = $objManageData->getAllRecords('history_physical_ques','', array('confirmation_id = '=>$pConfId), array(),array('ques + 0'=>'ASC'));
							if( is_array($getAddQuestions) && count($getAddQuestions) > 0 ) {
								foreach($getAddQuestions as $qArr){
									$table_main.='<tr>
																	<td style="width:600; padding-top:5px;">'.stripslashes($qArr['ques']);
																	if($qArr['ques_status']=="Yes" && trim($qArr['ques_desc'])){
																		$table_main.='<br>
																		<table style="width:500px; font-size:14px; padding-top:5px;" cellpadding="0" cellspacing="0">
																			<tr>
																				<td style="width:100px;font-weight:bold;font-style:italic;">Describe:&nbsp;</td>
																				<td style="width:400px;">'.htmlentities(stripslashes($qArr['ques_desc'])).'</td>
																			</tr>
																		</table>';
																	}
																	$table_main.='</td>
																	<td style="width:100px;text-align:center; padding-top:5px;">';
																	if($qArr['ques_status']!=""){$table_main.=$qArr['ques_status'];}else{$table_main.="____";}
																	$table_main.='</td>
																</tr>';
								}
							}

						$table_main.='</table>
					</td>
				</tr>
			</table>';



       // return $table_main;
        echo $table_main;
    }
	//TO DISPLAY PRIMARY /REF. PHYSICIAN INTO TOP OF CPR PRINTING
	public function print_PhysIntoCPRHeader($pid)
	{
		$cprNewPrint="YES";
		$printProvider =$this->print_provider($pid,$cprNewPrint);

		return $printProvider;
	}
	//GET Print CUSTOM FIELDS OF MED HX OCULAR GENERAL HEALTH SECTION
	public function get_customFields_MedHx($pid,$moduleName){

		$sub_module = 'Medical Hx -> ';
		$sub_module .= ($moduleName == 'general_health') ? 'General Health' : 'Ocular' ;

		if($pid){

			$qryMedHXCustFlds = "select cf.id as adminControlId, cf.control_lable as adminControlLable,
									cf.control_type as adminControltype, cf.cbk_default_select as adminCbkDefaultSelect,
									cf.default_value as adminDefaultvalue, cf.control_name as adminControlName,
									cf.module_section as adminModuleSection, pcf.id as patientControlId,
									pcf.patient_id as patientControlPatientId, pcf.patient_control_value as patientControlVal,
									pcf.patient_cbk_control_value as patientCbkControlVal
									FROM  custom_fields cf
									LEFT JOIN patient_custom_field pcf on
									cf.id = pcf.admin_control_id and pcf.patient_id = '".$pid."'
									where cf.module = 'Med_Hx'
									and cf.sub_module ='".$sub_module."'
									and cf.status = '0' order by cf.id ";

			$return = array();
			$resMedHXCustFlds=imw_query($qryMedHXCustFlds)or die(imw_error());
			if(imw_num_rows($resMedHXCustFlds)>0){
				while($rowMedHXCustFlds=imw_fetch_assoc($resMedHXCustFlds))
				{
					$arrMedHXCustFlds = array();
					$arrMedHXCustFlds['adminControlId']=$rowMedHXCustFlds['adminControlId'];
					$arrMedHXCustFlds['adminControlLable']=$rowMedHXCustFlds['adminControlLable'];
					$arrMedHXCustFlds['adminControltype']=$rowMedHXCustFlds['adminControltype'];
					$arrMedHXCustFlds['adminCbkDefaultSelect']=$rowMedHXCustFlds['adminCbkDefaultSelect'];
					$arrMedHXCustFlds['adminDefaultvalue']=$rowMedHXCustFlds['adminDefaultvalue'];
					$arrMedHXCustFlds['adminControlName']=$rowMedHXCustFlds['adminControlName'];
					$arrMedHXCustFlds['adminModuleSection']=$rowMedHXCustFlds['adminModuleSection'];
					$arrMedHXCustFlds['patientControlId']=$rowMedHXCustFlds['patientControlId'];
					$arrMedHXCustFlds['patientControlPatientId']=$rowMedHXCustFlds['patientControlPatientId'];
					$arrMedHXCustFlds['patientControlVal']=$rowMedHXCustFlds['patientControlVal'];
					$arrMedHXCustFlds['patientCbkControlVal']=$rowMedHXCustFlds['patientCbkControlVal'];
					$return[] =  $arrMedHXCustFlds;
				}
			}
		}
		return $return;
	}

	/**
	 * Lasik Section
	 */
	public function print_getLasik($pid,$fid) {
		$sql_lasik = "SELECT * FROM chart_vis_lasik WHERE patient_id = ".$pid." AND form_id = ".$fid;
		$result_lasik = imw_query($sql_lasik);
		if( imw_num_rows($result_lasik) > 0 ) {
			$data_l = imw_fetch_assoc($result_lasik);
			$return = "<table style=\"width:750px;\" cellpadding=\"0\" cellspacing=\"2\">";
			ob_start();?>
			<tr>
				<td colspan="6" class="">
					<b>LASIK (<?php echo ($data_l['date_lasik'] != "") ? date(phpDateFormat(),strtotime($data_l['date_lasik'])) : ''.' '.$data_l['time_lasik'];?>)</b>
				</td>
			</tr>
			<tr>
				<td class="tb_subheading" width="70" align="left">Method</td>
				<td class="tb_subheading" width="100" align="left">Intervention</td>
				<td class="tb_subheading" width="120" align="left">Microkeratome</td>
				<td class="tb_subheading" width="120" align="left">Laser Excimer</td>
				<td class="tb_subheading" width="120" align="left">Laser Mode</td>
				<td class="tb_subheading" width="150" align="left">Laser Optical Zone</td>
			</tr>
			<tr>
				<td width="70">
					<?php
						if( isset($data_l['method']) && $data_l['method'] != "" ){
							echo '<p>'.$data_l['method'].'</p>';
						}
					?>
				</td>
				<td width="100">
					<?php
						if( isset($data_l['intervention']) && $data_l['intervention'] != "" ){
							echo '<p>'.$data_l['intervention'].'</p>';
						}
					?>
				</td>
				<td width="120">
					<?php
						if( isset($data_l['microkeratome']) && $data_l['microkeratome'] != "" ){
							echo '<p>'.$data_l['microkeratome'].'</p>';
						}
					?>
				</td>
				<td width="120">
					<?php
						if( isset($data_l['laser_excimer']) && $data_l['laser_excimer'] != "" ){
							echo '<p>'.$data_l['laser_excimer'].'</p>';
						}
					?>
				</td>
				<td width="120">
					<?php
						if( isset($data_l['laser_mode']) && $data_l['laser_mode'] != "" ){
							echo '<p>'.$data_l['laser_mode'].'</p>';
						}
					?>
				</td>
				<td width="150">
					<?php
						if( isset($data_l['laser_optical_zone']) && $data_l['laser_optical_zone'] != "" ){
							echo '<p>'.$data_l['laser_optical_zone'].'</p>';
						}
					?>
				</td>
			</tr>
			<tr>
				<td colspan="6" class="paddingTop10">
					<table style="width:750px;" cellspacing="3" cellpadding="0">
						<tr>
							<td width="360" class="tb_subheading">Target</td>
							<td width="360" class="tb_subheading">Laser</td>
						</tr>
						<tr>
							<td>
								<?php
									$target = json_decode($data_l['target']);
									$targetData = '';
									$label = '';
									foreach ($target as $key => $t) {
										switch (strtolower($key)) {
											case 'os':
												$label = $this->osLable(1);
												break;
											case 'od':
												$label = $this->odLable(1);
												break;
											default:
												$label = $key;
												break;
										}
										$targetData.='<p><b>'.strtoupper($label).': </b>';
										if(strtolower($key) == 'os' || strtolower($key) == 'od') {
											foreach ($t as $key => $value) {
												if($value != "" && !empty($value)) {
													$targetData.='<b>'.$key.':</b>'.$value.',&nbsp;';
												}
											}
										} else {
											$targetData.=$t;
										}
										$targetData.='</p>';
									}
									echo $targetData;
								?>
							</td>
							<td>
								<?php
									$laser = json_decode($data_l['laser']);
									$laserData = '';
									foreach ($laser as $key => $t) {
										switch (strtolower($key)) {
											case 'os':
												$label = $this->osLable(1);
												break;
											case 'od':
												$label = $this->odLable(1);
												break;
											default:
												$label = $key;
												break;
										}
										$laserData.='<p><b>'.strtoupper($label).': </b>';
										if(strtolower($key) == 'os' || strtolower($key) == 'od') {
											foreach ($t as $key => $value) {
												if($value != "" && !empty($value)) {
													$laserData.='<b>'.$key.':</b>'.$value.',&nbsp;';
												}
											}
										} else {
											$laserData.=$t;
										}
										$laserData.='</p>';
									}
									echo $laserData;

								?>
							</td>
						</tr>
					</table>
				</td>
			</tr>

			<?php
			$return .= ob_get_contents();
			ob_end_clean();
			$return.="</table>";

		}
		echo $return;
	}

	  function print_iol_master($patient_id, $form_id, $req) {

        if (is_array($req) && count($req) > 0) {
            $sql = "SELECT * FROM iol_master_tbl WHERE patient_id = '$patient_id' AND iol_master_id in(" . implode(",", $req) . ")";
        } else if ($form_id!="") {
            $sql = "SELECT * FROM iol_master_tbl WHERE patient_id = '$patient_id' AND form_id = '$form_id'";
	   }


        $rowlenstar = imw_query($sql);
        if(imw_num_rows($rowlenstar) > 0) {
            while($getSurgicalRecordSavedRow=imw_fetch_assoc($rowlenstar)) {

              $temp_name='iol master';
                $test_id=$getSurgicalRecordSavedRow["iol_master_id"];
                ////////////////////////////////////////////// NOT EXTRACTED VARIABLES
			$test_form_id = $getSurgicalRecordSavedRow["form_id"];
			$sign_path = $getSurgicalRecordSavedRow["sign_path"];
			$sign_path_date_time = $getSurgicalRecordSavedRow["sign_path_date_time"];
			$sign_path_date = $sign_path_time = "";
			if($sign_path && $sign_path_date_time!="0000-00-00 00:00:00" || $sign_path_date_time!=0) {
				$sign_path_date = date("".phpDateFormat()."",strtotime($sign_path_date_time));
				$sign_path_time = date("h:i A",strtotime($sign_path_date_time));
			}

			//OD
				//MR VALUES
				$vis_mr_od_s = $getSurgicalRecordSavedRow['mrSOD'];
					$vis_mr_od_sC = $vis_mr_od_s;
				$vis_mr_od_c = $getSurgicalRecordSavedRow['mrCOD'];
					$vis_mr_od_cC = $vis_mr_od_c;
				$vis_mr_od_a = $getSurgicalRecordSavedRow['mrAOD'];
					$vis_mr_od_aC = $vis_mr_od_a;
				$vis_ak_od_k = $getSurgicalRecordSavedRow['k1Auto1OD'];
					$vis_ak_od_kC = $vis_ak_od_k;
				$vis_ak_od_x = $getSurgicalRecordSavedRow['k1Auto2OD'];
					$vis_ak_od_xC = $vis_ak_od_x;
				$vis_ak_od_slash = $getSurgicalRecordSavedRow['k2Auto1OD'];
					$vis_ak_od_slashC = $vis_ak_od_slash;
				$k2Auto2OD = $getSurgicalRecordSavedRow['k2Auto2OD'];
					$k2Auto2ODC = $k2Auto2OD;

				//PERFORMED BY PROVIDER AND DATE
				$authUserId = $getSurgicalRecordSavedRow['performedByOD'];
				$dateOD = $getSurgicalRecordSavedRow['dateOD'];
					list($dateODYear, $dateODMonth, $dateODDay) = explode("-", $dateOD);
					$today = $dateODMonth."-".$dateODDay."-".$dateODYear;
				//K READING VALUES K[Auto]
				$autoSelectOD = $getSurgicalRecordSavedRow['autoSelectOD'];
					$autoSelectOD = $this->getKheadingName($autoSelectOD);
				$iolMasterSelectOD = $getSurgicalRecordSavedRow['iolMasterSelectOD'];
					$iolMasterSelectOD = $this->getKheadingName($iolMasterSelectOD);
				$topographerSelectOD = $getSurgicalRecordSavedRow['topographerSelectOD'];
					$topographerSelectOD = $this->getKheadingName($topographerSelectOD);
				//IOL VALUES HOLLADAY
				$powerIolOD = $getSurgicalRecordSavedRow['powerIolOD'];
					$powerIolOD = $this->getFormulaHeadName($powerIolOD);
				$holladayOD = $getSurgicalRecordSavedRow['holladayOD'];
					$holladayOD = $this->getFormulaHeadName($holladayOD);
				$srk_tOD = $getSurgicalRecordSavedRow['srk_tOD'];
					$srk_tOD = $this->getFormulaHeadName($srk_tOD);
				$hofferOD = $getSurgicalRecordSavedRow['hofferOD'];
					$hofferOD = $this->getFormulaHeadName($hofferOD);
				//PERFORMED BY IOL
				$provider_idOD = $getSurgicalRecordSavedRow['performedByPhyOD'];
				//IOL VALUES
				$iol1OD = $getSurgicalRecordSavedRow['iol1OD'];
				if($iol1OD!=''){
					$providerLensesArrOD[0] = $this->getLenseName($iol1OD);
					$providerLensesODArr[$iol1OD] = $this->getLenseName($iol1OD);
				}
				$iol2OD = $getSurgicalRecordSavedRow['iol2OD'];
				if($iol2OD!=''){
					$providerLensesArrOD[1] = $this->getLenseName($iol2OD);
					$providerLensesODArr[$iol2OD] = $this->getLenseName($iol2OD);
				}
				$iol3OD = $getSurgicalRecordSavedRow['iol3OD'];
				if($iol3OD!=''){
					$providerLensesArrOD[2] = $this->getLenseName($iol3OD);
					$providerLensesODArr[$iol3OD] = $this->getLenseName($iol3OD);
				}
				$iol4OD = $getSurgicalRecordSavedRow['iol4OD'];
				if($iol4OD!=''){
					$providerLensesArrOD[3] = $this->getLenseName($iol4OD);
					$providerLensesODArr[$iol4OD] = $this->getLenseName($iol4OD);
				}

			//OS
				//MR VALUES
				$vis_mr_os_s = $getSurgicalRecordSavedRow['mrSOS'];
					$vis_mr_os_sC = $vis_mr_os_s;
				$vis_mr_os_c = $getSurgicalRecordSavedRow['mrCOS'];
					$vis_mr_os_cC = $vis_mr_os_c;
				$vis_mr_os_a = $getSurgicalRecordSavedRow['mrAOS'];
					$vis_mr_os_aC = $vis_mr_os_a;
				$vis_ak_os_k = $getSurgicalRecordSavedRow['k1Auto1OS'];
					$vis_ak_os_kC = $vis_ak_os_k;
				$vis_ak_os_x = $getSurgicalRecordSavedRow['k1Auto2OS'];
					$vis_ak_os_xC = $vis_ak_os_x;
				$vis_ak_os_slash = $getSurgicalRecordSavedRow['k2Auto1OS'];
					$vis_ak_os_slashC = $vis_ak_os_slash;
				$k2Auto2OS = $getSurgicalRecordSavedRow['k2Auto2OS'];
					$k2Auto2OSC = $k2Auto2OS;

				//PERFORMED BY PROVIDER AND DATE
				$provider_idOS = $getSurgicalRecordSavedRow['performedByOS'];
				$dateOS = $getSurgicalRecordSavedRow['dateOS'];
					list($dateOSYear, $dateOSMonth, $dateOSDay) = explode("-", $dateOS);
					$dateOS = $dateOSMonth."-".$dateOSDay."-".$dateOSYear;
				//K READING VALUES K[Auto]
				$autoSelectOS = $getSurgicalRecordSavedRow['autoSelectOS'];
					$autoSelectOS = $this->getKheadingName($autoSelectOS);
				$iolMasterSelectOS = $getSurgicalRecordSavedRow['iolMasterSelectOS'];
					$iolMasterSelectOS = $this->getKheadingName($iolMasterSelectOS);
				$topographerSelectOS = $getSurgicalRecordSavedRow['topographerSelectOS'];
					$topographerSelectOS = $this->getKheadingName($topographerSelectOS);
				//IOL VALUES HOLLADAY
				$powerIolOS = $getSurgicalRecordSavedRow['powerIolOS'];
					$powerIolOS = $this->getFormulaHeadName($powerIolOS);
				$holladayOS = $getSurgicalRecordSavedRow['holladayOS'];
					$holladayOS = $this->getFormulaHeadName($holladayOS);
				$srk_tOS = $getSurgicalRecordSavedRow['srk_tOS'];
					$srk_tOS = $this->getFormulaHeadName($srk_tOS);
				$hofferOS = $getSurgicalRecordSavedRow['hofferOS'];
					$hofferOS = $this->getFormulaHeadName($hofferOS);
				//IOL VALUES
				$iol1OS = $getSurgicalRecordSavedRow['iol1OS'];
				if($iol1OS!=''){
					$providerLensesArrOS[0] = $this->getLenseName($iol1OS);
					$providerLensesOSArr[$iol1OS] = $this->getLenseName($iol1OS);
				}
				$iol2OS = $getSurgicalRecordSavedRow['iol2OS'];
				if($iol2OS!=''){
					$providerLensesArrOS[1] = $this->getLenseName($iol2OS);
					$providerLensesOSArr[$iol2OS] = $this->getLenseName($iol2OS);
				}
				$iol3OS = $getSurgicalRecordSavedRow['iol3OS'];
				if($iol3OS!=''){
					$providerLensesArrOS[2] = $this->getLenseName($iol3OS);
					$providerLensesOSArr[$iol3OS] = $this->getLenseName($iol3OS);
				}
				$iol4OS = $getSurgicalRecordSavedRow['iol4OS'];
				if($iol4OS!=''){
					$providerLensesArrOS[3] = $this->getLenseName($iol4OS);
					$providerLensesOSArr[$iol4OS] = $this->getLenseName($iol4OS);
				}

				/* Date & Time */
				$tmp = $getSurgicalRecordSavedRow["examDate"];
				$elem_examTime = $getSurgicalRecordSavedRow["examTime"];

				if($tmp != "0000-00-00"){
					$elem_examDate = get_date_format($tmp);
				}

				/* Date & Time */

				$encounterId = $getSurgicalRecordSavedRow["encounter_id"];
				$elem_opidTestOrdered = $getSurgicalRecordSavedRow["ordrby"];
				if(($getSurgicalRecordSavedRow["ordrdt"] != "" && $getSurgicalRecordSavedRow["ordrdt"] != "0000-00-00")){
					$elem_opidTestOrderedDate = get_date_format($getSurgicalRecordSavedRow["ordrdt"]);
				}

				//Ag 09 changes --

				$sur_dateOD = $getSurgicalRecordSavedRow["sur_dt_od"];
				$elem_proc_od = $getSurgicalRecordSavedRow["proc_od"];
				$elem_anes_od = $getSurgicalRecordSavedRow["anes_od"];
				$elem_visc_od = $getSurgicalRecordSavedRow["visc_od"];
				$elem_visc_od_other = $getSurgicalRecordSavedRow["visc_od_other"];
				$elem_opts_od = $getSurgicalRecordSavedRow["opts_od"];
				$elem_opts_od_other = $getSurgicalRecordSavedRow["opts_od_other"];
				$elem_iol2dn_od = $getSurgicalRecordSavedRow["iol2dn_od"];

				$sur_dateOS = $getSurgicalRecordSavedRow["sur_dt_os"];
				$elem_proc_os = $getSurgicalRecordSavedRow["proc_os"];
				$elem_anes_os = $getSurgicalRecordSavedRow["anes_os"];
				$elem_visc_os = $getSurgicalRecordSavedRow["visc_os"];
				$elem_visc_os_other = $getSurgicalRecordSavedRow["visc_os_other"];
				$elem_opts_os = $getSurgicalRecordSavedRow["opts_os"];
				$elem_opts_os_other = $getSurgicalRecordSavedRow["opts_os_other"];
				$elem_iol2dn_os = $getSurgicalRecordSavedRow["iol2dn_os"];

				//Ag 09 changes --

				//chart notes vales
				$str_cn_vals=$getSurgicalRecordSavedRow["cn_mrk_val"];

			/////////////////////////////////////////////// NOT EXTRACTED VARIABLES

	//FOR COMPARE
		//IF PREVIOUS NOT EXISTS

				$authUserIdC = $authUserId;
				$dateODC = $dateOD;
				$autoSelectODC = $autoSelectOD;
				$iolMasterSelectODC = $iolMasterSelectOD;
				$topographerSelectODC = $topographerSelectOD;
				$k1IolMaster1ODC = $k1IolMaster1OD;
				$k1IolMaster2ODC = $k1IolMaster2OD;
				$k1Topographer1ODC = $k1Topographer1OD;
				$k1Topographer2ODC = $k1Topographer2OD;
				$k2IolMaster1ODC = $k2IolMaster1OD;
				$k2IolMaster2ODC = $k2IolMaster2OD;
				$k2Topographer1ODC = $k2Topographer1OD;
				$k2Topographer2ODC = $k2Topographer2OD;
				$cylIolMaster1ODC = $cylIolMaster1OD;
				$cylIolMaster2ODC = $cylIolMaster2OD;
				$cylTopographer1ODC = $cylTopographer1OD;
				$cylTopographer2ODC = $cylTopographer2OD;
				$aveIolMasterODC = $aveIolMasterOD;
				$aveTopographerODC = $aveTopographerOD;
				$contactLengthODC = $contactLengthOD;
				$immersionLengthODC = $immersionLengthOD;
				$iolMasterLengthODC = $iolMasterLengthOD;
				$contactNotesODC = $contactNotesOD;
				$immersionNotesODC = $immersionNotesOD;
				$iolMasterNotesODC = $iolMasterNotesOD;
				$performedByPhyODC = $performedByPhyOD;
				$powerIolODC = $powerIolOD;
				$holladayODC = $holladayOD;
				$srk_tODC = $srk_tOD;
				$hofferODC = $hofferOD;
				$iol1ODC = $iol1OD;
				$iol1PowerODC = $iol1PowerOD;
				$iol1HolladayODC = $iol1HolladayOD;
				$iol1srk_tODC = $iol1srk_tOD;
				$iol1HofferODC = $iol1HofferOD;
				$iol2ODC = $iol2OD;
				$iol2PowerODC = $iol2PowerOD;
				$iol2HolladayODC = $iol2HolladayOD;
				$iol2srk_tODC = $iol2srk_tOD;
				$iol2HofferODC = $iol2HofferOD;
				$iol3ODC = $iol3OD;
				$iol3PowerODC = $iol3PowerOD;
				$iol3HolladayODC = $iol3HolladayOD;
				$iol3srk_tODC = $iol3srk_tOD;
				$iol3HofferODC = $iol3HofferOD;
				$iol4ODC = $iol4OD;
				$iol4PowerODC = $iol4PowerOD;
				$iol4HolladayODC = $iol4HolladayOD;
				$iol4srk_tODC = $iol4srk_tOD;
				$iol4HofferODC = $iol4HofferOD;
				$cellCountODC = $cellCountOD;
				$notesODC = $notesOD;
				$pachymetryValODC = $pachymetryValOD;
				$pachymetryCorrecODC = $pachymetryCorrecOD;
				$cornealDiamODC = $cornealDiamOD;
				$dominantEyeODC = $dominantEyeOD;
				$pupilSize1ODC = $pupilSize1OD;
				$pupilSize2ODC = $pupilSize2OD;
				$cataractODC = $cataractOD;
				$astigmatismODC = $astigmatismOD;
				$myopiaODC = $myopiaOD;
				$selecedIOLsODC = $selecedIOLsOD;
				$notesAssesmentPlansODC = $notesAssesmentPlansOD;
				$lengthODC = $lengthOD;
				$lengthTypeODC = $lengthTypeOD;
				$axisODC = $axisOD;
				$performedByOSC = $performedByOS;
				$dateOSC = $dateOS;
				$autoSelectOSC = $autoSelectOS;
				$iolMasterSelectOSC = $iolMasterSelectOS;
				$topographerSelectOSC = $topographerSelectOS;
				$k1IolMaster1OSC = $k1IolMaster1OS;
				$k1IolMaster2OSC = $k1IolMaster2OS;
				$k1Topographer1OSC = $k1Topographer1OS;
				$k1Topographer2OSC = $k1Topographer2OS;
				$k2IolMaster1OSC = $k2IolMaster1OS;
				$k2IolMaster2OSC = $k2IolMaster2OS;
				$k2Topographer1OSC = $k2Topographer1OS;
				$k2Topographer2OSC = $k2Topographer2OS;
				$cylIolMaster1OSC = $cylIolMaster1OS;
				$cylIolMaster2OSC = $cylIolMaster2OS;
				$cylTopographer1OSC = $cylTopographer1OS;
				$cylTopographer2OSC = $cylTopographer2OS;
				$aveIolMasterOSC = $aveIolMasterOS;
				$aveTopographerOSC = $aveTopographerOS;
				$contactLengthOSC = $contactLengthOS;
				$immersionLengthOSC = $immersionLengthOS;
				$iolMasterLengthOSC = $iolMasterLengthOS;
				$contactNotesOSC = $contactNotesOS;
				$immersionNotesOSC = $immersionNotesOS;
				$iolMasterNotesOSC = $iolMasterNotesOS;
				$powerIolOSC = $powerIolOS;
				$holladayOSC = $holladayOS;
				$srk_tOSC = $srk_tOS;
				$hofferOSC = $hofferOS;
				$iol1OSC = $iol1OS;
				$iol1PowerOSC = $iol1PowerOS;
				$iol1HolladayOSC = $iol1HolladayOS;
				$iol1srk_tOSC = $iol1srk_tOS;
				$iol1HofferOSC = $iol1HofferOS;
				$iol2OSC = $iol2OS;
				$iol2PowerOSC = $iol2PowerOS;
				$iol2HolladayOSC = $iol2HolladayOS;
				$iol2srk_tOSC = $iol2srk_tOS;
				$iol2HofferOSC = $iol2HofferOS;
				$iol3OSC = $iol3OS;
				$iol3PowerOSC = $iol3PowerOS;
				$iol3HolladayOSC = $iol3HolladayOS;
				$iol3srk_tOSC = $iol3srk_tOS;
				$iol3HofferOSC = $iol3HofferOS;
				$iol4OSC = $iol4OS;
				$iol4PowerOSC = $iol4PowerOS;
				$iol4HolladayOSC = $iol4HolladayOS;
				$iol4srk_tOSC = $iol4srk_tOS;
				$iol4HofferOSC = $iol4HofferOS;
				$cellCountOSC = $cellCountOS;
				$notesOSC = $notesOS;
				$pachymetryValOSC = $pachymetryValOS;
				$pachymetryCorrecOSC = $pachymetryCorrecOS;
				$cornealDiamOSC = $cornealDiamOS;
				$dominantEyeOSC = $dominantEyeOS;
				$pupilSize1OSC = $pupilSize1OS;
				$pupilSize2OSC = $pupilSize2OS;
				$acdODC = $acdOD;
				$acdOSC = $acdOS;
				$w2wODC=$w2wOD;
				$w2wOSC=$w2wOS;

				$cataractOSC = $cataractOS;
				$astigmatismOSC = $astigmatismOS;
				$myopiaOSC = $myopiaOS;
				$selecedIOLsOSC = $selecedIOLsOS;
				$notesAssesmentPlansOSC = $notesAssesmentPlansOS;
				$cutsOSC = $cutsOS;
				$lengthOSC = $lengthOS;
				$lengthTypeOSC = $lengthTypeOS;
				$temporalOSC = $temporalOS;
				$signedByIdC = $signedById;
				$signatureC = $signature;
				$signedByOSIdC = $signedByOSId;
				$signatureOSC = $signatureOS;
				$performedIolOSC = $performedIolOS;



            $testPrint.= '
			<table cellpadding="0" cellspacing="0" border="0">
			<tr>
				<td >
				<table style="width:100%;" cellpadding="0" cellspacing="0" border="0">
					<tr>
						<td class="bluehed text_cap paddingTop10">'.strtoupper($temp_name).'</td>
					</tr>
					<tr>
				<td>
					MR&nbsp;&nbsp;&nbsp;S&nbsp;'.$vis_mr_od_s.'&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;'.$vis_mr_od_c.'&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;'.$vis_mr_od_a.'
                    &nbsp;&nbsp;&nbsp;&nbsp;Vision&nbsp;'.$visionOD.'&nbsp;&nbsp;/&nbsp;&nbsp;'.$glareOD.'
				</td>
			</tr>

			<tr>
				<td valign="top" style="width:524px; border:1px solid #000000;">
						<table style="width:auto" cellpadding="0" cellspacing="0" border="0">
						<tr><td colspan="4" style="color:#0000FF;font-size:14px;">
							OD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								Performed By: '.$phyTechArray[$authUserId].'&nbsp;&nbsp;
								Date:'.get_date_format($today,"mm-dd-yyyy").'
						</td></tr>
						<tr>
							<td style="width:49px; height:15px;"></td>
							<td style="width:155px"><strong>'.$autoSelectOD.'</strong></td>
							<td style="width:155px"><strong>'.$iolMasterSelectOD.'</strong></td>
							<td style="width:155px"><strong>'.$topographerSelectOD.'</strong></td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>K1</strong></td>
							<td>'.$vis_ak_od_k.'&nbsp;x&nbsp;'.$vis_ak_od_x.'</td>
							<td>'.$k1IolMaster1OD.'&nbsp;x&nbsp;'.$k1IolMaster2OD.'</td>
							<td>'.$k1Topographer1OD.'&nbsp;x&nbsp;'.$k1Topographer2OD.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>K2</strong></td>';

						if($k2Auto2OD!='') $data1 = $k2Auto2OD; else $data1 = $vis_ak_od_x;
						$testPrint.= '
							<td>'.$vis_ak_od_slash.'&nbsp;x&nbsp;'.$data1.'</td>
							<td>'.$k2IolMaster1OD.'&nbsp;x&nbsp;'.$k2IolMaster2OD.'</td>
							<td>'.$k2Topographer1OD.'&nbsp;x&nbsp;'.$k2Topographer2OD.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>CYL</strong></td>
							<td>'.$cyl1OD.'&nbsp;@&nbsp;'.$cylAuto2OD.'</td>
							<td>'.$cylIolMaster1OD.'&nbsp;@&nbsp;'.$cylIolMaster2OD.'</td>
							<td>'.$cylTopographer1OD.'&nbsp;@&nbsp;'.$cylTopographer2OD.'</td>
						</tr>
						<tr >
							<td style="height:15px;"><strong>AVE</strong></td>
							<td>'.$aveOD1.'</td>
							<td>'.$aveIolMasterOD.'</td>
							<td>'.$aveTopographerOD.'</td>
						</tr>
						<tr><td colspan="4" style="height:3px"></td></tr>
						<tr>
							<td style="height:15px;"><strong>AXIAL</strong></td>
							<td><strong>Contact</strong></td>
							<td><strong>Immersion</strong></td>
							<td><strong>IOL Master</strong></td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>Length</strong></td>
							<td>'.$contactLengthOD.'</td>
							<td>'.$immersionLengthOD.'</td>
							<td>'.$iolMasterLengthOD.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>Notes</strong></td>
							<td style="width:155px;">'.$contactNotesOD.'</td>
							<td style="width:155px;">'.$immersionNotesOD.'</td>
							<td style="width:155px;">'.$iolMasterNotesOD.'</td>
						</tr>
						</table>
				</td></tr>
			<tr>';

				$testPrint.='<tr>

				<td>
					MR&nbsp;&nbsp;&nbsp;S&nbsp;'.$vis_mr_os_s.'&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;'.$vis_mr_os_c.'&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;'.$vis_mr_os_a.'
                    &nbsp;&nbsp;&nbsp;&nbsp;Vision&nbsp;'.$visionOS.'&nbsp;&nbsp;/&nbsp;&nbsp;'.$glareOS.'
				</td>
			</tr>';
				// OS
				$testPrint.='<td style="width:1px;"></td>
							<td valign="top" style="width:524px; border:1px solid #000000;">
						<table style="width:auto;">';

						if(!$dateOS) $data2 = $today; else $data2 = $dateOS;
						if($k1Auto2OS!='') $data3 = $k1Auto2OS; else $data3 = $vis_ak_os_x;
						$testPrint.='
						<tr><td colspan="4" style="color:#0000FF;font-size:14px;">
							OS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								Performed By: '.$phyTechArray[$provider_idOS].'&nbsp;&nbsp;
								Date:'.get_date_format($data2,"mm-dd-yyyy").'
						</td></tr>
						<tr>
							<td style="width:49px;"></td>
							<td style="width:155px"><strong>'.$autoSelectOS.'</strong></td>
							<td style="width:155px"><strong>'.$iolMasterSelectOS.'</strong></td>
							<td style="width:155px"><strong>'.$topographerSelectOS.'</strong></td>
						</tr>
						<tr>
							<td style="height:10px;"><strong>K1</strong></td>
							<td>'.$vis_ak_os_k.'&nbsp;x&nbsp;'.$data3.'</td>
							<td>'.$k1IolMaster1OS.'&nbsp;x&nbsp;'.$k1IolMaster2OS.'</td>
							<td>'.$k1Topographer1OS.'&nbsp;x&nbsp;'.$k1Topographer2OS.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>K2</strong></td>';

						if($k2Auto2OS!='') $data4 = $k2Auto2OS; else $data4 = $vis_ak_os_x;
						$testPrint.= '
							<td>'.$vis_ak_os_slash.'&nbsp;x&nbsp;'.$data4.'</td>
							<td>'.$k2IolMaster1OS.'&nbsp;x&nbsp;'.$k2IolMaster2OS.'</td>
							<td>'.$k2Topographer1OS.'&nbsp;x&nbsp;'.$k2Topographer2OS.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>CYL</strong></td>
							<td>'.$cyl1OS.'&nbsp;@&nbsp;'.$cylAuto2OS.'</td>
							<td>'.$cylIolMaster1OS.'&nbsp;@&nbsp;'.$cylIolMaster2OS.'</td>
							<td>'.$cylTopographer1OS.'&nbsp;@&nbsp;'.$cylTopographer2OS.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>AVE</strong></td>
							<td>'.$aveOS1.'</td>
							<td>'.$aveIolMasterOS.'</td>
							<td>'.$aveTopographerOS.'</td>
						</tr>
						<tr><td colspan="4" style="height:3px"></td></tr>
						<tr>
							<td style="height:15px;"><strong>AXIAL</strong></td>
							<td><strong>Contact</strong></td>
							<td><strong>Immersion</strong></td>
							<td><strong>IOL Master</strong></td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>Length</strong></td>
							<td>'.$contactLengthOS.'</td>
							<td>'.$immersionLengthOS.'</td>
							<td>'.$iolMasterLengthOS.'</td>
						</tr>
						<tr>
							<td style="height:15px;"><strong>Notes</strong></td>
							<td style="width:155px;">'.$contactNotesOS.'</td>
							<td style="width:155px;">'.$immersionNotesOS.'</td>
							<td style="width:155px;">'.$iolMasterNotesOS.'</td>
						</tr>
						</table>';

			$testPrint.='
				</td>
			</tr>';

		$testPrint.='
		</table>
		</td>
	</tr>
	</table>';
/// PARTITION

			// SECOND PART START OD
			$firstCol = "style=\"width:100px; height:15px;\"";
			$width ="style=\"width:104px; text-align:left; height:15px;\"";
			$col2Width = "style=\"width:210px; text-align:left; height:15px;\"";
			$col3Width = "style=\"width:320px; text-align:left; height:15px;\"";
			$col4Width = "style=\"width:430px; text-align:left; height:15px;\"";
			$col5Width = "style=\"width:530px; text-align:left; height:15px;\"";

			if($powerIolOD!='') $data5=$powerIolOD; else $data5="POWER";
			if($holladayOD!='') $data6=$holladayOD; else $data6="Holladay";
			if($srk_tOD!='') $data7=$srk_tOD; else $data7="SRK-T";
			if($hofferOD!='') $data8=$hofferOD; else $data8="HOFFER";
			if($notesOD=='') $data9="Notes..."; else $data9=$notesOD;

			$testPrint.='<table border="0" cellpadding="0" cellspacing="0">
			<tr><td colspan="3" style="height:2px"></td></tr>
			<tr>
				<td valign="top" style="width:525px; border:1px solid #000000;">';

			$testPrint.='
						<table border="0" cellpadding="0" cellspacing="0">
						<tr><td colspan="5" style="color:#0000FF;font-size:14px; width:500px;">
							OD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								Performed By: '.$phyArray[$provider_idOD].'
						</td></tr>
						<tr>
							<td '.$firstCol.'>IOL</td>
							<td '.$width.'><strong>'.$data5.'</strong></td>
							<td '.$width.'><strong>'.$data6.'</strong></td>
							<td '.$width.'><strong>'.$data7.'</strong></td>
							<td '.$width.'><strong>'.$data8.'</strong></td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOD[0].'</strong></td>
							<td '.$width.'>'.$iol1PowerOD.'</td>
							<td '.$width.'>'.$iol1HolladayOD.'</td>
							<td '.$width.'>'.$iol1srk_tOD.'</td>
							<td '.$width.'>'.$iol1HofferOD.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOD[1].'</strong></td>
							<td '.$width.'>'.$iol2PowerOD.'</td>
							<td '.$width.'>'.$iol2HolladayOD.'</td>
							<td '.$width.'>'.$iol2srk_tOD.'</td>
							<td '.$width.'>'.$iol2HofferOD.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOD[2].'</strong></td>
							<td '.$width.'>'.$iol3PowerOD.'</td>
							<td '.$width.'>'.$iol3HolladayOD.'</td>
							<td '.$width.'>'.$iol3srk_tOD.'</td>
							<td '.$width.'>'.$iol3HofferOD.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOD[3].'</strong></td>
							<td '.$width.'>'.$iol4PowerOD.'</td>
							<td '.$width.'>'.$iol4HolladayOD.'</td>
							<td '.$width.'>'.$iol4srk_tOD.'</td>
							<td '.$width.'>'.$iol4HofferOD.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>Cell Count</strong>&nbsp;:&nbsp;'.$cellCountOD.'</td>
							<td '.$width.'><strong>Pachymetry</strong>&nbsp;:&nbsp;'.$pachymetryValOD.'&nbsp;&nbsp;'.$pachymetryCorrecOD.'</td>
							<td '.$width.'><strong>Corneal Diam</strong>&nbsp;:&nbsp;'.$cornealDiamOD.'</td>
							<td '.$width.'><strong>Dominant Eye</strong>&nbsp;:&nbsp;'.$dominantEyeOD.'</td>
							<td '.$width.'><strong>Pupil Size</strong>&nbsp;:&nbsp;'.$pupilSize1OD.'&nbsp;/&nbsp;'.$pupilSize2OD.'<br>&nbsp;&nbsp;Un-Dilated/Dilated</td>
						</tr>
						<tr>
							<td colspan="5"><div '.$col5Width.'>'.$data9.'</div></td>
						</tr>';


						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>CC:</strong>&nbsp;&nbsp;&nbsp;Scheduled for Intraocular lens implant A/Scan reviewed and IOL Selected.</div></td>
						</tr>';

						if($cataractOD==1) $data10='(yes)'; else $data10='(no)';
						if($astigmatismOD==1) $data11='(yes)'; else $data11='(no)';
						if($myopiaOD==1) $data12='(yes)'; else $data12='(no)';

						if($elem_proc_od_1=='checked') $data13='(yes)'; else $data13='(no)';
						if($elem_proc_od_2=='checked') $data14='(yes)'; else $data14='(no)';
						if($elem_proc_od_3=='checked') $data15='(yes)'; else $data15='(no)';

						if($elem_anes_od_1=='checked') $data16='(yes)'; else $data16='(no)';
						if($elem_anes_od_2=='checked') $data17='(yes)'; else $data17='(no)';

						if($elem_visc_od_1=='checked') $data18='(yes)'; else $data18='(no)';
						if($elem_visc_od_2=='checked') $data19='(yes)'; else $data19='(no)';
						if($elem_visc_od_3=='checked') $data20='(yes)'; else $data20='(no)';
						if($elem_visc_od_4=='checked') $data21='(yes)'; else $data21='(no)';


						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Assessment:</strong></td>
							<td '.$width.'>Cataract'.$data10.'</td>
							<td '.$width.'>Astigmatism'.$data11.'</td>
							<td colspan="2"><div '.$col2Width.'>Myopia'.$data12.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Plan:</strong></td>
							<td '.$width.'>'.$PlanOD.'</td>
							<td colspan="3"><div '.$col3Width.'><strong>Date of Surgery:</strong>&nbsp;'.$sur_dateOD.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Procedure:</strong></td>
							<td '.$width.'>Phaco'.$data13.'</td>
							<td '.$width.'>Complex Phaco'.$data14.'</td>
							<td colspan="2"><div '.$col2Width.'>Combined Procedure'.$data15.'</div></td>
						</tr>';

						$testPrint.='
						<tr >
							<td '.$firstCol.'><strong>Anesthesia:</strong></td>
							<td '.$width.'>Local'.$data16.'</td>
							<td colspan="3"><div '.$col3Width.'>Topical'.$data17.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Viscoelastic:</strong></td>
							<td colspan="4"><div '.$col4Width.'>Discovisc'.$data18.'&nbsp;Viscoat'.$data19.'&nbsp;
							Amvisc Plus'.$data20.'&nbsp;Healon'.$data21.'&nbsp;&nbsp;'.$elem_visc_od_other.'
							</div></td>
						</tr>';


						$data22 = ($lriOD==1) ? '(yes)' : '(no)';
						$data23 = ($dlOD==1) ? '(yes)' : '(no)';
						$data24 = ($synechiolysisOD==1) ? '(yes)' : '(no)';
						$data25 = ($irishooksOD==1) ? '(yes)' : '(no)';
						$data26 = ($trypanblueOD==1) ? '(yes)' : '(no)';
						$data27 = ($flomaxOD==1) ? '(yes)' : '(no)';

						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'>LRI'.$data22.'&nbsp;&nbsp;&nbsp;DL'.$data23.'&nbsp;&nbsp;&nbsp;Synechiolysis'.$data24.'&nbsp;&nbsp;&nbsp;IRIS Hooks'.$data25.'&nbsp;&nbsp;&nbsp;Trypan Blue'.$data26.'&nbsp;&nbsp;&nbsp;Pt. On Flomax'.$data27.'</div></td>
						</tr>';

						$data28 = ($elem_opts_od_1=='checked') ? '(yes)' : '(no)';
						$data29 = ($elem_opts_od_2=='checked') ? '(yes)' : '(no)';
						$data30 = ($elem_opts_od_3=='checked') ? '(yes)' : '(no)';
						$data31 = ($elem_opts_od_4=='checked') ? '(yes)' : '(no)';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'>Malyugin ring'.$data28.'&nbsp;&nbsp;&nbsp;Shugarcaine'.$data29.'&nbsp;&nbsp;&nbsp;Capsule tension rings'.$data30.'&nbsp;&nbsp;&nbsp;
							IOL Cutter'.$data31.'&nbsp;&nbsp;&nbsp;'.$elem_opts_od_other.'</div></td>
						</tr>';

						$data32 = ($elem_iol2dn_od_1=='checked') ? '(yes)' : '(no)';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>IOL master to be done on day of surgery:</strong>'.$data32.'</div></td>
						</tr>';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>Notes:</strong>&nbsp;&nbsp;&nbsp;'.$notesAssesmentPlansOD.'</div></td>
						</tr>
						';

						if($lriOD==1){
							$testPrint.='
							<tr>
								<td colspan="5"><div '.$col5Width.'><strong>Cuts:</strong>&nbsp;&nbsp;&nbsp;'.$cutsOD.'&nbsp;&nbsp;&nbsp;&nbsp;
								<b>Length:</b>&nbsp;&nbsp;&nbsp;'.$lengthOD.$lengthTypeOD.'&nbsp;&nbsp;&nbsp;&nbsp;
								<b>Axis:</b>&nbsp;&nbsp;'.$axisOD.'
								</div></td>
							</tr>';

							$data33 = ($superiorOD==1) ? '(yes)' : '(no)';
							$data34 = ($inferiorOD==1) ? '(yes)' : '(no)';
							$data35 = ($nasalOD==1) ? '(yes)' : '(no)';
							$data36 = ($temporalOD==1) ? '(yes)' : '(no)';
							$data37 = ($STOD==1) ? '(yes)' : '(no)';
							$data38 = ($SNOD==1) ? '(yes)' : '(no)';
							$data39 = ($ITOD==1) ? '(yes)' : '(no)';
							$data40 = ($INOD==1) ? '(yes)' : '(no)';
							$testPrint.='
							<tr>
								<td colspan="5"><div '.$col5Width.'>superior'.$data33.'&nbsp;&nbsp;&nbsp;inferior'.$data34.'&nbsp;&nbsp;&nbsp;nasal'.$data35.'&nbsp;&nbsp;&nbsp;temporal'.$data36.'&nbsp;&nbsp;&nbsp;
								ST'.$data37.'&nbsp;&nbsp;&nbsp;SN'.$data38.'&nbsp;&nbsp;&nbsp;IT'.$data39.'&nbsp;&nbsp;&nbsp;IN'.$data40.'
								</div></td>
							</tr>';
						}

						$testPrint.='
						</table>';

				$testPrint.='</td></tr>';

                $data77 = (empty($signedById)) ? $authUserId : $signedById;
                $testPrint.='<tr><td ><b>Physician Name:</b>&nbsp;&nbsp;'.$phyArray[$data77].'</td>
                                </tr>';

				// SECOND PAGE
				// SECOND PART OS
				if($powerIolOS!='') $data41=$powerIolOS; else $data41="POWER";
				if($holladayOS!='') $data42=$holladayOS; else $data42="Holladay";
				if($srk_tOS!='') $data43=$srk_tOS; else $data43="SRK-T";
				if($hofferOS!='') $data44=$hofferOS; else $data44="HOFFER";
				if($notesOS=='') $data45="Notes..."; else $data45=$notesOS;

				$testPrint.='<tr>
						<td valign="top" style="width:525px; border:1px solid #000000;">';
				$testPrint.='
						<table style="width:auto" cellpadding="0" cellspacing="0" border="0">
						<tr><td colspan="5" style="color:#0000FF;font-size:14px; width:500px;">
							OS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								Performed By: '.$phyArray[$performedIolOS].'
						</td></tr>
						<tr>
							<td '.$firstCol.'>IOL</td>
							<td '.$width.'><strong>'.$data41.'</strong></td>
							<td '.$width.'><strong>'.$data42.'</strong></td>
							<td '.$width.'><strong>'.$data43.'</strong></td>
							<td '.$width.'><strong>'.$data44.'</strong></td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOS[0].'</strong></td>
							<td '.$width.'>'.$iol1PowerOS.'</td>
							<td '.$width.'>'.$iol1HolladayOS.'</td>
							<td '.$width.'>'.$iol1srk_tOS.'</td>
							<td '.$width.'>'.$iol1HofferOS.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOS[1].'</strong></td>
							<td '.$width.'>'.$iol2PowerOS.'</td>
							<td '.$width.'>'.$iol2HolladayOS.'</td>
							<td '.$width.'>'.$iol2srk_tOS.'</td>
							<td '.$width.'>'.$iol2HofferOS.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOS[2].'</strong></td>
							<td '.$width.'>'.$iol3PowerOS.'</td>
							<td '.$width.'>'.$iol3HolladayOS.'</td>
							<td '.$width.'>'.$iol3srk_tOS.'</td>
							<td '.$width.'>'.$iol3HofferOS.'</td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>'.$providerLensesArrOS[3].'</strong></td>
							<td '.$width.'>'.$iol4PowerOS.'</td>
							<td '.$width.'>'.$iol4HolladayOS.'</td>
							<td '.$width.'>'.$iol4srk_tOS.'</td>
							<td '.$width.'>'.$iol4HofferOS.'</td>
						</tr>
						<tr >
							<td '.$firstCol.'><strong>Cell Count</strong>&nbsp;:&nbsp;'.$cellCountOS.'</td>
							<td '.$width.'><strong>Pachymetry</strong>&nbsp;:&nbsp;'.$pachymetryValOS.'&nbsp;&nbsp;'.$pachymetryCorrecOS.'</td>
							<td '.$width.'><strong>Corneal Diam</strong>&nbsp;:&nbsp;'.$cornealDiamOS.'</td>
							<td '.$width.'><strong>Dominant Eye</strong>&nbsp;:&nbsp;'.$dominantEyeOS.'</td>
							<td '.$width.'><strong>Pupil Size</strong>&nbsp;:&nbsp;'.$pupilSize1OS.'&nbsp;/&nbsp;'.$pupilSize2OS.'<br>&nbsp;&nbsp;Un-Dilated/Dilated</td>
						</tr>
						<tr>
							<td colspan="5"><div '.$col5Width.'>'.$data45.'</div></td>
						</tr>';


						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>CC:</strong>&nbsp;&nbsp;&nbsp;Scheduled for Intraocular lens implant A/Scan reviewed and IOL Selected.</div></td>
						</tr>';

						if($cataractOS==1) $data46='(yes)'; else $data46='(no)';
						if($astigmatismOS==1) $data47='(yes)'; else $data47='(no)';
						if($myopiaOS==1) $data48='(yes)'; else $data48='(no)';

						if($elem_proc_os_1=='checked') $data49='(yes)'; else $data49='(no)';
						if($elem_proc_os_2=='checked') $data50='(yes)'; else $data50='(no)';
						if($elem_proc_os_3=='checked') $data51='(yes)'; else $data21='(no)';

						if($elem_anes_os_1=='checked') $data52='(yes)'; else $data52='(no)';
						if($elem_anes_os_2=='checked') $data53='(yes)'; else $data53='(no)';

						if($elem_visc_os_1=='checked') $data54='(yes)'; else $data54='(no)';
						if($elem_visc_os_2=='checked') $data55='(yes)'; else $data55='(no)';
						if($elem_visc_os_3=='checked') $data56='(yes)'; else $data56='(no)';
						if($elem_visc_os_4=='checked') $data57='(yes)'; else $data57='(no)';


						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Assessment:</strong></td>
							<td '.$width.'>Cataract'.$data46.'</td>
							<td '.$width.'>Astigmatism'.$data47.'</td>
							<td colspan="2"><div '.$col2Width.'>Myopia'.$data48.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Plan:</strong></td>
							<td '.$width.'>'.$lensesProviderOSArray[$selecedIOLsOS].'</td>
							<td colspan="3"><div '.$col3Width.'><strong>Date of Surgery:</strong>&nbsp;'.$sur_dateOS.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Procedure:</strong></td>
							<td '.$width.'>Phaco'.$data49.'</td>
							<td '.$width.'>Complex Phaco'.$data50.'</td>
							<td colspan="2"><div '.$col2Width.'>Combined Procedure'.$data51.'</div></td>
						</tr>';

						$testPrint.='
						<tr>
							<td '.$firstCol.'><strong>Anesthesia:</strong></td>
							<td '.$width.'>Local'.$data52.'</td>
							<td colspan="3"><div '.$col3Width.'>Topical'.$data53.'</div></td>
						</tr>
						<tr>
							<td '.$firstCol.'><strong>Viscoelastic:</strong></td>
							<td colspan="4"><div '.$col4Width.'>Discovisc'.$data54.'Viscoat'.$data55.'&nbsp;
							Amvisc Plus'.$data56.'&nbsp;Healon'.$data57.'&nbsp;&nbsp;'.$elem_visc_os_other.'</div>
							</td>
						</tr>';

						$data58 = ($lriOS==1) ? '(yes)' : '(no)';
						$data59 = ($dlOS==1) ? '(yes)' : '(no)';
						$data60 = ($synechiolysisOS==1) ? '(yes)' : '(no)';
						$data61 = ($irishooksOS==1) ? '(yes)' : '(no)';
						$data62 = ($trypanblueOS==1) ? '(yes)' : '(no)';
						$data63 = ($flomaxOS==1) ? '(yes)' : '(no)';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'>LRI'.$data58.'&nbsp;&nbsp;&nbsp;DL'.$data59.'&nbsp;&nbsp;&nbsp;Synechiolysis'.$data60.'&nbsp;&nbsp;&nbsp;
							IRIS Hooks'.$data61.'&nbsp;&nbsp;&nbsp;Trypan Blue'.$data62.'&nbsp;&nbsp;&nbsp;Pt. On Flomax'.$data63.'</div></td>
						</tr>';

						$data64 = ($elem_opts_os_1=='checked') ? '(yes)' : '(no)';
						$data65 = ($elem_opts_os_2=='checked') ? '(yes)' : '(no)';
						$data66 = ($elem_opts_os_3=='checked') ? '(yes)' : '(no)';
						$data67 = ($elem_opts_os_4=='checked') ? '(yes)' : '(no)';
						$testPrint.='
						<tr>
							<td colspan="5" ><div '.$col5Width.'>Malyugin ring'.$data64.'&nbsp;&nbsp;&nbsp;Shugarcaine'.$data65.'&nbsp;&nbsp;&nbsp;Capsule tension rings'.$data66.'&nbsp;&nbsp;&nbsp;
							IOL Cutter'.$data67.'&nbsp;&nbsp;&nbsp;'.$elem_opts_os_other.'</div></td>
						</tr>';

						$data68 = ($elem_iol2dn_os_1=='checked') ? '(yes)' : '(no)';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>IOL master to be done on day of surgery:</strong>'.$data68.'</div></td>
						</tr>';
						$testPrint.='
						<tr>
							<td colspan="5"><div '.$col5Width.'><strong>Notes:</strong>&nbsp;&nbsp;&nbsp;'.$notesAssesmentPlansOS.'</div></td>
						</tr>
						';

						if($lriOS==1){
							$testPrint.='
							<tr>
								<td colspan="5"><div '.$col5Width.'><strong>Cuts:</strong>&nbsp;&nbsp;&nbsp;'.$cutsOS.'&nbsp;&nbsp;&nbsp;&nbsp;
								<b>Length:</b>&nbsp;&nbsp;&nbsp;'.$lengthOS.$lengthTypeOS.'&nbsp;&nbsp;&nbsp;&nbsp;
								<b>Axis:</b>&nbsp;&nbsp;'.$axisOS.'
								</div></td>
							</tr>';

							$data69 = ($superiorOS==1) ? '(yes)' : '(no)';
							$data70 = ($inferiorOS==1) ? '(yes)' : '(no)';
							$data71 = ($nasalOS==1) ? '(yes)' : '(no)';
							$data72 = ($temporalOS==1) ? '(yes)' : '(no)';
							$data73 = ($STOS==1) ? '(yes)' : '(no)';
							$data74 = ($SNOS==1) ? '(yes)' : '(no)';
							$data75 = ($ITOS==1) ? '(yes)' : '(no)';
							$data76 = ($INOS==1) ? '(yes)' : '(no)';
							$testPrint.='
							<tr>
								<td colspan="5"><div '.$col5Width.'>superior'.$data69.'&nbsp;&nbsp;&nbsp;inferior'.$data70.'&nbsp;&nbsp;&nbsp;nasal'.$data71.'&nbsp;&nbsp;&nbsp;temporal'.$data72.'&nbsp;&nbsp;&nbsp;
								ST'.$data73.'&nbsp;&nbsp;&nbsp;SN'.$data74.'&nbsp;&nbsp;&nbsp;IT'.$data75.'&nbsp;&nbsp;&nbsp;IN'.$data76.'
								</div></td>
							</tr>';
						}
						$testPrint.='
						</table>';
				$testPrint.='</td></tr>';
			// END SECOND PART OS

			$data78 = (empty($signedByOSId)) ? $authUserId : $signedByOSId;
			$testPrint.='<tr><td ><b>Physician Name:</b>&nbsp;&nbsp;'.$phyArray[$data78].'</td>
			</tr>'.$sign_path_print;

            $testPrint.='<tr>
						<td colspan="2" style="height:10px">';

								///Add TestLabs Images//
								$imagesHtml = $this->getTestImages($test_id,$sectionImageFrom="IOL_Master",$patient_id);
								if($imagesHtml!=""){
									$testPrint.='<table >'.$imagesHtml.' </table>';
								}
								$imagesHtml="";
								//End TestLabs Images


						$testPrint.='</td>
					</tr></table>';


                //end of while
            }

		   echo $testPrint;

        }
    }
	//==========FUNCTION TO GET DATA OF MED HX => OCULAR => SPECIALTY QUESTIONS==========
	public function print_specialty_question($pid="")
	{
		if($pid)
		{
			$query ="SELECT
						am.ques AS question, am.id AS question_id, amt.tab_name,
					CASE
						WHEN psqa.ans_type =0
						THEN psqa.pat_answer
						WHEN psqa.ans_type =1
						THEN mhqao.option_value
					END AS answer
						FROM `admn_medhx` am
					INNER JOIN
						`admn_medhx_tab` amt ON am.id = amt.admn_medhx_question_id
					INNER JOIN
						`patient_specialty_question_answer` psqa ON am.id = psqa.question_id
					LEFT JOIN
						`patient_specialty_question_options_answer` psqoa ON psqa.id = psqoa.patient_specialty_question_answer_id AND psqoa.state = 1
					AND
						psqoa.question_id = am.id
					LEFT JOIN
						`med_hx_question_answer_options` mhqao ON mhqao.id = psqoa.option_id
					WHERE psqa.patient_id = $pid
					";
			$sql = imw_query($query);
			if(imw_num_rows($sql))
			{
				while($rowPrtSplQue = imw_fetch_assoc($sql))
				{
					$arrPrtSplQues = array();
					$arrPrtSplQues['question_id']	= $rowPrtSplQue['question_id'];	//QUESTION ID
					$arrPrtSplQues['question']	    = $rowPrtSplQue['question'];       //QUESTION
					$arrPrtSplQues['tab_name']		= $rowPrtSplQue['tab_name'];    //TAB NAME i.e. OCULAR
					$arrPrtSplQues['answer'] 		= $rowPrtSplQue['answer'];     //ANSWER

					$return[] =  $arrPrtSplQues;
				}
			}
		}
		return $return;
	}

} //MAIN CLASS END
?>