/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if(f=d.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&!function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise();var L;for(L in n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c,e;c=d.getElementsByTagName("body")[0],c&&c.style&&(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))}),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0;
}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,e;return c=d.getElementsByTagName("body")[0],c&&c.style?(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)Y(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=d.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;function ea(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if(g=a[r],g||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];while(f--)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody){g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;while(f--)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k)}n.merge(q,i.childNodes),i.textContent="";while(i.firstChild)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;while(g=q[r++])if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c){f=0;while(g=i[f++])_.test(g.type||"")&&c.push(g)}return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=e.attributes[c].expando===!1);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=qa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return"undefined"==typeof n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(G)||[""],h=b.length;while(h--)f=oa.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=oa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||l.trigger.apply(e,c)!==!1)){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}o=0;while((i=p[o++])&&!b.isPropagationStopped())b.type=o>1?j:l.bindType||q,g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"),g&&g.apply(i,c),g=h&&i[h],g&&g.apply&&M(i)&&(b.result=g.apply(i,c),b.result===!1&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),c)===!1)&&M(e)&&h&&e[q]&&!n.isWindow(e)){m=e[h],m&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(e=a.target.ownerDocument||d,f=e.documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submit||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),n._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),n.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)}),n._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=qa),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Aa=ca(d),Ba=Aa.appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)});if(o&&(k=ja(b,a[0].ownerDocument,!1,a,d),e=k.firstChild,1===k.childNodes.length&&(k=e),e||d)){for(i=n.map(ea(k,"script"),Da),h=i.length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return d=ea(f,"script"),d.length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||"undefined"==typeof d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))},null,a,arguments.length)},append:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.appendChild(a)}})},prepend:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(ea(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return Y(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}});var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||(c=La(a,b),"none"!==c&&c||(Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ja[0].contentWindow||Ja[0].contentDocument).document,b.write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,i=d.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}});function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,k=j.appendChild(d.createElement("div")),k.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",j.childNodes[0].style.borderCollapse="separate",k=j.getElementsByTagName("td"),k[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===k[0].offsetHeight,f&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;while(c--)if(a=_a[c]+b,a in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g=l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Oa.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+eb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,function(){return fb(a,b,d)}):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(a,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0}),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{
marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)}),n.fn.extend({css:function(a,b){return Y(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){W(this)?n(this).show():n(this).hide()})}});function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout(function(){hb=void 0}),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=V[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ob(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k="none"===j?n._data(a,"olddisplay")||Ma(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function pb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(pb(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[ob],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}}),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));c=d.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,b=d.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return b===!1?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,Cb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,Cb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=Cb(this),b&&n._data(this,"__className__",b),n.attr(this,"class",b||a===!1?"":n._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Kb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Wb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Xb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:Kb.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k){k={};while(b=Jb.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;i=n.event&&l.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,w,l)===!1||2===u))return w.abort();v="abort";for(e in{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout(function(){w.abort("timeout")},l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=Wb(l,w,d)),v=Xb(l,v,w,k),k?(l.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(n.lastModified[f]=x),x=w.getResponseHeader("etag"),x&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,t=v.error,k=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}});function Yb(a){return a.style&&a.style.display||n.css(a,"display")}function Zb(a){if(!n.contains(a.ownerDocument||d,a))return!0;while(a&&1===a.nodeType){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Zb(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(ac,"\r\n")}}):{name:b.name,value:c.replace(ac,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in fc)fc[a](void 0,!0)}),l.cors=!!gc&&"withCredentials"in gc,gc=l.ajax=!!gc,gc&&n.ajaxTransport(function(b){if(!b.crossDomain||l.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}});function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){b=d.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function mc(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Qa})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({
padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Y(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n});
/*! jQuery UI - v1.11.4 - 2015-08-16
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, menu.js, progressbar.js, selectmenu.js, slider.js, spinner.js, tabs.js, tooltip.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=u.call(arguments,1),r=this;return a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):(o.length&&(n=e.widget.extend.apply(null,[n].concat(o))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))})),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var d=!1;e(document).mouseup(function(){d=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),d=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?M.left-=d:"center"===n.my[0]&&(M.left-=d/2),"bottom"===n.my[1]?M.top-=c:"center"===n.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(M,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}
},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},a=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;
this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)),void 0)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1]}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))
},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&&i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.css("box-sizing"),l=e.length&&(!t.length||e.index()<t.index()),u=this.options.animate||{},d=l&&u.down||u,c=function(){o._toggleComplete(i)};return"number"==typeof d&&(a=d),"string"==typeof d&&(n=d),n=n||d.easing||u.easing,a=a||d.duration||u.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:c,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==o.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0)}}),void 0):t.animate(this.hideProps,a,n,c):e.animate(this.showProps,a,n,c)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var c,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",m=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},g=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,m),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===c&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];g(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),c=this,t.document.one("mouseup",function(){c=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?g(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "))}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}});var v;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this
},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),v===n&&(v=null))},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k()}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?"":s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,H,z,F,E,O,j,W,L=new Date,R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),J=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),K=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),U=this._get(e,"stepMonths"),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-V,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;K[0]>w;w++){for(k="",this.maxRows=4,T=0;K[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",M="",Q){if(M+="<div class='ui-datepicker-group",K[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case K[1]-1:M+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",S=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,X,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",C=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+u)%7,C+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[N]+"'>"+p[N]+"</span></th>";for(M+=C+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),H=Q?this.maxRows>I?this.maxRows:I:I,this.maxRows=H,z=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;H>F;F++){for(M+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",x=0;7>x;x++)O=g?g.apply(e.input?e.input[0]:null,[z]):[!0,""],j=z.getMonth()!==Z,W=j&&!y||!O[0]||X&&X>z||$&&z>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(z.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===z.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+O[1]+(z.getTime()===G.getTime()?" "+this._currentClass:"")+(z.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===R.getTime()?" ui-state-highlight":"")+(z.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);M+=E+"</tr>"}Z++,Z>11&&(Z=0,et++),M+="</tbody></table>"+(Q?"</div>"+(K[0]>0&&T===K[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=M}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>"}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;
return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a))}}).css("position",a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,a){a.optgroup!==n&&(e("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(a.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0),s.length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&&(this.range=e.getRangeAt(0))):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:a.attr("label")||"",disabled:a.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()
},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:h(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:h(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:h(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:h(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return t.hash.length>1&&i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===s?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr("id"),h=e(s).closest("li"),l=h.attr("aria-controls");t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":o,"aria-labelledby":r}),a.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest("li"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger("activate",t,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&r.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;i!==!1&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),r={tab:n,panel:o},h=function(e,t){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){o.html(e),s._trigger("load",i,r),h(n,t)},1)}).fail(function(e,t){setTimeout(function(){h(e,t)},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=a),this._open(t,e,i))})}),i&&this._open(t,e,i),void 0)},_open:function(t,i,s){function n(e){l.of=e,o.is(":hidden")||o.position(l)}var a,o,r,h,l=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(h=s.clone(),h.removeAttr("id").find("[id]").removeAttr("id")):h=s,e("<div>").html(h).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(l.of),clearInterval(r))},e.fx.interval)),this._trigger("open",t,{tooltip:o})}},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s)},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);return a?(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),a.closing=!0,this._trigger("close",t,{tooltip:i}),a.hiding||(a.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e("#"+i).remove(),a.data("ui-tooltip-title")&&(a.attr("title")||a.attr("title",a.data("ui-tooltip-title")),a.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}});var y="ui-effects-",b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(b.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(y+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(y+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;
return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n()}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})}});/* build: `node build.js modules=ALL exclude=gestures,json minifier=uglifyjs` *//*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var fabric=fabric||{version:"1.5.0"};typeof exports!="undefined"&&(exports.fabric=fabric),typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||
  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0),fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function e(e,t){if(!this.__eventListeners[e])return;t?fabric.util.removeFromArray(this.__eventListeners[e],t):this.__eventListeners[e].length=0}function t(e,t){this.__eventListeners||(this.__eventListeners={});if(arguments.length===1)for(var n in e)this.on(n,e[n]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function n(t,n){if(!this.__eventListeners)return;if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)e.call(this,r,t[r]);else e.call(this,t,n);return this}function r(e,t){if(!this.__eventListeners)return;var n=this.__eventListeners[e];if(!n)return;for(var r=0,i=n.length;r<i;r++)n[r].call(this,t||{});return this}fabric.Observable={observe:t,stopObserving:n,fire:r,on:t,off:n,trigger:r}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(e,t,n){var r=this.getObjects();return n?r[t]=e:r.splice(t,0,e),this._onObjectAdded(e),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){var e=this.getObjects(),t;for(var n=0,r=arguments.length;n<r;n++)t=e.indexOf(arguments[n]),t!==-1&&(e.splice(t,1),this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(e,t){var n=this.getObjects(),r=n.length;while(r--)e.call(t,n[r],r,n);return this},getObjects:function(e){return typeof e=="undefined"?this._objects:this._objects.filter(function(t){return t.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(e){return this.getObjects().indexOf(e)>-1},complexity:function(){return this.getObjects().reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}},function(e){var t=Math.sqrt,n=Math.atan2,r=Math.PI/180;fabric.util={removeFromArray:function(e,t){var n=e.indexOf(t);return n!==-1&&e.splice(n,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*r},radiansToDegrees:function(e){return e/r},rotatePoint:function(e,t,n){var r=Math.sin(n),i=Math.cos(n);e.subtractEquals(t);var s=e.x*i-e.y*r,o=e.x*r+e.y*i;return(new fabric.Point(s,o)).addEquals(t)},transformPoint:function(e,t,n){return n?new fabric.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new fabric.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},invertTransform:function(e){var t=e.slice(),n=1/(e[0]*e[3]-e[1]*e[2]);t=[n*e[3],-n*e[1],-n*e[2],n*e[0],0,0];var r=fabric.util.transformPoint({x:e[4],y:e[5]},t);return t[4]=-r.x,t[5]=-r.y,t},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var n=/\D{0,2}$/.exec(e),r=parseFloat(e);t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(n[0]){case"mm":return r*fabric.DPI/25.4;case"cm":return r*fabric.DPI/2.54;case"in":return r*fabric.DPI;case"pt":return r*fabric.DPI/72;case"pc":return r*fabric.DPI/72*12;case"em":return r*t;default:return r}},falseFunction:function(){return!1},getKlass:function(e,t){return e=fabric.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),fabric.util.resolveNamespace(t)[e]},resolveNamespace:function(t){if(!t)return fabric;var n=t.split("."),r=n.length,i=e||fabric.window;for(var s=0;s<r;++s)i=i[n[s]];return i},loadImage:function(e,t,n,r){if(!e){t&&t.call(n,e);return}var i=fabric.util.createImage();i.onload=function(){t&&t.call(n,i),i=i.onload=i.onerror=null},i.onerror=function(){fabric.log("Error loading "+i.src),t&&t.call(n,null,!0),i=i.onload=i.onerror=null},e.indexOf("data")!==0&&typeof r!="undefined"&&(i.crossOrigin=r),i.src=e},enlivenObjects:function(e,t,n,r){function i(){++o===u&&t&&t(s)}e=e||[];var s=[],o=0,u=e.length;if(!u){t&&t(s);return}e.forEach(function(e,t){if(!e||!e.type){i();return}var o=fabric.util.getKlass(e.type,n);o.async?o.fromObject(e,function(n,o){o||(s[t]=n,r&&r(e,s[t])),i()}):(s[t]=o.fromObject(e),r&&r(e,s[t]),i())})},groupSVGElements:function(e,t,n){var r;return r=new fabric.PathGroup(e,t),typeof n!="undefined"&&r.setSourcePath(n),r},populateWithProperties:function(e,t,n){if(n&&Object.prototype.toString.call(n)==="[object Array]")for(var r=0,i=n.length;r<i;r++)n[r]in e&&(t[n[r]]=e[n[r]])},drawDashedLine:function(e,r,i,s,o,u){var a=s-r,f=o-i,l=t(a*a+f*f),c=n(f,a),h=u.length,p=0,d=!0;e.save(),e.translate(r,i),e.moveTo(0,0),e.rotate(c),r=0;while(l>r)r+=u[p++%h],r>l&&(r=l),e[d?"lineTo":"moveTo"](r,0),d=!d;e.restore()},createCanvasElement:function(e){return e||(e=fabric.document.createElement("canvas")),!e.getContext&&typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(e),e},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(e){var t=e.prototype;for(var n=t.stateProperties.length;n--;){var r=t.stateProperties[n],i=r.charAt(0).toUpperCase()+r.slice(1),s="set"+i,o="get"+i;t[o]||(t[o]=function(e){return new Function('return this.get("'+e+'")')}(r)),t[s]||(t[s]=function(e){return new Function("value",'return this.set("'+e+'", value)')}(r))}},clipContext:function(e,t){t.save(),t.beginPath(),e.clipTo(t),t.clip()},multiplyTransformMatrices:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(e,t,n,r){r>0&&(t>r?t-=r:t=0,n>r?n-=r:n=0);var i=!0,s=e.getImageData(t,n,r*2||1,r*2||1);for(var o=3,u=s.data.length;o<u;o+=4){var a=s.data[o];i=a<=0;if(i===!1)break}return s=null,i}}}(typeof exports!="undefined"?exports:this),function(){function i(t,n,i,u,a,f,l){var c=r.call(arguments);if(e[c])return e[c];var h=Math.PI,p=l*h/180,d=Math.sin(p),v=Math.cos(p),m=0,g=0;i=Math.abs(i),u=Math.abs(u);var y=-v*t*.5-d*n*.5,b=-v*n*.5+d*t*.5,w=i*i,E=u*u,S=b*b,x=y*y,T=w*E-w*S-E*x,N=0;if(T<0){var C=Math.sqrt(1-T/(w*E));i*=C,u*=C}else N=(a===f?-1:1)*Math.sqrt(T/(w*S+E*x));var k=N*i*b/u,L=-N*u*y/i,A=v*k-d*L+t*.5,O=d*k+v*L+n*.5,M=o(1,0,(y-k)/i,(b-L)/u),_=o((y-k)/i,(b-L)/u,(-y-k)/i,(-b-L)/u);f===0&&_>0?_-=2*h:f===1&&_<0&&(_+=2*h);var D=Math.ceil(Math.abs(_/h*2)),P=[],H=_/D,B=8/3*Math.sin(H/4)*Math.sin(H/4)/Math.sin(H/2),j=M+H;for(var F=0;F<D;F++)P[F]=s(M,j,v,d,i,u,A,O,B,m,g),m=P[F][4],g=P[F][5],M=j,j+=H;return e[c]=P,P}function s(e,n,i,s,o,u,a,f,l,c,h){var p=r.call(arguments);if(t[p])return t[p];var d=Math.cos(e),v=Math.sin(e),m=Math.cos(n),g=Math.sin(n),y=i*o*m-s*u*g+a,b=s*o*m+i*u*g+f,w=c+l*(-i*o*v-s*u*d),E=h+l*(-s*o*v+i*u*d),S=y+l*(i*o*g+s*u*m),x=b+l*(s*o*g-i*u*m);return t[p]=[w,E,S,x,y,b],t[p]}function o(e,t,n,r){var i=Math.atan2(t,e),s=Math.atan2(r,n);return s>=i?s-i:2*Math.PI-(i-s)}function u(e,t,i,s,o,u,a,f){var l=r.call(arguments);if(n[l])return n[l];var c=Math.sqrt,h=Math.min,p=Math.max,d=Math.abs,v=[],m=[[],[]],g,y,b,w,E,S,x,T;y=6*e-12*i+6*o,g=-3*e+9*i-9*o+3*a,b=3*i-3*e;for(var N=0;N<2;++N){N>0&&(y=6*t-12*s+6*u,g=-3*t+9*s-9*u+3*f,b=3*s-3*t);if(d(g)<1e-12){if(d(y)<1e-12)continue;w=-b/y,0<w&&w<1&&v.push(w);continue}x=y*y-4*b*g;if(x<0)continue;T=c(x),E=(-y+T)/(2*g),0<E&&E<1&&v.push(E),S=(-y-T)/(2*g),0<S&&S<1&&v.push(S)}var C,k,L=v.length,A=L,O;while(L--)w=v[L],O=1-w,C=O*O*O*e+3*O*O*w*i+3*O*w*w*o+w*w*w*a,m[0][L]=C,k=O*O*O*t+3*O*O*w*s+3*O*w*w*u+w*w*w*f,m[1][L]=k;m[0][A]=e,m[1][A]=t,m[0][A+1]=a,m[1][A+1]=f;var M=[{x:h.apply(null,m[0]),y:h.apply(null,m[1])},{x:p.apply(null,m[0]),y:p.apply(null,m[1])}];return n[l]=M,M}var e={},t={},n={},r=Array.prototype.join;fabric.util.drawArc=function(e,t,n,r){var s=r[0],o=r[1],u=r[2],a=r[3],f=r[4],l=r[5],c=r[6],h=[[],[],[],[]],p=i(l-t,c-n,s,o,a,f,u);for(var d=0,v=p.length;d<v;d++)h[d][0]=p[d][0]+t,h[d][1]=p[d][1]+n,h[d][2]=p[d][2]+t,h[d][3]=p[d][3]+n,h[d][4]=p[d][4]+t,h[d][5]=p[d][5]+n,e.bezierCurveTo.apply(e,h[d])},fabric.util.getBoundsOfArc=function(e,t,n,r,s,o,a,f,l){var c=0,h=0,p=[],d=[],v=i(f-e,l-t,n,r,o,a,s),m=[[],[]];for(var g=0,y=v.length;g<y;g++)p=u(c,h,v[g][0],v[g][1],v[g][2],v[g][3],v[g][4],v[g][5]),m[0].x=p[0].x+e,m[0].y=p[0].y+t,m[1].x=p[1].x+e,m[1].y=p[1].y+t,d.push(m[0]),d.push(m[1]),c=v[g][4],h=v[g][5];return d},fabric.util.getBoundsOfCurve=u}(),function(){function t(t,n){var r=e.call(arguments,2),i=[];for(var s=0,o=t.length;s<o;s++)i[s]=r.length?t[s][n].apply(t[s],r):t[s][n].call(t[s]);return i}function n(e,t){return i(e,t,function(e,t){return e>=t})}function r(e,t){return i(e,t,function(e,t){return e<t})}function i(e,t,n){if(!e||e.length===0)return;var r=e.length-1,i=t?e[r][t]:e[r];if(t)while(r--)n(e[r][t],i)&&(i=e[r][t]);else while(r--)n(e[r],i)&&(i=e[r]);return i}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Number.POSITIVE_INFINITY&&r!==Number.NEGATIVE_INFINITY&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)n in this&&e.call(t,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(e,t){var n=[];for(var r=0,i=this.length>>>0;r<i;r++)r in this&&(n[r]=e.call(t,this[r],r,this));return n}),Array.prototype.every||(Array.prototype.every=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)if(n in this&&!e.call(t,this[n],n,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)if(n in this&&e.call(t,this[n],n,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(e,t){var n=[],r;for(var i=0,s=this.length>>>0;i<s;i++)i in this&&(r=this[i],e.call(t,r,i,this)&&n.push(r));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=this.length>>>0,n=0,r;if(arguments.length>1)r=arguments[1];else do{if(n in this){r=this[n++];break}if(++n>=t)throw new TypeError}while(!0);for(;n<t;n++)n in this&&(r=e.call(null,r,this[n],n,this));return r}),fabric.util.array={invoke:t,min:r,max:n}}(),function(){function e(e,t){for(var n in t)e[n]=t[n];return e}function t(t){return e({},t)}fabric.util.object={extend:e,clone:t}}(),function(){function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())}function n(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:e,capitalize:t,escapeXml:n}}(),function(){var e=Array.prototype.slice,t=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var i=this,s=e.call(arguments,1),o;return s.length?o=function(){return t.call(i,this instanceof n?this:r,s.concat(e.call(arguments)))}:o=function(){return t.call(i,this instanceof n?this:r,arguments)},n.prototype=this.prototype,o.prototype=new n,o})}(),function(){function i(){}function s(t){var n=this.constructor.superclass.prototype[t];return arguments.length>1?n.apply(this,e.call(arguments,1)):n.call(this)}function o(){function u(){this.initialize.apply(this,arguments)}var n=null,o=e.call(arguments,0);typeof o[0]=="function"&&(n=o.shift()),u.superclass=n,u.subclasses=[],n&&(i.prototype=n.prototype,u.prototype=new i,n.subclasses.push(u));for(var a=0,f=o.length;a<f;a++)r(u,o[a],n);return u.prototype.initialize||(u.prototype.initialize=t),u.prototype.constructor=u,u.prototype.callSuper=s,u}var e=Array.prototype.slice,t=function(){},n=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}(),r=function(e,t,r){for(var i in t)i in e.prototype&&typeof e.prototype[i]=="function"&&(t[i]+"").indexOf("callSuper")>-1?e.prototype[i]=function(e){return function(){var n=this.constructor.superclass;this.constructor.superclass=r;var i=t[e].apply(this,arguments);this.constructor.superclass=n;if(e!=="initialize")return i}}(i):e.prototype[i]=t[i],n&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};fabric.util.createClass=o}(),function(){function t(e){var t=Array.prototype.slice.call(arguments,1),n,r,i=t.length;for(r=0;r<i;r++){n=typeof e[t[r]];if(!/^(?:function|object|unknown)$/.test(n))return!1}return!0}function s(e,t){return{handler:t,wrappedHandler:o(e,t)}}function o(e,t){return function(r){t.call(n(e),r||fabric.window.event)}}function u(e,t){return function(n){if(c[e]&&c[e][t]){var r=c[e][t];for(var i=0,s=r.length;i<s;i++)r[i].call(this,n||fabric.window.event)}}}function d(t,n){t||(t=fabric.window.event);var r=t.target||(typeof t.srcElement!==e?t.srcElement:null),i=fabric.util.getScrollLeftTop(r,n);return{x:v(t)+i.left,y:m(t)+i.top}}function g(e,t,n){var r=e.type==="touchend"?"changedTouches":"touches";return e[r]&&e[r][0]?e[r][0][t]-(e[r][0][t]-e[r][0][n])||e[n]:e[n]}var e="unknown",n,r,i=function(){var e=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)}}();(function(){var e={};n=function(t){return e[t]},r=function(t,n){e[t]=n}})();var a=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),l={},c={},h,p;a?(h=function(e,t,n){e.addEventListener(t,n,!1)},p=function(e,t,n){e.removeEventListener(t,n,!1)}):f?(h=function(e,t,n){var o=i(e);r(o,e),l[o]||(l[o]={}),l[o][t]||(l[o][t]=[]);var u=s(o,n);l[o][t].push(u),e.attachEvent("on"+t,u.wrappedHandler)},p=function(e,t,n){var r=i(e),s;if(l[r]&&l[r][t])for(var o=0,u=l[r][t].length;o<u;o++)s=l[r][t][o],s&&s.handler===n&&(e.detachEvent("on"+t,s.wrappedHandler),l[r][t][o]=null)}):(h=function(e,t,n){var r=i(e);c[r]||(c[r]={});if(!c[r][t]){c[r][t]=[];var s=e["on"+t];s&&c[r][t].push(s),e["on"+t]=u(r,t)}c[r][t].push(n)},p=function(e,t,n){var r=i(e);if(c[r]&&c[r][t]){var s=c[r][t];for(var o=0,u=s.length;o<u;o++)s[o]===n&&s.splice(o,1)}}),fabric.util.addListener=h,fabric.util.removeListener=p;var v=function(t){return typeof t.clientX!==e?t.clientX:0},m=function(t){return typeof t.clientY!==e?t.clientY:0};fabric.isTouchSupported&&(v=function(e){return g(e,"pageX","clientX")},m=function(e){return g(e,"pageY","clientY")}),fabric.util.getPointer=d,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(e,t){var n=e.style;if(!n)return e;if(typeof t=="string")return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?s(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var r in t)if(r==="opacity")s(e,t[r]);else{var i=r==="float"||r==="cssFloat"?typeof n.styleFloat=="undefined"?"cssFloat":"styleFloat":r;n[i]=t[r]}return e}var t=fabric.document.createElement("div"),n=typeof t.style.opacity=="string",r=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(e){return e};n?s=function(e,t){return e.style.opacity=t,e}:r&&(s=function(e,t){var n=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(n.zoom=1),i.test(n.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",n.filter=n.filter.replace(i,t)):n.filter+=" alpha(opacity="+t*100+")",e}),fabric.util.setStyle=e}(),function(){function t(e){return typeof e=="string"?fabric.document.getElementById(e):e}function s(e,t){var n=fabric.document.createElement(e);for(var r in t)r==="class"?n.className=t[r]:r==="for"?n.htmlFor=t[r]:n.setAttribute(r,t[r]);return n}function o(e,t){e&&(" "+e.className+" ").indexOf(" "+t+" ")===-1&&(e.className+=(e.className?" ":"")+t)}function u(e,t,n){return typeof t=="string"&&(t=s(t,n)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t}function a(e,t){var n,r,i=0,s=0,o=fabric.document.documentElement,u=fabric.document.body||{scrollLeft:0,scrollTop:0};r=e;while(e&&e.parentNode&&!n)e=e.parentNode,e.nodeType===1&&fabric.util.getElementStyle(e,"position")==="fixed"&&(n=e),e.nodeType===1&&r!==t&&fabric.util.getElementStyle(e,"position")==="absolute"?(i=0,s=0):e===fabric.document?(i=u.scrollLeft||o.scrollLeft||0,s=u.scrollTop||o.scrollTop||0):(i+=e.scrollLeft||0,s+=e.scrollTop||0);return{left:i,top:s}}function f(e){var t,n=e&&e.ownerDocument,r={left:0,top:0},i={left:0,top:0},s,o={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return{left:0,top:0};for(var u in o)i[o[u]]+=parseInt(l(e,u),10)||0;return t=n.documentElement,typeof e.getBoundingClientRect!="undefined"&&(r=e.getBoundingClientRect()),s=fabric.util.getScrollLeftTop(e,null),{left:r.left+s.left-(t.clientLeft||0)+i.left,top:r.top+s.top-(t.clientTop||0)+i.top}}var e=Array.prototype.slice,n,r=function(t){return e.call(t,0)};try{n=r(fabric.document.childNodes)instanceof Array}catch(i){}n||(r=function(e){var t=new Array(e.length),n=e.length;while(n--)t[n]=e[n];return t});var l;fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?l=function(e,t){var n=fabric.document.defaultView.getComputedStyle(e,null);return n?n[t]:undefined}:l=function(e,t){var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),n},function(){function n(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=fabric.util.falseFunction),t?e.style[t]="none":typeof e.unselectable=="string"&&(e.unselectable="on"),e}function r(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=null),t?e.style[t]="":typeof e.unselectable=="string"&&(e.unselectable=""),e}var e=fabric.document.documentElement.style,t="userSelect"in e?"userSelect":"MozUserSelect"in e?"MozUserSelect":"WebkitUserSelect"in e?"WebkitUserSelect":"KhtmlUserSelect"in e?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=n,fabric.util.makeElementSelectable=r}(),function(){function e(e,t){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),i=!0;r.onload=r.onreadystatechange=function(e){if(i){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;i=!1,t(e||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=e,n.appendChild(r)}fabric.util.getScript=e}(),fabric.util.getById=t,fabric.util.toArray=r,fabric.util.makeElement=s,fabric.util.addClass=o,fabric.util.wrapElement=u,fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=f,fabric.util.getElementStyle=l}(),function(){function e(e,t){return e+(/\?/.test(e)?"&":"?")+t}function n(){}function r(r,i){i||(i={});var s=i.method?i.method.toUpperCase():"GET",o=i.onComplete||function(){},u=t(),a;return u.onreadystatechange=function(){u.readyState===4&&(o(u),u.onreadystatechange=n)},s==="GET"&&(a=null,typeof i.parameters=="string"&&(r=e(r,i.parameters))),u.open(s,r,!0),(s==="POST"||s==="PUT")&&u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(a),u}var t=function(){var e=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}];for(var t=e.length;t--;)try{var n=e[t]();if(n)return e[t]}catch(r){}}();fabric.util.request=r}(),fabric.log=function(){},fabric.warn=function(){},typeof console!="undefined"&&["log","warn"].forEach(function(e){typeof console[e]!="undefined"&&typeof console[e].apply=="function"&&(fabric[e]=function(){return console[e].apply(console,arguments)})}),function(){function e(e){n(function(t){e||(e={});var r=t||+(new Date),i=e.duration||500,s=r+i,o,u=e.onChange||function(){},a=e.abort||function(){return!1},f=e.easing||function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},l="startValue"in e?e.startValue:0,c="endValue"in e?e.endValue:100,h=e.byValue||c-l;e.onStart&&e.onStart(),function p(t){o=t||+(new Date);var c=o>s?i:o-r;if(a()){e.onComplete&&e.onComplete();return}u(f(c,l,h,i));if(o>s){e.onComplete&&e.onComplete();return}n(p)}(r)})}function n(){return t.apply(fabric.window,arguments)}var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){fabric.window.setTimeout(e,1e3/60)};fabric.util.animate=e,fabric.util.requestAnimFrame=n}(),function(){function e(e,t,n,r){return e<Math.abs(t)?(e=t,r=n/4):r=n/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:n,s:r}}function t(e,t,n){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*n-e.s)*2*Math.PI/e.p)}function n(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}function r(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}function i(e,t,n,r){return n*(e/=r)*e*e*e+t}function s(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t}function o(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}function u(e,t,n,r){return n*(e/=r)*e*e*e*e+t}function a(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t}function f(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}function l(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t}function c(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t}function h(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t}function p(e,t,n,r){return e===0?t:n*Math.pow(2,10*(e/r-1))+t}function d(e,t,n,r){return e===r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t}function v(e,t,n,r){return e===0?t:e===r?t+n:(e/=r/2,e<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t)}function m(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t}function g(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t}function y(e,t,n,r){return e/=r/2,e<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function b(n,r,i,s){var o=1.70158,u=0,a=i;if(n===0)return r;n/=s;if(n===1)return r+i;u||(u=s*.3);var f=e(a,i,u,o);return-t(f,n,s)+r}function w(t,n,r,i){var s=1.70158,o=0,u=r;if(t===0)return n;t/=i;if(t===1)return n+r;o||(o=i*.3);var a=e(u,r,o,s);return a.a*Math.pow(2,-10*t)*Math.sin((t*i-a.s)*2*Math.PI/a.p)+a.c+n}function E(n,r,i,s){var o=1.70158,u=0,a=i;if(n===0)return r;n/=s/2;if(n===2)return r+i;u||(u=s*.3*1.5);var f=e(a,i,u,o);return n<1?-0.5*t(f,n,s)+r:f.a*Math.pow(2,-10*(n-=1))*Math.sin((n*s-f.s)*2*Math.PI/f.p)*.5+f.c+r}function S(e,t,n,r,i){return i===undefined&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t}function x(e,t,n,r,i){return i===undefined&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t}function T(e,t,n,r,i){return i===undefined&&(i=1.70158),e/=r/2,e<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t}function N(e,t,n,r){return n-C(r-e,0,n,r)+t}function C(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}function k(e,t,n,r){return e<r/2?N(e*2,0,n,r)*.5+t:C(e*2-r,0,n,r)*.5+n*.5+t}fabric.util.ease={easeInQuad:function(e,t,n,r){return n*(e/=r)*e+t},easeOutQuad:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOutQuad:function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,r){return n*(e/=r)*e*e+t},easeOutCubic:n,easeInOutCubic:r,easeInQuart:i,easeOutQuart:s,easeInOutQuart:o,easeInQuint:u,easeOutQuint:a,easeInOutQuint:f,easeInSine:l,easeOutSine:c,easeInOutSine:h,easeInExpo:p,easeOutExpo:d,easeInOutExpo:v,easeInCirc:m,easeOutCirc:g,easeInOutCirc:y,easeInElastic:b,easeOutElastic:w,easeInOutElastic:E,easeInBack:S,easeOutBack:x,easeInOutBack:T,easeInBounce:N,easeOutBounce:C,easeInOutBounce:k}}(),function(e){"use strict";function l(e){return e in a?a[e]:e}function c(e,n,r,i){var s=Object.prototype.toString.call(n)==="[object Array]",a;return e!=="fill"&&e!=="stroke"||n!=="none"?e==="strokeDashArray"?n=n.replace(/,/g," ").split(/\s+/).map(function(e){return parseFloat(e)}):e==="transformMatrix"?r&&r.transformMatrix?n=u(r.transformMatrix,t.parseTransformAttribute(n)):n=t.parseTransformAttribute(n):e==="visible"?(n=n==="none"||n==="hidden"?!1:!0,r&&r.visible===!1&&(n=!1)):e==="originX"?n=n==="start"?"left":n==="end"?"right":"center":a=s?n.map(o):o(n,i):n="",!s&&isNaN(a)?n:a}function h(e){for(var n in f){if(!e[n]||typeof e[f[n]]=="undefined")continue;if(e[n].indexOf("url(")===0)continue;var r=new t.Color(e[n]);e[n]=r.setAlpha(s(r.getAlpha()*e[f[n]],2)).toRgba()}return e}function p(e,t){var n,r;e.replace(/;$/,"").split(";").forEach(function(e){var i=e.split(":");n=l(i[0].trim().toLowerCase()),r=c(n,i[1].trim()),t[n]=r})}function d(e,t){var n,r;for(var i in e){if(typeof e[i]=="undefined")continue;n=l(i.toLowerCase()),r=c(n,e[i]),t[n]=r}}function v(e,n){var r={};for(var i in t.cssRules[n])if(m(e,i.split(" ")))for(var s in t.cssRules[n][i])r[s]=t.cssRules[n][i][s];return r}function m(e,t){var n,r=!0;return n=y(e,t.pop()),n&&t.length&&(r=g(e,t)),n&&r&&t.length===0}function g(e,t){var n,r=!0;while(e.parentNode&&e.parentNode.nodeType===1&&t.length)r&&(n=t.pop()),e=e.parentNode,r=y(e,n);return t.length===0}function y(e,t){var n=e.nodeName,r=e.getAttribute("class"),i=e.getAttribute("id"),s;s=new RegExp("^"+n,"i"),t=t.replace(s,""),i&&t.length&&(s=new RegExp("#"+i+"(?![a-zA-Z\\-]+)","i"),t=t.replace(s,""));if(r&&t.length){r=r.split(" ");for(var o=r.length;o--;)s=new RegExp("\\."+r[o]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(s,"")}return t.length===0}function b(e){var t=e.getElementsByTagName("use");while(t.length){var n=t[0],r=n.getAttribute("xlink:href").substr(1),i=n.getAttribute("x")||0,s=n.getAttribute("y")||0,o=e.getElementById(r).cloneNode(!0),u=(o.getAttribute("transform")||"")+" translate("+i+", "+s+")",a;for(var f=0,l=n.attributes,c=l.length;f<c;f++){var h=l.item(f);if(h.nodeName==="x"||h.nodeName==="y"||h.nodeName==="xlink:href")continue;h.nodeName==="transform"?u=h.nodeValue+" "+u:o.setAttribute(h.nodeName,h.nodeValue)}o.setAttribute("transform",u),o.setAttribute("instantiated_by_use","1"),o.removeAttribute("id"),a=n.parentNode,a.replaceChild(o,n)}}function E(e,t,n){var r=e.getAttribute("viewBox"),i=1,s=1,o=0,u=0,a,f,l,c;if(!r||!(r=r.match(w)))return;o=-parseFloat(r[1]),u=-parseFloat(r[2]),a=parseFloat(r[3]),f=parseFloat(r[4]),t&&t!==a&&(i=t/a),n&&n!==f&&(s=n/f),s=i=i>s?s:i;if(i===1&&s===1&&o===0&&u===0)return;l=" matrix("+i+" 0"+" 0 "+s+" "+o*i+" "+u*s+") ";if(e.tagName==="svg"){c=e.ownerDocument.createElement("g");while(e.firstChild!=null)c.appendChild(e.firstChild);e.appendChild(c)}else c=e,l=c.getAttribute("transform")+l;c.setAttribute("transform",l)}function x(e){var n=e.objects,i=e.options;return n=n.map(function(e){return t[r(e.type)].fromObject(e)}),{objects:n,options:i}}function T(e,t,n){t[n]&&t[n].toSVG&&e.push('<pattern x="0" y="0" id="',n,'Pattern" ','width="',t[n].source.width,'" height="',t[n].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[n].source.width,'" height="',t[n].source.height,'" xlink:href="',t[n].source.src,'"></image></pattern>')}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.string.capitalize,i=t.util.object.clone,s=t.util.toFixed,o=t.util.parseUnit,u=t.util.multiplyTransformMatrices,a={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},f={stroke:"strokeOpacity",fill:"fillOpacity"};t.cssRules={},t.gradientDefs={},t.parseTransformAttribute=function(){function e(e,t){var n=t[0];e[0]=Math.cos(n),e[1]=Math.sin(n),e[2]=-Math.sin(n),e[3]=Math.cos(n)}function n(e,t){var n=t[0],r=t.length===2?t[1]:t[0];e[0]=n,e[3]=r}function r(e,n){e[2]=Math.tan(t.util.degreesToRadians(n[0]))}function i(e,n){e[1]=Math.tan(t.util.degreesToRadians(n[0]))}function s(e,t){e[4]=t[0],t.length===2&&(e[5]=t[1])}var o=[1,0,0,1,0,0],u=t.reNum,a="(?:\\s+,?\\s*|,\\s*)",f="(?:(skewX)\\s*\\(\\s*("+u+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+u+")\\s*\\))",c="(?:(rotate)\\s*\\(\\s*("+u+")(?:"+a+"("+u+")"+a+"("+u+"))?\\s*\\))",h="(?:(scale)\\s*\\(\\s*("+u+")(?:"+a+"("+u+"))?\\s*\\))",p="(?:(translate)\\s*\\(\\s*("+u+")(?:"+a+"("+u+"))?\\s*\\))",d="(?:(matrix)\\s*\\(\\s*("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")"+"\\s*\\))",v="(?:"+d+"|"+p+"|"+h+"|"+c+"|"+f+"|"+l+")",m="(?:"+v+"(?:"+a+v+")*"+")",g="^\\s*(?:"+m+"?)\\s*$",y=new RegExp(g),b=new RegExp(v,"g");return function(u){var a=o.concat(),f=[];if(!u||u&&!y.test(u))return a;u.replace(b,function(u){var l=(new RegExp(v)).exec(u).filter(function(e){return e!==""&&e!=null}),c=l[1],h=l.slice(2).map(parseFloat);switch(c){case"translate":s(a,h);break;case"rotate":h[0]=t.util.degreesToRadians(h[0]),e(a,h);break;case"scale":n(a,h);break;case"skewX":r(a,h);break;case"skewY":i(a,h);break;case"matrix":a=h}f.push(a.concat()),a=o.concat()});var l=f[0];while(f.length>1)f.shift(),l=t.util.multiplyTransformMatrices(l,f[0]);return l}}();var w=new RegExp("^\\s*("+t.reNum+"+)\\s*,?"+"\\s*("+t.reNum+"+)\\s*,?"+"\\s*("+t.reNum+"+)\\s*,?"+"\\s*("+t.reNum+"+)\\s*"+"$");t.parseSVGDocument=function(){function r(e,t){while(e&&(e=e.parentNode))if(t.test(e.nodeName)&&!e.getAttribute("instantiated_by_use"))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,n=/^(symbol|image|marker|pattern|view)$/;return function(s,u,a){if(!s)return;b(s);var f=new Date,l=t.Object.__uid++,c,h,p=!1;s.getAttribute("width")&&s.getAttribute("width")!=="100%"&&(c=o(s.getAttribute("width"))),s.getAttribute("height")&&s.getAttribute("height")!=="100%"&&(h=o(s.getAttribute("height")));if(!c||!h){var d=s.getAttribute("viewBox");d&&(d=d.match(w))?(c=parseFloat(d[3]),h=parseFloat(d[4])):p=!0}E(s,c,h);var v=t.util.toArray(s.getElementsByTagName("*"));if(v.length===0&&t.isLikelyNode){v=s.selectNodes('//*[name(.)!="svg"]');var m=[];for(var g=0,y=v.length;g<y;g++)m[g]=v[g];v=m}var S=v.filter(function(t){return n.test(t.tagName)&&E(t,0,0),e.test(t.tagName)&&!r(t,/^(?:pattern|defs|symbol)$/)});if(!S||S&&!S.length){u&&u([],{});return}var x={width:c,height:h,svgUid:l,toBeParsed:p};t.gradientDefs[l]=t.getGradientDefs(s),t.cssRules[l]=t.getCSSRules(s),t.parseElements(S,function(e){t.documentParsingTime=new Date-f,u&&u(e,x)},i(x),a)}}();var S={has:function(e,t){t(!1)},get:function(){},set:function(){}},N=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");n(t,{parseFontDeclaration:function(e,t){var n=e.match(N);if(!n)return;var r=n[1],i=n[3],s=n[4],u=n[5],a=n[6];r&&(t.fontStyle=r),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),s&&(t.fontSize=o(s)),a&&(t.fontFamily=a),u&&(t.lineHeight=u==="normal"?1:u)},getGradientDefs:function(e){var t=e.getElementsByTagName("linearGradient"),n=e.getElementsByTagName("radialGradient"),r,i,s=0,o,u,a=[],f={},l={};a.length=t.length+n.length,i=t.length;while(i--)a[s++]=t[i];i=n.length;while(i--)a[s++]=n[i];while(s--)r=a[s],u=r.getAttribute("xlink:href"),o=r.getAttribute("id"),u&&(l[o]=u.substr(1)),f[o]=r;for(o in l){var c=f[l[o]].cloneNode(!0);r=f[o];while(c.firstChild)r.appendChild(c.firstChild)}return f},parseAttributes:function(e,r,i){if(!e)return;var s,o={},u;typeof i=="undefined"&&(i=e.getAttribute
("svgUid")),e.parentNode&&/^symbol|[g|a]$/i.test(e.parentNode.nodeName)&&(o=t.parseAttributes(e.parentNode,r,i)),u=o&&o.fontSize||e.getAttribute("font-size")||t.Text.DEFAULT_SVG_FONT_SIZE;var a=r.reduce(function(t,n){return s=e.getAttribute(n),s&&(n=l(n),s=c(n,s,o,u),t[n]=s),t},{});return a=n(a,n(v(e,i),t.parseStyleAttribute(e))),a.font&&t.parseFontDeclaration(a.font,a),h(n(o,a))},parseElements:function(e,n,r,i){(new t.ElementsParser(e,n,r,i)).parse()},parseStyleAttribute:function(e){var t={},n=e.getAttribute("style");return n?(typeof n=="string"?p(n,t):d(n,t),t):t},parsePointsAttribute:function(e){if(!e)return null;e=e.replace(/,/g," ").trim(),e=e.split(/\s+/);var t=[],n,r;n=0,r=e.length;for(;n<r;n+=2)t.push({x:parseFloat(e[n]),y:parseFloat(e[n+1])});return t},getCSSRules:function(e){var n=e.getElementsByTagName("style"),r={},i;for(var s=0,o=n.length;s<o;s++){var u=n[s].textContent;u=u.replace(/\/\*[\s\S]*?\*\//g,"");if(u.trim()==="")continue;i=u.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(e){return e.trim()}),i.forEach(function(e){var n=e.match(/([\s\S]*?)\s*\{([^}]*)\}/),i={},s=n[2].trim(),o=s.replace(/;$/,"").split(/\s*;\s*/);for(var u=0,a=o.length;u<a;u++){var f=o[u].split(/\s*:\s*/),h=l(f[0]),p=c(h,f[1],f[0]);i[h]=p}e=n[1],e.split(",").forEach(function(e){e=e.replace(/^svg/i,"").trim();if(e==="")return;r[e]=t.util.object.clone(i)})})}return r},loadSVGFromURL:function(e,n,r){function i(i){var s=i.responseXML;s&&!s.documentElement&&t.window.ActiveXObject&&i.responseText&&(s=new ActiveXObject("Microsoft.XMLDOM"),s.async="false",s.loadXML(i.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));if(!s||!s.documentElement)return;t.parseSVGDocument(s.documentElement,function(r,i){S.set(e,{objects:t.util.array.invoke(r,"toObject"),options:i}),n(r,i)},r)}e=e.replace(/^\n\s*/,"").trim(),S.has(e,function(r){r?S.get(e,function(e){var t=x(e);n(t.objects,t.options)}):new t.util.request(e,{method:"get",onComplete:i})})},loadSVGFromString:function(e,n,r){e=e.trim();var i;if(typeof DOMParser!="undefined"){var s=new DOMParser;s&&s.parseFromString&&(i=s.parseFromString(e,"text/xml"))}else t.window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(i.documentElement,function(e,t){n(e,t)},r)},createSVGFontFacesMarkup:function(e){var t="";for(var n=0,r=e.length;n<r;n++){if(e[n].type!=="text"||!e[n].path)continue;t+=["@font-face {","font-family: ",e[n].fontFamily,"; ","src: url('",e[n].path,"')","}"].join("")}return t&&(t=['<style type="text/css">',"<![CDATA[",t,"]]>","</style>"].join("")),t},createSVGRefElementsMarkup:function(e){var t=[];return T(t,e,"backgroundColor"),T(t,e,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:this),fabric.ElementsParser=function(e,t,n,r){this.elements=e,this.callback=t,this.options=n,this.reviver=r,this.svgUid=n&&n.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var e=0,t=this.elements.length;e<t;e++)this.elements[e].setAttribute("svgUid",this.svgUid),function(e,t){setTimeout(function(){e.createObject(e.elements[t],t)},0)}(this,e)},fabric.ElementsParser.prototype.createObject=function(e,t){var n=fabric[fabric.util.string.capitalize(e.tagName)];if(n&&n.fromElement)try{this._createObject(n,e,t)}catch(r){fabric.log(r)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(e,t,n){if(e.async)e.fromElement(t,this.createCallback(n,t),this.options);else{var r=e.fromElement(t,this.options);this.resolveGradient(r,"fill"),this.resolveGradient(r,"stroke"),this.reviver&&this.reviver(t,r),this.instances[n]=r,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(e,t){var n=this;return function(r){n.resolveGradient(r,"fill"),n.resolveGradient(r,"stroke"),n.reviver&&n.reviver(t,r),n.instances[e]=r,n.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(e,t){var n=e.get(t);if(!/^url\(/.test(n))return;var r=n.slice(5,n.length-1);fabric.gradientDefs[this.svgUid][r]&&e.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][r],e))},fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances))},function(e){"use strict";function n(e,t){this.x=e,this.y=t}var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=n,n.prototype={constructor:n,add:function(e){return new n(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new n(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new n(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new n(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new n(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new n(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return new n(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},midPointFrom:function(e){return new n(this.x+(e.x-this.x)/2,this.y+(e.y-this.y)/2)},min:function(e){return new n(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new n(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){this.x=e,this.y=t},setFromPoint:function(e){this.x=e.x,this.y=e.y},swap:function(e){var t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n}}}(typeof exports!="undefined"?exports:this),function(e){"use strict";function n(e){this.status=e,this.points=[]}var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}t.Intersection=n,t.Intersection.prototype={appendPoint:function(e){this.points.push(e)},appendPoints:function(e){this.points=this.points.concat(e)}},t.Intersection.intersectLineLine=function(e,r,i,s){var o,u=(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x),a=(r.x-e.x)*(e.y-i.y)-(r.y-e.y)*(e.x-i.x),f=(s.y-i.y)*(r.x-e.x)-(s.x-i.x)*(r.y-e.y);if(f!==0){var l=u/f,c=a/f;0<=l&&l<=1&&0<=c&&c<=1?(o=new n("Intersection"),o.points.push(new t.Point(e.x+l*(r.x-e.x),e.y+l*(r.y-e.y)))):o=new n}else u===0||a===0?o=new n("Coincident"):o=new n("Parallel");return o},t.Intersection.intersectLinePolygon=function(e,t,r){var i=new n,s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=n.intersectLineLine(e,t,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},t.Intersection.intersectPolygonPolygon=function(e,t){var r=new n,i=e.length;for(var s=0;s<i;s++){var o=e[s],u=e[(s+1)%i],a=n.intersectLinePolygon(o,u,t);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,r,i){var s=r.min(i),o=r.max(i),u=new t.Point(o.x,s.y),a=new t.Point(s.x,o.y),f=n.intersectLinePolygon(s,u,e),l=n.intersectLinePolygon(u,o,e),c=n.intersectLinePolygon(o,a,e),h=n.intersectLinePolygon(a,s,e),p=new n;return p.appendPoints(f.points),p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p}}(typeof exports!="undefined"?exports:this),function(e){"use strict";function n(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}t.Color=n,t.Color.prototype={_tryParsingColor:function(e){var t;e in n.colorNameMap&&(e=n.colorNameMap[e]);if(e==="transparent"){this.setSource([255,255,255,0]);return}t=n.sourceFromHex(e),t||(t=n.sourceFromRgb(e)),t||(t=n.sourceFromHsl(e)),t&&this.setSource(t)},_rgbToHsl:function(e,n,r){e/=255,n/=255,r/=255;var i,s,o,u=t.util.array.max([e,n,r]),a=t.util.array.min([e,n,r]);o=(u+a)/2;if(u===a)i=s=0;else{var f=u-a;s=o>.5?f/(2-u-a):f/(u+a);switch(u){case e:i=(n-r)/f+(n<r?6:0);break;case n:i=(r-e)/f+2;break;case r:i=(e-n)/f+4}i/=6}return[Math.round(i*360),Math.round(s*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e=this.getSource(),t,n,r;return t=e[0].toString(16),t=t.length===1?"0"+t:t,n=e[1].toString(16),n=n.length===1?"0"+n:n,r=e[2].toString(16),r=r.length===1?"0"+r:r,t.toUpperCase()+n.toUpperCase()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),10),n=e[3];return this.setSource([t,t,t,n]),this},toBlackWhite:function(e){var t=this.getSource(),n=(t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),r=t[3];return e=e||127,n=Number(n)<Number(e)?0:255,this.setSource([n,n,n,r]),this},overlayWith:function(e){e instanceof n||(e=new n(e));var t=[],r=this.getAlpha(),i=.5,s=this.getSource(),o=e.getSource();for(var u=0;u<3;u++)t.push(Math.round(s[u]*(1-i)+o[u]*i));return t[3]=r,this.setSource(t),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,t.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},t.Color.fromRgb=function(e){return n.fromSource(n.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(n.reRGBa);if(t){var r=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),i=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),s=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(r,10),parseInt(i,10),parseInt(s,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=n.fromRgb,t.Color.fromHsl=function(e){return n.fromSource(n.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(n.reHSLa);if(!t)return;var i=(parseFloat(t[1])%360+360)%360/360,s=parseFloat(t[2])/(/%$/.test(t[2])?100:1),o=parseFloat(t[3])/(/%$/.test(t[3])?100:1),u,a,f;if(s===0)u=a=f=o;else{var l=o<=.5?o*(s+1):o+s-o*s,c=o*2-l;u=r(c,l,i+1/3),a=r(c,l,i),f=r(c,l,i-1/3)}return[Math.round(u*255),Math.round(a*255),Math.round(f*255),t[4]?parseFloat(t[4]):1]},t.Color.fromHsla=n.fromHsl,t.Color.fromHex=function(e){return n.fromSource(n.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(n.reHex)){var t=e.slice(e.indexOf("#")+1),r=t.length===3,i=r?t.charAt(0)+t.charAt(0):t.substring(0,2),s=r?t.charAt(1)+t.charAt(1):t.substring(2,4),o=r?t.charAt(2)+t.charAt(2):t.substring(4,6);return[parseInt(i,16),parseInt(s,16),parseInt(o,16),1]}},t.Color.fromSource=function(e){var t=new n;return t.setSource(e),t}}(typeof exports!="undefined"?exports:this),function(){function e(e){var t=e.getAttribute("style"),n=e.getAttribute("offset"),r,i,s;n=parseFloat(n)/(/%$/.test(n)?100:1),n=n<0?0:n>1?1:n;if(t){var o=t.split(/\s*;\s*/);o[o.length-1]===""&&o.pop();for(var u=o.length;u--;){var a=o[u].split(/\s*:\s*/),f=a[0].trim(),l=a[1].trim();f==="stop-color"?r=l:f==="stop-opacity"&&(s=l)}}return r||(r=e.getAttribute("stop-color")||"rgb(0,0,0)"),s||(s=e.getAttribute("stop-opacity")),r=new fabric.Color(r),i=r.getAlpha(),s=isNaN(parseFloat(s))?1:parseFloat(s),s*=i,{offset:n,color:r.toRgb(),opacity:s}}function t(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}function n(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}function r(e,t,n){var r,i=0,s=1,o="";for(var u in t){r=parseFloat(t[u],10),typeof t[u]=="string"&&/^\d+%$/.test(t[u])?s=.01:s=1;if(u==="x1"||u==="x2"||u==="r2")s*=n==="objectBoundingBox"?e.width:1,i=n==="objectBoundingBox"?e.left||0:0;else if(u==="y1"||u==="y2")s*=n==="objectBoundingBox"?e.height:1,i=n==="objectBoundingBox"?e.top||0:0;t[u]=r*s+i}if(e.type==="ellipse"&&t.r2!==null&&n==="objectBoundingBox"&&e.rx!==e.ry){var a=e.ry/e.rx;o=" scale(1, "+a+")",t.y1&&(t.y1/=a),t.y2&&(t.y2/=a)}return o}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(e){e||(e={});var t={};this.id=fabric.Object.__uid++,this.type=e.type||"linear",t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},this.type==="radial"&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.colorStops=e.colorStops.slice(),e.gradientTransform&&(this.gradientTransform=e.gradientTransform),this.offsetX=e.offsetX||this.offsetX,this.offsetY=e.offsetY||this.offsetY},addColorStop:function(e){for(var t in e){var n=new fabric.Color(e[t]);this.colorStops.push({offset:t,color:n.toRgb(),opacity:n.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var t=fabric.util.object.clone(this.coords),n,r;this.colorStops.sort(function(e,t){return e.offset-t.offset});if(!e.group||e.group.type!=="path-group")for(var i in t)if(i==="x1"||i==="x2"||i==="r2")t[i]+=this.offsetX-e.width/2;else if(i==="y1"||i==="y2")t[i]+=this.offsetY-e.height/2;r='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(r+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),this.type==="linear"?n=["<linearGradient ",r,' x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'">\n']:this.type==="radial"&&(n=["<radialGradient ",r,' cx="',t.x2,'" cy="',t.y2,'" r="',t.r2,'" fx="',t.x1,'" fy="',t.y1,'">\n']);for(var s=0;s<this.colorStops.length;s++)n.push("<stop ",'offset="',this.colorStops[s].offset*100+"%",'" style="stop-color:',this.colorStops[s].color,this.colorStops[s].opacity!=null?";stop-opacity: "+this.colorStops[s].opacity:";",'"/>\n');return n.push(this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n"),n.join("")},toLive:function(e,t){var n,r,i=fabric.util.object.clone(this.coords);if(!this.type)return;if(t.group&&t.group.type==="path-group")for(r in i)if(r==="x1"||r==="x2")i[r]+=-this.offsetX+t.width/2;else if(r==="y1"||r==="y2")i[r]+=-this.offsetY+t.height/2;if(t.type==="text"||t.type==="i-text")for(r in i)if(r==="x1"||r==="x2")i[r]-=t.width/2;else if(r==="y1"||r==="y2")i[r]-=t.height/2;this.type==="linear"?n=e.createLinearGradient(i.x1,i.y1,i.x2,i.y2):this.type==="radial"&&(n=e.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2));for(var s=0,o=this.colorStops.length;s<o;s++){var u=this.colorStops[s].color,a=this.colorStops[s].opacity,f=this.colorStops[s].offset;typeof a!="undefined"&&(u=(new fabric.Color(u)).setAlpha(a).toRgba()),n.addColorStop(parseFloat(f),u)}return n}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,s){var o=i.getElementsByTagName("stop"),u=i.nodeName==="linearGradient"?"linear":"radial",a=i.getAttribute("gradientUnits")||"objectBoundingBox",f=i.getAttribute("gradientTransform"),l=[],c={},h;u==="linear"?c=t(i):u==="radial"&&(c=n(i));for(var p=o.length;p--;)l.push(e(o[p]));h=r(s,c,a);var d=new fabric.Gradient({type:u,coords:c,colorStops:l,offsetX:-s.left,offsetY:-s.top});if(f||h!=="")d.gradientTransform=fabric.parseTransformAttribute((f||"")+h);return d},forObject:function(e,t){return t||(t={}),r(e,t.coords,"userSpaceOnUse"),new fabric.Gradient(t)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||(e={}),this.id=fabric.Object.__uid++;if(e.source)if(typeof e.source=="string")if(typeof fabric.util.getFunctionBody(e.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(e.source));else{var t=this;this.source=fabric.util.createImage(),fabric.util.loadImage(e.source,function(e){t.source=e})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat),e.offsetX&&(this.offsetX=e.offsetX),e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;return typeof this.source=="function"?e=String(this.source):typeof this.source.src=="string"&&(e=this.source.src),{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var t=typeof this.source=="function"?this.source():this.source,n=t.width/e.getWidth(),r=t.height/e.getHeight(),i=this.offsetX/e.getWidth(),s=this.offsetY/e.getHeight(),o="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat")r=1;if(this.repeat==="repeat-y"||this.repeat==="no-repeat")n=1;return t.src?o=t.src:t.toDataURL&&(o=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+s+'" width="'+n+'" height="'+r+'">\n'+'<image x="0" y="0"'+' width="'+t.width+'" height="'+t.height+'" xlink:href="'+o+'"></image>\n'+"</pattern>\n"},toLive:function(e){var t=typeof this.source=="function"?this.source():this.source;if(!t)return"";if(typeof t.src!="undefined"){if(!t.complete)return"";if(t.naturalWidth===0||t.naturalHeight===0)return""}return e.createPattern(t,this.repeat)}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.toFixed;if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(e){typeof e=="string"&&(e=this._parseShadow(e));for(var n in e)this[n]=e[n];this.id=t.Object.__uid++},_parseShadow:function(e){var n=e.trim(),r=t.Shadow.reOffsetsAndBlur.exec(n)||[],i=n.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseInt(r[1],10)||0,offsetY:parseInt(r[2],10)||0,blur:parseInt(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var t="SourceAlpha",r=40,i=40;return e&&(e.fill===this.color||e.stroke===this.color)&&(t="SourceGraphic"),e.width&&e.height&&(r=n(Math.abs(this.offsetX/e.getWidth()),2)*100+20,i=n(Math.abs(this.offsetY/e.getHeight()),2)*100+20),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" '+'x="-'+r+'%" width="'+(100+2*r)+'%" '+">\n"+'	<feGaussianBlur in="'+t+'" stdDeviation="'+n(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n'+'	<feColorMatrix result="matrixOut" in="blurOut" type="matrix" '+'values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n'+'	<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n'+"	<feMerge>\n"+"		<feMergeNode></feMergeNode>\n"+'		<feMergeNode in="SourceGraphic"></feMergeNode>\n'+"	</feMerge>\n"+"</filter>\n"},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var e={},n=t.Shadow.prototype;return this.color!==n.color&&(e.color=this.color),this.blur!==n.blur&&(e.blur=this.blur),this.offsetX!==n.offsetX&&(e.offsetX=this.offsetX),this.offsetY!==n.offsetY&&(e.offsetY=this.offsetY),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,t=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(e,t){t||(t={}),this._initStatic(e,t),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(e,t){this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this)),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this)),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this)),t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,n){return this.__setBgOverlayImage("overlayImage",e,t,n)},setBackgroundImage:function(e,t,n){return this.__setBgOverlayImage("backgroundImage",e,t,n)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,e.mozImageSmoothingEnabled=this.imageSmoothingEnabled,e.msImageSmoothingEnabled=this.imageSmoothingEnabled,e.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,n,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[e]=new fabric.Image(t,r),n&&n()},this,r&&r.crossOrigin):(r&&t.setOptions(r),this[e]=t,n&&n()),this},__setBgOverlayColor:function(e,t,n){if(t&&t.source){var r=this;fabric.util.loadImage(t.source,function(i){r[e]=new fabric.Pattern({source:i,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY}),n&&n()})}else this[e]=t,n&&n();return this},_createCanvasElement:function(){var e=fabric.document.createElement("canvas");e.style||(e.style={});if(!e)throw r;return this._initCanvasElement(e),e},_initCanvasElement:function(e){fabric.util.createCanvasElement(e);if(typeof e.getContext=="undefined")throw r},_initOptions:function(e){for(var t in e)this[t]=e[t];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style)return;this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(e){this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var n;t=t||{};for(var r in e)n=e[r],t.cssOnly||(this._setBackstoreDimension(r,e[r]),n+="px"),t.backstoreOnly||this._setCssDimension(r,n);return t.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(e){var t=this.getActiveGroup();this.viewportTransform=e,this.renderAll();for(var n=0,r=this._objects.length;n<r;n++)this._objects[n].setCoords();return t&&t.setCoords(),this},zoomToPoint:function(e,t){var n=e;e=fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=t,this.viewportTransform[3]=t;var r=fabric.util.transformPoint(e,this.viewportTransform);this.viewportTransform[4]+=n.x-r.x,this.viewportTransform[5]+=n.y-r.y,this.renderAll();for(var i=0,s=this._objects.length;i<s;i++)this._objects[i].setCoords();return this},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){this.viewportTransform[4]=-e.x,this.viewportTransform[5]=-e.y,this.renderAll();for(var t=0,n=this._objects.length;t<n;t++)this._objects[t].setCoords();return this},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(e,t){if(!t)return;e.save();var n=this.viewportTransform;e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._shouldRenderObject(t)&&t.render(e),e.restore(),this.controlsAboveOverlay||t._renderControls(e)},_shouldRenderObject:function(e){return e?e!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(e){this.stateful&&e.setupState(),e.canvas=this,e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.getActiveObject()===e&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:e}),e.fire("removed")},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(e){var t=this[e===!0&&this.interactive?"contextTop":"contextContainer"],n=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),e||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,n),this._renderActiveGroup(t,n),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(e,t){var n,r;if(!t||this.preserveObjectStacking)for(n=0,r=this._objects.length;n<r;++n)this._draw(e,this._objects[n]);else for(n=0,r=this._objects.length;n<r;++n)this._objects[n]&&!t.contains(this._objects[n])&&this._draw(e,this._objects[n])},_renderActiveGroup:function(e,t){if(t){var n=[];this.forEachObject(function(e){t.contains(e)&&n.push(e)}),t._set("objects",n),this._draw(e,t)}},_renderBackground:function(e){this.backgroundColor&&(e.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(e):this.backgroundColor,e.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(e,this.backgroundImage)},_renderOverlay:function(e){this.overlayColor&&(e.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(e):this.overlayColor,e.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(e,this.overlayImage)},renderTop:function(){var e=this.contextTop||this.contextContainer;this.clearContext(e),this.selection&&this._groupSelector&&this._drawSelection();var t=this.getActiveGroup();return t&&t.render(e),this._renderOverlay(e),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,n){var r={objects:this._toObjects(t,n)};return e(r,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,r,n),r},_toObjects:function(e,t){return this.getObjects().map(function(n){return this._toObject(n,e,t)},this)},_toObject:function(e,t,n){var r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);var i=this._realizeGroupTransformOnObject(e),s=e[t](n);return this.includeDefaultValues||(e.includeDefaultValues=r),this._unwindGroupTransformOnObject(e,i),s},_realizeGroupTransformOnObject:function(e){var t=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(e.group&&e.group===this.getActiveGroup()){var n={};return t.forEach(function(t){n[t]=e[t]}),this.getActiveGroup().realizeTransform(e),n}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},__serializeBgOverlay:function(){var e={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(e.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(e.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(e.overlayImage=this.overlayImage.toObject()),e},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={});var n=[];return this._setSVGPreamble(n,e),this._setSVGHeader(n,e),this._setSVGBgOverlayColor(n,"backgroundColor"),this._setSVGBgOverlayImage(n,"backgroundImage"),this._setSVGObjects(n,t),this._setSVGBgOverlayColor(n,"overlayColor"),this._setSVGBgOverlayImage(n,"overlayImage"),n.push("</svg>"),n.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){var n,r,i;t.viewBox?(n=t.viewBox.width,r=t.viewBox.height):(n=this.width,r=this.height,this.svgViewportTransformation||(i=this.viewportTransform,n/=i[0],r/=i[3])),e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',r,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(e,t){for(var n=0,r=this.getObjects(),i=r.length;n<i;n++){var s=r[n],o=this._realizeGroupTransformOnObject(s);e.push(s.toSVG(t)),this._unwindGroupTransformOnObject(s,o)}},_setSVGBgOverlayImage:function(e,t){this[t]&&this[t].toSVG&&e.push(this[t].toSVG())},_setSVGBgOverlayColor:function(e,t){this[t]&&this[t].source?e.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"></rect>"):this[t]&&t==="overlayColor"&&e.push('<rect x="0" y="0" ','width="',this.width,'" height="'
,this.height,'" fill="',this[t],'"',"></rect>")},sendToBack:function(e){return n(this._objects,e),this._objects.unshift(e),this.renderAll&&this.renderAll()},bringToFront:function(e){return n(this._objects,e),this._objects.push(e),this.renderAll&&this.renderAll()},sendBackwards:function(e,t){var r=this._objects.indexOf(e);if(r!==0){var i=this._findNewLowerIndex(e,r,t);n(this._objects,e),this._objects.splice(i,0,e),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(e,t,n){var r;if(n){r=t;for(var i=t-1;i>=0;--i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}}else r=t-1;return r},bringForward:function(e,t){var r=this._objects.indexOf(e);if(r!==this._objects.length-1){var i=this._findNewUpperIndex(e,r,t);n(this._objects,e),this._objects.splice(i,0,e),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(e,t,n){var r;if(n){r=t;for(var i=t+1;i<this._objects.length;++i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}}else r=t+1;return r},moveTo:function(e,t){return n(this._objects,e),this._objects.splice(t,0,e),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): "+"{ objects: "+this.getObjects().length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=fabric.util.createCanvasElement();if(!t||!t.getContext)return null;var n=t.getContext("2d");if(!n)return null;switch(e){case"getImageData":return typeof n.getImageData!="undefined";case"setLineDash":return typeof n.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray)},_setShadow:function(){if(!this.shadow)return;var e=this.canvas.contextTop;e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e,this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e){this._captureDrawingPath(e),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){this._points.push(e)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t=this.canvas.viewportTransform,n=this._points[0],r=this._points[1];e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.beginPath(),this._points.length===2&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),e.moveTo(n.x,n.y);for(var i=1,s=this._points.length;i<s;i++){var o=n.midPointFrom(r);e.quadraticCurveTo(n.x,n.y,o.x,o.y),n=this._points[i],r=this._points[i+1]}e.lineTo(n.x,n.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=[],n=new fabric.Point(e[0].x,e[0].y),r=new fabric.Point(e[1].x,e[1].y);t.push("M ",e[0].x," ",e[0].y," ");for(var i=1,s=e.length;i<s;i++){var o=n.midPointFrom(r);t.push("Q ",n.x," ",n.y," ",o.x," ",o.y," "),n=new fabric.Point(e[i].x,e[i].y),i+1<e.length&&(r=new fabric.Point(e[i+1].x,e[i+1].y))}return t.push("L ",n.x," ",n.y," "),t},createPath:function(e){var t=new fabric.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var n=this.createPath(t);this.canvas.add(n),n.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:n})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),n=this.canvas.contextTop,r=this.canvas.viewportTransform;n.save(),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.fillStyle=t.fill,n.beginPath(),n.arc(t.x,t.y,t.radius,0,Math.PI*2,!1),n.closePath(),n.fill(),n.restore()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var t=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n],s=new fabric.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&s.setShadow(this.shadow),t.push(s)}var o=new fabric.Group(t,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},addPoint:function(e){var t=new fabric.Point(e.x,e.y),n=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=n,t.fill=r,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render()},onMouseMove:function(e){this.addSprayChunk(e),this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var t=[];for(var n=0,r=this.sprayChunks.length;n<r;n++){var i=this.sprayChunks[n];for(var s=0,o=i.length;s<o;s++){var u=new fabric.Rect({width:i[s].width,height:i[s].width,left:i[s].x+1,top:i[s].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&u.setShadow(this.shadow),t.push(u)}}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var a=new fabric.Group(t,{originX:"center",originY:"center"});a.canvas=this.canvas,this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},_getOptimizedRects:function(e){var t={},n;for(var r=0,i=e.length;r<i;r++)n=e[r].left+""+e[r].top,t[n]||(t[n]=e[r]);var s=[];for(n in t)s.push(t[n]);return s},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]);for(var n=0,r=this.sprayChunkPoints.length;n<r;n++){var i=this.sprayChunkPoints[n];typeof i.opacity!="undefined"&&(e.globalAlpha=i.opacity),e.fillRect(i.x,i.y,i.width,i.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,n,r,i=this.width/2;for(var s=0;s<this.density;s++){t=fabric.util.getRandomInt(e.x-i,e.x+i),n=fabric.util.getRandomInt(e.y-i,e.y+i),this.dotWidthVariance?r=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):r=this.dotWidth;var o=new fabric.Point(t,n);o.width=r,this.randomOpacity&&(o.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=20,t=5,n=fabric.document.createElement("canvas"),r=n.getContext("2d");return n.width=n.height=e+t,r.fillStyle=this.color,r.beginPath(),r.arc(e/2,e/2,e/2,0,Math.PI*2,!1),r.closePath(),r.fill(),n},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,n=fabric.util.radiansToDegrees,r=Math.atan2,i=Math.abs,s=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(e){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(e,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.originX==="right"?t.mouseXSign=-1:t.mouseXSign=1),t.originY!=="center"&&(t.originY==="bottom"?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(e,t){var n=this.getPointer(e,!0),r=this._normalizePointer(t,n);return t.containsPoint(r)||t._findTargetCorner(n)},_normalizePointer:function(e,t){var n=this.getActiveGroup(),r=t.x,i=t.y,s=n&&e.type!=="group"&&n.contains(e),o;return s&&(o=new fabric.Point(n.left,n.top),o=fabric.util.transformPoint(o,this.viewportTransform,!0),r-=o.x,i-=o.y),{x:r,y:i}},isTargetTransparent:function(e,t,n){var r=e.hasBorders,i=e.transparentCorners;e.hasBorders=e.transparentCorners=!1,this._draw(this.contextCache,e),e.hasBorders=r,e.transparentCorners=i;var s=fabric.util.isTransparent(this.contextCache,t,n,this.targetFindTolerance);return this.clearContext(this.contextCache),s},_shouldClearSelection:function(e,t){var n=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&n&&!n.contains(t)&&n!==t&&!e.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(e,t){if(!t)return;var n=this._currentTransform,r;return n.action==="scale"||n.action==="scaleX"||n.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:n.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!e.altKey:e.altKey},_getOriginFromCorner:function(e,t){var n={x:e.originX,y:e.originY};if(t==="ml"||t==="tl"||t==="bl")n.x="right";else if(t==="mr"||t==="tr"||t==="br")n.x="left";if(t==="tl"||t==="mt"||t==="tr")n.y="bottom";else if(t==="bl"||t==="mb"||t==="br")n.y="top";return n},_getActionFromCorner:function(e,t){var n="drag";return t&&(n=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),n},_setupCurrentTransform:function(e,n){if(!n)return;var r=this.getPointer(e),i=n._findTargetCorner(this.getPointer(e,!0)),s=this._getActionFromCorner(n,i),o=this._getOriginFromCorner(n,i);this._currentTransform={target:n,action:s,scaleX:n.scaleX,scaleY:n.scaleY,offsetX:r.x-n.left,offsetY:r.y-n.top,originX:o.x,originY:o.y,ex:r.x,ey:r.y,left:n.left,top:n.top,theta:t(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:n.left,top:n.top,scaleX:n.scaleX,scaleY:n.scaleY,originX:o.x,originY:o.y},this._resetCurrentTransform(e)},_translateObject:function(e,t){var n=this._currentTransform.target;n.get("lockMovementX")||n.set("left",e-this._currentTransform.offsetX),n.get("lockMovementY")||n.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(e,t,n){var r=this._currentTransform,i=r.target,s=i.get("lockScalingX"),o=i.get("lockScalingY"),u=i.get("lockScalingFlip");if(s&&o)return;var a=i.translateToOriginPoint(i.getCenterPoint(),r.originX,r.originY),f=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY);this._setLocalMouse(f,r),this._setObjectScale(f,r,s,o,n,u),i.setPositionByOrigin(a,r.originX,r.originY)},_setObjectScale:function(e,t,n,r,i,s){var o=t.target,u=!1,a=!1,f=o.stroke?o.strokeWidth:0;t.newScaleX=e.x/(o.width+f/2),t.newScaleY=e.y/(o.height+f/2),s&&t.newScaleX<=0&&t.newScaleX<o.scaleX&&(u=!0),s&&t.newScaleY<=0&&t.newScaleY<o.scaleY&&(a=!0),i==="equally"&&!n&&!r?u||a||this._scaleObjectEqually(e,o,t):i?i==="x"&&!o.get("lockUniScaling")?u||n||o.set("scaleX",t.newScaleX):i==="y"&&!o.get("lockUniScaling")&&(a||r||o.set("scaleY",t.newScaleY)):(u||n||o.set("scaleX",t.newScaleX),a||r||o.set("scaleY",t.newScaleY)),u||a||this._flipObject(t,i)},_scaleObjectEqually:function(e,t,n){var r=e.y+e.x,i=t.stroke?t.strokeWidth:0,s=(t.height+i/2)*n.original.scaleY+(t.width+i/2)*n.original.scaleX;n.newScaleX=n.original.scaleX*r/s,n.newScaleY=n.original.scaleY*r/s,t.set("scaleX",n.newScaleX),t.set("scaleY",n.newScaleY)},_flipObject:function(e,t){e.newScaleX<0&&t!=="y"&&(e.originX==="left"?e.originX="right":e.originX==="right"&&(e.originX="left")),e.newScaleY<0&&t!=="x"&&(e.originY==="top"?e.originY="bottom":e.originY==="bottom"&&(e.originY="top"))},_setLocalMouse:function(e,t){var n=t.target;t.originX==="right"?e.x*=-1:t.originX==="center"&&(e.x*=t.mouseXSign*2,e.x<0&&(t.mouseXSign=-t.mouseXSign)),t.originY==="bottom"?e.y*=-1:t.originY==="center"&&(e.y*=t.mouseYSign*2,e.y<0&&(t.mouseYSign=-t.mouseYSign)),i(e.x)>n.padding?e.x<0?e.x+=n.padding:e.x-=n.padding:e.x=0,i(e.y)>n.padding?e.y<0?e.y+=n.padding:e.y-=n.padding:e.y=0},_rotateObject:function(e,t){var i=this._currentTransform;if(i.target.get("lockRotation"))return;var s=r(i.ey-i.top,i.ex-i.left),o=r(t-i.top,e-i.left),u=n(o-s+i.theta);u<0&&(u=360+u),i.target.angle=u%360},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.setAngle(0)},_drawSelection:function(){var e=this.contextTop,t=this._groupSelector,n=t.left,r=t.top,o=i(n),u=i(r);e.fillStyle=this.selectionColor,e.fillRect(t.ex-(n>0?0:-n),t.ey-(r>0?0:-r),o,u),e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var a=t.ex+s-(n>0?0:o),f=t.ey+s-(r>0?0:u);e.beginPath(),fabric.util.drawDashedLine(e,a,f,a+o,f,this.selectionDashArray),fabric.util.drawDashedLine(e,a,f+u-1,a+o,f+u-1,this.selectionDashArray),fabric.util.drawDashedLine(e,a,f,a,f+u,this.selectionDashArray),fabric.util.drawDashedLine(e,a+o-1,f,a+o-1,f+u,this.selectionDashArray),e.closePath(),e.stroke()}else e.strokeRect(t.ex+s-(n>0?0:o),t.ey+s-(r>0?0:u),o,u)},_isLastRenderedObject:function(e){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(e,!0))},findTarget:function(e,t){if(this.skipTargetFind)return;if(this._isLastRenderedObject(e))return this.lastRenderedObjectWithControlsAboveOverlay;var n=this.getActiveGroup();if(n&&!t&&this.containsPoint(e,n))return n;var r=this._searchPossibleTargets(e);return this._fireOverOutEvents(r),r},_fireOverOutEvents:function(e){e?this._hoveredTarget!==e&&(this.fire("mouse:over",{target:e}),e.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=e):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(e,t,n){if(t&&t.visible&&t.evented&&this.containsPoint(e,t)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||!!t.isEditing)return!0;var r=this.isTargetTransparent(t,n.x,n.y);if(!r)return!0}},_searchPossibleTargets:function(e){var t,n=this.getPointer(e,!0),r=this._objects.length;while(r--)if(!this._objects[r].group&&this._checkTarget(e,this._objects[r],n)){this.relatedTarget=this._objects[r],t=this._objects[r];break}return t},getPointer:function(t,n,r){r||(r=this.upperCanvasEl);var i=e(t,r),s=r.getBoundingClientRect(),o=s.width||0,u=s.height||0,a;if(!o||!u)"top"in s&&"bottom"in s&&(u=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(o=Math.abs(s.right-s.left));return this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,n||(i=fabric.util.transformPoint(i,fabric.util.invertTransform(this.viewportTransform))),o===0||u===0?a={width:1,height:1}:a={width:r.width/o,height:r.height/u},{x:i.x*a.width,y:i.y*a.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.getWidth()||e.width,n=this.getHeight()||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:n+"px",left:0,top:0}),e.width=t,e.height=n,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(e){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=e,e.set("active",!0)},setActiveObject:function(e,t){return this._setActiveObject(e),this.renderAll(),this.fire("object:selected",{target:e,e:t}),e.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(e){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:e}),this},_setActiveGroup:function(e){this._activeGroup=e,e&&e.set("active",!0)},setActiveGroup:function(e,t){return this._setActiveGroup(e),e&&(this.fire("object:selected",{target:e,e:t}),e.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var e=this.getActiveGroup();e&&e.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(e){return this._discardActiveGroup(),this.fire("selection:cleared",{e:e}),this},deactivateAll:function(){var e=this.getObjects(),t=0,n=e.length;for(;t<n;t++)e[t].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(e){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:e}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:e}),this},drawControls:function(e){var t=this.getActiveGroup();t?this._drawGroupControls(e,t):this._drawObjectsControls(e)},_drawGroupControls:function(e,t){t._renderControls(e)},_drawObjectsControls:function(e){for(var t=0,n=this._objects.length;t<n;++t){if(!this._objects[t]||!this._objects[t].active)continue;this._objects[t]._renderControls(e),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t]}}});for(var o in fabric.StaticCanvas)o!=="prototype"&&(fabric.Canvas[o]=fabric.StaticCanvas[o]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},t=fabric.util.addListener,n=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),t(fabric.window,"resize",this._onResize),t(this.upperCanvasEl,"mousedown",this._onMouseDown),t(this.upperCanvasEl,"mousemove",this._onMouseMove),t(this.upperCanvasEl,"mousewheel",this._onMouseWheel),t(this.upperCanvasEl,"touchstart",this._onMouseDown),t(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof eventjs!="undefined"&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){n(fabric.window,"resize",this._onResize),n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"mousewheel",this._onMouseWheel),n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof eventjs!="undefined"&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e,t){this.__onMouseWheel&&this.__onMouseWheel(e,t)},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onMouseDown:function(e){this.__onMouseDown(e),t(fabric.document,"touchend",this._onMouseUp),t(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),e.type==="touchstart"?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(e){this.__onMouseUp(e),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove),n(fabric.document,"touchmove",this._onMouseMove),t(this.upperCanvasEl,"mousemove",this._onMouseMove),t(this.upperCanvasEl,"touchmove",this._onMouseMove);if(e.type==="touchend"){var r=this;setTimeout(function(){t(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,t){var n=this.getActiveGroup()||this.getActiveObject();return!!(e&&(e.isMoving||e!==n)||!e&&!!n||!e&&!n&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(e){var t;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(e,!0);var n=this._shouldRender(t,this.getPointer(e));this._maybeGroupObjects(e),t&&(t.isMoving=!1),n&&this.renderAll(),this._handleCursorAndEvent(e,t)},_handleCursorAndEvent:function(e,t){this._setCursorFromEvent(e,t);var n=this;setTimeout(function(){n._setCursorFromEvent(e,t)},50),this.fire("mouse:up",{target:t,e:e}),t&&t.fire("mouseup",{e:e})},_finalizeCurrentTransform:function(){var e=this._currentTransform,t=e.target;t._scaling&&(t._scaling=!1),t.setCoords(),this.stateful&&t.hasStateChanged()&&(this.fire("object:modified",{target:t}),t.fire("modified")),this._restoreOriginXY(t)},_restoreOriginXY:function(e){if(this._previousOriginX&&this._previousOriginY){var t=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=t.x,e.top=t.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.discardActiveObject(e).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=fabric.util.invertTransform(this.viewportTransform),n=fabric.util.transformPoint(this.getPointer(e,!0),t);this.freeDrawingBrush.onMouseDown(n),this.fire("mouse:down",{e:e});var r=this.findTarget(e);typeof r!="undefined"&&r.fire("mousedown",{e:e,target:r})},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=fabric.util.invertTransform(this.viewportTransform),n=fabric.util.transformPoint(this.getPointer(e,!0),t);this.freeDrawingBrush.onMouseMove(n)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:e});var r=this.findTarget(e);typeof r!="undefined"&&r.fire("mousemove",{e:e,target:r})},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:e});var t=this.findTarget(e);typeof t!="undefined"&&t.fire("mouseup",{e:e,target:t})},__onMouseDown:function(e){var t="which"in e?e.which===1:e.button===1;if(!t&&!fabric.isTouchSupported)return;if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return}if(this._currentTransform)return;var n=this.findTarget(e),r=this.getPointer(e,!0);this._previousPointer=r;var i=this._shouldRender(n,r),s=this._shouldGroup(e,n);this._shouldClearSelection(e,n)?this._clearSelection(e,n,r):s&&(this._handleGrouping(e,n),n=this.getActiveGroup()),n&&n.selectable&&!s&&(this._beforeTransform(e,n),this._setupCurrentTransform(e,n)),i&&this.renderAll(),this.fire("mouse:down",{target:n,e:e}),n&&n.fire("mousedown",{e:e})},_beforeTransform:function(e,t){this.stateful&&t.saveState(),t._findTargetCorner(this.getPointer(e))&&this.onBeforeScaleRotate(t),t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,e))},_clearSelection:function(e,t,n){this.deactivateAllWithDispatch(e),t&&t.selectable?this.setActiveObject(t,e):this.selection&&(this._groupSelector={ex:n.x,ey:n.y,top:0,left:0})},_setOriginToCenter:function(e){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var t=e.getCenterPoint();e.originX="center",e.originY="center",e.left=t.x,e.top=t.y,this._currentTransform.left=e.left,this._currentTransform.top=e.top},_setCenterToOrigin:function(e){var t=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=t.x,e.top=t.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(e){var t,n;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return}if(typeof e.touches!="undefined"&&e.touches.length>1)return;var r=this._groupSelector;r?(n=this.getPointer(e,!0),r.left=n.x-r.ex,r.top=n.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e),!t||t&&!t.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(e,t)),this.fire("mouse:move",{target:t,e:e}),t&&t.fire("mousemove",{e:e})},_transformObject:function(e){var t=this.getPointer(e),n=this._currentTransform;n.reset=!1,n.target.isMoving=!0,this._beforeScaleTransform(e,n),this._performTransformAction(e,n,t),this.renderAll()},_performTransformAction:function(e,t,n){var r=n.x,i=n.y,s=t.target,o=t.action;o==="rotate"?(this._rotateObject(r,i),this._fire("rotating",s,e)):o==="scale"?(this._onScale(e,t,r,i),this._fire("scaling",s,e)):o==="scaleX"?(this._scaleObject(r,i,"x"),this._fire("scaling",s,e)):o==="scaleY"?(this._scaleObject(r,i,"y"),this._fire("scaling",s,e)):(this._translateObject(r,i),this._fire("moving",s,e),this.setCursor(this.moveCursor))},_fire:function(e,t,n){this.fire("object:"+e,{target:t,e:n}),t.fire(e,{e:n})},_beforeScaleTransform:function(e,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var n=this._shouldCenterTransform(e,t.target);if(n&&(t.originX!=="center"||t.originY!=="center")||!n&&t.originX==="center"&&t.originY==="center")this._resetCurrentTransform(e),t.reset=!0}},_onScale:function(e,t,n,r){(e.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(n,r)):(!t.reset&&t.currentAction==="scale"&&this._resetCurrentTransform(e,t.target),t.currentAction="scaleEqually",this._scaleObject(n,r,"equally"))},_setCursorFromEvent:function(e,t){if(!t||!t.selectable)return this.setCursor(this.defaultCursor),!1;var n=this.getActiveGroup(),r=t._findTargetCorner&&(!n||!n.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));return r?this._setCornerCursor(r,t):this.setCursor(t.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(t,n){if(t in e)this.setCursor(this._getRotatedCornerCursor(t,n));else{if(t!=="mtr"||!n.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(t,n){var r=Math.round(n.getAngle()%360/45);return r<0&&(r+=8),r+=e[t],r%=8,this.cursorMap[r]}})}(),function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,t){var n=this.getActiveObject();return e.shiftKey&&(this.getActiveGroup()||n&&n!==t)&&this.selection},_handleGrouping:function(e,t){if(t===this.getActiveGroup()){t=this.findTarget(e,!0);if(!t||t.isType("group"))return}this.getActiveGroup()?this._updateActiveGroup(t,e):this._createActiveGroup(t,e),this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(e,t){var n=this.getActiveGroup();if(n.contains(e)){n.removeWithUpdate(e),this._resetObjectTransform(n),e.set("active",!1);if(n.size()===1){this.discardActiveGroup(t),this.setActiveObject(n.item(0));return}}else n.addWithUpdate(e),this._resetObjectTransform(n);this.fire("selection:created",{target:n,e:t}),n.set("active",!0)},_createActiveGroup:function(e,t){if(this._activeObject&&e!==this._activeObject){var n=this._createGroup(e
);n.addWithUpdate(),this.setActiveGroup(n),this._activeObject=null,this.fire("selection:created",{target:n,e:t})}e.set("active",!0)},_createGroup:function(e){var t=this.getObjects(),n=t.indexOf(this._activeObject)<t.indexOf(e),r=n?[this._activeObject,e]:[e,this._activeObject];return new fabric.Group(r,{canvas:this})},_groupSelectedObjects:function(e){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],e):t.length>1&&(t=new fabric.Group(t.reverse(),{canvas:this}),t.addWithUpdate(),this.setActiveGroup(t,e),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){var n=[],r,i=this._groupSelector.ex,s=this._groupSelector.ey,o=i+this._groupSelector.left,u=s+this._groupSelector.top,a=new fabric.Point(e(i,o),e(s,u)),f=new fabric.Point(t(i,o),t(s,u)),l=i===o&&s===u;for(var c=this._objects.length;c--;){r=this._objects[c];if(!r||!r.selectable||!r.visible)continue;if(r.intersectsWithRect(a,f)||r.isContainedWithinRect(a,f)||r.containsPoint(a)||r.containsPoint(f)){r.set("active",!0),n.push(r);if(l)break}}return n},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",n=e.quality||1,r=e.multiplier||1,i={left:e.left,top:e.top,width:e.width,height:e.height};return r!==1?this.__toDataURLWithMultiplier(t,n,i,r):this.__toDataURL(t,n,i)},__toDataURL:function(e,t,n){this.renderAll(!0);var r=this.upperCanvasEl||this.lowerCanvasEl,i=this.__getCroppedCanvas(r,n);e==="jpg"&&(e="jpeg");var s=fabric.StaticCanvas.supports("toDataURLWithQuality")?(i||r).toDataURL("image/"+e,t):(i||r).toDataURL("image/"+e);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),i&&(i=null),s},__getCroppedCanvas:function(e,t){var n,r,i="left"in t||"top"in t||"width"in t||"height"in t;return i&&(n=fabric.util.createCanvasElement(),r=n.getContext("2d"),n.width=t.width||this.width,n.height=t.height||this.height,r.drawImage(e,-t.left||0,-t.top||0)),n},__toDataURLWithMultiplier:function(e,t,n,r){var i=this.getWidth(),s=this.getHeight(),o=i*r,u=s*r,a=this.getActiveObject(),f=this.getActiveGroup(),l=this.contextTop||this.contextContainer;r>1&&this.setWidth(o).setHeight(u),l.scale(r,r),n.left&&(n.left*=r),n.top&&(n.top*=r),n.width?n.width*=r:r<1&&(n.width=o),n.height?n.height*=r:r<1&&(n.height=u),f?this._tempRemoveBordersControlsFromGroup(f):a&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var c=this.__toDataURL(e,t,n);return this.width=i,this.height=s,l.scale(1/r,1/r),this.setWidth(i).setHeight(s),f?this._restoreBordersControlsOnGroup(f):a&&this.setActiveObject&&this.setActiveObject(a),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),c},toDataURLWithMultiplier:function(e,t,n){return this.toDataURL({format:e,multiplier:t,quality:n})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls,e.origBorderColor=e.borderColor,e.hasControls=!0,e.borderColor="rgba(0,0,0,0)",e.forEachObject(function(e){e.origBorderColor=e.borderColor,e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls,e.borderColor=e.origBorderColor,e.forEachObject(function(e){e.borderColor=e.origBorderColor,delete e.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,t,n){return this.loadFromJSON(e,t,n)},loadFromJSON:function(e,t,n){if(!e)return;var r=typeof e=="string"?JSON.parse(e):e;this.clear();var i=this;return this._enlivenObjects(r.objects,function(){i._setBgOverlay(r,t)},n),this},_setBgOverlay:function(e,t){var n=this,r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var i=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(n.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,i),this.__setBgOverlay("overlayImage",e.overlayImage,r,i),this.__setBgOverlay("backgroundColor",e.background,r,i),this.__setBgOverlay("overlayColor",e.overlay,r,i),i()},__setBgOverlay:function(e,t,n,r){var i=this;if(!t){n[e]=!0;return}e==="backgroundImage"||e==="overlayImage"?fabric.Image.fromObject(t,function(t){i[e]=t,n[e]=!0,r&&r()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){n[e]=!0,r&&r()})},_enlivenObjects:function(e,t,n){var r=this;if(!e||e.length===0){t&&t();return}var i=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(e,function(e){e.forEach(function(e,t){r.insertAt(e,t,!0)}),r.renderOnAddRemove=i,t&&t()},null,n)},_toDataURL:function(e,t){this.clone(function(n){t(n.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,n){this.clone(function(r){n(r.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var n=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(n,function(){e&&e(t)})})},cloneWithoutData:function(e){var t=fabric.document.createElement("canvas");t.width=this.getWidth(),t.height=this.getHeight();var n=new fabric.Canvas(t);n.clipTo=this.clipTo,this.backgroundImage?(n.setBackgroundImage(this.backgroundImage.src,function(){n.renderAll(),e&&e(n)}),n.backgroundImageOpacity=this.backgroundImageOpacity,n.backgroundImageStretch=this.backgroundImageStretch):e&&e(n)}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.toFixed,i=t.util.string.capitalize,s=t.util.degreesToRadians,o=t.StaticCanvas.supports("setLineDash");if(t.Object)return;t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(e){e&&this.setOptions(e)},_initGradient:function(e){e.fill&&e.fill.colorStops&&!(e.fill instanceof t.Gradient)&&this.set("fill",new t.Gradient(e.fill))},_initPattern:function(e){e.fill&&e.fill.source&&!(e.fill instanceof t.Pattern)&&this.set("fill",new t.Pattern(e.fill)),e.stroke&&e.stroke.source&&!(e.stroke instanceof t.Pattern)&&this.set("stroke",new t.Pattern(e.stroke))},_initClipping:function(e){if(!e.clipTo||typeof e.clipTo!="string")return;var n=t.util.getFunctionBody(e.clipTo);typeof n!="undefined"&&(this.clipTo=new Function("ctx",n))},setOptions:function(e){for(var t in e)this.set(t,e[t]);this._initGradient(e),this._initPattern(e),this._initClipping(e)},transform:function(e,t){var n=t?this._getLeftTopCoords():this.getCenterPoint();e.translate(n.x,n.y),e.rotate(s(this.angle)),e.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(e){var n=t.Object.NUM_FRACTION_DIGITS,i={type:this.type,originX:this.originX,originY:this.originY,left:r(this.left,n),top:r(this.top,n),width:r(this.width,n),height:r(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,n),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,n),scaleX:r(this.scaleX,n),scaleY:r(this.scaleY,n),angle:r(this.getAngle(),n),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,n),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(i=this._removeDefaultValues(i)),t.util.populateWithProperties(this,i,e),i},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var n=t.util.getKlass(e.type).prototype,r=n.stateProperties;return r.forEach(function(t){e[t]===n[t]&&delete e[t]}),e},toString:function(){return"#<fabric."+i(this.type)+">"},get:function(e){return this[e]},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):typeof t=="function"&&e!=="clipTo"?this._set(e,t(this.get(e))):this._set(e,t),this},_set:function(e,n){var i=e==="scaleX"||e==="scaleY";return i&&(n=this._constrainScale(n)),e==="scaleX"&&n<0?(this.flipX=!this.flipX,n*=-1):e==="scaleY"&&n<0?(this.flipY=!this.flipY,n*=-1):e==="width"||e==="height"?this.minScaleLimit=r(Math.min(.1,1/Math.max(this.width,this.height)),2):e==="shadow"&&n&&!(n instanceof t.Shadow)&&(n=new t.Shadow(n)),this[e]=n,this},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},setSourcePath:function(e){return this.sourcePath=e,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(e,n){if(this.width===0&&this.height===0||!this.visible)return;e.save(),this._setupCompositeOperation(e),n||this.transform(e),this._setStrokeStyles(e),this._setFillStyles(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._setOpacity(e),this._setShadow(e),this.clipTo&&t.util.clipContext(this,e),this._render(e,n),this.clipTo&&e.restore(),this._removeShadow(e),this._restoreCompositeOperation(e),e.restore()},_setOpacity:function(e){this.group&&this.group._setOpacity(e),e.globalAlpha*=this.opacity},_setStrokeStyles:function(e){this.stroke&&(e.lineWidth=this.strokeWidth,e.lineCap=this.strokeLineCap,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,e.strokeStyle=this.stroke.toLive?this.stroke.toLive(e,this):this.stroke)},_setFillStyles:function(e){this.fill&&(e.fillStyle=this.fill.toLive?this.fill.toLive(e,this):this.fill)},_renderControls:function(e,n){if(!this.active||n)return;var r=this.getViewportTransform();e.save();var i;this.group&&(i=t.util.transformPoint(this.group.getCenterPoint(),r),e.translate(i.x,i.y),e.rotate(s(this.group.angle))),i=t.util.transformPoint(this.getCenterPoint(),r,null!=this.group),this.group&&(i.x*=this.group.scaleX,i.y*=this.group.scaleY),e.translate(i.x,i.y),e.rotate(s(this.angle)),this.drawBorders(e),this.drawControls(e),e.restore()},_setShadow:function(e){if(!this.shadow)return;var t=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1;e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*(t+n)*(this.scaleX+this.scaleY)/4,e.shadowOffsetX=this.shadow.offsetX*t*this.scaleX,e.shadowOffsetY=this.shadow.offsetY*n*this.scaleY},_removeShadow:function(e){if(!this.shadow)return;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_renderFill:function(e){if(!this.fill)return;e.save();if(this.fill.gradientTransform){var t=this.fill.gradientTransform;e.transform.apply(e,t)}this.fill.toLive&&e.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e)},_renderStroke:function(e){if(!this.stroke||this.strokeWidth===0)return;e.save();if(this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),o?(e.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(e)):this._renderDashedStroke&&this._renderDashedStroke(e),e.stroke();else{if(this.stroke.gradientTransform){var t=this.stroke.gradientTransform;e.transform.apply(e,t)}this._stroke?this._stroke(e):e.stroke()}this._removeShadow(e),e.restore()},clone:function(e,n){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(n),e):new t.Object(this.toObject(n))},cloneAsImage:function(e){var n=this.toDataURL();return t.util.loadImage(n,function(n){e&&e(new t.Image(n))}),this},toDataURL:function(e){e||(e={});var n=t.util.createCanvasElement(),r=this.getBoundingRect();n.width=r.width,n.height=r.height,t.util.wrapElement(n,"div");var i=new t.StaticCanvas(n);e.format==="jpg"&&(e.format="jpeg"),e.format==="jpeg"&&(i.backgroundColor="#fff");var s={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new t.Point(n.width/2,n.height/2),"center","center");var o=this.canvas;i.add(this);var u=i.toDataURL(e);return this.set(s).setCoords(),this.canvas=o,i.dispose(),i=null,u},isType:function(e){return this.type===e},complexity:function(){return 0},toJSON:function(e){return this.toObject(e)},setGradient:function(e,n){n||(n={});var r={colorStops:[]};r.type=n.type||(n.r1||n.r2?"radial":"linear"),r.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2};if(n.r1||n.r2)r.coords.r1=n.r1,r.coords.r2=n.r2;for(var i in n.colorStops){var s=new t.Color(n.colorStops[i]);r.colorStops.push({offset:i,color:s.toRgb(),opacity:s.getAlpha()})}return this.set(e,t.Gradient.forObject(this,r))},setPatternFill:function(e){return this.set("fill",new t.Pattern(e))},setShadow:function(e){return this.set("shadow",e?new t.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},setAngle:function(e){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(e,t){t=t||this.canvas.getPointer(e);var n=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-n.x,y:t.y-n.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=e.globalCompositeOperation,e.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(e){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(e.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,n(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0}(typeof exports!="undefined"?exports:this),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,n,r){var i=t.x,s=t.y,o=this.stroke?this.strokeWidth:0;return n==="left"?i=t.x+(this.getWidth()+o*this.scaleX)/2:n==="right"&&(i=t.x-(this.getWidth()+o*this.scaleX)/2),r==="top"?s=t.y+(this.getHeight()+o*this.scaleY)/2:r==="bottom"&&(s=t.y-(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},translateToOriginPoint:function(t,n,r){var i=t.x,s=t.y,o=this.stroke?this.strokeWidth:0;return n==="left"?i=t.x-(this.getWidth()+o*this.scaleX)/2:n==="right"&&(i=t.x+(this.getWidth()+o*this.scaleX)/2),r==="top"?s=t.y-(this.getHeight()+o*this.scaleY)/2:r==="bottom"&&(s=t.y+(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var n=this.getCenterPoint();return this.translateToOriginPoint(n,e,t)},toLocalPoint:function(t,n,r){var i=this.getCenterPoint(),s=this.stroke?this.strokeWidth:0,o,u;return n&&r?(n==="left"?o=i.x-(this.getWidth()+s*this.scaleX)/2:n==="right"?o=i.x+(this.getWidth()+s*this.scaleX)/2:o=i.x,r==="top"?u=i.y-(this.getHeight()+s*this.scaleY)/2:r==="bottom"?u=i.y+(this.getHeight()+s*this.scaleY)/2:u=i.y):(o=this.left,u=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),i,-e(this.angle)).subtractEquals(new fabric.Point(o,u))},setPositionByOrigin:function(e,t,n){var r=this.translateToCenterPoint(e,t,n),i=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(t){var n=e(this.angle),r=this.getWidth()/2,i=Math.cos(n)*r,s=Math.sin(n)*r,o=this.getWidth(),u=Math.cos(n)*o,a=Math.sin(n)*o;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=i,this.top-=s):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=i,this.top+=s):this.originX==="left"&&t==="right"?(this.left+=u,this.top+=a):this.originX==="right"&&t==="left"&&(this.left-=u,this.top-=a),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,t){var n=this.oCoords,r=new fabric.Point(n.tl.x,n.tl.y),i=new fabric.Point(n.tr.x,n.tr.y),s=new fabric.Point(n.bl.x,n.bl.y),o=new fabric.Point(n.br.x,n.br.y),u=fabric.Intersection.intersectPolygonRectangle([r,i,o,s],e,t);return u.status==="Intersection"},intersectsWithObject:function(e){function t(e){return{tl:new fabric.Point(e.tl.x,e.tl.y),tr:new fabric.Point(e.tr.x,e.tr.y),bl:new fabric.Point(e.bl.x,e.bl.y),br:new fabric.Point(e.br.x,e.br.y)}}var n=t(this.oCoords),r=t(e.oCoords),i=fabric.Intersection.intersectPolygonPolygon([n.tl,n.tr,n.br,n.bl],[r.tl,r.tr,r.br,r.bl]);return i.status==="Intersection"},isContainedWithinObject:function(e){var t=e.getBoundingRect(),n=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(n,r)},isContainedWithinRect:function(e,t){var n=this.getBoundingRect();return n.left>=e.x&&n.left+n.width<=t.x&&n.top>=e.y&&n.top+n.height<=t.y},containsPoint:function(e){var t=this._getImageLines(this.oCoords),n=this._findCrossPoints(e,t);return n!==0&&n%2===1},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var n,r,i,s,o,u,a=0,f;for(var l in t){f=t[l];if(f.o.y<e.y&&f.d.y<e.y)continue;if(f.o.y>=e.y&&f.d.y>=e.y)continue;f.o.x===f.d.x&&f.o.x>=e.x?(o=f.o.x,u=e.y):(n=0,r=(f.d.y-f.o.y)/(f.d.x-f.o.x),i=e.y-n*e.x,s=f.o.y-r*f.o.x,o=-(i-s)/(n-r),u=i+n*o),o>=e.x&&(a+=1);if(a===2)break}return a},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(e),n=fabric.util.array.max(e),r=Math.abs(t-n),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],s=fabric.util.array.min(i),o=fabric.util.array.max(i),u=Math.abs(s-o);return{left:t,top:s,width:r,height:u}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e},scale:function(e){return e=this._constrainScale(e),e<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,e*=-1),this.scaleX=e,this.scaleY=e,this.setCoords(),this},scaleToWidth:function(e){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(e/this.width/t)},scaleToHeight:function(e){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/t)},setCoords:function(){var t=e(this.angle),n=this.getViewportTransform(),r=function(e){return fabric.util.transformPoint(e,n)},i=this._calculateCurrentDimensions(!1),s=i.x,o=i.y;s<0&&(s=Math.abs(s));var u=Math.sqrt(Math.pow(s/2,2)+Math.pow(o/2,2)),a=Math.atan(isFinite(o/s)?o/s:0),f=Math.cos(a+t)*u,l=Math.sin(a+t)*u,c=Math.sin(t),h=Math.cos(t),p=this.getCenterPoint(),d=new fabric.Point(s,o),v=new fabric.Point(p.x-f,p.y-l),m=new fabric.Point(v.x+d.x*h,v.y+d.x*c),g=r(new fabric.Point(v.x-d.y*c,v.y+d.y*h)),y=r(new fabric.Point(m.x-d.y*c,m.y+d.y*h)),b=r(v),w=r(m),E=new fabric.Point((b.x+g.x)/2,(b.y+g.y)/2),S=new fabric.Point((w.x+b.x)/2,(w.y+b.y)/2),x=new fabric.Point((y.x+w.x)/2,(y.y+w.y)/2),T=new fabric.Point((y.x+g.x)/2,(y.y+g.y)/2),N=new fabric.Point(S.x+c*this.rotatingPointOffset,S.y-h*this.rotatingPointOffset);return this.oCoords={tl:b,tr:w,br:y,bl:g,ml:E,mt:S,mr:x,mb:T,mtr:N},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var e=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.fillRule,n=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",r=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"",s=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",u=this.strokeMiterLimit?this.strokeMiterLimit:"4",a=typeof this.opacity!="undefined"?this.opacity:"1",f=this.visible?"":" visibility: hidden;",l=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",n,"; ","stroke-width: ",r,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",s,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",u,"; ","fill: ",e,"; ","fill-rule: ",t,"; ","opacity: ",a,";",l,f].join("")},getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var e=fabric.util.toFixed,t=this.getAngle(),n=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],r=fabric.util.transformPoint(this.getCenterPoint(),n),i=fabric.Object.NUM_FRACTION_DIGITS,s=this.type==="path-group"?"":"translate("+e(r.x,i)+" "+e(r.y,i)+")",o=t!==0?" rotate("+e(t,i)+")":"",u=this.scaleX===1&&this.scaleY===1&&n[0]===1&&n[3]===1?"":" scale("+e(this.scaleX*n[0],i)+" "+e(this.scaleY*n[3],i)+")",a=this.type==="path-group"?this.width*n[0]:0,f=this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",l=this.type==="path-group"?this.height*n[3]:0,c=this.flipY?" matrix(1 0 0 -1 0 "+l+")":"";return[s,o,u,f,c].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var e=[];return this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1)),this.shadow&&e.push(this.shadow.toSVG(this)),e}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){return this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this),e&&e.stateProperties&&e.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var e=fabric.util.degreesToRadians,t=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||!this.active)return!1;var t=e.x,n=e.y,r,i;for(var s in this.oCoords){if(!this.isControlVisible(s))continue;if(s==="mtr"&&!this.hasRotatingPoint)continue;if(!(!this.get("lockUniScaling")||s!=="mt"&&s!=="mr"&&s!=="mb"&&s!=="ml"))continue;i=this._getImageLines(this.oCoords[s].corner),r=this._findCrossPoints({x:t,y:n},i);if(r!==0&&r%2===1)return this.__corner=s,s}return!1},_setCornerCoords:function(){var t=this.oCoords,n=e(45-this.angle),r=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,i=r*Math.cos(n),s=r*Math.sin(n),o,u;for(var a in t)o=t[a].x,u=t[a].y,t[a].corner={tl:{x:o-s,y:u-i},tr:{x:o+i,y:u-s},bl:{x:o-i,y:u+s},br:{x:o+s,y:u+i}}},_calculateCurrentDimensions:function(e){var t=this.getViewportTransform(),n=this.strokeWidth,r=this.width,i=this.height,s=this.strokeLineCap==="round"||this.strokeLineCap==="square",o=this.type==="line"&&this.width===0,u=this.type==="line"&&this.height===0,a=o||u,f=s&&u||!a,l=s&&o||!a;return o?r=n:u&&(i=n),f&&(r+=r<0?-n:n),l&&(i+=i<0?-n:n),r=r*this.scaleX+2*this.padding,i=i*this.scaleY+2*this.padding,e?fabric.util.transformPoint(new fabric.Point(r,i),t,!0):{x:r,y:i}},drawBorders:function(e){if(!this.hasBorders)return this;e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,e.strokeStyle=this.borderColor,e.lineWidth=1/this.borderScaleFactor;var t=this._calculateCurrentDimensions(!0),n=t.x,r=t.y;this.group&&(n*=this.group.scaleX,r*=this.group.scaleY),e.strokeRect(~~-(n/2)-.5,~~-(r/2)-.5,~~n+1,~~r+1);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var i=-r/2;e.beginPath(),e.moveTo(0,i),e.lineTo(0,i-this.rotatingPointOffset),e.closePath(),e.stroke()}return e.restore(),this},drawControls:function(e){if(!this.hasControls)return this;var t=this._calculateCurrentDimensions(!0),n=t.x,r=t.y,i=-(n/2),s=-(r/2),o=this.cornerSize/2,u=this.transparentCorners?"strokeRect":"fillRect";return e.save(),e.lineWidth=1,e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,e.strokeStyle=e.fillStyle=this.cornerColor,this._drawControl("tl",e,u,i-o,s-o),this._drawControl("tr",e,u,i+n-o,s-o),this._drawControl("bl",e,u,i-o,s+r-o),this._drawControl("br",e,u,i+n-o,s+r-o),this.get("lockUniScaling")||(this._drawControl("mt",e,u,i+n/2-o,s-o),this._drawControl("mb",e,u,i+n/2-o,s+r-o),this._drawControl("mr",e,u,i+n-o,s+r/2-o),this._drawControl("ml",e,u,i-o,s+r/2-o)),this.hasRotatingPoint&&this._drawControl("mtr",e,u,i+n/2-o,s-this.rotatingPointOffset-o),e.restore(),this},_drawControl:function(e,n,r,i,s){if(!this.isControlVisible(e))return;var o=this.cornerSize;t()||this.transparentCorners||n.clearRect(i,s,o,o),n[r](i,s,o,o)},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,t){return this._getControlsVisibility()[e]=t,this},setControlsVisibility:function(e){e||(e={});for(var t in e)this.setControlVisible(t,e[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),s.renderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxCenterObjectV:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),s.renderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxRemove:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(t){e.set("opacity",t),s.renderAll(),i()},onComplete:function(){s.remove(e),r()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,n;for(t in arguments[0])e.push(t);for(var r=0,i=e.length;r<i;r++)t=e[r],n=r!==i-1,this._animate(t,arguments[0][t],arguments[1],n)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,n,r){var i=this,s;t=t.toString(),n?n=fabric.util.object.clone(n):n={},~e.indexOf(".")&&(s=e.split("."));var o=s?this.get(s[0])[s[1]]:this.get(e);"from"in n||(n.from=o),~t.indexOf("=")?t=o+parseFloat(t.replace("=","")):t=parseFloat(t),fabric.util.animate({startValue:n.from,endValue:t,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(){return n.abort.call(i)},onChange:function(t){s?i[s[0]][s[1]]=t:i.set(e,t);if(r)return;n.onChange&&n.onChange()},onComplete:function(){if(r)return;i.setCoords(),n.onComplete&&n.onComplete()}})}}),function(e){"use strict";function s(e,t){var n=e.origin,r=e.axis1,i=e.axis2,s=e.dimension,o=t.nearest,u=t.center,a=t.farthest;return function(){switch(this.get(n)){case o:return Math.min(this.get(r),this.get(i));case u:return Math.min(this.get(r),this.get(i))+.5*this.get(s);case a:return Math.max(this.get(r),this.get(i))}}}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},i=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(e,t){t=t||{},e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),typeof r[e]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e,t){e.beginPath();if(t){var n=this.getCenterPoint();e.translate(n.x-this.strokeWidth/2,n.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&i){var r=this.calcLinePoints();e.moveTo(r.x1,r.y1),e.lineTo(r.x2,r.y2)}e.lineWidth=this.strokeWidth;var s=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=s},_renderDashedStroke:function(e){var n=this.calcLinePoints();e.beginPath(),t.util.drawDashedLine(e,n.x1,n.y1,n.x2,n.y2,this.strokeDashArray),e.closePath()},toObject:function(e){return n(this.callSuper("toObject",e),this.calcLinePoints())},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,n=e*this.width*.5,r=t*this.height*.5,i=e*this.width*-0.5,s=t*this.height*-0.5;return{x1:n,x2:i,y1:r,y2:s}},toSVG:function(e){var t=this._createBaseSVGMarkup(),n={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(!this.group||this.group.type!=="path-group")n=this.calcLinePoints();return t.push("<line ",'x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform
(),this.getSvgTransformMatrix(),'"/>\n'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,r){var i=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES),s=[i.x1||0,i.y1||0,i.x2||0,i.y2||0];return new t.Line(s,n(i,r))},t.Line.fromObject=function(e){var n=[e.x1,e.y1,e.x2,e.y2];return new t.Line(n,e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";function i(e){return"radius"in e&&e.radius>=0}var t=e.fabric||(e.fabric={}),n=Math.PI,r=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:n*2,initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("radius",e.radius||0),this.startAngle=e.startAngle||this.startAngle,this.endAngle=e.endAngle||this.endAngle},_set:function(e,t){return this.callSuper("_set",e,t),e==="radius"&&this.setRadius(t),this},toObject:function(e){return r(this.callSuper("toObject",e),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(e){var t=this._createBaseSVGMarkup(),r=0,i=0,s=(this.endAngle-this.startAngle)%(2*n);if(s===0)this.group&&this.group.type==="path-group"&&(r=this.left+this.radius,i=this.top+this.radius),t.push("<circle ",'cx="'+r+'" cy="'+i+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var o=Math.cos(this.startAngle)*this.radius,u=Math.sin(this.startAngle)*this.radius,a=Math.cos(this.endAngle)*this.radius,f=Math.sin(this.endAngle)*this.radius,l=s>n?"1":"0";t.push('<path d="M '+o+" "+u," A "+this.radius+" "+this.radius," 0 ",+l+" 1"," "+a+" "+f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return e?e(t.join("")):t.join("")},_render:function(e,t){e.beginPath(),e.arc(t?this.left+this.radius:0,t?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(e),this._renderStroke(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e,this.set("width",e*2).set("height",e*2)},complexity:function(){return 1}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,n){n||(n={});var s=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!i(s))throw new Error("value of `r` attribute is required and can not be negative");s.left=s.left||0,s.top=s.top||0;var o=new t.Circle(r(s,n));return o.left-=o.radius,o.top-=o.radius,o},t.Circle.fromObject=function(e){return new t.Circle(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("width",e.width||100).set("height",e.height||100)},_render:function(e){var t=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-t,n),e.lineTo(0,-n),e.lineTo(t,n),e.closePath(),this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n=this.width/2,r=this.height/2;e.beginPath(),t.util.drawDashedLine(e,-n,r,0,-r,this.strokeDashArray),t.util.drawDashedLine(e,0,-r,n,r,this.strokeDashArray),t.util.drawDashedLine(e,n,r,-n,r,this.strokeDashArray),e.closePath()},toSVG:function(e){var t=this._createBaseSVGMarkup(),n=this.width/2,r=this.height/2,i=[-n+" "+r,"0 "+ -r,n+" "+r].join(",");return t.push("<polygon ",'points="',i,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Triangle.fromObject=function(e){return new t.Triangle(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=Math.PI*2,r=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("rx",e.rx||0),this.set("ry",e.ry||0)},_set:function(e,t){this.callSuper("_set",e,t);switch(e){case"rx":this.rx=t,this.set("width",t*2);break;case"ry":this.ry=t,this.set("height",t*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return r(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(e){var t=this._createBaseSVGMarkup(),n=0,r=0;return this.group&&this.group.type==="path-group"&&(n=this.left+this.rx,r=this.top+this.ry),t.push("<ellipse ",'cx="',n,'" cy="',r,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),e?e(t.join("")):t.join("")},_render:function(e,t){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(t?this.left+this.rx:0,t?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,n,!1),e.restore(),this._renderFill(e),this._renderStroke(e)},complexity:function(){return 1}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,n){n||(n={});var i=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0;var s=new t.Ellipse(r(i,n));return s.top-=s.ry,s.left-=s.rx,s},t.Ellipse.fromObject=function(e){return new t.Ellipse(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;if(t.Rect){console.warn("fabric.Rect is already defined");return}var r=t.Object.prototype.stateProperties.concat();r.push("rx","ry","x","y"),t.Rect=t.util.createClass(t.Object,{stateProperties:r,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(e){e=e||{},this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e,t){if(this.width===1&&this.height===1){e.fillRect(0,0,1,1);return}var n=this.rx?Math.min(this.rx,this.width/2):0,r=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,s=this.height,o=t?this.left:-this.width/2,u=t?this.top:-this.height/2,a=n!==0||r!==0,f=.4477152502;e.beginPath(),e.moveTo(o+n,u),e.lineTo(o+i-n,u),a&&e.bezierCurveTo(o+i-f*n,u,o+i,u+f*r,o+i,u+r),e.lineTo(o+i,u+s-r),a&&e.bezierCurveTo(o+i,u+s-f*r,o+i-f*n,u+s,o+i-n,u+s),e.lineTo(o+n,u+s),a&&e.bezierCurveTo(o+f*n,u+s,o,u+s-f*r,o,u+s-r),e.lineTo(o,u+r),a&&e.bezierCurveTo(o,u+f*r,o+f*n,u,o+n,u),e.closePath(),this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n=-this.width/2,r=-this.height/2,i=this.width,s=this.height;e.beginPath(),t.util.drawDashedLine(e,n,r,n+i,r,this.strokeDashArray),t.util.drawDashedLine(e,n+i,r,n+i,r+s,this.strokeDashArray),t.util.drawDashedLine(e,n+i,r+s,n,r+s,this.strokeDashArray),t.util.drawDashedLine(e,n,r+s,n,r,this.strokeDashArray),e.closePath()},toObject:function(e){var t=n(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(e){var t=this._createBaseSVGMarkup(),n=this.left,r=this.top;if(!this.group||this.group.type!=="path-group")n=-this.width/2,r=-this.height/2;return t.push("<rect ",'x="',n,'" y="',r,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,r){if(!e)return null;r=r||{};var i=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0;var s=new t.Rect(n(r?t.util.object.clone(r):{},i));return s.visible=s.width>0&&s.height>0,s},t.Rect.fromObject=function(e){return new t.Rect(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(e,n){return t.Polygon.prototype.initialize.call(this,e,n)},_calcDimensions:function(){return t.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return t.Polygon.prototype._applyPointOffset.call(this)},toObject:function(e){return t.Polygon.prototype.toObject.call(this,e)},toSVG:function(e){return t.Polygon.prototype.toSVG.call(this,e)},_render:function(e){if(!t.Polygon.prototype.commonRender.call(this,e))return;this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n,r;e.beginPath();for(var i=0,s=this.points.length;i<s;i++)n=this.points[i],r=this.points[i+1]||n,t.util.drawDashedLine(e,n.x,n.y,r.x,r.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElement=function(e,n){if(!e)return null;n||(n={});var r=t.parsePointsAttribute(e.getAttribute("points")),i=t.parseAttributes(e,t.Polyline.ATTRIBUTE_NAMES);return new t.Polyline(r,t.util.object.extend(i,n))},t.Polyline.fromObject=function(e){var n=e.points;return new t.Polyline(n,e,!0)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t),this._calcDimensions(),"top"in t||(this.top=this.minY),"left"in t||(this.left=this.minX)},_calcDimensions:function(){var e=this.points,t=r(e,"x"),n=r(e,"y"),s=i(e,"x"),o=i(e,"y");this.width=s-t||0,this.height=o-n||0,this.minX=t||0,this.minY=n||0},_applyPointOffset:function(){this.points.forEach(function(e){e.x-=this.minX+this.width/2,e.y-=this.minY+this.height/2},this)},toObject:function(e){return n(this.callSuper("toObject",e),{points:this.points.concat()})},toSVG:function(e){var t=[],n=this._createBaseSVGMarkup();for(var r=0,i=this.points.length;r<i;r++)t.push(s(this.points[r].x,2),",",s(this.points[r].y,2)," ");return n.push("<",this.type," ",'points="',t.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),e?e(n.join("")):n.join("")},_render:function(e){if(!this.commonRender(e))return;this._renderFill(e);if(this.stroke||this.strokeDashArray)e.closePath(),this._renderStroke(e)},commonRender:function(e){var t,n=this.points.length;if(!n||isNaN(this.points[n-1].y))return!1;e.beginPath(),this._applyPointOffset&&((!this.group||this.group.type!=="path-group")&&this._applyPointOffset(),this._applyPointOffset=null),e.moveTo(this.points[0].x,this.points[0].y);for(var r=0;r<n;r++)t=this.points[r],e.lineTo(t.x,t.y);return!0},_renderDashedStroke:function(e){t.Polyline.prototype._renderDashedStroke.call(this,e),e.closePath()},complexity:function(){return this.points.length}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=function(e,r){if(!e)return null;r||(r={});var i=t.parsePointsAttribute(e.getAttribute("points")),s=t.parseAttributes(e,t.Polygon.ATTRIBUTE_NAMES);return new t.Polygon(i,n(s,r))},t.Polygon.fromObject=function(e){return new t.Polygon(e.points,e,!0)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.array.min,r=t.util.array.max,i=t.util.object.extend,s=Object.prototype.toString,o=t.util.drawArc,u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(e,t){t=t||{},this.setOptions(t);if(!e)throw new Error("`path` argument is required");var n=s.call(e)==="[object Array]";this.path=n?e:e.match&&e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path)return;n||(this.path=this._parsePath()),this._setPositionDimensions(),t.sourcePath&&this.setSourcePath(t.sourcePath)},_setPositionDimensions:function(){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,e.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0,e.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0,this.top=this.top||e.top,this.left=this.left||e.left,this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(e){var t,n=null,r=0,i=0,s=0,u=0,a=0,f=0,l,c,h=-this.pathOffset.x,p=-this.pathOffset.y;this.group&&this.group.type==="path-group"&&(h=0,p=0),e.beginPath();for(var d=0,v=this.path.length;d<v;++d){t=this.path[d];switch(t[0]){case"l":s+=t[1],u+=t[2],e.lineTo(s+h,u+p);break;case"L":s=t[1],u=t[2],e.lineTo(s+h,u+p);break;case"h":s+=t[1],e.lineTo(s+h,u+p);break;case"H":s=t[1],e.lineTo(s+h,u+p);break;case"v":u+=t[1],e.lineTo(s+h,u+p);break;case"V":u=t[1],e.lineTo(s+h,u+p);break;case"m":s+=t[1],u+=t[2],r=s,i=u,e.moveTo(s+h,u+p);break;case"M":s=t[1],u=t[2],r=s,i=u,e.moveTo(s+h,u+p);break;case"c":l=s+t[5],c=u+t[6],a=s+t[3],f=u+t[4],e.bezierCurveTo(s+t[1]+h,u+t[2]+p,a+h,f+p,l+h,c+p),s=l,u=c;break;case"C":s=t[5],u=t[6],a=t[3],f=t[4],e.bezierCurveTo(t[1]+h,t[2]+p,a+h,f+p,s+h,u+p);break;case"s":l=s+t[3],c=u+t[4],n[0].match(/[CcSs]/)===null?(a=s,f=u):(a=2*s-a,f=2*u-f),e.bezierCurveTo(a+h,f+p,s+t[1]+h,u+t[2]+p,l+h,c+p),a=s+t[1],f=u+t[2],s=l,u=c;break;case"S":l=t[3],c=t[4],n[0].match(/[CcSs]/)===null?(a=s,f=u):(a=2*s-a,f=2*u-f),e.bezierCurveTo(a+h,f+p,t[1]+h,t[2]+p,l+h,c+p),s=l,u=c,a=t[1],f=t[2];break;case"q":l=s+t[3],c=u+t[4],a=s+t[1],f=u+t[2],e.quadraticCurveTo(a+h,f+p,l+h,c+p),s=l,u=c;break;case"Q":l=t[3],c=t[4],e.quadraticCurveTo(t[1]+h,t[2]+p,l+h,c+p),s=l,u=c,a=t[1],f=t[2];break;case"t":l=s+t[1],c=u+t[2],n[0].match(/[QqTt]/)===null?(a=s,f=u):(a=2*s-a,f=2*u-f),e.quadraticCurveTo(a+h,f+p,l+h,c+p),s=l,u=c;break;case"T":l=t[1],c=t[2],n[0].match(/[QqTt]/)===null?(a=s,f=u):(a=2*s-a,f=2*u-f),e.quadraticCurveTo(a+h,f+p,l+h,c+p),s=l,u=c;break;case"a":o(e,s+h,u+p,[t[1],t[2],t[3],t[4],t[5],t[6]+s+h,t[7]+u+p]),s+=t[6],u+=t[7];break;case"A":o(e,s+h,u+p,[t[1],t[2],t[3],t[4],t[5],t[6]+h,t[7]+p]),s=t[6],u=t[7];break;case"z":case"Z":s=r,u=i,e.closePath()}n=t}this._renderFill(e),this._renderStroke(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){var t=i(this.callSuper("toObject",e),{path:this.path.map(function(e){return e.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(e){var t=this.toObject(e);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(e){var t=[],n=this._createBaseSVGMarkup(),r="";for(var i=0,s=this.path.length;i<s;i++)t.push(this.path[i].join(" "));var o=t.join(" ");if(!this.group||this.group.type!=="path-group")r=" translate("+ -this.pathOffset.x+", "+ -this.pathOffset.y+") ";return n.push("<path ",'d="',o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),r,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),e?e(n.join("")):n.join("")},complexity:function(){return this.path.length},_parsePath:function(){var e=[],t=[],n,r,i=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,s,o;for(var f=0,l,c=this.path.length;f<c;f++){n=this.path[f],o=n.slice(1).trim(),t.length=0;while(s=i.exec(o))t.push(s[0]);l=[n.charAt(0)];for(var h=0,p=t.length;h<p;h++)r=parseFloat(t[h]),isNaN(r)||l.push(r);var d=l[0],v=u[d.toLowerCase()],m=a[d]||d;if(l.length-1>v)for(var g=1,y=l.length;g<y;g+=v)e.push([d].concat(l.slice(g,g+v))),d=m;else e.push(l)}return e},_parseDimensions:function(){var e=[],i=[],s,o=null,u=0,a=0,f=0,l=0,c=0,h=0,p,d,v;for(var m=0,g=this.path.length;m<g;++m){s=this.path[m];switch(s[0]){case"l":f+=s[1],l+=s[2],v=[];break;case"L":f=s[1],l=s[2],v=[];break;case"h":f+=s[1],v=[];break;case"H":f=s[1],v=[];break;case"v":l+=s[1],v=[];break;case"V":l=s[1],v=[];break;case"m":f+=s[1],l+=s[2],u=f,a=l,v=[];break;case"M":f=s[1],l=s[2],u=f,a=l,v=[];break;case"c":p=f+s[5],d=l+s[6],c=f+s[3],h=l+s[4],v=t.util.getBoundsOfCurve(f,l,f+s[1],l+s[2],c,h,p,d),f=p,l=d;break;case"C":f=s[5],l=s[6],c=s[3],h=s[4],v=t.util.getBoundsOfCurve(f,l,s[1],s[2],c,h,f,l);break;case"s":p=f+s[3],d=l+s[4],o[0].match(/[CcSs]/)===null?(c=f,h=l):(c=2*f-c,h=2*l-h),v=t.util.getBoundsOfCurve(f,l,c,h,f+s[1],l+s[2],p,d),c=f+s[1],h=l+s[2],f=p,l=d;break;case"S":p=s[3],d=s[4],o[0].match(/[CcSs]/)===null?(c=f,h=l):(c=2*f-c,h=2*l-h),v=t.util.getBoundsOfCurve(f,l,c,h,s[1],s[2],p,d),f=p,l=d,c=s[1],h=s[2];break;case"q":p=f+s[3],d=l+s[4],c=f+s[1],h=l+s[2],v=t.util.getBoundsOfCurve(f,l,c,h,c,h,p,d),f=p,l=d;break;case"Q":c=s[1],h=s[2],v=t.util.getBoundsOfCurve(f,l,c,h,c,h,s[3],s[4]),f=s[3],l=s[4];break;case"t":p=f+s[1],d=l+s[2],o[0].match(/[QqTt]/)===null?(c=f,h=l):(c=2*f-c,h=2*l-h),v=t.util.getBoundsOfCurve(f,l,c,h,c,h,p,d),f=p,l=d;break;case"T":p=s[1],d=s[2],o[0].match(/[QqTt]/)===null?(c=f,h=l):(c=2*f-c,h=2*l-h),v=t.util.getBoundsOfCurve(f,l,c,h,c,h,p,d),f=p,l=d;break;case"a":v=t.util.getBoundsOfArc(f,l,s[1],s[2],s[3],s[4],s[5],s[6]+f,s[7]+l),f+=s[6],l+=s[7];break;case"A":v=t.util.getBoundsOfArc(f,l,s[1],s[2],s[3],s[4],s[5],s[6],s[7]),f=s[6],l=s[7];break;case"z":case"Z":f=u,l=a}o=s,v.forEach(function(t){e.push(t.x),i.push(t.y)}),e.push(f),i.push(l)}var y=n(e),b=n(i),w=r(e),E=r(i),S=w-y,x=E-b,T={left:y,top:b,width:S,height:x};return T}}),t.Path.fromObject=function(e,n){typeof e.path=="string"?t.loadSVGFromURL(e.path,function(r){var i=r[0],s=e.path;delete e.path,t.util.object.extend(i,e),i.setSourcePath(s),n(i)}):n(new t.Path(e.path,e))},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,n,r){var s=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);n&&n(new t.Path(s.d,i(s,r)))},t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.invoke,i=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(e,t){t=t||{},this.paths=e||[];for(var n=this.paths.length;n--;)this.paths[n].group=this;t.toBeParsed&&(this.parseDimensionsFromPaths(t),delete t.toBeParsed),this.setOptions(t),this.setCoords(),t.sourcePath&&this.setSourcePath(t.sourcePath)},parseDimensionsFromPaths:function(e){var n,r,i=[],s=[],o,u,a,f=this.transformMatrix;for(var l=this.paths.length;l--;){o=this.paths[l],u=o.height+o.strokeWidth,a=o.width+o.strokeWidth,n=[{x:o.left,y:o.top},{x:o.left+a,y:o.top},{x:o.left,y:o.top+u},{x:o.left+a,y:o.top+u}];for(var c=0;c<n.length;c++)r=n[c],f&&(r=t.util.transformPoint(r,f,!1)),i.push(r.x),s.push(r.y)}e.width=Math.max.apply(null,i),e.height=Math.max.apply(null,s)},render:function(e){if(!this.visible)return;e.save(),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.transform(e),this._setShadow(e),this.clipTo&&t.util.clipContext(this,e),e.translate(-this.width/2,-this.height/2);for(var n=0,r=this.paths.length;n<r;++n)this.paths[n].render(e,!0);this.clipTo&&e.restore(),this._removeShadow(e),e.restore()},_set:function(e,t){if(e==="fill"&&t&&this.isSameColor()){var n=this.paths.length;while(n--)this.paths[n]._set(e,t)}return this.callSuper("_set",e,t)},toObject:function(e){var t=n(i.call(this,e),{paths:r(this.getObjects(),"toObject",e)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(e){var t=this.toObject(e);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(e){var t=this.getObjects(),n=this.getPointByOrigin("left","top"),r="translate("+n.x+" "+n.y+")",i=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),r,this.getSvgTransform(),'" ',">\n"];for(var s=0,o=t.length;s<o;s++)i.push(t[s].toSVG(e));return i.push("</g>\n"),e?e(i.join("")):i.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var e=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(t){return(t.get("fill")||"").toLowerCase()===e})},complexity:function(){return this.paths.reduce(function(e,t){return e+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}}),t.PathGroup.fromObject=function(e,n){typeof e.paths=="string"?t.loadSVGFromURL(e.paths,function(r){var i=e.paths;delete e.paths;var s=t.util.groupSVGElements(r,e,i);n(s)}):t.util.enlivenObjects(e.paths,function(r){delete e.paths,n(new t.PathGroup(r,e))})},t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.array.invoke;if(t.Group)return;var o={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(e,t){t=t||{},this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;this.originalState={},this.callSuper("initialize"),t.originX&&(this.originX=t.originX),t.originY&&(this.originY=t.originY),this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",t),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(e){var t=e.getLeft(),n=e.getTop(),r=this.getCenterPoint();e.set({originalLeft:t,originalTop:n,left:t-r.x,top:n-r.y}),e.setCoords(),e.__origHasControls=e.hasControls,e.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){return this._restoreObjectsState(),e&&(this._objects.push(e),e.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(e){e.set("active",!0),e.group=this},removeWithUpdate:function(e){return this._moveFlippedObject(e),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(e){e.group=this},_onObjectRemoved:function(e){delete e.group,e.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(e,t){if(e in this.delegatedProperties){var n=this._objects.length;while(n--)this._objects[n].set(e,t)}this.callSuper("_set",e,t)},toObject:function(e){return n(this.callSuper("toObject",e),{objects:s(this._objects,"toObject",e)})},render:function(e){if(!this.visible)return;e.save(),this.clipTo&&t.util.clipContext(this,e),this.transform(e);for(var n=0,r=this._objects.length;n<r;n++)this._renderObject(this._objects[n],e);this.clipTo&&e.restore(),e.restore()},_renderControls:function(e,t){this.callSuper("_renderControls",e,t);for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(e)},_renderObject:function(e,t){var n=e.hasRotatingPoint;if(!e.visible)return;e.hasRotatingPoint=!1,e.render(t),e.hasRotatingPoint=n},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(e){return this._moveFlippedObject(e),this._setObjectPosition(e),e},_moveFlippedObject:function(e){var t=e.get("originX"),n=e.get("originY"),r=e.getCenterPoint();e.set({originX:"center",originY:"center",left:r.x,top:r.y}),this._toggleFlipping(e);var i=e.getPointByOrigin(t,n);return e.set({originX:t,originY:n,left:i.x,top:i.y}),this},_toggleFlipping:function(e){this.flipX&&(e.toggle("flipX"),e.set("left",-e.get("left")),e.setAngle(-e.getAngle())),this.flipY&&(e.toggle("flipY"),e.set("top",-e.get("top")),e.setAngle(-e.getAngle()))},_restoreObjectState:function(e){return this._setObjectPosition(e),e.setCoords(),e.hasControls=e.__origHasControls,delete e.__origHasControls,e.set("active",!1),e.setCoords(),delete e.group,this},_setObjectPosition:function(e){var t=this.getCenterPoint(),n=this._getRotatedLeftTop(e);e.set({angle:e.getAngle()+this.getAngle(),left:t.x+n.left,top:t.y+n.top,scaleX:e.get("scaleX")*this.get("scaleX"),scaleY:e.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(e){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*e.getTop()*this.get("scaleY")+Math.cos(t)*e.getLeft()*this.get("scaleX"),top:Math.cos(t)*e.getTop()*this.get("scaleY")+Math.sin(t)*e.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords()}),this},_calcBounds:function(e){var t=[],n=[],r,i,s=["tr","br","bl","tl"];for(var o=0,u=this._objects.length;o<u;++o){r=this._objects[o],r.setCoords();for(var a=0;a<s.length;a++)i=s[a],t.push(r.oCoords[i].x),n.push(r.oCoords[i].y)}this.set(this._getBounds(t,n,e))},_getBounds:function(e,n,s){var o=t.util.invertTransform(this.getViewportTransform()),u=t.util.transformPoint(new t.Point(r(e),r(n)),o),a=t.util.transformPoint(new t.Point(i(e),i(n)),o),f={width:a.x-u.x||0,height:a.y-u.y||0};return s||(f.left=u.x||0,f.top=u.y||0,this.originX==="center"&&(f.left+=f.width/2),this.originX==="right"&&(f.left+=f.width),this.originY==="center"&&(f.top+=f.height/2),this.originY==="bottom"&&(f.top+=f.height)),f},toSVG:function(e){var t=["<g ",'transform="',this.getSvgTransform(),'">\n'];for(var n=0,r=this._objects.length;n<r;n++)t.push(this._objects[n].toSVG(e));return t.push("</g>\n"),e?e(t.join("")):t.join("")},get:function(e){if(e in o){if(this[e])return this[e];for(var t=0,n=this._objects.length;t<n;t++)if(this._objects[t][e])return!0;return!1}return e in this.delegatedProperties?this._objects[0]&&this._objects[0].get(e):this[e]}}),t.Group.fromObject=function(e,n){t.util.enlivenObjects(e.objects,function(r){delete e.objects,n&&n(new t.Group(r,e))})},t.Group.async=!0}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=fabric.util.object.extend;e.fabric||(e.fabric={});if(e.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(e,t){t||(t={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",t),this._initElement(e,t),this._initConfig(t),t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(e,t,n){return this._element=e,this._originalElement=e,this._initConfig(n),this.filters.length!==0?this.applyFilters(t):t&&t(),this},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.width,height:e.height}},_stroke:function(e){e.save(),this._setStrokeStyles(e),e.beginPath(),e.strokeRect(-this.width/2,-this.height/2,this.width,this.height),e.closePath(),e.restore()},_renderDashedStroke:function(e){var t=-this.width/2,n=-this.height/2,r=this.width,i=this.height;e.save(),this._setStrokeStyles(e),e.beginPath(),fabric.util.drawDashedLine(e,t,n,t+r,n,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n,t+r,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n+i,t,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t,n+i,t,n,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(e){return t(this.callSuper("toObject",e),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(e){return e&&e.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(e){var t=[],n=-this.width/2,r=-this.height/2,i="none";this.group&&this.group.type==="path-group"&&(n=this.left,r=this.top),this.alignX!=="none"&&this.alignY!=="none"&&(i="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),t.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',n,'" y="',r,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',i,'"',"></image>\n");if(this.stroke||this.strokeDashArray){var s=this.fill;this.fill=null,t.push("<rect ",'x="',n,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=s}return t.push("</g>\n"),e?e(t.join("")):t.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(e,t,n){fabric.util.loadImage(e,function(e){return this.setElement(e,t,n)},this,n&&n.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(e,t){this.constructor.fromObject(this.toObject(t),e)},applyFilters:function(e,t,n,r){t=t||this.filters,n=n||this._originalElement;if(!n)return;var i=n,s=fabric.util.createCanvasElement(),o=fabric.util.createImage(),u=this;return s.width=i.width,s.height=i.height,s.getContext("2d").drawImage(i,0,0,i.width,i.height),t.length===0?(this._element=n,e&&e(),s):(t.forEach(function(e){e&&e.applyTo(s,e.scaleX||u.scaleX,e.scaleY||u.scaleY),!r&&e&&e.type==="Resize"&&(u.width*=e.scaleX,u.height*=e.scaleY)}),o.width=s.width,o.height=s.height,fabric.isLikelyNode?(o.src=s.toBuffer(undefined,fabric.Image.pngCompression),u._element=o,!r&&(u._filteredEl=o),e&&e()):(o.onload=function(){u._element=o,!r&&(u._filteredEl=o),e&&e(),o.onload=s=i=null},o.src=s.toDataURL("image/png")),s)},_render:function(e,t){var n,r,i=this._findMargins(),s;n=t?this.left:-this.width/2,r=t?this.top:-this.height/2,this.meetOrSlice==="slice"&&(e.beginPath(),e.rect(n,r,this.width,this.height),e.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,s=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):s=this._element,s&&e.drawImage(s,n+i.marginX,r+i.marginY,i.width,i.height),this._renderStroke(e)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var e=this.width,t=this.height,n,r,i=0,s=0;if(this.alignX!=="none"||this.alignY!=="none")n=[this.width/this._element.width,this.height/this._element.height],r=this.meetOrSlice==="meet"?Math.min.apply(null,n):Math.max.apply(null,n),e=this._element.width*r,t=this._element.height*r,this.alignX==="Mid"&&(i=(this.width-e)/2),this.alignX==="Max"&&(i=this.width-e),this.alignY==="Mid"&&(s=(this.height-t)/2),this.alignY==="Max"&&(s=this.height-t);return{width:e,height:t,marginX:i,marginY:s}},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width),this.set("height",e.height)},_initElement:function(e){this.setElement(fabric.util.getById(e)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,t){e.filters&&e.filters.length?fabric.util.enlivenObjects(e.filters,function(e){t&&t(e)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){this.width="width"in e?e.width:this.getElement()?this.getElement().width||0:0,this.height="height"in e?e.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){fabric.Image.prototype._initFilters.call(e,e,function(r){e.filters=r||[];var i=new fabric.Image(n,e);t&&t(i)})},null,e.crossOrigin)},fabric.Image.fromURL=function(e,t,n){fabric.util.loadImage(e,function(e){t&&t(new fabric.Image(e,n))},null,n&&n.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href"
.split(" ")),fabric.Image.fromElement=function(e,n,r){var i=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES),s="xMidYMid",o="meet",u,a,f;i.preserveAspectRatio&&(f=i.preserveAspectRatio.split(" ")),f&&f.length&&(o=f.pop(),o!=="meet"&&o!=="slice"?(s=o,o="meet"):f.length&&(s=f.pop())),u=s!=="none"?s.slice(1,4):"none",a=s!=="none"?s.slice(5,8):"none",i.alignX=u,i.alignY=a,i.meetOrSlice=o,fabric.Image.fromURL(i["xlink:href"],n,t(r?fabric.util.object.clone(r):{},i))},fabric.Image.async=!0,fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return e>0?Math.round((e-1)/90)*90:Math.round(e/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},n=e.onComplete||t,r=e.onChange||t,i=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){i.setAngle(e),r()},onComplete:function(){i.setCoords(),n()},onStart:function(){i.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.renderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(e){e=e||{},this.brightness=e.brightness||0},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.brightness;for(var s=0,o=r.length;s<o;s+=4)r[s]+=i,r[s+1]+=i,r[s+2]+=i;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{brightness:this.brightness})}}),t.Image.filters.Brightness.fromObject=function(e){return new t.Image.filters.Brightness(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(e){e=e||{},this.opaque=e.opaque,this.matrix=e.matrix||[0,0,0,0,1,0,0,0,0];var n=t.util.createCanvasElement();this.tmpCtx=n.getContext("2d")},_createImageData:function(e,t){return this.tmpCtx.createImageData(e,t)},applyTo:function(e){var t=this.matrix,n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=Math.round(Math.sqrt(t.length)),s=Math.floor(i/2),o=r.data,u=r.width,a=r.height,f=u,l=a,c=this._createImageData(f,l),h=c.data,p=this.opaque?1:0;for(var d=0;d<l;d++)for(var v=0;v<f;v++){var m=d,g=v,y=(d*f+v)*4,b=0,w=0,E=0,S=0;for(var x=0;x<i;x++)for(var T=0;T<i;T++){var N=m+x-s,C=g+T-s;if(N<0||N>a||C<0||C>u)continue;var k=(N*u+C)*4,L=t[x*i+T];b+=o[k]*L,w+=o[k+1]*L,E+=o[k+2]*L,S+=o[k+3]*L}h[y]=b,h[y+1]=w,h[y+2]=E,h[y+3]=S+p*(255-S)}n.putImageData(c,0,0)},toObject:function(){return n(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=function(e){return new t.Image.filters.Convolute(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(e){e=e||{},this.threshold=e.threshold||100},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=r.length;for(var o=0,u=r.length;o<u;o+=4)r[o+3]=i+255*(s-o)/s;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold})}}),t.Image.filters.GradientTransparency.fromObject=function(e){return new t.Image.filters.GradientTransparency(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.width*n.height*4,s=0,o;while(s<i)o=(r[s]+r[s+1]+r[s+2])/3,r[s]=o,r[s+1]=o,r[s+2]=o,s+=4;t.putImageData(n,0,0)}}),t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s;for(s=0;s<i;s+=4)r[s]=255-r[s],r[s+1]=255-r[s+1],r[s+2]=255-r[s+2];t.putImageData(n,0,0)}}),t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(e){e=e||{},this.mask=e.mask,this.channel=[0,1,2,3].indexOf(e.channel)>-1?e.channel:0},applyTo:function(e){if(!this.mask)return;var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=this.mask.getElement(),o=t.util.createCanvasElement(),u=this.channel,a,f=r.width*r.height*4;o.width=s.width,o.height=s.height,o.getContext("2d").drawImage(s,0,0,s.width,s.height);var l=o.getContext("2d").getImageData(0,0,s.width,s.height),c=l.data;for(a=0;a<f;a+=4)i[a+3]=c[a+u];n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),t.Image.filters.Mask.fromObject=function(e,n){t.util.loadImage(e.mask.src,function(r){e.mask=new t.Image(r,e.mask),n&&n(new t.Image.filters.Mask(e))})},t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(e){e=e||{},this.noise=e.noise||0},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.noise,s;for(var o=0,u=r.length;o<u;o+=4)s=(.5-Math.random())*i,r[o]+=s,r[o+1]+=s,r[o+2]+=s;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=function(e){return new t.Image.filters.Noise(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(e){e=e||{},this.blocksize=e.blocksize||4},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.height,s=n.width,o,u,a,f,l,c,h;for(u=0;u<i;u+=this.blocksize)for(a=0;a<s;a+=this.blocksize){o=u*4*s+a*4,f=r[o],l=r[o+1],c=r[o+2],h=r[o+3];for(var p=u,d=u+this.blocksize;p<d;p++)for(var v=a,m=a+this.blocksize;v<m;v++)o=p*4*s+v*4,r[o]=f,r[o+1]=l,r[o+2]=c,r[o+3]=h}t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{blocksize:this.blocksize})}}),t.Image.filters.Pixelate.fromObject=function(e){return new t.Image.filters.Pixelate(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(e){e=e||{},this.threshold=e.threshold||30,this.distance=e.distance||20},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=this.distance,o=255-i,u=Math.abs,a,f,l;for(var c=0,h=r.length;c<h;c+=4)a=r[c],f=r[c+1],l=r[c+2],a>o&&f>o&&l>o&&u(a-f)<s&&u(a-l)<s&&u(f-l)<s&&(r[c+3]=1);t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),t.Image.filters.RemoveWhite.fromObject=function(e){return new t.Image.filters.RemoveWhite(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o;for(s=0;s<i;s+=4)o=.3*r[s]+.59*r[s+1]+.11*r[s+2],r[s]=o+100,r[s+1]=o+50,r[s+2]=o+255;t.putImageData(n,0,0)}}),t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o,u,a;for(s=0;s<i;s+=4)o=r[s],u=r[s+1],a=r[s+2],r[s]=(o*.393+u*.769+a*.189)/1.351,r[s+1]=(o*.349+u*.686+a*.168)/1.203,r[s+2]=(o*.272+u*.534+a*.131)/2.14;t.putImageData(n,0,0)}}),t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(e){e=e||{},this.color=e.color||"#000000",this.opacity=typeof e.opacity!="undefined"?e.opacity:(new t.Color(this.color)).getAlpha()},applyTo:function(e){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=i.length,o,u,a,f,l,c,h,p,d;d=(new t.Color(this.color)).getSource(),u=d[0]*this.opacity,a=d[1]*this.opacity,f=d[2]*this.opacity,p=1-this.opacity;for(o=0;o<s;o+=4)l=i[o],c=i[o+1],h=i[o+2],i[o]=u+l*p,i[o+1]=a+c*p,i[o+2]=f+h*p;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),t.Image.filters.Tint.fromObject=function(e){return new t.Image.filters.Tint(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Multiply=t.util.createClass(t.Image.filters.BaseFilter,{type:"Multiply",initialize:function(e){e=e||{},this.color=e.color||"#000000"},applyTo:function(e){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=i.length,o,u;u=(new t.Color(this.color)).getSource();for(o=0;o<s;o+=4)i[o]*=u[0]/255,i[o+1]*=u[1]/255,i[o+2]*=u[2]/255;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color})}}),t.Image.filters.Multiply.fromObject=function(e){return new t.Image.filters.Multiply(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric;t.Image.filters.Blend=t.util.createClass({type:"Blend",initialize:function(e){e=e||{},this.color=e.color||"#000",this.image=e.image||!1,this.mode=e.mode||"multiply",this.alpha=e.alpha||1},applyTo:function(e){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s,o,u,a,f,l,c,h,p,d,v=!1;if(this.image){v=!0;var m=t.util.createCanvasElement();m.width=this.image.width,m.height=this.image.height;var g=new t.StaticCanvas(m);g.add(this.image);var y=g.getContext("2d");d=y.getImageData(0,0,g.width,g.height).data}else d=(new t.Color(this.color)).getSource(),s=d[0]*this.alpha,o=d[1]*this.alpha,u=d[2]*this.alpha;for(var b=0,w=i.length;b<w;b+=4){a=i[b],f=i[b+1],l=i[b+2],v&&(s=d[b]*this.alpha,o=d[b+1]*this.alpha,u=d[b+2]*this.alpha);switch(this.mode){case"multiply":i[b]=a*s/255,i[b+1]=f*o/255,i[b+2]=l*u/255;break;case"screen":i[b]=1-(1-a)*(1-s),i[b+1]=1-(1-f)*(1-o),i[b+2]=1-(1-l)*(1-u);break;case"add":i[b]=Math.min(255,a+s),i[b+1]=Math.min(255,f+o),i[b+2]=Math.min(255,l+u);break;case"diff":case"difference":i[b]=Math.abs(a-s),i[b+1]=Math.abs(f-o),i[b+2]=Math.abs(l-u);break;case"subtract":c=a-s,h=f-o,p=l-u,i[b]=c<0?0:c,i[b+1]=h<0?0:h,i[b+2]=p<0?0:p;break;case"darken":i[b]=Math.min(a,s),i[b+1]=Math.min(f,o),i[b+2]=Math.min(l,u);break;case"lighten":i[b]=Math.max(a,s),i[b+1]=Math.max(f,o),i[b+2]=Math.max(l,u)}}n.putImageData(r,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.Blend.fromObject=function(e){return new t.Image.filters.Blend(e)}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=Math.pow,r=Math.floor,i=Math.sqrt,s=Math.abs,o=Math.max,u=Math.round,a=Math.sin,f=Math.ceil;t.Image.filters.Resize=t.util.createClass(t.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(e,t,n){this.rcpScaleX=1/t,this.rcpScaleY=1/n;var r=e.width,i=e.height,s=u(r*t),o=u(i*n),a;this.resizeType==="sliceHack"&&(a=this.sliceByTwo(e,r,i,s,o)),this.resizeType==="hermite"&&(a=this.hermiteFastResize(e,r,i,s,o)),this.resizeType==="bilinear"&&(a=this.bilinearFiltering(e,r,i,s,o)),this.resizeType==="lanczos"&&(a=this.lanczosResize(e,r,i,s,o)),e.width=s,e.height=o,e.getContext("2d").putImageData(a,0,0)},sliceByTwo:function(e,n,i,s,u){var a=e.getContext("2d"),f,l=.5,c=.5,h=1,p=1,d=!1,v=!1,m=n,g=i,y=t.util.createCanvasElement(),b=y.getContext("2d");s=r(s),u=r(u),y.width=o(s,n),y.height=o(u,i),s>n&&(l=2,h=-1),u>i&&(c=2,p=-1),f=a.getImageData(0,0,n,i),e.width=o(s,n),e.height=o(u,i),a.putImageData(f,0,0);while(!d||!v)n=m,i=g,s*h<r(m*l*h)?m=r(m*l):(m=s,d=!0),u*p<r(g*c*p)?g=r(g*c):(g=u,v=!0),f=a.getImageData(0,0,n,i),b.putImageData(f,0,0),a.clearRect(0,0,m,g),a.drawImage(y,0,0,n,i,0,0,m,g);return a.getImageData(0,0,s,u)},lanczosResize:function(e,t,o,u,l){function c(e){return function(t){if(t>e)return 0;t*=Math.PI;if(s(t)<1e-16)return 1;var n=t/e;return a(t)*a(n)/t/n}}function h(e){var a,f,c,p,d,L,A,O,M,_,D;C.x=(e+.5)*b,k.x=r(C.x);for(a=0;a<l;a++){C.y=(a+.5)*w,k.y=r(C.y),d=0,L=0,A=0,O=0,M=0;for(f=k.x-x;f<=k.x+x;f++){if(f<0||f>=t)continue;_=r(1e3*s(f-C.x)),N[_]||(N[_]={});for(var P=k.y-T;P<=k.y+T;P++){if(P<0||P>=o)continue;D=r(1e3*s(P-C.y)),N[_][D]||(N[_][D]=y(i(n(_*E,2)+n(D*S,2))/1e3)),c=N[_][D],c>0&&(p=(P*t+f)*4,d+=c,L+=c*m[p],A+=c*m[p+1],O+=c*m[p+2],M+=c*m[p+3])}}p=(a*u+e)*4,g[p]=L/d,g[p+1]=A/d,g[p+2]=O/d,g[p+3]=M/d}return++e<u?h(e):v}var p=e.getContext("2d"),d=p.getImageData(0,0,t,o),v=p.getImageData(0,0,u,l),m=d.data,g=v.data,y=c(this.lanczosLobes),b=this.rcpScaleX,w=this.rcpScaleY,E=2/this.rcpScaleX,S=2/this.rcpScaleY,x=f(b*this.lanczosLobes/2),T=f(w*this.lanczosLobes/2),N={},C={},k={};return h(0)},bilinearFiltering:function(e,t,n,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y=0,b,w=this.rcpScaleX,E=this.rcpScaleY,S=e.getContext("2d"),x=4*(t-1),T=S.getImageData(0,0,t,n),N=T.data,C=S.getImageData(0,0,i,s),k=C.data;for(h=0;h<s;h++)for(p=0;p<i;p++){l=r(w*p),c=r(E*h),d=w*p-l,v=E*h-c,b=4*(c*t+l);for(m=0;m<4;m++)o=N[b+m],u=N[b+4+m],a=N[b+x+m],f=N[b+x+4+m],g=o*(1-d)*(1-v)+u*d*(1-v)+a*v*(1-d)+f*d*v,k[y++]=g}return C},hermiteFastResize:function(e,t,n,o,u){var a=this.rcpScaleX,l=this.rcpScaleY,c=f(a/2),h=f(l/2),p=e.getContext("2d"),d=p.getImageData(0,0,t,n),v=d.data,m=p.getImageData(0,0,o,u),g=m.data;for(var y=0;y<u;y++)for(var b=0;b<o;b++){var w=(b+y*o)*4,E=0,S=0,x=0,T=0,N=0,C=0,k=0,L=(y+.5)*l;for(var A=r(y*l);A<(y+1)*l;A++){var O=s(L-(A+.5))/h,M=(b+.5)*a,_=O*O;for(var D=r(b*a);D<(b+1)*a;D++){var P=s(M-(D+.5))/c,H=i(_+P*P);if(H>1&&H<-1)continue;E=2*H*H*H-3*H*H+1,E>0&&(P=4*(D+A*t),k+=E*v[P+3],x+=E,v[P+3]<255&&(E=E*v[P+3]/250),T+=E*v[P],N+=E*v[P+1],C+=E*v[P+2],S+=E)}}g[w]=T/S,g[w+1]=N/S,g[w+2]=C/S,g[w+3]=k/x}return m},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=function(){return new t.Image.filters.Resize}}(typeof exports!="undefined"?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.object.clone,i=t.util.toFixed,s=t.StaticCanvas.supports("setLineDash");if(t.Text){t.warn("fabric.Text is already defined");return}var o=t.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:o,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(e,t){t=t||{},this.text=e,this.__skipDimension=!0,this.setOptions(t),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(e){if(this.__skipDimension)return;e||(e=t.util.createCanvasElement().getContext("2d"),this._setTextStyles(e)),this._textLines=this.text.split(this._reNewline),this._clearCache();var n=this.textAlign;this.textAlign="left",this.width=this._getTextWidth(e),this.textAlign=n,this.height=this._getTextHeight(e)},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(e){this.clipTo&&t.util.clipContext(this,e),this._renderTextBackground(e),this._renderText(e),this._renderTextDecoration(e),this.clipTo&&e.restore()},_renderText:function(e){e.save(),this._translateForTextAlign(e),this._setOpacity(e),this._setShadow(e),this._setupCompositeOperation(e),this._renderTextFill(e),this._renderTextStroke(e),this._restoreCompositeOperation(e),this._removeShadow(e),e.restore()},_translateForTextAlign:function(e){this.textAlign!=="left"&&this.textAlign!=="justify"&&e.translate(this.textAlign==="center"?this.width/2:this.width,0)},_setTextStyles:function(e){e.textBaseline="alphabetic",this.skipTextAlign||(e.textAlign=this.textAlign),e.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(e){var t=this._getLineWidth(e,0);for(var n=1,r=this._textLines.length;n<r;n++){var i=this._getLineWidth(e,n);i>t&&(t=i)}return t},_renderChars:function(e,t,n,r,i){t[e](n,r,i)},_renderTextLine:function(e,t,n,r,i,s){i-=this.fontSize*this._fontSizeFraction;if(this.textAlign!=="justify"){this._renderChars(e,t,n,r,i,s);return}var o=this._getLineWidth(t,s),u=this.width;if(u>=o){var a=n.split(/\s+/),f=this._getWidthOfWords(t,n,s),l=u-f,c=a.length-1,h=l/c,p=0;for(var d=0,v=a.length;d<v;d++)this._renderChars(e,t,a[d],r+p,i,s),p+=t.measureText(a[d]).width+h}else this._renderChars(e,t,n,r,i,s)},_getWidthOfWords:function(e,t){return e.measureText(t.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(e){if(!this.fill&&!this._skipFillStrokeCheck)return;var t=0;for(var n=0,r=this._textLines.length;n<r;n++){var i=this._getHeightOfLine(e,n),s=i/this.lineHeight;this._renderTextLine("fillText",e,this._textLines[n],this._getLeftOffset(),this._getTopOffset()+t+s,n),t+=i}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e)},_renderTextStroke:function(e){if((!this.stroke||this.strokeWidth===0)&&!this._skipFillStrokeCheck)return;var t=0;e.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),s&&e.setLineDash(this.strokeDashArray)),e.beginPath();for(var n=0,r=this._textLines.length;n<r;n++){var i=this._getHeightOfLine(e,n),o=i/this.lineHeight;this._renderTextLine("strokeText",e,this._textLines[n],this._getLeftOffset(),this._getTopOffset()+t+o,n),t+=i}e.closePath(),e.restore()},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(e){this._renderTextBoxBackground(e),this._renderTextLinesBackground(e)},_renderTextBoxBackground:function(e){if(!this.backgroundColor)return;e.save(),e.fillStyle=this.backgroundColor,e.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),e.restore()},_renderTextLinesBackground:function(e){var t=0,n=this._getHeightOfLine();if(!this.textBackgroundColor)return;e.save(),e.fillStyle=this.textBackgroundColor;for(var r=0,i=this._textLines.length;r<i;r++){if(this._textLines[r]!==""){var s=this._getLineWidth(e,r),o=this._getLineLeftOffset(s);e.fillRect(this._getLeftOffset()+o,this._getTopOffset()+t,s,this.fontSize*this._fontSizeMult)}t+=n}e.restore()},_getLineLeftOffset:function(e){return this.textAlign==="center"?(this.width-e)/2:this.textAlign==="right"?this.width-e:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__lineOffsets=[]},_shouldClearCache:function(){var e=!1;for(var t in this._dimensionAffectingProps)this["__"+t]!==this[t]&&(this["__"+t]=this[t],e=!0);return e},_getLineWidth:function(e,t){return this.__lineWidths[t]?this.__lineWidths[t]:(this.__lineWidths[t]=e.measureText(this._textLines[t]).width,this.__lineWidths[t])},_renderTextDecoration:function(e){function i(r){var i,s=0,o,u,a;for(i=0,o=n._textLines.length;i<o;i++){var f=n._getLineWidth(e,i),l=n._getLineLeftOffset(f),c=n._getHeightOfLine(e,i);for(u=0,a=r.length;u<a;u++)e.fillRect(n._getLeftOffset()+l,s+(n._fontSizeMult-1+r[u])*n.fontSize-t,f,n.fontSize/15);s+=c}}if(!this.textDecoration)return;var t=this.height/2,n=this,r=[];this.textDecoration.indexOf("underline")>-1&&r.push(.85),this.textDecoration.indexOf("line-through")>-1&&r.push(.43),this.textDecoration.indexOf("overline")>-1&&r.push(-0.12),r.length>0&&i(r)},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(e,t){if(!this.visible)return;e.save(),this._setTextStyles(e),this._shouldClearCache()&&this._initDimensions(e),t||this.transform(e),this._setStrokeStyles(e),this._setFillStyles(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.group&&this.group.type==="path-group"&&e.translate(this.left,this.top),this._render(e),e.restore()},toObject:function(e){var t=n(this.callSuper("toObject",e),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(e){var t=this._createBaseSVGMarkup(),n=this._getSVGLeftTopOffsets(this.ctx),r=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(t,r),e?e(t.join("")):t.join("")},_getSVGLeftTopOffsets:function(e){var t=this._getHeightOfLine(e,0),n=-this.width/2,r=0;return{textLeft:n+(this.group&&this.group.type==="path-group"?this.left:0),textTop:r+(this.group&&this.group.type==="path-group"?-this.top:0),lineTop:t}},_wrapSVGTextAndBg:function(e,t){e.push('	<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',t.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',t.textSpans.join(""),"</text>\n","	</g>\n")},_getSVGTextAndBg:function(e,t){var n=[],r=[],i=0;this._setSVGBg(r);for(var s=0,o=this._textLines.length;s<o;s++)this.textBackgroundColor&&this._setSVGTextLineBg(r,s,t,e,i),this._setSVGTextLineText(s,n,i,t,e,r),i+=this._getHeightOfLine(this.ctx,s);return{textSpans:n,textBgRects:r}},_setSVGTextLineText:function(e,n,r,s,o){var u=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-o+r-this.height/2;n.push('<tspan x="',i(s+this._getLineLeftOffset(this.__lineWidths[e]),4),'" ','y="',i(u,4),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(this._textLines[e]),"</tspan>")},_setSVGTextLineBg:function(e,t,n,r,s){e.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(n+this._getLineLeftOffset(this.__lineWidths[t]),4),'" y="',i(s-this.height/2,4),'" width="',i(this.__lineWidths[t],4),'" height="',i(this._getHeightOfLine(this.ctx,t)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(e){this.backgroundColor&&e.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,4),'" y="',i(-this.height/2,4),'" width="',i(this.width,4),'" height="',i(this.height,4),'"></rect>\n')},_getFillAttributes:function(e){var n=e&&typeof e=="string"?new t.Color(e):"";return!n||!n.getSource()||n.getAlpha()===1?'fill="'+e+'"':'opacity="'+n.getAlpha()+'" fill="'+n.setAlpha(1).toRgb()+'"'},_set:function(e,t){this.callSuper("_set",e,t),e in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,n){if(!e)return null;var r=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES);n=t.util.object.extend(n?t.util.object.clone(n):{},r),n.top=n.top||0,n.left=n.left||0,"dx"in r&&(n.left+=r.dx),"dy"in r&&(n.top+=r.dy),"fontSize"in n||(n.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE),n.originX||(n.originX="left");var i=e.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),s=new t.Text(i,n),o=0;return s.originX==="left"&&(o=s.getWidth()/2),s.originX==="right"&&(o=-s.getWidth()/2),s.set({left:s.getLeft()+o,top:s.getTop()-s.getHeight()/2+s.fontSize*(.18+s._fontSizeFraction)}),s},t.Text.fromObject=function(e){return new t.Text(e.text,r(e))},t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),function(){var e=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(e,t){this.styles=t?t.styles||{}:{},this.callSuper("initialize",e,t),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__maxFontHeights=[],this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var e=this.styles;for(var t in e)for(var n in e[t])for(var r in e[t][n])return!1;return!0},setSelectionStart:function(e){e=Math.max(e,0),this.selectionStart!==e&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=e),this._updateTextarea()},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this.selectionEnd!==e&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=e),this._updateTextarea()},getSelectionStyles:function(e,t){if(arguments.length===2){var n=[];for(var r=e;r<t;r++)n.push(this.getSelectionStyles(r));return n}var i=this.get2DCursorLocation(e);return this.styles[i.lineIndex]?this.styles[i.lineIndex][i.charIndex]||{}:{}},setSelectionStyles:function(e){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,e);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,e);return this._clearCache(),this},_extendStyles:function(e,t){var n=this.get2DCursorLocation(e);this.styles[n.lineIndex]||(this.styles[n.lineIndex]={}),this.styles[n.lineIndex][n.charIndex]||(this.styles[n.lineIndex][n.charIndex]={}),fabric.util.object.extend(this.styles[n.lineIndex][n.charIndex],t)},_render:function(e){this.callSuper("_render",e),this.ctx=e,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active)return;var e=this.text.split(""),t,n;this.canvas.contextTop?(n=this.canvas.contextTop,n.save(),n.transform.apply(n,this.canvas.viewportTransform),this.transform(n)):(n=this.ctx,n.save()),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(e,"cursor"),this.renderCursor(t,n)):(t=this._getCursorBoundaries(e,"selection"),this.renderSelection(e,t,n)),n.restore()},get2DCursorLocation:function(e){typeof e=="undefined"&&(e=this.selectionStart);var t=this.text.slice(0,e),n=t.split(this._reNewline);return{lineIndex:n.length-1,charIndex:n[n.length-1].length}},getCurrentCharStyle:function(e,t){var n=this.styles[e]&&this.styles[e][t===0?0:t-1];return{fontSize:n&&n.fontSize||this.fontSize,fill:n&&n.fill||this.fill,textBackgroundColor:n&&n.textBackgroundColor||this.textBackgroundColor,textDecoration:n&&n.textDecoration||this.textDecoration,fontFamily:n&&n.fontFamily||this.fontFamily,fontWeight:n&&n.fontWeight||this.fontWeight,fontStyle:n&&n.fontStyle||this.fontStyle,stroke:n&&n.stroke||this.stroke,strokeWidth:n&&n.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(e,t){return this.styles[e]&&this.styles[e][t===0?0:t-1]&&this.styles[e][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(e,t){return this.styles[e]&&this.styles[e][t===0?0:t-1]&&this.styles[e][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(e,t){var n=Math.round(this._getLeftOffset()),r=this._getTopOffset(),i=this._getCursorBoundariesOffsets(e,t);return{left:n,top:r,leftOffset:i.left+i.lineLeft,topOffset:i.top}},_getCursorBoundariesOffsets:function(e,t){var n=0,r=0,i=0,s=0,o=0;for(var u=0;u<this.selectionStart;u++)e[u]==="\n"?(o=0,s+=this._getHeightOfLine(this.ctx,r),r++,i=0):(o+=this._getWidthOfChar(this.ctx,e[u],r,i),i++),n=this._getCachedLineOffset(r);return t==="cursor"&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,r)/this.lineHeight-this.getCurrentCharFontSize(r,i)*(1-this._fontSizeFraction)),{top:s,left:o,lineLeft:n}},_getCachedLineOffset:function(e){var t=this._getLineWidth(this.ctx,e);return this.__lineOffsets[e]||(this.__lineOffsets[e]=this._getLineLeftOffset(t))},renderCursor:function(e,t){var n=this.get2DCursorLocation(),r=n.lineIndex,i=n.charIndex,s=this.getCurrentCharFontSize(r,i),o=r===0&&i===0?this._getCachedLineOffset(r):e.leftOffset;t.fillStyle=this.getCurrentCharColor(r,i),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+o,e.top+e.topOffset,this.cursorWidth/this.scaleX,s)},renderSelection:function(e,t,n){n.fillStyle=this.selectionColor;var r=this.get2DCursorLocation(this.selectionStart),i=this.get2DCursorLocation(this.selectionEnd),s=r.lineIndex,o=i.lineIndex;for(var u=s;u<=o;u++){var a=this._getCachedLineOffset(u)||0,f=this._getHeightOfLine(this.ctx,u),l=0,c=this._textLines[u];if(u===s)for(var h=0,p=c.length;h<p;h++)h>=r.charIndex&&(u!==o||h<i.charIndex)&&(l+=this._getWidthOfChar(n,c[h],u,h)),h<r.charIndex&&(a+=this._getWidthOfChar(n,c[h],u,h));else if(u>s&&u<o)l+=this._getLineWidth(n,u)||5;else if(u===o)for(var d=0,v=i.charIndex;d<v;d++)l+=this._getWidthOfChar(n,c[d],u,d);n.fillRect(t.left+a,t.top+t.topOffset,l,f),t.topOffset+=f}},_renderChars:function(e,t,n,r,i,s){if(this.isEmptyStyles())return this._renderCharsFast(e,t,n,r,i);this.skipTextAlign=!0,r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var o=this._getHeightOfLine(t,s),u=this._getCachedLineOffset(s),a=n.split(""),f,l="";r+=u||0,t.save(),i-=o/this.lineHeight*this._fontSizeFraction;for(var c=0,h=a.length;c<=h;c++){f=f||this.getCurrentCharStyle(s,c);var p=this.getCurrentCharStyle(s,c+1);if(this._hasStyleChanged(f,p)||c===h)this._renderChar(e,t,s,c-1,l,r,i,o),l="",f=p;l+=a[c]}t.restore()},_renderCharsFast:function(e,t,n,r,i){this.skipTextAlign=!1,e==="fillText"&&this.fill&&this.callSuper("_renderChars",e,t,n,r,i),e==="strokeText"&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",e,t,n,r,i)},_renderChar:function(e,t,n,r,i,s,o,u){var a,f,l,c=this._fontSizeFraction*u/this.lineHeight;if(this.styles&&this.styles[n]&&(a=this.styles[n][r])){var h=a.stroke||this.stroke,p=a.fill||this.fill;t.save(),f=this._applyCharStylesGetWidth(t,i,n,r,a),l=this._getHeightOfChar(t,i,n,r),p&&t.fillText(i,s,o),h&&t.strokeText(i,s,o),this._renderCharDecoration(t,a,s,o,c,f,l),t.restore(),t.translate(f,0)}else e==="strokeText"&&
this.stroke&&t[e](i,s,o),e==="fillText"&&this.fill&&t[e](i,s,o),f=this._applyCharStylesGetWidth(t,i,n,r),this._renderCharDecoration(t,null,s,o,c,f,this.fontSize),t.translate(t.measureText(i).width,0)},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.fontSize!==t.fontSize||e.textBackgroundColor!==t.textBackgroundColor||e.textDecoration!==t.textDecoration||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth},_renderCharDecoration:function(e,t,n,r,i,s,o){var u=t?t.textDecoration||this.textDecoration:this.textDecoration;if(!u)return;u.indexOf("underline")>-1&&e.fillRect(n,r+o/10,s,o/15),u.indexOf("line-through")>-1&&e.fillRect(n,r-o*(this._fontSizeFraction+this._fontSizeMult-1)+o/15,s,o/15),u.indexOf("overline")>-1&&e.fillRect(n,r-(this._fontSizeMult-this._fontSizeFraction)*o,s,o/15)},_renderTextLine:function(e,t,n,r,i,s){this.isEmptyStyles()||(i+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",e,t,n,r,i,s)},_renderTextDecoration:function(e){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",e)},_renderTextLinesBackground:function(e){if(!this.textBackgroundColor&&!this.styles)return;e.save(),this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor);var t=0;for(var n=0,r=this._textLines.length;n<r;n++){var i=this._getHeightOfLine(e,n);if(this._textLines[n]===""){t+=i;continue}var s=this._getLineWidth(e,n),o=this._getCachedLineOffset(n);this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor,e.fillRect(this._getLeftOffset()+o,this._getTopOffset()+t,s,i/this.lineHeight));if(this.styles[n])for(var u=0,a=this._textLines[n].length;u<a;u++)if(this.styles[n]&&this.styles[n][u]&&this.styles[n][u].textBackgroundColor){var f=this._textLines[n][u];e.fillStyle=this.styles[n][u].textBackgroundColor,e.fillRect(this._getLeftOffset()+o+this._getWidthOfCharsAt(e,n,u),this._getTopOffset()+t,this._getWidthOfChar(e,f,n,u)+1,i/this.lineHeight)}t+=i}e.restore()},_getCacheProp:function(e,t){return e+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,n,r,i,s){var o=s||this.styles[r]&&this.styles[r][i];o?o=e(o):o={},this._applyFontStyles(o);var u=this._getCacheProp(n,o);if(this.isEmptyStyles()&&this._charWidthsCache[u]&&this.caching)return this._charWidthsCache[u];typeof o.shadow=="string"&&(o.shadow=new fabric.Shadow(o.shadow));var a=o.fill||this.fill;return t.fillStyle=a.toLive?a.toLive(t,this):a,o.stroke&&(t.strokeStyle=o.stroke&&o.stroke.toLive?o.stroke.toLive(t,this):o.stroke),t.lineWidth=o.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(o),this._setShadow.call(o,t),this.caching?(this._charWidthsCache[u]||(this._charWidthsCache[u]=t.measureText(n).width),this._charWidthsCache[u]):t.measureText(n).width},_applyFontStyles:function(e){e.fontFamily||(e.fontFamily=this.fontFamily),e.fontSize||(e.fontSize=this.fontSize),e.fontWeight||(e.fontWeight=this.fontWeight),e.fontStyle||(e.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,n){return this.styles[t]&&this.styles[t][n]?e(this.styles[t][n]):{}},_getWidthOfChar:function(e,t,n,r){if(this.textAlign==="justify"&&/\s/.test(t))return this._getWidthOfSpace(e,n);var i=this._getStyleDeclaration(n,r);this._applyFontStyles(i);var s=this._getCacheProp(t,i);if(this._charWidthsCache[s]&&this.caching)return this._charWidthsCache[s];if(e){e.save();var o=this._applyCharStylesGetWidth(e,t,n,r);return e.restore(),o}},_getHeightOfChar:function(e,t,n,r){return this.styles[n]&&this.styles[n][r]?this.styles[n][r].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(e,t,n){var r=this._textLines[t][n];return this._getHeightOfChar(e,r,t,n)},_getWidthOfCharsAt:function(e,t,n){var r=0,i,s;for(i=0;i<n;i++)s=this._textLines[t][i],r+=this._getWidthOfChar(e,s,t,i);return r},_getLineWidth:function(e,t){return this.__lineWidths[t]?this.__lineWidths[t]:(this.__lineWidths[t]=this._getWidthOfCharsAt(e,t,this._textLines[t].length),this.__lineWidths[t])},_getWidthOfSpace:function(e,t){if(this.__widthOfSpace[t])return this.__widthOfSpace[t];var n=this._textLines[t],r=this._getWidthOfWords(e,n,t),i=this.width-r,s=n.length-n.replace(/\s+/g,"").length,o=i/s;return this.__widthOfSpace[t]=o,o},_getWidthOfWords:function(e,t,n){var r=0;for(var i=0;i<t.length;i++){var s=t[i];s.match(/\s/)||(r+=this._getWidthOfChar(e,s,n,i))}return r},_getHeightOfLine:function(e,t){if(this.__lineHeights[t])return this.__lineHeights[t];var n=this._textLines[t],r=this._getHeightOfChar(e,n[0],t,0);for(var i=1,s=n.length;i<s;i++){var o=this._getHeightOfChar(e,n[i],t,i);o>r&&(r=o)}return this.__maxFontHeights[t]=r,this.__lineHeights[t]=r*this.lineHeight*this._fontSizeMult,this.__lineHeights[t]},_getTextHeight:function(e){var t=0;for(var n=0,r=this._textLines.length;n<r;n++)t+=this._getHeightOfLine(e,n);return t},_renderTextBoxBackground:function(e){if(!this.backgroundColor)return;e.save(),e.fillStyle=this.backgroundColor,e.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),e.restore()},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:e(this.styles)})}}),fabric.IText.fromObject=function(t){return new fabric.IText(t.text,e(t))}}(),function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var e=this;setTimeout(function(){e.selected=!0},100)})},initAddedHandler:function(){var e=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),e.canvas&&(e.canvas._iTextInstances=e.canvas._iTextInstances||[],e.canvas._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){e.canvas&&(e.canvas._iTextInstances=e.canvas._iTextInstances||[],fabric.util.removeFromArray(e.canvas._iTextInstances,e))})},_initCanvasHandlers:function(){var e=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(e.canvas)}),this.canvas.on("mouse:up",function(){e.canvas._iTextInstances&&e.canvas._iTextInstances.forEach(function(e){e.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(e.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,n,r){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:n,onComplete:function(){i.isAborted||e[r]()},onChange:function(){e.canvas&&(e.canvas.clearContext(e.canvas.contextTop||e.ctx),e.renderCursorOrSelection())},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var t=this,n=e?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){t._tick()},n)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(e){var t=0,n=e-1;if(this._reSpace.test(this.text.charAt(n)))while(this._reSpace.test(this.text.charAt(n)))t++,n--;while(/\S/.test(this.text.charAt(n))&&n>-1)t++,n--;return e-t},findWordBoundaryRight:function(e){var t=0,n=e;if(this._reSpace.test(this.text.charAt(n)))while(this._reSpace.test(this.text.charAt(n)))t++,n++;while(/\S/.test(this.text.charAt(n))&&n<this.text.length)t++,n++;return e+t},findLineBoundaryLeft:function(e){var t=0,n=e-1;while(!/\n/.test(this.text.charAt(n))&&n>-1)t++,n--;return e-t},findLineBoundaryRight:function(e){var t=0,n=e;while(!/\n/.test(this.text.charAt(n))&&n<this.text.length)t++,n++;return e+t},getNumNewLinesInSelectedText:function(){var e=this.getSelectedText(),t=0;for(var n=0,r=e.split(""),i=r.length;n<i;n++)r[n]==="\n"&&t++;return t},searchWordBoundary:function(e,t){var n=this._reSpace.test(this.text.charAt(e))?e-1:e,r=this.text.charAt(n),i=/[ \n\.,;!\?\-]/;while(!i.test(r)&&n>0&&n<this.text.length)n+=t,r=this.text.charAt(n);return i.test(r)&&r!=="\n"&&(n+=t===1?0:1),n},selectWord:function(e){var t=this.searchWordBoundary(e,-1),n=this.searchWordBoundary(e,1);this.setSelectionStart(t),this.setSelectionEnd(n)},selectLine:function(e){var t=this.findLineBoundaryLeft(e),n=this.findLineBoundaryRight(e);this.setSelectionStart(t),this.setSelectionEnd(n)},enterEditing:function(){if(this.isEditing||!this.editable)return;return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.selected=!1,e.isEditing&&e.exitEditing()})},initMouseMoveHandler:function(){var e=this;this.canvas.on("mouse:move",function(t){if(!e.__isMousedown||!e.isEditing)return;var n=e.getSelectionStartFromPointer(t.e);n>=e.__selectionStartOnMouseDown?(e.setSelectionStart(e.__selectionStartOnMouseDown),e.setSelectionEnd(n)):(e.setSelectionStart(n),e.setSelectionEnd(e.__selectionStartOnMouseDown))})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(!this.hiddenTextarea)return;this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps)return;this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},_removeCharsFromTo:function(e,t){var n=t;while(n!==e){var r=this.get2DCursorLocation(n).charIndex;n--;var i=this.get2DCursorLocation(n).charIndex,s=i>r;s?this.removeStyleObject(s,n+1):this.removeStyleObject(this.get2DCursorLocation(n).charIndex===0,n)}this.text=this.text.slice(0,e)+this.text.slice(t),this._clearCache()},insertChars:function(e,t){var n=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+e+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(e,n,t),this.setSelectionStart(this.selectionStart+e.length),this.setSelectionEnd(this.selectionStart),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(t,n,r){this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={});var i=this.styles[t][n-1],s={};if(r)s[0]=e(i),this.styles[t+1]=s;else{for(var o in this.styles[t])parseInt(o,10)>=n&&(s[parseInt(o,10)-n]=this.styles[t][o],delete this.styles[t][o]);this.styles[t+1]=s}this._clearCache()},insertCharStyleObject:function(t,n,r){var i=this.styles[t],s=e(i);n===0&&!r&&(n=1);for(var o in s){var u=parseInt(o,10);u>=n&&(i[u+1]=s[u])}this.styles[t][n]=r||e(i[n-1]),this._clearCache()},insertStyleObjects:function(e,t,n){var r=this.get2DCursorLocation(),i=r.lineIndex,s=r.charIndex;this.styles[i]||(this.styles[i]={}),e==="\n"?this.insertNewlineStyleObject(i,s,t):n?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(i,s)},_insertStyles:function(e){for(var t=0,n=e.length;t<n;t++){var r=this.get2DCursorLocation(this.selectionStart+t),i=r.lineIndex,s=r.charIndex;this.insertCharStyleObject(i,s,e[t])}},shiftLineStyles:function(t,n){var r=e(this.styles);for(var i in this.styles){var s=parseInt(i,10);s>t&&(this.styles[s+n]=r[s])}},removeStyleObject:function(t,n){var r=this.get2DCursorLocation(n),i=r.lineIndex,s=r.charIndex;if(t){var o=this._textLines[i-1],u=o?o.length:0;this.styles[i-1]||(this.styles[i-1]={});for(s in this.styles[i])this.styles[i-1][parseInt(s,10)+u]=this.styles[i][s];this.shiftLineStyles(i,-1)}else{var a=this.styles[i];if(a){var f=this.selectionStart===this.selectionEnd?-1:0;delete a[s+f]}var l=e(a);for(var c in l){var h=parseInt(c,10);h>=s&&h!==0&&(a[h-1]=l[h],delete a[h])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+(new Date),this.__lastLastClickTime=+(new Date),this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+(new Date);var t=this.canvas.getPointer(e.e);this.isTripleClick(t)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(t)&&(this.fire("dblclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))}),this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){var t=this.canvas.getPointer(e.e);this.__mousedownX=t.x,this.__mousedownY=t.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(e.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(e){var t=this.canvas.getPointer(e);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;if(this._isObjectMoved(e.e))return;this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e);e.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(e){var t=this.canvas.getPointer(e),n=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),i=fabric.util.rotatePoint(n,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(e,i)},getSelectionStartFromPointer:function(e){var t=this._getLocalRotatedPointer(e),n=0,r=0,i=0,s=0,o,u;for(var a=0,f=this._textLines.length;a<f;a++){u=this._textLines[a].split(""),i+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getLineWidth(this.ctx,a),c=this._getLineLeftOffset(l);r=c*this.scaleX,this.flipX&&(this._textLines[a]=u.reverse().join(""));for(var h=0,p=u.length;h<p;h++){var d=u[h];n=r,r+=this._getWidthOfChar(this.ctx,d,a,this.flipX?p-h:h)*this.scaleX;if(i<=t.y||r<=t.x){s++;continue}return this._getNewSelectionStartFromOffset(t,n,r,s+a,p)}if(t.y<i)return this._getNewSelectionStartFromOffset(t,n,r,s+a,p)}if(typeof o=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(e,t,n,r,i){var s=e.x-t,o=n-e.x,u=o>s?0:1,a=r+u;return this.flipX&&(a=i-a),a>this.text.length&&(a=this.text.length),a}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing)return;if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else{if(!(e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey)))return;this[this._ctrlKeysMap[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.renderAll()},forwardDelete:function(e){this.selectionStart===this.selectionEnd&&this.moveCursorRight(e),this.removeChars(e)},copy:function(e){var t=this.getSelectedText(),n=this._getClipboardData(e);n&&n.setData("text",t),this.copiedText=t,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(e){var t=null,n=this._getClipboardData(e);n?t=n.getData("text"):t=this.copiedText,t&&this.insertChars(t,!0)},cut:function(e){if(this.selectionStart===this.selectionEnd)return;this.copy(),this.removeChars(e)},_getClipboardData:function(e){return e&&(e.clipboardData||fabric.window.clipboardData)},onKeyPress:function(e){if(!this.isEditing||e.metaKey||e.ctrlKey)return;e.which!==0&&this.insertChars(String.fromCharCode(e.which)),e.stopPropagation()},getDownCursorOffset:function(e,t){var n=t?this.selectionEnd:this.selectionStart,r,i,s=this.text.slice(0,n),o=this.text.slice(n),u=s.slice(s.lastIndexOf("\n")+1),a=o.match(/(.*)\n?/)[1],f=(o.match(/.*\n(.*)\n?/)||{})[1]||"",l=this.get2DCursorLocation(n);if(l.lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34)return this.text.length-n;var c=this._getLineWidth(this.ctx,l.lineIndex);i=this._getLineLeftOffset(c);var h=i,p=l.lineIndex;for(var d=0,v=u.length;d<v;d++)r=u[d],h+=this._getWidthOfChar(this.ctx,r,p,d);var m=this._getIndexOnNextLine(l,f,h);return a.length+1+m},_getIndexOnNextLine:function(e,t,n){var r=e.lineIndex+1,i=this._getLineWidth(this.ctx,r),s=this._getLineLeftOffset(i),o=s,u=0,a;for(var f=0,l=t.length;f<l;f++){var c=t[f],h=this._getWidthOfChar(this.ctx,c,r,f);o+=h;if(o>n){a=!0;var p=o-h,d=o,v=Math.abs(p-n),m=Math.abs(d-n);u=m<v?f+1:f;break}}return a||(u=t.length),u},moveCursorDown:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var t=this.getDownCursorOffset(e,this._selectionDirection==="right");e.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t),this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+e),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var e=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(e)},moveCursorDownWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),this._selectionDirection==="right"?this.setSelectionEnd(this.selectionEnd+e):this.setSelectionStart(this.selectionStart+e),this.selectionEnd<this.selectionStart&&this._selectionDirection==="left"&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(e,t){var n=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(n);if(r.lineIndex===0||e.metaKey||e.keyCode===33)return n;var i=this.text.slice(0,n),s=i.slice(i.lastIndexOf("\n")+1),o=(i.match(/\n?(.*)\n.*$/)||{})[1]||"",u,a=this._getLineWidth(this.ctx,r.lineIndex),f=this._getLineLeftOffset(a),l=f,c=r.lineIndex;for(var h=0,p=s.length;h<p;h++)u=s[h],l+=this._getWidthOfChar(this.ctx,u,c,h);var d=this._getIndexOnPrevLine(r,o,l);return o.length-d+s.length},_getIndexOnPrevLine:function(e,t,n){var r=e.lineIndex-1,i=this._getLineWidth(this.ctx,r),s=this._getLineLeftOffset(i),o=s,u=0,a;for(var f=0,l=t.length;f<l;f++){var c=t[f],h=this._getWidthOfChar(this.ctx,c,r,f);o+=h;if(o>n){a=!0;var p=o-h,d=o,v=Math.abs(p-n),m=Math.abs(d-n);u=m<v?f:f-1;break}}return a||(u=t.length-1),u},moveCursorUp:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var t=this.getUpCursorOffset(e,this._selectionDirection==="right");e.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t),this.initDelayedCursor()},moveCursorUpWithShift:function(e){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),this._selectionDirection==="right"?this.setSelectionEnd(this.selectionEnd-e):this.setSelectionStart(this.selectionStart-e),this.selectionEnd<this.selectionStart&&this._selectionDirection==="right"&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(e){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-e),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor()},_move:function(e,t,n){var r=t==="selectionStart"?"setSelectionStart":"setSelectionEnd";e.altKey?this[r](this["findWordBoundary"+n](this[t])):e.metaKey||e.keyCode===35||e.keyCode===36?this[r](this["findLineBoundary"+n](this[t])):this[r](this[t]+(n==="Left"?-1:1))},_moveLeft:function(e,t){this._move(e,t,"Left")},_moveRight:function(e,t){this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(e){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.setSelectionStart(this.selectionStart-1))},moveCursorRight:function(e){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length)return;this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor()},moveCursorRightWithShift:function(e){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.setSelectionEnd(this.selectionEnd+1))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){if(this.selectionStart!==0)if(e.metaKey){var t=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(t,this.selectionStart),this.setSelectionStart(t)}else if(e.altKey){var n=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(n,this.selectionStart),this.setSelectionStart(n)}else{var r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n";this.removeStyleObject(r),this.setSelectionStart(this.selectionStart-1),this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(e,t,n,r,i,s){this.styles[e]?this._setSVGTextLineChars(e,t,n,r,s):this.callSuper("_setSVGTextLineText",e,t,n,r,i)},_setSVGTextLineChars:function(e,t,n,r,i){var s=this._textLines[e].split(""),o=0,u=this._getSVGLineLeftOffset(e)-this.width/2,a=this._getSVGLineTopOffset(e),f=this._getHeightOfLine(this.ctx,e);for(var l=0,c=s.length;l<c;l++){var h=this.styles[e][l]||{};t.push(this._createTextCharSpan(s[l],h,u,a.lineTop+a.offset,o));var p=this._getWidthOfChar(this.ctx,s[l],e,l);h.textBackgroundColor&&i.push(this._createTextCharBg(h,u,a.lineTop,f,p,o)),o+=p}},_getSVGLineLeftOffset:function(e){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[e]),2)},_getSVGLineTopOffset:function(e){var t=0,n=0;for(var r=0;r<e;r++)t+=this._getHeightOfLine(this.ctx,r);return n=this._getHeightOfLine(this.ctx,r),{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(e,t,n,r,i,s){return['<rect fill="',e.textBackgroundColor,'" x="',t+s,'" y="',n-this.height/2,'" width="',i,'" height="',r/this.lineHeight,'"></rect>'].join("")},_createTextCharSpan:function(e,t,n,r,i){var s=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',n+i,'" y="',r-this.height/2,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',s,'">',fabric.util.string.escapeXml(e),"</tspan>"].join("")}}),function(){function request(e,t,n){var r=URL.parse(e);r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);var i=r.protocol.indexOf("https:")===0?HTTPS:HTTP,s=i.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(e){var r="";t&&e.setEncoding(t),e.on("end",function(){n(r)}),e.on("data",function(t){e.statusCode===200&&(r+=t)})});s.on("error",function(e){e.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(e.message)}),s.end()}function requestFs(e,t){var n=require("fs");n.readFile(e,function(e,n){if(e)throw fabric.log(e),e;t(n)})}if(typeof document!="undefined"&&typeof window!="undefined")return;var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(e,t,n){function r(r){i.src=new Buffer(r,"binary"),i._src=e,t&&t.call(n,i)}var i=new Image;e&&(e instanceof Buffer||e.indexOf("data")===0)?(i.src=i._src=e,t&&t.call(n,i)):e&&e.indexOf("http")!==0?requestFs(e,r):e?request(e,"binary",r):t&&t.call(n,e)},fabric.loadSVGFromURL=function(e,t,n){e=e.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),e.indexOf("http")!==0?requestFs(e,function(e){fabric.loadSVGFromString(e.toString(),t,n)}):request(e,"",function(e){fabric.loadSVGFromString(e,t,n)})},fabric.loadSVGFromString=function(e,t,n){var r=(new DOMParser).parseFromString(e);fabric.parseSVGDocument(r.documentElement,function(e,n){t&&t(e,n)},n)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){var r=new fabric.Image(n);r._initConfig(e),r._initFilters(e,function(e){r.filters=e||[],t&&t(r)})})},fabric.createCanvasForNode=function(e,t,n,r){r=r||n;var i=fabric.document.createElement("canvas"),s=new Canvas(e||600,t||600,r);i.style={},i.width=s.width,i.height=s.height;var o=fabric.Canvas||fabric.StaticCanvas,u=new o(i,n);return u.contextContainer=s.getContext("2d"),u.nodeCanvas=s,u.Font=Canvas.Font,u},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){return this.nodeCanvas.createJPEGStream(e)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(e,t){return origSetWidth.call(this,e,t),this.nodeCanvas.width=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(e,t){return origSetHeight.call(this,e,t),this.nodeCanvas.height=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}();
function invalid_input_msg(obj,msg,class_name){class_name=typeof(class_name)=='undefined'?'mandatory':class_name;obj.className+=" "+class_name;if(typeof(top.fAlert)!="undefined"){top.fAlert(msg);}else if(typeof(fancyAlert)!="undefined"){top.fancyAlert(msg);}
obj.select();obj.focus();obj.value='';}
String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};String.prototype.trimMultiSpace=function(){return this.replace(/\s{2,}/g," ");};String.prototype.trimHyphen=function(){return this.replace(/^\-|\-$/g,"");};String.prototype.trimMultiHyphen=function(){return this.replace(/\-{2,}/g,"-");};function set_phone_format(objPhone,default_format,phone_length,msg_txt,class_name){phone_length=phone_length||top.phone_length;phone_min_length=top.phone_min_length;default_format=default_format||top.phone_format;msg_txt=msg_txt||"phone";class_name=typeof(class_name)=='undefined'?'mandatory':class_name;phone_reg_exp_js=(typeof(top.phone_reg_exp_js)!="undefined"&&typeof(top.phone_reg_exp_js)!=null&&top.phone_reg_exp_js!='')?top.phone_reg_exp_js:"[^0-9+]";regExp=new RegExp(phone_reg_exp_js,'g');var refinedPh=objPhone.value.replace(regExp,"");refinedPh=refinedPh.trim();refinedPh=refinedPh.trimHyphen();refinedPh=refinedPh.trimMultiHyphen();refinedPh=refinedPh.trimMultiSpace();if(refinedPh.length<phone_min_length){invalid_input_msg(objPhone,"Please Enter a valid "+msg_txt+" number",class_name);return;}else{refinedPh=refinedPh.substr(0,phone_length);switch(default_format){case"###-###-####":objPhone.value=refinedPh.substring(0,3)+"-"+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,10);break;case"(###) ###-####":objPhone.value="("+refinedPh.substring(0,3)+") "+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,10);break;case"(##) ###-####":objPhone.value="("+refinedPh.substring(0,2)+") "+refinedPh.substring(2,5)+"-"+refinedPh.substring(5,9);break;case"(###) ###-###":objPhone.value="("+refinedPh.substring(0,3)+") "+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,9);break;case"(####) ######":objPhone.value="("+refinedPh.substring(0,4)+") "+refinedPh.substring(4,10);break;case"(####) #####":objPhone.value="("+refinedPh.substring(0,4)+") "+refinedPh.substring(4,9);break;case"(#####) #####":objPhone.value="("+refinedPh.substring(0,5)+") "+refinedPh.substring(5,10);break;case"(#####) ####":objPhone.value="("+refinedPh.substring(0,5)+") "+refinedPh.substring(5,9);break;default:objPhone.value=refinedPh;break;}}}
function core_phone_format(phone,default_format,phone_length){phone_length=phone_length||top.phone_length;phone_min_length=top.phone_min_length;default_format=default_format||top.phone_format;phone_reg_exp_js=(typeof(top.phone_reg_exp_js)!="undefined"&&typeof(top.phone_reg_exp_js)!=null&&top.phone_reg_exp_js!='')?top.phone_reg_exp_js:"[^0-9+]";regExp=new RegExp(phone_reg_exp_js,'g');var refinedPh=phone.replace(regExp,"");refinedPh=refinedPh.trim();refinedPh=refinedPh.trimHyphen();refinedPh=refinedPh.trimMultiHyphen();refinedPh=refinedPh.trimMultiSpace();var formatted_phone='';if(refinedPh.length<phone_min_length){return formatted_phone;}else{refinedPh=refinedPh.substr(0,phone_length);switch(default_format){case"###-###-####":formatted_phone=refinedPh.substring(0,3)+"-"+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,10);break;case"(###) ###-####":formatted_phone="("+refinedPh.substring(0,3)+") "+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,10);break;case"(##) ###-####":formatted_phone="("+refinedPh.substring(0,2)+") "+refinedPh.substring(2,5)+"-"+refinedPh.substring(5,9);break;case"(###) ###-###":formatted_phone="("+refinedPh.substring(0,3)+") "+refinedPh.substring(3,6)+"-"+refinedPh.substring(6,9);break;case"(####) ######":formatted_phone="("+refinedPh.substring(0,4)+") "+refinedPh.substring(4,10);break;case"(####) #####":formatted_phone="("+refinedPh.substring(0,4)+") "+refinedPh.substring(4,9);break;case"(#####) #####":formatted_phone="("+refinedPh.substring(0,5)+") "+refinedPh.substring(5,10);break;case"(#####) ####":formatted_phone="("+refinedPh.substring(0,5)+") "+refinedPh.substring(5,9);break;default:formatted_phone=refinedPh;break;}
return formatted_phone;}}
function isDefined(variable){return(!(!(variable||false)))}
window.onload=make_maindiv_full;function make_maindiv_full(){wh=window.screen.availHeight-100;if(isDefined(dgi('main'))){dgi('main').style.height=wh+'px';if(isDefined(dgi('iMedicDiv')))dgi('iMedicDiv').style.height=wh-180+"px";if(isDefined(dgi('iMedicFrame')))dgi('iMedicFrame').style.height=wh-182+"px";}}
function foo(){}
function ele(id,task){dgi(id).style.display=task;}
function dgi(id){return document.getElementById(id);}
function dgn(name){return document.getElementsByName(name);}
function dgt(tag){return document.getElementsByTagName(tag);}
function charlimit(field,count,showin){var tex=field.value;var len=tex.length;if(len>count){tex=tex.substring(0,count);field.value=tex;return false;}dgi(showin).innerHTML=count-len;}
function trim(val){return val.replace(/^\s+|\s+$/,'');}
function alphanum(o,w){var r={'special':/[\W]/g};o.value=o.value.replace(r[w],'');}
function emv(entered){with(entered){apos=entered.indexOf("@");dotpos=entered.lastIndexOf(".");lastpos=entered.length-1;if(apos<1||dotpos-apos<2||lastpos-dotpos>3||lastpos-dotpos<2){return false;}else{return true;}}}
function wl(url){window.location.href=url;}
function pageWidth(){return window.innerWidth!=null?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body!=null?document.body.clientWidth:null;}
function pageHeight(){return window.innerHeight!=null?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body!=null?document.body.clientHeight:null;}
function topPosition(){return typeof window.pageYOffset!='undefined'?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0;}
function leftPosition(){return typeof window.pageXOffset!='undefined'?window.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft?document.body.scrollLeft:0;}
function fancyAlert(msg,title,callback,obj,facnyBtn1,facnyBtn2,func1,func2,mask,maskOpacity,width,height_adjustment,autoClose,showClose,left,top,drag,facnyBtn3,func3){var isCenter="";left=left||"";top=top||"";if(typeof(width)=="undefined")width=300;if(typeof(autoClose)=="undefined"||!autoClose)autoClose="yes";if(typeof(title)!="string")title='imwemr';if(title=="")title='imwemr';if(callback==null){callback='';}
if(!facnyBtn1){facnyBtn1='OK';}
if(!facnyBtn2){facnyBtn2=false;}
if(!facnyBtn3){facnyBtn3=false;}
if(!func1){func1=callback;}
if(!func2){func2=callback;}
if(!func3){func3=callback;}
if(typeof(mask)!="boolean"){mask=true;}
if(typeof(drag)!="boolean"){drag=true;}
if(autoClose=="yes"){func1='closeDialog();'+func1;func2='closeDialog();'+func2;}
if((left!="")||(top!="")){isCenter=false}
dialogBox(title,msg,facnyBtn1,facnyBtn2,func1,func2,false,mask,drag,callback,width,"",isCenter,left,top,showClose,obj,maskOpacity,height_adjustment,facnyBtn3,func3);}
function dialogBox(title,msgg,btn1,btn2,func1,func2,btnCancel,mask,drag,callback,w,h,isCenter,l,t,showClose,inThis,maskOpacity,height_adjustment,btn3,func3)
{var text='';if((typeof(w)=="string"&&w=='default')||typeof(w)=="undefined"||w<=0){w="500px";}else{w=(parseInt(w)+60)+"px";}
if((typeof(h)=="string"&&h=='default')||typeof(h)=="undefined"||h<=0){h="auto";}else{h=parseInt(h)+"px";}
if(typeof(isCenter)!="boolean"){isCenter=true;}
if(!maskOpacity){maskOpacity=50;maskBrowserOpacity=0.5;}
if(typeof(mask)!="boolean"){mask=false;maskOpacity=0;maskBrowserOpacity=0;}
if(maskOpacity>0){maskBrowserOpacity=maskOpacity/100;}
if(typeof(drag)!="boolean"){drag=false;}
if(typeof(btnCancel)!="boolean"){btnCancel=false;}
if(typeof(showClose)!="boolean"){showClose=true;}
var width=pageWidth();var height=pageHeight();var left=leftPosition();var topP=topPosition();if(typeof(l)!="undefined"&&!isCenter){left=l+"px";}
if(typeof(t)!="undefined"&&!isCenter){topP=t+"px";}
var dialogwidth=w;var dialogheight=h;var topposition=100;var leftposition=parseInt(left)+(width/2)-(parseInt(dialogwidth)/2);if(typeof(dialogBoxCounter)=="undefined")dialogBoxCounter=0;else dialogBoxCounter++;if(callback==null){callback=false;}else if(callback==''){callback=false;}
var butonnsArr=new Array();YsAction=NoAction=ThirdAction='';if(typeof(btn1)=="string"&&typeof(func1)=="string"){butonnsArr[0]={'id':0,'label':btn1,'val':'Y'}
YsAction=func1;if(YsAction.indexOf('window.top.')==-1&&YsAction.indexOf('top.')==0){YsAction="window."+YsAction;}}
if(typeof(btn2)=="string"&&typeof(func2)=="string"){butonnsArr[butonnsArr.length]={'id':1,'label':btn2,'val':'N'}
if(func2!='return'&&func2!='return false'){NoAction=func2;if(NoAction!=false&&NoAction.indexOf('window.top.')==-1&&NoAction.indexOf('top.')==0){NoAction="window."+NoAction;}}}
if(typeof(btn3)=="string"&&typeof(func3)=="string"){butonnsArr[butonnsArr.length]={'id':2,'label':btn3,'val':'three'}
if(func3!='return'&&func3!='return false'){ThirdAction=func3;if(ThirdAction!=false&&ThirdAction.indexOf('window.top.')==-1&&ThirdAction.indexOf('top.')==0){ThirdAction="window."+NoAction;}}}
MessiOptionsArr={'title':title,'modal':true,'closeButton':true,'width':w,'height':h,'buttons':butonnsArr,'callback':function(val){if(val=='Y'){eval(YsAction);}else if(val=='N'&&NoAction!=false){eval(NoAction);}else if(val=='three'&&ThirdAction!=false){eval(ThirdAction);}}};max_h=parseInt(height)-180;msgg='<div style="max-height:'+max_h+'px; overflow:auto;">'+msgg+'</div>';new window.top.Messi(msgg,MessiOptionsArr);}
function closeDialog(callback){return;if(callback==null){callback=false;}else if(callback==''){callback=false;}else{callback='function(){'+callback+';}';}
$('body .dialogMask').fadeOut('slow');$('#divCon').fadeOut('slow');$('#divCon').parent('div,span').html('');}
var DragHandler={_oElem:null,attach:function(oElem){oElem.onmousedown=DragHandler._dragBegin;oElem.dragBegin=new Function();oElem.drag=new Function();oElem.dragEnd=new Function();return oElem;},_dragBegin:function(e){var oElem=DragHandler._oElem=this;if(isNaN(parseInt(oElem.style.left))){oElem.style.left='0px';}
if(isNaN(parseInt(oElem.style.top))){oElem.style.top='0px';}
var x=parseInt(oElem.style.left);var y=parseInt(oElem.style.top);e=e?e:window.event;oElem.mouseX=e.clientX;oElem.mouseY=e.clientY;oElem.dragBegin(oElem,x,y);document.onmousemove=DragHandler._drag;document.onmouseup=DragHandler._dragEnd;return false;},_drag:function(e){var oElem=DragHandler._oElem;var x=parseInt(oElem.style.left);var y=parseInt(oElem.style.top);e=e?e:window.event;oElem.style.left=x+(e.clientX-oElem.mouseX)+'px';oElem.style.top=y+(e.clientY-oElem.mouseY)+'px';oElem.mouseX=e.clientX;oElem.mouseY=e.clientY;oElem.drag(oElem,x,y);return false;},_dragEnd:function(){var oElem=DragHandler._oElem;var x=parseInt(oElem.style.left);var y=parseInt(oElem.style.top);oElem.dragEnd(oElem,x,y);document.onmousemove=null;document.onmouseup=null;DragHandler._oElem=null;}}
function isScrolledV(id){id='#'+id;OuterHeight=$(id).height();InnerHeight=$(id).prop('scrollHeight');Scrolled=$(id).scrollTop();if(OuterHeight+Scrolled>=InnerHeight)return true;else return false;}
window.document.onkeydown=function(event)
{switch(event.keyCode){case 121:event.returnValue=false;event.keyCode=0;alert('This will Close all the work and LogOut');return false;break;case 122:event.returnValue=false;event.keyCode=0;top.preview_patient_details(event);return false;break;case 27:case 116:do_audit='no';auditHome='no';audit='no';var switchUser=($("#div_switch_user").data('bs.modal')||{}).isShown;if(switchUser===true){return false;}
break;case 82:if(event.ctrlKey){do_audit='no';auditHome='no';audit='no';var switchUser=($("#div_switch_user").data('bs.modal')||{}).isShown;if(switchUser===true){event.preventDefault();return false;}}
break;}}
window.document.oncontextmenu=function(event){var switchUser=($("#div_switch_user").data('bs.modal')||{}).isShown;if(switchUser===true){event.stopPropagation();return false;}}
function fAlert(msg,title,actionToPerform,width,height,BtnCaption,ModalMode){if(typeof(title)=='undefined'||title=='')title='imwemr';if(typeof(actionToPerform)=='undefined')actionToPerform='';if(typeof(width)=='undefined'||width=='')width='500px';if(typeof(height)=='undefined'||height=='')height='auto';if(typeof(BtnCaption)=='undefined'||BtnCaption=='')BtnCaption='OK';if(typeof(ModalMode)!='boolean')ModalMode=true;if(BtnCaption=='CLOSE'||BtnCaption=='Close'){closeBtn=false;}else{closeBtn=true;}
msg='<div style="max-height:500px; overflow:auto;">'+msg+'</div>';if(typeof(Messi)=='function'){new Messi(msg,{'title':title,modal:ModalMode,'width':width,'closeButton':closeBtn,buttons:[{id:0,label:BtnCaption,val:'X'}],callback:function(){if(typeof(actionToPerform)=='string'&&actionToPerform!=''&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')>=0){actionToPerform;}else if(typeof(actionToPerform)=='string'&&actionToPerform!=''&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')<0){eval(actionToPerform);}else if(typeof(actionToPerform)=='object'){actionToPerform.focus();}}});}else if(typeof(window.top.Messi)=='function'){new window.top.Messi(escape(msg),{'title':title,modal:ModalMode,'width':width,'closeButton':closeBtn,buttons:[{id:0,label:BtnCaption,val:'X'}],callback:function(){if(typeof(actionToPerform)=='string'&&actionToPerform!=''&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')>=0){actionToPerform;}else if(typeof(actionToPerform)=='string'&&actionToPerform!=''&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')<0){eval(actionToPerform);}else if(typeof(actionToPerform)=='object'){actionToPerform.focus();}}});}}
function fancyConfirm(msg,title,YsAction,NoAction,width,height,btn1,btn2){if(typeof(YsAction)=='undefined'){YsAction=title;title='';}
if(typeof(title)=='undefined'||title=='')title='imwemr';if(typeof(width)=='undefined'||width=='')width='500px';if(typeof(NoAction)=='undefined'||NoAction=='')NoAction=false;if(YsAction.indexOf('window.top.')==-1&&YsAction.indexOf('top.')==0){YsAction="window."+YsAction;}
if(NoAction!=false&&NoAction.indexOf('window.top.')==-1&&NoAction.indexOf('top.')==0){NoAction="window."+NoAction;}
if(typeof(btn1)=='undefined'||btn1=='')btn1='Yes';if(typeof(btn2)=='undefined'||btn2=='')btn2='No';new window.top.Messi(msg,{'title':title,modal:true,'width':width,buttons:[{id:0,label:btn1,val:'Y',"class":'btn-success'},{id:1,label:btn2,val:'N',"class":'btn-danger'}],callback:function(val){if(val=='Y'){eval(YsAction);}else if(val=='N'&&NoAction!=false){eval(NoAction);}}});}
function fancyModal(html,title,w,h,closeBtn,po,ModalMode){if(typeof(title)!="string")title=null;if(typeof(w)!="string")w='';if(typeof(h)!="string")h='';if(typeof(closeBtn)=="undefined")closeBtn=true;if(typeof(po)!='undefined'){of=$(po).offset();}else po=false;if(typeof(ModalMode)!='boolean')ModalMode=true;if(po){new top.Messi(html,{'title':title,modal:ModalMode,'width':w,'height':h,'closeButton':closeBtn,center:false,viewport:{top:of.top+25,left:of.left+25}});}
else{new top.Messi(html,{'title':title,modal:ModalMode,'width':w,'height':h,'closeButton':closeBtn});}}
function removeMessi(){window.top.$('.messi-modal,.messi').remove();}
if(typeof($)!='undefined'){$(document).ready(function(e){$('form, input').attr('autocomplete','off');});$(document).ajaxComplete(function(event,request,settings){if(request.getResponseHeader('REQUIRES_AUTH')==='1'){top.window.location=top.JS_WEB_ROOT_PATH+'/interface/login/index.php';}});}
function fnArrDate(dateString,format){dateString=dateString||'';format=format||'yyyy-mm-dd'
separator=get_date_separator(dateString)
arrBirthDate=dateString.split(separator);switch(format){case"dd"+separator+"mm"+separator+"yyyy":date=arrBirthDate[0];month=arrBirthDate[1];year=arrBirthDate[2];break;case"mm"+separator+"dd"+separator+"yyyy":month=arrBirthDate[0];date=arrBirthDate[1];year=arrBirthDate[2];break;case"yyyy"+separator+"mm"+separator+"dd":year=arrBirthDate[0];month=arrBirthDate[1];date=arrBirthDate[2];break;case"yyyy"+separator+"dd"+separator+"mm":year=arrBirthDate[0];month=arrBirthDate[2];date=arrBirthDate[1];break;default:month=arrBirthDate[0];date=arrBirthDate[1];year=arrBirthDate[2];}
return[year,month,date]}
function get_date_separator(date){date=date||'';separator='-';if(date.search("-")!="-1")
separator="-";else if(date.search("/")!="-1")
separator="/";else if(date.search("/\\/")!="-1")
separator="\\";return separator;}
function validate_date(objName,format){date=typeof(objName)=="object"?objName.value:objName;if(date!=''){if(typeof(top.jquery_date_format)!="undefined"){jquery_date_format=top.jquery_date_format;}else if(typeof(opener.top.jquery_date_format)!="undefined"){jquery_date_format=opener.top.jquery_date_format;}else if(typeof(top.opener.top.jquery_date_format)!="undefined"){jquery_date_format=top.opener.top.jquery_date_format;}
format=format||jquery_date_format;separator=get_date_separator(format);var regex="";switch(format){case"dd"+separator+"mm"+separator+"yyyy":var regex=new RegExp("(((0[1-9]|[12][0-9]|3[01])["+separator+"](0[13578]|1[02])["+separator+"](19|20[0-9]{2}))|((0[1-9]|[12][0-9]|3[0])["+separator+"](0[469]|1[1])["+separator+"](19|20[0-9]{2}))|((0[1-9]|1[0-9]|2[0-9])["+separator+"](02)["+separator+"]((19|20)(04|08|[2468][048]|[13579][26])))|((0[1-9]|1[0-9]|2[0-8])["+separator+"](02)["+separator+"]((19|20)[0-9]{2})))");if(typeof(objName)=="object")
date=date.replace(/(\d{2})(\d{2})(\d{4})/,'$1'+separator+'$2'+separator+'$3');break;case"mm"+separator+"dd"+separator+"yyyy":var regex=new RegExp("(((0[13578]|1[02])["+separator+"](0[1-9]|[12][0-9]|3[01])["+separator+"](19|20[0-9]{2}))|((0[469]|1[1])["+separator+"](0[1-9]|[12][0-9]|3[0])["+separator+"](19|20[0-9]{2}))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-9])["+separator+"]((19|20)(04|08|[2468][048]|[13579][26])))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-8])["+separator+"]((19|20)[0-9]{2})))");if(typeof(objName)=="object")
date=date.replace(/(\d{2})(\d{2})(\d{4})/,'$1'+separator+'$2'+separator+'$3');break;case"mm"+separator+"dd"+separator+"yy":alert("mm"+separator+"dd"+separator+"yy");var regex=new RegExp("(((0[13578]|1[02])["+separator+"](0[1-9]|[12][0-9]|3[01])["+separator+"](19|20[0-9]{2}))|((0[469]|1[1])["+separator+"](0[1-9]|[12][0-9]|3[0])["+separator+"](19|20[0-9]{2}))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-9])["+separator+"]((19|20)(04|08|[2468][048]|[13579][26])))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-8])["+separator+"]((19|20)[0-9]{2})))");if(typeof(objName)=="object")
date=date.replace(/(\d{2})(\d{2})(\d{2})/,'$1'+separator+'$2'+separator+'$3');break;case"yyyy"+separator+"mm"+separator+"dd":var regex=new RegExp("(((19|20[0-9]{2})["+separator+"](0[13578]|1[02])["+separator+"](0[1-9]|[12][0-9]|3[01]))|((19|20[0-9]{2})["+separator+"](0[469]|1[1])["+separator+"](0[1-9]|[12][0-9]|3[0]))|(((19|20)(04|08|[2468][048]|[13579][26]))["+separator+"](02)["+separator+"](0[1-9]|1[0-9]|2[0-9]))|(((19|20)[0-9]{2}["+separator+"](02)["+separator+"](0[1-9]|1[0-9]|2[0-8]))))");if(typeof(objName)=="object")
date=date.replace(/(\d{4})(\d{2})(\d{2})/,'$1'+separator+'$2'+separator+'$3');break;case"yyyy"+separator+"dd"+separator+"mm":var regex=new RegExp("(((19|20[0-9]{2})["+separator+"](0[1-9]|[12][0-9]|3[01])["+separator+"](0[13578]|1[02]))|((19|20[0-9]{2})["+separator+"](0[1-9]|[12][0-9]|3[0])["+separator+"](0[469]|1[1]))|(((19|20)(04|08|[2468][048]|[13579][26]))["+separator+"](0[1-9]|1[0-9]|2[0-9])["+separator+"](02))|(((19|20)[0-9]{2}["+separator+"](0[1-9]|1[0-9]|2[0-8])["+separator+"](02))))");if(typeof(objName)=="object")
date=date.replace(/(\d{4})(\d{2})(\d{2})/,'$1'+separator+'$2'+separator+'$3');break;default:var regex=new RegExp("(((0[13578]|1[02])["+separator+"](0[1-9]|[12][0-9]|3[01])["+separator+"](19|20[0-9]{2}))|((0[469]|1[1])["+separator+"](0[1-9]|[12][0-9]|3[0])["+separator+"](19|20[0-9]{2}))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-9])["+separator+"]((19|20)(04|08|[2468][048]|[13579][26])))|((02)["+separator+"](0[1-9]|1[0-9]|2[0-8])["+separator+"]((19|20)[0-9]{2})))");if(typeof(objName)=="object")
date=date.replace(/(\d{4})(\d{2})(\d{2})/,'$1'+separator+'$2'+separator+'$3');}
if(regex.test(date)){flag=true;objName.value=date;}
else flag=false;return flag;}}
function getDateFormat(date,inFormat,outFormat){arrDate=fnArrDate(date,inFormat);yy=arrDate[0];mm=arrDate[1];dd=arrDate[2];date_result='';if(date!=''){opener_top_date_format=''
if(opener!=null)opener_top_date_format=opener.top.date_format
outFormat=outFormat||top.date_format||opener_top_date_format;separator=get_date_separator(outFormat);switch(outFormat){case"dd"+separator+"mm"+separator+"yyyy":date_result=dd+separator+mm+separator+yy;break;case"yyyy"+separator+"mm"+separator+"dd":date_result=yy+separator+mm+separator+dd;break;case"yyyy"+separator+"dd"+separator+"mm":date_result=yy+separator+dd+separator+mm;break;default:date_result=mm+separator+dd+separator+yy;}}
return date_result;}
function validate_zip(inpObj){var borwser_name=get_browser();if(typeof(top.int_country)!="undefined"&&top.int_country=="UK")return true;zip_type=(typeof(opener)!='undefined'&&borwser_name!='chrome')?opener.top.zip_type:top.zip_type;switch(zip_type){case"numeric":regex=new RegExp("^[0-9- ]{0,"+top.zip_length+"}$","gi");replaceExp=new RegExp("[^0-9- ]","gi");break;case"alphanumeric":regex=new RegExp("^[0-9a-zA-Z- ]{0,"+top.zip_length+"}$","gi");replaceExp=new RegExp("[^0-9a-zA-Z- ]","gi");break;default:regex=new RegExp("^[0-9- ]{0,"+top.zip_length+"}$","gi");replaceExp=new RegExp("[^0-9- ]","gi");}
zip=inpObj.value;newZip='';if(zip!="")
newZip=zip.replace(replaceExp,"");if(zip!=newZip)
inpObj.value=newZip
if(regex.test(zip))
return true
else{return false;}}
function validate_ssn(objName,format,length){ssn=typeof(objName)=="object"?objName.value:objName;format=format||top.ssn_format;length=length||top.ssn_length;ssn_reg_exp_js=(typeof(top.ssn_reg_exp_js)!="undefined"&&typeof(top.ssn_reg_exp_js)!=null&&top.ssn_reg_exp_js!='')?top.ssn_reg_exp_js:"[^0-9\-+]";regExp=new RegExp(ssn_reg_exp_js,'g');refinedSSN=ssn.replace(regExp,"");refinedSSN=refinedSSN.replace(/[^0-9A-Za-z+]/g,'');refinedSSN=refinedSSN.substr(0,length);ssnLength=refinedSSN.replace(/[^0-9A-Za-z+]/g,'').length;if(ssnLength>0&&((format!=''&&ssnLength!=length)||(format==''&&ssnLength>length))){if(typeof(opener)!="undefined"){top.fAlert("Invalid Social Security Number (SSN)");}else{top.fAlert("Invalid Social Security Number (SSN)");}
objName.value='';return false;}else{switch(format){case"###-###-####":objName.value=refinedSSN.replace(/(\d{3})(\d{3})(\d{4})/,'$1-$2-$3');break;case"###-##-####":objName.value=refinedSSN.replace(/(\d{3})(\d{2})(\d{4})/,'$1-$2-$3');break;default:objName.value=refinedSSN;}}
return true;}
function checkdate(objName,type){type=type||'';if(validate_date(objName,type)==false&&objName.value!=''){objName.value="";objName.focus();if(typeof(opener)=='undefined'&&typeof(top.opener)=='undefined'){fAlert('Please enter a valid Date');top.document.getElementById("divCommonAlertMsg").style.display="block";}else{fAlert('Please enter a valid Date');}
return false;}
else{return true;}}
function get_browser(){browser='';if(navigator.userAgent.indexOf("MSIE")!=-1||!!navigator.userAgent.match(/Trident\/7\./)){browser="ie";}
else if(typeof(window.mozilla)=="object"){browser="mozilla";}
else if(typeof(window.chrome)=="object"){browser="chrome";}else if(navigator.userAgent.indexOf("Safari")!=-1){browser="safari";}
return browser;}
function show_clock(){var newDate=new Date();var C=new Date(newDate);var h=C.getHours();var m=C.getMinutes();var s=C.getSeconds();var dn="PM";if(h<12)dn="AM";if(h>12)h=h-12;if(h==0)h=12;if(h<=9)h="0"+h;if(m<=9)m="0"+m;if(s<=9)s="0"+s;var tm=h+":"+m+":"+s+" "+dn;dgi("tick2").innerHTML=tm;setTimeout("show_clock()",1000);}
function set_caret_position(elemId,caretPos)
{var elem=document.getElementById(elemId);if(elem!=null)
{if(elem.createTextRange)
{var range=elem.createTextRange();range.move('character',caretPos);range.select();}
else
{if(elem.selectionStart)
{elem.focus();elem.setSelectionRange(caretPos,caretPos);}
else
elem.focus();}}}
function get_focus_obj(obj)
{var obj_id=obj.id;if(document.getElementById(obj_id))
{var str=document.getElementById(obj_id).value;if(str&&str.length>0)
set_caret_position(obj_id,str.length);}}
function alert_notification_show(m)
{o1=$('#div_alert_notifications');o2=$('#div_alert_notifications').find('.notification_span').html(m);o1.fadeIn('slow');ACT=2;t=setInterval(function(){if(ACT>0){ACT--;}else{clearInterval(t);o1.fadeOut('slow');o2.html('');}},1000);}
function show_modal(div_id,header_title,content,footer_cont,cont_height,size,dismissible,cross_btn){if(header_title==''||typeof(header_title)!='string'){header_title='imwemr';}
if(footer_cont==''||typeof(footer_cont)!='string'){footer_cont='<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>';}
if(cont_height==''||typeof(cont_height)!='string'){cont_height='300';}
var cross_btn_html='<button type="button" class="close" data-dismiss="modal"></button>';if(typeof(cross_btn)!=='undefined'&&cross_btn!=''){cross_btn_html='';}
var header_content='<div class="modal-header bg-primary">'+cross_btn_html+'<h4 class="modal-title">'+header_title+'</h4></div>';var body_content='<div class="modal-body" style="max-height:'+cont_height+'px;overflow:auto;overflow-y:scroll">'+content+'</div>';var footer_content='<div id="module_buttons" class="modal-footer ad_modal_footer"><div class="col-sm-12">'+footer_cont+'</div></div>';var final_str=header_content+body_content+footer_content;var modal='';modal+='<div class="common_modal_wrapper">';modal+='<div class="modal-dialog '+size+'"><div class="modal-content">'+final_str+'</div></div>';modal+='</div>';if($('#'+div_id+'').length>0){$('#'+div_id+'').html(modal);}else{$('body').append('<div class="modal" id="'+div_id+'" role="dialog"><div>');$('#'+div_id+'').html(modal);}
if(dismissible!='false'){$('#'+div_id+'').modal({backdrop:'static',keyboard:false,});}
$('#'+div_id+'').modal('show');return false;}
function checkIfAlphabet(e,ctrlId)
{txtVal='';var txtVal=dgi(ctrlId).value;if(txtVal!=''){var unicode=e.keyCode?e.keyCode:e.charCode;if(!(unicode>=65&&unicode<=90)&&!(unicode==8||unicode==46||unicode==13||unicode==9||unicode==16||unicode==17||unicode==18||unicode==37||unicode==38||unicode==39||unicode==40||unicode==32)){alert("Only Character values accepted");var rightVal=txtVal.substr(0,parseInt(txtVal.length)-1);dgi(ctrlId).value=rightVal;return false;}}}
function imw_msg_js(key){var msgArray={'no_rec':'No record found.','drop_sel':'Please Select.','sel_rec':'Please select a record.','del_rec':'Are you sure to delete the selected record(s) ?'};if(key!=""){return msgArray[key];}else{return msgArray;}}
function set_val_text(ths,menuId,elemId,liId){if(ths===''||typeof(ths)==='undefined'){if(typeof(liId)!='undefined'){var parent_elem=$('#drop_li_'+liId).parent();parent_elem.find('.dropdown-submenu').each(function(id,elem){if($(elem).attr('id')!='drop_li_'+liId){$(elem).find('.dropdown-menu').removeClass('show');}});}}else{if($('.dropdown-menu').hasClass("show")){$('.dropdown-menu').removeClass('show');$('#'+elemId).parent().find('.open').removeClass('open');}
var elem_val=$(ths).parent().find('input').val();if(elem_val!=''||typeof(elem_val)!='undefined'){$('#'+elemId+'').val(elem_val).change();$('#'+menuId+'').dropdown('toggle');}}}
if(window.jQuery){$(document).ready(function(){$('body').on("click",".dropdown-submenu a",function(e){if($(this).next('ul').hasClass("show")){$('.dropdown-submenu').removeClass('show');}else{$('.dropdown-submenu').removeClass('show');$(this).next('ul').toggleClass('show');}
e.stopPropagation();e.preventDefault();$('.dropdown').on('hide.bs.dropdown',function(){if($('.dropdown-menu .dropdown-submenu').find('ul').hasClass('show')){$('.dropdown-menu .dropdown-submenu').find('ul').removeClass('show').addClass('hide');}});});$('body').on('show.bs.dropdown','.dropdown',function(elem){var target_dropdown=elem.currentTarget;var get_dropDown=$(target_dropdown).find('ul.dropdown-menu').width();var obj_offset=$(target_dropdown).offset();if($(window).width()<(obj_offset.left+get_dropDown)){var difference=$(window).width()-(obj_offset.left+get_dropDown+10);$(target_dropdown).find('ul.dropdown-menu').css('left',difference);}});});}
function reload_simple_menu(id,val){if($('#'+id)){$('#'+id).find('label').remove();var final_val=$('#'+id).html()+val;$('#'+id).html(final_val);}}
function html_to_pdf(html_file_loc,op,pdf_name,on_page,one_page_pdf,call_for){var on_page_dir=false;if(on_page!=''&&typeof(on_page)!='undefined')
{on_page_dir=on_page;}
if(html_file_loc!=''&&typeof(html_file_loc)!='undefined'&&html_file_loc.length>0){if(op==''||typeof(op)=='undefined'){op='p';}
if(pdf_name==''||typeof(pdf_name)=='undefined'){pdf_name='new_pdf';}
if(call_for==''||typeof(call_for)=='undefined'){call_for='html_to_pdf';}
var wo=top.JS_WEB_ROOT_PATH;if(on_page_dir==true)
{if(typeof(wo)=='undefined'){wo=window.opener.top.JS_WEB_ROOT_PATH;}
window.location.href=wo+'/library/'+call_for+'/createPdf.php?onePage='+one_page_pdf+'&op='+op+'&file_location='+html_file_loc+'&pdf_name='+pdf_name+'';}
else
{window.open(''+wo+'/library/'+call_for+'/createPdf.php?onePage='+one_page_pdf+'&op='+op+'&file_location='+html_file_loc+'&pdf_name='+pdf_name+'');}}else{alert('Invalid file location provided');}}
function era_file_fun(){var enc_id="";if(top.fmain.$('#enc_id_read').length>0){enc_id=top.fmain.$('#enc_id_read').val();}
var wname="ERA";var features="width=1200px,height=450px,resizable=1,scrollbars=1";top.popup_win("../../interface/accounting/era_file.php?enc_id="+enc_id,features);}
function claim_file_fun(clm_status){var enc_id="";if(top.fmain.$('#enc_id_read').length>0){enc_id=top.fmain.$('#enc_id_read').val();}
var url='../../interface/accounting/claims_file.php?enc_id='+enc_id;var wname="Claims";var features="width=1200px,height=450px,resizable=1,scrollbars=1";if(claim_status_request_js=='YES'){if(typeof(clm_status)!='undefined'&&clm_status!=''){var url='../../interface/accounting/claims_status.php?clm_status=true&enc_id='+enc_id;var wname="ClaimsStatus";}}
top.popup_win(url,features);}
function statement_file_fun(){var patid="";if(typeof(pat_js)!='undefined'&&pat_js!=''){patid=pat_js;}else{if($('#patient_id').length>0){patid=$('#patient_id').val();}}
var url='../../interface/reports/accountingStatementsResult.php?Submit=Get Report&pevious=yes&patientId='+patid;var wname="statements";var features="width=900px,height=650px,resizable=1,scrollbars=1";if(patid>0){top.popup_win(url,features);}else{top.fAlert('Please select a patient.');}}
function stop_enter_key_on(idd){$('#'+idd).bind('keypress',function(e){if((e.keyCode||e.which)==13){e.preventDefault();return false;}});}
function hasNumbers(t){return/\d/.test(t);}
function search_pt(callback_function){var parWidth=parseInt($(window).width()-500);var win_height=parseInt($(window).height());top.popup_win(top.JS_WEB_ROOT_PATH+'/interface/billing/search_patient_popup.php?callback_function='+callback_function+'',"width="+parWidth+",scrollbars=0,resizable=yes,height="+win_height+",top=0,left=10,addressbar=1");}
function check_checkboxes(){$('#chk_sel_all').click(function(){var status=this.checked;$('.chk_sel').each(function(){this.checked=status;});});}
function current_date(d_format,year_digit,time,t_format)
{d_format=d_format||top.jquery_date_format||window.top.opener.jquery_date_format;d_format=d_format.toLowerCase()
year_digit=parseInt(year_digit)
year_digit=(year_digit!==2&&year_digit!==4)?4:year_digit;time=time||false;time=(typeof time!='boolean')?false:time;t_format=t_format||'12'
t_format=(t_format=='24'||t_format=='12')?t_format:'12'
var t=new Date();var mon=(parseInt(t.getMonth())+1).toString();var d=('0'+t.getDate()).slice(-2);var m=('0'+mon).slice(-2);var y=t.getFullYear()
if(year_digit===2)y=y.toString().substr(2,2);d_format=d_format.replace(/y/g,y);d_format=d_format.replace(/m/g,m);d_format=d_format.replace(/d/g,d);var time_string='';if(time)
{var h=parseInt(t.getHours());var m=parseInt(t.getMinutes());var a=(h<12)?'AM':'PM';m=m<10?'0'+m:m;h=(t_format=='12'&&h>12)?h-12:h;time_string=' '+h+':'+m+(t_format==12?' '+a:'');}
return d_format+time_string;}
function section_highlight(section_id,arr_all_sections,di_highlight_all){$(arr_all_sections).each(function(){$('#'+this).css({'background-color':'#FFF'});});if(typeof(di_highlight_all)=='undefined'||!di_highlight_all){$('#'+section_id).css({'background-color':'#FFFFCC'});}}
function search_email(e,div_object,left,top)
{var object=document.getElementById(div_object);var nextObject=object.getElementsByTagName('select').item(0);if(e.keyCode==64&&object.style.display=="none"){object.style.left=left;object.style.top=top;object.style.display="block";nextObject.options[0].selected=true;nextObject.focus();}else if(e.keyCode!=64&&object.style.display=="block"){object.style.display="none";}}
var typed_val="";function select_option(e,object,object_id){var text=document.getElementById(object_id);var value=text.value;var splited_value=value.split("@");if(e.keyCode==13){var value_without_website_address=splited_value[0];var value_with_new_website_address=value_without_website_address+object.value;text.value=value_with_new_website_address;object.parentNode.style.display="none";text.focus();}else if(e.keyCode!=103&&e.keyCode!=104&&e.keyCode!=109&&e.keyCode!=97){if(typed_val!=""){var value_without_website_address=splited_value[0]+"@"+typed_val;}else{var value_without_website_address=splited_value[0]+"@";}
var value_with_new_website_address=value_without_website_address;text.value=value_with_new_website_address;typed_val="";object.parentNode.style.display="none";text.focus();}else{typed_val=typed_val+String.fromCharCode(e.keyCode);}}
function select_option_with_mouse(object,object_id){var text=document.getElementById(object_id);var value=text.value;var splited_value=value.split("@");var value_without_website_address=splited_value[0];var value_with_new_website_address=value_without_website_address+object.value;text.value=value_with_new_website_address;object.parentNode.style.display="none";}
function gebi(el){return document.getElementById(el);}
function zip_vs_state_R6(objZip,objCity,objState,objCountry,objCounty)
{zip_code=$(objZip).val();if(zip_code==''){$(objCity).val('');$(objState).val('');return false;}
$.ajax({url:top.JS_WEB_ROOT_PATH+"/interface/patient_info/ajax/demographics/add_city_state.php?zipcode="+zip_code,success:function(data)
{var changecolor='#F6C67A';var val=data.split("-");var city=$.trim(val[0]);var state=$.trim(val[1]);var country=$.trim(val[3]);var county=$.trim(val[4]);if(city!="")
{$(objCity).val(city);$(objState).val(state);if(country){$(objCountry).val(country);}
if(county){$(objCounty).val(county);}
return;if(typeof(top.int_country)!="undefined"&&top.int_country=="UK"){if(typeof(document.getElementById("zipCodeStatus"))!="undefined"&&document.getElementById("zipCodeStatus")!=null&&document.getElementById("zipCodeStatus")!="undefined")
document.getElementById("zipCodeStatus").value="OK";return;}
if(typeof(top.stop_zipcode_validation)!="undefined"&&top.stop_zipcode_validation=="YES"){return;}
$(objZip).val("");changeClass(document.getElementById($(objZip).attr("id")),1)
if(typeof(top.fAlert)!="undefined")
top.fAlert('Please enter correct '+top.zipLabel);else{alert('Please enter correct '+top.zipLabel);}
$(objZip).select();$(objCity).val("");$(objState).val("");$(objCounty).val("");}}});}
function set_header_title(title){top.$('#acc_page_name').html(title);}
function showHidemodal(action,div_id,dismissible,backdrop){action=(action=='show'||'hide')?action:'show';backdrop=(typeof backdrop==='boolean')?backdrop:false;dismissible=(typeof dismissible==='boolean')?dismissible:false;if(action=='hide'){$('#'+div_id+'').modal(action);}
else{backdrop=(dismissible)?'static':backdrop;$('#'+div_id+'').modal({backdrop:backdrop,keyboard:false});if(!$('#'+div_id+'').hasClass('in')){$('#'+div_id+'').modal('show');}}
return false;}
function ado_scan_fun(show,formNme,editId){if(typeof show=='undefined')show='scan';if(typeof formNme=='undefined')return;if(typeof editId=='undefined'||editId=='')editId=0;var url=top.JS_WEB_ROOT_PATH+'/library/classes/scan_ptinfo_medhx_images.php?formName='+formNme+'&show='+show;url+=(editId>0)?'&edit_id='+editId:'';top.popup_win(url,'scan_patient_info');}
function set_modal_btns(parent_id,btn_arr){var parent_elem='';var btn_str='';var footer_str='';var default_type='button';var btn_debug_arr=new Array;if($('#'+parent_id).length>0){parent_elem=$('#'+parent_id);}else if($('.'+parent_id).length>0){parent_elem=$('.'+parent_id);}
var onclick='';if(parent_id=='new_priv_div .modal-footer'){onclick='onclick="resetToOldPriv();"';}
if(parent_elem.length){parent_elem.addClass('btn-ftr-unique');parent_elem.attr('id','module_buttons');if(btn_arr.length>0){$.each(btn_arr,function(id,val){var btn_name_str='';var btn_val=btn_arr[id][0].charAt(0).toUpperCase()+btn_arr[id][0].slice(1);var btn_class=get_btn_class(btn_val);var btn_name=btn_arr[id][1];var btn_func=btn_arr[id][2];var btn_type=default_type;if(btn_name.length){btn_type='submit';btn_name_str='name="'+btn_name+'" value="'+btn_name+'"';}
btn_str+='<button type="'+btn_type+'" class="'+btn_class+'" '+btn_name_str+' id="'+btn_val+'" onclick="'+btn_func+'">'+btn_val+'</button>';});btn_str+='<button type="button" class="btn btn-danger" data-dismiss="modal" '+onclick+'>Close</button>';footer_str='<div class="row mdl_btns_dp"><div class="col-sm-12 text-center">'+btn_str+'</div></div>';}else{btn_str+='<button type="button" class="btn btn-danger" data-dismiss="modal" '+onclick+'>Close</button>';footer_str='<div class="row mdl_btns_dp"><div class="col-sm-12 text-center">'+btn_str+'</div></div>';}
if($('body').find('.btn-ftr-unique .mdl_btns_dp').length==0){$('body').find('.btn-ftr-unique').find('[type=button],[type=submit]').not('input[type=hidden]').remove();$('body').find('.btn-ftr-unique').append(footer_str);}else{$('body').find('.btn-ftr-unique .mdl_btns_dp').html(footer_str);}
if($('body').find('.btn-ftr-unique').hasClass('ad_modal_footer')===false){$('body').find('.btn-ftr-unique').addClass('ad_modal_footer');}
if(parent_elem.hasClass('btn-ftr-unique')){parent_elem.removeClass('btn-ftr-unique');}}}
function get_btn_class(btn_val){var btn_class='btn btn-default';switch(btn_val.toLowerCase()){case'save':case'done':case'ok':case'yes':btn_class='btn btn-success';break;case'cancel':case'no':case'Close':btn_class='btn btn-danger';break;case'delete selected':btn_class='btn btn-danger';break;case'print':case'download':case'add':case'upload':btn_class='btn btn-info';break;}
return btn_class;}
function set_modal_height(object,debug){var obj='';var debug_arr=new Array;if(typeof(object)=='object'){obj=$(object);}else{if($('#'+object).length>0){obj=$('#'+object);}else if($('.'+object).length>0){obj=$('.'+object);}}
debug_arr['object']=obj;if(obj!=''){if(obj.hasClass('in')){var elem=obj;var elem_height=elem.outerHeight();debug_arr['modal_height']=elem_height;var header_position=$('#first_toolbar',top.document).position();var window_height=parseInt(window.innerHeight-$('footer',top.document).outerHeight()-header_position.top-$('#first_toolbar').outerHeight());debug_arr['window_height']=window_height;if(elem_height>window_height){var diff=parseInt(elem_height-window_height);var new_height=parseInt(elem_height-diff);var modal_extra=parseInt(elem.find('.modal-header').outerHeight()+elem.find('.modal-footer').outerHeight());new_height=parseInt(new_height-modal_extra)
debug_arr['modal_extra_height']=new_height;elem.find('.modal-body').css('max-height',new_height);if(elem.find('.modal-body').css("overflow-x")!='hidden'){elem.find('.modal-body').css({overflow:'auto','overflow-x':'hidden'});}}}}
if(debug){console.log(debug_arr);}}
function checkSingle(elemId,grpName){var obgrp=document.getElementsByName(grpName);var objele=document.getElementById(elemId);var len=obgrp.length;if(objele.checked==true){for(var i=0;i<len;i++){if((obgrp[i].id!=objele.id)&&(obgrp[i].checked==true)){obgrp[i].checked=false;}}}}
function changeChbxColor(grpNode){var objGrp=$('input[name="'+grpNode+'"]');var len=objGrp.length;var is_checked=false;for(var i=0;i<len;i++){if(objGrp[i].checked==true){is_checked=true;}}
if(is_checked)
objGrp.parent('div').removeClass('checkbox-mandatory');else
objGrp.parent('div').addClass('checkbox-mandatory');}
function day_charges(){var sc_wd=(screen.availWidth)-100;var sc_hg=(screen.availHeight)-120;var features='width='+sc_wd+',height='+sc_hg+',left=150,top=80,location=0,status=1,resizable=1,left=0,top=0,scrollbars=0';top.popup_win("../../interface/accounting/day_charges_list.php",features);}
function popup_resize(maxWidth,maxHeight,maxAvail)
{maxWidth=maxWidth||1270;maxHeight=maxHeight||850;maxAvail=maxAvail||0.9;var avail_w_90=(screen.availWidth*maxAvail)
var avail_h_90=(screen.availHeight*maxAvail)
var parWidth=(screen.availWidth>maxWidth)?maxWidth:avail_w_90;var parHeight=(screen.availHeight>maxHeight)?maxHeight:avail_h_90;window.resizeTo(parWidth,parHeight);var t=parseInt((screen.availHeight-window.outerHeight)/2)
var l=parseInt((screen.availWidth-window.outerWidth)/2)
window.moveTo(l,t);}
function show_iportal_changes_alert_data(filter,pt_id){var form_data='iportal_filter='+filter+'&iportal_pt='+pt_id;var modal_title='';var modal_id='';switch(filter){case'demographics':case'medical':modal_title='Patient Portal - Demographics Changes';modal_id='iportal_changes_demograph';break;case'cl_order':modal_title='Patient Portal - Contact Lens Order';modal_id='iportal_changes_cl_order';break;case'registered_patients':modal_title='Patient Portal - Patient Registration';modal_id='iportal_changes_reg_pt';break;case'iportal_payments':modal_title='Patient Portal - Payment(s)';modal_id='iportal_patient_payments';break;}
$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/physician_console/handle_pt_changes.php',data:form_data,type:'POST',dataType:'JSON',beforeSend:function(){},success:function(response){if(response){if(response.data_length>0&&response.data.length){var modal_html=generate_iportal_alert_html(response,filter);if(modal_html){var div_id=modal_id;var title=modal_title;var footer='<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button><button type="button" class="btn btn-success" onclick="window.top.fmain.location.reload();">Reload with approved changes</button><button type="button" class="btn btn-success" onclick="top.fmain.approve_all_operation(0,\''+modal_id+'\', \''+filter+'\');">Approve All</button>';if(filter=='iportal_payments'){footer='<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button><button type="button" class="btn btn-success" onclick="top.fmain.iportal_payment_message_read(0,\''+modal_id+'\', \''+filter+'\');">Ok</button>';}
if(!top.$('#iportal_modal_val_'+modal_id).length){show_modal(div_id,title,modal_html,footer,'400','modal_90');}
$('body').on('hide.bs.modal','#'+modal_id,function(event){var iportal_input=$('<input>');iportal_input.attr({'id':'iportal_modal_val_'+modal_id,'value':'shown','type':'hidden',});top.$('body').append(iportal_input);});}
else{if($("#"+modal_id).length>0)$("#"+modal_id).html('').modal('hide');}}}},complete:function(){top.show_loading_image('hide');}});}
function generate_iportal_alert_html(result,filter)
{var $_html='';if(result.data_length==0)return false;var table_header='';var table_rows='';if(filter=='medical'||filter=='demographics'){table_header+='<th class="col-xs-1 text-nowrap">Field Changed</th>';table_header+='<th class="col-xs-4">Old Value</th>';table_header+='<th class="col-xs-4">New Value</th>';table_header+='<th class="col-xs-3">Action</th>';$.each(result.data,function(id,val){table_rows+='<tr>';table_rows+='<td>'+val['col_lbl']+'</td>';table_rows+='<td>'+val['old_val']+'</td>';table_rows+='<td>'+val['new_val']+'</td>';table_rows+='<td id="iportal_approve_'+val['id']+'" class="text-center">';table_rows+='<div class="btn-group">';table_rows+='<button class="btn btn-success" data-filter="'+filter+'" onClick="top.fmain.approve_operation(\''+val['id']+'\', this);">Approve</button>';table_rows+='<button class="btn btn-danger"data-filter="'+filter+'" onClick="top.fmain.disapprove_operation(\''+val['id']+'\', this);">Decline</button>';table_rows+='</div>';table_rows+='</td>';table_rows+='</tr>';});}
if(filter=='iportal_payments'){table_header+='<th class="col-xs-4 text-nowrap">Field Changed</th>';table_header+='<th class="col-xs-8">New Value</th>';$.each(result.data,function(id,val){table_rows+='<tr>';table_rows+='<td>'+val['col_lbl']+'</td>';table_rows+='<td>'+val['new_val']+'</td>';table_rows+='</tr>';});}
if(filter=='cl_order'){table_header+='<th>Patient</th>';table_header+='<th class="text-nowrap">Date</th>';table_header+='<th>Eye</th>';table_header+='<th>Brand</th>';table_header+='<th>Manufacturer</th>';table_header+='<th>Disposable</th>';table_header+='<th>Supplies</th>';table_header+='<th>#Boxes</th>';table_header+='<th>Action</th>';var eye_str='';var old_order_num=0;$.each(result.data,function(id,val){var td_date='';var td_patient='';var td_approval='';var ordNum=val['temp_order_num'];if(old_order_num!=ordNum){cnt=0;}
if(cnt==0){rowspan=val['order_count'];td_date='<td rowspan="'+rowspan+'">'+val['orderedDate']+'</td>';td_patient='<td rowspan="'+rowspan+'">'+val['pt_name']+'</td>';td_approval+='<td id="iportal_approve_'+val['id']+'" class="text-center" rowspan="'+rowspan+'">';td_approval+='<div class="btn-group">';td_approval+='<button class="btn btn-success" data-filter="'+filter+'" onClick="top.fmain.approve_operation(\''+ordNum+'\', this);">Approve</button>';td_approval+='<button class="btn btn-danger" data-filter="'+filter+'" onClick="top.fmain.disapprove_operation(\''+ordNum+'\', this);">Decline</button>';td_approval+='</div>';td_approval+='</td>';}
table_rows+='<tr>';table_rows+=td_patient;table_rows+=td_date;table_rows+='<td>'+val['eye']+'</td>';table_rows+='<td>'+val['brand']+'</td>';table_rows+='<td>'+val['manufacturer']+'</td>';table_rows+='<td>'+val['disposable']+'</td>';table_rows+='<td>'+val['supplies']+'</td>';table_rows+='<td>'+val['boxes']+'</td>';table_rows+=td_approval;table_rows+='</tr>';old_order_num=ordNum;cnt++;});}
if(filter=='registered_patients'){table_header+='<th>Patient Data</th>';table_header+='<th>Email Verification</th>';table_header+='<th>Action</th>';$.each(result.data,function(id,val){var pt_details='';pt_details+='<div class="row">';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>First Name :</strong>  '+val['fname'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Last Name :</strong>  '+val['lname'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="clearfix"></div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Sex :</strong>  '+val['sex'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>DOB :</strong>  '+val['dob'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Email :</strong>  '+val['email'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="clearfix"></div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Home Phone :</strong>  '+val['phone_home'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Cell Phone :</strong>  '+val['phone_cell'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>Work Phone :</strong>  '+val['phone_biz_ext']+' '+val['phone_biz'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="clearfix"></div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<div class="row">';pt_details+='<div class="col-sm-4">';pt_details+='<strong>Address :</strong>';pt_details+='</div>';pt_details+='<div class="col-sm-8">';pt_details+=val['address'];pt_details+='</div>';pt_details+='</div>';pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>City :</strong>  '+val['city'];pt_details+='</div>';pt_details+='</div>';pt_details+='<div class="col-sm-4">';pt_details+='<div class="form-group">';pt_details+='<strong>'+top.zipLabel+' :</strong>  '+val['postal_code'];pt_details+='</div>';pt_details+='</div>';pt_details+='</div>';table_rows+='<tr>';table_rows+='<td>'+pt_details+'</td>';table_rows+='<td>'+val['auth_status']+'</td>';table_rows+='<td id="iportal_approve_'+val['id']+'" class="text-center">';table_rows+='<div class="btn-group">';table_rows+='<button class="btn btn-success" data-filter="'+filter+'" onClick="top.fmain.approve_operation(\''+val['id']+'\', this);">Approve</button>';table_rows+='<button class="btn btn-danger" data-filter="'+filter+'"  onClick="top.fmain.disapprove_operation(\''+val['id']+'\', this);">Decline</button>';table_rows+='</div>';table_rows+='</td>';table_rows+='</tr>';});}
$_html+='<div class="row">';var h1_title=' Following Patients has registered from Patient Portal ';var h2_title=' Please take the appropriate action.';if(filter=='iportal_payments'){h1_title=' Following Payment(s) made from Patient Portal ';h2_title=' This is alert message for patient payment(s). ';}
$_html+='<h1 style="font-size:18px;font-weight:normal;margin:0px;padding:0px;">'+h1_title+'</h1>';$_html+='<h2 style="font-size:14px;font-weight:normal;margin:5px 0px 10px 0px;padding:0px;">'+h2_title+'</h2>';$_html+='<div class="col-xs-12">';$_html+='<table class="table table-bordered table-hover table-striped">';$_html+='<thead class="header">';$_html+='<tr class="grythead">';$_html+=table_header;$_html+='</tr>';$_html+='</thead>';$_html+='<tbody id="newTbodyBorder">';$_html+=table_rows;$_html+='</tbody>';$_html+='</table>';$_html+='<input type="hidden" name="hidd_iportal_approve" id="hidd_iportal_approve" value="'+result.row_id_str+'">';$_html+='</div>';$_html+='</div>';return $_html;}
function approve_operation(row_id,ths)
{var processing_btn='<button class="btn btn-warning"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Processing...</button>';var approved_btn='<button class="btn btn-success"><span class="glyphicon glyphicon-ok"></span> Successfully Approved</button>';var filter=$(ths).data('filter');var url='/interface/physician_console/handle_pt_changes.php';if(filter=='cl_order'){url='/iportal_config/approve_cl_orders.php';}
if(filter=='registered_patients'){url='/iportal_config/handle_pt_registration.php';}
ths_parent=$(ths).parent();if(row_id!=""&&parseInt(row_id))
{ths_parent.html(processing_btn);}
$.ajax({url:top.JS_WEB_ROOT_PATH+url,data:'sel_op=approve&row_id='+row_id+'&alert_filter='+filter,type:'POST',success:function(response){if(filter=='registered_patients'){var resp=JSON.parse(response);if(resp.status=="success"){ths_parent.html(approved_btn).append('<div style="color:#090;font-weight:bold;">Approved<br />Patient Id: '+resp.pt_id+'</div>');}
else if(resp.status=="error"){ths_parent.html(processing_btn).append('<div style="color:#CC0000;font-weight:bold;">Error while approving</div>');}}},complete:function(respData){if(filter=='registered_patients'){}else{ths_parent.html(approved_btn);}}});return false;}
function disapprove_operation(row_id,ths)
{var processing_btn='<button class="btn btn-warning"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Processing...</button>';var declined_btn='<button class="btn btn-success"><span class="glyphicon glyphicon-ok"></span> Successfully Declined</button>';var filter=$(ths).data('filter');var url='/interface/physician_console/handle_pt_changes.php';if(filter=='cl_order'){url='/iportal_config/approve_cl_orders.php';}
if(filter=='registered_patients'){url='/iportal_config/handle_pt_registration.php';}
ths_parent=$(ths).parent();if(row_id!=""&&parseInt(row_id))
{ths_parent.html(processing_btn);}
$.ajax({url:top.JS_WEB_ROOT_PATH+url,data:'sel_op=decline&row_id='+row_id,type:'POST',complete:function(respData)
{resultData=respData.responseText;ths_parent.html(declined_btn);}});}
function approve_all_operation(indx,modal_id,filter)
{var url='/interface/physician_console/handle_pt_changes.php';if(filter=='cl_order'){url='/iportal_config/approve_cl_orders.php';}
if(filter=='registered_patients'){url='/iportal_config/handle_pt_registration.php';}
var processing_btn='<button class="btn btn-warning"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Processing...</button>';var approved_btn='<button class="btn btn-success"><span class="glyphicon glyphicon-ok"></span> Successfully Approved</button>';all_id=$('#'+modal_id+' #hidd_iportal_approve').val();var all_id_arr=new Array();if(all_id)
{all_id_arr=all_id.split(',');row_id=all_id_arr[indx];if(all_id_arr.length>indx)
{if(row_id!=""&&parseInt(row_id))
{if($('#iportal_approve_'+row_id).text()!="Declined")
$('#iportal_approve_'+row_id).html(processing_btn);}
$.ajax({url:top.JS_WEB_ROOT_PATH+url,data:'sel_op=approve&row_id='+row_id+'&alert_filter='+filter,type:'POST',complete:function(r)
{if(r.responseText=="approved")
$('#iportal_approve_'+row_id).html(approved_btn);approve_all_operation(parseInt(indx)+1,modal_id,filter);}});}
if(all_id_arr.length==indx)top.fmain.location.reload(true);}else{if($("#"+modal_id).length>0)$("#"+modal_id).html('').modal('hide');}
return false;}
function iportal_payment_message_read(indx,modal_id,filter){var url='/interface/physician_console/handle_pt_changes.php';var all_id=$('#'+modal_id+' #hidd_iportal_approve').val();var all_id_arr=new Array();if(all_id)
{all_id_arr=all_id.split(',');var row_id=all_id_arr[indx];if(all_id_arr.length>indx)
{$.ajax({url:top.JS_WEB_ROOT_PATH+url,data:'sel_op=iportal_payment_read&row_id='+row_id+'&alert_filter='+filter,type:'POST',complete:function(r)
{iportal_payment_message_read(parseInt(indx)+1,modal_id,filter);}});}
if(all_id_arr.length==indx)top.fmain.location.reload(true);}else{if($("#"+modal_id).length>0)$("#"+modal_id).html('').modal('hide');}
return false;}
function view_only_acc_call(mode){top.fAlert("You do not have permission to perform this action.",'',340);if(mode==1){return false;}}
function changeColumnSelection(e){var fid=e.currentTarget.id
var obj=$('#'+fid);var values=obj.val();var page=obj.data('page');$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/common/column_settings.php',type:'post',dataType:'json',data:{page:page,cols:(values?values.join(','):'')},beforeSend:function(){top.show_loading_image('show');},complete:function(){top.show_loading_image('hide');},success:function(r){if(r.success){obj.find('option').each(function(){var v=$(this).attr('value');var t=v.replace(/-/g,"");if($.inArray(v,values)===-1){$("td."+t).addClass('hide');}
else
$("td."+t).removeClass('hide');});}
else
top.fAlert('Error: please try again');}})}
function loadItsDesc(selObj,textObj){var val=selObj.value;var arrVal=val.split('-');textObj.style.visibility="visible";if(arrVal[2]){textObj.value=arrVal[2];}
else{textObj.value="";}}
function loadItsDescImmu(selObj,textObj){var val=selObj.value;var arrVal=val.split('-');textObj.style.visibility="visible";if(arrVal[2]){textObj.value=arrVal[2];}
else if(arrVal[0]==""){textObj.value="";textObj.style.visibility="hidden";}
else{textObj.value="";}}
function drag_div_move(ele,ev){$(ele).draggable();}
function acknowledged(op,form){op=op||0;if(document.getElementById('patSpesificDivAlert')){if(op==1){$(form).children('#disablePatAlertThisSession').val('yes');}
else{$(form).children('#disablePatAlertThisSession').val('');}
$(form).children('#patSpesificDivAlert').css('display','none');}}
function manage_section_height(dest_obj,source_obj_array,flexibility){if(typeof(flexibility)=='undefined')flexibility=0;h=0;$(source_obj_array).each(function(index,element){h+=$(source_obj_array[index]).height();});if(flexibility<0)h=h-parseInt(flexibility);else h=h+parseInt(flexibility);wh=window.innerHeight;$(dest_obj).height(wh-h);}
function newPatient_info_main(){var parWidth=parseInt($(window).width()-500);var win_height=$(window).height();top.popup_win(top.JS_WEB_ROOT_PATH+"/interface/scheduler/common/new_patient_info_popup_new.php?source=demographics&search=true&frm_status=show_check_in&popheight="+win_height,"width="+parWidth+",scrollbars=0,resizable=yes,height="+win_height+",top=0,left=10,addressbar=1")}
function check_rule_manager(obj_value,section){section=(section)?section:'';var post_data={obj_value:obj_value,section:section}
$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/common/assign_new_task.php',type:'post',dataType:'json',data:post_data,beforeSend:function(){top.show_loading_image('show');},complete:function(){top.show_loading_image('hide');},success:function(r){}});}
var o='';function del_doc(__this,confirm){o=__this||o;if(typeof confirm=='undefined'){top.fmain.frames[0].document.write('');top.fancyConfirm("Sure! you want to delete this document ?","top.del_doc('',true)");}
else{var u=$(o).data('url');if($(o).length>0&&typeof u!=='undefined'){if(top.fmain)top.fmain.location.href=u;if(top.all_data)top.all_data.location.href=u;}
else
top.fAlert('Unable to delete. Please refresh the tab and try again. ')}}
function dismissTaskAlert(){top.master_ajax_tunnel(top.JS_WEB_ROOT_PATH+'/interface/core/ajax_handler.php?task=task_alert_shown');$("#task_alerts",top.document).modal('hide');}
function ZeissViewer(pid,user,pass,path){if(pid=="")pid=window.top.$("#patient_id").val();u=user;p=pass;params=" -username "+u+" -password "+p+" -patientId "+pid;exeURL='"'+path+'\\launchFORUM.cmd"'+params;try{WSH=new ActiveXObject("WScript.Shell");WSH.run(exeURL);}catch(e){if(e!=''){try{exeURL=exeURL.replace('Program Files','Program Files (x86)');WSH=new ActiveXObject("WScript.Shell");WSH.run(exeURL);}catch(er){top.fAlert('<div class="text-center">Check if Zeiss Application installed.<br>'+er.message+'</div>');}}}}
function sig_web_alert(){var msg='Error, make sure you have installed SigWeb.<br> <a href="https://www.topazsystems.com/software/sigweb.exe" target="_BLANK" class="purple-text">Click here</a> to download SigWeb service.<br>';msg+='<a href="https://www.topazsystems.com/Software/sigweb_install.pdf" target="_BLANK" class="purple-text">Click here</a> to read installation instructions before installing';top.fAlert(msg);}
var heardAboutSearch=['Family','Friends','Doctor','Previous Patient.','Previous Patient'];function searchHeardAbout(){var WRP=top.JS_WEB_ROOT_PATH
var search_val=$("#heardAbtSearch").val();search_val=$.trim(search_val);target_search_val='';if(search_val!="")
{search_val_arr=search_val.split(',');if(search_val_arr[0]!=""&&typeof search_val_arr[0]!="undefined")
{last_name_val=$.trim(search_val_arr[0]);last_mid_name_arr=last_name_val.split(' ');target_search_val=$.trim(last_mid_name_arr[1]);if(target_search_val==""||typeof target_search_val=="undefined")
{target_search_val=last_mid_name_arr[0];}}
else
{target_search_val=$.trim(search_val_arr[0]);}}
if(!target_search_val)return false;var heardAbtVal=$("#elem_heardAbtUs").val();var tmpArr=heardAbtVal.split("-");heardAbtVal=tmpArr[1].trim();if(!heardAbtVal)return false;if($.inArray(heardAbtVal,heardAboutSearch)!==-1){if(WRP=='undefined'){if(typeof window.opener!=='undefined'){WRP=window.opener.top.JS_WEB_ROOT_PATH;}}
if(heardAbtVal=='Doctor'){window.open(WRP+"/interface/admin/users/searchPhysician.php?btn_sub=search&sel_by=LastName&txt_for="+target_search_val,"window1","width=800,height=500,scrollbars=yes, status=1");}
else{var w=window.open(WRP+"/interface/scheduler/search_patient_popup.php?sel_by=Active&txt_for="+target_search_val+"&btn_sub=Search&call_from=demographics","PatientWindow","width=800,height=500,top=420,left=150,scrollbars=yes");}}}
function setHeardAboutUsVal(pid,name){document.getElementById('heardAbtSearchId').value=pid;document.getElementById('heardAbtSearch').value=name+'-'+pid;}
function get_phy_name_from_search(strVal,id){if(top.$('#appt_scheduler_status').val()=='loaded'){document.getElementById('front_primary_care_id').value=id;document.getElementById('front_primary_care_name').value=strVal;}
else{document.getElementById('heardAbtSearchId').value=id;document.getElementById('heardAbtSearch').value=strVal;}}
function validate_num(obj){var num=$(obj).val();num=num.trim();if(num!=""){num=num.replace(/[^\d.]/,'');if(num=="")num=0;}
$(obj).val(num);}
function capitalize_letter(str){return str.replace(/(^\S|\s\S)/g,function(match,g1,offset,origstr){return g1.toUpperCase();});}
function view_only_call(){top.fAlert("You do not have permission to perform this action.");return false;}/*!
 * Bootstrap v3.3.7 (http://getbootstrap.com)
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under the MIT license
 */
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.7",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a("#"===f?[]:f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.7",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c).prop(c,!0)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c).prop(c,!1))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target).closest(".btn");b.call(d,"toggle"),a(c.target).is('input[type="radio"], input[type="checkbox"]')||(c.preventDefault(),d.is("input,button")?d.trigger("focus"):d.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(a>this.$items.length-1||a<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.7",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.7",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){document===a.target||this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.7",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){
this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.7",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return e<c&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(e+g<=a-d)&&"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&e<=c?"top":null!=d&&i+j>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);window.onkeydown=function(event){if(event.keyCode==78){if(event.ctrlKey){event.returnValue=false;event.keyCode=0;window.status='New window is disabled';return false;}}};var zbtn = $.fn.button.noConflict();$.fn.btn = zbtn;/*!
 * Bootstrap-select v1.12.4 (http://silviomoreto.github.io/bootstrap-select)
 *
 * Copyright 2013-2017 bootstrap-select
 * Licensed under MIT (https://github.com/silviomoreto/bootstrap-select/blob/master/LICENSE)
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){!function(a){"use strict";function b(b){var c=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}];return a.each(c,function(){b=b?b.replace(this.re,this.ch):""}),b}function c(b){var c=arguments,d=b;[].shift.apply(c);var e,f=this.each(function(){var b=a(this);if(b.is("select")){var f=b.data("selectpicker"),g="object"==typeof d&&d;if(f){if(g)for(var h in g)g.hasOwnProperty(h)&&(f.options[h]=g[h])}else{var i=a.extend({},l.DEFAULTS,a.fn.selectpicker.defaults||{},b.data(),g);i.template=a.extend({},l.DEFAULTS.template,a.fn.selectpicker.defaults?a.fn.selectpicker.defaults.template:{},b.data().template,g.template),b.data("selectpicker",f=new l(this,i))}"string"==typeof d&&(e=f[d]instanceof Function?f[d].apply(f,c):f.options[d])}});return"undefined"!=typeof e?e:f}String.prototype.includes||!function(){var a={}.toString,b=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),c="".indexOf,d=function(b){if(null==this)throw new TypeError;var d=String(this);if(b&&"[object RegExp]"==a.call(b))throw new TypeError;var e=d.length,f=String(b),g=f.length,h=arguments.length>1?arguments[1]:void 0,i=h?Number(h):0;i!=i&&(i=0);var j=Math.min(Math.max(i,0),e);return!(g+j>e)&&c.call(d,f,i)!=-1};b?b(String.prototype,"includes",{value:d,configurable:!0,writable:!0}):String.prototype.includes=d}(),String.prototype.startsWith||!function(){var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),b={}.toString,c=function(a){if(null==this)throw new TypeError;var c=String(this);if(a&&"[object RegExp]"==b.call(a))throw new TypeError;var d=c.length,e=String(a),f=e.length,g=arguments.length>1?arguments[1]:void 0,h=g?Number(g):0;h!=h&&(h=0);var i=Math.min(Math.max(h,0),d);if(f+i>d)return!1;for(var j=-1;++j<f;)if(c.charCodeAt(i+j)!=e.charCodeAt(j))return!1;return!0};a?a(String.prototype,"startsWith",{value:c,configurable:!0,writable:!0}):String.prototype.startsWith=c}(),Object.keys||(Object.keys=function(a,b,c){c=[];for(b in a)c.hasOwnProperty.call(a,b)&&c.push(b);return c});var d={useDefault:!1,_set:a.valHooks.select.set};a.valHooks.select.set=function(b,c){return c&&!d.useDefault&&a(b).data("selected",!0),d._set.apply(this,arguments)};var e=null,f=function(){try{return new Event("change"),!0}catch(a){return!1}}();a.fn.triggerNative=function(a){var b,c=this[0];c.dispatchEvent?(f?b=new Event(a,{bubbles:!0}):(b=document.createEvent("Event"),b.initEvent(a,!0,!1)),c.dispatchEvent(b)):c.fireEvent?(b=document.createEventObject(),b.eventType=a,c.fireEvent("on"+a,b)):this.trigger(a)},a.expr.pseudos.icontains=function(b,c,d){var e=a(b).find("a"),f=(e.data("tokens")||e.text()).toString().toUpperCase();return f.includes(d[3].toUpperCase())},a.expr.pseudos.ibegins=function(b,c,d){var e=a(b).find("a"),f=(e.data("tokens")||e.text()).toString().toUpperCase();return f.startsWith(d[3].toUpperCase())},a.expr.pseudos.aicontains=function(b,c,d){var e=a(b).find("a"),f=(e.data("tokens")||e.data("normalizedText")||e.text()).toString().toUpperCase();return f.includes(d[3].toUpperCase())},a.expr.pseudos.aibegins=function(b,c,d){var e=a(b).find("a"),f=(e.data("tokens")||e.data("normalizedText")||e.text()).toString().toUpperCase();return f.startsWith(d[3].toUpperCase())};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`"},i=function(a){var b=function(b){return a[b]},c="(?:"+Object.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}},j=i(g),k=i(h),l=function(b,c){d.useDefault||(a.valHooks.select.set=d._set,d.useDefault=!0),this.$element=a(b),this.$newElement=null,this.$button=null,this.$menu=null,this.$lis=null,this.options=c,null===this.options.title&&(this.options.title=this.$element.attr("title"));var e=this.options.windowPadding;"number"==typeof e&&(this.options.windowPadding=[e,e,e,e]),this.val=l.prototype.val,this.render=l.prototype.render,this.refresh=l.prototype.refresh,this.setStyle=l.prototype.setStyle,this.selectAll=l.prototype.selectAll,this.deselectAll=l.prototype.deselectAll,this.destroy=l.prototype.destroy,this.remove=l.prototype.remove,this.show=l.prototype.show,this.hide=l.prototype.hide,this.init()};l.VERSION="1.12.4",l.DEFAULTS={noneSelectedText:"Nothing selected",noneResultsText:"No results matched {0}",countSelectedText:function(a,b){return 1==a?"{0} item selected":"{0} items selected"},maxOptionsText:function(a,b){return[1==a?"Limit reached ({n} item max)":"Limit reached ({n} items max)",1==b?"Group limit reached ({n} item max)":"Group limit reached ({n} items max)"]},selectAllText:"Select All",deselectAllText:"Deselect All",doneButton:!1,doneButtonText:"Close",multipleSeparator:", ",styleBase:"btn",style:"btn-default",size:"auto",title:null,selectedTextFormat:"values",width:!1,container:!1,hideDisabled:!1,showSubtext:!1,showIcon:!0,showContent:!0,dropupAuto:!0,header:!1,liveSearch:!1,liveSearchPlaceholder:null,liveSearchNormalize:!1,liveSearchStyle:"contains",actionsBox:!1,iconBase:"glyphicon",tickIcon:"glyphicon-ok",showTick:!1,template:{caret:'<span class="caret"></span>'},maxOptions:!1,mobile:!1,selectOnTab:!1,dropdownAlignRight:!1,windowPadding:0},l.prototype={constructor:l,init:function(){var b=this,c=this.$element.attr("id");this.$element.addClass("bs-select-hidden"),this.liObj={},this.multiple=this.$element.prop("multiple"),this.autofocus=this.$element.prop("autofocus"),this.$newElement=this.createView(),this.$element.after(this.$newElement).appendTo(this.$newElement),this.$button=this.$newElement.children("button"),this.$menu=this.$newElement.children(".dropdown-menu"),this.$menuInner=this.$menu.children(".inner"),this.$searchbox=this.$menu.find("input"),this.$element.removeClass("bs-select-hidden"),this.options.dropdownAlignRight===!0&&this.$menu.addClass("dropdown-menu-right"),"undefined"!=typeof c&&(this.$button.attr("data-id",c),a('label[for="'+c+'"]').click(function(a){a.preventDefault(),b.$button.focus()})),this.checkDisabled(),this.clickListener(),this.options.liveSearch&&this.liveSearchListener(),this.render(),this.setStyle(),this.setWidth(),this.options.container&&this.selectPosition(),this.$menu.data("this",this),this.$newElement.data("this",this),this.options.mobile&&this.mobile(),this.$newElement.on({"hide.bs.dropdown":function(a){b.$menuInner.attr("aria-expanded",!1),b.$element.trigger("hide.bs.select",a)},"hidden.bs.dropdown":function(a){b.$element.trigger("hidden.bs.select",a)},"show.bs.dropdown":function(a){b.$menuInner.attr("aria-expanded",!0),b.$element.trigger("show.bs.select",a)},"shown.bs.dropdown":function(a){b.$element.trigger("shown.bs.select",a)}}),b.$element[0].hasAttribute("required")&&this.$element.on("invalid",function(){b.$button.addClass("bs-invalid"),b.$element.on({"focus.bs.select":function(){b.$button.focus(),b.$element.off("focus.bs.select")},"shown.bs.select":function(){b.$element.val(b.$element.val()).off("shown.bs.select")},"rendered.bs.select":function(){this.validity.valid&&b.$button.removeClass("bs-invalid"),b.$element.off("rendered.bs.select")}}),b.$button.on("blur.bs.select",function(){b.$element.focus().blur(),b.$button.off("blur.bs.select")})}),setTimeout(function(){b.$element.trigger("loaded.bs.select")})},createDropdown:function(){var b=this.multiple||this.options.showTick?" show-tick":"",c=this.$element.parent().hasClass("input-group")?" input-group-btn":"",d=this.autofocus?" autofocus":"",e=this.options.header?'<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>'+this.options.header+"</div>":"",f=this.options.liveSearch?'<div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off"'+(null===this.options.liveSearchPlaceholder?"":' placeholder="'+j(this.options.liveSearchPlaceholder)+'"')+' role="textbox" aria-label="Search"></div>':"",g=this.multiple&&this.options.actionsBox?'<div class="bs-actionsbox"><div class="btn-group btn-group-sm btn-block"><button type="button" class="actions-btn bs-select-all btn btn-default">'+this.options.selectAllText+'</button><button type="button" class="actions-btn bs-deselect-all btn btn-default">'+this.options.deselectAllText+"</button></div></div>":"",h=this.multiple&&this.options.doneButton?'<div class="bs-donebutton"><div class="btn-group btn-block"><button type="button" class="btn btn-sm btn-default">'+this.options.doneButtonText+"</button></div></div>":"",i='<div class="btn-group bootstrap-select'+b+c+'"><button type="button" class="'+this.options.styleBase+' dropdown-toggle" data-toggle="dropdown"'+d+' role="button"><span class="filter-option pull-left"></span>&nbsp;<span class="bs-caret">'+this.options.template.caret+'</span></button><div class="dropdown-menu open" role="combobox">'+e+f+g+'<ul class="dropdown-menu inner" role="listbox" aria-expanded="false"></ul>'+h+"</div></div>";return a(i)},createView:function(){var a=this.createDropdown(),b=this.createLi();return a.find("ul")[0].innerHTML=b,a},reloadLi:function(){var a=this.createLi();this.$menuInner[0].innerHTML=a},createLi:function(){var c=this,d=[],e=0,f=document.createElement("option"),g=-1,h=function(a,b,c,d){return"<li"+("undefined"!=typeof c&&""!==c?' class="'+c+'"':"")+("undefined"!=typeof b&&null!==b?' data-original-index="'+b+'"':"")+("undefined"!=typeof d&&null!==d?'data-optgroup="'+d+'"':"")+">"+a+"</li>"},i=function(d,e,f,g){return'<a tabindex="0"'+("undefined"!=typeof e?' class="'+e+'"':"")+(f?' style="'+f+'"':"")+(c.options.liveSearchNormalize?' data-normalized-text="'+b(j(a(d).html()))+'"':"")+("undefined"!=typeof g||null!==g?' data-tokens="'+g+'"':"")+' role="option">'+d+'<span class="'+c.options.iconBase+" "+c.options.tickIcon+' check-mark"></span></a>'};if(this.options.title&&!this.multiple&&(g--,!this.$element.find(".bs-title-option").length)){var k=this.$element[0];f.className="bs-title-option",f.innerHTML=this.options.title,f.value="",k.insertBefore(f,k.firstChild);var l=a(k.options[k.selectedIndex]);void 0===l.attr("selected")&&void 0===this.$element.data("selected")&&(f.selected=!0)}var m=this.$element.find("option");return m.each(function(b){var f=a(this);if(g++,!f.hasClass("bs-title-option")){var k,l=this.className||"",n=j(this.style.cssText),o=f.data("content")?f.data("content"):f.html(),p=f.data("tokens")?f.data("tokens"):null,q="undefined"!=typeof f.data("subtext")?'<small class="text-muted">'+f.data("subtext")+"</small>":"",r="undefined"!=typeof f.data("icon")?'<span class="'+c.options.iconBase+" "+f.data("icon")+'"></span> ':"",s=f.parent(),t="OPTGROUP"===s[0].tagName,u=t&&s[0].disabled,v=this.disabled||u;if(""!==r&&v&&(r="<span>"+r+"</span>"),c.options.hideDisabled&&(v&&!t||u))return k=f.data("prevHiddenIndex"),f.next().data("prevHiddenIndex",void 0!==k?k:b),void g--;if(f.data("content")||(o=r+'<span class="text">'+o+q+"</span>"),t&&f.data("divider")!==!0){if(c.options.hideDisabled&&v){if(void 0===s.data("allOptionsDisabled")){var w=s.children();s.data("allOptionsDisabled",w.filter(":disabled").length===w.length)}if(s.data("allOptionsDisabled"))return void g--}var x=" "+s[0].className||"";if(0===f.index()){e+=1;var y=s[0].label,z="undefined"!=typeof s.data("subtext")?'<small class="text-muted">'+s.data("subtext")+"</small>":"",A=s.data("icon")?'<span class="'+c.options.iconBase+" "+s.data("icon")+'"></span> ':"";y=A+'<span class="text">'+j(y)+z+"</span>",0!==b&&d.length>0&&(g++,d.push(h("",null,"divider",e+"div"))),g++,d.push(h(y,null,"dropdown-header"+x,e))}if(c.options.hideDisabled&&v)return void g--;d.push(h(i(o,"opt "+l+x,n,p),b,"",e))}else if(f.data("divider")===!0)d.push(h("",b,"divider"));else if(f.data("hidden")===!0)k=f.data("prevHiddenIndex"),f.next().data("prevHiddenIndex",void 0!==k?k:b),d.push(h(i(o,l,n,p),b,"hidden is-hidden"));else{var B=this.previousElementSibling&&"OPTGROUP"===this.previousElementSibling.tagName;if(!B&&c.options.hideDisabled&&(k=f.data("prevHiddenIndex"),void 0!==k)){var C=m.eq(k)[0].previousElementSibling;C&&"OPTGROUP"===C.tagName&&!C.disabled&&(B=!0)}B&&(g++,d.push(h("",null,"divider",e+"div"))),d.push(h(i(o,l,n,p),b))}c.liObj[b]=g}}),this.multiple||0!==this.$element.find("option:selected").length||this.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),d.join("")},findLis:function(){return null==this.$lis&&(this.$lis=this.$menu.find("li")),this.$lis},render:function(b){var c,d=this,e=this.$element.find("option");b!==!1&&e.each(function(a){var b=d.findLis().eq(d.liObj[a]);d.setDisabled(a,this.disabled||"OPTGROUP"===this.parentNode.tagName&&this.parentNode.disabled,b),d.setSelected(a,this.selected,b)}),this.togglePlaceholder(),this.tabIndex();var f=e.map(function(){if(this.selected){if(d.options.hideDisabled&&(this.disabled||"OPTGROUP"===this.parentNode.tagName&&this.parentNode.disabled))return;var b,c=a(this),e=c.data("icon")&&d.options.showIcon?'<i class="'+d.options.iconBase+" "+c.data("icon")+'"></i> ':"";return b=d.options.showSubtext&&c.data("subtext")&&!d.multiple?' <small class="text-muted">'+c.data("subtext")+"</small>":"","undefined"!=typeof c.attr("title")?c.attr("title"):c.data("content")&&d.options.showContent?c.data("content").toString():e+c.html()+b}}).toArray(),g=this.multiple?f.join(this.options.multipleSeparator):f[0];if(this.multiple&&this.options.selectedTextFormat.indexOf("count")>-1){var h=this.options.selectedTextFormat.split(">");if(h.length>1&&f.length>h[1]||1==h.length&&f.length>=2){c=this.options.hideDisabled?", [disabled]":"";var i=e.not('[data-divider="true"], [data-hidden="true"]'+c).length,j="function"==typeof this.options.countSelectedText?this.options.countSelectedText(f.length,i):this.options.countSelectedText;g=j.replace("{0}",f.length.toString()).replace("{1}",i.toString())}}void 0==this.options.title&&(this.options.title=this.$element.attr("title")),"static"==this.options.selectedTextFormat&&(g=this.options.title),g||(g="undefined"!=typeof this.options.title?this.options.title:this.options.noneSelectedText),this.$button.attr("title",k(a.trim(g.replace(/<[^>]*>?/g,"")))),this.$button.children(".filter-option").html(g),this.$element.trigger("rendered.bs.select")},setStyle:function(a,b){this.$element.attr("class")&&this.$newElement.addClass(this.$element.attr("class").replace(/selectpicker|mobile-device|bs-select-hidden|validate\[.*\]/gi,""));var c=a?a:this.options.style;"add"==b?this.$button.addClass(c):"remove"==b?this.$button.removeClass(c):(this.$button.removeClass(this.options.style),this.$button.addClass(c))},liHeight:function(b){if(b||this.options.size!==!1&&!this.sizeInfo){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("ul"),f=document.createElement("li"),g=document.createElement("li"),h=document.createElement("a"),i=document.createElement("span"),j=this.options.header&&this.$menu.find(".popover-title").length>0?this.$menu.find(".popover-title")[0].cloneNode(!0):null,k=this.options.liveSearch?document.createElement("div"):null,l=this.options.actionsBox&&this.multiple&&this.$menu.find(".bs-actionsbox").length>0?this.$menu.find(".bs-actionsbox")[0].cloneNode(!0):null,m=this.options.doneButton&&this.multiple&&this.$menu.find(".bs-donebutton").length>0?this.$menu.find(".bs-donebutton")[0].cloneNode(!0):null;if(i.className="text",c.className=this.$menu[0].parentNode.className+" open",d.className="dropdown-menu open",e.className="dropdown-menu inner",f.className="divider",i.appendChild(document.createTextNode("Inner text")),h.appendChild(i),g.appendChild(h),e.appendChild(g),e.appendChild(f),j&&d.appendChild(j),k){var n=document.createElement("input");k.className="bs-searchbox",n.className="form-control",k.appendChild(n),d.appendChild(k)}l&&d.appendChild(l),d.appendChild(e),m&&d.appendChild(m),c.appendChild(d),document.body.appendChild(c);var o=h.offsetHeight,p=j?j.offsetHeight:0,q=k?k.offsetHeight:0,r=l?l.offsetHeight:0,s=m?m.offsetHeight:0,t=a(f).outerHeight(!0),u="function"==typeof getComputedStyle&&getComputedStyle(d),v=u?null:a(d),w={vert:parseInt(u?u.paddingTop:v.css("paddingTop"))+parseInt(u?u.paddingBottom:v.css("paddingBottom"))+parseInt(u?u.borderTopWidth:v.css("borderTopWidth"))+parseInt(u?u.borderBottomWidth:v.css("borderBottomWidth")),horiz:parseInt(u?u.paddingLeft:v.css("paddingLeft"))+parseInt(u?u.paddingRight:v.css("paddingRight"))+parseInt(u?u.borderLeftWidth:v.css("borderLeftWidth"))+parseInt(u?u.borderRightWidth:v.css("borderRightWidth"))},x={vert:w.vert+parseInt(u?u.marginTop:v.css("marginTop"))+parseInt(u?u.marginBottom:v.css("marginBottom"))+2,horiz:w.horiz+parseInt(u?u.marginLeft:v.css("marginLeft"))+parseInt(u?u.marginRight:v.css("marginRight"))+2};document.body.removeChild(c),this.sizeInfo={liHeight:o,headerHeight:p,searchHeight:q,actionsHeight:r,doneButtonHeight:s,dividerHeight:t,menuPadding:w,menuExtras:x}}},setSize:function(){if(this.findLis(),this.liHeight(),this.options.header&&this.$menu.css("padding-top",0),this.options.size!==!1){var b,c,d,e,f,g,h,i,j=this,k=this.$menu,l=this.$menuInner,m=a(window),n=this.$newElement[0].offsetHeight,o=this.$newElement[0].offsetWidth,p=this.sizeInfo.liHeight,q=this.sizeInfo.headerHeight,r=this.sizeInfo.searchHeight,s=this.sizeInfo.actionsHeight,t=this.sizeInfo.doneButtonHeight,u=this.sizeInfo.dividerHeight,v=this.sizeInfo.menuPadding,w=this.sizeInfo.menuExtras,x=this.options.hideDisabled?".disabled":"",y=function(){var b,c=j.$newElement.offset(),d=a(j.options.container);j.options.container&&!d.is("body")?(b=d.offset(),b.top+=parseInt(d.css("borderTopWidth")),b.left+=parseInt(d.css("borderLeftWidth"))):b={top:0,left:0};var e=j.options.windowPadding;f=c.top-b.top-m.scrollTop(),g=m.height()-f-n-b.top-e[2],h=c.left-b.left-m.scrollLeft(),i=m.width()-h-o-b.left-e[1],f-=e[0],h-=e[3]};if(y(),"auto"===this.options.size){var z=function(){var m,n=function(b,c){return function(d){return c?d.classList?d.classList.contains(b):a(d).hasClass(b):!(d.classList?d.classList.contains(b):a(d).hasClass(b))}},u=j.$menuInner[0].getElementsByTagName("li"),x=Array.prototype.filter?Array.prototype.filter.call(u,n("hidden",!1)):j.$lis.not(".hidden"),z=Array.prototype.filter?Array.prototype.filter.call(x,n("dropdown-header",!0)):x.filter(".dropdown-header");y(),b=g-w.vert,c=i-w.horiz,j.options.container?(k.data("height")||k.data("height",k.height()),d=k.data("height"),k.data("width")||k.data("width",k.width()),e=k.data("width")):(d=k.height(),e=k.width()),j.options.dropupAuto&&j.$newElement.toggleClass("dropup",(f>g&&b-w.vert<d)||j.$element[0].className.indexOf("dropupalways")!=-1),j.$newElement.hasClass("dropup")&&(b=f-w.vert),"auto"===j.options.dropdownAlignRight&&k.toggleClass("dropdown-menu-right",h>i&&c-w.horiz<e-o),m=x.length+z.length>3?3*p+w.vert-2:0,k.css({"max-height":b+"px",overflow:"hidden","min-height":m+q+r+s+t+"px"}),l.css({"max-height":b-q-r-s-t-v.vert+"px","overflow-y":"auto","min-height":Math.max(m-v.vert,0)+"px"})};z(),this.$searchbox.off("input.getSize propertychange.getSize").on("input.getSize propertychange.getSize",z),m.off("resize.getSize scroll.getSize").on("resize.getSize scroll.getSize",z)}else if(this.options.size&&"auto"!=this.options.size&&this.$lis.not(x).length>this.options.size){var A=this.$lis.not(".divider").not(x).children().slice(0,this.options.size).last().parent().index(),B=this.$lis.slice(0,A+1).filter(".divider").length;b=p*this.options.size+B*u+v.vert,j.options.container?(k.data("height")||k.data("height",k.height()),d=k.data("height")):d=k.height(),j.options.dropupAuto&&this.$newElement.toggleClass("dropup",f>g&&b-w.vert<d),k.css({"max-height":b+q+r+s+t+"px",overflow:"hidden","min-height":""}),l.css({"max-height":b-v.vert+"px","overflow-y":"auto","min-height":""})}}},setWidth:function(){if("auto"===this.options.width){this.$menu.css("min-width","0");var a=this.$menu.parent().clone().appendTo("body"),b=this.options.container?this.$newElement.clone().appendTo("body"):a,c=a.children(".dropdown-menu").outerWidth(),d=b.css("width","auto").children("button").outerWidth();a.remove(),b.remove(),this.$newElement.css("width",Math.max(c,d)+"px")}else"fit"===this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width","").addClass("fit-width")):this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width",this.options.width)):(this.$menu.css("min-width",""),this.$newElement.css("width",""));this.$newElement.hasClass("fit-width")&&"fit"!==this.options.width&&this.$newElement.removeClass("fit-width")},selectPosition:function(){this.$bsContainer=a('<div class="bs-container" />');var b,c,d,e=this,f=a(this.options.container),g=function(a){e.$bsContainer.addClass(a.attr("class").replace(/form-control|fit-width/gi,"")).toggleClass("dropup",a.hasClass("dropup")),b=a.offset(),f.is("body")?c={top:0,left:0}:(c=f.offset(),c.top+=parseInt(f.css("borderTopWidth"))-f.scrollTop(),c.left+=parseInt(f.css("borderLeftWidth"))-f.scrollLeft()),d=a.hasClass("dropup")?0:a[0].offsetHeight,e.$bsContainer.css({top:b.top-c.top+d,left:b.left-c.left,width:a[0].offsetWidth})};this.$button.on("click",function(){var b=a(this);e.isDisabled()||(g(e.$newElement),e.$bsContainer.appendTo(e.options.container).toggleClass("open",!b.hasClass("open")).append(e.$menu))}),a(window).on("resize scroll",function(){g(e.$newElement)}),this.$element.on("hide.bs.select",function(){e.$menu.data("height",e.$menu.height()),e.$bsContainer.detach()})},setSelected:function(a,b,c){c||(this.togglePlaceholder(),c=this.findLis().eq(this.liObj[a])),c.toggleClass("selected",b).find("a").attr("aria-selected",b)},setDisabled:function(a,b,c){c||(c=this.findLis().eq(this.liObj[a])),b?c.addClass("disabled").children("a").attr("href","#").attr("tabindex",-1).attr("aria-disabled",!0):c.removeClass("disabled").children("a").removeAttr("href").attr("tabindex",0).attr("aria-disabled",!1)},isDisabled:function(){return this.$element[0].disabled},checkDisabled:function(){var a=this;this.isDisabled()?(this.$newElement.addClass("disabled"),this.$button.addClass("disabled").attr("tabindex",-1).attr("aria-disabled",!0)):(this.$button.hasClass("disabled")&&(this.$newElement.removeClass("disabled"),this.$button.removeClass("disabled").attr("aria-disabled",!1)),this.$button.attr("tabindex")!=-1||this.$element.data("tabindex")||this.$button.removeAttr("tabindex")),this.$button.click(function(){return!a.isDisabled()})},togglePlaceholder:function(){var a=this.$element.val();this.$button.toggleClass("bs-placeholder",null===a||""===a||a.constructor===Array&&0===a.length)},tabIndex:function(){this.$element.data("tabindex")!==this.$element.attr("tabindex")&&this.$element.attr("tabindex")!==-98&&"-98"!==this.$element.attr("tabindex")&&(this.$element.data("tabindex",this.$element.attr("tabindex")),this.$button.attr("tabindex",this.$element.data("tabindex"))),this.$element.attr("tabindex",-98)},clickListener:function(){var b=this,c=a(document);c.data("spaceSelect",!1),this.$button.on("keyup",function(a){/(32)/.test(a.keyCode.toString(10))&&c.data("spaceSelect")&&(a.preventDefault(),c.data("spaceSelect",!1))}),this.$button.on("click",function(){b.setSize()}),this.$element.on("shown.bs.select",function(){if(b.options.liveSearch||b.multiple){if(!b.multiple){var a=b.liObj[b.$element[0].selectedIndex];if("number"!=typeof a||b.options.size===!1)return;var c=b.$lis.eq(a)[0].offsetTop-b.$menuInner[0].offsetTop;c=c-b.$menuInner[0].offsetHeight/2+b.sizeInfo.liHeight/2,b.$menuInner[0].scrollTop=c}}else b.$menuInner.find(".selected a").focus()}),this.$menuInner.on("click","li a",function(c){var d=a(this),f=d.parent().data("originalIndex"),g=b.$element.val(),h=b.$element.prop("selectedIndex"),i=!0;if(b.multiple&&1!==b.options.maxOptions&&c.stopPropagation(),c.preventDefault(),!b.isDisabled()&&!d.parent().hasClass("disabled")){var j=b.$element.find("option"),k=j.eq(f),l=k.prop("selected"),m=k.parent("optgroup"),n=b.options.maxOptions,o=m.data("maxOptions")||!1;if(b.multiple){if(k.prop("selected",!l),b.setSelected(f,!l),d.blur(),n!==!1||o!==!1){var p=n<j.filter(":selected").length,q=o<m.find("option:selected").length;if(n&&p||o&&q)if(n&&1==n)j.prop("selected",!1),k.prop("selected",!0),b.$menuInner.find(".selected").removeClass("selected"),b.setSelected(f,!0);else if(o&&1==o){m.find("option:selected").prop("selected",!1),k.prop("selected",!0);var r=d.parent().data("optgroup");b.$menuInner.find('[data-optgroup="'+r+'"]').removeClass("selected"),b.setSelected(f,!0)}else{var s="string"==typeof b.options.maxOptionsText?[b.options.maxOptionsText,b.options.maxOptionsText]:b.options.maxOptionsText,t="function"==typeof s?s(n,o):s,u=t[0].replace("{n}",n),v=t[1].replace("{n}",o),w=a('<div class="notify"></div>');t[2]&&(u=u.replace("{var}",t[2][n>1?0:1]),v=v.replace("{var}",t[2][o>1?0:1])),k.prop("selected",!1),b.$menu.append(w),n&&p&&(w.append(a("<div>"+u+"</div>")),i=!1,b.$element.trigger("maxReached.bs.select")),o&&q&&(w.append(a("<div>"+v+"</div>")),i=!1,b.$element.trigger("maxReachedGrp.bs.select")),setTimeout(function(){b.setSelected(f,!1)},10),w.delay(750).fadeOut(300,function(){a(this).remove()})}}}else j.prop("selected",!1),k.prop("selected",!0),b.$menuInner.find(".selected").removeClass("selected").find("a").attr("aria-selected",!1),b.setSelected(f,!0);!b.multiple||b.multiple&&1===b.options.maxOptions?b.$button.focus():b.options.liveSearch&&b.$searchbox.focus(),i&&(g!=b.$element.val()&&b.multiple||h!=b.$element.prop("selectedIndex")&&!b.multiple)&&(e=[f,k.prop("selected"),l],b.$element.triggerNative("change"))}}),this.$menu.on("click","li.disabled a, .popover-title, .popover-title :not(.close)",function(c){c.currentTarget==this&&(c.preventDefault(),c.stopPropagation(),b.options.liveSearch&&!a(c.target).hasClass("close")?b.$searchbox.focus():b.$button.focus())}),this.$menuInner.on("click",".divider, .dropdown-header",function(a){a.preventDefault(),a.stopPropagation(),b.options.liveSearch?b.$searchbox.focus():b.$button.focus()}),this.$menu.on("click",".popover-title .close",function(){b.$button.click()}),this.$searchbox.on("click",function(a){a.stopPropagation()}),this.$menu.on("click",".actions-btn",function(c){b.options.liveSearch?b.$searchbox.focus():b.$button.focus(),c.preventDefault(),c.stopPropagation(),a(this).hasClass("bs-select-all")?b.selectAll():b.deselectAll()}),this.$element.change(function(){b.render(!1),b.$element.trigger("changed.bs.select",e),e=null})},liveSearchListener:function(){var c=this,d=a('<li class="no-results"></li>');this.$button.on("click.dropdown.data-api",function(){c.$menuInner.find(".active").removeClass("active"),c.$searchbox.val()&&(c.$searchbox.val(""),c.$lis.not(".is-hidden").removeClass("hidden"),d.parent().length&&d.remove()),c.multiple||c.$menuInner.find(".selected").addClass("active"),setTimeout(function(){c.$searchbox.focus()},10)}),this.$searchbox.on("click.dropdown.data-api focus.dropdown.data-api touchend.dropdown.data-api",function(a){a.stopPropagation()}),this.$searchbox.on("input propertychange",function(){if(c.$lis.not(".is-hidden").removeClass("hidden"),c.$lis.filter(".active").removeClass("active"),d.remove(),c.$searchbox.val()){var e,f=c.$lis.not(".is-hidden, .divider, .dropdown-header");if(e=c.options.liveSearchNormalize?f.not(":a"+c._searchStyle()+'("'+b(c.$searchbox.val())+'")'):f.not(":"+c._searchStyle()+'("'+c.$searchbox.val()+'")'),e.length===f.length)d.html(c.options.noneResultsText.replace("{0}",'"'+j(c.$searchbox.val())+'"')),c.$menuInner.append(d),c.$lis.addClass("hidden");else{e.addClass("hidden");var g,h=c.$lis.not(".hidden");h.each(function(b){var c=a(this);c.hasClass("divider")?void 0===g?c.addClass("hidden"):(g&&g.addClass("hidden"),g=c):c.hasClass("dropdown-header")&&h.eq(b+1).data("optgroup")!==c.data("optgroup")?c.addClass("hidden"):g=null}),g&&g.addClass("hidden"),f.not(".hidden").first().addClass("active"),c.$menuInner.scrollTop(0)}}})},_searchStyle:function(){var a={begins:"ibegins",startsWith:"ibegins"};return a[this.options.liveSearchStyle]||"icontains"},val:function(a){return"undefined"!=typeof a?(this.$element.val(a),this.render(),this.$element):this.$element.val()},changeAll:function(b){if(this.multiple){"undefined"==typeof b&&(b=!0),this.findLis();var c=this.$element.find("option"),d=this.$lis.not(".divider, .dropdown-header, .disabled, .hidden"),e=d.length,f=[];if(b){if(d.filter(".selected").length===d.length)return}else if(0===d.filter(".selected").length)return;d.toggleClass("selected",b);for(var g=0;g<e;g++){var h=d[g].getAttribute("data-original-index");f[f.length]=c.eq(h)[0]}a(f).prop("selected",b),this.render(!1),this.togglePlaceholder(),this.$element.triggerNative("change")}},selectAll:function(){return this.changeAll(!0)},deselectAll:function(){return this.changeAll(!1)},toggle:function(a){a=a||window.event,a&&a.stopPropagation(),this.$button.trigger("click")},keydown:function(b){var c,d,e,f,g=a(this),h=g.is("input")?g.parent().parent():g.parent(),i=h.data("this"),j=":not(.disabled, .hidden, .dropdown-header, .divider)",k={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};if(f=i.$newElement.hasClass("open"),!f&&(b.keyCode>=48&&b.keyCode<=57||b.keyCode>=96&&b.keyCode<=105||b.keyCode>=65&&b.keyCode<=90))return i.options.container?i.$button.trigger("click"):(i.setSize(),i.$menu.parent().addClass("open"),f=!0),void i.$searchbox.focus();if(i.options.liveSearch&&/(^9$|27)/.test(b.keyCode.toString(10))&&f&&(b.preventDefault(),b.stopPropagation(),i.$menuInner.click(),i.$button.focus()),/(38|40)/.test(b.keyCode.toString(10))){if(c=i.$lis.filter(j),!c.length)return;d=i.options.liveSearch?c.index(c.filter(".active")):c.index(c.find("a").filter(":focus").parent()),e=i.$menuInner.data("prevIndex"),38==b.keyCode?(!i.options.liveSearch&&d!=e||d==-1||d--,d<0&&(d+=c.length)):40==b.keyCode&&((i.options.liveSearch||d==e)&&d++,d%=c.length),i.$menuInner.data("prevIndex",d),i.options.liveSearch?(b.preventDefault(),g.hasClass("dropdown-toggle")||(c.removeClass("active").eq(d).addClass("active").children("a").focus(),g.focus())):c.eq(d).children("a").focus()}else if(!g.is("input")){var l,m,n=[];c=i.$lis.filter(j),c.each(function(c){a.trim(a(this).children("a").text().toLowerCase()).substring(0,1)==k[b.keyCode]&&n.push(c)}),l=a(document).data("keycount"),l++,a(document).data("keycount",l),m=a.trim(a(":focus").text().toLowerCase()).substring(0,1),m!=k[b.keyCode]?(l=1,a(document).data("keycount",l)):l>=n.length&&(a(document).data("keycount",0),l>n.length&&(l=1)),c.eq(n[l-1]).children("a").focus()}if((/(13|32)/.test(b.keyCode.toString(10))||/(^9$)/.test(b.keyCode.toString(10))&&i.options.selectOnTab)&&f){if(/(32)/.test(b.keyCode.toString(10))||b.preventDefault(),i.options.liveSearch)/(32)/.test(b.keyCode.toString(10))||(i.$menuInner.find(".active a").click(),g.focus());else{var o=a(":focus");o.click(),o.focus(),b.preventDefault(),a(document).data("spaceSelect",!0)}a(document).data("keycount",0)}(/(^9$|27)/.test(b.keyCode.toString(10))&&f&&(i.multiple||i.options.liveSearch)||/(27)/.test(b.keyCode.toString(10))&&!f)&&(i.$menu.parent().removeClass("open"),i.options.container&&i.$newElement.removeClass("open"),i.$button.focus())},mobile:function(){this.$element.addClass("mobile-device")},refresh:function(){this.$lis=null,this.liObj={},this.reloadLi(),this.render(),this.checkDisabled(),this.liHeight(!0),this.setStyle(),
this.setWidth(),this.$lis&&this.$searchbox.trigger("propertychange"),this.$element.trigger("refreshed.bs.select")},hide:function(){this.$newElement.hide()},show:function(){this.$newElement.show()},remove:function(){this.$newElement.remove(),this.$element.remove()},destroy:function(){this.$newElement.before(this.$element).remove(),this.$bsContainer?this.$bsContainer.remove():this.$menu.remove(),this.$element.off(".bs.select").removeData("selectpicker").removeClass("bs-select-hidden selectpicker")}};var m=a.fn.selectpicker;a.fn.selectpicker=c,a.fn.selectpicker.Constructor=l,a.fn.selectpicker.noConflict=function(){return a.fn.selectpicker=m,this},a(document).data("keycount",0).on("keydown.bs.select",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',l.prototype.keydown).on("focusin.modal",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',function(a){a.stopPropagation()}),a(window).on("load.bs.select.data-api",function(){a(".selectpicker").each(function(){var b=a(this);c.call(b,b.data())})})}(a)});

(function(){'use strict';function Messi(data,options){var close;var _this=this;_this.options=jQuery.extend({},Messi.prototype.options,options||{});if(this.options.position===Messi.prototype.options.position){_this.options.position=_this.options.viewport;}
_this.messi=jQuery(_this.template);_this.setContent(data);if(_this.options.title===null){jQuery('.messi-titlebox',_this.messi).remove();}else{jQuery('.messi-title',_this.messi).append(_this.options.title);if((_this.options.buttons.length===0&&!_this.options.autoclose)||_this.options.closeButton){close=jQuery('<span class="messi-closebtn"></span>');close.on('click.MessiJS',function(){_this.hide();});jQuery('.messi-titlebox',this.messi).prepend(close);}
if(_this.options.titleClass!==null){jQuery('.messi-titlebox',this.messi).addClass(_this.options.titleClass);}}
if(_this.options.width!==null){jQuery('.messi-box',_this.messi).css('width',_this.options.width);}
if(_this.options.buttons.length>0){for(var i=0;i<_this.options.buttons.length;i++){var btnbox=jQuery('<div>',{'class':'messi-btnbox'}).css('width',parseInt(100/_this.options.buttons.length,10)+'%');var cls=(_this.options.buttons[i]['class'])?_this.options.buttons[i]['class']:'';var btn=jQuery('<button>',{href:'#','class':'btn '+cls,value:_this.options.buttons[i].val,'click':function(){var value=$(this).val();if(typeof _this.options.callback==='function'){if(_this.options.callback(value)===false){return this;}}
_this.hide();}}).text(_this.options.buttons[i].label);btnbox.append(btn);jQuery('.messi-actions',this.messi).append(btnbox);}}else{jQuery('.messi-footbox',this.messi).remove();}
if(_this.options.buttons.length===0&&_this.options.title===null&&!_this.options.autoclose){if(_this.options.closeButton){close=jQuery('<span class="messi-closebtn"></span>');close.on('click.MessiJS',function(){_this.hide();});jQuery('.messi-content',this.messi).prepend(close);}}
if(_this.options.modal){_this.modal=jQuery('<div class="messi-modal"></div>').css({opacity:_this.options.modalOpacity,width:jQuery(document).width(),height:jQuery(document).height(),position:'fixed','z-index':_this.options.zIndex+jQuery('.messi').length}).appendTo(document.body);}
if(_this.options.show){_this.show();}
if(_this.options.autoclose!==null){setTimeout(function(){var value=jQuery.data(this,'value');var after=(_this.options.callback!==null)?function(){_this.options.callback(value);}:null;_this.hide();},_this.options.autoclose,this);}
return _this;}
Messi.prototype={options:{autoclose:null,buttons:[],callback:null,center:true,closeButton:true,height:'auto',title:null,titleClass:null,margin:0,modal:false,modalOpacity:0.2,padding:'10px',position:{top:'0px',left:'0px'},show:true,unload:true,viewport:{top:'0px',left:'0px'},width:'500px',zIndex:99999},template:'<div class="messi"><div class="messi-box"><div class="messi-wrapper"><div class="messi-titlebox"><span class="messi-title"></span></div><div class="messi-content"></div><div class="messi-footbox"><div class="messi-actions"></div></div></div></div></div>',content:'<div></div>',visible:false,setContent:function(data){jQuery('.messi-content',this.messi).css({padding:this.options.padding,height:this.options.height}).empty().append(data);},center:function(){this.messi.css({top:((jQuery(window).height()-this.messi.height())/2),left:((jQuery(window).width()-this.messi.width())/2)});return this;},show:function(){if(this.visible){return;}
if(this.messi.parent().length===0){if(this.modal){this.modal.appendTo(document.body);}
this.messi.appendTo(document.body);}
if(this.modal){this.modal.show();}
this.messi.css({top:this.options.position.top,left:this.options.position.left});this.messi.css({'zIndex':this.options.zIndex+jQuery('.messi').length});if(this.options.animate){this.messi.addClass('animated '+this.options.animate.open);}
this.messi.show();if(this.options.center){this.center();}else{this.enforceMargin();}
this.visible=true;jQuery(window).on('resize.MessiJS scroll.MessiJS',this,Messi.prototype.resize);},hide:function(){if(!this.visible){return;}
var _this=this;if(this.options.animate){this.messi.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){_this.visible=false;if(_this.options.modal){_this.modal.css({display:'none'});}
_this.unload();});this.messi.removeClass(this.options.animate.open).addClass(this.options.animate.close);}else{if(_this.options.modal){_this.modal.css({display:'none'});}
_this.messi.css({display:'none'});_this.visible=false;_this.unload();}
return this;},resize:function(event){var _this=event.data;if(_this.options.modal){jQuery('.messi-modal').css({width:jQuery(document).width(),height:jQuery(document).height()});}
if(_this.options.center){_this.center();}else if(_this.options.margin>0){_this.enforceMargin();}},toggle:function(){this[this.visible?'hide':'show']();return this;},unload:function(){if(this.visible){this.hide();}
jQuery(window).off('resize.MessiJS scroll.MessiJS',Messi.prototype.resize);if(this.modal){this.modal.remove();}
this.messi.remove();},enforceMargin:function(){if(!this.options.margin){return;}
var $window=jQuery(window);var x=this.max(parseInt(this.options.viewport.left,10),parseInt(this.options.position.left,10));var y=this.max(parseInt(this.options.viewport.top,10),parseInt(this.options.position.top,10));if(x+this.messi.width()+this.options.margin>$window.width()){x=$window.width()-this.options.margin-this.messi.width();}
if(y+this.messi.height()+this.options.margin>$window.height()){y=$window.height()-this.options.margin-this.messi.height();}
if(x<this.options.margin){x=this.options.margin;}
if(y<this.options.margin){y=this.options.margin;}
this.messi.css({left:x,top:y});},jqueryize:function(){return this.messi;},max:function(a,b){if(a>b){return a;}
else{return b;}},};window.Messi=Messi;})();jQuery.extend(Messi,{alert:function(data,callback,options){var buttons=[{id:'ok',label:'OK',val:'OK'}];options=jQuery.extend({closeButton:true,buttons:buttons,callback:function(){}},options,{show:true,unload:true,callback:callback});return new Messi(data,options);},ask:function(data,callback,options){var buttons=[{id:'yes',label:'Yes',val:'Y','class':'btn-success'},{id:'no',label:'No',val:'N','class':'btn-danger'}];options=jQuery.extend({closeButton:false,modal:true,buttons:buttons,callback:function(){}},options,{show:true,unload:true,callback:callback});return new Messi(data,options);},img:function(src,options){var img=new Image();jQuery(img).load(function(){var vp={width:jQuery(window).width()-50,height:jQuery(window).height()-50};var ratio=(this.width>vp.width||this.height>vp.height)?Math.min(vp.width/this.width,vp.height/this.height):1;jQuery(img).css({width:this.width*ratio,height:this.height*ratio});options=jQuery.extend({show:true,unload:true,closeButton:true,width:this.width*ratio,height:this.height*ratio,padding:0},options);new Messi(img,options);}).error(function(){if(typeof window.console==='object'){console.log('Error loading '+src);}}).attr('src',src);},load:function(url,options){options=jQuery.extend({show:true,unload:true,params:{}},options);var request={url:url,data:options.params,dataType:'html',cache:false,error:function(request,status,error){if(typeof window.console==='object'){console.log(request.responseText);}},success:function(html){new Messi(html,options);}};jQuery.ajax(request);}});
fabric.Image.filters.Redify=fabric.util.createClass({type:'Redify',applyTo:function(canvasEl){var context=canvasEl.getContext('2d'),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data;for(var i=0,len=data.length;i<len;i+=4){data[i+0]=0;data[i+1]=0;data[i+2]=0;data[i+3]=0;}
context.putImageData(imageData,0,0);}});fabric.Image.filters.Redify.fromObject=function(object){return new fabric.Image.filters.Redify(object);};fabric.Object.prototype._applyEraseExe=function(ctx){var this_scl_w=this_scl_h=1;var ar_er=this.erasers||[];var ar_er_ln=ar_er.length;for(var j=0;j<ar_er_ln;j++){var row="",col="",size="";row=parseInt(ar_er[j][0]*this_scl_w);col=parseInt(ar_er[j][1]*this_scl_h);size=ar_er[j][2]||10;if(row===""||col===""||size===""){continue;}
ctx.clearRect(row,col,size,size);}}
fabric.Object.prototype.applyErase_v2=function(callback,row,col,size){var _this=this;size=10;var scale_x=scale_y=1;scale_x=this.scaleX||1;scale_y=this.scaleY||1;var flip_x=this.flipX||0;size=size/scale_x;var ar_er=this.get('erasers')||[];if(typeof(row)!="undefined"&&row>0){var w=(this.width/2)*scale_x;var h=(this.height/2)*scale_y;row=parseInt(row)-parseInt(w)-parseInt(size*scale_x/2);col=parseInt(col)-parseInt(h)-parseInt(size*scale_y/2);row=parseInt(row/scale_x);col=parseInt(col/scale_y);if(flip_x==1){row+=9;row=(row>0)?0-row:Math.abs(row);}
ar_er.push([row,col,size]);}
var ar_er_ln=ar_er.length;if(ar_er_ln<=0){return;}
this.set('erasers',ar_er);this.canvas.renderAll();return this;};fabric.Object.prototype.applyErase=function(callback,row,col,size){if(this.type!="c-image"){var ret=this.applyErase_v2(callback,row,col,size);return ret;}
size=size||75;if(this.width==730){size=20;}
var ar_er=this.get('erasers')||[];if(typeof(row)!="undefined"&&row>0){ar_er.push([row,col,size]);}
var ar_er_ln=ar_er.length;if(ar_er_ln<=0){return;}
if(this.type=="c-image"){var imgElement=this._originalElement;if(!imgElement){return;}
var imgEl=imgElement;}else{return;}
var canvasEl=fabric.util.createCanvasElement(),replacement=fabric.util.createImage(),_this=this;canvasEl.width=imgEl.width;canvasEl.height=imgEl.height;if(this.type=="c-image"){canvasEl.getContext('2d').drawImage(imgEl,0,0,imgEl.width,imgEl.height);}
var this_scaleX=parseFloat(this.scaleX)||1,this_scaleY=parseFloat(this.scaleY)||1;var this_w=parseInt(this.width),this_h=parseInt(this.height);var this_scl_w=parseFloat((imgEl.width/this_w)/this_scaleX),this_scl_h=parseFloat((imgEl.height/this_h)/this_scaleY);var context=canvasEl.getContext('2d');for(var j=0;j<ar_er_ln;j++){var row="",col="",size="";size=parseInt(ar_er[j][2]/this_scaleX);row=parseInt(ar_er[j][0]*this_scl_w)-parseInt(size/2);col=parseInt(ar_er[j][1]*this_scl_h)-parseInt(size/2);if(row===""||col===""||size===""){continue;}
context.clearRect(row,col,size,size);}
this.set('erasers',ar_er);if(fabric.isLikelyNode){replacement.src=canvasEl.toBuffer(undefined,fabric.Image.pngCompression);_this._element=replacement;callback&&callback();}
else{replacement.onload=function(){_this._element=replacement;callback&&callback();replacement.onload=canvasEl=imgEl=null;};replacement.src=canvasEl.toDataURL('image/png');}
return canvasEl;};fabric.CImage=fabric.util.createClass(fabric.Image,{type:'c-image',initialize:function(element,options){this.callSuper('initialize',element,options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});}});fabric.CImage.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){callback&&callback(new fabric.CImage(img,object));});};fabric.CImage.async=true;fabric.CImage.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img){callback&&callback(new fabric.CImage(img,imgOptions));},null,imgOptions&&imgOptions.crossOrigin);};fabric.Citext=fabric.util.createClass(fabric.IText,{type:'citext',initialize:function(element,options){options||(options={});this.callSuper('initialize',element,options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.Citext.fromObject=function(object){return new fabric.Citext(object.text,object);};fabric.Citext.async=false;fabric.Citextb=fabric.util.createClass(fabric.IText,{type:'citextb',initialize:function(element,options){options||(options={});this.callSuper('initialize',element,options);options&&this.set('unit',options.unit);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{unit:this.unit});},_render:function(ctx){this.callSuper('_render',ctx);}});fabric.Citextb.fromObject=function(object){return new fabric.Citextb(object.text,object);};fabric.Citextb.async=false;fabric.CRect=fabric.util.createClass(fabric.Rect,{type:'cRect',initialize:function(options){options||(options={});this.callSuper('initialize',options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.CRect.fromObject=function(object){return new fabric.CRect(object);};fabric.CRect.async=false;fabric.CCircle=fabric.util.createClass(fabric.Circle,{type:'cCircle',initialize:function(options){options||(options={});this.callSuper('initialize',options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.CCircle.fromObject=function(object){return new fabric.CCircle(object);};fabric.CCircle.async=false;fabric.CLine=fabric.util.createClass(fabric.Line,{type:'cLine',initialize:function(points,options){options||(options={});this.callSuper('initialize',points,options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.CLine.fromObject=function(object){var points=[object.x1,object.y1,object.x2,object.y2];return new fabric.CLine(points,object);};fabric.CLine.async=false;fabric.CPath=fabric.util.createClass(fabric.Path,{type:'cPath',initialize:function(path,options){options||(options={});this.callSuper('initialize',path,options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.CPath.fromObject=function(object,callback){callback(new fabric.CPath(object.path,object));};fabric.CPath.async=true;fabric.CPencilBrush=fabric.util.createClass(fabric.PencilBrush,{initialize:function(canvas){this.callSuper('initialize',canvas);},createPath:function(pathData){var path=new fabric.CPath(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:'center',originY:'center'});if(this.shadow){this.shadow.affectStroke=true;path.setShadow(this.shadow);}
return path;}});fabric.CGroup=fabric.util.createClass(fabric.Group,{type:'cGroup',initialize:function(path,options){options||(options={});this.callSuper('initialize',path,options);options&&this.set('erasers',options.erasers);},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{erasers:this.erasers});},_render:function(ctx){this.callSuper('_render',ctx);this._applyEraseExe(ctx);}});fabric.CGroup.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&&callback(new fabric.CGroup(enlivenedObjects,object));});};fabric.CGroup.async=true;fabric.CSprayBrush=fabric.util.createClass(fabric.SprayBrush,{initialize:function(canvas){this.callSuper('initialize',canvas);},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var rects=[];var cg_fill_clr="#000000";for(var i=0,ilen=this.sprayChunks.length;i<ilen;i++){var sprayChunk=this.sprayChunks[i];for(var j=0,jlen=sprayChunk.length;j<jlen;j++){cg_fill_clr=this.color;var rect=new fabric.CRect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:'center',originY:'center',fill:this.color});this.shadow&&rect.setShadow(this.shadow);rects.push(rect);}}
if(this.optimizeOverlapping){rects=this._getOptimizedRects(rects);}
cg_fill_clr=(typeof(cg_fill_clr)!="undefined"&&cg_fill_clr!="")?cg_fill_clr:"#000000";var group=new fabric.CGroup(rects,{originX:'center',originY:'center',fill:cg_fill_clr});group.canvas=this.canvas;this.canvas.add(group);this.canvas.fire('path:created',{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.renderAll();}});
var escapeRegExp=function(string){return string.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");}
function rgp(s,m){if(typeof(s)!="undefined"&&s!=""){if(typeof(m)=="undefined"){m="gi";}
return new RegExp(s,m);}
return s;}
function js_htmlentities(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function mk_var_nm(str,wh){str=str.replace(/[^0-9a-z]/gi,'');str=wh+str;return str;}
function regReplace(ptrn,repW,str){if($.trim(ptrn)!=""){var reg=new RegExp(ptrn,"g");var mtch=str.match(reg);if(mtch){str=str.replace(reg,"");}else{}}
return $.trim(str);}
function gebi(id,t){var o;if(t==1){o=document.getElementsByName(id);}else if(t==2){o=document.getElementsByTagName(id);}else{o=document.getElementById(id);if(o==null){o=document.getElementsByName(id)[0];}}
return o;}
function stopClickBubble(flg)
{var ev=window.event;if(ev){if(typeof(flg)!="undefined"&&flg==1){var chk=ev.srcElement.nodeName;var chktag=ev.srcElement.tagName;var eType=ev.srcElement.type;if(chk=="INPUT"||chk=="TEXTAREA"||((eType=="change"||eType=="keyup"||eType=="mousedown")&&chk=="SELECT")){return;}}
ev.cancelBubble=true;if(ev.stopPropagation)ev.stopPropagation();}}
function get_src_center(){var left=($(window).width()/2);var top=($(window).height()/2);return{'top':top,'left':left};}
function scroll_into_view(sele,hid){var offset=$(sele).offset();var diff=0;var scrollTop=$(window).scrollTop();var scrollBottom=scrollTop+$(window).height();var ofHgt=$(sele).height();var offsetBottom=offset.top+ofHgt;if(offsetBottom>scrollBottom){diff=scrollTop+(offsetBottom-scrollBottom);$('html, body').animate({scrollTop:diff},'slow','linear');}}
function get_js_dt_frmt(){var d=(typeof(top.jquery_date_format)!="undefined"&&top.jquery_date_format!="")?top.jquery_date_format:"mm-dd-yy";if(d=="m-d-Y"){d="mm-dd-yy";}
return d;}
function currenttime(){var Digital=new Date()
var hours=Digital.getHours()
var minutes=Digital.getMinutes()
var seconds=Digital.getSeconds()
var dn="PM"
if(hours<12)
dn="AM"
if(hours>12)
hours=hours-12
if(hours==0)
hours=12
if(minutes<=9)
minutes="0"+minutes
if(seconds<=9)
seconds="0"+seconds
var ctime=hours+":"+minutes+dn
return ctime;}
function insertDate(obj){var id=obj.name.replace(/Txt/g,"Dt");var tobj=gebi(id);if(tobj){tobj.value=$.datepicker.formatDate('mm-dd-yy',new Date());}}
function insertTime(obj){var id=obj.name.replace(/finding/g,"timeStamp");var tobj=gebi(id);if(tobj&&tobj.value==""){tobj.value=currenttime();if(typeof(tobj.onblur)=="function"){tobj.onblur();}}
if(obj.name.indexOf("schirmer")!=-1){var id=obj.name.replace(/finding/g,"date");var tobj=gebi(id);if(tobj&&tobj.value==""){tobj.value=$.datepicker.formatDate('mm-dd-yy',new Date());}}}
function fun_mselect(o,w,v,t,f){if(w=="val"){var x=$(o).selectpicker('val');if(!x){x="";}return x;}else if(w=="title"){return $(o).parent().find("button").attr("title");}else if(w=='render'||w=='refresh'){$(o).selectpicker(w);}else if(w=='select'){if(typeof(f)!="undefined"&&f!=""){if(typeof(v)!="undefined"&&v.length>0){var ar_chk=v.split(', ');}}
$(o).find('option[value]').each(function(){var art=this.value.split('\*\*');var tv=this.value;if(typeof(f)!="undefined"&&f!=""){if(typeof(ar_chk)!="undefined"&&ar_chk.length>0){this.selected=(ar_chk.indexOf(tv)!=-1)?true:false;}}else{this.selected=(typeof(v)!="undefined"&&v.length>0&&(v.indexOf(art[0])!=-1||v.indexOf(tv)!=-1))?true:false;}});fun_mselect(o,'render');if(typeof(t)!="undefined"&&t!=""){fun_mselect(o,'settitle',t);}}else if(w=="settitle"){var op=$(o).parent();var ob=op.find("button");ob.attr("title",v);if(v==""){ob.find("span.filter-option").html(v);op.find("ul li").removeClass("selected");}}else if(w=='unselect'){$(o).find('option[value]').each(function(){if(typeof(v)!="undefined"&&this.value==v){this.selected=false;}});fun_mselect(o,'render');}else if(w=='onchange'){$(o).on('changed.bs.select',v);}else if(w=='width'){var aw=0,w="";aw=$("#tblSuperbill").data("dx_width");if(typeof(aw)=="undefined"){$("#tblSuperbill").hide();var otd=$("#tblSuperbill").parent().find(".grythead th:nth-child(3)");aw=otd[0].offsetWidth;if(typeof(aw)=="undefined"){aw=otd.attr("width");}
$("#tblSuperbill").data("dx_width",aw);$("#tblSuperbill").show();}
if(typeof(aw)=="undefined"){aw=0;}
$(o).each(function(){if($(this).parents("#tblSuperbill").length==0){return true;}
if(aw!=0){$(this).parents("td.dx").attr("width",aw);var aw1=aw;$(this).parents(".bootstrap-select").css({"width":aw1+"px"});$(this).parents(".bootstrap-select").find("span.filter-option").css({"white-space":"normal"});}
var ttl=$(this).attr("title");if(typeof(ttl)!="undefined"&&$.trim(ttl)!=""){$(this).parents(".bootstrap-select").find("button").attr("title",ttl);}});}}
function setProcessImg(f,id,msg,t,lft,delay){var o=null;if(o==null){var ogsc=get_src_center();var left=ogsc.left-100;var top=ogsc.top-100;o={'top':top,'left':left};id="";}
if(f==0){if(typeof(id)!="undefined"&&$("#div_loading_image.prcsing"+id+"").length>0){$("#div_loading_image.prcsing"+id+"").hide().remove();}else{$("#div_loading_image").hide().remove();}
return;}else if(f==1){if(o!=null){if($("#div_loading_image.prcsing"+id+"").length<=0){if(typeof(msg)!="undefined"&&msg!=""){msg="<div id=\"div_loading_text\" class=\"text-info\">"+msg+"</div>";}else{msg="";}
var prsc="<div id=\"div_loading_image\" class=\"text-center prcsing"+id+"\">"+"<div class=\"loading_container\">"+"<div class=\"process_loader\"></div>"+""+msg+""+"</div>"+"</div>";$("body").append(prsc);$("#div_loading_image.prcsing"+id+"").css({"left":lft+"px","top":t+"px","position":"fixed","z-index":"1000000"});if(typeof(delay)!="undefined"&&delay!=""&&!isNaN(delay)){$("#div_loading_image.prcsing"+id+"").delay(delay).fadeOut(400);setTimeout(function(){$("#div_loading_image.prcsing"+id+"").hide().remove();},parseInt(delay)+400);}}}}}
function displayConfirmYesNo_v2(title,msg,btn1,btn2,func,showCancel,showImage,misc){if(typeof(func)=="undefined"){func="";}
if((typeof(showImage)=="undefined")||(showImage!=0)){showImage="<span class=\"ui-icon ui-icon-alert\" >";}else{showImage="";}
var htm=""+"<div id=\"dialog-confirm\" title=\""+title+"\">"+"<p>"+showImage+"</span>"+msg+"</p>"+"</div>";$("#dialog-confirm").remove();$("body").append(htm);var btn=[];if(typeof(btn1)!="undefined"&&btn1!=""&&btn1!="0"){btn[btn.length]={text:""+btn1,'class':"ui-btn-sucus",click:function(){if(func!=""){eval(""+func+"(1);");};$(this).dialog("close");$("#dialog-confirm").remove();}};}
if(typeof(btn2)!="undefined"&&btn2!=""&&btn2!="0"){btn[btn.length]={text:""+btn2,'class':"ui-btn-sucus",click:function(){if(func!=""){eval(""+func+"(0);");};$(this).dialog("close");$("#dialog-confirm").remove();}};}
if((typeof showCancel=="undefined")||(showCancel!=0)){btn[btn.length]={text:"Cancel",'class':"ui-btn-cncl",click:function(){if(func!=""){eval(""+func+"(-1);");};$(this).dialog("close");$("#dialog-confirm").remove();}};}
$("#dialog-confirm").dialog({resizable:false,height:"auto",width:400,modal:true,buttons:btn});}
function open_print_window(resp){var parWidth=595;var parHeight=841;var printOptionStyle;printOptionStyle='p';window.open(''+zPath+'/../library/html_to_pdf/createPdf.php?op='+printOptionStyle+'&file_location='+resp+'','_parent','scrollbars=1,resizable=1,width='+parWidth+'height='+parHeight+'');}
function hide_modal(id){$("#"+id).modal('hide');setTimeout(function(){$("#"+id+", .modal-backdrop").remove();},"500");}
function renew_title(o,s){if($.trim(s)==""){$(o).attr('title',"").tooltip('disable');}else{$(o).tooltip('enable');$(o).attr('title',""+s).tooltip('fixTitle').tooltip('setContent');}}
function single_chkbx(ob){var nm=ob.name;var o=document.getElementsByName(nm);var ln=o.length;for(i=0;i<ln;i++){if(o[i].id!=ob.id){o[i].checked=false;}}}
var flash_msg_c=0;function flash_msg(msg,type){if(typeof(msg)!="undefined"&&msg!=""){var tp=10+(10*flash_msg_c);var htm='<div id="flash_msg_c'+flash_msg_c+'" style="position:fixed;z-index:1000;top:'+tp+'%;right:0%;min-width:200px;min-height:20px;" class="flsh alert alert-'+type+'">'+''+msg+'</div>';$("body").append(htm);setTimeout(function(){$('.flsh').fadeOut('slow');if(flash_msg_c>0){flash_msg_c=flash_msg_c-1;}},1000);flash_msg_c=flash_msg_c+1;}}
var isiPad=(navigator.userAgent.match(/iPad/i)!=null)?1:0;var isSafari=(navigator.userAgent.match(/Safari/i)!=null&&navigator.userAgent.match(/Chrome/i)==null)?1:0;var oPUF=[];var oPP=[];var oPO=[];var oPF=[];var arrSchPop=[];var icd10_unique_obj_id='';function setSavedBtn(flg,txt){top.$("#save,#btnFinalize,#cancel").prop("disabled",function(){return(flg==1)?true:false;});var tmp=(typeof(txt)!="undefined"&&txt!="")?txt:"Saving chart notes. Please Wait! ";if(typeof(setProcessImg)!='undefined')setProcessImg(flg,"",tmp);}
function showOtherForms(u,n,w,h,scrl)
{scrl=(typeof scrl!="undefined")?scrl:1;if(u!=""){var features='location=0,status=1,resizable=1,left=0,top=0,scrollbars='+scrl+',width='+w+',height='+h;top.popup_win(u,features);}}
function setThisChangeStatus(obj){isFormChanged=1;}
function loadRVS(flag,wh){if($("#div_rvs").length==0){var url="onload_wv.php";var p="elem_action=loadRVS";p+="&finalize_flag="+$("#elem_isFormFinalized").val();p+="&form_id="+$("#elem_masterId").val();if(typeof(setProcessImg)!='undefined')setProcessImg("1","rvsBtn");$.post(url,p,function(data){if(data!=""){if(typeof(setProcessImg)!='undefined')setProcessImg("0","rvsBtn");$("#frmMain").append(""+data);$("#div_rvs").show();$("#div_rvs,#detailDesc1,#detailDesc2").draggable({handle:".handleDrag"});if(typeof(wh)!="undefined"&&wh!=""){$("#"+wh).triggerHandler("click");}}});}else{if($("#div_rvs").css("display")=="none"||(typeof(wh)!="undefined"&&wh!="")){$("#div_rvs").show();if(typeof(wh)!="undefined"&&wh!=""){$("#"+wh).triggerHandler("click");}}else{$("#div_rvs").hide();}}
stopClickBubble();}
function setUserName(str){var obj={"id":""+authUserID,"name":""+authUserNM};if(str=="elem_ccHx"){var otd=gebi("td_cosigner");var ocid=gebi("elem_cosigner_id");var ocname=gebi("elem_cosigner_name");}
if(str.indexOf("MR")!=-1){var ocid="elem_providerId";var ocname="elem_providerName";var mri=str.replace("MR","");if(mri>1){ocid+="Other";ocname+="Other";}
if(mri>2){ocid+="_"+mri;ocname+="_"+mri;}
ocid=gebi(ocid);ocname=gebi(ocname);}
if(ocid&&ocname){if(str=="elem_ccHx"){var oPrId=gebi("elem_pro_id");if(oPrId&&((oPrId.value!="")&&(oPrId.value==obj.id))){return false;}}
ocid.value=obj.id;if(typeof ocid.onchange=="function"){ocid.onchange();}
if(typeof ocid.onkeyup=="function"){ocid.onkeyup();}
if(typeof ocid.onkeydown=="function"){ocid.onkeydown();}
ocname.value=obj.name;if(str!="elem_ccHx"){changeVisionStatus(ocname,1,1);changeVisionStatus(ocid,1,1);if(str.indexOf("MR")!=-1){renew_title(ocname,ocname.value);}}
if(otd){otd.style.visibility="visible";}}}
function getTechMandatory(obj){var str=$.trim(obj.value);if(str==""||user_type!='3'){$("#tm_ocualr,#tm_general_health,#tm_medication,#tm_surgeries,#tm_allergies,#tm_immunizations,"+"#tm_social,#tm_cvf,#tm_visit,#tm_cc_history,#tm_vision,#tm_distance,#tm_near,"+"#tm_ar,#tm_pc,#tm_mr,#tm_cvf_c,"+"#tm_amsler_grid,#tm_icp_color_plates,#tm_steroopsis,#tm_diplopia,#tm_retinoscopy,"+"#tm_exophthalmometer,#tm_pupil,#tm_eom,#tm_external,#tm_iop").each(function(){$(this).val("");});return;}
if(typeof(setProcessImg)!='undefined')setProcessImg("1","techman");$.get('requestHandler.php?elem_formAction=getTechMandtory&elem_visitCode='+str,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","techman");if(d){for(var x in d){if(x!="tech_id"&&x!="ptVisit"){$("#tm_"+x).val(d[x]);}}}},'json');}
function tm_checkExmdone(exm){var os=gebi("elem_se_"+exm);var s=(os)?gebi("elem_se_"+exm).value:"";if(s!=""&&s.indexOf("=1")!=-1){if(gebi("elem_pos"+exm).value==1||gebi("elem_wnl"+exm+"").value==1){return true;}else if(exm!="Eom"&&(gebi("elem_wnl"+exm+"Od").value==1||gebi("elem_wnl"+exm+"Os").value==1)){return true;}}
return false;}
function mandatory_ovr(){}
function mandotry_chk(val){if(val==1){return;}
if(user_type=='3'){var ocualr=$("#tm_ocualr").val();var general_health=$("#tm_general_health").val();var medication=$("#tm_medication").val();var surgeries=$("#tm_surgeries").val();var allergies=$("#tm_allergies").val();var immunizations=$("#tm_immunizations").val();var social=$("#tm_social").val();var cvf=$("#tm_cvf").val();var visit=$("#tm_visit").val();var cc_history=$("#tm_cc_history").val();var vision=$("#tm_vision").val();var distance=$("#tm_distance").val();var near=$("#tm_near").val();var ar=$("#tm_ar").val();var pc=$("#tm_pc").val();var mr=$("#tm_mr").val();var cvf_c=$("#tm_cvf_c").val();var amsler_grid=$("#tm_amsler_grid").val();var icp_color_plates=$("#tm_icp_color_plates").val();var steroopsis=$("#tm_steroopsis").val();var diplopia=$("#tm_diplopia").val();var retinoscopy=$("#tm_retinoscopy").val();var exophthalmometer=$("#tm_exophthalmometer").val();var pupil=$("#tm_pupil").val();var eom=$("#tm_eom").val();var external=$("#tm_external").val();var iop=$("#tm_iop").val();var show_name="Please fill in the following:- <br>\n";var flag_chk=0;var tmp,tmp1;if(visit=='yes'){tmp=top.fmain.gebi('elem_ptVisit_chk');tmp1=1;if(tmp&&tmp.value==''){tmp1=0;show_name+='-Visit<br>\n';flag_chk+=1;}}
if(cc_history=='yes'){tmp=gebi("elem_chk");tmp=ccHxDefStr(tmp.value,1);tmp1=1;if(tmp==''){tmp1=0;show_name+='-CC & History<br>\n';flag_chk+=1;}}
if(vision=='yes'){var show_name1='';if(distance=='yes'){tmp=isVisElemDone(["elem_visDisOdSel1","elem_visDisOsSel1"]);tmp1=1;if(tmp==false){tmp1=0;show_name1+='-Distance<br>\n';flag_chk+=1;}}
if(near=='yes'){tmp=isVisElemDone(["elem_visNearOdSel1","elem_visNearOsSel1"]);tmp1=1;if(tmp==false){tmp1=0;show_name1+='-Near<br>\n';flag_chk+=1;}}
if(ar=='yes'){tmp=isVisElemDone(["elem_visArOdS","elem_visArOsS"]);tmp1=1;if(tmp==false){tmp1=0;show_name1+='-AR<br>\n';flag_chk+=1;}}
if(pc=='yes'){tmp=isVisElemDone(["elem_visPcOdSel1","elem_visPcOsSel1"]);tmp1=1;if(tmp==false){tmp1=0;show_name1+='-PC<br>\n';}}
if(mr=='yes'){tmp=isVisElemDone(["elem_visMrOdS","elem_visMrOsS"]);tmp1=1;if(tmp==false){tmp1=0;show_name1+='-MR<br>\n';flag_chk+=1;}}
if(show_name1){show_name+='-Vision<br>\n';show_name+=show_name1;}}
if(icp_color_plates=='yes'){tmp=isVisElemDone(["elem_color_sign_od","elem_color_od_1","elem_color_od_2","elem_color_sign_os","elem_color_os_1","elem_color_os_2"]);tmp1=1;if(tmp==false){vis_show_sec('r4',1);tmp1=0;show_name+='-ICP Color Plate<br>\n';flag_chk+=1;}}
if(steroopsis=='yes'){tmp=isVisElemDone(["elem_stereo_SecondsArc"]);tmp1=1;if(tmp==false){vis_show_sec('r4',1);tmp1=0;show_name+='-Stereopsis<br>\n';flag_chk+=1;}}
if(retinoscopy=='yes'){tmp=isVisElemDone(["elem_visExoOdS","elem_visExoOsS"]);tmp1=1;if(tmp==false){vis_show_sec('r4',1);tmp1=0;show_name+='-Retinoscopy<br>\n';flag_chk+=1;}}
if(exophthalmometer=='yes'){tmp=isVisElemDone(["elem_visRetPD","elem_visRetOd","elem_visRetOs"]);tmp1=1;if(tmp==false){vis_show_sec('r4',1);tmp1=0;show_name+='-Exophthalmometer<br>\n';flag_chk+=1;}}
if(pupil=='yes'){tmp=tm_checkExmdone("Pupil");tmp1=1;if(tmp==false){tmp1=0;show_name+='-Pupil<br>\n';flag_chk+=1;}}
if(eom=='yes'){tmp=tm_checkExmdone("Eom");tmp1=1;if(tmp==false){tmp1=0;show_name+='-EOM<br>\n';flag_chk+=1;}}
if(external=='yes'){tmp=tm_checkExmdone("Ee");tmp1=1;if(tmp==false){tmp1=0;show_name+='-External<br>\n';flag_chk+=1;}}
if(iop=='yes'){tmp1=1;var sid=gebi('elem_sumOdIOP');var sis=gebi('elem_sumOsIOP');var sad=gebi('elem_sumOdAnesthetic');var sas=gebi('elem_sumOsAnesthetic');var sdd=gebi('elem_sumOdDilation');var sds=gebi('elem_sumOsDilation');if(sid&&sis&&sad&&sas&&sdd&&sds&&($.trim(sid.innerHTML)=='')&&($.trim(sis.innerHTML)=='')&&($.trim(sad.innerHTML)=='')&&($.trim(sas.innerHTML)=='')&&($.trim(sdd.innerHTML)=='')&&($.trim(sds.innerHTML)=='')){tmp1=0;show_name+='-IOP<br>';flag_chk+=1;}}
if(amsler_grid=="yes"){if($("#amsgrid .positive").length<=0&&$("#amsgrid .wnl_lbl").length<=0){show_name+='-Amsler Grid<br>';flag_chk+=1;}}
if(cvf_c=="yes"){if($("#cvf .positive").length<=0&&$("#cvf .wnl_lbl").length<=0){show_name+='-CVF<br>';flag_chk+=1;}}
if(diplopia=="yes"){if($("#dv_w4dot .active").length<=0){show_name+='-Diplopia/Worth for dot<br>';flag_chk+=1;}}
if(val==2){if(flag_chk>0){var title="Tech Warning";var msg=""+show_name+"<BR>";var btn1="Continue & Save";var func="top.fmain.decideTechWarning";top.fmain.displayConfirmYesNo_v2(title,msg,btn1,0,func,1);}else{return true;}}}else{return true;}}
function decideTechWarning(val){if(val=="1"){top.fmain.saveMainPage(1);}}
function utElem_capture(e){if(!e){return;}
var clr=(typeof(ProClr[logged_user_type])!="undefined")?ProClr[logged_user_type]:"";var clr1,clr2;if(typeof(clr)=="string"){clr1=clr2=clr;}else if(typeof(clr)=="object"){clr1=clr[0];clr2=clr[1];}
if(e.target){var eo=e.target;var enm=eo.name;var eid=eo.id;}else{var eo=e;var enm=e.name;var eid=e.id;}
var wc=(typeof(examName)!="undefined"&&examName!=""&&typeof(getWcId)!="undefined"&&(examName=="LA"||examName=="Fundus"||examName=="SLE"))?getWcId():{nm:""};var elue="#elem_utElems"+wc.nm;var elue_cr=elue+"_cur";if(typeof(enm)!="undefined"&&(enm.indexOf("_peri")!=-1||enm.indexOf("elem_rvcd")!=-1)&&wc.nm==""){return;}
var tmp=$(elue_cr).val();if(typeof(tmp)=="undefined")tmp="";var str=""+$(elue).val();if(typeof(eid)=="undefined"||eid==""){eid=""+enm;}
var n="[^a-zA-Z0-9_\-]";var rs=eid.match(n);if(rs){return;}
str=str.replace(eid+",","");$(elue).val(str);if(tmp.indexOf(eid+",")==-1){tmp=tmp+eid+",";}
$(elue_cr).val(tmp);if(typeof(enm)!="undefined"&&enm.indexOf("elem_ocMeds")==-1){if((eo.type=="checkbox"&&eo.checked==false)||((eo.type=="text"||eo.type=="textarea"||eo.type=="select-one")&&(eo.value==""||eo.value=="20/"))){if(eo.type=="checkbox"){clr2="transparent";}else{clr1="white";}
tmp=""+tmp.replace(eid+",","");$(elue_cr).val(tmp);}
if(eo.type=="checkbox"){$(eo).css("background-color",clr2);$("label[for="+eid+"]").css({"border-color":""+clr2})}
else if(eo.type=="select-one"&&(typeof(examName)!="undefined"&&examName=="Fundus")&&typeof(eo.onclick)!="function"){$(eo).css("background-color",clr1).trigger("click");}
else{$(eo).css("background-color",clr1);}}}
function utElem_setBgColor(dvSmartC){if(typeof(dvSmartC)!="undefined"&&dvSmartC!=""){var str=$("#elem_utElems_smartchart").val();var maincontainer=" #"+dvSmartC+" ";}else{var str=$("#elem_utElems").val();var maincontainer=" body ";}
if(typeof(str)!="undefined"&&str!=""){var rep,clr,clr1,clr2;var ar=str.split("|");var ln=ar.length;for(i=0;i<ln;i++){var t=ar[i].split("@");clr=ProClr[t[0]];if(typeof(clr)=="string"){clr1=clr2=clr;}else if(typeof(clr)=="object"){clr1=clr[0];clr2=clr[1];}
var a=(t[1]&&typeof(t[1])!="undefined")?t[1].split(","):[];var l=a.length;for(var j=0;j<l;j++){if(a[j]!=""){if(a[j].indexOf("[]")!=-1||a[j].indexOf("[")!=-1||a[j].indexOf("elem_ocMeds")!=-1||a[j].indexOf("%")!=-1){continue;}
$(""+maincontainer+" *[name="+a[j]+"], "+maincontainer+" #"+a[j]+"").css("background-color",function(){if(this.type=="checkbox"){if(this.checked!=false){var tmpfor=(typeof(this.id)!="undefined"&&this.id!="")?this.id:a[j];if($("label[for="+tmpfor+"]").length==0){if($(":input[name='"+tmpfor+"']").length>0&&$(":input[name='"+tmpfor+"']").attr("id")!=""){tmpfor=""+$(":input[name='"+tmpfor+"']").attr("id");}}
$("label[for="+tmpfor+"]").css({"border-color":""+clr2});}
return(this.checked==false)?"transparent":clr2;}else{return(this.value=='')?"":clr1;}});}}}}}
function set_refer_phy_tbar(flgdb){if(typeof(flgdb)!="undefined"&&flgdb=="1"){$.get(zPath+'/chart_notes/requestHandler.php?elem_formAction=get_refer_phy',function(d){if(typeof(d)!="undefined"){$("#strPtRefPhy").val(d);set_refer_phy_tbar();}});return;}
var d=$("#strPtRefPhy").val();if(d&&d!=""){var arrTemp=new Array();arrTemp=d.split("!@!");var ref_phy_name=arrTemp[0]
if(arrTemp[0].search(",")>0){ref_phy_name=arrTemp[0];}
var pcp_name=arrTemp[1]
if(arrTemp[1].search(",")>0){pcp_name=arrTemp[1];}
var cm_name=arrTemp[2]
if(arrTemp[2].search(",")>0){cm_name=arrTemp[2];}
if(typeof(ref_phy_name)!='undefined'){top.$("#spanDetailRefPhy").html(""+ref_phy_name);}
if(typeof(pcp_name)!='undefined'){top.$("#spanDetailPCP").html(""+pcp_name);}
if(typeof(cm_name)!='undefined'){top.$("#spanDetailCoMangPhy").html(""+cm_name);}
if(ref_phy_name){top.$("#spanDetailRefPhy").attr('data-original-title',"<span class='text-nowrap'>"+arrTemp[6]+"</span>");}
if(pcp_name){top.$("#spanDetailPCP").attr('data-original-title',"<span class='text-nowrap'>"+arrTemp[7]+"</span>");}
if(cm_name){top.$("#spanDetailCoMangPhy").attr('data-original-title',"<span class='text-nowrap'>"+arrTemp[8]+"</span>");}
top.$('#spanMoreRefPhy').removeClass("hidden");top.$("#spanMoreRefPhy").html(""+arrTemp[3]);top.$('#spanMorePCP').removeClass("hidden");top.$("#spanMorePCP").html(""+arrTemp[4]);top.$('#spanMoreCoMangPhy').css({"position":'absolute'}).removeClass("hidden");top.$("#spanMoreCoMangPhy").html(""+arrTemp[5]);}}
function chrt_showChartInfo(h){top.$("#li_rc").hide();top.$('#chart_phy_note').attr('title',"");top.$("#icoPtLock").addClass("hidden").unbind("click");top.$("#ddmenu_p3 li").removeClass("active");top.$("#chartdos, #infoIns").html("");top.$("#el_charttemp").val("").unbind("change");top.$("#btnPtForms").unbind("click");top.$("#chart_status").html("");window.top.$("#chartdos").unbind("change");window.top.$("#lichartp3dd ul a").unbind("click");if(typeof(h)!='undefined'&&h=="1"){top.$(".elchart").css("display","none");return;}
top.$("#chartdos").html($("#elem_dos").val());top.$("#el_charttemp").val($("#elem_ptTemplate").val());$("#el_visit").bind("change",function(){var x=$.trim($(this).val());if(x==""){$("#elem_ptVisit_chk,#elem_ptTesting,#elem_masterPtVisit,#elem_masterTesting").val('').triggerHandler("change");}
else{var v="",t="";if(x.indexOf("-")!=-1){var ar=x.split("-");ar[0]=$.trim(ar[0]);if(ar[0]&&ar[0]!=""){v=ar[0];}if(ar[1]&&ar[1]!=""){t=ar[1];}}else{if($("#el_visit_ig .mega-dropdown-menu li.col-sm-6").eq(1).find("a:contains('"+x+"')").length){t=x}else{v=x;}}
$("#elem_ptVisit_chk").val(""+v);$("#elem_masterPtVisit").val(""+v).triggerHandler("change");$("#elem_ptTesting").val(""+t);$("#elem_masterTesting").val(""+t).triggerHandler("change");}});top.$("#el_charttemp").bind("change",function(){var t=$(this).val();var o=top.fmain.$("#elem_ptTemplate");var pv=o.val();o.val(t).data("prv",pv).trigger("change");top.$(this).val("");});var tmp=$("#divMenuTemplate").html();top.$("#el_charttemp_ig ul, #lichart_status ul").replaceWith(tmp);top.$("#el_charttemp_ig ul a, #lichart_status ul a").bind("click",function(){var h=top.$(this).data("id");top.$("#el_charttemp").val(h).trigger("change");});if(hasActChart=="0"){top.$("#btn_new_chart").removeClass("hidden");}else{top.$("#btn_new_chart").addClass("hidden");}
if($("#divLockPassPrompt").length>0){top.$("#icoPtLock").removeClass("hidden").bind("click",function(){top.fmain.lock_showPassPrompt();});}
top.$("#btnPtForms").bind("click",function(){top.fmain.showChartNotesTree();});highlight_pt_form_btn();var s="Active";var clbl="label-info";if($("#elem_isFormFinalized").val()=="1"||$("#elem_masterpurge_status").val()=="1"){s=$("#elem_masterpurge_status").val()==1?"Purged":"Final";clbl="label-danger";}
top.$("#chart_status").html(s).show().removeClass("label-info label-danger").addClass(clbl);var t=$("#infoIns_hidden").html()||"";top.$("#infoIns").html(t);set_refer_phy_tbar();var sep=" - ";var p3=$("#phth_pros").val()||"";var p3_i=$("#is_od_os").val()||"";if(p3!=""){window.top.$("#lichartp3dd ul a:contains('"+p3+"')").parent().addClass("active");p3+=sep;}
if(p3_i!=""){window.top.$("#lichartp3dd ul a:contains('"+p3_i+"')").parent().addClass("active");}
window.top.$("#el_chartp3").val(p3+p3_i);window.top.$("#lichartp3dd ul a").bind("click",function(){var h=$(this).text()||"";if(h.indexOf("Eye")!=-1){return;}
$(this).parent().siblings().removeClass("active");$(this).parent().addClass("active");var tmp=window.top.$("#el_chartp3").val()||"";var ar_tmp=tmp.split(sep);ar_tmp[0]=$.trim(ar_tmp[0]);if(typeof(ar_tmp[1])!="undefined"){ar_tmp[1]=$.trim(ar_tmp[1]);}else{ar_tmp[1]="";}
if(ar_tmp[0]=="OU"||ar_tmp[0]=="OD"||ar_tmp[0]=="OS"){ar_tmp[0]="";}
if(h!=""){if(h=="OU"||h=="OD"||h=="OS"){ar_tmp[1]=h;}else if(h=="No Defect"){ar_tmp[0]="";ar_tmp[1]="";$(this).parent().parent().find("li").removeClass("active");}else{ar_tmp[0]=h;}}
var curset=(ar_tmp[0]!="")?"1":"0";window.top.fmain.$("#elem_curset_phth_pros").val(curset);window.top.fmain.$("#phth_pros").val(""+ar_tmp[0]);window.top.fmain.$("#is_od_os").val(""+ar_tmp[1]);window.top.fmain.loadExamsSummaryAll();if(ar_tmp[0]!=""&&ar_tmp[1]!=""){h=ar_tmp[0]+sep+ar_tmp[1];window.top.$("#el_chartp3").val(h);}else if(ar_tmp[0]!=""){h=ar_tmp[0]+"";window.top.$("#el_chartp3").val(h);}else{window.top.$("#el_chartp3").val("");}
return false;});$("#el_chartneuro_ig ul a").bind("click",function(){$("#el_chartneuro_ig ul li").removeClass("active");var h=$(this).text()||"";$(this).parent().addClass("active");$("#elem_neuroPsych").val(""+h);});var m=$("#elem_get_memo").val();var mo=window.top.$("#el_chartp3_ig");if(m==1){mo.hide();}else{mo.show();}
var t=(top.$("#ins_pro")[0])?top.$("#ins_pro")[0].title:"";if(typeof(t)=="undefined"){t="";}else if(t!=""){t=" ( "+t+" )";}
var t1=top.$("#vis_ins").html();if(typeof(t1)=="undefined"){t1="";}
var t2=$.trim(t1+" "+t+"");top.$("#infoIns").attr("title",t2);window.top.$("#chartdos").val($("#elem_dos").val()).datepicker({dateFormat:top.jQueryIntDateFormat}).bind("change",function(){window.top.fmain.$("#elem_dos").val(this.value).trigger("change");});if(phy_note_exists=='1'){window.top.$("#chart_phy_note").removeClass("hidden");}else{window.top.$("#chart_phy_note").addClass("hidden");}}
function highlight_pt_form_btn(){if(is_test_uninterpreted=='1'){top.$("#btnPtForms").addClass("highlight");}else{top.$("#btnPtForms").removeClass("highlight");}}
function open_medgrid(){$("#divMedGridMain").remove();var str="<div id=\"divMedGridMain\"  class=\"section\">"+"<div id=\"load_med_save\" style=\"position:absolute; display:none; background-color:red; color:white; margin:200px 400px; font-size:14px; height:50px;\" >Please wait saving is in process..</div>"+"<div id=\"divHeader\" class=\"section_header\" style=\"width:1200px;cursor:move;\"><span class=\"closeBtn\" onclick=\"$('#divMedGridMain').hide()\"></span>Ocular Medication Grid</div>"+"<iframe src=\"\" width=\"1200px\"  height=\"100%\" scrolling=\"yes\" border=\"0\" style=\"border:0px\" id=\"frmMedGrid\">"+"</iframe>"+"</div>";$("body").append(str);$("#load_med_save").hide();$("#divMedGridMain").css({"display":"none","position":"absolute","height":"400px","top":"20px","left":"20px","width":"1200px","z-index":"100","background-color":"white"}).show();$("#divMedGridMain").draggable({"handle":"#divHeader"});}
function showUnFinalize(u,n,w,h)
{var oPUF=(typeof(top.oPUF)!="undefined")?top.oPUF:top.fmain.oPUF;if(elem_per_vo=="1"){if(n=='Amendments'){return;}}
if(u!=""){if(n=="VF-GL"){n="VFGL";}
if(n=="OCT-RNFL"){n="OCTRNFL";}
if(!oPUF[n]||!(oPUF[n].open)||(oPUF[n].closed==true)){oPUF[n]=window.open(u,n,'location=0,status=1,resizable=1,left=1,top=1,scrollbars=1,width='+w+',height='+h);oPUF[n].focus();}else{oPUF[n].focus();}}}
function makeMemoChart(){makeNewChart('',1);}
function makeNewChart(val,memo)
{if(typeof(elem_per_vo)!="undefined"&&elem_per_vo=="1"){return;}
if(typeof(zPath)=="undefined")zPath="";var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;if(typeof val=="undefined"){val="GETFORMSETTINGS";}
if(typeof(memo)=="undefined"){memo="";}
top.show_loading_image('show','','Loading...');tmp=encodeURIComponent("Make New Chart Notes");top.fmain.window.location.replace(u+"/chart_notes/saveCharts.php?elem_saveForm="+tmp+"&elem_make=1&elem_tempId="+val+"&memo="+memo);}
function setPtTemplate(obj){if((obj.value!="")){var sep="-[_]-";var arr=obj.value.split(sep);if((arr[0]!="")&&(arr[1]!="")){if((typeof(hasActChart)!="undefined"&&hasActChart=="0")||obj.value=="Default"||obj.value=="Memo"||obj.value=="Amendment"){if(arr[0]=="Memo"&&arr[1]=="0"){makeMemoChart();}
else if(arr[0]=="Amendment"&&arr[1]=="0"){var t=$(obj).data("prv");obj.value=(typeof(t)!="undefined")?t:"";showUnFinalize(zPath+'/chart_notes/onload_wv.php?elem_action=Amendments','Amendments','800','400');}
else{makeNewChart(arr[1]);}
return;}
obj.value=""+arr[0];var oiFrm=top.fmain;var oF2=(oiFrm)?oiFrm.document.frmMain:null;if(oF2){var oMid=oF2.elem_masterId;var oMFz=oF2.elem_masterFinalize;var oMRvw=oF2.elem_isFormReviewable
var oPer=oF2.elem_per_vo;var oPrgd=oF2.elem_masterpurge_status;var msg="";if(oPer&&oPer.value=="1"){msg+="\nYou do not have permission to make changes.";}
if(oMFz&&oMFz.value=="1"){msg+="\nFinalized chart cannot be changed.";}
if(oPrgd&&oPrgd.value=="1"){msg+="\nPurged chart cannot be changed.";}
if(msg!=""){top.fAlert(""+msg);obj.value=obj.defaultValue;return;}
if(isFormChanged==1){oF2.elem_ptGo2.value="ChangeTemplate";oF2.elem_ptSrchFindBy.value=arr[1];oF2.submit();}else{tmp="Change Chart Notes Template";top.fmain.window.location.replace(zPath+"/chart_notes/saveCharts.php?elem_saveForm="+tmp+"&elem_templateId="+arr[1]+"&elem_tempFormId="+oMid.value);}}}}}
function hideButtons(f,id,r,e,cvu,prg)
{var ar=[];ar["elem_per_vo"]=elem_per_vo;ar["userTypeCn"]=user_type;ar["f"]=f;ar["r"]=r;ar["prg"]=prg;ar["e"]=e;ar["cvu"]=cvu;ar["fpv"]=flg_phy_view;ar["fz"]=show_finalize_btn;ar["prgdel"]=per_prgdel;top.btn_show("WV",ar);}
function showPrevCharts(val){if(val=="+1"){if(typeof varNxtFId.id!="undefined"){top.fmain.showFinalize(varNxtFId.typeChart,varNxtFId.id,varNxtFId.chartStatus,varNxtFId.releaseNum);}else{top.fAlert("No next chart exits.");}}else if(val=="-1"){if(typeof varPrevFId.id!="undefined"){top.fmain.showFinalize(varPrevFId.typeChart,varPrevFId.id,varPrevFId.chartStatus,varPrevFId.releaseNum);}else{top.fAlert("No previous chart exits.");}}}
function showPrevChartsImags(n,id){if(typeof(setProcessImg)!='undefined')setProcessImg(1,"");$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=ChartPrevImage&id="+id,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"");if(data){if(data=="No File Found."){top.fAlert(data);return;}top.$("#chart_img_modal").remove();top.$("body").append(data);top.$("#chart_img_modal .close").bind("click",function(){top.$("#chart_img_modal").remove();});}});}
function one_eye_valid(w){var ret=true;if(w=='drawingpane'||w=='Pupil'||w=='External'||w=='Ee'||w=='L&A'||w=='LA'||w=='IOP/Gonio'||w=='Gonio'||w=='IOP'||w=='SLE'||w=='Opt.Nev/Disc'||w=='Fundus Exam'||w=='Dilation'||w=='Fundus Exam Drawing'||w=='RV'||w=='Ref_Surg'||w=='Refractive Surgery'){var op=oneEye_isOpAllwd("OU");if(!op.alwd||((w=='drawingpane')&&op.iss!="")){flash_msg('Prosthesis/Phthisis is set. This operation is not allowed!','danger');ret=false;}}
return ret;}
function openPW(w,s,ainf)
{var clWidth=document.body.clientWidth;var clHeight=window.screen.availHeight;if(clHeight==null){clHeight=675;}
if(!one_eye_valid(w)){return;}
if(typeof s!="undefined"){s=s.toLowerCase();}
var u="",v="",ag="";switch(w){case"drawingpane":v="drawingpane.php";n="drawingpane";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=Drawingpane";if(typeof(s)!="undefined"&&s!=""){u+="&id="+s;}
break;case"AG":v="amsler_grid.php";n="amsler";w="825";h="340";u="?elem_action=AmslerGrid";ag="agModal";break;case"CVF":v="cvf.php";n="cvf";w="1000";h="340";u="?elem_action=CVF";ag="cvfModal";break;case"Pupil":v="pupil_2.php";n="pupil";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=PupilExam";break;case"EOM":v="eom_2.php";n="eom";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=EOM";if(s=="draw"){u+="&pg_tab=drw_tab&pg=draw";}
break;case"External":case"Ee":case"Ex":v="external_2.php";n="external";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=External";if(s=="draw"){u+="&pg_tab=drw_tab&pg=draw";}
break;case"L&A":case"LA":v="l_and_a_2.php";n="l_a";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=LA";if(s=="lids"){u+="&pg_tab=lid_tab&pg=Lid";}else if(s=="lesion"){u+="&pg_tab=lesion_tab&pg=Lesion";}else if(s=="lidpos"){u+="&pg_tab=lidposition_tab&pg=LidPosition";}else if(s=="lacsys"){u+="&pg_tab=lacrimal_tab&pg=Lacrimal_System";}else if(s=="drawla"||s=="draw"){u+="&pg_tab=drw_tab&pg=draw";}else{u+="&pg_tab=lid_tab&pg=Lid";}
break;case"IOP/Gonio":case"Gonio":case"IOP":v="iop_gon_2.php";n="iop";w=clWidth;h="695";u="?elem_action=IOP_Gonio";if(s=="iop"){u+="&pg_tab=IOP_tab&pg=IOP";}else if(s=="gonio"){u+="&pg_tab=Gonio_tab&pg=Gonio";}else if(s=="drawgonio"||s=="draw"){u+="&pg_tab=Drawing_tab&pg=Drawing";}
break;case"SLE":v="sle_2.php";n="sle";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=SLE";if(s=="conj"){u+="&pg_tab=Conj_tab&pg=Conj";}else if(s=="corn"){u+="&pg_tab=Cornea_tab&pg=Cornea";}else if(s=="ant"){u+="&pg_tab=AntChamber_tab&pg=AntChamber";}else if(s=="iris"){u+="&pg_tab=Iris_tab&pg=Iris";}else if(s=="lens"){u+="&pg_tab=lens_tab&pg=lens";}else if(s=="drawsle"||s=="draw"){u+="&pg_tab=drw_tab&pg=Drawing";}
break;case"Fundus Exam":case"RV":v="retina_vitreous_2.php";n="r_v";w=clWidth;h=parseInt(clHeight)-125;u="?elem_action=FundusExam";if(s=="vit"){u+="&pg_tab=Vitreous_tab&pg=Vitreous";}else if(s=="mac"){u+="&pg_tab=Macula_tab&pg=Macula";}else if(s=="drawrv"||s=="draw"||s=="drawrvma"||s=="drawrvon"){pg=(s=="drawrvma"||s=="drawrvon")?s:"Drawing";u+="&pg_tab=drw_tab&pg="+pg;}else if(s=="peri"){u+="&pg_tab=Periphery_tab&pg=Periphery";}else if(s=="bv"){u+="&pg_tab=bv_tab&pg=bv";}else if(s=="optic"){u+="&pg_tab=optic_tab&pg=Optic";}else if(s=="ret"){u+="&pg_tab=ret&pg=ret";}
break;case"Ref_Surg":case"Refractive Surgery":u="?elem_action=RefractiveSurgery";var ar=getMRinfo_SC();v="refractive_surgery.php";u+="&sod="+ar["sod"]+"&sos="+ar["sos"]+"&cod="+ar["cod"]+"&cos="+ar["cos"]+"&aod="+ar["aod"]+"&aos="+ar["aos"];n="ref_surg";w=clWidth;h=parseInt(clHeight)-125;break;case"VF-GL":u='../tests/test_vf_gl.php?pop=1';if(typeof(s)!="undefined"&&s!=""){u+="&tId="+s;}
showUnFinalize(u,'VF-GL',clWidth,clHeight);return;break;case"OCT - RNFL":u='../tests/test_oct_rnfl.php?pop=1';if(typeof(s)!="undefined"&&s!=""){u+="&tId="+s;}
showUnFinalize(u,'OCT-RNFL',clWidth,clHeight);return;break;default:return;break;}
if(u!=""){var t=top.fmain.oPUF;u=zPath+"/chart_notes/onload_wv.php"+u;if(typeof(ainf)!="undefined"&&ainf!=""){u+=(u.indexOf("?")==-1)?"?":"";u+="&"+ainf;}
if(ag!=""){if(typeof(setProcessImg)!='undefined')setProcessImg(1,"");$.get(u,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"");if($("#"+ag).length<=0){$("body").append(data);}
else{$("#"+ag).replaceWith(data);}
$(".modal-backdrop").remove();var xhgt=top.$(window).height();var xwdth=top.$(window).width();$("#"+ag).on('shown.bs.modal',function(){top.$(this).find('.modal-dialog').css({width:'auto',height:'auto','max-height':'100%'});xhgt=(parseInt(xhgt)-(parseInt(top.$(this).find('.modal-header').css("height"))+parseInt(top.$(this).find('.modal-footer').css("height"))+100));top.$(this).find('.modal-body').css({height:xhgt+"px","padding":"2px"});$("#app_ams_od, #app_ams_os, #app_cvf_od_drawing, #app_cvf_os_drawing ").each(function(){oSimpDrw[this.id]=new SimpleDrawing(this.id);oSimpDrw[this.id].init();});if($('#elem_examDate_amsler').length>0){$('#elem_examDate_amsler').datepicker({changeMonth:true,changeYear:true,dateFormat:z_js_dt_frmt});ag_setWnlEyeFlag("0");}
if($("#"+ag+" .bggrey").length>0){$(":input").bind("click",function(){$("#"+ag+" .bggrey").each(function(){$(this).removeClass("bggrey");});});}});$("#"+ag).css({'z-index':'1041'});$("#"+ag).modal("show");cn_ta_cvf_ag("#"+ag+" textarea");});return;}
if(!t[n]||!(t[n].open)||(t[n].closed==true)||t[n].document==null){t[n]=window.open(u,n,'location=0,status=1,resizable=1,left=1,top=1,scrollbars=1,width='+w+',height='+h);t[n].focus();}else{t[n].focus();}}}
function showFinalize(str,id,st,rel,opn,tstId){var clWidth=document.body.clientWidth;var clHeight=window.screen.availHeight;if(clHeight==null){clHeight=675;}
if(!one_eye_valid(str)){return;}
rel=(rel=="1")?"1":"0";opn=((rel=="0")||(opn=="1"))?"1":"0";tstId=(typeof tstId!="undefined")?tstId:"0";var path="";if(typeof(zPath_remote)!="undefined"){path=""+zPath_remote;}
else if(typeof(zPath)!="undefined"){path=""+zPath;}
var url="",w,h,n;var memoVal='';switch(str)
{case"Amsler Grid":return;break;case"A/Scan":case"Ascan":url="ascan.php?pop=1";n="docAS";str="Ascan";break;case"IOL Master":case"IOL_Master":url="iol_master.php?pop=1";n="docIOL_Master";str="IOL_Master";break;case"CVF":return;break;case"EOM":url="onload_wv.php?elem_action=EOM";w=clWidth;h="675",n="docEOM";break;case"External":url="onload_wv.php?elem_action=External";w=clWidth;h=clHeight,n="docEx";break;case"Dilation":case"Gonio":case"IOP/Gonio":url="onload_wv.php?elem_action=IOP_Gonio";w=clWidth;h="695",n="docIOP";if(str=="Gonio"){url+="&pg_tab=Gonio_tab&pg=Gonio";}
break;case"L&A":url="onload_wv.php?elem_action=LA";w=clWidth;h=clHeight,n="docLA";break;case"Pupil":url="onload_wv.php?elem_action=PupilExam";w=clWidth;h=clHeight,n="docPupil";break;case"Opt.Nev/Disc":case"Fundus Exam":case"Fundus Exam Drawing":url="onload_wv.php?elem_action=FundusExam";w=clWidth;h=parseInt(clHeight)-125,n="docRV";if(str=="Fundus Exam Drawing"){url+="&pg_tab=drw_tab&pg=Drawing";}
break;case"SLE":url="onload_wv.php?elem_action=SLE";w=clWidth;h=parseInt(clHeight)-125,n="docSLE";break;case"Fundus":case"Disc":url="test_disc.php?pop=1";n="docDisc";break;case"Topography":url="test_topography.php?pop=1";n="docTopo";break;case"External/Anterior":url="test_external.php?pop=1";n="docExAnt";str="External_Anterior";break;case"IVFA":url="test_ivfa.php?pop=1";n="docIvfa";break;case"ICG":url="test_icg.php?pop=1";n="docIcg";break;case"HRT":case"NFA":url="test_nfa.php?pop=1";n="docNfa";break;case"Pachy":url="test_pacchy.php?pop=1";n="docPachy";break;case"VF":url="test_vf.php?pop=1";n="docVF";break;case"VF-GL":url="test_vf_gl.php?pop=1";n="docVFGL";str=n="VFGL";break;case"OCT":url="test_oct.php?pop=1";n="docOCT";break;case"OCT-RNFL":url="test_oct_rnfl.php?pop=1";n="docOCTRNFL";str=n="OCTRNFL";break;case"GDX":url="test_gdx.php?pop=1";n="docGDX";break;case"Amendment":url="onload_wv.php?elem_action=Amendments";w="800";h="400",n="docAmendment";break;case"Other":url="test_other.php?pop=1";n="docOthr";break;case"TemplateTests":url="test_template.php?pop=1";n="docOthr";break;case"CustomTests":case"Customtests":case"customtests":url="test_template_custom_patient.php?pop=1";n="docOthr";break;case"Labs":url="test_labs.php?pop=1";n="docLabs";break;case"B-Scan":url="test_bscan.php?pop=1";n="docbscan";str=n="BScan";break;case"Cell Count":url="test_cellcount.php?pop=1";n="doccellcnt";str=n="CellCount";break;case"Assessment & Plan":case"Vision":case"Memo Chart Note":var memoVal='true';case"Chart Note":url="";if(id!=""){if(rel!=0){var z;for(z in oPF){if((oPF[z])&&(oPF[z].closed==false))oPF[z].close();}
for(z in oPUF){if((oPUF[z])&&(oPUF[z].closed==false))oPUF[z].close();}}
var strQS="";if(st=="Final"){strQS+="&elem_saveForm=Show Prev Chart Notes";strQS+="&hd_finalize_id="+id;strQS+="&elem_openForm="+opn;if(rel!=1){var url;url=path+"/common/print_function.php?print_form_id="+id;window.open(url,'imedic_print','location=0,status=1,resizable=1,left=1,top=1,scrollbars=1,width=700,height=680');return;}}else{strQS+="&elem_saveForm=Make New Chart Notes";}
if(rel!=0){strQS+="&memo="+memoVal;var frmObj;if(top.fmain){frmObj=top.fmain;}
else{if(window.opener&&window.opener.top.fmain){frmObj=window.opener.top.fmain;}}
if(frmObj&&typeof(frmObj)!="undefined"){if(typeof(zPath)=="undefined"){if(typeof(frmObj.JS_SCHEDULER_VERSION)!=""){zPath=window.opener.top.JS_WEB_ROOT_PATH+"/interface";}
if(window.opener&&window.opener.top.$('#appt_scheduler_status').length>0){window.opener.top.$('#appt_scheduler_status').val('unloaded');}}
frmObj.window.location.replace(zPath+"/chart_notes/saveCharts.php?a=1"+strQS);}
return;}}else{}
break;}
if(url!=""){if(tstId!=0){url="/tests/"+url;if(url.indexOf("?")==-1)url+="?";url+="&tId="+tstId;n+="_"+str+"_"+tstId;w=clWidth;h=parseInt(clHeight)-70;}else{url="/chart_notes/"+url;if(url.indexOf("?")==-1)url+="?";url+=(st=="Final")?"&finalize_id="+id:"";n+=(typeof id!="undefined")?"_"+id:"";}
var z;for(z in oPF){if((oPF[z])&&(oPF[z].closed==false))oPF[z].close();}
if(((typeof(oPF)=="undefined"))||(!oPF[n])||(!(oPF[n].open))||(oPF[n].closed==true)){oPF[n]=window.open(path+url,n,'location=0,status=1,resizable=1,left=1,top=1,scrollbars=1,width='+w+',height='+h);oPF[n].focus();}else{oPF[n].focus();}}}
function saveMainPage(flgSkip,btn_final_pressed){if(elem_per_vo=="1"){return;}
if(typeof flgSkip=="undefined"||flgSkip==""){flgSkip="0";}
var ophpr=$("#phth_pros");var oisOdOs=$("#is_od_os");if(ophpr.val()!=""&&oisOdOs.val()==""){top.fAlert(ophpr.val()+" is selected, please select an Eye to save the Information.");return false;}
if(gebi("closeWorkView").value!='true'){var flag=chckMainSaveReqFlds();if(flag==false){return false;}}else{flgSkip="1";}
var flg=true;if(user_type=="3"&&flgSkip=="0"){var flg=mandotry_chk('2');}
if(flg==true){if(zSaveWithoutPopupSave=="0"){var all_warn="";if(str_warn_finalize!=""){all_warn+=str_warn_finalize;}
var n=$("#elem_neuroPsych").val();var m=$("#elem_get_memo").val();if($.trim(n)==""&&m!="1"){all_warn+="Warning! Neuro/Psych is not completed.<br/>";}
if($.trim(all_warn)!=""){if(typeof(zStopSaveWarning)=="undefined"||zStopSaveWarning==""){top.fAlert(all_warn);}}}
$("#otherSaveVal").val($("#otherSave").val());saveMainPageExe(btn_final_pressed);}}
function chckMainSaveReqFlds(){var memoPage=gebi('elem_get_memo').value;var oCCPro=gebi('elem_pro_id');if(oCCPro){var getCCvalue=gebi('elem_pro_id').value;getCCvalue=((typeof getCCvalue!="undefined")&&(getCCvalue!=""))?getCCvalue:0;}else{getCCvalue=0;}
var flag=flag2=0;var Mr1Val=Mr2Val=0;var isMr1Done=isMr2Done=changeMr1Done=changeMr2Done=false;var getMROperator=getMR2Operator=0;var isObjNote=(gebi("elem_objNotes"))?1:0;if(isObjNote==0){var oProId=gebi('elem_providerId');if(oProId){var getMROperator=oProId.value;var ar=new Array("elem_visMrOdS","elem_visMrOdC","elem_visMrOdA","elem_visMrOdAdd","elem_visMrOsS","elem_visMrOsC","elem_visMrOsA","elem_visMrOsAdd");var isMr1Done=false;isMr1Done=isCurMRDone(ar);}
var oProId_2=gebi('elem_providerIdOther');if(oProId_2){var getMR2Operator=oProId_2.value;var ar2=new Array("elem_visMrOtherOdS","elem_visMrOtherOdC","elem_visMrOtherOdA","elem_visMrOtherOdAdd","elem_visMrOtherOsS","elem_visMrOtherOsC","elem_visMrOtherOsA","elem_visMrOtherOsAdd");var isMr2Done=false;isMr2Done=isCurMRDone(ar2);}}
var msg="<b>Please address the following:-</b><div class='m10'>";var fFalse=0;if(memoPage==''){var cchisCount=gebi("elem_ccHx").value;var ccHisLength=cchisCount.length;if(getCCvalue==0&&ccHisLength>0&&memoPage==''){msg+='<li>Operator not authorized for CC & History.</li>';fFalse+=1;}}
if(((getMROperator==0)&&(isMr1Done==true))||((getMR2Operator==0)&&(isMr2Done==true))){msg+='<li>Provider for MR</li>';fFalse+=1;}
var oSB=isSuperBillMade();var sb_dxids="";if(oSB.SBill==true){if((oSB.DXCodeOK==false)||(oSB.DXCodeAssocOK==false)){msg+='<li>Dx code in Super bill for CPT Codes:- '+oSB.CptNotAssoc+'</li>';fFalse+=1;}
if(oSB.DXCodeComplete==false){msg+='<li>Incomplete ICD-10 DX code(s) in Super bill</li>';fFalse+=1;}
if(oSB.mul_ophth_cd==true){msg+='<li>Multiple Ophthalmoscopy Code exists in this superbill!</li>';fFalse+=1;}
sb_dxids=oSB.dxids;}
$("#sb_dxids").val(sb_dxids);if(fFalse>0){if(msg!='')msg+='</div>';top.fAlert(""+msg);return false;}
return true;}
function isCurMRDone(te){return isVisElemDone(te);}
function isVisElemDone(te,isObjArr){isObjArr=(typeof isObjArr!="undefined")?isObjArr:0;if(typeof te!="undefined"){tl=te.length;for(var j=0;j<tl;j++){le=(isObjArr==1)?te[j]:gebi(te[j]);if(le){if((le.type=="text")||(le.type=="select-one")||(le.type=="textarea")){if((le.value!="")&&(le.value!="20\\")){if($(le).hasClass("active")){return true;}}}}}}
return false;}
var psm_actAfSave="";function postSaveMainPageFunctions(data){isFormChanged=0;if(typeof(data.chartFinalized)!="undefined"&&data.chartFinalized==1){top.fAlert("This Chart is Finalized. \nso this chart will be reloaded with new permissions.","Close chart","top.clean_patient_session(undefined,undefined, 1);");return;}
if(typeof(data.as_msg)!="undefined"&&data.as_msg!=''){top.fAlert("<br />"+data.as_msg);}
if(typeof(data.closePtChart)!="undefined"&&data.closePtChart==1){top.clean_patient_session(undefined,undefined,1);return;}
finalize_flag=data.finalize_flag;isReviewable=data.isReviewable;$("#elem_masterFinalize").val(data.finalize_flag);$("#elem_masterRecordValidity").val(1);$("#elem_isFormFinalized").val(data.finalize_flag);$("#elem_isFormReviewable").val(data.isReviewable);$("#elem_masterIsSuperBilled").val(data.elem_masterIsSuperBilled);$("#elem_masterFinalizerId").val(data.elem_masterFinalizerId);$("#elem_masterpurge_status").val(data.purge_status);$("#elem_masterFinalDate").val(data.elem_masterFinalDate);$("#elem_masterProvIds").val(data.elem_masterProvIds);$("#elem_activeFormId").val(data.elem_activeFormId);$("#clws_id").val(data.clws_id);$("#trial_no_old").val(data.cl_trialno);$("#clws_type_old").val(data.clws_type);$("#cl_label").text(data.clws_type_label);$("#clws_type").css('width','100px');$("#clws_type").text(data.clws_type_dd);if(data.elem_procIds){var b=data.elem_procIds;for(var a in b){$("#elem_procedureId_"+a).val(b[a]);}}
if(data.finalize_flag==1){hasActChart=data.elem_activeFormId;if(data.isReviewable==1){setReviewableFunction('frmMain');}else{setfinalizedFunction('frmMain');}
chrt_showChartInfo();if(hasActChart==0){top.$("#el_charttemp_ig ul .def_opts, #lichart_status ul .def_opts").removeClass("hidden");}}
if(sc_userPress_newchart_save==1){sc_userPress_newchart_save=0;sc_userPress(1);}
top.fmain.hideButtons(''+data.finalize_flag,''+data.form_id,''+data.isReviewable,''+data.isEditable,''+data.iscur_user_vphy,''+data.purge_status);$("#sliderRight").attr("attrFilled",0);$("#sliderLeft").attr("attrFilled",0);loadAsPlanTBar();upAsPlanProbid(data.apid);if(psm_actAfSave.indexOf("Print_MR")!=-1){var w=psm_actAfSave.replace(/Print_MR/,"");psm_actAfSave="";zSaveWithoutPopupSave=0;printMr("show",w);}
if(send_to_ibra==1){cnct_ibra(1);}
send_to_ibra=0;str_warn_finalize="";}
function get_asmt_dx_code_id(){var elem_asmt_dxcode_id="";$("#assessplan textarea[id*=elem_assessment_dxcode]").each(function(){var t=$(this).data("dxid");if(typeof(t)=="undefined"||t==""){t="";}elem_asmt_dxcode_id+=""+t+"@@";});$("#elem_asmt_dxcode_id").val(elem_asmt_dxcode_id);}
var submitStart=false;var zSaveWithoutPopupSave=0;function saveMainPageExe(el_btfinalize_pressed){if(elem_per_vo=="1"||submitStart==true){return;}
if(zSaveWithoutPopupSave==0){top.fmain.funClosePopUpExe(1);}
if((user_type!=1)&&(user_type!=3)){disable13Elems(0);}
emptyArcRedStrikeB4Save();var svtxt="";if(typeof(el_btfinalize_pressed)!="undefined"&&el_btfinalize_pressed=="1"){svtxt="Finalize in Progress. Please wait!";}
top.fmain.setSavedBtn("1",svtxt);var objMainFrm=document.frmMain;submitStart=true;get_asmt_dx_code_id();var strsave=$("#frmMain").serialize();strsave+="&savedby=ajax";if(typeof(el_btfinalize_pressed)!="undefined"&&el_btfinalize_pressed=="1"){strsave+="&el_btfinalize_pressed=1";}
$.post("saveCharts.php",strsave,function(data){if(typeof(top.get_pt_edu_alert)!="undefined"){top.get_pt_edu_alert();}
submitStart=false;zSaveWithoutPopupSave=0;postSaveMainPageFunctions(data);top.fmain.setSavedBtn("0");$.ajax({url:"cl_block.php",success:function(resp){if(resp){if($('#ContactLens').length){var clParent=$('#ContactLens').parent();$('#ContactLens').remove();clParent.append(resp);}
applyTypeAhead();utElem_setBgColor();var arrElems=[];var elem=elemString='';var curVals=document.getElementById('elem_utElems_cur').value;arrElems=curVals.split(',');for(x in arrElems){elem=arrElems[x];if(elem!=""){utElem_capture(document.getElementById(elem));}}}}});},'json').fail(function(data){if(data.responseText.indexOf("Current session experiencing a change")!=-1){top.fancyConfirm(""+data.responseText,"Session error","window.top.fmain.wv_reload(1)","window.top.fmain.wv_reload(0)",'','','Refresh','Close Application');}
else{top.fmain.setSavedBtn("0");var ermsg="Error Occurred, Please close this window and try later!  \ncode:"+data.status+", \nstatusText:"+data.statusText+", \n"+data.responseText;if(typeof(isDssEnable)!='undefined'&&isDssEnable){ermsg=ermsg.replace(/(?:\n)/g,"<br />");top.fAlert(ermsg);}else{alert(ermsg);}
$.post(zPath+'/chart_notes/requestHandler.php',{'elem_formAction':'LogError','req_ptwo':'1','msg':''+ermsg},function(){});console.log(data);}});}
function wv_reload(flg){if(flg==0){top.window.close();}else if(flg==1){top.window.location.reload();}}
function funClose(flg)
{if(typeof(flg)=="undefined"||flg!=1){funClosePopUpExe();}
tmp=encodeURIComponent("Close this patient work view");var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;top.fmain.window.location.replace(u+"/chart_notes/saveCharts.php?elem_saveForm="+tmp);}
var str_warn_finalize="";function FinalizeMainPage(flgPrmpt,confrmed){if(elem_per_vo=="1"){return;}
var objMainFrm=document.frmMain;var chartsign_1=chartsign_2=true;if((flgPrmpt=="1")){}else{if(typeof(confrmed)=='undefined'&&1==2){top.fancyConfirm('Finalize: Are you sure?','Finalize Chart',"top.fmain.FinalizeMainPage("+flgPrmpt+",true)","flgPrmpt=false;");flgPrmpt=false;}else{flgPrmpt=true;}
if(flgPrmpt){var str_num="";var tmp=$("div.divsign :input[name*=elem_physicianId][value='"+objMainFrm.elem_chartOprtrId.value+"']").parents(".divsign");if(tmp.find(":input[name*=elem_signCoords][value!=''][value!='0-0-0:;']").length<=0&&tmp.find(":input[name*=elem_sign_path][value!='']").length<=0){if(tmp.find("label.clickable[id*=lbl_phy_sig]").length>0){var cid=""+tmp.attr("id");var num=""+cid.replace("sign_phy","");if(typeof(num)!="undefined"&&num!=""){str_num+=num+",";}}}
var tmp_arScribe="";$("div.divsign :input[name*=elem_physicianIdName][value*='(Scribe)']").each(function(data){var tmp=$(this).parents(".divsign");if(tmp.find(":input[name*=elem_signCoords][value!=''][value!='0-0-0:;']").length<=0&&tmp.find(":input[name*=elem_sign_path][value!='']").length<=0){var num=tmp.attr("id").replace("sign_phy","");if(typeof(num)!="undefined"&&num!=""){str_num+=num+",";}}});if(str_num!=""){getPhySign_db(str_num,1);return;}}}
if(flgPrmpt){var flag=chckMainSaveReqFlds();if(flag==false){return false;}
var err=false;var msg="<b>Please Fill the following:</b><div class='m10'>";var tmp=$("div.divsign :input[name*=elem_physicianId][value='"+objMainFrm.elem_chartOprtrId.value+"']");if(tmp.length>0){var t=tmp.parents(".divsign").find(":input[name*=elem_signCoords][value!='0-0-0:;']");var t2=tmp.parents(".divsign").find(":input[name*=elem_sign_path][value!='']");if((t.length<=0||t.val().length<=0)&&t2.length<=0){err=true;msg+="<li>Signature</li>";}}else{err=true;msg+="<li>Physician Name</li>";}
if(err==false){var ispov=$("#elem_proc_only_visit").val();var m=$("#elem_get_memo").val();str_warn_finalize="";var t=isVisitCodeExits();if(typeof(sb_warnVisCd)=="undefined"){sb_warnVisCd="";}
if(sb_warnVisCd=="1"&&t==0&&ispov!="1"){str_warn_finalize+="Warning! Super Bill does not include any visit code.<br/>";}
else if(t==-1&&m!="1"){str_warn_finalize+="Warning! No superbill created for this visit.<br/>";}
if($("#btn_attest_scribe").length>0){var t=$("#btn_attest_scribe").data("attested");if(typeof(t)=="undefined"||t==""){str_warn_finalize+="Warning! Scribe Attestation not complete.<br/>";}}
if($("#btn_attest_attend_scribe").length>0){var t=$("#btn_attest_attend_scribe").data("attested");if(typeof(t)=="undefined"||t==""){str_warn_finalize+="Warning! Attending scribe attestation not complete.<br/>";}}
if($("#btn_attest_teach").length>0){var t=$("#btn_attest_teach").data("attested");if(typeof(t)=="undefined"||t==""){str_warn_finalize+="Warning! Teaching attestation not complete.<br/>";}}
objMainFrm.elem_masterFinalize.value="1";objMainFrm.elem_masterFinalizerId.value=objMainFrm.elem_chartOprtrId.value;if(isDssEnable==1){var tiuTitle=top.fmain.document.getElementById('dssTiuTitle').value;if(typeof(tiuTitle)!='undefined'&&tiuTitle!=''){top.dssValidateElectronicSignature('show','','','saveChartNote');}else{top.fAlert('Please select TIU Title from the DSS TIU Title Dropdown.','DSS Required Field');return false;}}else{saveMainPage(0,1);}}else{if(msg!='')msg+='</div>';top.fAlert(msg);}}}
function chartNoteUnfinalize(){var title="Unfinalize Chart";var msg="Are you sure you want to unfinalize chart note?<BR>"+"You will need to re-finalize it.";var func="top.fmain.decideChartNoteUnfinalize(1)";top.fancyConfirm(msg,title,func);return;}
function chartNoteEdit(){var title="Edit Chart";var msg="Are you sure you want to edit chart notes?<br>"+"You will need to re-finalize it.";var func="top.fmain.decideChartNoteEdit(1)";top.fancyConfirm(msg,title,func);return;}
function decideChartNoteEdit(val,flg_fnlz){if(val==1){var oFid=top.fmain.document.getElementById("elem_masterId");if(oFid&&(oFid.value!="")){var memo=$("#elem_get_memo").val();var tmp="ChartNoteEdit";if(typeof(flg_fnlz)!="undefined"&&flg_fnlz=="1"){tmp="ChartNoteUnfinalize";}
top.fmain.window.location.replace(zPath+"/chart_notes/saveCharts.php?elem_saveForm="+tmp+"&hd_finalize_id="+oFid.value+"&elem_openForm=0&memo="+memo);}}}
function decideChartNoteUnfinalize(val){decideChartNoteEdit(val,1);}
function getconfirmationPurgeRequest(){if(elem_per_vo=="1"&&per_prgdel!="1"){top.fAlert('You don\'t have permissions.');return;}
var vBtnPrge=top.$("#buttonPurge").val();if(vBtnPrge=="Undo Purge"){var title="Undo Purge Chart Note";var msg="Do you want to undo purge this chart note?";}else{var title="Purge Chart Note";var msg="Do you want to purge this chart note?";}
var func="top.fmain.confirmPurgeRequest(1);";top.fancyConfirm(msg,title,func);}
function confirmPurgeRequest(strVal){if(strVal==1){var vBtnPrge=top.$("#buttonPurge").val();if(vBtnPrge=="Undo Purge"){var status="0",msg="Un-Purging ";}else{var status="1",msg="Purging ";}
top.fmain.setSavedBtn("1",msg+"Chart Note. Please wait! ");$.post("saveCharts.php",{"elem_saveForm":"PurgeCN","elem_status":status},function(data){top.fmain.setSavedBtn("0");if(top.$("#lblFinalized").get(0)){var htmlStr=(data.purge_status==1)?'<b>Purged</b>':'<b>Finalized</b>';top.$("#lblFinalized").html(htmlStr);}
if(data.purge_status==1){$("body").append("<div id=\"dvPrgdSgn\" title=\"Purged chart note\">X</div>");}else{$("#dvPrgdSgn").remove();}
postSaveMainPageFunctions(data);},'json');}}
function deleteChart(flg){if(elem_per_vo=="1"&&per_prgdel!="1"){top.fAlert('You don\'t have permissions.');return;}
if(typeof(flg)!="undefined"&&flg==1){top.fmain.setSavedBtn("1","Deleting Chart Note. Please wait! ");$.post("saveCharts.php",{"elem_saveForm":"DeleteCN"},function(data){if(typeof varNxtFId.id!="undefined"){top.fmain.showFinalize(varNxtFId.typeChart,varNxtFId.id,varNxtFId.chartStatus,varNxtFId.releaseNum);}
else if(typeof varPrevFId.id!="undefined"){top.fmain.showFinalize(varPrevFId.typeChart,varPrevFId.id,varPrevFId.chartStatus,varPrevFId.releaseNum);}
else{wv_reload(1);}},'json');}else{var msg="Do you want to remove this chart note? This operation cannot be reversed.";var func="top.fmain.deleteChart(1);";var title="Delete Chart Note";top.fancyConfirm(msg,title,func);}}
function chkWVB4Close(){if(typeof(elem_per_vo)=="undefined"||(typeof(elem_per_vo)!="undefined"&&elem_per_vo=="1")){if(typeof(funClosePopUpExe)=="function")funClosePopUpExe(0);return false;}
if(typeof(isTestFormsOpen)=="undefined"||(typeof(isTestFormsOpen)!="undefined"&&isTestFormsOpen())){return true;}
funClosePopUpExe(1);if(top.fmain&&top.fmain.isFormChanged&&typeof(top.fmain.isFormChanged)!="undefined"&&top.fmain.isFormChanged==1&&top.fmain.$("#elem_closePtChart").length>0&&top.$("#save").length>0){top.fmain.$("#elem_closePtChart").val(1);top.fmain.zSaveWithoutPopupSave=1;top.$("#save").trigger("click");return true;}else{return false;}}
function chkWVB4Move(ptGo2,ptSrch,ptSrchFB,callFrom){if(typeof(elem_per_vo)=="undefined"||(typeof(elem_per_vo)!="undefined"&&elem_per_vo=="1")){if(typeof(funClosePopUpExe)=="function")funClosePopUpExe(0);return false;}
if(typeof(isTestFormsOpen)=="undefined"||(typeof(isTestFormsOpen)!="undefined"&&isTestFormsOpen())){return true;}
if(callFrom!='CL'){if(typeof(funClosePopUpExe)!="undefined"){funClosePopUpExe(1);}}
var flgDel_EId=1;var CLSavedCheck='';if(callFrom=='CL'){CLSavedCheck=1;}
var o1=(top.fmain&&top.fmain.document.frmMain)?top.fmain.document.frmMain:null;if(o1){var flag=(isFormChanged==1)?true:false;if(callFrom=='CL'){flag=true;}
if(flag==false){return false;}
var fnl=o1.elem_isFormFinalized;var rel=o1.elem_isFormReviewable;var purge=o1.elem_masterpurge_status;if(purge.value>0){return false;}
if((fnl.value=="0")||(rel.value=="1")){top.fmain.get_asmt_dx_code_id();top.fmain.setSavedBtn("1");if(top.fmain.disable13Elems){top.fmain.disable13Elems(0);}
o1.elem_ptGo2.value=ptGo2;o1.elem_ptSrchPatient.value=ptSrch;o1.elem_ptSrchFindBy.value=ptSrchFB;o1.elem_clPopUpSaved.value=CLSavedCheck;o1.submit();o1.elem_clPopUpSaved.value='';flgDel_EId=0;return true;}}
if(flgDel_EId==1){$.get(zPath+'/chart_notes/requestHandler.php?elem_formAction=EmptyEncounterID',function(){});}
return false;}
function getPhyViewWV(val){var res=chkWVB4Move("ShowPhyView");if(res==true){}else{var tmp=encodeURIComponent(val);top.fmain.window.location.replace(zPath+"/chart_notes/requestHandler.php?elem_formAction=ShowPhyView&op="+tmp);}}
function funClosePopUpExe(sv){if(typeof(elem_per_vo)!="undefined"&&elem_per_vo=="1"){sv='0';}
try{var arr=[top.fmain.oPP,top.fmain.oPO,top.fmain.oPF,top.fmain.oPUF,top.fmain.arrSchPop,top.tb_oPU,top.arr_opened_popups];for(var zx in arr){var tmpoP=arr[zx];if(tmpoP){for(var z in tmpoP){if(tmpoP[z]&&tmpoP[z].closed==false&&z!="day_charges_list"){var savebtn=tmpoP[z].document.getElementById("save");if(!savebtn&&tmpoP[z].jQuery){savebtn=tmpoP[z].$("button:contains('Done')").filter(function(){return $(this).text()==='Done';});}
var oSaveClose=tmpoP[z].document.getElementById("elem_saveClose");if(oSaveClose){oSaveClose.value="1";}
if(savebtn&&savebtn.length>0&&(sv=="1")&&(tmpoP[z].name!="winChangePassword")&&(tmpoP[z].name!="alerts")&&(tmpoP[z].name!="contact_lens_worksheet_popup")){savebtn.click();}else{tmpoP[z].close();}}}}}}catch(ignored){console.log("ERROR: "+ignored.name+" - "+ignored.description);}}
function funReset()
{if(elem_per_vo=="1"){return;}
var o=top.fmain.document.frmMain.elements;var l=o.length;for(var i=0;i<l;i++)
{if((o[i].type=="text")||(o[i].type=="textarea")){o[i].value="";}else if(o[i].type=="checkbox"){if(o[i].checked==true){o[i].checked=false;}}}}
function setSmartApEye(name1,iter,elem){var name=name1+iter+"[]";key=0;$("input[name='"+name+"']").each(function(index,element){if($(element).attr("id")!=$(elem).attr("id"))
$(element).prop("checked",false);id=name1+iter+key;$("label[for="+id+"]").css({"border-color":"transparent"});key++;});$("input[name='elem_ap_assess[]'][value='"+iter+"']").prop("checked",true);}
function setSmartAssessEye(name1,iter,elem){if($(elem).is(":checked")==false){name=name1+iter+"[]";key=0;$("input[name='"+name+"']").each(function(index,element){$(element).prop("checked",false);id=name1+iter+key;$("label[for="+id+"]").css({"border-color":"transparent"});key++;});}}
function disable13Elems(v){if((user_type!=1)&&(user_type!=3))return;var strElm="#divMR :input[type!=hidden][type!=button][type!=submit], "+"#div_rvs :input[type!=hidden][type!=button][type!=submit], "+"#div_rvs :input[type!=hidden][type!=button][type!=submit], "+"#elem_chk, "+"#elem_mrPrism1,#elem_mrNoneGiven1,#elem_mrGLPH1, "+"#elem_mrPrism2,#elem_mrList2,#elem_mrGLPH2,#elem_mrCL2, "+"#elem_mrBat2";$(strElm).each(function(){if(v){$(this).attr("disabled","disabled").bind("click change",setElem2Default);}else{$(this).removeAttr("disabled");}});strElm="#imgClearMr1,#imgCopyMr1_Pc,#imgCopyMr1_Ar,#imgClearMr2,#imgClearMr3";$(strElm).unbind("click");}
function setElem2Default(){if((user_type!=1)&&(user_type!=3))return;if((this.type=="checkbox")||(this.type=="radio")){this.checked=this.defaultChecked;}else{this.value=this.defaultValue;}
return false;}
var to_showdivArc="";var oDivNames=new Array();function hideAlldivArc(mn){for(var i in oDivNames){var od=gebi("divArcCmn"+i);if(od){od.style.display="none";}
oDivNames[i]=0;}}
function postionDivArc(id,mn){var idO=id;if(id=="FundusExam"){id="RV";}
var str="";if($(":input[name='"+id+"']").length>0){str=":input[name='"+id+"']";}else if($("#lblHx"+id+"").length>0){str="#lblHx"+id+"";}
if(str!=""){var opos=$(str).offset();var hgt=$(str).parents(".esum").height();var sTop=$("#divWorkView").scrollTop();var hgtD=$("#divArcCmn"+idO).height();var top=parseInt(opos.top)+parseInt(sTop)-parseInt(hgtD)-30;if(top<sTop){top=sTop;if(sTop>(opos.top+hgtD)){top+=opos.top+hgt-30;}else{}}
$("#divArcCmn"+idO).css({"display":"block","left":opos.left+"px"});}}
function showdivArc(divId,flg,mn){var oDiv=gebi("divArcCmn"+divId);if(oDiv){if(flg=="1"){oDivNames[divId]=1;hideAlldivArc(mn);postionDivArc(divId,mn);if(to_showdivArc){to_showdivArc=clearTimeout(to_showdivArc);}}else{to_showdivArc=setTimeout(function(){if(to_showdivArc){oDiv.style.display="none";}},500);}}}
function remRedStyleArc(obj){obj.className=obj.className.replace(/red_strike/g,"");if(obj.select)obj.select();}
function emptyArcRedStrikeB4Save(){$(".arcvDeleted").val("");var arr=new Array("commentsForPatient");var len=arr.length;for(var i=0;i<len;i++){var to=gebi(arr[i]);if(to&&(to.className.indexOf("bgSmoke")!=-1)){to.value="";}}}
function isTestFormsOpen(){var arrOpenPU=new Array();var arrObj=new Array(top.fmain.oPF,top.fmain.oPUF,top.fmain.oPO,top.tb_oPU);try{for(var i in arrObj){for(var j in arrObj[i]){if(arrObj[i][j]&&arrObj[i][j].open&&arrObj[i][j].closed!=true){if(j.indexOf("docAG")!=-1||j.indexOf("amsler")!=-1){arrOpenPU[arrOpenPU.length]="Amsler Grid";}else if(j.indexOf("docDisc")!=-1||j.indexOf("Disc")!=-1){arrOpenPU[arrOpenPU.length]="Fundus";}else if(j.indexOf("docTopo")!=-1||j.indexOf("Topography")!=-1){arrOpenPU[arrOpenPU.length]="Topography";}else if(j.indexOf("docExAnt")!=-1||j.indexOf("External")!=-1){arrOpenPU[arrOpenPU.length]="External/Anterior";}else if(j.indexOf("docIvfa")!=-1||j.indexOf("IVFA")!=-1){arrOpenPU[arrOpenPU.length]="IVFA";}else if(j.indexOf("docNfa")!=-1||j.indexOf("HRT")!=-1){arrOpenPU[arrOpenPU.length]="HRT";}else if(j.indexOf("docOptha")!=-1||j.indexOf("Optha")!=-1){arrOpenPU[arrOpenPU.length]="Ophtha";}else if(j.indexOf("docPachy")!=-1||j.indexOf("Pachy")!=-1){arrOpenPU[arrOpenPU.length]="Pachy";}else if(j.indexOf("docVF")!=-1||j.indexOf("VF")!=-1){arrOpenPU[arrOpenPU.length]="VF";}else if(j.indexOf("docOCT")!=-1||j.indexOf("OCT")!=-1){arrOpenPU[arrOpenPU.length]="OCT";}else if(j.indexOf("docIcg")!=-1||j.indexOf("ICG")!=-1){arrOpenPU[arrOpenPU.length]="ICG";}else if(j.indexOf("doccellcnt")!=-1||j.indexOf("CellCount")!=-1){arrOpenPU[arrOpenPU.length]="Cell Count";}else if(j.indexOf("docAscan")!=-1||j.indexOf("Ascan")!=-1){arrOpenPU[arrOpenPU.length]="A/Scan";}else if(j.indexOf("docIOL_Master")!=-1||j.indexOf("IOL_Master")!=-1){arrOpenPU[arrOpenPU.length]="IOL Master";}else if(j.indexOf("docbscan")!=-1||j.indexOf("BScan")!=-1){arrOpenPU[arrOpenPU.length]="B-Scan";}else if(j.indexOf("docOthr")!=-1||j.indexOf("Other")!=-1){arrOpenPU[arrOpenPU.length]="Other-Tests";}else if(j.indexOf("docLabs")!=-1||j.indexOf("Labs")!=-1){arrOpenPU[arrOpenPU.length]="Laboratories";}else if(j.indexOf("winSuperBill")!=-1){arrOpenPU[arrOpenPU.length]="Super Bill";}else if(j.indexOf("GDX")!=-1){arrOpenPU[arrOpenPU.length]="GDX";}}}}}catch(err){console.log("first: "+err);}
if(arrOpenPU.length>0){top.fAlert("Please save and close test forms<br/>"+"<br/>     -"+arrOpenPU.join("<br/>     -"));return true;}else{return false;}}
function setReviewableFunction(id){if((typeof(id)=="undefined"||id=="")&&$("form[id]").length>0){id=$("form[id]").get(0).id;}
if(typeof(id)!="undefined"&&id!=""){var strElm="#"+id+" :input[type!=button][type!=submit][value!=Save][value!=Done][value!=Cancel]";$(strElm).bind("focus",checkAlert);var strElm="#"+id+" label[for]";$(strElm).bind("mousedown",function(event){var f=$(this).attr("for");if(typeof(f)!="undefined"&&f!=""){$("#"+f).triggerHandler("focus");$(strElm).unbind("mousedown");}});}}
function checkAlert()
{if(typeof(window.flgCheckAlert)=="undefined"&&(typeof(event)!="undefined"&&event.target.id!='sl_paging'&&event.target.id!='el_pt_crry_frwd_dos'))
{top.fAlert("You are modifying a finalized patient chart note");window.flgCheckAlert=1;}}
function openNewChart(o,flgmsg)
{if(top.$(".messi").length<=0||top.$("#wv_old_chart_alert").length<=0){var msg=flgmsg?"You don't have permission to edit chart notes.":"Please Open New Chart Note!";top.fAlert(msg);top.$(".messi")[0].id="wv_old_chart_alert";if(o.type!="checkbox"){o.value=o.defaultValue;}
return false;}}
function setfinalizedFunction(id,flgmsg){if((typeof(id)=="undefined"||id=="")&&$("form[id]").length>0){id=$("form[id]").get(0).id;}
if(typeof(id)!="undefined"&&id!=""){var strElm="#"+id+" :input[type!=button][type!=submit][value!=Save][value!=Done][value!=Cancel]"+"[id!=to_do][name!=patient_task][id!=dr_to_do][name!=dr_task][name!=phy_name_drop][id!=elem_mrBat2][name!=pamOrBat][id!=elem_sur_ocu_hx]"+"[type!=hidden][id!=drawing-line-width][id!=text-font-size][id!=elem_lockAdminPass][name!=btn_act_done]";var tgNm="";$(strElm).each(function(){if($(this).parents("#genHealthDiv_wv").length>0){return false;}
var typee=this.type;tgNm=this.tagName.toLowerCase();if(typee=="text"||tgNm=="textarea"){$(this).attr("readonly","readonly");}else{$(this).attr("disabled","disabled");}
$(this).bind("click change",function(){openNewChart(this,flgmsg);});});}}
var sc_userPress_newchart_save=0;function sc_userPress(val){if(val==1){if($(":checked[name*=elem_ap_assess]").length>0){if($("#elem_masterRecordValidity").val()=="0"){sc_userPress_newchart_save=1;saveMainPage();return;}else{if(typeof(setProcessImg)!='undefined')setProcessImg("1","bodyMP","",300,600);var icd10=($("#hid_icd10").length>0)?$("#hid_icd10").val():$("#enc_icd10").val();document.frmsc.elem_sc_icd10.value=icd10;var param="elem_saveForm="+document.frmsc.elem_saveForm.value;param+="&elem_sc_icd10="+icd10;$(":checked[name*=elem_ap_assess]").each(function(){var v=this.value;param+="&elem_ap_assess[]="+v;param+="&elem_symptom_"+v+"="+$("#accordion_smart_chart :hidden[name=elem_symptom_"+v+"]").val();param+="&elem_site_"+v+"[]="+$(":checked[name*=elem_site_"+v+"]").val();param+="&elem_todoid_"+v+"="+$("#accordion_smart_chart  :hidden[name=elem_todoid_"+v+"]").val();});if(typeof(setProcessImg)!='undefined')setProcessImg("1");$.post("saveCharts.php",param,function(d){window.location.reload();});}}
$("#div_sc_con").hide();}else{$("#div_sc_con").hide();$("#div_sc_con_detail").modal('hide');$("#div_sc_con_detail1").modal('hide');}}
function loadAsPlanTBar(){$.post('onload_wv.php',{'elem_action':"GetListExamDone"},function(data){$('#imp_ex_done').html(data);},"");}
function upAsPlanProbid(arr){if(!arr||!arr[0]||arr[0].length<=0)return;var arr0=arr[0],arr1=arr[1];arr2=arr[2];$("input[name*=el_pt_ap_id]").each(function(indx){var tasid=this.id.replace(/el_pt_ap_id/,"elem_assessment");var tasv=$.trim($("#"+tasid).val());var tpl=this.id.replace(/el_pt_ap_id/,"elem_problist_id_assess");var tplv=$.trim($("#"+tpl).val());var re=null;if(tasv!=""){tasv=escapeRegExp(tasv);re=new RegExp("^"+tasv,"g");}
if(this.value==""||this.value=="0"){if(tasv!=""){for(var z in arr0){if(arr0[z].indexOf(tasv)!=-1&&re.test($.trim(arr0[z]))&&arr2&&arr2[z]&&arr2[z]!=""&&arr2[z]!="0"){this.value=arr2[z];}}}}else if(tasv==""){this.value='';}
if(tplv==""||tplv=="0"){if(tasv!=""){for(var z in arr0){if(arr0[z].indexOf(tasv)!=-1&&arr1[z]!=""&&arr1[z]!="0"){$("#"+tpl).val(arr1[z]);}}}}});}
function printPC(){var parWidth=parent.document.body.clientWidth;var parHeight=parent.document.body.clientHeight;top.popup_win(zPath+'/chart_notes/requestHandler.php?printType=1&elem_formAction=print_pc','printPatientPC','scrollbars=1,resizable=1,width='+parWidth+'height='+parHeight+',top=0,left=0');}
function printMr(value,w){if(elem_per_vo=="1"||(finalize_flag=="1"&&isReviewable!="1")){value="show";}
if(value=="show"){var givenMrValue="";$(":checked[name*=elem_mrNoneGiven]").each(function(){var a=this.name.replace(/elem_mrNoneGiven/,"");if(a!=""&&typeof(a)!="undefined"){if(givenMrValue!=""){givenMrValue+=",";}givenMrValue+="MR "+a+"";}});var pr=flg_printMr;pr=(pr=="")?"0":"1";var printone="";if(typeof(w)!="undefined"&&w!=""){printone="&printone="+w;}
var parWidth=parent.document.body.clientWidth;var parHeight=parent.document.body.clientHeight;top.popup_win(zPath+'/chart_notes/requestHandler.php?printType=1&elem_formAction=print_mr&givenMr='+givenMrValue+printone,'printPatientMr','scrollbars=1,resizable=1,width='+parWidth+'height='+parHeight+',top=0,left=0');}else{if(typeof(w)=="undefined"){w="";}
psm_actAfSave="Print_MR"+w;zSaveWithoutPopupSave=1;saveMainPage();}}
function getPhySign_db(num,flgSave,coId){var phyId_value="";var num0="";if(typeof(num)=="undefined"||num==""){num=1;}
num=""+num;var ar_num=(""+num.indexOf(",")!=-1)?""+num.split(","):[num];if(ar_num.length>0){for(var t in ar_num){var tnum=ar_num[t];if(typeof(tnum)!="undefined"&&tnum!=""){if(num0==""){num0=tnum;}
var phyId=gebi("elem_physicianId"+tnum);if(phyId&&typeof(phyId.value)!="undefined"&&phyId.value!=""){phyId_value+=phyId.value+",";}}}}
window.status="";if((phyId_value=="")){var em="Please select any signer.";window.status=em;return;}
flgSave=(typeof flgSave=="undefined")?"0":flgSave;var url="requestHandler.php";params="elem_formAction=CaptureSign";params+="&elem_flgApplet="+flgSave;params+="&elem_form_id="+$("#elem_masterId").val();params+="&elem_physicianId="+phyId_value;params+="&num="+num;if(typeof(setProcessImg)!='undefined')setProcessImg("1","td_signature_applet"+num0);$.post(url,params,function(dt){if(typeof(setProcessImg)!='undefined')setProcessImg("0","td_signature_applet"+num0);if(dt){var flgSave1=(typeof(dt.flgSaveDef)!="undefined")?dt.flgSaveDef:0;var data=dt.data;for(var x in data){var odata=data[x];if(odata&&((odata.strpixls&&odata.strpixls!="")||(odata.strsignpath&&odata.strsignpath!=""))){var num=odata.num;var oT=gebi("td_signature_applet"+num);var oE=gebi("elem_signCoords"+num);var oE1=gebi("hdSignCoordsOriginal"+num);var oSP=gebi("elem_sign_path"+num);if(oT){if(oE){oE.value=""+odata.strpixls;}
if(oE1){oE1.value=""+odata.strpixls;}
if(oSP){oSP.value=""+odata.strsignpath;}
oT.innerHTML=""+odata.str;flgSave1=1;}}else{window.status="Physician signature do not exists.";}}
if(flgSave=="1"&&flgSave1==1){FinalizeMainPage("1");}}},'json');}
var wnlOptTimer;var wnlOptExm="";var wnlOptW="";function showWnlOpts(flg,w,val){var o2=$("#div_wnlOpts"+w);if(o2.length<=0){var funcl="javascript:void";if(w==1){funcl="setWnlStart";}
else if(w==2){funcl="setNcStart";}
else if(w==3){funcl="setResetStart";}
var ss=""+"<div id=\"div_wnlOpts"+w+"\" class=\"wnlOpts\" onmouseover=\"clearWnlOpts();\" onmouseout=\"showWnlOpts(0,"+w+")\" >"+"<a href=\"javascript:void(0);\" class=\"ou\" onclick=\""+funcl+"('OU')\">OU</a><br/>"+"<a href=\"javascript:void(0);\" class=\"od\" onclick=\""+funcl+"('OD')\">OD</a><br/>"+"<a href=\"javascript:void(0);\" class=\"os\" onclick=\""+funcl+"('OS')\">OS</a>"+"</div>";$("#summarysheet").append(ss);showWnlOpts(flg,w,val);return;}
if(flg==1){var o;if(typeof val!="undefined"){if(wnlOptExm!=""&&val!=wnlOptExm){o2.hide();clearWnlOpts();}
if(wnlOptW!=""&&w!=wnlOptW){$("#div_wnlOpts"+wnlOptW).hide();}
var id="";if(w==1){id="elem_btnWnl";}
else if(w==2){id="elem_btnNoChange";}
else if(w==3){id="btn_reset_chart";}
o=$("#"+id+val);if(o.val()=="Prv"||o.val()=="UNDO")return;}
var pos=o.offset();var pos_ss=$("#summarysheet").offset();var dwv_scrolltop=$("#divWorkView").scrollTop();if(o2&&o2.is(':hidden')){var left=(w==1)?pos.left+40:pos.left+30;var top=pos.top;top+=dwv_scrolltop;top=top-25;var objcss={"left":""+left+"px","top":""+top+"px"};o2.css(objcss).show();wnlOptExm=""+val;wnlOptW=w;}
clearWnlOpts();}else{if(wnlOptTimer==null){wnlOptTimer=setTimeout(function(){showWnlOpts(0,w);},1000);}else{o2.hide();clearWnlOpts();wnlOptExm="";wnlOptW="";}}}
function clearWnlOpts(){wnlOptTimer=clearTimeout(wnlOptTimer);}
function setWnlStart(val){if(wnlOptExm!=""){showWnlOpts(0,1);if(wnlOptExm=="Mas"){setWnlValues_all(val);}else{setWnlValues(wnlOptExm,val);}}}
function setNcStart(val){if(wnlOptExm!=""){showWnlOpts(0,2);if(wnlOptExm=="Mas"){autoSaveNoChange_all(val);}else{autoSaveNoChange(wnlOptExm,val);}}}
function setWnlValues_all(iv){iv=(typeof iv!="undefined")?""+iv:"OU";var arr=new Array("pupil","eom","External","La","Sle","Rv");$("#summarysheet .btn[id*=elem_btnWnl]").each(function(){if(this.id=='elem_btnWnlMas'){return true;}
var t=this.id.replace(/elem_btnWnl/,'');t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();if(t=="Pupil"||t=="Eom"){t=t.toLowerCase();}
var tmp=iv;if(t=="eom"||t=="External"||t=="Gonio"){if(tmp!="OU")return true;}
setWnlValues(t,tmp);});}
function autoSaveWnl(w,eye)
{if(w.length==0)
{return;}
var url="saveCharts.php";var params={};params.elem_saveForm="WNL";var f=document.getElementById("elem_masterId");params.elem_formId=f.value;params.w=w;var p=document.getElementById("elem_patientId");params.elem_patientId=p.value;params.elem_exmEye=eye;params.artemp=arrTempProc_js;params.cryfwd_form_id=$("#cryfwd_form_id").val();if(typeof(setProcessImg)!='undefined')setProcessImg(1,"");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"");if(data=="1"){top.window.status="wnl is saved.";w=w.toLowerCase();if(w=="rv"){w="fundus_exam";}else if(w=="ag"){w="amsgrid";}
loadExamsSummary(w);if(w=="Pupil"||w=="Eom"||w=="Ee"){mandotry_chk(1);}}else{top.window.status="Error: wnl is not saved.\nPlease Try again.";}},"");}
function setWnlValues(s,eye){if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
eye=(typeof eye!="undefined")?eye:"OU";if(s.toUpperCase()!="EOM"){var op=oneEye_isOpAllwd(eye);if(!op.alwd){flash_msg('Prosthesis/Phthisis is set. This operation is not allowed!','danger');return;}
eye=op.eye;}
autoSaveWnl(s,eye);}
function autoSaveNoChange(w,eye)
{eye=(typeof eye!="undefined")?eye:"OU";if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
if(w.length==0)
{return;}
if(w.toUpperCase()!="EOM"){var op=oneEye_isOpAllwd(eye);if(!op.alwd){flash_msg('Prosthesis/Phthisis is set. This operation is not allowed!','danger');return;}
eye=op.eye;}
var url="saveCharts.php";var params="elem_saveForm=NoChange";var f=$("#elem_masterId");params+="&elem_formId="+f.val();params+="&w="+w;var p=$("#elem_patientId");params+="&elem_patientId="+p.val();params+="&elem_exmEye="+eye;params+="&cryfwd_form_id="+$("#cryfwd_form_id").val();var eId="elem_btnNoChange"+w;var eObj=$(":input[id='"+eId+"']");if(eObj.length){var r="1";params+="&"+eId+"="+r;}else{return;}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,eId);$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,eId);if(data=="1"){w=w.toLowerCase();if(w=="rv"){w="fundus_exam";}else if(w=="gonio"){w="iop_gon";}else if(w=="ag"){w="amsgrid";}
loadExamsSummary(w);if(w=="Pupil"||w=="Eom"||w=="Ee"){mandotry_chk(1);}}else{top.window.status="Error: \'no change\' is not saved.\nPlease Try again.";console.log(data);}},"");}
function autoSaveNoChange_all(v){v=(typeof v!="undefined")?""+v:"OU";var arr=new Array("Pupil","EOM","External","LA","Gonio","SLE","RV","Ref_Surg");var j=0;for(var i=0;i<8;i++){var o=$("#elem_btnNoChange"+arr[i]);if(o.length>0){if(o.val()=="NC"){autoSaveNoChange(arr[i],v);j+=1;}else{}}}
if(j==0){var cfrm=confirm("Do you want to set all exams to previous visit?");if(cfrm!=false){for(var i=0;i<7;i++){var o=$("#elem_btnNoChange"+arr[i]);if(o.length>0){if(o.val()=="Prv"||o.val()=="UNDO"){o.triggerHandler("click");}}}}}}
function addMoreSigns(v){var len=$("#elem_signatureNum").val();if(len==""){len=1;}
var num=parseInt(len)+1;$("#elem_signatureNum").val(num);if(typeof(setProcessImg)!='undefined')setProcessImg(1,"signatures");$.get("requestHandler.php",{"elem_formAction":"addMoreSigns","num":num},function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"signatures");if(data!=""){var wh=(v==2)?".phy_right":".phy_left";$("#signatures").append(data);$(document).scrollTop($(document).height());}});}
function checkDupPhy(obj){if(obj&&obj.value!=""){if($(".divsign :hidden[name*=elem_physicianId][value="+obj.value+"]").length>0||$(":hidden[name=elem_cosignerId][value="+obj.value+"]").length>0||$(":hidden[name=elem_physicianId][value="+obj.value+"]").length>0){top.fAlert("Physician already exists.");obj.value="";obj.focus();}else{var num=obj.name.replace("elem_physicianId","");$(":input[name=elem_physicianIdName"+num+"]").val(obj[obj.selectedIndex].text);}}}
function getAssessmentSign(num,n,coords,sdata,simg,cnfrm)
{if(elem_per_vo=="1"){return;}
if(typeof(num)=="undefined"){num=1;}
var v1="td_signature_applet"+num;var v2="dv_ShowSign"+num;var v3="elem_signCoords"+num;var v4="hdSignCoordsOriginal"+num;var v5="elem_sign_path"+num;if(typeof(n)=="undefined"){var w=parseInt(225*2.5);var h=parseInt(45*2.5);var opd=0;var tmp=$('#'+v1).position();if($("#"+v2).length<=0){var final_flg=$("#elem_isFormFinalized").val();var strpixls="";var img="<iframe id=\"ifrm_signApp"+num+"\" src=\"signApplet.php?final_flg="+final_flg+"&signType="+num+"\" border=\"0\" height=\"100%\" width=\"100%\" scrolling=\"0\"></iframe>";var str="<div id=\""+v2+"\" >"+
img+"</div>";$('#'+v1).append(str);$('#'+v2).css({'position':'absolute','width':''+w+"px",'height':''+h+"px",'background-color':'white','border':'1px solid black','z-Index':2,'overflow':'hidden'});}else{$("#"+v2).show();}
$("#"+v2).css({"left":tmp.left+"px","top":(opd+tmp.top-h)+"px"});}else if(n==1){var fid=$("#elem_masterId").val();$('#'+v1+' img').remove();$("#"+v2).hide();var final_flg=$("#elem_isFormFinalized").val();var proId=(final_flg==1)?$('#'+v1).parents("div.divsign").find(":input[name*=elem_physicianId][type!=text]").val():"";if(typeof(setProcessImg)!='undefined')setProcessImg(1,""+v1);var p={'elem_formAction':'GetSign','strpixls':''+coords+'','fid':''+fid,'signType':num,'final_flg':final_flg,'proId':proId,'sData':sdata,'sImg':simg};$.post('requestHandler.php',p,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,""+v1);if(data&&data.src&&data.src!=''){var u=zPath;$('#'+v1).append("<img src=\""+data.src+"\" alt=\"sign\" width=\"150\" height=\"30\" >");$('input[name='+v5+']').val(data.sign_path);}},"json");}else if(n==2){$("#"+v2).hide();}else if(n==3){if($('#'+v1+' img').length>0){$('#'+v1+' img').remove();$('input[name='+v5+']').val("");$("#"+v3).val("");}else{if($('#'+v1+'').parents("div.divsign").children("select[value='']").length>0){$('#'+v1+'').parents("div.divsign").remove();}else{if(typeof(cnfrm)=="undefined"){top.fancyConfirm("Are you sure to delete this physician?","",'top.fmain.getAssessmentSign("'+num+'","'+n+'","'+coords+'","'+sdata+'","'+simg+'",true)');return}
else if(cnfrm==true){var fid=$("#elem_masterId").val();if($('#'+v1+'').parents("div.divsign").find(":hidden[name*=elem_physicianId]").length>0){var proid=$('#'+v1+'').parents("div.divsign").find(":hidden[name*=elem_physicianId]").val();}else if($('#'+v1+'').parents("div.divsign").find("select[name*=elem_physicianId]").length>0){var proid=$('#'+v1+'').parents("div.divsign").find("select[name*=elem_physicianId]").val();}
if($.isNumeric(proid)){$.get("saveCharts.php",{"elem_saveForm":"DelSignature","proid":proid,"fid":fid},function(data){if(data==0){$('#'+v1+'').parents("div.divsign").remove();}else{window.status="Error: "+data;}});}else{$('#'+v1+'').parents("div.divsign").remove();}
return;}}}}}
function setPrPh(o)
{if(o.checked==true){$("#phth_pros").val(""+o.value);$("#elem_curset_phth_pros").val("1");$("#p3s input[name!='"+o.name+"']").attr("checked",false).each(function(){utElem_capture(this);});$("#is_od_os").css("visibility","visible");}else{$("#is_od_os").val("").css("visibility","hidden");$("#phth_pros").val("");$("#elem_curset_phth_pros").val("0");}
loadExamsSummaryAll();}
function setPhPrEye(o)
{var prph=$("#phth_pros").val();if(prph==""||o.value==""){$("#elem_curset_phth_pros").val("0");}else{$("#elem_curset_phth_pros").val("1");}
loadExamsSummaryAll();}
function loadExamsSummary(enm){if(enm=="")return;var url="onload_wv.php";var params={};params.elem_action="GetExamSummary";params.enm=enm;var oe_issue=$("#phth_pros").val();var oe_eye=$("#is_od_os").val();var oe_curr=$("#elem_curset_phth_pros").val();if(oe_issue!=""&&oe_eye!=""){params.oe=""+oe_issue+"~!~"+oe_eye+"~!~"+oe_curr;}
if(enm=="sle"||enm=="fundus_exam"){params.artemp=arrTempProc_js;}
setProcessImg(1,"summarysheet");$.get(url,params,function(data){setProcessImg(0,"summarysheet");if(data[enm]!=""&&enm!="drawingpane"){$("#"+enm).html(data[enm]);}else if(enm=="vf_oct_gl"){$("#"+enm).html(data[enm]);}
if(enm!="dv_cpctrl"&&enm!="dv_stereopsis"&&enm!="dv_w4dot"){setExamsLoaded(enm);}
if(data["drawingpane"]!=""){if($.trim(data["drawingpane"])=="No Drawing exits."){data["drawingpane"]="";}
$("#drawingpane").html(data["drawingpane"]);}
if(data["imp_ex_done"]!=""){$("#imp_ex_done").html(data["imp_ex_done"]);}},"json");}
function loadExamsSummaryAll(){$('#summarysheet>div').each(function(indx){var eid=$(this).prop("id");if(typeof(eid)!="undefined"&&eid!=""){if(eid!="sec_wv_sum"&&eid.indexOf("div_wnlOpts")==-1){if($(this).html()!=""){loadExamsSummary(eid);}}}});}
function setExamsLoaded(enm){setFindingsLinks();}
function setFindingsLinks(){if(elem_per_vo=="1"||(finalize_flag==1&&isReviewable==0)){return;}
$("#summarysheet b.finding").each(function(){var ea=$(this).data("ev_atch");if(typeof(ea)=="undefined"){$(this).data("ev_atch",1);$(this).bind("click",function(){var cs=$(this).data("sen");var cfind=$(this).html();if(cfind=="Comments:"){cfind=cfind+cs;}
var cfind_f=$(this).data("symp-full");if(typeof(cfind_f)!="undefined"&&cfind_f!=""){cfind=cfind_f;}
if(typeof(cfind)!="undefined"&&cfind!=""){checkSympTyped(this,cfind,'',cs);}});}});}
var checkSympTyped_qry="";function checkSympTyped(ob,symp,fromas,exm){var searchVal=symp;var searchVal=searchVal.split(";");searchVal=$.trim(searchVal[0]);searchVal=encodeURI(searchVal);var oid=(typeof(ob.id)!="undefined"&&ob.id!="")?ob.id:"summarysheet";var ct=""+$("#elem_ptTemplate").val();ct=encodeURI(ct);if(typeof(fromas)=="undefined"){fromas="";}
if(typeof(exm)=="undefined"){exm="";}
var vicd10=$("#hid_icd10").val();if(typeof(vicd10)=="undefined"){if(window.opener&&window.opener.top.fmain){vicd10=window.opener.top.fmain.$("#hid_icd10").val();}}
var url="requestHandler.php";var params="elem_formAction=SmartChartDetail&symp="+searchVal+"&mode=NoAP&ctemp="+ct+"&fromas="+fromas+"&icd10="+vicd10+"&sen="+exm;if(checkSympTyped_qry!=params){checkSympTyped_qry=params;}else if($("#div_sc_con_detail").length>0){return;}
$("#div_sc_con_detail").modal('hide');$("#div_sc_con_detail, .modal-backdrop").remove();if(typeof(setProcessImg)!='undefined')setProcessImg("1",""+oid);$.get(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0",""+oid);if(data!=""){$("#div_sc_con_detail").modal('hide');$("#div_sc_con_detail, .modal-backdrop").remove();$("body").append(data);$("#div_sc_con_detail").modal({backdrop:false});$("#div_sc_con_detail").modal('show');$(".dacry input[type=text], .lacsci input[type=text], .ctmri input[type=text]").datepicker({dateFormat:"mm-dd-yy",showOn:"button"});utElem_setBgColor("div_sc_con_detail");$("#div_sc_con_detail textarea, #div_sc_con_detail input[type=text]").bind("focus",function(){if(!$(this).hasClass("ui-autocomplete-input")){cn_ta1_no_assess(this,'');};});newET_setGray_v3();}});}
function clearAssessRow(id){var a=["elem_assessment_dxcode","elem_assessment","elem_plan","elem_apOu","elem_apOd","elem_apOs","no_change_","elem_resolve"];var rx=rgp(a.join("|"));var asdxid=id.replace(rx,"");for(var x in a){var t="#"+a[x]+asdxid;if($(t).is(":checkbox")){$(t).prop("checked",false);if(t.indexOf("no_change_")!=-1||t.indexOf("elem_resolve")!=-1){$(t).triggerHandler("click");}}else{$(t).val("");}}}
function chkSelection(s,obj){if(obj.tagName=="SMALL"){var lna=$("#assessplan :checkbox[name='elem_apnc[]']").length-1;var lnb=$("#assessplan :checked[name='elem_apnc[]']").length;$("#assessplan :checkbox[name='elem_apnc[]']").each(function(){if(lnb>=lna){if(this.checked){$(this).prop("checked",false).triggerHandler("click");}}else{if(!this.checked){$(this).prop("checked",true).triggerHandler("click");}}});return;}
if(obj.id.indexOf("no_change_")!=-1){if(obj.checked==true){gebi("elem_resolve"+s).checked=false;}}else if(obj.id.indexOf("elem_resolve")!=-1){if(obj.checked==true){var o=gebi("no_change_"+s);if(o){o.checked=false;}}}
setAPClr(s,obj);}
function setAPClr(w,o){var w1=w-1;var clr="";if($("#no_change_"+w+":checked").length>0){clr="apClr";}else if($("#elem_resolve"+w+":checked").length>0){clr="apClrRes";}
$("#assessplan .planbox:eq("+w1+") textarea").removeClass("apClr apClrRes");if(clr!=""){$("#assessplan .planbox:eq("+w1+") textarea").addClass(clr);}
restorePlan_2(w,o);}
function restorePlan_2(val,obj){if(finalize_flag==1&&isReviewable==0)return;if(obj.checked==true){var oAssess=gebi("elem_assessment"+val);var targetPlan,cfPlan=null;targetPlan=$("#assessplan .planbox:eq("+(val-1)+" textarea)");cfPlan=targetPlan.attr("data-elem_CFPlan");if(typeof(cfPlan)!="undefined"&&(($.trim(oAssess.value)!="")&&($.trim(targetPlan.val())==""))){targetPlan.val(cfPlan);}}}
function ap_rowAdj(mf,m2){if(((typeof mf!="undefined")&&(mf!=0))&&((typeof m2!="undefined")&&(m2!=0))&&(mf!=m2)){var arr=["elem_assessment","elem_plan","elem_resolve","no_change_","elem_apOu","elem_apOd","elem_apOs","elem_assessment_dxcode","elem_problist_id_assess","el_pt_ap_id","el_amst_site"];for(var x in arr){var elm=arr[x];var t2,t,cft="";if($("#"+elm+m2).attr("type")=="checkbox"){t=$("#"+elm+m2).is(":checked");t2=$("#"+elm+mf).is(":checked");if(typeof(t2)=="undefined"){t2=false;}
$("#"+elm+m2).prop("checked",t2).each(function(){if(elm=="no_change_"||elm=="elem_resolve"){setAPClr(m2,this);}});}else{t=$("#"+elm+m2).val();if(typeof(t)=="undefined"){t="";}
$("#"+elm+m2).val(""+$("#"+elm+mf).val()).triggerHandler("keyup");if(elm=="elem_plan"){cft=$("#"+elm+m2).attr("data-elem_CFPlan");$("#"+elm+m2).attr("data-elem_CFPlan",$("#"+elm+mf).attr("data-elem_CFPlan"));}else if(elm=="el_amst_site"){cft=$("#"+elm+m2).parent().hasClass("hidden");if($("#"+elm+mf).parent().hasClass("hidden")){$("#"+elm+m2).parent().addClass("hidden");$("#elem_assessment"+m2).parent().removeClass("col-sm-11").addClass("col-sm-12");}else{$("#"+elm+m2).parent().removeClass("hidden");$("#elem_assessment"+m2).parent().removeClass("col-sm-12").addClass("col-sm-11");}}else if(elm=="elem_assessment_dxcode"){cft=$("#"+elm+m2).attr("data-dxid");$("#"+elm+m2).attr("data-dxid",$("#"+elm+mf).attr("data-dxid"));}}
if(mf<m2){for(var i=m2-1;i>=mf;i--){if($("#"+elm+i).parents(".planbox").css("display")=="none"){continue;}
var cft1="";if($("#"+elm+i).attr("type")=="checkbox"){var t1=$("#"+elm+i).is(":checked");if(typeof(t)=="undefined"){t=false;}
$("#"+elm+i).prop("checked",t).each(function(){if(elm=="no_change_"||elm=="elem_resolve"){setAPClr(i,this);}});}else{var t1=$("#"+elm+i).val();if(typeof(t1)=="undefined"){t1="";}
$("#"+elm+i).val(""+t).triggerHandler("keyup");if(elm=="elem_plan"){cft1=$("#"+elm+i).attr("data-elem_CFPlan");$("#"+elm+i).attr("data-elem_CFPlan",cft);}else if(elm=="el_amst_site"){cft1=$("#"+elm+i).parent().hasClass("hidden");if(cft){$("#"+elm+i).parent().addClass("hidden");$("#elem_assessment"+i).parent().removeClass("col-sm-11").addClass("col-sm-12");}else{$("#"+elm+i).parent().removeClass("hidden");$("#elem_assessment"+i).parent().removeClass("col-sm-12").addClass("col-sm-11");}}else if(elm=="elem_assessment_dxcode"){cft1=$("#"+elm+i).attr("data-dxid");$("#"+elm+i).attr("data-dxid",cft);}}
t=t1;cft=cft1;}}else if(mf>m2){for(var i=m2+1;i<=mf;i++){if($("#"+elm+i).parents(".planbox").css("display")=="none"){continue;}
if($("#"+elm+i).attr("type")=="checkbox"){var t1=$("#"+elm+i).is(":checked");if(typeof(t)=="undefined"){t=false;}
$("#"+elm+i).prop("checked",t).each(function(){if(elm=="no_change_"||elm=="elem_resolve"){setAPClr(i,this);}});}else{var t1=$("#"+elm+i).val();if(typeof(t1)=="undefined"){t1="";}
$("#"+elm+i).val(""+t).triggerHandler("keyup");if(elm=="elem_plan"){cft1=$("#"+elm+i).attr("data-elem_CFPlan");$("#"+elm+i).attr("data-elem_CFPlan",cft);}else if(elm=="el_amst_site"){cft1=$("#"+elm+i).parent().hasClass("hidden");if(cft){$("#"+elm+i).parent().addClass("hidden");$("#elem_assessment"+i).parent().removeClass("col-sm-11").addClass("col-sm-12");}else{$("#"+elm+i).parent().removeClass("hidden");$("#elem_assessment"+i).parent().removeClass("col-sm-12").addClass("col-sm-11");}}else if(elm=="elem_assessment_dxcode"){cft1=$("#"+elm+i).attr("data-dxid");$("#"+elm+i).attr("data-dxid",cft);}}
t=t1;cft=cft1;}}}}}
var st_ap_adjt=ed_ap_adjt=0;function ap_adjt(num,obj){var tmp_u_t=(user_type=="1"||(ssFollowPhy!=""&&ssFollowPhy!="0"))?"1":"0";if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))||(tmp_u_t!="1")){return;}
if(st_ap_adjt==0){st_ap_adjt=num;obj.style.color="red";return;}else{ed_ap_adjt=num;}
if((st_ap_adjt!=0)&&(ed_ap_adjt!=0)){$("#assessplan .ap_num").css("color","white");ap_rowAdj(st_ap_adjt,ed_ap_adjt);isFormChanged=1;st_ap_adjt=ed_ap_adjt=0;}}
function showICD10CodeModifier(obj){if($.trim(obj.value)==""){return;}
var icd10=$("#hid_icd10").val();if(icd10!=1){return false;}
if(isDiabetesAssess(obj.value)){if(typeof(obj.onchange)=="function"){obj.onchange();}
if(typeof(obj.onblur)=="function"){obj.onblur();}
return;}
var dxid=obj.id.replace("elem_assessment","elem_assessment_dxcode");if(""+$("#"+dxid).val().length<=0){return;}
$("#"+dxid).data("checkfullcode",1);$("#"+dxid).autocomplete("search");}
function isDiabetesAssess(str,fstp){str=$.trim(str);if(fstp=="2"){var ar_str=str.split(";");if(ar_str.length>0){str=$.trim(ar_str[0]);}}
var ret=str.match(/^((diabetes|diabetes\s+mellitus|dm)\s+type\s+[1|2])/gi);str=str.toLowerCase();if(str=="diabetes 1"||str=="diabetes 2"||str=="dm 1"||str=="dm 2"||str=="diabetes type 1 no retinopathy"||str=="diabetes type 2 no retinopathy"){ret=str;}return ret;}
var arrScrlHgt_setTaPlanHgt=[];function setTaPlanHgt(num,obj){if(!isiPad&&navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")==-1){return;}
var num2=""+num;if(num=="elem_consult_reason"||num=="commentsForPatient"||num=="elem_notes"||num=="elem_transition_reason"||num=="elem_transition_notes"||num2.indexOf("elem_visMrDesc")!=-1||num2.indexOf("elem_visPcDesc")!=-1){var x=$("#"+num)[0].scrollHeight;var y=(typeof(x)!="undefined"&&x>20)?x:20;$("#"+num).attr("style","height: "+y+"px !important");return;}
if((num==0)&&(typeof obj!="undefined")){num=obj.id.replace("elem_plan","");}
var objAsses=gebi("elem_assessment"+num);var objAssesDxCode=gebi("elem_assessment_dxcode"+num);var objPlan=gebi("elem_plan"+num);var tdA=gebi("td_assessment"+num);var tdP=gebi("td_plan"+num);if(typeof(arrScrlHgt_setTaPlanHgt[num])=="undefined"){arrScrlHgt_setTaPlanHgt[num]=[];}
if(objAsses){var tmp1=(typeof(arrScrlHgt_setTaPlanHgt[num][0])!="undefined"&&arrScrlHgt_setTaPlanHgt[num][0]>18)?arrScrlHgt_setTaPlanHgt[num][0]:18;var tmp=(typeof(objAsses.scrollHeight)!="undefined"&&objAsses.scrollHeight>18)?(objAsses.scrollHeight):tmp1;if(tmp){if(tmp1<tmp&&tmp-tmp1>=8)
{objAsses.style.maxHeight=objAsses.style.minHeight=objAsses.style.height=tmp+"px";arrScrlHgt_setTaPlanHgt[num][0]=tmp1=tmp;$(objAsses).prop("style","height: "+tmp+"px !important");}}}
if(objAssesDxCode){objAssesDxCode.value=$.trim(""+objAssesDxCode.value.replace(/\s*/g,""));objAssesDxCode.value=""+objAssesDxCode.value.replace(",",", ");var tmp1=(typeof(arrScrlHgt_setTaPlanHgt[num][1])!="undefined"&&arrScrlHgt_setTaPlanHgt[num][1]>18)?arrScrlHgt_setTaPlanHgt[num][1]:18;var tmp=(typeof(objAssesDxCode.scrollHeight)!="undefined"&&objAssesDxCode.scrollHeight>18)?(objAssesDxCode.scrollHeight):tmp1;if(tmp){if(tmp1<tmp&&tmp-tmp1>=8)
{objAssesDxCode.style.maxHeight=objAssesDxCode.style.minHeight=objAssesDxCode.style.height=tmp+"px";arrScrlHgt_setTaPlanHgt[num][1]=tmp;$(objAssesDxCode).prop("style","height: "+tmp+"px !important");}}}
if(objPlan){var tmp1=(typeof(arrScrlHgt_setTaPlanHgt[num][2])!="undefined"&&arrScrlHgt_setTaPlanHgt[num][2]>18)?arrScrlHgt_setTaPlanHgt[num][2]:18;var tmp=(typeof(objPlan.scrollHeight)!="undefined"&&objPlan.scrollHeight>18)?(objPlan.scrollHeight):tmp1;if(tmp){if(tmp1<tmp&&tmp-tmp1>=8)
{objPlan.style.maxHeight=objPlan.style.minHeight=objPlan.style.height=tmp+"px";arrScrlHgt_setTaPlanHgt[num][2]=parseInt(tmp);$(objPlan).prop("style","height: "+tmp+"px !important");}}}
if(tdA&&tdP){tdA.style.height=(tmp1+5)+"px";tdP.style.height=(tmp1+5)+"px";}}
var strCalledMAses="";function checkConsolePlan(obj,num,flgDx){var str=$.trim(obj.value);if($("#hid_icd10").val()=="1"){if(isDiabetesAssess(str,2)){if($("#no_change_"+num).prop("checked")==false){z_flg_diab_sb="2";sb_checkDiabetes();return;}}else if(str.match(/esotropia/gi)||str.match(/esotropia>>/gi)||str.match(/exotropia/gi)||str.match(/exotropia>>/gi)||str.match(/congenital/gi)||str.match(/congenital>>/gi)){icd10_charts_popup(1,'',str,obj.id);return;}}
var strdx=$("#elem_assessment_dxcode"+num).val();var flagAs=isAssessAlreadyAdded(str,num,strdx);if(flagAs.Flag){top.fAlert('Assessment already exists.');obj.value="";$("#elem_assessment_dxcode"+num).val("");$("#elem_apOu"+num).prop("checked",false);$("#elem_apOd"+num).prop("checked",false);$("#elem_apOs"+num).prop("checked",false);return;}
if((flgDx!=1)&&isDxCorrectCode(str)){check4DxDesc(obj,num);}else{var str=str.split(";");str=$.trim(str[0]);var symp=as=pln="";var oPlan=gebi("elem_plan"+num);var addstr=num+":"+str+",";var url="requestHandler.php";var params="elem_formAction=GetAPDataofAsmt";params+="&srch="+str;$.get(url,params,function(data){var chk_as=""+data[0];var chk_plan=$.trim(""+data[1]);var chk_symp=$.trim(""+data[2]);if(chk_as=="false"&&chk_plan=="false"&&chk_symp=="false"){return;}
var obj2=isApPlansMulti(chk_plan,1);var lenk=obj2.lenk;if(typeof(cn_rem_escp_char)!="undefined"){chk_plan=cn_rem_escp_char(chk_plan);}
if((strCalledMAses.indexOf(addstr)==-1)&&(lenk==false)){var strPlan=$.trim(oPlan.value);if(strPlan!=""){if(strPlan.indexOf(chk_plan)==-1){strPlan=strPlan+"; "+chk_plan;}}else{strPlan=""+chk_plan;}
oPlan.value=strPlan;}else{strCalledMAses+=addstr;}
setApPolFU(chk_symp,chk_as,chk_plan);if(chk_symp!=""){checkSympTyped(obj,chk_symp,1);}},"json");}}
function setCursorAtEnd(){var obj=arguments[0];var st2=arguments[1];var e=window.event;if(e&&(typeof arguments[1]=="undefined")){obj=e.srcElement;}
if(obj){var st=st2||0;if(st==0){if(obj.value.indexOf("20/")!=-1){st=3;}
if(obj.name.indexOf("_dxcode")!=-1&&$.trim(obj.value)!=""){st=obj.value.length;}}
if(obj.setSelectionRange){obj.setSelectionRange(st,st);}else if(obj.createTextRange)
{var FieldRange=obj.createTextRange();FieldRange.moveStart('character',st);FieldRange.select();}}}
function restorePlan_all(){if(finalize_flag==1&&isReviewable==0)return;if($("#divPPlans").length<=0){showPrevPlan();return;}
$("#divPPlans table tr").each(function(){var indx=$(this).find("td:nth-child(1)").html();if(typeof(indx)!="undefined"&&indx!=""){indx=indx.replace(/\./,"");indx=$.trim(indx);}
if(typeof(indx)!="undefined"&&indx!=""){var td=gebi("elem_plan"+indx);if(td){var t=$.trim(td.value);t=t.replace(/[\n\r\u00AD]/g,'');var pln=$(this).find("td:nth-child(2)").text();pln=$.trim(pln);if(typeof(pln)!="undefined"&&pln!=""&&t==""){td.value=pln;if(typeof(td.onkeyup)=="function"){td.onkeyup();}}}}});$('#divPPlans').hide();}
function remPrevPlan(i){if(typeof(i)!="undefined"){var td2=gebi("tdprevplan"+i);if(td2){td2.innerHTML="";}}
showPrevPlan();stopClickBubble();}
var showPrevPlan_flg;function showPrevPlan(flg){if(typeof(flg)!="undefined"){if(flg==1){showPrevPlan_flg=setTimeout(function(){showPrevPlan();},700);}
else if(flg==2){clearTimeout(showPrevPlan_flg);}
return;}
if($("#divPPlans").length>0){$('#divPPlans').show();return;}
var i=1;var str="";while(true){var td=gebi("elem_plan"+i);if(!td||i>50)break;var cfPlan=td.getAttribute("data-elem_CFPlan");var cfPlan_rem=td.getAttribute("data-elem_CFPlan_rem");if(typeof(cfPlan_rem)=="string"&&cfPlan_rem=="1"){cfPlan="";}
if(cfPlan!=null&&cfPlan!=""&&typeof(cfPlan)!="undefined"){str+="<tr valign=\"top\"><td>"+i+".</td><td id=\"tdprevplan"+i+"\" >"+cfPlan+"</td><td align=\"center\"  title=\"Remove\" onclick=\"remPrevPlan('"+i+"')\"><span class=\"glyphicon glyphicon-remove\"></span></td></tr>";}
i++;}
if(str!=""){str="<table border=\"0\" class=\"table table-bordered table-hover table-striped\">"+str+"</table>";}else{str="<span>No Previous Plan</span>";}
str="<div class=\"header\">"+"<span id=\"spn_dd_dos\" class=\"pull-left primary form-inline\" ><label for=\"sl_prv_dd_dos\">DOS:</label><select id=\"sl_prv_dd_dos\" class=\"form-control\" onchange=\"load_visit_plans(this)\"><option value=\"\"> -Select- </option></select></span>"+"<span class=\"glyphicon glyphicon-remove\" onclick=\"$('#divPPlans').remove();\"></span></div>"+str;$("#divPPlans").remove();var oP=$("#linkPrevPlan").position();var tmp=parseInt(oP.top)+25;$("#assessplan").append("<div id='divPPlans'>"+str+"</div>");$("#assessplan #divPPlans").css('top',tmp+'px');$("#divPPlans").draggable({handle:"div"});$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=load_dd_dos",function(d){if(d){$.each(d,function(k,itm){var sl=(k==0)?"selected":"";$("#sl_prv_dd_dos").append($('<option '+sl+'></option>').val(itm[0]).html(itm[1]));});}},"json");}
function load_visit_plans(o){var i=$(o).val();if(i==""){return;}
if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
top.show_loading_image('show');$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=load_dos_plans&fid="+i,function(d){top.show_loading_image('hide');if(typeof(d)!="undefined"&&d!=""){$("#divPPlans .header").nextAll().remove();if(d=="No Previous Plan"){d="<span>"+d+"</span>";}
$(""+d).insertAfter("#divPPlans .header");}});}
function reset_assessment(fldid){if(fldid.indexOf("elem_assessment_dxcode")!=-1){var ass_dx_id=fldid;var ass_id=fldid.replace("elem_assessment_dxcode","elem_assessment");var ass_ou_id=fldid.replace("elem_assessment_dxcode","elem_apOu");var ass_od_id=fldid.replace("elem_assessment_dxcode","elem_apOd");var ass_os_id=fldid.replace("elem_assessment_dxcode","elem_apOs");var pop_ass_id=fldid.replace("elem_assessment_dxcode","pop_elem_assessment");var ass_plan_pt_id=fldid.replace("elem_assessment_dxcode","el_pt_ap_id");var ass_plan_id=fldid.replace("elem_assessment_dxcode","elem_plan");if($("#"+ass_plan_id).val()==""){$("#"+ass_plan_pt_id).val('');}
$("#"+ass_id).val('');$("#"+ass_ou_id).attr("checked",false);$("#"+ass_od_id).attr("checked",false);$("#"+ass_os_id).attr("checked",false);$("#elem_ass_comm").val('');$("#"+pop_ass_id).val('');$("#"+ass_dx_id).val('').removeData("dxid").attr("data-dxid","");}else if(fldid.indexOf("ap_elem_assessment")!=-1){var ass_id=fldid.replace("ap_elem_assessment","elem_assessment");var ass_dx_id=fldid.replace("ap_elem_assessment","elem_assessment_dxcode");var ass_ou_id=fldid.replace("ap_elem_assessment","elem_apOu");var ass_od_id=fldid.replace("ap_elem_assessment","elem_apOd");var ass_os_id=fldid.replace("ap_elem_assessment","elem_apOs");var pop_ass_id=fldid.replace("ap_elem_assessment","pop_elem_assessment");var ass_plan_id=fldid.replace("ap_elem_assessment","elem_plan");var ass_plan_pt_id=fldid.replace("ap_elem_assessment","el_pt_ap_id");$("#"+ass_id).val('');$("#"+ass_plan_id).val('');$("#"+ass_ou_id).attr("checked",false);$("#"+ass_od_id).attr("checked",false);$("#"+ass_os_id).attr("checked",false);$("#elem_ass_comm").val('');$("#"+pop_ass_id).val('');$("#"+ass_dx_id).val('').removeData("dxid").attr("data-dxid","");$("#"+ass_plan_pt_id).val('');$("#"+ass_id).parents(".planbox").hide();}else if(fldid.indexOf("elem_assessment")!=-1){var ass_id=fldid;var ass_dx_id=fldid.replace("elem_assessment","elem_assessment_dxcode");var ass_ou_id=fldid.replace("elem_assessment","elem_apOu");var ass_od_id=fldid.replace("elem_assessment","elem_apOd");var ass_os_id=fldid.replace("elem_assessment","elem_apOs");var pop_ass_id=fldid.replace("elem_assessment","pop_elem_assessment");var ass_plan_pt_id=fldid.replace("elem_assessment","el_pt_ap_id");var ass_plan_id=fldid.replace("elem_assessment","elem_plan");if($("#"+ass_plan_id).val()==""){$("#"+ass_plan_pt_id).val('');}
$("#"+ass_id).val('');$("#"+ass_ou_id).attr("checked",false);$("#"+ass_od_id).attr("checked",false);$("#"+ass_os_id).attr("checked",false);$("#elem_ass_comm").val('');$("#"+pop_ass_id).val('');$("#"+ass_dx_id).val('').removeData("dxid").attr("data-dxid","");}else if(fldid.indexOf("elem_dxCode")!=-1){$("#"+fldid).val('');$("#elem_ass_comm").val('');$("#"+fldid).removeData("dxid");renew_title($("#"+fldid)[0],"");}
$("#dialogLSS td.highlight").removeClass('highlight');$("#dialogLSS").dialog("close");}
function getForthAssess(flg)
{var objTbl=$("#assessplan .planbox");var lastRow=objTbl.length;var tmp=lastRow;var objAssess=gebi("elem_assessment"+tmp);var objAssessDx=gebi("elem_assessment_dxcode"+tmp);var objPlan=gebi("elem_plan"+tmp);if(((objAssess.value!="")||(objAssessDx.value!="")||(objPlan.value!=""))||(typeof(flg)!="undefined"&&flg=="1")){addAssessPlanRow("","","");}}
function makeAssessmentPure(assess){var retDx="";assess=$.trim(assess);if(assess!=""){var indx=assess.indexOf(";");if(indx!=-1){assess=assess.substring(0,indx);}
indx=-1;var chkEye="";indx=assess.lastIndexOf("-");if(indx!=-1){var ptrn="\\-\\s*(OD|OS|OU)\\s*";var reg=new RegExp(ptrn,"g");if(assess.match(reg)){chkEye=assess.match(new RegExp("(OD|OS|OU)","g"));assess=assess.replace(reg,"");}}
indx=-1;indx=assess.lastIndexOf("(");if(indx!=-1){var tmp=$.trim(assess.substring(indx));tmp=$.trim(tmp.replace(/[\\(\\)]/g,""));if(tmp.indexOf(",")!=-1){var arr=tmp.split(",");}else{var arr=new Array(tmp);}
var flag=true;var len=arr.length;for(var i=0;i<len;i++)
{if((typeof arr[i]!="undefined")){if(!isDxCorrectCode(arr[i])){flag=false;break;}}}
if(flag==true){assess=$.trim(assess.substring(0,indx));retDx=tmp;}}}
return{"assess":assess,"dx":retDx,"eye":chkEye};}
function isDxAlreadyAdded(dx,dxid){dx=$.trim(dx);dxid=$.trim(dxid);if(typeof(dx)=="undefined"||dx==""){return 1;}
var ret=0;var lastRow=$("#assessplan .planbox").length;for(var i=1;i<=lastRow;i++){var oDx=gebi("elem_assessment_dxcode"+i);if((oDx!=null)){var chk=$.trim(oDx.value);if(chk!=""){var chkid=$(oDx).data("dxid");if(typeof(chkid)=="undefined"){chkid="";}
var chk2=chk.substring(0,chk.length-1)+"-";var chk3=chk.substring(0,chk.length-2)+"--";var chk4=chk.substring(0,chk.length-3)+"-x-";if(chk==dx||chk.indexOf(dx)!=-1||dx==chk2||dx==chk3||dx==chk4){if(dxid!=""&&dxid!=chkid){}else{ret=1;break;}}}}}
return ret;}
function isAssessAlreadyAdded(assessment,asnum,asdx,asdxid){var curNum=(typeof asnum!="undefined"&&asnum!="")?asnum:null;var curDx=(typeof asdx!="undefined"&&asdx!="")?asdx:"";curDx=$.trim(curDx.replace(/\s/g,""));asdxid=(typeof asdxid!="undefined"&&asdxid!="")?$.trim(asdxid):"";var oAssessment=makeAssessmentPure(assessment);var assessment=oAssessment.assess;assessment=$.trim(assessment);var lastRow=$("#assessplan .planbox").length;var flag=false;var emptyIndx=0;var addedIndx=0;for(var i=1;i<=lastRow;i++){var oAssess=gebi("elem_assessment"+i);if((oAssess!=null)){var oDx=gebi("elem_assessment_dxcode"+i);if($.trim(oAssess.value)!=""){var otemp=makeAssessmentPure(oAssess.value);var temp=$.trim(otemp.assess);var tmpdx=oDx.value;tmpdx=$.trim(tmpdx.replace(/\s/g,""));var tmpdxid=$(oDx).data("dxid");if(typeof(tmpdxid)=="undefined"){tmpdxid="";}
tmpdxid=$.trim(tmpdxid);if((temp.toUpperCase()==assessment.toUpperCase())&&((curNum==null)||(curNum!=i))){var flg=(curNum!=null&&(curDx!=tmpdx||(tmpdxid!=asdxid)))?false:true;if(flg){flag=true;addedIndx=i;break;}}else{}}else{var oPlan=gebi("elem_plan"+i);if(emptyIndx==0&&$.trim(oPlan.value)==""&&$.trim(oDx.value)==""){emptyIndx=i;}}}}
return{"Flag":flag,"EmptyIndx":emptyIndx,"AddedIndx":addedIndx};}
function isDxCorrectCode(elemVal)
{if($.trim(elemVal)!="")
{var ptrn="^[0-9a-zA-Z]{3}((\\.[0-9a-zA-Z\\-]{1,4}))?$";var reg=new RegExp(ptrn,"g");if($.trim(elemVal).match(reg)==null||$.trim(elemVal).match(/[0-9]/)==null)
{return false;}}
return true;}
function isApPlansMulti(plan,flg){var ptrn="(^\\n|\\n$)";plan=regReplace(ptrn,"",plan);if(typeof(flg)!="undefined"&&flg==1){var arrPlans=plan.split("\\n");}else{var arrPlans=plan.split("\n");}
var lenk=arrPlans.length;return(lenk>1)?{"lenk":true,"arr":arrPlans}:{"lenk":false};}
function setApPolFU(symp,as,pln,a_n,idOdr,idOdrset,site,sig,fInsrtOrdr){if(typeof(symp)=="undefined")symp="";if(typeof(as)=="undefined")as="";if(typeof(pln)=="undefined")pln="";if(typeof(idOdr)=="undefined")idOdr="";if(typeof(idOdrset)=="undefined")idOdrset="";if(typeof(a_n)=="undefined")a_n="";if(typeof(site)=="undefined")site="";if(typeof(sig)=="undefined")sig="";if(typeof(fInsrtOrdr)=="undefined")fInsrtOrdr="";if(typeof(cn_rem_escp_char)!="undefined"){if(as!=""){as=""+as;as=cn_rem_escp_char(as);}
if(pln!=""){pln=""+pln;pln=cn_rem_escp_char(pln);}}
if(symp==""&&as==""&&pln=="")return;var url="requestHandler.php";var p={"elem_formAction":"setApPolFU","symp":symp,"as":as,"pln":pln,"idOdrset":idOdrset,"idOdr":idOdr,"a_n":a_n,"site":site,"sig":sig,"fInsrtOrdr":fInsrtOrdr};if(typeof(setProcessImg)!='undefined')setProcessImg("1","follow_up");$.post(url,p,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","follow_up");if(data){var a,b,c;for(var z in data){a=$.trim(data[z]['number']);b=$.trim(data[z]['time']);c=$.trim(data[z]['visit_type']);d=$.trim(data[z]['provider']);if(typeof(a)=="undefined"||a=="undefined"){a="";}
if(typeof(b)=="undefined"||b=="undefined"){b="";}
if(typeof(c)=="undefined"||c=="undefined"){c="";}
if(a!=""||b!=""||c!=""){fu_addOpts(""+a,""+b,""+c,""+d);}}}},"json");}
function addAssessPlanRow(assessment,plan,eye,dx,ordrids,afill){assessment=((typeof assessment!="undefined")&&($.trim(assessment)!=""))?""+assessment:"";plan=((typeof plan!="undefined")&&($.trim(plan)!=""))?""+plan+"":"";dx=((typeof dx!="undefined")&&($.trim(dx)!=""))?""+dx+"":"";var oAssessTbl=$("#assessplan");var lastRow=$("#assessplan .planbox").length;var currRowId=lastRow+1;lenAssess=currRowId;var tOu=tOd=tOs="";if(eye=="OU"){tOu=" checked=\"checked\" ";}else if(eye=="OD"){tOd=" checked=\"checked\" ";}else if(eye=="OS"){tOs=" checked=\"checked\" ";}
var str=""+"<div class=\"planbox\">"+" <div class=\"row planchoose ap_eye_removed\" >"+"  <div class=\"col-lg-3 col-md-3 col-sm-5 \">"+"   <ul>"+"   <li class=\"ouc\"><input name=\"elem_apOu[]\" id=\"elem_apOu"+currRowId+"\" type=\"checkbox\" value=\""+currRowId+"\" onclick=\"setApEye(this,0)\"  onfocus=\"setApEye(this,1)\"  /><label for=\"elem_apOu"+currRowId+"\"></label></li>"+"   <li class=\"odc\"><input name=\"elem_apOd[]\" id=\"elem_apOd"+currRowId+"\" type=\"checkbox\" value=\""+currRowId+"\" onclick=\"setApEye(this,0)\"  onfocus=\"setApEye(this,1)\"  /><label for=\"elem_apOd"+currRowId+"\"></label></li>"+"   <li class=\"osc\"><input name=\"elem_apOs[]\" id=\"elem_apOs"+currRowId+"\" type=\"checkbox\" value=\""+currRowId+"\" onclick=\"setApEye(this,0)\"  onfocus=\"setApEye(this,1)\"   /> <label for=\"elem_apOs"+currRowId+"\"></label></li>"+"   </ul>"+"  </div>"+" </div>"+" <div class=\"clearfix ap_eye_removed\"></div>"+" <div class=\"row planform\" >"+"  <div class=\"col-lg-1 col-md-1 col-sm-1 col-lg-1-sn col-md-1-sn col-sm-1-sn\" >"+"   <div class=\"planchoose\">"+"   <div class=\"counter ap_num\" onClick=\"ap_adjt("+currRowId+", this);\" >"+currRowId+"</div>"+"   </div>"+"  </div>"+"  <div class=\"col-lg-1 col-md-1 col-sm-1 col-lg-1-opt col-md-1-opt col-sm-1-opt\" > "+"   <div class=\"planchoose\">"+"   <ul class=\"ul_ne\"> "+"   <li class=\"ne\"><div class=\"checkboxO\"><input type=\"checkbox\" name=\"elem_apnc[]\" id=\"no_change_"+currRowId+"\" value=\""+currRowId+"\" onClick=\"chkSelection('"+currRowId+"', this);\"  /><label for=\"no_change_"+currRowId+"\">NE</label></div></li>   "+"   <li class=\"res\"><div class=\"checkboxO\"><input name=\"elem_apres[]\" id=\"elem_resolve"+currRowId+"\" type=\"checkbox\" value=\""+currRowId+"\" onClick=\"chkSelection('"+currRowId+"', this);\"  /><label for=\"elem_resolve"+currRowId+"\">RES</label></div></li> "+"   </ul>"+"   </div>"+"  </div>"+"  <div class=\"col-lg-4 col-md-4 col-sm-7 col-lg-4-as col-md-4-as col-sm-7-as \">"+"  <div class=\"row\">"+"  <div class=\"col-sm-12\">"+"  <textarea name=\"elem_assessment[]\" rows=\"3\" id=\"elem_assessment"+currRowId+"\" onkeyup=\"setTaPlanHgt("+currRowId+");\"  onchange=\"checkConsolePlan(this,'"+currRowId+"');getForthAssess();\" class=\"form-control  \" onclick=\"showICD10CodeModifier(this)\" tabindex=\"1\"   >"+assessment+"</textarea> "+"  </div>"+"  <div class=\"col-sm-1 hidden \">"+"  <select name=\"el_amst_site[]\" id=\"el_amst_site"+currRowId+"\" class=\"form-control \" onchange=\"setApEye(this,2)\"><option></option>"+"   <option value=\"OU\"  >OU</option>"+"   <option value=\"OD\"  >OD</option>"+"   <option value=\"OS\"  >OS</option>"+"  </select>"+"  </div>"+"  </div>"+"  </div>"+"  <div class=\"col-lg-1 col-md-1 col-sm-2 col-lg-1-dx col-md-1-dx col-sm-2-dx\">"+"  <textarea  class=\" form-control dx \" rows=\"3\"  onkeyup=\"setTaPlanHgt("+currRowId+");\" name=\"elem_assessment_dxcode[]\" id=\"elem_assessment_dxcode"+currRowId+"\" tabindex=\"5\" onblur=\"checkDXCodesChart(this);setTaPlanHgt("+currRowId+");getForthAssess();\" onfocus=\"setCursorAtEnd(this);\"    >"+dx+"</textarea> "+"  </div>"+"  <div class=\"col-lg-4 col-md-4 col-sm-12 col-lg-4-pl col-md-4-pl col-sm-12-pl\">"+"  <textarea  name=\"elem_plan[]\" rows=\"3\" id=\"elem_plan"+currRowId+"\" onkeyup=\"setTaPlanHgt("+currRowId+");\" onchange=\"setTaPlanHgt("+currRowId+");\"  data-elem_CFPlan=\"\" class=\"  form-control plantext\" tabindex=\"5\"   >"+plan+"</textarea>"+"  </div>"+"  <div class=\"col-lg-1 col-md-1 col-sm-1 col-lg-1-x col-md-1-x col-sm-1-x\"> "+"   <span class=\"glyphicon glyphicon-remove\" alt=\"Delete\" onclick=\"reset_assessment('ap_elem_assessment"+currRowId+"');\"></span>"+"  </div>"+" </div>"+"<input name=\"elem_apConMeds[]\" id=\"elem_apConMeds"+currRowId+"\" type=\"hidden\" value=\"\" /> "+"<input name=\"elem_problist_id_assess[]\" id=\"elem_problist_id_assess"+currRowId+"\" type=\"hidden\" value=\"\" /> "+"<input name=\"elem_assessment_typeAhead"+currRowId+"\" id=\"elem_assessment_typeAhead"+currRowId+"\"  type=\"hidden\" value=\"\" /> "+"<input name=\"el_pt_ap_id[]\" id=\"el_pt_ap_id"+currRowId+"\" type=\"hidden\" value=\"\" />"+"</div>"+"<div class=\"clearfix\"></div>";$(str).insertBefore("#assessplan .addbut");sb_addTypeAhead();cn_typeahead();if(typeof(ordrids)!="undefined"&&ordrids!=""){attachOrder2Chart(currRowId,ordrids);}
if(typeof(afill)!="undefined"&&afill==1&&dx!=""){fill_dx_ases(currRowId,dx);}}
function fill_dx_ases(currRowId,dx,dxid){var o=$("#elem_assessment"+currRowId);var c=o.val();if(dx==""||o.length<=0||(typeof(c)!="undefined"&&$.trim(c)!="")){return;}
$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=getDxAses&dx="+encodeURIComponent(dx)+"&dxid="+dxid,function(d){if(typeof(d)!="undefined"&&$.trim(d)!=""){$("#elem_assessment"+currRowId).val(d);}});}
function addAssessOption(assessment,plan,fRem,eye,fRemPlan,dx,ordrids,apnum,dxid){if(typeof(asmt_sep_multi_dx_code)=="undefined"){asmt_sep_multi_dx_code=0;}
if(asmt_sep_multi_dx_code==1&&typeof(dx)!="undefined"&&dx!=""&&(dx.indexOf(",")!=-1||dx.indexOf(";")!=-1)){if(dx.indexOf(",")!=-1){var ardx=dx.split(",");}else if(dx.indexOf(";")!=-1){var ardx=dx.split(";");}
if(ardx.length>1){var ardxId=(typeof(dxid)!="undefined"&&dxid!="")?dxid.split(","):[];for(var x=0;x<ardx.length;x++){dxid=(typeof ardxId[x]!="undefined"&&$.trim(ardxId[x])!="")?ardxId[x]:"";if(x==0){addAssessOptionExe(assessment,plan,fRem,eye,fRemPlan,ardx[x],ordrids,apnum,0,dxid);}
else{if($.trim(ardx[x])!=""){addAssessOptionExe("",plan,fRem,eye,fRemPlan,ardx[x],'',apnum,1,dxid);}}}}}else{addAssessOptionExe(assessment,plan,fRem,eye,fRemPlan,dx,ordrids,apnum,0,dxid);}}
function addAssessOptionExe(assessment,plan,fRem,eye,fRemPlan,dx,ordrids,apnum,afill,dxid){var flg_auto_fill=0;if(typeof(dx)!="undefined"&&$.trim(dx)!=""&&typeof(afill)!="undefined"&&afill==1){flg_auto_fill=1;if(isDxAlreadyAdded(dx,dxid)){return;}}
if(($.trim(assessment)=="undefined"||$.trim(assessment)==""||typeof(assessment)=="undefined")&&($.trim(plan)=="undefined"||$.trim(plan)==""||typeof(plan)=="undefined")&&(flg_auto_fill==0)){return;}
var ar=["Ou","Od","Os"];if(typeof apnum!='undefined'&&apnum!=''){var obj={"Flag":true,"AddedIndx":apnum};}
else{var obj=isAssessAlreadyAdded(assessment,'',dx,dxid);}
if(obj.Flag)
{var oAssess=gebi("elem_assessment"+obj.AddedIndx);var oPlan=gebi("elem_plan"+obj.AddedIndx);var oDx=gebi("elem_assessment_dxcode"+obj.AddedIndx);if((typeof fRem!="undefined")&&(fRem==true)){if(oAssess&&oPlan){oAssess.value="";oPlan.value="";oDx.value="";$(oDx).data("dxid","");$("#elem_apOu"+obj.AddedIndx).prop("checked",false);$("#elem_apOd"+obj.AddedIndx).prop("checked",false);$("#elem_apOs"+obj.AddedIndx).prop("checked",false);if(typeof oPlan.onkeyup=="function"){oPlan.onkeyup();}}}else{if(oAssess&&oPlan){var indx=assessment.indexOf(";");if(indx!=-1){var chk_as=oAssess.value;indx=parseInt(indx)+1;var as_com=assessment.substr(indx);var ar_as_com=as_com.split(",");var ar_lids_as=["Right Lower Lid","Left Upper Lid","Left Lower Lid","Right Upper Lid","Left Eye","Right Eye","Both Eyes"];var l=ar_lids_as.length;for(var x=0;x<l;x++){var t_ad=""+ar_lids_as[x];if(typeof(t_ad)!="undefined"&&t_ad!="undefined"&&t_ad!=""){if(as_com.indexOf(t_ad)!=-1){if(chk_as.indexOf(t_ad)==-1){if(chk_as.indexOf(";")==-1){chk_as=chk_as+"; ";}else{chk_as=chk_as+", ";}
chk_as=chk_as+t_ad;}}else{if(chk_as.indexOf(t_ad)!=-1){chk_as=chk_as.replace(t_ad+", ","");chk_as=chk_as.replace(t_ad,"");chk_as=$.trim(chk_as);}}}}
chk_as=chk_as.replace(";,",";");oAssess.value=chk_as;}
if((typeof plan!="undefined")&&($.trim(plan)!="")){if(typeof(fRemPlan)!="undefined"&&fRemPlan==1){if($.trim(oPlan.value)!=""){var plan_old=plan.replace("\u00AD","");var del_from_start=plan.indexOf("\u00AD")!=-1?1:0;if(""+oPlan.value.toLowerCase().indexOf(""+plan.toLowerCase()+"\n")!=-1){oPlan.value=oPlan.value.replace(""+plan+"\n","");}else if(""+oPlan.value.toLowerCase().indexOf(""+plan_old.toLowerCase()+"\n")!=-1){oPlan.value=oPlan.value.replace(""+plan_old+"\n","");}else if(""+oPlan.value.toLowerCase().indexOf(""+plan.toLowerCase())!=-1){oPlan.value=oPlan.value.replace(""+plan,"");}else if(""+oPlan.value.toLowerCase().indexOf(""+plan_old.toLowerCase()+"")!=-1){if(del_from_start==1){if(""+oPlan.value.toLowerCase().indexOf("\n"+plan.toLowerCase()+"")!=-1){oPlan.value=oPlan.value.replace(""+plan+"","");}else{var reg_pln=rgp("^"+plan_old+"\n",'i');var mtch=oPlan.value.toLowerCase().match(reg_pln);if(mtch){oPlan.value=oPlan.value.replace(reg_pln,"");}else{if(oPlan.value.toLowerCase()==plan_old.toLowerCase()){oPlan.value=oPlan.value.replace(plan_old,"");}}}}
else{oPlan.value=oPlan.value.replace(""+plan_old+"","");}}}}else{plan=plan.replace("\u00AD","");if(oPlan.value.indexOf(plan)==-1){if(typeof(oPlan.value)!="undefined"&&oPlan.value!=""){oPlan.value+="\n";}
oPlan.value+=""+plan+"\u00AD";}}}else{oPlan.value+="";}
oPlan.value=$.trim(oPlan.value);oPlan.value=oPlan.value.replace(/^\n+|\n+$|^\u00AD+|^\r+|\r+$/g,"");if(typeof dx!="undefined"&&$.trim(dx)!=""){oDx.value=""+dx;$(oDx).data("dxid",dxid);if(dx.indexOf("-")!=-1){$(oDx).addClass("mandatory");show_asmt_site($(oDx),dx);}else{$(oDx).triggerHandler("blur");}}
if(typeof oPlan.onkeyup=="function"){oPlan.onkeyup();}
if(typeof(ordrids)!="undefined"&&ordrids!=""){attachOrder2Chart(obj.AddedIndx,ordrids);}}}
var teye="";if(eye.indexOf("RLL")!=-1||eye.indexOf("RUL")!=-1){teye="OD";}
if(eye.indexOf("LLL")!=-1||eye.indexOf("LUL")!=-1){if(eye.indexOf("RLL")!=-1||eye.indexOf("RUL")!=-1){teye="OU";}
else{teye="OS";}}
if(teye!=""){eye=teye;}
for(var x in ar){if(eye=="def")continue;var oEye=gebi("elem_ap"+ar[x]+obj.AddedIndx);if(oEye){if(oAssess.value!=""&&ar[x].toUpperCase()==eye.toUpperCase()){oEye.checked=true;}else{oEye.checked=false;}}}
getForthAssess();return;}
if(obj.EmptyIndx!=0){var oAssess=gebi("elem_assessment"+obj.EmptyIndx);var oPlan=gebi("elem_plan"+obj.EmptyIndx);var oDx=gebi("elem_assessment_dxcode"+obj.EmptyIndx);if(oAssess&&oPlan){oAssess.value=assessment;oPlan.value=((typeof plan!="undefined")&&($.trim(plan)!=""))?plan+"":"";if(typeof oPlan.onkeyup=="function"){oPlan.onkeyup();}
var teye="";if(eye.indexOf("RLL")!=-1||eye.indexOf("RUL")!=-1){teye="OD";}
if(eye.indexOf("LLL")!=-1||eye.indexOf("LUL")!=-1){if(eye.indexOf("RLL")!=-1||eye.indexOf("RUL")!=-1){teye="OU";}
else{teye="OS";}}
if(teye!=""){eye=teye;}
for(var x in ar){var oEye=gebi("elem_ap"+ar[x]+obj.EmptyIndx);if(oEye){if(ar[x].toUpperCase()==eye.toUpperCase()){oEye.checked=true;}else{oEye.checked=false;}}}
if((typeof dx!="undefined")&&($.trim(dx)!="")){dx=dx+"";dxid=((typeof dxid!="undefined")&&($.trim(dxid)!=""))?dxid:"";}else{dx="";dxid="";}
oDx.value=dx;$(oDx).data("dxid",dxid);if(typeof oDx.onblur=="function"){if(dx.indexOf("-")!=-1){$(oDx).addClass("mandatory");show_asmt_site($(oDx),dx);}else{$(oDx).triggerHandler("blur");}}
if(typeof(ordrids)!="undefined"&&ordrids!=""){attachOrder2Chart(obj.EmptyIndx,ordrids);}
if(typeof(afill)!="undefined"&&afill==1&&dx!=""){fill_dx_ases(obj.EmptyIndx,dx,dxid);}
$(oAssess).parents(".planbox").show();}}else{addAssessPlanRow(assessment,plan,eye,dx,ordrids,afill);}
getForthAssess();}
function showMultiAp_exe(val,num){if(!num){return;}
var oDiv=document.getElementById("div_plan_ap_show_2");if(oDiv){if(val==1){var oIfrm=top.fmain;var flagNum=false;var strAPExist="";var oAps=document.getElementsByName("elem_apAs[]");var lenAps=(oAps!=null)?oAps.length:0;for(var i=0;i<lenAps;i++){if(oAps[i].checked==true){var strAssess=""+oAps[i].value;var strPlan="";var oPlans=document.getElementsByName("elem_apPlan_"+i+"[]");var lenPlans=(oPlans!=null)?oPlans.length:0;for(var j=0;j<lenPlans;j++){if(oPlans[j].checked){strPlan+=(strPlan!="")?"\n":"";strPlan+=""+oPlans[j].value;}}
var oChkAses=isAssessAlreadyAdded(strAssess);if(oChkAses.Flag==false){if(flagNum==false){flagNum=true;var oTmpAsses=oIfrm.document.getElementById("elem_assessment"+num);var oTmpPlan=oIfrm.document.getElementById("elem_plan"+num);if(oTmpAsses){oTmpAsses.value=""+strAssess;}
if(oTmpPlan){oTmpPlan.value=""+strPlan;if(typeof oTmpPlan.onchange=="function"){oTmpPlan.onchange();}
if(typeof oTmpPlan.onkeyup=="function"){oTmpPlan.onkeyup();}}}else{oIfrm.addAssessOption(strAssess,strPlan);}}else{strAPExist+="<br/>  -"+strAssess+"";}}}
if(strAPExist!=""){top.fAlert("Following assessments are already exits:--<br/>"+strAPExist);}
var orderSetObj=document.getElementsByName("elem_order_set[]");var order_set_val_arr=Array();for(o=0,oi=0;o<orderSetObj.length;o++){if(orderSetObj[o].checked==true){var order_set_id=orderSetObj[o].value;var orderString=order_set_id;var ordersObj=document.getElementsByName("elem_orders["+order_set_id+"][]");var order_id_arr=Array();for(or=0;or<ordersObj.length;or++){if(ordersObj[or].checked==true){order_id_arr[or]=ordersObj[or].value;}
else{order_id_arr[or]='';}}
var order_id_str=order_id_arr.join(', ');if(order_id_str!=''){orderString+='__'+order_id_str;}
var orders_options_obj=document.getElementsByName("elem_orders_options["+order_set_id+"][]");var orders_options_arr=Array();for(or=0;or<orders_options_obj.length;or++){if(orders_options_obj[or].checked==true){orders_options_arr[or]=orders_options_obj[or].value;}
else{orders_options_arr[or]='';}}
var orders_options_str=orders_options_arr.join(', ');if(orders_options_arr!=''){orderString+='__'+orders_options_arr;}
order_set_val_arr[oi]=orderString;oi++;}}
var order_set_val_str=order_set_val_arr.join('---');}
oDiv.style.display="none";}}
function showMultiAp(str,num){$("#div_plan_ap_show_2").remove();var str1="<div id=\"div_plan_ap_show_2\">"+"<div>"+str+"</div>"+"<input type=\"button\" class=\"dff_button\" id=\"btnSMP_ok\" onClick=\"showMultiAp_exe('1',"+num+")\" value=\"OK\"/> "+"<input type=\"button\" class=\"dff_button\" id=\"btnSMP_close\" onClick=\"showMultiAp_exe('0',"+num+")\" value=\"Close\"/>"+"</div>";$("body").append(""+str1);$("#div_plan_ap_show_2").show();}
function check4DxDesc(obj,num){var str="";if(obj&&(typeof obj.value!="undefined")){str=obj.value;}
if(str==""||num==""){return;}
var oElemPlan=gebi("elem_plan"+num);if(oElemPlan==null){return;}
var url=zPath+"/chart_notes/requestHandler.php";var params="elem_formAction=getDxAP";params+="&elem_dxCode="+str;if(typeof(setProcessImg)!='undefined')setProcessImg("1",""+obj.id);$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0",""+obj.id);var xmlDoc=data;var str="";var cPlans=0;var tmpAssess="";var tmpPlan="";var oAllAp=xmlDoc.getElementsByTagName("allap")[0];var oAps=(oAllAp!=null)?oAllAp.childNodes:null;var lenAps=(oAps!=null)?oAps.length:0;var chk=false;for(var i=0;i<lenAps;i++){var oData=oAps[i];if(oData.firstChild){if(oData.nodeName=="ap"){str+="<tr valign=\"top\" align=\"left\" >";var oApCn=oData.childNodes;var lenApcn=(oApCn!=null)?oApCn.length:0;for(var k=0;k<lenApcn;k++){var ofData=oApCn[k];if(ofData.firstChild){if(ofData.nodeName=="ases"){str+="<td colspan='2'><input type=\"checkbox\" name=\"elem_apAs[]\" value=\""+ofData.firstChild.data+"\">"+ofData.firstChild.data+"</td>";tmpAssess=""+ofData.firstChild.data;}else if(ofData.nodeName=="plans"){var strPlan="<table>";var oPlans=(ofData!=null)?ofData.childNodes:null;var lenPlans=(oPlans!=null)?oPlans.length:0;for(var j=0;j<lenPlans;j++){var oPlan=oPlans[j];if(oPlan.firstChild){strPlan+="<tr><td><input type=\"checkbox\" name=\"elem_apPlan_"+i+"[]\" value=\""+oPlan.firstChild.data+"\">"+oPlan.firstChild.data+"</td></tr>";tmpPlan=""+oPlan.firstChild.data;cPlans++;}}
strPlan+="</table>";str+="<td>"+strPlan+"</td>";}}}
str+="</tr>";}
if(oData.nodeName=="order_dx"){if(chk==false){chk=true;str+="<tr class=\"txt_10b\"><td colspan=\"3\">Order set associate with Assessment</td></tr>";str+="<tr class=\"txt_10b\">";str+="<td width='100'>Order set</td>";str+="<td width='100'>Orders</td>";str+="<td width='100'>Order set options</td>";str+="</tr>";}
str+="<tr valign=\"top\">";var oApCn=oData.childNodes;var lenApcn=(oApCn!=null)?oApCn.length:0;for(var k=0;k<lenApcn;k++){var ofData=oApCn[k];if(ofData.firstChild){if(ofData.nodeName=="order_set_id"){var order_set_id=ofData.firstChild.data;}
else if(ofData.nodeName=="order_set"){str+="<td width='100'><input type=\"checkbox\" name=\"elem_order_set[]\" value=\""+order_set_id+"\" checked=\"checked\">"+ofData.firstChild.data+"</td>";tmpAssess=""+ofData.firstChild.data;}
else if(ofData.nodeName=="order"){var strPlan="<table>";var oPlans=(ofData!=null)?ofData.childNodes:null;var lenPlans=(oPlans!=null)?oPlans.length:0;for(var j=0;j<lenPlans;j++){var oPlan=oPlans[j];if(oPlan.firstChild){if(oPlan.nodeName=="orders_id"){var order_id=oPlan.firstChild.data;}
else{strPlan+="<tr><td><input type=\"checkbox\" name=\"elem_orders["+order_set_id+"][]\" value=\""+order_id+"\" checked=\"checked\">"+oPlan.firstChild.data+"</td></tr>";tmpPlan=""+oPlan.firstChild.data;cPlans++;}}}
strPlan+="</table>";str+="<td width='100'>"+strPlan+"</td>";}
else if(ofData.nodeName=="set_options"){var strPlan="<table width='100'>";var oPlans=(ofData!=null)?ofData.childNodes:null;var lenPlans=(oPlans!=null)?oPlans.length:0;for(var j=0;j<lenPlans;j++){var oPlan=oPlans[j];if(oPlan.firstChild){if(oPlan.nodeName=="order_set_options"){strPlan+="<tr><td><input type=\"checkbox\" name=\"elem_orders_options["+order_set_id+"][]\" value=\""+oPlan.firstChild.data+"\" checked=\"checked\">"+oPlan.firstChild.data+"</td></tr>";cPlans++;}}}
strPlan+="</table>";str+="<td width='100'>"+strPlan+"</td>";}}}
str+="</tr>";}}}
if(tmpAssess!=""){if(cPlans>1){str="<table width=\"100%\" border=\"0\">"+"<tr><td colspan='2'><b>Assessment</b></td><td><b>Plan</b></td></tr>"+
str+"</table>";var ctop=top;if(top.fmain){ctop=top.fmain;}
ctop.showMultiAp(str,num);}else{obj.value=""+tmpAssess;oElemPlan.value=""+tmpPlan;}}},"xml");}
function setAssessOption_v2(indx,fRem){if(indx=="1"){if($(":checked[id*=el_chk_as_]").length>0){$(":checked[id*=el_chk_as_]").each(function(indx){var x=this.id;var y=x.replace(/el_chk_as_/,"el_chk_pl_");var as=""+this.value;var pln="";$(":checked[id*="+y+"]").each(function(indx2){pln+=""+this.value+"\n";});var z=x.replace(/el_chk_as_/,"el_td_dx_");var dx=$.trim(""+$("#"+z).html());var dxid=$("#"+z).data("dxid");var z1=x.replace(/el_chk_as_/,"el_chk_site_");var site=$.trim(""+$("#"+z1).val());site=site||"";var to_do_id=$(this).data("to_do_id");if(as!=""||pln!=""){addAssessOption(as,""+pln,fRem,site,"",dx,'','',dxid);if(typeof(to_do_id)!="undefined"&&to_do_id!=""){setApPolFU("to_do_id",to_do_id);}}});}else{top.fAlert("Please select any assessment!");return;}}
hide_modal("div_sel_assess_for_symp");}
var setAssessOption_c=0;function setAssessOption(symp,fRem,sEye,flgPop,cnslid){if(typeof(symp)=="undefined"){symp="";}
if(typeof(cnslid)=="undefined"){cnslid="";}
if((symp&&symp!="")||(cnslid&&cnslid!="")){var symp1=""+symp;var icd_code_10=(""+$("#hid_icd10").val()=="1")?"1":"0";var dos=$("#elem_dos").val();var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=GetAssessOption&symp="+encodeURIComponent(symp)+"&icd_code_10="+icd_code_10+"&eye="+sEye+"&cnslid="+cnslid+"&dos="+dos;$.get(url,function(data){if(data&&data.length>0){if(data.length>1){var symp_var=symp.replace(/\W+/g,"");var str_sel_htm="";for(var ww in data){if(data[ww].assess||data[ww].plan){var tAssess="",tPlan="",tDx="",tDxId="",tpu="",tapsite="",tto_do_id="",tdxas="";tAssess=""+$.trim(data[ww].assess);tPlan=""+$.trim(data[ww].plan);obj2=isApPlansMulti(tPlan);tDx=""+$.trim(data[ww].dxcode);tDxId=""+$.trim(data[ww].dxId);tpu=data[ww].pu||"";tapsite=""+$.trim(data[ww].ap_site);if(tapsite==""){tapsite=""+sEye;}
tto_do_id=""+$.trim(data[ww].to_do_id);tdxas=$.trim(data[ww].asmt_com);if(typeof(tdxas)!="undefined"&&tdxas!=""){tAssess=tAssess+"; "+tdxas;}
if(tpu!=""){symp_var=symp_var+setAssessOption_c;setAssessOption_c++;if(obj2.lenk==true){tPlan="";for(var zx in obj2.arr){var t=$.trim(obj2.arr[zx]);if(t!=""){tPlan+="<input type=\"checkbox\" id=\"el_chk_pl_"+setAssessOption_c+"_"+zx+"\" value=\""+t+"\" ><label for=\"el_chk_pl_"+setAssessOption_c+"_"+zx+"\" >"+t+"</label><br/>";}}}else if(tPlan!=""){var t=tPlan;tPlan="";tPlan="<input type=\"checkbox\" id=\"el_chk_pl_"+setAssessOption_c+"_0\" value=\""+t+"\" ><label for=\"el_chk_pl_"+setAssessOption_c+"_0\" >"+t+"</label><br/>";}
str_sel_htm+="<tr valign=\"top\">"+"<td><input type=\"checkbox\" id=\"el_chk_as_"+setAssessOption_c+"\" value=\""+tAssess+"\" data-to_do_id=\""+tto_do_id+"\" >"+"<label for=\"el_chk_as_"+setAssessOption_c+"\">"+tAssess+"</label>"+"<input type=\"hidden\" id=\"el_chk_site_"+setAssessOption_c+"\" value=\""+tapsite+"\" ></td>"+"<td id=\"el_td_pl_"+setAssessOption_c+"\">"+tPlan+"</td>"+"<td id=\"el_td_dx_"+setAssessOption_c+"\" data-dxid=\""+tDxId+"\">"+tDx+"</td></tr>";}else{var obj2=isApPlansMulti(tPlan);if(obj2.lenk==true||flgPop>1){addAssessOption(tAssess,"",fRem,tapsite,"",tDx,'','',tDxId);}else{addAssessOption(tAssess,tPlan,fRem,tapsite,"",tDx,'','',tDxId);}
if(typeof(tto_do_id)!="undefined"){setApPolFU("to_do_id",tto_do_id);}}}}
if(str_sel_htm!=""){var ar_clr_symp=symp.split("!~!");var clr_symp=ar_clr_symp[0];str_sel_htm="<div>"+"<table class=\"table table-responsive table-striped\" ><tr><td>Assessment</td><td>Plan</td><td>Dx code</td>"+"</tr>"+str_sel_htm+"</table>"+"</div>";if($("#div_sel_assess_for_symp").length<=0){str_sel_htm=" <div id=\"div_sel_assess_for_symp\" class=\"modal fade\" role=\"dialog\">"+"<div class=\"modal-dialog\">"+"<div class=\"modal-content\">"+"<div class=\"modal-header\">"+"<button type=\"button\" class=\"close\" data-dismiss=\"modal\" onclick=\"setAssessOption_v2(0)\"></button>"+"<h4 class=\"modal-title\">Select assessments and plans for symptom: "+clr_symp+"</h4>"+"</div>"+"<div class=\"modal-body con frcb\">"+
str_sel_htm+"</div>"+"<div class=\"modal-footer text-center\">"+"<button type=\"button\" class=\"btn btn-success\"  name=\"el_dsafs_btn_done\" onclick=\"setAssessOption_v2(1,'"+fRem+"')\">Done</button>"+"<button type=\"button\" class=\"btn btn-danger\" data-dismiss=\"modal\" name=\"el_dsafs_btn_cancel\" onclick=\"setAssessOption_v2(0)\">Cancel</button>"+"</div>"+"</div>"+"</div>"+"</div>";$("body").append(str_sel_htm);$("#div_sel_assess_for_symp").draggable({handle:".modal-header"});$("#div_sel_assess_for_symp").modal({show:true,backdrop:false});}else{$("#div_sel_assess_for_symp .con").children("div").last().after(str_sel_htm);$("#div_sel_assess_for_symp").draggable({handle:".modal-header"});$("#div_sel_assess_for_symp").modal({show:true,backdrop:false});}
$("input[id*=el_chk_pl_]").bind("click",function(){$(this).parents("tr").find("input[id*=el_chk_as]").prop("checked",true);});}}else{if(data[0].assess||data[0].plan){var tAssess=$.trim(data[0].assess);var tPlan=$.trim(data[0].plan);var tDx=""+$.trim(data[0].dxcode);var tDxId=""+$.trim(data[0].dxId);tapsite=""+$.trim(data[0].ap_site);if(tapsite==""){tapsite=""+sEye;}
var tto_do_id=""+$.trim(data[0].to_do_id);var tdxas=$.trim(data[0].asmt_com);if(typeof(tdxas)!="undefined"&&tdxas!=""){if(tAssess.indexOf(";")==-1){tAssess=tAssess+"; ";}else{tAssess=tAssess+", ";}
tAssess=tAssess+""+tdxas;}
var obj2=isApPlansMulti(tPlan);if(obj2.lenk==true||flgPop>1){addAssessOption(tAssess,"",fRem,tapsite,"",tDx,'','',tDxId);}else{addAssessOption(tAssess,tPlan,fRem,tapsite,"",tDx,'','',tDxId);}
if(typeof(tto_do_id)!="undefined"){setApPolFU("to_do_id",tto_do_id);}}}}},"json");}}
function setApEye(o,focs){if(focs==2){var ind=$(o)[0].id.replace(/el_amst_site/,"");var v=$(o).val();$("#elem_apOu"+ind+", #elem_apOd"+ind+", #elem_apOs"+ind).prop("checked",false);if(v=="OU"){$("#elem_apOu"+ind).prop("checked",true);}else if(v=="OD"){$("#elem_apOd"+ind).prop("checked",true);}else if(v=="OS"){$("#elem_apOs"+ind).prop("checked",true);}}}
function setExamDescChange(obj,v2){if(v2==1){obj.className=obj.className.replace("bgSmoke","");}else{var oCIn=gebi(obj.name+"_changed");if(oCIn){oCIn.value="1";$(obj).unbind("change",setExamDescChange);if($(obj).val()!=""&&$(obj).parent().hasClass("bgWhite")==false){$(obj).parent().addClass("bgWhite");}}}}
function add_future_sch_tests_appoints(flg,eid,cnfrm){if(typeof(flg)!="undefined"&&flg!=""){if(flg==1){if(finalize_flag==1&&isReviewable!=1){top.fAlert("Please open a new chart note");return;}
var msg="";var test_check_flag=$.trim($(":checked[name=elem_fsta_test_appoint]").val());if($.trim(test_check_flag)==""){msg+="<li>Test or Appointment</li>";}
if(test_check_flag=="Test"){if($.trim($(":input[name=elem_fsta_test_name]").val())==""){msg+="<li>Test Name</li>";}
var tmp_testtype=$.trim($(":checked[name=elem_fsta_test_type]").val());if(tmp_testtype==""){msg+="<li>Test Type</li>";}}else if(test_check_flag=="Appointment"||test_check_flag=="Referral"){if($.trim($(":input[name=elem_fsta_phy_name]").val())==""){msg+="<li>Physician Name</li>";}}
if(msg!=""){top.fAlert("<b>Please fill in the following:</b><div class='m10'>"+msg+"</div>");return;}
var param=$("#frm_future_tests_extr").serialize();param+="&elem_dos="+$("#elem_dos").val();if(typeof(setProcessImg)!='undefined')setProcessImg(1,"frm_future_tests_extr");$.post("requestHandler.php",param,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"frm_future_tests_extr");add_future_sch_tests_appoints_processing(data);});}else if(flg==3){if(finalize_flag==1&&isReviewable!=1){top.fAlert("Please open a new chart note");return;}
var divtype=(eid=="2")?"div_saved_future_appoint_ref":"div_saved_future_tests";var delid="";$("#"+divtype+" :checked[name*=elem_FSTA_delid]").each(function(){delid+=this.value+",";})
if(delid==""){top.fAlert("Please check any record to delete.");}else{if(typeof(cnfrm)=="undefined"){top.fancyConfirm("Are you sure you want to delete?","","top.fmain.add_future_sch_tests_appoints('"+flg+"', '"+eid+"',true);");return;}
var strEdit="&elem_delid="+encodeURI(delid);if(typeof(setProcessImg)!='undefined')setProcessImg(1,"ft_appnt");$.get("requestHandler.php?elem_formAction=add_future_sch_tests_appoints"+strEdit,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"ft_appnt");add_future_sch_tests_appoints_processing(data);});}}else if(flg==0){hide_modal("div_add_future_tests");return;}}else{var strEdit="";if(typeof(eid)!="undefined"&&eid!=""){strEdit="&elem_showId="+eid;}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,"ft_appnt");if($("#div_add_future_tests").length>0){hide_modal("div_add_future_tests");}
$.get("requestHandler.php?elem_formAction=add_future_sch_tests_appoints"+strEdit,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"ft_appnt");add_future_sch_tests_appoints_processing(data);});}}
function add_future_sch_tests_appoints_processing(data,idpimg){if($("#div_add_future_tests").length>0){hide_modal("div_add_future_tests");setTimeout(function(){add_future_sch_tests_appoints_processing(data,idpimg);},500);return;}
$("body").append(""+data);$("#div_add_future_tests").modal("show");var dt=$("input[name=elem_fsta_sch_date]").val();if($.trim(dt)==""){dt=new Date();}
var dt_format=top.jQueryIntDateFormat;$("input[name=elem_fsta_sch_date]").datepicker().datepicker("option","dateFormat",dt_format).datepicker("setDate",dt);multiphy_typeahead(6);}
function set_future_sch_tests_options(val){var tmp="#dvFSTA_test";if(val=="Test"){$(tmp).show();}else{$(tmp).hide();}
tmp="#dvFSTA_loinc, #dvFSTA_cpt, #dvFSTA_snomed";if(val=="Referral"){$(tmp).hide();}else{set_future_sch_testsType_options();}}
function set_future_sch_testsType_options(){var tmp=$.trim($(":checked[name=elem_fsta_test_type]").val());var test_check_flag=$.trim($(":checked[name=elem_fsta_test_appoint]").val());$("#dvFSTA_loinc, #dvFSTA_cpt, #dvFSTA_snomed").hide();if(test_check_flag=="Test"){if(tmp=="Lab"||tmp==""){$("#dvFSTA_loinc").show();}
if(tmp=="Procedure"||tmp==""){$("#dvFSTA_cpt").show();}
if(tmp=="Imaging"||tmp==""){$("#dvFSTA_snomed").show();}}}
function lock_checkPass(mtd){var oIn=$("#elem_lockAdminPass");if(oIn.length&&($.trim(oIn.val())=="")){top.fAlert("Enter password.");return;}
oIn=$("#elem_lockAdminPass");var cTab=$("#elem_tab").val();if(mtd=="MD5"){oIn.val(md5($.trim(oIn.val())));}
else{oIn.val(Sha256.hash($.trim(oIn.val())));}
if(typeof(zPath)=="undefined"){zPath="";}
var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;var url=u+"/chart_notes/requestHandler.php";var params={"elem_formAction":"checkAdminPass4Lock","elem_lockAdminPass":""+oIn.val(),"elem_tab":""+cTab};$.post(url,params,function(data){if(data==1){if(typeof(funClosePopUpExe)!='undefined'){funClosePopUpExe();}
top.window.location.reload();}else{top.fAlert("Please enter correct password.");oIn.val("");oIn.focus();}});}
function lock_showPassPrompt(){var odiv=document.getElementById("divLockPassPrompt");var oIn=document.getElementById("elem_lockAdminPass");if(odiv){odiv.style.display="block";}
if(oIn){oIn.value="";oIn.focus();}
stopClickBubble();}
function showChartNotesTree(flg){if(flg!="2"&&flg!="1"&&flg!="srch"){if($("#sliderRight").length>0&&$("#sliderRight").attr("attrFilled")=="1"){$("body").trigger("click");return;}}
if(flg=="1"){update_toolbar_icon();}
var response="json";var url=zPath+"/chart_notes/requestHandler.php";var params="elem_formAction=chartNoteTree";if(flg=="srch"){var srchVal=gebi('elem_findSearch').value;var fndStatus='';if(gebi('elem_findStatus')){fndStatus=gebi('elem_findStatus').value;}
var fndPhy='';if(gebi('elem_findPhy')){fndPhy=gebi('elem_findPhy').value;}
params+="&elem_formAction_ptforms=Search";params+="&srchVal="+srchVal;params+="&fndStatus="+fndStatus;params+="&fndPhy="+fndPhy;$("#sec_exams,#sec_tests").html("Loading..");}else{params+="&elem_formAction_ptforms=chartNoteTree";}
$("#sliderRight").remove();$("body").append("<div id=\"sliderRight\">Loading...</div>");if(typeof(setProcessImg)=="function")setProcessImg("1","sliderRight");$.post(url,params,function(data){if(typeof(setProcessImg)=="function")setProcessImg("0","sliderRight");if(response=="text"){console.log(data);}
var tmp=""+data.innerHtml;if($("#sliderRight").length<=0){$("body").append("<div id=\"sliderRight\">Loading...</div>");}
$("#sliderRight").html(tmp).attr("attrFilled","1").bind("click",function(){stopClickBubble();});$('[data-toggle="tooltip"]').tooltip();if(typeof(data.is_test_uninterpreted)!="undefined"){is_test_uninterpreted=data.is_test_uninterpreted;highlight_pt_form_btn();}},response);}
function sl_showopts(obj){var tmp=$(obj).parent().parent().find("ul");if(tmp.css("display")=="none")tmp.show();else tmp.hide();stopClickBubble();}
var flgHMPE1=0;function handlerMainPageEvents(e){var etar=e.target;var chk=etar.nodeName;var chktag=etar.tagName;var eType=e.type;if(chk=="INPUT"||chk=="TEXTAREA"||((eType=="change"||eType=="keyup"||eType=="mousedown")&&chk=="SELECT")){var enm=e.target.name;var eid=e.target.id;if(e.target.type=="button")return;if(elem_per_vo=="1"){if(enm!="elem_lockAdminPass"&&enm!="elem_btnLock"){if($("#icoPtLock").length>0){$("#icoPtLock").triggerHandler('click');}else if(flgHMPE1==0){if($(etar).parents("#genHealthDiv_wv").length<=0){var t="You don't have permission to edit chart notes. ";top.fAlert(""+t);flgHMPE1=1;window.status="Note: "+t;setfinalizedFunction('',1);}}}
return;}
if(finalize_flag=='1'&&isReviewable=='1'){if(eid!="elem_ptTemplate"){checkAlert();}}
isFormChanged=1;if($(etar).parents("#Vision").length>0){if(enm!="clws_charges[]"){if($(etar).hasClass("active")==false){set_vis_el_active(etar);if($(etar).parents("#MR").length>0||$(etar).parents("#PC").length>0){if($(etar).parents(".prism,#pc3_prism,#mr3_prism").length>0){var eye=(enm.indexOf("Od")!=-1)?"Od":"Os";$(etar).parents(".prism,#pc3_prism,#mr3_prism").children(":input[name*="+eye+"]").each(function(){$(this).trigger("keyup");});}
if($(etar).parents("#MR").length>0){var vissectch=""+$("#elem_vis_section_touched").val();if(vissectch.indexOf("MR")==-1){$("#elem_vis_section_touched").val(vissectch+",MR");}}
if(enm.indexOf("OsAdd")!=-1&&$(etar).val()==""){var t=enm.replace("OsAdd","OdAdd");$(etar).val($("#"+t).val());}}}
if(enm.indexOf("elem_visMrO")!=-1||enm.indexOf("elem_mrNoneGiven")!=-1){add_opyia_assessment(enm,etar.value);}
if($(etar).parents("#div_lasik_common").length>0){$("#el_lasik_userid").val(authUserID);if(enm.indexOf("el_visLasikTrgtTime")!=-1){$("#"+enm).val(""+currenttime());}}}}
if($(etar).parents("#CVF").length>0){$("#CVF div.bggrey").removeClass("bggrey");}
if($(etar).parents("#AmslerGrid").length>0){ag_clear_grey_bg();}
if($(etar).parents("#dv_cn_progess_notes").length>0){if($(etar).hasClass("active")==false){$(etar).addClass("active");}}
if($(etar).prop("checked")&&$(etar).parents("#ft_strd_of_cr").length>0){var eid=$(etar).attr("id");if(eid.indexOf("el_soc")!=-1){$('#ft_strd_of_cr :checked').not("#"+eid).prop('checked',false);}}
if($(etar).parents("#assessplan,#detailDesc1,#detailDesc2,#divApPlan,.OrderDetail, #dialog-Mdc-cum-new-pt, #dv_cn_progess_notes").length>0){return;}
utElem_capture(e);if(eid=="elem_chk"||eid=="elem_ccompliant"){setTimeout(function(){if($(etar).is(":focus")){$(etar).addClass("mk_bigger_el").bind("blur",function(){$(etar).removeClass("mk_bigger_el");});}},2000);}
top.$("body").click();}else if(eType=="click"||eType=="touchstart"){if($(etar).parents("#ft_strd_of_cr").length>0){var eid=$(etar).attr("for");if(eid.indexOf("el_soc")!=-1){$('#ft_strd_of_cr :checked').not("#"+eid).prop('checked',false);}}
if(isiPad){if(($(etar).parents('#sliderRight').length>0)){setTimeout(function(){closePopUps();},500);}else if($(etar).parents('#div_rvs').length>0){}else{closePopUps();}}
else{closePopUps();}}}
function ag_clear_grey_bg(){$("#AmslerGrid div.bggrey").removeClass("bggrey");}
function clearMr(w,rem){if(typeof(rem)!="undefined"&&rem==1){$("#row_mr_"+w+", #row_mr_"+(w-1)).hide();return;}
var ar=new Array("elem_visMrOdP","elem_visMrOdPrism","elem_visMrOdSlash","elem_visMrOdSel1","elem_visMrOsP","elem_visMrOsPrism","elem_visMrOsSlash","elem_visMrOsSel1","elem_visMrOdS","elem_visMrOdC","elem_visMrOdA","elem_visMrOdAdd","elem_visMrOdTxt1","elem_visMrOdSel2","elem_visMrOdTxt2","elem_visMrOsS","elem_visMrOsC","elem_visMrOsA","elem_visMrOsAdd","elem_visMrOsTxt1","elem_visMrOsSel2","elem_visMrOsTxt2","elem_visMrDesc","elem_visMrOdSel2Vision","elem_visMrOsSel2Vision","elem_providerName","elem_providerId","elem_visMrPrismDesc_","elem_visMrOuTxt1","elem_mr_pres_dt_","elem_mrNoneGiven","elem_mr_type");var l=ar.length;for(var i=0;i<l;i++){var n=ar[i];if(((w>"1"))&&(n!="elem_visMrDesc")){n=(n.indexOf("Od")!=-1)?n.replace(/Od/,"OtherOd"):n;n=(n.indexOf("Os")!=-1)?n.replace(/Os/,"OtherOs"):n;n=(n.indexOf("Ou")!=-1)?n.replace(/Ou/,"OtherOu"):n;}
if((w>"1")&&(n=="elem_providerName"||n=="elem_providerId")){n+="Other";}
if((w>"2")&&(n!="elem_visMrDesc")){n=n+"_"+w;}
if((w>="2")&&(n=="elem_visMrDesc")){n="elem_visMrDescOther";}
if((w>"2")&&(n=="elem_visMrDescOther")){n="elem_visMrDescOther_"+w;}
if(n.indexOf("elem_visMrPrismDesc_")!=-1){n="elem_visMrPrismDesc_"+w;}
if(n.indexOf("elem_mr_pres_dt_")!=-1){n="elem_mr_pres_dt_"+w;}
if(n.indexOf("elem_mrNoneGiven")!=-1){n="elem_mrNoneGiven"+w;}
if(n.indexOf("elem_mr_type")!=-1){n="elem_mr_type"+w;}
var o=gebi(n);if(o){if(o.type=="checkbox"){o.checked=false;}else{if(o.value.indexOf("20/")<0){o.value="";}else{o.value="20/";}}}}}
function changeVisionStatus(){var obj=arguments[0];var e=window.event;if(e&&(typeof arguments[1]=="undefined")){obj=e.srcElement;}
var flg_frc=(typeof arguments[2]!="undefined"&&arguments[2]==1)?1:0;if(obj){var ev="click";if(typeof obj.type!="undefined"&&obj.type=="select-one"){ev="keyup";}
if(!$(obj).hasClass("active")||flg_frc==1){$(obj).trigger(ev);}}}
function setGivenMr(o,str){}
function showTranspose(indx,wh){var arreye=["Od","Os"];for(var x in arreye){var eye=arreye[x];if(typeof(wh)!="undefined"&&wh=="PC"){var sufx="";if(indx>"1"){sufx=""+indx;}
var vs="elem_visPc"+eye+"S"+sufx;var vc="elem_visPc"+eye+"C"+sufx;var va="elem_visPc"+eye+"A"+sufx;}else{var othr="";if(indx>"1"){othr="Other";}
var sufx="";if(indx>"2"){sufx="_"+indx;}
var vs="elem_visMr"+othr+eye+"S"+sufx;var vc="elem_visMr"+othr+eye+"C"+sufx;var va="elem_visMr"+othr+eye+"A"+sufx;}
var s=$("input[name="+vs+"]").val();s=$.trim(s);var c=$("input[name="+vc+"]").val();c=$.trim(c);var a=$("input[name="+va+"]").val();a=$.trim(a);if(s.toUpperCase()=="PLANO"){s="0";}
if(typeof(s)=="undefined"||s==""||isNaN(s)){continue;}
if(typeof(c)=="undefined"||c.toUpperCase()=="SPHERE"||c==""||isNaN(c)){continue;}
var sig_sc=parseFloat(s)+parseFloat(c);sig_sc=sig_sc.toFixed(2);if(""+sig_sc.indexOf("+")==-1&&""+sig_sc.indexOf("-")==-1){sig_sc="+"+sig_sc;}
var op_sign_c=(-1)*parseFloat(c);op_sign_c=""+op_sign_c.toFixed(2);if(""+op_sign_c.indexOf("+")==-1&&""+op_sign_c.indexOf("-")==-1){op_sign_c="+"+op_sign_c;}
if(typeof(a)!="undefined"&&a!=""&&!isNaN(a)){var new_axis=parseFloat(a)+90;if(new_axis<1||new_axis>180){new_axis=a-90;}}
if(isNaN(sig_sc)){sig_sc="";}
if(isNaN(op_sign_c)){op_sign_c="";}
if(isNaN(new_axis)){new_axis="";}
else if(new_axis!=""&&!isNaN(new_axis)){var t=""+new_axis;if(t.length<3){new_axis=(t.length==1)?"00"+new_axis:"0"+new_axis;}}
$("input[name="+vs+"]").val(sig_sc).triggerHandler("blur");$("input[name="+vc+"]").val(op_sign_c);$("input[name="+va+"]").val(new_axis);}
stopClickBubble();}
function checkValue(num,val){var c=$("input[type=checkbox][name*=elem_mrNoneGiven"+num+"]");if(c.prop("checked")==true&&c.hasClass("inact")){c.prop("checked",false);c.trigger('click');}
if(val!=""){if(val=="cycloplegic"){val="CR "+num;}
else if(val=="Over Refraction"){val="OR "+num;}
else if(val=="trial frame"){val="TF "+num;}
else if(val=="Final"){val="FR "+num;}
else if(val=="Outside Rx"){val="ORx "+num;}
$("#h2_mr_id"+num).html(val);}else{$("#h2_mr_id"+num).html("MR "+num);}}
function showPrescDtBox(indx,op){}
function mrOtherExe(objDiv,flag)
{if(typeof objDiv!="undefined")
{if(flag==true)
{objDiv.style.display="block";}
else
{objDiv.style.display="none";emptyPcValues(objDiv);}}}
function emptyPcValues(objDiv){var objElems=new Array();var objElemsInput=objDiv.getElementsByTagName("INPUT");var objElemsSelect=objDiv.getElementsByTagName("SELECT");if(objElemsInput.length>0){objElems=objElems.concat(objElemsInput);}
if(objElemsSelect.length>0){objElems=objElems.concat(objElemsSelect);}
var len=objElems[0].length;for(var i=0;i<len;i++)
{if((objElems[0][i].name.indexOf("elemHoriPosition")==-1)&&(objElems[0][i].name.indexOf("elemTargetName")==-1)){objElems[0][i].value="";}}}
function copyPcMr(ob){var v=$(ob).val();if(v==""){return;}
var ti=$(ob).data("mr"),t="MR",tdv="row_mr_",tprsmdv="";if(typeof(ti)=="undefined"){ti=$(ob).data("pc");t="PC";tdv="pc";tprsmdv="pc_ovr_ref_prism";}
if(v.indexOf(t)!=-1){var si=$.trim(v.replace(t,"")),sid,flgOpPrsm=0;$("#"+tdv+ti+" :input").each(function(){if(this.type=="text"||this.type=="select-one"||this.type=="textarea"||this.type=="checkbox"){sid="";if(t=="PC"){if(ti>1||this.type=="checkbox"){tsi=(si>1||this.id.indexOf("elem_visPcPrismDesc_")!=-1)?si:"";sid=this.id.replace(ti,tsi);}else{if(this.id.indexOf("elem_visPcPrismDesc_")!=-1){this.id="elem_visPcPrismDesc_";}
sid=this.id+si;}}else if(t=="MR"){if(ti>2){if(si>2){sid=this.id.replace(ti,si);}else if(si>1){if(this.id.indexOf("PrismDesc")!=-1||this.id.indexOf("elem_mr_pres_dt")!=-1||this.id.indexOf("elem_mr_type")!=-1||(this.id.indexOf("Other")==-1&&this.type=="checkbox")){sid=this.id.replace(ti,si);}
else{sid=this.id.replace("_"+ti,"");}}else{if(this.id.indexOf("PrismDesc")!=-1||this.id.indexOf("elem_mr_pres_dt")!=-1||this.id.indexOf("elem_mr_type")!=-1||(this.id.indexOf("Other")==-1&&this.type=="checkbox")){sid=this.id.replace(ti,si);}
else{sid=this.id.replace("_"+ti,"").replace("Other","");}}}else if(ti>1){if(si>2){sid=this.id+"_"+si;}else{sid=this.id.replace("Other","");}}else if(ti<=1){if(this.id.indexOf("PrismDesc")!=-1||this.id.indexOf("elem_mr_pres_dt")!=-1||this.id.indexOf("elem_mr_type")!=-1||this.id.indexOf("mrNoneGiven")!=-1){sid=this.id.replace(ti,si);}
else{sid=(this.id.indexOf("elem_visMrDesc")!=-1)?this.id+"Other":this.id.replace("elem_visMr","elem_visMrOther");if(si>2){sid=(this.type=="checkbox")?sid.replace("Sel2_","Sel2_"+si+"_"):sid+"_"+si;}}}}
if(sid!=""){if(this.type=="checkbox"){if($("#"+this.id).prop("checked")!=$("#"+sid).prop("checked")){$("#"+this.id).parent().find("label[for='"+this.id+"']").trigger("click");}}else{var tmp=$("#"+sid).val();if(typeof(tmp)=="undefined"){tmp="";}
tmp=$.trim(tmp);$("#"+this.id).val(tmp);utElem_capture(this);set_vis_el_active(this);}
if(t=="PC"){if($(this).parents("#"+tprsmdv+ti).length>0&&tmp!=""&&tmp!="20/"){flgOpPrsm=1;}}else if(t=="MR"){if($(this).parents("#mr_gl_ph"+ti+",#mr_prism"+ti).length>0&&tmp!=""&&tmp!="20/"){flgOpPrsm=1;}}}}});}else{var ar=['S','C','A','Add','Sel1','P','Slash','Prism'];var fmr="elem_visMr",fpc="elem_visPc";var sod,sos,tod,tos,oth="",otht="",sfx="",sfxt,tmp;var si="";if(v.indexOf("PC")!=-1||v.indexOf("MR")!=-1){si=parseInt($.trim(v.replace(/PC|MR/g,"")));}
if(v.indexOf("PC")!=-1){var fs=fpc;sfx=(si<2)?"":si;}else if(v.indexOf("MR")!=-1){var fs=fmr;oth=(si>1)?"Other":"";sfx=(si>2)?"_"+si:"";}else if(v.indexOf("ARC")!=-1){var fs="elem_visCycAr";}else if(v.indexOf("AR")!=-1){var fs="elem_visAr";}
if(t=="MR"){var ft=fmr;otht=(ti>1)?"Other":"";sfxt=(ti>2)?"_"+ti:"";}else if(t=="PC"){var ft=fpc;sfxt=(ti<2)?"":ti;}
for(var z in ar){if(v.indexOf("AR")!=-1&&ar[z]!="S"&&ar[z]!="C"&&ar[z]!="A"){continue;}
sod=sos=tod=tos=null;if(v.indexOf("PC")!=-1){tmp=(ar[z]=="Sel1")?"Sel2":ar[z];sod=$("#"+fs+"Od"+tmp+sfx);sos=$("#"+fs+"Os"+tmp+sfx);}else{sod=$("#"+fs+oth+"Od"+ar[z]+sfx);sos=$("#"+fs+oth+"Os"+ar[z]+sfx);}
if(t=="MR"){tod=$("#"+ft+otht+"Od"+ar[z]+sfxt);tos=$("#"+ft+otht+"Os"+ar[z]+sfxt);}else if(t=="PC"){tmp=(ar[z]=="Sel1")?"Sel2":ar[z];tod=$("#"+ft+"Od"+tmp+sfxt);tos=$("#"+ft+"Os"+tmp+sfxt);}
if(sod&&tod){tod.val(sod.val());utElem_capture(tod[0]);set_vis_el_active(tod[0]);}
if(sos&&tos){tos.val(sos.val());utElem_capture(tos[0]);set_vis_el_active(tos[0]);}
if(t=="PC"){if($(tod,tos).parents("#"+tprsmdv+ti).length>0&&tmp!=""&&tmp!="20/"){flgOpPrsm=1;}}else if(t=="MR"){if($(tod,tos).parents("#mr_gl_ph"+ti+",#mr_prism"+ti).length>0&&tmp!=""&&tmp!="20/"){flgOpPrsm=1;}}}
sod=$("#"+fs+"Desc"+oth+sfx);tod=$("#"+ft+"Desc"+otht+sfxt);if(sod&&tod){tod.val(sod.val());utElem_capture(tod[0]);set_vis_el_active(tod[0]);}
if(v.indexOf("PC")!=-1||v.indexOf("MR")!=-1){sod=$("#"+fs+"PrismDesc_"+si);tod=$("#"+ft+"PrismDesc_"+ti);if(sod&&tod){tod.val(sod.val());utElem_capture(tod[0]);set_vis_el_active(tod[0]);}}}
if(flgOpPrsm==1){if(t=="PC"){$("#"+tprsmdv+ti).addClass("in");}
else if(t=="MR"){$("#mr_gl_ph"+ti+",#mr_prism"+ti).addClass("in");}}
if(t=="MR"){if(ti>=1){setUserName("MR"+ti);}}}
function changePc(n){if(typeof(n)=="object"){if(n.name.indexOf("S")!=-1&&(n.value=='0'||n.value=='0.0'||n.value=='0.00')){$("input[name='"+n.name+"']").val("PLANO");}}}
function justify2Decimal(objElem,nosign){var valElem=$.trim(objElem.value);if(valElem!=""&&!isNaN(valElem)&&nosign!=1){var tmp=def_clindr_sign;if(typeof(tmp)=="undefined"||tmp==""||objElem.name.indexOf("S")!=-1){tmp="+"}
var ptrn="^[\+|\-]";var reg=new RegExp(ptrn,'g');var sign=valElem.match(reg);var unJustNumber=(sign==null)?valElem:valElem.substr(1);var justNumber=(unJustNumber=="")?"":parseFloat(unJustNumber).toFixed(2);if(justNumber==0.00)tmp=sign="";objElem.value=(sign==null)?tmp+justNumber:sign+justNumber;}else{objElem.value=valElem;}}
function ak_sel(obj){$("input[name='elem_kType']").each(function(){if(obj.checked&&this.id!=obj.id){this.checked=false;utElem_capture(this);}});}
function check2Blur(obj,wh,wh2){var e=window.event;var kCode=e.keyCode
if(((kCode>=48)&&(kCode<=57))||((kCode>=65)&&(kCode<=90))||((kCode>=96)&&(kCode<=111))||((kCode>=186)&&(kCode<=191))||((kCode>=219)&&(kCode<=222))){var oWh2=gebi(wh2,1)[0];var val=(typeof obj.value=="undefined")?"":$.trim(obj.value);if(((wh=="I")||(wh=="A")||(wh=="X"))&&(val.length>=3)){oWh2.focus();if(oWh2.type!="select-one")oWh2.select();}else if((wh=="K")&&(wh=="slash")){var ptrn="^\\w\\w\.\\w\\w$";var reg=new RegExp(ptrn,"g");var mtch=val.match(reg);if(mtch){oWh2.focus();if(oWh2.type!="select-one")oWh2.select();}}else{var dInx=val.indexOf(".");if((dInx!=-1)){var sbStr=val.substr(dInx+1);if(sbStr.length>=2){oWh2.focus();if(oWh2.type!="select-one")oWh2.select();}}}}}
function changeMr(n){if((finalize_flag==1&&isReviewable==0)||elem_per_vo=="1")return;var ar=null;var e="OU";if(typeof(n)=="object"){if(n.name.indexOf("Od")!=-1){e="OD";}else if(n.name.indexOf("Os")!=-1){e="OS";}
if(n.name.indexOf("S")!=-1&&(n.value=='0'||n.value=='0.0'||n.value=='0.00')){$("input[name='"+n.name+"']").val("PLANO");}
var c=0,vn="";if(n.name.indexOf("Add")==-1&&(n.name.indexOf("S")!=-1||n.name.indexOf("C")!=-1||n.name.indexOf("A")!=-1||n.name.indexOf("Txt1")!=-1)){c=1;vn=n.name;}
if(n.name.indexOf("Other")!=-1){var mri=n.name.match(/_\d+/);if(mri){mri=mri[0];mri=""+mri.replace(/_/,'');n=parseInt(mri);}else{n=2;}}else{n=1;}}
if(n>=1){setUserName("MR"+n);if(e=="OS"&&c==1){if(vn&&typeof(vn)!="undefined"&&vn!=""){var a1=vn.replace(/(S|C|A|Txt1)/,"Add");a1=a1.replace(/(Od|Os)/,"Od");var a2=a1.replace(/(Od)/,"Os");if($("#vision input[name="+a1+"]").length>0&&$("#vision input[name="+a2+"]").length>0){var t=$("#vision input[name="+a2+"]");var s=""+$("#vision input[name="+a1+"]").val();if(s!=""&&s!="+"){t.val(""+$("#vision input[name="+a1+"]").val());utElem_capture(t[0]);}}}}}}
function set_vis_el_active(oenm){var enm="";if(oenm!=null){enm=oenm.name;}
$(oenm).addClass("active");var str=$("#elem_statusElements").val();if(typeof(str)=="undefined")str="";if(str.indexOf(enm+"=1,")==-1){str=str.replace(""+enm+"=0,","");str=str+""+enm+"=1,";}
$("#elem_statusElements").val(str);}
function chkOther(o){if(o.value.toLowerCase()=='other')o.value='';}
function wv_activate_menu_click(obj_el,flg_top){var slctr=" .menu a";if(typeof(obj_el)!="undefined"&&obj_el!=""){slctr=obj_el;}
var obj=$(""+slctr).not("#ContactLens ul.dropdown-menu a");if(typeof(flg_top)!="undefined"&&flg_top=="1"){obj=top.$(""+slctr);}
obj.bind("click",function(){var me=$(this);if(typeof(flg_top)!="undefined"&&flg_top=="1"){me=top.$(this);}
var tid=me.parents(".menu").find("button").data("trgt-id");var otid=(typeof(flg_top)!="undefined"&&flg_top=="1")?top.$("#"+tid):$("#"+tid);var v=me.data("val");if(tid.indexOf("elem_followUpNumber_")!=-1){var pv=otid.val();if(typeof(pv)!="undefined"&&pv!=""){v=v+","+pv;}}
otid.val(v).triggerHandler("change");otid.triggerHandler("blur");otid.triggerHandler("keyup");otid.trigger("click");});}
function wv_activate_mr(){$(":checkbox[id*=elem_mrNoneGiven]").bind("click",function(){var x=this.name.replace("elem_mrNoneGiven","elem_mr_pres_dt_");var d="";if(this.checked){d=$("#elem_examDate").val();}$("#"+x).val(d).trigger("click");});$("input[id*=elem_mr_pres_dt]").datepicker({dateFormat:"mm-dd-yy"});}
var reset_vis_nav_ept;function reset_vis_nav(){if(typeof(reset_vis_nav_ept)=="undefined"){reset_vis_nav_ept=$('.examleftpan').position().top;}
var wt=$(window).scrollTop();var th=$(".workvision")[0].offsetHeight;var sh=$(".examleftpan")[0].offsetHeight;var sp=$('.examleftpan').position().top;var wp=$(".workvision").position().top;var ct=reset_vis_nav_ept+wt+sh;var dt=wp+th;if(ct>=dt){wt=dt-sh;}
if(wt>=wp){var d=wt-wp;var t=reset_vis_nav_ept+d;}else{t=0;}
$('.examleftpan').css({"top":t+"px"});}
function vision_event_handler(){wv_activate_menu_click();$("#Vision .menu button").attr("tabindex","-1");$(".reloadpos").bind("click",function(){setResetValues('vis');});wv_activate_mr();$('#Vision .nav-pills a').bind("click",function(){var t=$(this).attr('href');var v='';if(t=='#pill_ar'){$("#elem_visArOdSel1").removeClass("hidden");$("#elem_visCycArOdSel1").addClass("hidden");if($('#pill_ar').hasClass("in")){v='popAR';}}else if(t=='#pill_cyc_ar'){$("#elem_visArOdSel1").addClass("hidden");$("#elem_visCycArOdSel1").removeClass("hidden");if($('#pill_cyc_ar').hasClass("in")){v='popCycAR';}}else if(t=='#pill_bat'){$("#bat .hdr div").addClass("hidden");if($('#pill_bat').hasClass("in")){v='popBAT';}}else if(t=='#pill_pam'){$("#bat .hdr div").removeClass("hidden");if($('#pill_pam').hasClass("in")){v='popPAM';}}
if(v!=''){callPopup('',v,'1250','760');}
else{$(this).tab('show');}
return false;});var menu=function(o){var c=$(o).hasClass("in")?"up":"down";$(".examleftpan a[href='#"+o.id+"'] span").removeClass("glyphicon-menu-up glyphicon-menu-down").addClass("glyphicon-menu-"+c);};var menu_el='#Distance, #PC, #MR, #LASIK, #OtherVisionExams, #ContactLens';$(menu_el).each(function(){menu(this);});$(menu_el).on('shown.bs.collapse',function(){var t=$(this).attr('id');if($("#"+t).hasClass("in")){scroll_into_view("#"+t);};menu(this);});$(menu_el).on('hidden.bs.collapse',function(){var t=$(this).attr('id');$(window).triggerHandler("scroll");menu(this);});$(window).scroll(function(){reset_vis_nav();});$("#MR .dv_glph_hdr .header :checkbox").bind("click",function(){if($(this).prop("checked")){$(this).parents(".header").find(":checkbox[id!='"+$(this).attr("id")+"']").prop("checked",false);}});$("#Vision .examsectbox .header .glyphicon-ok-circle").bind("click",function(){var w=$(this).parents(".examsectbox").parent().attr("id");var c,c1="",flg_blur=0;if(w=="ar"||w=="bat"){var x=$("#"+w+" table.in").attr("id");if(x=="pill_ar"){c1+="#elem_visArOdSel1, #elem_visArRefPlace";}else if(x=="pill_cyc_ar"){c1+="#elem_visCycArOdSel1, #elem_visArRefPlace";}else if(x=="pill_pam"){c1+="#elem_visPam, #elem_visPamOdSel2";}
c=$("#"+x);}else{w=$(this).parents("div[id*=pc]").attr("id")||"";if(w!=""&&w.indexOf("pc")!=-1){c=$("#"+w);}else{w=$(this).parents("div[id*='row_mr_']").attr("id")||"";if(w!=""&&w.indexOf("row_mr_")!=-1){c=$("#"+w);flg_blur=1;}else{c=$(this).parents(".examsectbox");}}}
if(c){c.find(":input").each(function(){var v=$(this).val();if(v!=""&&v!="20/"){var thid=$(this).attr("id");if(typeof(thid)!="undefined"&&thid.indexOf("elem_addvisDisOdSel")!=-1){return true;}$(this).trigger("change");if(flg_blur==1&&typeof(this.id)!='undefined'&&this.id.indexOf("OdS")!=-1){$(this).triggerHandler("blur");c.find(":checked[name*=elem_mrNoneGiven]").each(function(){$(this).prop("checked",false).trigger("click");});flg_blur=0;}}});}
if(c1!=""){$(""+c1).each(function(){var v=$(this).val();if(v!=""&&v!="20/"){$(this).trigger("change");}});}});}
function add_opyia_assessment(enm,val){if(typeof(flgRefDig)=="undefined"){flgRefDig=1;}
if(flgRefDig==0){return;}
if(typeof(flgRefGivenOnly)=="undefined"){flgRefGivenOnly=0;}
if(typeof(flgPhyRefSet)=="undefined"){flgPhyRefSet=0;}
var etar_v=$.trim(val);if(etar_v!=""){var v_icd_10=$("#hid_icd10").val();var t_as="",t_dx="",site="",t_as_2="",t_dx_2="",site_2="";var s_od,s_os,ad_od,ad_os,mr_givn;if(enm.indexOf("_3")!=-1){s_od=$(":input[name=elem_visMrOtherOdS_3]").val(),s_os=$(":input[name=elem_visMrOtherOsS_3]").val(),ad_od=$(":input[name=elem_visMrOtherOdAdd_3]").val(),ad_os=$(":input[name=elem_visMrOtherOsAdd_3]").val();mr_givn=$(":checked[name=elem_mrNoneGiven3]").length;}else if(enm.indexOf("Other")!=-1){s_od=$(":input[name=elem_visMrOtherOdS]").val(),s_os=$(":input[name=elem_visMrOsS]").val(),ad_od=$(":input[name=elem_visMrOtherOdAdd]").val(),ad_os=$(":input[name=elem_visMrOsAdd]").val();mr_givn=$(":checked[name=elem_mrNoneGiven2]").length;}else{s_od=$(":input[name=elem_visMrOdS]").val(),s_os=$(":input[name=elem_visMrOsS]").val(),ad_od=$(":input[name=elem_visMrOdAdd]").val(),ad_os=$(":input[name=elem_visMrOsAdd]").val();mr_givn=$(":checked[name=elem_mrNoneGiven1]").length;}
s_od=(typeof(s_od)=="undefined")?"":$.trim(s_od);if(""+s_od.toLowerCase()=="plano"){s_od="";}
s_os=(typeof(s_os)=="undefined")?"":$.trim(s_os);if(""+s_os.toLowerCase()=="plano"){s_os="";}
ad_od=(typeof(ad_od)=="undefined"||parseFloat(ad_od)<=0)?"":$.trim(ad_od);ad_os=(typeof(ad_os)=="undefined"||parseFloat(ad_os)<=0)?"":$.trim(ad_os);mr_givn=(typeof(mr_givn)=="undefined")?0:$.trim(mr_givn);if(flgRefGivenOnly=="1"&&mr_givn<=0){return;}
if((ad_od!=""&&ad_od!="+")||(ad_os!=""&&ad_os!="+")){t_as_2="Presbyopia";t_dx_2=(v_icd_10=="9")?"367.4":"H52.4";if(ad_od!=""){site_2="OD";}
if(ad_os!=""){site_2=(ad_od!="")?"OU":"OS";}}
if((s_od!=""&&s_od!="-"&&s_od!="+")||(s_os!=""&&s_os!="-"&&s_os!="+")){if(s_od.indexOf("-")!=-1||s_os.indexOf("-")!=-1){t_as="Myopia";t_dx=(v_icd_10=="9")?"367.1":"H52.1-";}
else{t_as="Hyperopia";t_dx=(v_icd_10=="9")?"367.0":"H52.0-";}
if(t_dx=="H52.1-"){if(s_od!=""&&s_od.indexOf("-")!=-1){site="OD";}
if(s_os!=""&&s_os.indexOf("-")!=-1){site=(site!="")?"OU":"OS";}}else{if(s_od!=""){site="OD";}
if(s_os!=""){site=(s_od!="")?"OU":"OS";}}
var r="";if(site=="OD"){r=1;}else if(site=="OU"){r=3;}else if(site=="OS"){r=2;}
t_dx=t_dx.replace("-",r);}
if(t_as!=""||t_as_2!=""){cn_clearOpiaAssessments(t_as,t_as_2);if(t_as!=""){addAssessOption(t_as,"","",site,"",t_dx);}
if(t_as_2!=""){addAssessOption(t_as_2,"","",site_2,"",t_dx_2);}}}}
function cn_clearOpiaAssessments(a1,a2){var ass_nm="textarea[id*=elem_assessment]";$(ass_nm).each(function(indx){if(this.id.indexOf("elem_assessment_dxcode")!=-1){return true;}
var tmp=$.trim(this.value);if($.trim(tmp)!=""){tmp=tmp.toLowerCase();var ar_tmp=tmp.split(";");tmp=$.trim(ar_tmp[0]);if(tmp=="presbyopia"||tmp=="myopia"||tmp=="hyperopia"){var flgdo=1;if(typeof(a1)!="undefined"&&a1!=""){a1=a1.toLowerCase();if(tmp==a1){flgdo=0;a1="";}}
if(typeof(a2)!="undefined"&&a2!=""){a2=a2.toLowerCase();if(tmp==a2){flgdo=0;a2="";}}
if(flgdo==1){clearAssessRow(this.id);}}}});}
function vis_show_sec(wh,flgshow){}
function setActuity(obj){}
function addArthSign(obj){var valElem=$.trim(obj.value);obj.value="";var ptrn="^[\+|\-]";var reg=new RegExp(ptrn,'g');var sign=valElem.match(reg);if(valElem!=""&&!isNaN(valElem)){if(sign!=null){valElem=valElem.replace(reg,"");}else{sign="+";}
if(valElem!=""){valElem=parseFloat(valElem).toFixed(2);obj.value=sign+valElem;}}}
function setOs(obj){var n=obj.name;var valElem=$.trim(obj.value);if((n.indexOf("Add")!=-1)&&(valElem!="")){addArthSign(obj);}}
function scrollDropDowns(obj){var parentModal=$(obj);if(parentModal.length){var mainContainer=parentModal.find('.modal-body');var inputElem=mainContainer.find("input[type=text]");$.each(inputElem,function(id,val){var inputTxt=this.id;mainContainer.find('input[id$='+inputTxt+']:visible').each(function(id,elem){var inputID=$(elem).attr('id');var selectID=inputID.replace('text_','');var inputVal=$(elem).val();inputVal=$.trim(inputVal);if(inputTxt==selectID){return true;}
var selectElem=mainContainer.find('#'+selectID);if(selectElem){var scrollHeight=0;if(inputVal!=''&&inputVal!="None"){var flgc=0;selectElem.find('option').each(function(id,optElement){if(inputID.indexOf("S_text_input")!=-1||inputID.indexOf("C_text_input")!=-1||inputID.indexOf("A_text_input")!=-1){if(parseFloat(this.value)<parseFloat(inputVal)){scrollHeight+=15;}
flgc=1;}else{if(this.value==inputVal){flgc=1;}
if(flgc==0){scrollHeight+=15;}}});if(flgc==0){scrollHeight=0;}}
selectElem.animate({scrollTop:scrollHeight},5);}});});}}
function callPopup(fileName,popName,width,height,section){if(section!="PRS"){if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}}
var popmodal="";popmodal=popName+"Modal";if(popmodal!=""){var indx=""+popName.replace(/popMR/,"");var indx2=""+popName.replace(/popExtMR/,"");var ext_mr_lbl=$("#h2_mr_id"+indx).html();var mr_lbl=$("#h2_mr_id"+indx).html();if(top.$("#"+popmodal).length>0){top.$("#"+popmodal).modal('hide');top.$("#"+popmodal+", .modal-backdrop").remove();}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,"");var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=VisPopUp&popName="+popName+"&mr_lbl="+mr_lbl+"&ext_mr_lbl="+ext_mr_lbl;$.get(url,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"");top.$("body").append(d);top.$("#"+popmodal).modal("show");top.$('#'+popmodal).on('shown.bs.modal',function(){if(popName.indexOf("popPC")!=-1||popName.indexOf("popMR")!=-1||popName.indexOf("popBAT")!=-1||popName.indexOf("popExtMR")!=-1){top.$("#"+popmodal).find('.modal-dialog').css({width:'auto'});}
top.$("#"+popmodal).find('.modal-dialog').css({height:'auto','max-height':'100%'});top.$("#"+popmodal).find('.modal-body').css({padding:'2px'});var xhgt=top.$(window).height();var xwdth=top.$(window).width();if(section=="PRS"){xhgt=parent.document.body.clientHeight-120;}
xhgt=parseInt(xhgt)-(parseInt(top.$(this).find('.modal-footer').css("height"))+150);var fun=function(){var x=$(this).val();$(this).find("option").prop("selected",false);$(this).find("option[value='"+x+"']").prop("selected",true);var v=$(this).val()||"";var tid=$(this).attr("id").replace("_input","_text_input");top.$("#"+tid).val(v);};if(isiPad==1){top.$("#"+popmodal+" .modal-body select[data-size]").attr("data-size",1).prop('multiple',false).bind("blur",fun);}else{top.$("#"+popmodal+" .modal-body select[data-size]").css({"min-height":xhgt+"px"}).bind("change",fun);}
if(popName.indexOf("popPC")!=-1||popName.indexOf("popMR")!=-1||popName.indexOf("popExtMR")!=-1){top.$("#"+popmodal+" .modal-body").css({"overflow-x":"hidden","height":xhgt+150});top.$("#"+popmodal+" .panel-body").css({"padding":"2px"});}
if(popName.indexOf("popMR")!=-1){top.$("#"+popmodal+" .table").css({"margin-bottom":"2px"});top.$("#"+popmodal+" .table td").prop("style","padding: 2px !important");}
if(popName.indexOf("popExtMR")!=-1){top.$("#"+popmodal+" .table").css({"margin-bottom":"2px"});top.$("#"+popmodal+" .table td").prop("style","padding: 2px !important");}
top.$("#"+popmodal+" .modal-footer").css({"text-align":"center"});if(typeof(top.getValuesFromParent)!="undefined"&&popName.indexOf("popExtMR")==-1){top.getValuesFromParent(popmodal);}
if(typeof(top.bl_exe)!="undefined"){top.$("#"+popmodal+" .bl ").each(function(){$(this).bind("click",function(){top.bl_exe(this);});});}
setTimeout(function(){scrollDropDowns(top.$("#"+popmodal));},500);});if(popName.indexOf("popPC")==-1&&popName.indexOf("popMR")==-1){wv_activate_menu_click("#"+popmodal+" .menu a",1);}});}}
function opArUp(op){if(typeof op=="undefined")op="";var url=zPath+"/chart_notes/onload_wv.php?elem_action=ScarAR&op="+op;var n="childWinArScan";top.fmain.showOtherForms(url,n,810,600,0);}
var flg_add_more_vision=0;function add_more_vision(w){var indx=0;var wh=(w=="pc")?"#PC":"#MR";$(wh+">.row>div[id]").each(function(){if($(this).css("display")=="none"){return false;}var id=$(this).attr("id");id=id.replace(/pc|row_mr_/g,"");id=parseInt(id);if(id>indx){indx=id;}});indx+=1;if(w=="pc"){if($("#pc"+indx).length>0){$("#pc"+indx+", #pc"+(indx+1)+", #pc"+(indx+2)).show();return;}}
else{if($("#row_mr_"+indx).length>0){$("#row_mr_"+indx+", #row_mr_"+(indx+1)).show();return;}}
if(flg_add_more_vision==1){return;}
flg_add_more_vision=1;var pcln=$("#PC").find(".row>div[id*=pc]").length;var mrln=$("#MR").find("div[id*=row_mr_]").length;var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=addVisionPCMR&indx="+indx+"&w="+w+"&ctmpMr3="+$("#ctmpMr3").val()+"&pcln="+pcln+"&mrln="+mrln;if(typeof(setProcessImg)=="function"){setProcessImg("1","vision");}
$.get(url,function(data){flg_add_more_vision=0;if(typeof(setProcessImg)=="function"){setProcessImg("0","vision");}if(data!=""){$(wh+">.row").append(data);}wv_activate_menu_click();wv_activate_mr();});}
function clearPc(w,rem){if(typeof(rem)!="undefined"&&rem==1){$("#pc"+w+", #pc"+(w-1)+", #pc"+(w-2)).hide();}}
function chk_mr_given(o){if($(o).val()!=""){var tmpdt=$(o).val();var a=o.id.replace(/elem_mr_pres_dt_/,"elem_mrNoneGiven");if($("#"+a).prop("checked")==false){$("#"+a).trigger("click");$(o).val(tmpdt);}}}
function vis_add_menu(o,mid,eid,h,t){if(typeof(o)!="undefined"){if(!$(o).hasClass("dropdown-toggle")){if(typeof(h)=="undefined"){var g=""+mid;if(g!=""){if($("#Vision ."+g+"_ul").length<=0){if(typeof(setProcessImg)!='undefined')setProcessImg("1","Vision");$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=get_sb_menu&wh="+g+"&req_ptwo=1&mid="+mid+"&eid="+eid,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","Vision");if(typeof(d)!="undefined"&&d!=""){vis_add_menu(o,mid,eid,d,1);}});}else{var d=$("#Vision ."+g+"_ul").get(0).outerHTML;if(typeof(d)!="undefined"&&d!=""){vis_add_menu(o,mid,eid,d);}}
return;}}else{var trgtid=''+$(o).parent().parent().find(".form-control").attr("id");$(o).parent().append(h);$(o).attr("data-toggle","dropdown");$(o).attr("data-trgt-id",trgtid);$(o).addClass("dropdown-toggle");$(o).unbind("click",'vis_add_menu');$(o).dropdown();if(mid=="menu_visit_type"){$("#el_visit_ig ul").bind("click",function(){stopClickBubble();});$("#el_visit_ig ul a").bind("click",function(){var x="elem_ptVisit_chk";var y="elem_ptTesting";var h=top.$(this).html();var c=$(this).parent().parent().find(".dropdown-header").html();var w="";if(c=="VISIT"){w=x;}else if(c=="TESTING"){w=y;}
if(w!=""){var a=$("#"+w).val();if(h=="Other"){h="";a="";}
if(typeof(a)!="undefined"&&a!=""){if(c=="VISIT"){if(a.indexOf(h)==-1&&a.indexOf(h+",")==-1){h=h+", "+a;}else{return;}}
else if(c=="TESTING"){if(a!=h){a=h;}else{return;}}}
$("#"+w).val(h);var a=$("#"+x).val()||"";var b=$("#"+y).val()||"";var w="";if(a!=""){w+=a;if(b!=""){w+=" - ";}}
if(b!=""){w+=b;}
$("#el_visit").val(w);$("#elem_masterPtVisit").val(a).triggerHandler("change");$("#elem_masterTesting").val(b).triggerHandler("change");}
stopClickBubble();});}else{wv_activate_menu_click("."+mid+" a");}
if(typeof(t)!="undefined"&&t=="1"){$(o).dropdown("toggle");}}}}}
function add_more_actuity(hh){indx="4";var iddv="div_pop_acuity"+indx;var sel_val=$("#elem_addvisDisOdSel").val();if(typeof(hh)!="undefined"){if(hh==1){$("#"+iddv+"").addClass("hidden");if(sel_val!=""){$("#flg_addvisDisOdSel").removeClass("hidden");}else{$("#flg_addvisDisOdSel").addClass("hidden");}}else if(hh==2){$("#"+iddv+" input[id]").val('');}
return;}
if($("#elem_visDisOdSel"+indx+"").length>0){if(sel_val!=""){$("#"+iddv).removeClass("hidden");var wh=$("#elem_addvisDisOdSel").offset();$("#"+iddv).css({"top":wh.top+"px","left":wh.left+"px"});$("#elem_visDisOdSel"+indx).val(sel_val);$("#"+iddv).draggable({'handle':'.header'});}else{$("#"+iddv).addClass("hidden");$("#"+iddv+" input[id]").val('');$("#flg_addvisDisOdSel").addClass("hidden");}}else{}}
function closePopUps()
{$("#sliderRight").remove();$("#btn_attest_scribe, #btn_attest_attend_scribe, #btn_attest_teach").popover("destroy");top.$('#spanMoreCoMangPhy, #spanMoreRefPhy, #spanMorePCP').popover("destroy");top.$("body").click();}
function close_modal_js(obj){$(obj).parent().parent().remove();}
var flg_saveCDRV="";function saveCDRV(){if(finalize_flag==1&&isReviewable!=1){return;}
var fid=$("#elem_masterId").val();var cd_od=$.trim($("input[name=elem_rvcd_od]").val());var cd_os=$.trim($("input[name=elem_rvcd_os]").val());if(cd_od==""&&cd_os==""){return;}
if(typeof(flg_saveCDRV)=="undefined"||flg_saveCDRV==""){flg_saveCDRV=setTimeout(function(){saveCDRV();},5000);return;}
flg_saveCDRV=clearTimeout(flg_saveCDRV);var params={"elem_saveForm":"saveCDRV","fid":fid,"elem_cdValOd":cd_od,"elem_cdValOs":cd_os};if(typeof(setProcessImg)=="function")setProcessImg("1","fundus_exam");$.post("saveCharts.php",params,function(data){if(typeof(setProcessImg)=="function")setProcessImg("0","fundus_exam");if(data!=0){window.status="Error: C:D values are not saved.";}else{loadExamsSummary("fundus_exam");}});}
function checkPneEye(x){var vchk="elem_periNotExamined";var veye="elem_peri_ne_eye";if(x.id!=vchk&&x.id!=veye){vchk="elem_periNotExamined_peri";veye="elem_peri_ne_eye_peri";}
if(x.type=="checkbox"){var o=$("#"+veye);if($("#"+vchk).prop("checked")&&o.val()==""){o.val("OU");}else if(!$("#"+vchk).prop("checked")){o.val("");}}else if(x.type=="select-one"){var o=$("#"+vchk);if($("#"+veye).val()!=""&&o.prop("checked")==false){o.prop("checked",true).triggerHandler("click");}else if($("#"+veye).val()==""){o.prop("checked",false);}}
utElem_capture(o[0]);if(typeof(examName)!="undefined"&&examName=="Fundus"){if($("#"+vchk).prop("checked")){if($("#"+veye).val()=="OD"||$("#"+veye).val()=="OU"){$("#"+vchk).parents(".tab-pane").find("textarea[id*=AdOptionsOd]").trigger("click");}
if($("#"+veye).val()=="OS"||$("#"+veye).val()=="OU"){$("#"+vchk).parents(".tab-pane").find("textarea[id*=AdOptionsOs]").trigger("click");}}}}
function savePNE(o){if(finalize_flag==1&&isReviewable!=1){return;}
var vchk="elem_periNotExamined";var veye="elem_peri_ne_eye";var ex="Ret";if(o.id!=vchk&&o.id!=veye){vchk="elem_periNotExamined_peri";veye="elem_peri_ne_eye_peri";ex="Peri";}
var fid=$("#elem_masterId").val();var pne=$(":checked[name="+vchk+"]").length>0?1:0;var pne_i=$(":input[name="+veye+"]").val();var params={"elem_saveForm":"SavePeriphery","fid":fid,"pne":pne,"pne_i":pne_i,"ex":ex};if(typeof(setProcessImg)=="function")setProcessImg("1","fundus_exam");$.get("saveCharts.php",params,function(data){if(typeof(setProcessImg)=="function")setProcessImg("0","fundus_exam");if(data!=0){window.status="Error: periphery Not exam is not saved.";}else{loadExamsSummary("fundus_exam");}});}
function setResetValues(val,site,confrmed){if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
if(val=="vis")val="Vision";if(typeof(confrmed)=='undefined'){top.fancyConfirm("Do you want to reset "+val+" exam(s)?",'',"top.fmain.setResetValues(\'"+val+"\', \'"+site+"\',true)");c=false;}else{c=true;}
if(c){if(val=="Vision"){var a="#Vision :input[type=text], "+"#Vision textarea,#Vision select, "+"#elem_statusElements ";$(a).val("").removeClass("active").addClass("inact");$("#Vision .acuity").val("20/");$("#Vision :input[type=checkbox]").attr("checked",false);$("#a_pcPrism1,#a_pcPrism2,#linkpc3,#a_mrPrism1,#a_mrPrism2,#indBat,#indMR3,#sptitle_w4dot").removeClass("positive");$("#Vision #el_lasik_userid").val(authUserID);}else{if(typeof(site)=="undefined"){site="";}
var url="saveCharts.php";var params="elem_saveForm=setResetValues";params+="&elem_section="+val;params+="&elem_fid="+$("#elem_masterId").val();params+="&site="+site;params+="&cryfwd_form_id="+$("#cryfwd_form_id").val();if(typeof(setProcessImg)=="function")setProcessImg("1","");$.post(url,params,function(data){if(typeof(setProcessImg)=="function")setProcessImg(0,"");if(data=="1"){loadExamsSummaryAll();}},"");}}
stopClickBubble();}
function setResetStart(s){setResetValues('All',s);}
function cn_progess_notes(op){if(user_type!=1&&logged_user_type!=6){return;}
var sv_per=((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1")))?0:1;if(op==2){$("#dv_cn_progess_notes").remove();return;}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,"btnPrgs");var params="";var f=$("#elem_masterId");params+="&elem_formId="+f.val();var p=$("#elem_patientId");params+="&elem_patientId="+p.val();var d=$("#elem_dos");params+="&elem_dos="+d.val();params+="&sv_per="+sv_per;if(op==3){var prv_frm_id=$("#el_all_prg_note").val();params+="&load_prev_prog="+prv_frm_id;}
var url="requestHandler.php?elem_formAction=get_cn_progess_notes";if(op==4){params+="&op=print";$.get(url+params,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"btnPrgs");if(d){top.fmain.showOtherForms(zPath+'/../library/html_to_pdf/createPdf.php?file_location='+d,'print_plan_win','1000','400');}else{top.fAlert('No progress note exists');}});return;}
if(op==1){params+="&op=save";params+="&txt="+$("#el_cpn_txt").val();$.post(url,params,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"btnPrgs");cn_progess_notes(2);});return;}
$.get(url+params,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"btnPrgs");cn_progess_notes(2);$("body").append("<div id=\"dv_cn_progess_notes\" class=\"modal-dialog modal-lg\"><div class=\"modal-content\"><div class=\"modal-header bg-primary\"><button type=\"button\" class=\"close\" onclick=\"cn_progess_notes(2)\"></button><h4 class=\"modal-title\">Progress Note</h4></div><div class=\"modal-body\">"+d+"</div></div></div>");});}
function AfterSave(obj){var exm=obj.Exam.toLowerCase();if(exm=="ee"){exm="external";}else if(exm=="iop"||exm=="gonio"){exm="iop_gon";}else if(exm=="rv"){exm="fundus_exam";}else if(exm=="vf-gl"||exm=="oct-rnfl"){exm="vf_oct_gl";if($("#vf_oct_gl").length<=0){return;}}
loadExamsSummary(exm);if(exm=="eom"){loadExamsSummary("dv_cpctrl");loadExamsSummary("dv_stereopsis");loadExamsSummary("dv_w4dot");}
if(exm=="fundus_exam"){z_flg_diab_sb="3";sb_checkDiabetes();var ir_as=obj.arDrawInter[0],ir_dx=obj.arDrawInter[1],ir_pln=obj.arDrawInter[2],ir_dxid=obj.arDrawInter[3];addAssessOption(ir_as,ir_pln,0,"OU","",ir_dx,'','',ir_dxid);}
var arrMain=[];if(obj.arExamDone!=null&&obj.arExamDone.length>0){var arED=obj.arExamDone;var len=arED.length;var valEye,chkExm_org,tmp;for(var i=0;i<len;i++){tmp=arED[i].split("~*~");chkExm_org=$.trim(tmp[0])||"";valEye=$.trim(tmp[1])||"";if(chkExm_org!=""){arrMain[arrMain.length]=[chkExm_org,valEye];}}}
len=arrMain.length;for(var i=0;i<len;i++){chkExm=arrMain[i][0];valEye=arrMain[i][1];setAssessOption(chkExm,false,valEye,len);}
mandotry_chk('1');}
function get_MedList(num)
{if(typeof(setProcessImg)!='undefined')setProcessImg("1","elem_ptVisit_chk");$.get(top.JS_WEB_ROOT_PATH+"/interface/chart_notes/requestHandler.php?elem_formAction=show_med_list"+num,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","elem_ptVisit_chk");$("body").append(data);if(num==1){$("#medicationDiv").show();}
if(num==6){$("#surgeryDiv").show();}});}
function getMedHx()
{if(typeof(setProcessImg)!='undefined')setProcessImg("1","divOcMeds");$.get(top.JS_WEB_ROOT_PATH+"/interface/chart_notes/onload_wv.php?elem_action=GetMedHx",function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","divOcMeds");$("#divOcMeds").html(data);});}
var SxWinObj=false;function openMedHX(op,winH)
{if(op=="medication"||op=="medication_grid"){var ec=$("#tbl_ocu_grid").data("edit_chart"),prv_frmid="0";if(op=="medication_grid"&&typeof(ec)!="undefined"&&ec==1){if(elem_per_vo=='1'||((finalize_flag=="1")&&(isReviewable!="1"))){}else{prv_frmid=$("#elem_masterId").val();}}
divH=winH-130;winH=winH-100;window.open(top.JS_WEB_ROOT_PATH+"/interface/Medical_history/index.php?showpage=medication&callFrom=WV"+(op=='medication_grid'?'&subcall=grid':'')+"&divH="+divH+"&prv_frmid="+prv_frmid+"",'Medications','height='+winH+',width=1400,top=10,left=20,status=1');}
else if(op=="sxPro"||op=="sxPro2"){divH=winH-230;winH=winH-150;flgSxIco=(op=="sxPro2")?"1":"0";var w=document.body.clientWidth;SxWinObj=window.open(top.JS_WEB_ROOT_PATH+"/interface/Medical_history/index.php?showpage=sx_procedures&callFrom=WV&divH="+divH+"&flgSxIco="+flgSxIco,'Sx Procedures','height='+winH+',width='+w+',top=10,left=20,status=1');}
else if(op=="allergies"){divH=winH-230;winH=winH-150;window.open(top.JS_WEB_ROOT_PATH+"/interface/Medical_history/index.php?showpage=allergies&callFrom=WV&divH="+divH+"",'Allergies','height='+winH+',width=1060,top=10,left=20,status=1');}}
function gebi(id,t)
{var o;if(t==1){o=document.getElementsByName(id);}else if(t==2){o=document.getElementsByTagName(id);}else{o=document.getElementById(id);if(o==null){o=document.getElementsByName(id)[0];}}
return o;}
var tkGenHlth;function showMedList(id,frld)
{if(typeof(gebi)=="undefined")return;if(id==1){var o=gebi('medicationDiv');if(o){o.style.display='block';}else{get_MedList(1);}}
if(id==6){if(gebi('surgeryDiv')){gebi('surgeryDiv').style.display='inline';}else{get_MedList(6);}}
if(id=="PMH"){if(gebi('genHealthDiv_wv')){if(gebi('genHealthDiv_wv').innerHTML==""||frld==1){if(typeof(setProcessImg)!='undefined')setProcessImg("1","genHealthDiv_wv");$('#genHealthDiv_wv').load('onload_wv.php',{'elem_action':'GetGenHealth'},function(){if(gebi('genHealthDiv_wv').innerHTML!=""){if(typeof(setProcessImg)!='undefined')setProcessImg("0","genHealthDiv_wv");$('#genHealthDiv_wv').modal("show");set_modal_height($('#genHealthDiv_wv'));$('#genHealthDiv_wv').find('select.selectpicker').selectpicker();$('#genHealthDiv_wv').find("input.datepicker").datepicker({dateFormat:z_js_dt_frmt});clearTimeout(tkGenHlth);if(isERPPortalEnabled&&!postpone_pghd){setTimeout(function(){load_pghd_chart_reqs();},1000);}}});}
else{if(gebi('genHealthDiv_wv').innerHTML!=""){$('#genHealthDiv_wv').modal("show");clearTimeout(tkGenHlth);if(isERPPortalEnabled&&!postpone_pghd){setTimeout(function(){load_pghd_chart_reqs();},1000);}}}}}}
function load_pghd_chart_reqs(){var oPUF=(typeof(top.oPUF)!="undefined")?top.oPUF:top.fmain.oPUF;var n="pghd_reqs";if(!oPUF[n]||!(oPUF[n].open)||(oPUF[n].closed==true)){oPUF[n]=window.open(top.JS_WEB_ROOT_PATH+"/interface/Medical_history/get_pghd_req_med_hx.php?callFrom=WV",n,'location=1,status=1,resizable=1,left=10,top=1,scrollbars=1,width=1000,height=500');oPUF[n].focus();}else{oPUF[n].focus();}}
function hideMedListExe(id,frc)
{if(id==1){var o=gebi('medicationDiv');if(o)o.style.display='none';}
if(id==6){$('#surgeryDiv').fadeOut('fast');}
if(id=="PMH"){if((tkGenHlth)||(frc==1)){if(document.getElementById('genHealthDiv_wv')){$('#genHealthDiv_wv').modal('hide');}
clearTimeout(tkGenHlth);}}}
function hideMedList(id)
{if(id==1){if(typeof(gebi)=="undefined")return;var o=gebi('medicationDiv');if(o)o.style.display='none';}
if(id==6){$('#surgeryDiv').fadeOut('fast');}
if(id=="PMH"){tkGenHlth=setTimeout("hideMedListExe('"+id+"')",500);}}
function showAllergy(val)
{$("#allergies_patient").remove();if(val==1){var url=top.JS_WEB_ROOT_PATH+"/interface/chart_notes/requestHandler.php";var params="elem_formAction=PtAllergy";if(typeof(setProcessImg)=="function")setProcessImg("1","btn_allergy");$.post(url,params,function(data){if(typeof(setProcessImg)=="function")setProcessImg(0,"btn_allergy");if(data!=""){$("body").append(""+data);$('#allergies_patient').show();}},"");}}
function sc_showExamDetails(inx,mval){var symp=todoId=searchVal="";if(inx=="menu"){if(typeof(mval)=="undefined"||mval==""){return;}
searchVal=symp=encodeURI(mval);}else{var symp=$(":hidden[name=elem_symptom_"+inx+"]").val();searchVal=symp=encodeURI(symp);var todoId=$(":hidden[name=elem_todoid_"+inx+"]").val();if(typeof(todoId)=="undefined"||todoId==""){todoId="";}}
var vicd10=$("#hid_icd10").val();if(typeof(vicd10)=="undefined"){if(window.opener&&window.opener.top.fmain){vicd10=window.opener.top.fmain.$("#hid_icd10").val();}}
var dos=$("#elem_dos").val();if(typeof(dos)=="undefined"){if(window.opener&&window.opener.top.fmain){dos=window.opener.top.fmain.$("#elem_dos").val();}}
var url=top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php';var params="elem_formAction=SmartChartDetail&symp="+symp+"&todoId="+todoId+"&searchVal="+searchVal+"&empty_symp_allow=1&icd10="+vicd10+"&dos="+dos;$("#div_sc_con_detail").modal('hide');if(typeof(setProcessImg)!='undefined')setProcessImg("1","div_sc_con");$.get(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","div_sc_con");if(data!=""){if($('#div_sc_con_detail').length>0){$("#div_sc_con_detail").modal('hide');$('#div_sc_con_detail, .modal-backdrop').remove();}
$("body").append(data);$("#div_sc_con_detail").modal('show');$(".dacry input[type=text], .lacsci input[type=text], .ctmri input[type=text]").datepicker();utElem_setBgColor("div_sc_con_detail");$("#div_sc_con_detail textarea, #div_sc_con_detail input[type=text]").bind("focus",function(){if(!$(this).hasClass("ui-autocomplete-input")){cn_ta1_no_assess(this,'');};});newET_setGray_v3();}else{top.fAlert("No Assessment policy defined.");}});}
function sc_check_bl(obj){var flg=0;var nm_2="";$("#d_"+obj+"_od :input").each(function(i){if(this.type=="button"){return;}
nm_2=this.name.replace(/Od/g,"Os");if($("#d_"+obj+"_os :input[name="+nm_2+"]").length==0){if(this.value=="RUL"){nm_2=nm_2.replace(/rul/g,"lul");}
else if(this.value=="RLL"){nm_2=nm_2.replace(/rll/g,"lll");}}
if(this.type=="checkbox"){$("#d_"+obj+"_os :input[name="+nm_2+"]").prop("checked",this.checked).each(function(){utElem_capture(this);});if(this.checked&&flg==0){$("#d_"+obj+"_os :input[name="+nm_2+"]").triggerHandler("click");flg=1;}}else{$("#d_"+obj+"_os :input[name="+nm_2+"]").val(this.value).each(function(){utElem_capture(this);});if($.trim(this.value)!=""&&flg==0){$("#d_"+obj+"_os :input[name="+nm_2+"]").triggerHandler("click");flg=1;}}});}
function sc_insertMultiPlan1(indx){var strOrderId='';var str='';if($("#sc_elem_assess"+indx).length>0&&$("#sc_elem_assess"+indx).prop("checked")==false){if($('form[name=frmSC_Exam]  :checked[name*=elem_multiPlanSCPop'+indx+'][type=checkbox]').length>0){$("label[for=sc_elem_assess"+indx+"]").trigger("click");}}
$('form[name=frmSC_Exam]  :checked[name*=elem_multiPlanSCPop'+indx+']').each(function(){if(""+this.name.indexOf("_eye")==-1){var val=""+this.value;if(this.id.indexOf("elem_multiPlanSCPop"+indx+"_OrdrS")!=-1){var tmpsep="~!~||~!~";if(val.indexOf(tmpsep)!=-1){var arrVal=val.split(tmpsep);val=''+arrVal[0]+'';if(typeof(arrVal[1])&&arrVal[1]!=""){var tmpid=this.id;var tmpidsig=tmpid+"_sig";var tmpsig=$('select[name='+tmpidsig+']').val();if(typeof(tmpsig)=="undefined"){tmpsig="";}
tmpsig=$.trim(tmpsig);if(tmpsig!=""){var oOdrNm=$(this).attr("data-ordernm");if(typeof(oOdrNm)=="undefined"){oOdrNm="";}
if(oOdrNm!=""){val=val.replace(oOdrNm,oOdrNm+" "+tmpsig+"");}
arrVal[1]+="~!~|sig|~!~"+tmpsig;}
var tmpideye=tmpid+"_eye";var tmpeye=$(':checked[name='+tmpideye+']').val();if(typeof(tmpeye)=="undefined"){tmpeye="";}
if(tmpeye!=""){var oOdrNm=$(this).attr("data-ordernm");if(typeof(oOdrNm)=="undefined"){oOdrNm="";}
if(oOdrNm!=""){val=val.replace(oOdrNm,oOdrNm+" ("+tmpeye+")");}
arrVal[1]+="~!~|eye|~!~"+tmpeye;}
strOrderId+=""+arrVal[1]+",";}}}
if(val!=''){str+=''+val+'\n';}}});str=$.trim(str);$('form[name=frmSC_Exam] #sc_elem_plan_ap'+indx+'').val(str);$('form[name=frmSC_Exam] :input[name="elem_sc_orderids'+indx+'"]').val(strOrderId);}
function sc_searchExam(ob){var v=ob.innerHTML;if(typeof(v)!="undefined"){sc_showExamDetails('menu',v);$(".selector").menu("blur");$(".selector").menu("collapseAll",null,true);$('#div_sc_con #sc_menu_exams').hide();}}
function getSmartChartPopUp(){if(top.fmain==null)return;var vIsFin=top.fmain.$(":input[name='elem_isFormFinalized']").val();var vIsRev=top.fmain.$(":input[name='elem_isFormReviewable']").val();if(vIsFin==1&&vIsRev==0){top.fAlert("Chart note is finalized and is not reviewable.");return;}
if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
var url=top.JS_WEB_ROOT_PATH+"/interface/chart_notes/smart_charting.php";var params="elem_formAction=SmartChartPopUp";var dos=$("#elem_dos").val();params+="&dos="+dos;if(typeof(setProcessImg)!='undefined'){setProcessImg("1","bodyMP",0,0);}
$.post(url,params,function(data){top.$("#tl_smc .icon24").attr("disabled",false);if(typeof(setProcessImg)!='undefined')setProcessImg("0","bodyMP");var armenu=data.armenu;data=data.str;if(data!=""){if($('#div_sc_con_detail1').length>0){if($('#div_sc_con_detail1').next('style').length>0){$('#div_sc_con_detail1').next('style').remove();}
$('#div_sc_con_detail1').remove();}
$("body").append(data);$('#div_sc_con_detail1').modal('show');var typeahead_search=$("#elem_search_symptopms").typeahead();typeahead_search.data('typeahead').source=armenu;typeahead_search.data('typeahead').updater=function(item){var v=item;sc_showExamDetails('menu',v)
return item;};$('body').on('click','.dropdown-submenu a',function(e){var window_attr={};window_attr.width=$(window).width();window_attr.height=$(window).height();var current_elem=$(this);var next_ul=$(this).next('ul');$(this).next('ul').toggle();e.stopPropagation();e.preventDefault();});}else{top.fAlert("No Assessment policy defined.");}},"json");}
function sc_saveExamDetail(ob){var val=ob.value;if(val=="Reset"){$("#div_sc_con_detail input[type=text], #div_sc_con_detail select, #div_sc_con_detail textarea").val("");$("#div_sc_con_detail :checked").each(function(){$(this).trigger("click");});$("#div_sc_con_detail form").append("<input type=\"hidden\" id=\"elem_exm_find_pop_reset\" name=\"elem_exm_find_pop_reset\" value=\"1\">");return;}else if(val=="Done"){var url="saveCharts.php";if(typeof(setProcessImg)!='undefined')setProcessImg("1","div_sc_con_detail");var drw_symp=$("form[name=frmSC_Exam] :hidden[name=elem_drawingSymp]").val();if(typeof(drw_symp)!="undefined"&&drw_symp==""){drw_symp=0;}
var vicd10=$("#hid_icd10").val();if(typeof(vicd10)=="undefined"){if(window.opener&&window.opener.top.fmain){vicd10=window.opener.top.fmain.$("#hid_icd10").val();}}
var flgDoNotSave=0;if(drw_symp==1){var examNameCalled=""+$("form[name=frmSC_Exam] input[name=elem_examNameCalled]").val();var temp_check_exam_name=""+$("form[name=frmSC_Exam] input[name=elem_temp_check_exam_name]").val();if(examNameCalled==temp_check_exam_name){if(typeof(setProcessImg)!='undefined')setProcessImg("0","div_sc_con_detail");var tmp_eye_od=0,tmp_eye_os=0,subExamDivId="";$("form[name=frmSC_Exam] .symOpt1 :input").each(function(indx){var tmpid=""+this.id;if(typeof(tmpid)=="undefined"||tmpid==""){tmpid=""+this.name;}
tmpid=tmpid.replace(/_drwpusx/g,'');tmpid_target=tmpid.replace("_duplicate","");if(this.type=="checkbox"||this.type=="radio"){if(this.checked==true){if(this.name.toLowerCase().indexOf("od_")!=-1||this.name.indexOf("Od")!=-1){tmp_eye_od=1;}
if(this.name.toLowerCase().indexOf("os_")!=-1||this.name.indexOf("Os")!=-1){tmp_eye_os=1;}
if($("#"+tmpid_target).length>0){$("#"+tmpid_target).each(function(){if(!this.checked){this.click();utElem_capture(this);checkwnls(this);}if(this.checked){checkwnls(this);}});if(subExamDivId==""){subExamDivId=$("#"+tmpid_target).parents(".subExam").attr("id");}}else if($(":input[name="+tmpid_target+"]").length>0){$(":input[name="+tmpid_target+"]").each(function(){if(!this.checked){this.click();utElem_capture(this);}if(this.checked){checkwnls(this);}});if(subExamDivId==""){subExamDivId=$(":input[name="+tmpid_target+"]").parents(".subExam").attr("id");}}}}else{if($.trim(this.value)!=""){if(this.name.toLowerCase().indexOf("od_")!=-1||this.name.indexOf("Od")!=-1){tmp_eye_od=1;}
if(this.name.toLowerCase().indexOf("os_")!=-1||this.name.indexOf("Os")!=-1){tmp_eye_os=1;}
if($("#"+tmpid_target).length>0){$("#"+tmpid_target).val(""+this.value).each(function(){this.click();utElem_capture(this);checkwnls(this);});if(subExamDivId==""){subExamDivId=$("#"+tmpid_target).parents(".subExam").attr("id");}}else if($(":input[name="+tmpid_target+"]").length>0){$(":input[name="+tmpid_target+"]").val(""+this.value).each(function(){this.click();utElem_capture(this);checkwnls(this);});if(subExamDivId==""){subExamDivId=$(":input[name="+tmpid_target+"]").parents(".subExam").attr("id");}}}}});if(subExamDivId!=""){top.window.status="Please save changes from Done button!";}
var tmp_comm=""+$("form[name=frmSC_Exam] :input[name=sc_elem_comments]").val();tmp_comm=$.trim(tmp_comm);if(tmp_comm!=""&&subExamDivId!=""){$("#"+subExamDivId+" textarea[name*=AdOptions]").each(function(idx){if(this.value!=""){this.value+=", ";}
this.value+=""+tmp_comm;if(typeof(this.onblur)=="function"){this.onblur();}});}
var f_clck=0;var ln=$("form[name=frmSC_Exam] :input[name*=sc_elem_assess]").length;for(var i=1;i<=ln;i++){var tmp_assmt="",tmp_plan="",tmp_eye="",tmp_dx="";var o_assmt=$("form[name=frmSC_Exam] :input[name=sc_elem_assess"+i+"]");if(o_assmt.prop("type")=="checkbox"&&o_assmt.prop("checked")==true){}
else if(o_assmt.prop("type")=="textarea"&&o_assmt.val()!=""){}
else{continue;}
tmp_assmt=""+$("form[name=frmSC_Exam] :input[name=sc_elem_assess"+i+"]").val();tmp_plan=""+$("form[name=frmSC_Exam] textarea[name=sc_elem_plan"+i+"]").val();tmp_plan_ap=""+$("form[name=frmSC_Exam] #sc_elem_plan_ap"+i+"").val();if(tmp_plan_ap!=""&&tmp_plan_ap!="undefined"){if(tmp_plan!=""&&tmp_plan!="undefined"){tmp_plan=tmp_plan+"\n";}tmp_plan=tmp_plan+tmp_plan_ap;}
tmp_dx=""+$("form[name=frmSC_Exam] :input[name=sc_elem_dxcode"+i+"]").val();if(typeof(tmp_dx)=="undefined"||tmp_dx=="undefined"){tmp_dx="";}
if(tmp_eye_od==1&&tmp_eye_os==1){tmp_eye="OU";}else if(tmp_eye_od==1){tmp_eye="OD";}else if(tmp_eye_os==1){tmp_eye="OS";}
if(tmp_assmt!=""||tmp_plan!=""){window.opener.top.fmain.zSaveWithoutPopupSave=1;window.opener.top.fmain.addAssessOption(""+tmp_assmt,""+tmp_plan,0,""+tmp_eye,0,""+tmp_dx);f_clck=1;}}
if(f_clck==1){window.opener.top.$("#save").trigger("click");}
flgDoNotSave=1;}}
if(flgDoNotSave==0){$("#div_sc_con_detail .greyAll_v2").each(function(){if(this.type=="checkbox"&&this.checked){this.checked=false;}else if(this.type=="text"||this.type=="textarea"||this.type=="select-one"){this.value="";}});var params=$("form[name=frmSC_Exam]").serialize();params+="&elem_saveForm=Smart Charting_v6";params+="&hid_icd10="+vicd10;$("#div_sc_con_detail input:checkbox").not(":checked").each(function(){params+="&"+this.name+"=";});params=params.replace(/_drwpusx/g,'');$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","div_sc_con_detail");if(data.AP){var ln=data.AP["A"].length;for(var i=0;i<ln;i++){if(data.AP["A"][i]&&typeof(data.AP["A"][i])!="undefined"&&data.AP["A"][i]!=""){if(drw_symp==0){addAssessOption(""+data.AP["A"][i],""+data.AP["P"][i],0,""+data.AP["EYE"][i],"",data.AP["DX"][i],data.AP["ORDERIDS"][i],'',data.AP["DXID"][i]);}else{window.opener.top.fmain.addAssessOption(""+data.AP["A"][i],""+data.AP["P"][i],0,""+data.AP["EYE"][i],"",data.AP["DX"][i],data.AP["ORDERIDS"][i],'',data.AP["DXID"][i]);}}}}
if(data.FU){var ln=data.FU.length;for(var i=0;i<ln;i++){if(""+$.trim(data.FU[i]["number"])!=""||""+$.trim(data.FU[i]["time"])!=""||""+$.trim(data.FU[i]["visit_type"])!=""){if(drw_symp==0){fu_addOpts(""+data.FU[i]["number"],""+data.FU[i]["time"],""+data.FU[i]["visit_type"]);}else{window.opener.top.fmain.fu_addOpts(""+data.FU[i]["number"],""+data.FU[i]["time"],""+data.FU[i]["visit_type"]);}}}}
if(drw_symp==0){top.fmain.zSaveWithoutPopupSave=1;top.$("#save").trigger("click");loadExamsSummaryAll();}else{window.opener.top.fmain.zSaveWithoutPopupSave=1;window.opener.top.$("#save").trigger("click");window.opener.top.fmain.loadExamsSummaryAll();}
hide_modal("div_sc_con_detail");},"json");}else{hide_modal("div_sc_con_detail");}}else{hide_modal("div_sc_con_detail");}}
function showPhyNotes(val,evnt){$('[id^=physician_notes_div]').each(function(id,elem){$(elem).remove();});if(val==1){$.ajax({type:'POST',url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/physician_notes.php?ajax_request=yes&get_modal=yes',success:function(response){$("body").append(""+response);$('#physician_notes_div').show();}});}}
function donePtLExam(str){$("#tdPtLExam").html("L. Exm. "+str);}
function close_gh_window(){$('#genHealthDiv_wv').modal("hide");}
function ptInfoReviewed()
{if((finalize_flag==1&&isReviewable==0)||elem_per_vo=="1"){return;}
hideMedListExe("PMH",1);var o=top.fmain;var oFrmRewSt=o.gebi("elem_isFormReviewable");var oFrmFinz=o.gebi("elem_isFormFinalized");var oMasterId=o.gebi("elem_masterId");var mId="";var prm="elem_formAction=genHealthReviewd";if((oFrmFinz.value!="1")||(oFrmRewSt.value=="1")){if(typeof oMasterId.value!="undefined")mId=oMasterId.value;var msg_ownr=$("#tr_ownership_msg").data("msg");if(typeof(msg_ownr)!="undefined"&&msg_ownr!=""){prm+="&elem_owner_msg="+msg_ownr;}}
prm+="&elem_mId="+mId;$.post(top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',""+prm,function(data){if(data){if(data.noti_genhealth){$(".okayNav #general_health").removeClass();$(".okayNav #general_health").addClass(""+data.noti_genhealth);}
donePtLExam(data.tmp);close_gh_window();if(typeof(msg_ownr)!="undefined"&&msg_ownr!=""){var cc=$("#elem_ccompliant").val();cc=$.trim(cc);var ptrn="HPI was performed by([\\w ]+)\.";cc=regReplace(ptrn,"",cc);if(cc!=""){cc=cc+"\n";}
if(msg_ownr){cc=cc+msg_ownr;}
$("#elem_ccompliant").val(cc);if(data.proid){$("#elem_pro_id").val(data.proid);}
if(data.pro_nm){$("#elem_pro_name").val(data.pro_nm);}
if(data.cosignid){$("#elem_cosigner_id").val(data.cosignid);}
if(data.cosign_nm){$("#elem_cosigner_name").val(data.cosign_nm);}
$("#elem_ccompliant, #elem_chk").trigger("click");$("#elem_painCc").trigger("change");$("#elem_neuroPsych").trigger("click");}
top.$("#save").trigger("click");}},"json");}
function bind_datepicker()
{$("input.datepicker").datepicker({timepicker:false,format:top.jquery_date_format,maxDate:new Date(),autoclose:true,scrollInput:false});}
function getMRinfo_SC(){var sod="",sos="",cod="",cos="",aod="",aos="",tm="";var a=0;b=0;tm=0;$("#Vision input[name*=elem_mrNoneGiven").each(function(){var x=this.name.replace(/elem_mrNoneGiven/,"");var othr="";sfx="";if(x>1){othr="Other";if(x>2){sfx="_"+x;}}
var y=$("#Vision input[name=elem_providerName"+othr+sfx+"][class*=active]").length;if(this.checked&&y>0){if(a<x){a=x;}}else if(y>0){if(b<x){b=x;}}});if(a>0){tm=a;}
else if(b>0){tm=b;}
if(tm>0){var othr="";sfx="";if(tm>1){othr="Other";if(tm>2){sfx="_"+tm;}}
if($("#Vision input[name=elem_visMr"+othr+"OdS"+sfx+"]").length>0){sod=$("#Vision input[name=elem_visMr"+othr+"OdS"+sfx+"]").val();}
if($("#Vision input[name=elem_visMr"+othr+"OdC"+sfx+"]").length>0){cod=$("#Vision input[name=elem_visMr"+othr+"OdC"+sfx+"]").val();}
if($("#Vision input[name=elem_visMr"+othr+"OdA"+sfx+"]").length>0){aod=$("#Vision input[name=elem_visMr"+othr+"OdA"+sfx+"]").val();}
if($("#Vision input[name=elem_visMr"+othr+"OsS"+sfx+"]").length>0){sos=$("#Vision input[name=elem_visMr"+othr+"OsS"+sfx+"]").val();}
if($("#Vision input[name=elem_visMr"+othr+"OsC"+sfx+"]").length>0){cos=$("#Vision input[name=elem_visMr"+othr+"OsC"+sfx+"]").val();}
if($("#Vision input[name=elem_visMr"+othr+"OsA"+sfx+"]").length>0){aos=$("#Vision input[name=elem_visMr"+othr+"OsA"+sfx+"]").val();}}
return{"sod":sod,"sos":sos,"cod":cod,"cos":cos,"aod":aod,"aos":aos};}
function updateADTime(w){var saveForm="";w=$.trim(w);if(w==""||elem_per_vo=='1'||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
if(w=="Anes"){saveForm="updateAnesTime";}else if(w=="Dial"){saveForm="updateDialTime";}else if(w=="OOD"){saveForm="updateOODTime";}
if(saveForm==""){return;}
var wP="tdTitleIop";var Digital=new Date();var hours=Digital.getHours();var minutes=Digital.getMinutes();var seconds=Digital.getSeconds();var dt=Digital.getDate();if(dt<9){dt="0"+dt;}
var mnth=Digital.getMonth();mnth+=1;if(mnth<9){mnth="0"+mnth;}
var year=Digital.getFullYear();var dn="PM"
if(hours<12)
dn="AM"
if(hours>12)
hours=hours-12
if(hours==0)
hours=12
if(minutes<=9)
minutes="0"+minutes
if(seconds<=9)
seconds="0"+seconds
var ctime=hours+":"+minutes+dn
var cdt=mnth+"-"+dt+"-"+year;var url="saveCharts.php";var params="elem_saveForm=updateIOPTime";var f=gebi("elem_masterId");params+="&elem_formId="+f.value;params+="&w="+w;var p=gebi("elem_patientId");params+="&elem_patientId="+p.value;params+="&elem_newTime="+ctime;params+="&elem_newdt="+cdt;if(typeof(setProcessImg)!='undefined')setProcessImg("1",wP);$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0",wP);loadExamsSummary("iop_gon");});}
function showPrvSynthesis(tst,tid,intrprt){if(tst=="x"){return;}else if(tst=="VF-GL"){var divid="dv_vf_gl";var divsyn="dv_syn_vf_gl";}else if(tst=="OCT-RNFL"){var divid="dv_oct_rnfl";var divsyn="dv_syn_oct_rnfl";}
var op="";if(typeof(intrprt)!="undefined"&&intrprt==1){op="Interpret";}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,divid);$.get("saveCharts.php?elem_saveForm=showPrvSynthesis&tst="+tst+"&tid="+tid+"&op="+op,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,divid);if(op=="Interpret"){if(data==1){if(typeof(setProcessImg)!='undefined'){setProcessImg(1,"","Test is interpreted.","","",1800);}$("input[type=button][name='elem_btn"+tst+"Rwd']").hide();}else{top.fAlert("Error: Test is NOT interpreted.");}}else{if(data!=""){$("body").append(data);$('#modal_prev_synth').modal('show');}}});}
function tests_interpret(tst,tid){showPrvSynthesis(tst,tid,1);}
function go_test_tab(){top.$("#Tests").click();}
function getMemoTable(arrVal,addIndx,dfdt){var oTblCntr=gebi("elem_cntrTableMemo");var currRowId=((typeof oTblCntr.value!="undefined")&&(oTblCntr.value!=""))?parseInt(oTblCntr.value)+1:1;var url=zPath+"/chart_notes/requestHandler.php";var params="elem_formAction=add_memo&elem_cntrTableMemo="+currRowId;$.get(url,params,function(data){oTblCntr.value=currRowId;$("#memo_panel_grp").append(data);$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});cn_typeahead();});}
function remMemoTable(remIndx){if(confirm("Are you sure you want to delete it?")){if(remIndx>1){$("#memo"+remIndx).remove();}else{$("#memo"+remIndx+" :input").val("");}}}
function openPatientProblemsList(){var url=zPath+"/Medical_history/problem_list/patient_problems_list_popup.php";var n="childWinArScan";top.fmain.showOtherForms(url,n,810,600,0);}
function showcCChxpop(){var chk=$('#cchx_link').attr('title');if(typeof(chk)=="undefined"){if(typeof(setProcessImg)!='undefined')setProcessImg(1,"cchx_link");$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=showcCChxpop",function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"cchx_link");$('#cchx_link').popover({container:'body',title:"<strong>CC & History</strong>",content:""+data,html:true,placement:"bottom",animation:false});$("#cchx_link").on('shown.bs.popover',function(o){var hgt=window.innerHeight;var popover_id=$(this).attr('aria-describedby');var ptop=$("#"+popover_id+"").css("top")||0;hgt=parseInt(hgt)-parseInt(ptop)-50;$("#"+popover_id+"").css({'max-width':'90%','z-index':'99999999'});$("#"+popover_id+" .popover-content").css({'height':hgt+"px","overflow":"auto"});});$('#cchx_link').popover('show');$('#cchx_link').popover('hide');$('#cchx_link').popover('show');});}else{$('#cchx_link').popover('toggle');}}
function ccHxDefStr(str,op){var ptrn="\\s*(A|An)?((\\s*[0-9]{1,3}\\s*(Yr\\.|Yrs\\.|Year|Years|Months|Days|Mon\\.))?(\\s*old)?)?\\s*(Male|Female|male|female)?\\s*(with\\s*history\\s*of|patient|with\\s*chief\\s*complaint\\s*of)?\\s*";var reg=new RegExp(ptrn,"gi");if(op==1){return str.replace(reg,"");}else{return reg;}}
function get_reff_address_v2(obj){obj.title="";var str=$.trim(obj.value);if(str!=""){$.get(top.JS_WEB_ROOT_PATH+"/interface/chart_notes/requestHandler.php?elem_formAction=get_reff_address_v2&refnm="+str,function(d){if(d!=""){obj.title=""+d;}else{obj.title="";}});}}
function ptProbList_fillInDxDesc(obj,pth){var str="";if(obj&&(typeof obj.value!="undefined")){str=obj.value;}
if(typeof pth=="undefined"||pth==""){if(typeof(zPath)=="undefined"){zPath="";}
pth=""+zPath;}
if(str==""||!isDxCorrectCode(str)){return;}
var url=pth+"/chart_notes/requestHandler.php";params="elem_formAction=Dx";params+="&elem_desc="+encodeURI(str);if(typeof(setProcessImg)!='undefined')setProcessImg("1",""+obj.name);$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0",""+obj.name);var xmlDoc=data;var arrDxCode=xmlDoc.getElementsByTagName("dxcode");var arrDxCodeDesc=xmlDoc.getElementsByTagName("dxcodedesc");var arrPqriCode=xmlDoc.getElementsByTagName("pqri");var oDxCode=(arrDxCode.length>0)?xmlDoc.getElementsByTagName("dxcode")[0]:null;var oDxCodeDesc=(arrDxCodeDesc.length>0)?xmlDoc.getElementsByTagName("dxcodedesc")[0]:null;if((oDxCodeDesc)&&(oDxCodeDesc.firstChild)){var tDx=oDxCodeDesc.firstChild.data;tDx+=' - '+oDxCode.firstChild.data;obj.value=""+tDx;}},"xml");}
function pt_g_hc(obj){$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{elem_formAction:'show_goals_hc'},beforeSend:function(r){top.show_loading_image('show','','Please wait, loading data...');},complete:function(){top.show_loading_image('hide');},success:function(res){if($("#pt_goal_health_modal",top.fmain.document).length>0){$("#pt_goal_health_modal",top.fmain.document).remove();}
$("body",top.fmain.document).append(res);$("#pt_goal_health_modal",top.fmain.document).find('select').selectpicker();$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});$("#pt_goal_health_modal",top.fmain.document).modal('show');}});}
function pt_health(obj){$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{elem_formAction:'show_health_status'},beforeSend:function(r){top.show_loading_image('show','','Please wait, loading data...');},complete:function(){top.show_loading_image('hide');},success:function(res){if($("#pt_health_status_modal",top.fmain.document).length>0){$("#pt_health_status_modal",top.fmain.document).remove();}
$("body",top.fmain.document).append(res);$("#pt_health_status_modal",top.fmain.document).find('select').selectpicker();$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});$("#pt_health_status_modal",top.fmain.document).modal('show');}});}
function delete_goal(id,index)
{if(id)
{$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{elem_formAction:'del_goal',record_id:id},beforeSend:function(r){top.show_loading_image('show','','Please wait, Deleting Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){var r=res.split('_');if(r[0]==1)
$("#goal_row_"+index).remove();top.fAlert(r[1]);}});}
else
{$("#goal_row_"+index).remove();}}
function add_goals(_this)
{var html='';var addBtnObj=$("#add_goal_btn");var p_index=addBtnObj.data('rows');var c_index=p_index+1;var delBtn='<span class="glyphicon glyphicon-remove pointer" onclick="delete_goal(\'\',\''+p_index+'\');"></span>';html+='<tr id="goal_row_'+c_index+'">';html+='<td class="col-xs-3">';html+='<input type="hidden" name="goal_id['+c_index+']" id="goal_id_'+c_index+'" value="" />';html+='<input type="text" class="form-control" name="goal_set['+c_index+']" id="goal_set_'+c_index+'" value="" />';html+='</td>';html+='<td class="col-xs-1">';html+='<input type="text" class="form-control" name="goal_code['+c_index+']" id="goal_code_'+c_index+'" value="" />';html+='</td>';html+='<td class="col-xs-1">';html+='<input type="text" class="form-control" name="goal_data_type['+c_index+']" id="goal_data_type_'+c_index+'" value="" maxlength="5" />';html+='</td>';html+='<td class="col-xs-3">';html+='<input type="text" class="form-control" name="goal_data['+c_index+']" id="goal_data_'+c_index+'" value="" />';html+='</td>';html+='<td class="col-xs-1">';html+='<input type="text" class="form-control" name="goal_unit['+c_index+']" id="goal_unit_'+c_index+'" value="" />';html+='</td>';html+='<td class="col-xs-1">';html+='<input type="hidden" class="form-control" name="goal_opr_id['+c_index+']" id="goal_opr_id_'+c_index+'" value="'+authUserID+'" />';html+='<input type="text" class="form-control" name="goal_opr_name['+c_index+']" id="goal_opr_name_'+c_index+'" value="'+authUserNM+'" readonly />';html+='</td>';html+='<td class="col-xs-1">';html+='<div class="input-group">';html+='<input type="text" class="form-control date-pick" name="goal_date['+c_index+']" id="goal_date_'+c_index+'" value="" />';html+='<label class="input-group-addon" for="goal_date_'+c_index+'"><i class="glyphicon glyphicon-calendar"></i></label>';html+='</div>';html+='</td>';html+='<td >&nbsp;</td>';html+='</tr>';$("#goal_row_"+p_index).find('td:last').html(delBtn);$("#goal_row_"+p_index).after(html);$("#goal_row_"+c_index).find('select.selectpicker').selectpicker();addBtnObj.data('rows',c_index);$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});}
function save_goals()
{var formObj=$("#goalDataDiv",top.fmain.document).find('input, select');var formData=formObj.serialize()+'&elem_formAction=save_goal';$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:formData,beforeSend:function(r){top.show_loading_image('show','','Please wait, Saving Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){$("#goalDataDiv",top.fmain.document).html(res).find('select').selectpicker();$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});}});}
function add_health_status(type)
{var html='';var addBtnObj=$("#add_hs_btn_"+type);var p_index=addBtnObj.data('rows');var c_index=p_index+1;var delBtn='<span class="glyphicon glyphicon-remove pointer" onclick="del_pt_health_status(\'\',\''+p_index+'\',\''+type+'\');"></span>';html+='<tr id="hs_row_'+type+c_index+'">';html+='<td class="col-xs-3">';html+='<input type="hidden" name="'+type+'_id['+c_index+']" id="'+type+'_id_'+c_index+'" value="" />';html+='<input type="text" class="form-control" name="'+type+'_status_text['+c_index+']" id="'+type+'_status_text_'+c_index+'" value="" />';html+='</td>';html+='<td class="col-xs-1">';html+='<input type="text" class="form-control" name="'+type+'_ccd_code['+c_index+']" id="'+type+'_ccd_code_'+c_index+'" value="" />';html+='</td>';html+='<td width="10%">';html+='<div class="input-group">';html+='<input type="text" class="form-control date-pick" name="'+type+'_status_date['+c_index+']" id="'+type+'_status_date_'+c_index+'" value="" />';html+='<label class="input-group-addon" for="'+type+'_status_date_'+c_index+'"><i class="glyphicon glyphicon-calendar"></i></label>';html+='</div>';html+='</td>';html+='<td width="3%" >&nbsp;</td>';html+='</tr>';$("#hs_row_"+type+p_index).find('td:last').html(delBtn);$("#hs_row_"+type+p_index).after(html);$("#hs_row_"+type+c_index).find('select.selectpicker').selectpicker();addBtnObj.data('rows',c_index);$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});}
function save_health_status()
{var formObj=$("#pt_health_status_data_div",top.fmain.document).find('input, select');var formData=formObj.serialize()+'&elem_formAction=save_health_status';$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:formData,beforeSend:function(r){top.show_loading_image('show','','Please wait, Saving Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){$("#pt_health_status_data_div",top.fmain.document).html(res).find('select').selectpicker();$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});}});}
function del_pt_health_status(id,index,type)
{if(id)
{$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{elem_formAction:'del_pt_health_status',record_id:id},beforeSend:function(r){top.show_loading_image('show','','Please wait, Deleting Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){var r=res.split('_');if(r[0]==1)
$("#hs_row_"+type+index).remove();top.fAlert(r[1]);}});}
else
{$("#hs_row_"+type+index).remove();}}
function enableField(_this)
{var obj=$("#goal_unit_"+$(_this).data('index'));if($(_this).val()=='range')
obj.prop('disable',false);else obj.prop('disable',true);}
function save_hc()
{var formObj=$("#hcDataDiv",top.fmain.document).find('input, select');var formData=formObj.serialize()+'&elem_formAction=save_hc';$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:formData,beforeSend:function(r){top.show_loading_image('show','','Please wait, Saving Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){$("#hcDataDiv",top.fmain.document).html(res);$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});}});}
function delete_hc(type,id,index,parent_index)
{type=type||'';parent_index=parent_index||'';index=index|'';var p_index=parent_index?parent_index+'_':'';var row='';if(type=='obs')row='hc_row_'+index;else if(type=='con')row='con_'+p_index+index;else if(type=='rel')row='rel_'+p_index+index;if(id)
{$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{'elem_formAction':'del_hc','type':type,'record_id':id},beforeSend:function(r){top.show_loading_image('show','','Please wait, Deleting Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){var r=res.split('_');if(r[0]==1&&index&&row)
$("#"+row).remove();top.fAlert(r[1]);}});}
else
{if(index&&row)
$("#"+row).remove();}}
function chart_set_attestation(indx){var btn="";if(indx==1){btn="btn_attest_scribe";}else if(indx==2){btn="btn_attest_attend_scribe";}else if(indx==3){btn="btn_attest_teach";}
if(btn!=""){var msg=$("#"+btn).data("msg");var attested=$("#"+btn).data("attested");var proId=authUserID;var formId=$("#elem_masterId").val();if((attested==""||typeof(attested)=="undefined")&&typeof(msg)!="undefined"&&msg!=""){if((finalize_flag!=1||isReviewable!=0)&&elem_per_vo!="1"){var url="saveCharts.php";param="elem_saveForm=setAttestation&proId="+proId+"&msg="+msg+"&formId="+formId+"&indx="+indx;$.post(url,param,function(data){$("#"+btn).removeClass("btn-warning").addClass("btn-success");$("#"+btn).data("attested","1");$("#"+btn).data("msg",""+msg);if(indx==3){$("input[name=elem_resiHxReviewd]").val(1);$("#assessplan #spnRxHxRvd").addClass("active");}});}}
if(msg!=""){$('#'+btn).popover('destroy');$('#'+btn).popover({'title':"",'content':""+msg,'html':true});$('#'+btn).popover('toggle');}}}
function change_attending_phy(o){var id=o.value;if(id!=""){if((finalize_flag!=1||isReviewable!=0)&&elem_per_vo!="1"){var formId=$("#elem_masterId").val();var url="saveCharts.php";param="elem_saveForm=setAttestation&new_pro_Id="+id+"&formId="+formId;if(typeof(setProcessImg)!='undefined')setProcessImg(1,"el_change_attending");$.post(url,param,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"el_change_attending");if(data){if(data.btn_attest_scribe&&typeof(data.btn_attest_scribe)!="undefined"&&data.btn_attest_scribe!=""){$("#btn_attest_scribe").data("msg",""+data.btn_attest_scribe);}
if(data.btn_attest_attend_scribe&&typeof(data.btn_attest_attend_scribe)!="undefined"&&data.btn_attest_attend_scribe!=""){$("#btn_attest_attend_scribe").data("msg",""+data.btn_attest_attend_scribe);}}},"json");}}}
function rvs_sep_usr_coments(){var x1="",x2="";var x=$.trim($('#elem_ccompliant').val());var DBLCIRCLE=String.fromCharCode(9678);var w=x.indexOf(DBLCIRCLE);if(w!=-1){x1=x.substring(w);x1=$.trim(x1.replace(DBLCIRCLE,""));x2=$.trim(x.substring(0,w));}else if(x!=""){x2=x;}
return{'COM':x1,'CCHX':x2};}
function rvs_mk_cchx_readonly(){$('#elem_ccompliant').prop('readonly',true).bind('click',function(){var o_cchx_com=rvs_sep_usr_coments();var str_modal='<!-- Modal -->'+'<div id=\'cchxModal\' class=\'modal fade\' role=\'dialog\'>'+'<div class=\'modal-dialog modal-lg\'>'+'<!-- Modal content-->'+'<div class=\'modal-content\'>'+'<div class=\'modal-header\'>'+'<button type=\'button\' class=\'close\' data-dismiss=\'modal\'></button>'+'<h4 class=\'modal-title\'>Enter comments into chief complaint </h4>'+'</div>'+'<div class=\'modal-body\'>'+'<p>'+o_cchx_com.CCHX+'</p>'+'<p><textarea id=\'ta_ccHX_com_modal\' class=\'form-control\' rows=\'5\'>'+o_cchx_com.COM+'</textarea></p>'+'</div>'+'<div class=\'modal-footer\'>'+'<button type=\'button\' class=\'btn btn-success\' >Done</button>'+'<button type=\'button\' class=\'btn btn-danger\' data-dismiss=\'modal\'>Close</button>'+'</div>'+'</div>'+'</div>'+'</div>';$('body').append(str_modal);$('#cchxModal .btn-success').bind('click',function(){var x=$.trim($('#ta_ccHX_com_modal').val());var y=$.trim(o_cchx_com.CCHX);if(x!=""){if(y!=""){y+='\n';}
var DBLCIRCLE=String.fromCharCode(9678);y+=DBLCIRCLE+' '+x;}
$('#elem_ccompliant').val(y).triggerHandler('click');$('#cchxModal').modal('hide');});$('#cchxModal').modal({backdrop:false});$('#ta_ccHX_com_modal').focus();});}
function save_inpatient()
{var formObj=$("#inpatientDataDiv",top.fmain.document).find('input, select');var formData=formObj.serialize()+'&elem_formAction=save_inpatient';$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:formData,beforeSend:function(r){top.show_loading_image('show','','Please wait, Saving Record(s)...');},complete:function(){top.show_loading_image('hide');},success:function(res){$("#inpatientDataDiv",top.fmain.document).html(res);}});}
function ptPayerModal(callFrom){if(callFrom=='')callFrom='get';switch(callFrom){case'get':$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php?elem_formAction=getPtPayer',type:'GET',beforeSend:function(){top.show_loading_image('show');},success:function(response){if(response!=''){$('#patient_payer_modal').find('#patientPayerDiv').html(response);$('.selectpicker').selectpicker('refresh');$('.datePickIn').datepicker({dateFormat:"mm-dd-yy"});}},complete:function(){top.show_loading_image('hide');}});break;case'save':var dat=$("#patientPayerDiv").find('input,select').serialize();$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php?elem_formAction=savePtPayer',data:dat,type:'POST',beforeSend:function(){top.show_loading_image('show');},success:function(response){if(response!=''){$('#patient_payer_modal').find('#patientPayerDiv').html(response);$('.selectpicker').selectpicker('refresh');$('.datePickIn').datepicker({dateFormat:"mm-dd-yy"});}},complete:function(){top.show_loading_image('hide');}});break;}}
function showAsHx(flg){if(flg==1){if($("#divAsHx").length<=0){var fid=$("#elem_masterId").val();if(typeof(setProcessImg)=="function")setProcessImg("1","assessplan");$.get("requestHandler.php",{"elem_formAction":"showAsHxNew","fid":fid},function(data){if(typeof(setProcessImg)=="function")setProcessImg("0","assessplan");if(data!=""){$("body").append(data);$("#divAsHx").css({"display":"block"});$("#divAsHx").draggable({handle:".panel-heading"})
$("#divAsHx .panel-body").css({'overflow':'auto','height':$(window).height()-50});$("#divAsHx .panel-heading").css({'cursor':'move'});}});}else{$("#divAsHx").show();}}else{$("#divAsHx").hide();}}
function update_toolbar_icon(){$.get("requestHandler.php",{"elem_formAction":"update_icons"},function(d){if(d){for(var a in d){if(d[a]!=null){$("li#"+a).removeClass("cbred cbgreen cborange").addClass(d[a]);}}}},'json');}
function show_ad_div(op){if(typeof(op)=="undefined"){op=0;}
if(op=="1"){hide_modal("advancedDirectiveModal");}
else if(op=="2"){var adoval=$("#ado_option").val();show_ad_div(1);if(typeof(setProcessImg)=="function")setProcessImg("1");$.post("saveCharts.php",{"elem_saveForm":"save_advance_directive","ado_option":""+adoval},function(d){if(typeof(setProcessImg)=="function")setProcessImg("0");if(typeof(d)!="undefined"&&d!=""){$("#ad_dir").html(d);}});}else{if(typeof(setProcessImg)=="function")setProcessImg("1");$.get("requestHandler.php?elem_formAction=get_adv_directive",function(d){if(typeof(setProcessImg)=="function")setProcessImg("0");if(d&&d!=""){$("body").append(d);$("#advancedDirectiveModal").modal("show");$("#advancedDirectiveModal .menu_advdirective a").bind("click",function(){$("#ado_option").val($(this).data("val"));});}});}}
function show_pop_up_pt_alert(msg){var a="divPtDemographicAlertWV";if(typeof(top.patient_pop_up)=="undefined"){top.patient_pop_up=new Array();}
if(msg!=""&&(jQuery.inArray(a,top.patient_pop_up)=="-1")){top.fAlert('<div style="max-height:450px;overflow-y:scroll;">'+msg+'</div>','Patient Notes');top.patient_pop_up[top.patient_pop_up.length]=a;}}
function hideWVSxDiv(id){var e=event;id=id||'';if(typeof id==='undefined')id='';if(!id)return;var container=$("#"+id);if(!container.is(e.target)&&container.has(e.target).length===0&&container.css('display')!=='none'){container.hide();}}
$(document).mouseup(function(e){hideWVSxDiv('surgeryDiv');});function show_iop_graphs(flg,vision){if(typeof(flg)!="undefined"&&flg==1){if($("#iol_graph_doc").length>0){$("#iol_graph_doc").remove();}else if(top.$("#iol_graph_doc").length>0){top.$("#iol_graph_doc").hide().remove();}return;}
if($("#iol_graph_doc").length<=0){var v=(typeof(vision)!="undefined"&&vision!="")?"&vision="+vision:"";$("body").append("<div id='iol_graph_doc'><iframe id=\"ifrm_iop_graph\" src=\""+zPath+"/chart_notes/view/iop_graphs.php?inc_glbl=1"+v+"\" border=\"0\" height=\"100%\" width=\"100%\" scrolling=\"0\"></iframe></div>");}$("#iol_graph_doc").show();}
function pging_cn_dig(st){if(isNaN(st)&&typeof(st.value)!="undefined"){st=st.value;}else if(isNaN(st)){st=0;}
var url=top.JS_WEB_ROOT_PATH+"/interface/chart_notes/requestHandler.php";$.get(url,{elem_formAction:"PtAtAGlancePopUp",limit_records:"1","st":st},function(resp){resp=$.parseJSON(resp);$('#pgd_showpop',top.fmain.document).html(resp.data)
if(typeof(top.fmain.setHgtGrpDiv)=='function'){top.fmain.setHgtGrpDiv();}
var sh=0;$('#pgd_showpop').find('table:not(:last-child)').each(function(){sh+=$(this).height();});$('#pgd_showpop .modal-body',top.fmain.document).scrollTop(0).scrollTop(sh-50);});stopClickBubble();}
function role_change_options(o,h){if(typeof(h)!="undefined"&&h==1){$("#legendDiv .clickable").popover('hide');return;}
if(typeof($(o).attr("aria-describedby"))=="undefined"){var x=top.$("#li_rc").html();x=x.replace("<h4><label class=\"\">Role as</label>","");x=x.replace(/change_role\(this\)/g,"top.change_role(this,1)");$(o).unbind("click").popover({title:"Role Change<small>Unsaved data will be lost.</small><span class=\"glyphicon glyphicon-remove pull-right\" onclick=\"role_change_options('',1)\"></span>",content:""+x,html:true,placement:"top"});$(o).popover('show');$("#legendDiv input[name=el_usr_role]").each(function(){this.checked=(this.value==logged_user_type)?true:false;});}}
function show_pgd(){var ob=$("#pgd_showpop");if(ob.length>0){var c=ob.css('display');if(c=='none')ob.show();}}
function setHgtGrpDiv(){var len=$("div[id*=div_assess_]").length;for(var i=0;i<len;i++){var oAssess=document.getElementById("div_assess_"+i);var oPlan=document.getElementById("div_plan_"+i);if(oAssess&&oPlan){var len2=oAssess.childNodes.length;for(var j=0;j<len2;j++){var odivAssess=oAssess.childNodes[j];var odivPlan=oPlan.childNodes[j];if(odivAssess||odivPlan){var hgtAssess=(odivAssess&&(typeof odivAssess.offsetHeight!="undefined"))?odivAssess.offsetHeight:15;var hgtPlan=(odivPlan&&(typeof odivPlan.offsetHeight!="undefined"))?odivPlan.offsetHeight:15;var tmp="";if((hgtAssess>hgtPlan)){tmp=hgtAssess;}else{tmp=hgtPlan;}
tmp=parseInt(tmp)+parseInt(15);if(odivAssess){odivAssess.style.height=""+tmp+"px";}
if(odivPlan){odivPlan.style.height=""+tmp+"px";}}}}}}
function show_inpatient_data(){$.ajax({url:top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php',type:'post',data:{elem_formAction:'show_inpatient_data'},beforeSend:function(r){top.show_loading_image('show','','Please wait, loading data...');},complete:function(){top.show_loading_image('hide');},success:function(res){if($("#inpatient_modal",top.fmain.document).length>0){$("#inpatient_modal",top.fmain.document).remove();}
$("body",top.fmain.document).append(res);$("#inpatient_modal",top.fmain.document).find('select').selectpicker();$(".date-pick").datepicker({dateFormat:z_js_dt_frmt});$("#inpatient_modal",top.fmain.document).modal('show');}});}
function show_pt_payer(){var html='';html+='<div id="patient_payer_modal" class="modal fade" role="dialog">';html+='<div class="modal-dialog modal-lg" style="width:80%;">';html+='<!-- Modal content-->';html+='<div class="modal-content">';html+='<div class="modal-header bg-primary">';html+='<button type="button" class="close" data-dismiss="modal"></button>';html+='<h4 class="modal-title">Patient Payer</h4>';html+='</div>';html+='<div class="modal-body">';html+='<div id="selectContainer" style="position:absolute;"></div>';html+='<div class="row">';html+='<div class="col-sm-12" id="patientPayerDiv">';html+='</div>';html+='</div>';html+='</div>';html+='<div id="module_buttons" class="ad_modal_footer modal-footer">';html+='<button type="button" class="btn btn-success" onclick="top.fmain.ptPayerModal(\'save\');">Save Patient Payer</button>';html+='<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';if($("#patient_payer_modal",top.fmain.document).length>0){$("#patient_payer_modal",top.fmain.document).remove();}
$("body",top.fmain.document).append(html);top.fmain.ptPayerModal();$('#patient_payer_modal').modal('show');}
function showSocialForm(){$("#socialBody #socialDataTbl, #socialGHDiv #edit_icon").addClass('hidden');$("#socialBody #socialForm, #socialGHDiv #close_icon, #socialGHDiv #save_icon").removeClass('hidden');if(!$("#social").hasClass('in')){$("#socialGHDiv").find('h4').trigger('click');}
scroll_div();}
function hideSocialForm(){$("#socialBody #socialForm, #socialGHDiv #close_icon, #socialGHDiv #save_icon").addClass('hidden');$("#socialBody #socialDataTbl, #socialGHDiv #edit_icon").removeClass('hidden');if(!$("#social").hasClass('in')){$("#socialGHDiv").find('h4').trigger('click');}}
function scroll_div(){var obj=$("#genHealthDiv_wv").find('.modal-body');obj.animate({scrollTop:obj.scrollTop()+$("#socialGHDiv").offset().top},1000);}
function saveSocialForm(){var frm=$("#socialBody").find("#genHlthSocialForm");var data=frm.serialize();var chk=chkSocialFrmChange();if(chk)
{var url=top.JS_WEB_ROOT_PATH+'/interface/chart_notes/requestHandler.php';$.post(url,data).done(function(r){r=$.parseJSON(r);if(r.success){$("#socialBody #socialDataTbl").html(r.data.html);$("#socialBody #socialForm").html(r.data.form_data);hideSocialForm();$('#genHealthDiv_wv').find('select.selectpicker').selectpicker();$('#genHealthDiv_wv').find("input.datepicker").datepicker({dateFormat:z_js_dt_frmt});}
else{var m='Error occured..Please try again';top.fAlert(m);}});}
else{hideSocialForm();}}
function cancelSocialFrmEditing(){var chk=chkSocialFrmChange();if(chk){var m="There is change in the social information! Would you like to save and continue?"
top.fancyConfirm(m,'','top.fmain.saveSocialForm();','top.fmain.resetSocialForm();');}else{hideSocialForm();}}
function chkSocialFrmChange(){var frm=$("#socialBody").find("#genHlthSocialForm");var inputs=frm.find('input,select,textarea');var chk_change=false;$.each(inputs,function(i,v){var t=v.type;var c_val=$(v).val();var o_val=$(v).data('prev');if(t=='checkbox'){c_val=$(v).is(':checked')?'checked':'';o_val=$(v).data('prev');}
o_val=$.trim(o_val);c_val=$.trim(c_val);if(c_val!==o_val&&v.name!=='elem_formAction'){chk_change=true;}});return chk_change;}
function resetSocialForm(){var frm=$("#socialBody").find("#genHlthSocialForm");var inputs=frm.find('input,select,textarea');$.each(inputs,function(i,v){var t=v.type;var c_val=$(v).val();var o_val=$(v).data('prev');if(t=='checkbox'){c_val=$(v).is(':checked')?'checked':'';o_val=$(v).data('prev');}
c_val=$.trim(c_val);o_val=$.trim(o_val);if(c_val!==o_val){if(t=='checkbox'){var c=(o_val=='checked')?true:false;$(v).prop('checked',c);}
else if(t=='select-multiple'){var d=o_val.split(',');d=d.join(',');$(v).selectpicker('val',d);}
else{$(v).val(o_val);}}});hideSocialForm();}
function save_sur_ocu(o){if(elem_per_vo=="1"){return;}
if(finalize_flag=="1"&&isReviewable!="1"){top.fmain.setSavedBtn("1","Saving Surgical Ocular Hx..");var v=o.checked?1:0;var strsave="elem_saveForm=save_sur_ocu&elem_sur_ocu_hx="+v;$.post("saveCharts.php",strsave,function(d){top.fmain.setSavedBtn("0");});}else{top.$("#save").click();}}
function set_new_carry(flgdone){if(elem_per_vo=="1"||(finalize_flag=="1"&&isReviewable!="1")){return;}
if(typeof(zPath)=="undefined")zPath="";var u=zPath;var qry="";if(typeof flgdone!="undefined"&&flgdone=="1"){var cr_fwd_id=$("#sl_pt_dos_modal :checked[id*=el_nfc_ds]").val();if(typeof cr_fwd_id!="undefined"&&cr_fwd_id!=""){top.show_loading_image('show','','Loading...');qry="&set_cf_form_id="+cr_fwd_id;$.get(u+"/chart_notes/requestHandler.php?elem_formAction=set_crfrwd_id"+qry,function(d){window.location.reload();});}else{top.fAlert("Please select DOS!");}
return;}
qry="&cur_cf_form_id="+$("#cryfwd_form_id").val()+"&cur_form_id="+$("#elem_masterId").val();if($("#sl_pt_dos_modal").length>0){var t=$("#el_filter_pro").val()||"";qry+="&el_filter_pro="+t;t=$("#el_filter_facility").val()||"";qry+="&el_filter_facility="+t;$("#sl_pt_dos_modal").modal('hide');$("#sl_pt_dos_modal, .modal-backdrop").remove();}
top.show_loading_image('show','','Loading...');$.get(u+"/chart_notes/requestHandler.php?elem_formAction=get_dos_prompt"+qry,function(d){$("body").append(d);var hgt=parseInt($(window).height()*70/100);$("#sl_pt_dos_modal .dos_cf").css({"height":hgt+"px","overflow":'auto'});$("#sl_pt_dos_modal").modal("show");$("#sl_pt_dos_modal").draggable();top.show_loading_image('hide');});}
var send_to_ibra=0;function cnct_ibra(flg_snd_dt){if(elem_per_vo=="1"||(finalize_flag=="1"&&isReviewable!="1")){return;}
var a1=$("#el_lasik_trgt_method").val(),a2=$("#el_visLasikTrgtDate").val(),a3=$("#el_lasik_trgt_intervention").val();if(typeof(a1)=="undefined"||a1==""||typeof(a2)=="undefined"||a2==""||typeof(a3)=="undefined"||a3==""){top.fAlert("Please enter Lasik data!");return;}
if(typeof(zPath)=="undefined")zPath="";var u=zPath;if(typeof flg_snd_dt!="undefined"){top.show_loading_image('show');var param="elem_formAction=ibra_case&elem_ibra_action=send_lasik";$.post(u+"/chart_notes/requestHandler.php",param,function(d){top.show_loading_image('hide');if(typeof(d)!="undefined"&&d=='-1'){top.fAlert("Lasik data is sent to IBRA!");}});}else{send_to_ibra=1;top.$("#save").trigger("click");}}
function service_eligibility_check(obj){if($(obj).is(':checked')==true){$(obj).val(1);$(obj).prop('checked',true);}
else{$(obj).val(0);$(obj).prop('checked',false);}}
function dssLoadTiuTitles(){var $select=$('#dssTiuTitle');$.ajax({url:top.JS_WEB_ROOT_PATH+"/interface/core/ajax_handler.php?task=dssLoadTiuTitles",type:'GET',}).done(function(response){$select.append(response);});}
var clMs_mvFrom="";function click2MoveSign(a){if(finalize_flag==1&&isReviewable!=1){return;}
if(clMs_mvFrom==""){clMs_mvFrom=a;$(".divsign .signernm").css("color","green");$("#sign_phy"+a+" .signernm").css("color","red");}else{if(clMs_mvFrom!=a){var arr=["elem_signCoords","hdSignCoordsOriginal","elem_is_user_sign","elem_is_phy_sign","elem_sign_path","elem_physicianIdName","elem_physicianId"];var tmp="";for(var z in arr){tmp="";tmp=$(":input[name="+arr[z]+a+"]").val();$(":input[name="+arr[z]+a+"]").val($(":input[name="+arr[z]+clMs_mvFrom+"]").val());$(":input[name="+arr[z]+clMs_mvFrom+"]").val(tmp);}
tmp=$("#td_signature_applet"+a).parent().html();$("#td_signature_applet"+a).parent().html($("#td_signature_applet"+clMs_mvFrom).parent().html());$("#td_signature_applet"+clMs_mvFrom).parent().html(tmp);if($("#lbl_phy_sig"+a).hasClass("clickable")&&!$("#lbl_phy_sig"+clMs_mvFrom).hasClass("clickable")){$("#lbl_phy_sig"+a).removeClass("clickable").unbind("click");$("#lbl_phy_sig"+a)[0].onclick=function(){};$("#lbl_phy_sig"+clMs_mvFrom).addClass("clickable").bind("click",function(){getPhySign_db(clMs_mvFrom);});}else if(!$("#lbl_phy_sig"+a).hasClass("clickable")&&$("#lbl_phy_sig"+clMs_mvFrom).hasClass("clickable")){$("#lbl_phy_sig"+a).addClass("clickable").bind("click",function(){getPhySign_db(a);});$("#lbl_phy_sig"+clMs_mvFrom).removeClass("clickable").unbind("click");$("#lbl_phy_sig"+clMs_mvFrom)[0].onclick=function(){};}
if($("#sign_phy"+a+" i").length>0||$("#sign_phy"+clMs_mvFrom+" i").length>0){tmp=$("#sign_phy"+a+" i").html();$("#sign_phy"+a+" i").html($("#sign_phy"+clMs_mvFrom+" i").html());$("#sign_phy"+clMs_mvFrom+" i").html(tmp);}}
$(".divsign .signernm").css("color","#663366");clMs_mvFrom="";}}
function show_review_detail(o){var id=$(o).data("lstid"),secName=$(o).data("scnm"),opId=$(o).data("opid"),dateTime=$(o).data("dtm");if(typeof(id)=="undefined"){id="";}
if(typeof(secName)=="undefined"){secName="";}
if(typeof(opId)=="undefined"){opId="";}
if(typeof(dateTime)=="undefined"){dateTimes="";}
var parWidth=document.body.clientWidth;top.popup_win(zPath+'/Medical_history/review_details.php?masterId='+id+'&secName='+secName+'&opId='+opId+'&dateTime='+dateTime,'medHXReviwed','toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width='+parWidth+',height=520');}
function show_staging_link(id){var ass_id="";var show_staging="";if(id.indexOf("elem_assessment_dxcode")!=-1){ass_id=id;}else if(id.indexOf("elem_assessment")!=-1){ass_id=id.replace("elem_assessment","elem_assessment_dxcode");if($("#"+ass_id).val()==""){ass_id=id.replace("elem_assessment_dxcode","elem_assessment");}}else if(id.indexOf("elem_dxCode")!=-1){ass_id=id;}
if(ass_id!=""){var ass_val=($("#"+ass_id).val()).split('.');if($.trim(ass_val[0])=='H40'||$.trim(ass_val[0])=='h40'){show_staging=$("#"+ass_id).val();}else{ass_val=(ass_val[0]).split(':');if($.trim(ass_val[1])=='H40'||$.trim(ass_val[1])=='h40'){show_staging=$("#"+ass_id).val();}}}
return show_staging;}
function cn_isFulldxAdded(ob){var fldid04=""+ob.id;var dxdb=$("#"+fldid04).data("valbakdb");var dxdsc=$("#"+fldid04).data("valdxdesc");var st1srch=""+$("#"+fldid04).data("val1stsrch");var srchval=""+$("#"+fldid04).data("valsrchd").toUpperCase().trim();var ar_st1srch=st1srch.split(",");st1srch=$.trim(ar_st1srch[ar_st1srch.length-1]);st1srch=st1srch.toUpperCase().trim();$("#"+fldid04).removeData("val1stsrch");if(typeof(dxdb)!="undefined"&&typeof(dxdsc)!="undefined"){if(""+st1srch!=""+srchval&&srchval.indexOf("-")==-1){if(ob.id.indexOf("elem_assessment")!=-1&&ob.id.indexOf("_dxcode")==-1){ob.value=dxdsc;$(ob).triggerHandler("blur");$(ob).triggerHandler("change");var dx_id=ob.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+dx_id).val(srchval);}else if(ob.id.indexOf("elem_assessment_dxcode")!=-1){ob.value=srchval;var as_id=ob.id.replace("elem_assessment_dxcode","elem_assessment");if($.trim($("#"+as_id).val())==""&&$("#"+as_id).length>0){$("#"+as_id).val(dxdsc);$("#"+as_id).triggerHandler("blur");$("#"+as_id).triggerHandler("change");}}else{ob.value=srchval;}
return true;}}
return false;}
function getIEtextareaCaret(el){var start=0;if(typeof(el.createTextRange)=="function"&&document.selection&&typeof(document.selection.createRange())!="undefined"){var range=el.createTextRange(),range2=document.selection.createRange().duplicate(),range2Bookmark=range2.getBookmark();range.moveToBookmark(range2Bookmark);while(range.moveStart('character',-1)!==0){start++;}}else if(el.selectionStart){var val=el.value;start=val.slice(0,el.selectionStart).length;}else{start=el.length;}
if(typeof(start)=="undefined"){start=0;}
return start;}
function jq_extractLast(term,side,o){var term_full=term;var cat=getIEtextareaCaret(o);term=term.substring(0,cat);var n0=term.lastIndexOf("\n");term=$.trim(term);var ret="",ret2="";if(side==1){ret=""+$.trim(term.substring(n0+1));}else if(side==2){ret=""+$.trim(term.substring(0,n0))+"\n";srch=""+$.trim(term.substring(n0+1));ret2=""+$.trim(term_full.substring(n0))+"";cat=cat-srch.length;}
if(ret2.length>0){ret2=ret2.replace(srch,"");}
if(cat<0){cat=0;}
return(side==2)?[ret,ret2,cat,srch]:ret;}
function jq_getStarter(term){var r="";var o=new RegExp("^(\\-|((\\d+|\\w)\\.))","i");if(o.test(term)){r=o.exec(term);r=r[0];term=term.replace(o,"");term=$.trim(term);}
return[r,term];}
function cn_rem_escp_char(s){if(s!=""){s=s.replace(/\\'/g,"'");s=s.replace(/\\&/g,"&");}
return s;}
function cn_adjustSearchValue(hystck,ndl){var ar_ndl=ndl.split(" ");var last_ndl="",flgFull=0;if(ar_ndl.length>1){last_ndl=ar_ndl[ar_ndl.length-1];}
if(hystck.toLowerCase().indexOf(ndl.toLowerCase())!=-1||flgFull==1){return hystck;}else{var tmp="";if(last_ndl!=""&&hystck.toLowerCase().indexOf(last_ndl.toLowerCase())!=-1){ar_ndl.length=ar_ndl.length-1;var tmp=ar_ndl.join(" ");if($.trim(tmp)!=""){tmp=tmp+" ";}}
return tmp+hystck;}}
var chk_term_length=function(term){var art=term.split(" "),art_ln=art.length;if(art_ln>0){var t=$.trim(art[art_ln-1]);if(t.length<3){return false;}}
return true;};var cn_ta1_no_assess=function(ota1,strExamName){if(typeof(strExamName)=="undefined"){strExamName="";}
$(ota1).autocomplete({source:function(request,response){var mode="";if(this.element[0].name&&typeof(this.element[0].name)!="undefined"&&(this.element[0].name=="elem_visMrDesc"||this.element[0].name.indexOf("elem_visMrDescOther")!=-1)){var tmpICD10=$("#hid_icd10").val();tmpICD10=(tmpICD10==1)?1:0;mode="&mode=MR&ICD10="+tmpICD10;}
var str_prfx="";if(typeof(top.JS_WEB_ROOT_PATH)!="undefined"){str_prfx=top.JS_WEB_ROOT_PATH+"/interface/chart_notes/";}
$.getJSON(str_prfx+"requestHandler.php?elem_formAction=TypeAhead"+strExamName+mode,{term:jq_extractLast(request.term,1,this.element[0])},response);},search:function(){var term=jq_extractLast(this.value,1,this);var o=jq_getStarter(term);this.strter=o[0];return chk_term_length(term);},minLength:3,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){arr=ui.item.value.split("~~");ui.item.value=arr[0];var t=jq_extractLast(this.value,2,this);var r=""+ui.item.value;r=cn_adjustSearchValue(r,t[3]);if(this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t[0]+""+r+t[1]);if(typeof(setCursorAtEnd)!="undefined"){setCursorAtEnd(this,t[2]+r.length);}
$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");return false;}}}).filter("textarea[id^=elem_plan]").each(function(){$(this).triggerHandler('keyup');});};function cn_typeahead_order(){var ta3=function(ota3){$(ota3).autocomplete({source:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=getorder&req_ptwo=1",minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var r=""+ui.item.value;this.value=$.trim(""+r);$(this).parent().find(":hidden[id*=med_id]").val(ui.item.id);$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");return false;}}});};$("input[type=text][id*=ele_order_name]").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta3(this);};});}
function cn_ta_cvf_ag(ptrn){$(ptrn).bind("focus",function(){if(!$(this).hasClass("ui-autocomplete-input")){cn_ta1_no_assess(this,"");};});}
function cn_typeahead(flg){var browser=navigator.appName;var b_version=navigator.appVersion;var version=parseFloat(b_version);if(typeof(rv_lens_used)!="undefined"){rv_lens_used();}
var strExamName="";var ptrntextbox="";if(typeof(examName)!="undefined"&&(examName!="")){strExamName="&exmnm="+examName;ptrntextbox=",input[name][type=text]:not(.mulPressure input[name][type=text])";}
if(version!=4){$("textarea[name]:not(textarea[name^='elem_assessment'])"+ptrntextbox).bind("focus",function(){if(!$(this).hasClass("ui-autocomplete-input")){cn_ta1_no_assess(this,strExamName);};});$("#assessplan .col-sm-12-pl textarea[name^='elem_plan'], #commentsForPatient, #elem_consult_reason, #PC  textarea[name^='elem_visPcDesc'], #MR  textarea[name^='elem_visMrDesc'], #elem_notes").each(function(){$(this).triggerHandler('keyup');});getDataFilePath='requestHandler.php?elem_formAction=TypeAhead&mode=assessment&callFrom=wv';var flg_LitSev="";var ta2=function(ota2){$(ota2).bind("keydown",function(event){}).autocomplete({open:function(event,ui){$(ota2).autocomplete("widget").css("width",parseInt($(window).width()*3/4)+"px");},source:function(request,response){showMode="ap";assessment=uV=request.term;vARR=uV.split('[ICD-10: ');if(vARR.length>1){ICD10_ARR=vARR[1].split(',');if(ICD10_ARR.length>1){ICD10=ICD10_ARR[0];request.term=ICD10;assessment=vARR[0];}}else{delete ICD10;}
request.term=request.term.replace(/^\s|\s$/g,'');var term=jq_extractLast(request.term,1,this.element[0]);var o=jq_getStarter(term);this.element[0].strter=o[0];flg_LitSev=0;if(typeof(examName)!="undefined"&&examName=="Fundus"){var tmpICD10=window.opener.top.fmain.$("#hid_icd10").val();tmpICD10=(tmpICD10==1)?1:0;var chart_dos="";if(typeof(window.opener.top.fmain.$("#elem_dos").val())!="undefined"&&$("textarea[name^='elem_assessment']")){chart_dos=window.opener.top.fmain.$("#elem_dos").val();}}else{var tmpICD10=$("#hid_icd10").val();tmpICD10=(tmpICD10==1)?1:0;var chart_dos="";if(typeof($("#elem_dos").val())!="undefined"&&$("textarea[name^='elem_assessment']")){chart_dos=$("#elem_dos").val();}}
if(getDataFilePath=="../common/getICD10data.php"){getDataFilePath="requestHandler.php?elem_formAction=TypeAhead&mode=getICD10Data&term="+term+"&ICD10="+tmpICD10+"&show_pop=1";}else{getDataFilePath=getDataFilePath+'&term='+term+'&ICD10='+tmpICD10+'&show_pop=1&chart_dos='+chart_dos;}
var oe=this.element[0];if(typeof($(oe).data("val1stsrch"))=="undefined"){$(oe).data("val1stsrch",term);}
$.ajax({url:getDataFilePath,dataType:"json",success:function(availableTags){if(typeof(availableTags.flg_LitSev)!="undefined"&&(availableTags.flg_LitSev==1||availableTags.flg_LitSev==0)){flg_LitSev=availableTags.flg_LitSev;if(typeof(availableTags.icd10_dxdb)!="undefined"){$(oe).data("valbakdb",availableTags.icd10_dxdb);}
if(typeof(availableTags.srchd_code)!="undefined"){$(oe).data("valsrchd",availableTags.srchd_code);}
if(typeof(availableTags.icd10_dxdesc)!="undefined"){$(oe).data("valdxdesc",availableTags.icd10_dxdesc);}
availableTags=availableTags.results;}
if(vARR&&vARR.length>1){request.term='';}request.term='';if(flg_LitSev==1){response(availableTags);}else{response($.ui.autocomplete.filter(availableTags,icd10_extractLast(request.term)));}}});},response:function(event,ui){if(flg_LitSev){if(cn_isFulldxAdded(this)){}else{$("#"+this.id).removeData("val1stsrch");if($("#dialogLSS").length>0){if($("#pop_ass_flag").length>0){var fldid01=""+this.id;var fldid02=fldid01.replace("pop_","");if(fldid02.indexOf("elem_assessment_dxcode")!=-1||fldid02.indexOf("elem_assessment")!=-1){var fldid03=fldid02.replace("elem_assessment","elem_assessment_dxcode");var elem_ass_comm=$("#elem_ass_comm").val();var fldid03_exp=$("#"+fldid01).val().split('[ICD-10: ');var fldid03_arr="";if(fldid03_exp.length>1){fldid03_arr=fldid03_exp[1].split(',');}
if(elem_ass_comm!=""&&typeof(elem_ass_comm)!="undefined"){$("#"+fldid02).val($("#"+fldid01).val()+";;"+elem_ass_comm);}else{$("#"+fldid02).val($("#"+fldid01).val());}
$("#"+fldid03).val(fldid03_arr[0]);$("#"+fldid03).data("valbakdb",fldid03_arr[0]);$("#dialogLSS").remove();$("#"+fldid02).triggerHandler("click");$("#"+fldid02).triggerHandler("blur");$("#"+fldid02).triggerHandler("change");}else if(fldid02.indexOf("elem_dxCode")!=-1){var fldid03_exp=$("#"+fldid01).val().split('[ICD-10: ');var fldid03_arr="";if(fldid03_exp.length>1){fldid03_arr=fldid03_exp[1].split(',');}else{fldid03_arr=fldid03_exp[1];}
$("#"+fldid02).val(fldid03_arr[0]);$("#"+fldid02).data("valbakdb",fldid03_arr[0]);$("#dialogLSS").remove();$("#"+fldid02).triggerHandler("click");$("#"+fldid02).triggerHandler("blur");$("#"+fldid02).triggerHandler("change");}}else{$("#dialogLSS").remove();}}
var rr="";var i=1;for(var i=0;i<3;i++){var ee="",ee1="";var lat_ct=0;for(var x in ui['content'][i]){lat_ct=parseInt(lat_ct)+1;var lat_ct_show="";var tmp=""+ui['content'][i][x];if(typeof(tmp)=="undefined"||tmp==""||tmp=="undefined"){continue;}
var arr_tmp=tmp.split("-");var showtxt=$.trim(arr_tmp[0]);var showval=$.trim(arr_tmp[1]);var fldid=""+this.id;fldid=fldid.replace("pop_","");if(i==0){lat_ct_show="txt_lat";}else if(i==1){lat_ct_show="txt_sev";}else if(i==2){lat_ct_show="txt_stag";}
ee+="<span id='txt_span_latt' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\"></span>";if(i==0){if(showtxt.toLowerCase().indexOf("lid")!=-1){if(showtxt.toLowerCase().indexOf("right")!=-1){ee+="<tr><td  id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}else{ee1+="<tr><td  id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}
continue;}}
ee+="<tr><td id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}
if(ee!=""){var hd="";if(i==0){hd="Eye";}else if(i==1){hd="Stage";}else if(i==2){hd="Encounter";}
if(i==0&&ee1!=""){ee="<table id='LSS_od"+i+"' >"+"<tr><td><b>Right Eye</b></td></tr>"+ee+""+"</table>";rr+="<td>"+ee+"</td>";ee1="<table id='LSS_os"+i+"' >"+"<tr><td><b>Left Eye</b></td></tr>"+ee1+"</table>";rr+="<td>"+ee1+"</td>";}else{ee="<table id='LSS"+i+"' >"+"<tr><td><b>"+hd+"</b></td></tr>"+ee+"</table>";rr+="<td>"+ee+"</td>";}
if(i==1||i==2){break;}}}
if(rr!=""){var js_icd_data_str="";var js_icd_data_ee="";var full_dx_val=$.trim($("#"+fldid).data("valbakdb"));var final_dx_val=full_dx_val.toLowerCase();if(typeof(js_icd_data_arr)!="undefined"&&js_icd_data_arr&&typeof(js_icd_data_arr[final_dx_val])!="undefined"){for(var k=0;k<js_icd_data_arr[final_dx_val].length;k++){js_icd_data_str+=js_icd_data_arr[final_dx_val][k];}}
if(js_icd_data_str!=""){js_icd_data_ee="<table id='LSk3'><tr><td style='padding:0px 0px 4px 0px;'><input type='hidden' id='fldid_chk' name='fldid_chk' value='"+fldid+"' ><b>Causative Factors</b></td></tr>"+js_icd_data_str+"</table>";}
var obj_comm_div="";if(fldid.indexOf("elem_assessment")!=-1){var fldid_comm_id=fldid.replace("_dxcode","");var obj_comm_exp=($("#"+fldid_comm_id).val()).split(';');var obj_comm_val="";if(typeof(obj_comm_exp[2])!="undefined"){for(l=1;l<=obj_comm_exp.length;l++){var obj_comm_exp_chk="";if(obj_comm_exp[l]!=""&&typeof(obj_comm_exp[l])!="undefined"){obj_comm_exp_chk=$.trim(obj_comm_exp[l].toLowerCase());if(l==1&&obj_comm_exp_chk!='ou'&&obj_comm_exp_chk!='od'&&obj_comm_exp_chk!='os'){}else{if(obj_comm_val!=''){obj_comm_val+=';';}
obj_comm_val+=obj_comm_exp[l];}}}}
var comm_width="410px";if(js_icd_data_ee!=""){comm_width="630px";}
obj_comm_div="<table id='dvLssComm'style='padding:5px 0px 5px 0px;'><tr><td><b>Comment</b></td></tr><tr><td><textarea class='input_text_10' name='elem_ass_comm' id='elem_ass_comm' style='width:"+comm_width+"; height:40px;'>"+obj_comm_val+"</textarea></td></tr></table>";}
if(fldid.indexOf("elem_assessment_dxcode")!=-1||fldid.indexOf("elem_assessment")!=-1){var show_ass_id=fldid.replace("elem_assessment_dxcode","elem_assessment");}else{var show_ass_id=fldid.replace("pop_","");}
var show_ass_val=($("#"+show_ass_id).val()).split('[');rr="<div class=\"dvLss\"><table id=\"bigtbl\" border='0' width='100%'><tr valign='top'>"+rr+"</tr></table></div>";var dd="<div id=\"dialogLSS\" title=\"Select ICD 10 Dx code\">"+"<input type=\"hidden\" id=\"pop_ass_flag\" value=\"1\" ><textarea class=\"input_text_10\" id='pop_"+show_ass_id+"' name='pop_elem_assessment[]' style=\"width:410px;height:20px;\">"+show_ass_val[0]+"</textarea>"+
rr+"<input type=\"hidden\" id=\"olen\" value=\"1\" >"+
js_icd_data_ee+obj_comm_div+"</div>";var del_btn_val="Delete Dx code";if(fldid.indexOf("elem_assessment_dxcode")!=-1||fldid.indexOf("elem_assessment")!=-1){del_btn_val="Delete Assessment and Dx code";}
if(js_icd_data_ee!=""){var dialogLSS_width='700';}else{var dialogLSS_width='450';}
var show_staging_link_val=show_staging_link(show_ass_id);$("body").append(dd);$("#dialogLSS").dialog({close:function(){if($("#elem_ass_comm")){$("#elem_ass_comm").val('');}},buttons:[{text:"Done",'class':"ui-btn-sucus",click:function(){if($("#dialogLSS table[id*=LSk3]").length>0){$("#dialogLSS table[id*=LSk3] td").addClass("doneCF");}
if($("#dialogLSS table[id*=LSS_o]").length>0){$("#dialogLSS table[id*=LSS_o] td").addClass("doneLPU");}
if($("#dialogLSS table[id*=LSS0]").length>0){$("#dialogLSS table[id*=LSS0] td").addClass("doneLPU");}else if($("#dialogLSS table[id*=LSS1]").length>0){$("#dialogLSS table[id*=LSS1] td").addClass("doneLPU");}else if($("#dialogLSS table[id*=LSS2]").length>0){$("#dialogLSS table[id*=LSS2] td").addClass("doneLPU");}
if($("#dialogLSS td.highlight").length>0){$("#dialogLSS td.highlight").eq(0).triggerHandler("click");}else{if($("#elem_ass_comm").val()!=""){$("#dialogLSS td [id=txt_span_latt]").eq(0).triggerHandler("click");}}
if($("#elem_ass_comm")){$("#elem_ass_comm").val('');}
$(this).dialog("close");}},{id:"dmb_reset",text:"Reset",click:function(){reset_assessment(fldid);}},{id:"dmb_staging_code",text:"Staging Code",click:function(){staging_div_view('show');}},{id:"dialog_add_mutli_dx",text:"Add Multiple Dx",click:function(){$("#dialogLSS").append("");$("#dialogLSS div.dvLss table#bigtbl").clone().appendTo("#dialogLSS div.dvLss");var len=$("#dialogLSS table[id*=bigtbl]").length;var inx=len-1;var oo=$("#dialogLSS table[id*=bigtbl]").get(inx);oo.id="bigtbl"+inx;$("#dialogLSS #olen").val(len);}}],minWidth:dialogLSS_width});$("#dmb_reset").css({"float":"right"});if(show_staging_link_val==""){$("#dmb_staging_code").hide();}
$("#dmb_staging_code").css({"float":"left","background":"none","color":"purple","border":"none","font-weight":"bold"});$("#dialog_add_mutli_dx").hide();cn_typeahead();if($("#dialog_add_mutli_dx").length>0){if(fldid.indexOf("elem_assessment")!=-1){var fldid_as=fldid.replace(/elem_assessment/,"elem_assessment_dxcode");var tt=$("#"+fldid_as).val();var artt=tt.split(",");var lentt=artt.length;for(var t1=1;t1<lentt;t1++){$("#dialog_add_mutli_dx").trigger("click");}}}}}
$(this).autocomplete("close");}
return false;},minLength:1,focus:function(){return false;},close:function(){if((typeof(ICD10)=='string'&&ICD10.substr((ICD10.length-1),1)=='-')||($(this).val().indexOf('>>')>0)){getDataFilePath='../common/getICD10data.php';if(hiddenOBJ.val()==""||""+hiddenOBJ.val().indexOf("-")!=-1)
$(this).autocomplete("search");}else{getDataFilePath='requestHandler.php?elem_formAction=TypeAhead&mode=assessment&callFrom=wv';}},select:function(event,ui){var flgInWv=(typeof(examName)!="undefined"&&examName=="Fundus")?0:1;if(flgInWv){getForthAssess();}
arr=ui.item.value.split("~~");index=$(this).attr('id').match(/\d+$/);if($(this).attr('id').indexOf("elem_assessment_dxcode")!=-1||$(this).attr('id').indexOf("elem_assessment")!=-1){hiddenOBJ=$("#elem_assessment_dxcode"+index);}else{hiddenOBJ=$("#elem_dxCode_"+index);}
if(this.value.indexOf(";")==-1){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val('');hiddenOBJ.data("dxid","");}}
if(arr[1]=='commu'||arr[1]=='phy'||arr[1]=='dyn'||arr[1]=='dx'){var tmp_val="";ui.item.value=arr[0];var tmp_ival=cn_rem_escp_char(ui.item.value);uV1=tmp_ival;if(uV1.slice(-1)==")"&&uV1.indexOf(" \t\r(")!=-1){arr1=uV1.split(/\([^\(]*$/);tmp_val=arr1[0];if(this.value.indexOf(";")==-1||hiddenOBJ.val()==""){var tmp_dx_id=(typeof(ui.item.dxid)!="undefined")?ui.item.dxid:"";vARR1=uV1.split("(").pop().replace(/\)$/g,'');if(typeof(asmt_sep_multi_dx_code)=="undefined"||flgInWv==0){asmt_sep_multi_dx_code=0;}
if(asmt_sep_multi_dx_code==1&&typeof(vARR1)!="undefined"&&vARR1!=""&&(vARR1.indexOf(",")!=-1||vARR1.indexOf(";")!=-1)){if(vARR1.indexOf(",")!=-1){var ardx=vARR1.split(",");}else if(vARR1.indexOf(";")!=-1){var ardx=vARR1.split(";");}
if(ardx.length>1){var ardxid=tmp_dx_id.split(",");for(var d=0;d<ardx.length;d++){var t=""+$.trim(ardx[d]);var tid=(typeof(ardxid[d])!="undefined")?""+$.trim(ardxid[d]):"";if(t!=""){if(d==0){hiddenOBJ.val(t).data("dxid",tid);hiddenOBJ.triggerHandler("blur");}
else{addAssessOptionExe("","","","","",t,'','',1,tid);}}}}}else{hiddenOBJ.val(vARR1).data("dxid",tmp_dx_id);hiddenOBJ.triggerHandler("blur");}}}else{tmp_val=uV1;if(this.value.indexOf(";")==-1){hiddenOBJ.val('');if(flgInWv==1){show_asmt_site(hiddenOBJ,'');}}}
var t=jq_extractLast(this.value,2,this);var r=""+tmp_val;r=cn_adjustSearchValue(r,t[3]);if(this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t[0]+""+r+t[1]);$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");return false;}
code='';uV1=assessment=ui.item.value;vARR1=uV1.split('[ICD-10: ');if(vARR1.length>1){ICD10_ARR1=vARR1[1].split(',');if(ICD10_ARR1.length>1){uV1=ICD10_ARR1[0];code=ICD10_ARR1[0];}}
laterality=uV1.substr((uV1.length-1),1);if(showMode!='ap'&&uV1.indexOf('.')>0&&uV1.indexOf('-')<0){ICD10=uV1;}
if(laterality=='-'){laterality=false;var terms=icd10_split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(">>");var tmp=typeof(ui.item.id)!="undefined"?ui.item.id:"";if(tmp!=""){hiddenOBJ.data("dxid",tmp);}}else if(typeof(ICD10)!='undefined'&&ICD10!=null&&typeof(ICD10)=='string'){dX_code=ICD10.replace('-',laterality);if(showMode=='ap'){icd_value=this.value;NewdX_code=ICD10.replace('-',laterality);dX_code=icd_value.replace(ICD10,NewdX_code);dX_code=dX_code.replace('>>','');vARR2=dX_code.split(' [ICD-10: ');if(vARR2.length>1){assessment=vARR2[0];}
if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(NewdX_code);}}
this.value=assessment;$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");}else{if(showMode=='ap'){if(vARR1.length>1){this.value=vARR1[0];if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(code);if(typeof(ui.item.id)!="undefined"&&$.trim(ui.item.id)!=""){hiddenOBJ.data("dxid",ui.item.id);}
if(flgInWv==1){show_asmt_site(hiddenOBJ,code);}}
var fldid01=""+this.id;var fldid02=fldid01.replace("pop_","");if($("#dialogLSS").length>0){if($("#pop_ass_flag").length>0){if(fldid02.indexOf("elem_assessment_dxcode")!=-1||fldid02.indexOf("elem_assessment")!=-1){var elem_ass_comm="";if($("#elem_ass_comm").val()!=""){elem_ass_comm="; \n"+$("#elem_ass_comm").val();}
$("#"+fldid02).val($("#"+fldid01).val()+elem_ass_comm);$("#dialogLSS").remove();}else{$("#dialogLSS").remove();}}}
$("#"+fldid02).triggerHandler("click");$("#"+fldid02).triggerHandler("blur");$("#"+fldid02).triggerHandler("change");}else{if(this.value.indexOf(";")==-1){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(code);}}
tmp_val=""+ui.item.value;var t=jq_extractLast(this.value,2,this);var r=""+tmp_val;r=cn_adjustSearchValue(r,t[3]);if(this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t[0]+""+r+t[1]);$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");}}else{this.value=assessment;$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");}}
return false;}});};$("#assessplan .col-sm-7-as textarea[name^='elem_assessment']").bind("focus",function(){if($(this).attr('id')!=icd10_unique_obj_id){icd10_unique_obj_id=$(this).attr('id');delete uV;delete vARR;delete ICD10;delete uV1;delete vARR1;delete ICD10_ARR1;delete laterality;delete dX_code;delete NewdX_code;delete ICD10_ARR;}});$("#assessplan .col-sm-7-as textarea[name='elem_assessment[]'], #dialogLSS textarea[name='pop_elem_assessment[]'], #rprtIntrModal textarea[name='elem_assessment[]'] ").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta2(this);};});}else if(version==4){var ta3=function(ota3){$(ota3).autocomplete({source:"requestHandler.php?elem_formAction=TypeAhead"+strExamName,minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var t=jq_extractLast(this.value,2,this);var r=""+ui.item.value;r=cn_adjustSearchValue(r,t[3]);if(this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t[0]+""+r+t[1]);$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");setCursorAtEnd(this,t[2]+r.length);}}}).filter("textarea[id^=elem_plan]").each(function(){$(this).triggerHandler('keyup');});};$("textarea:not(textarea[name^='elem_assessment'])"+ptrntextbox).bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta3(this);};});if(typeof(examName)!="undefined"&&examName!=""){return;}
var ta4=function(ota4){$(ota4).autocomplete({source:"requestHandler.php?elem_formAction=TypeAhead&mode=assessment",minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var t=jq_extractLast(this.value,2,this);var r=""+ui.item.value;r=cn_adjustSearchValue(r,t[3]);this.value=$.trim(""+t[0]+""+r);$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");return false;}}});};$("#assessplan textarea[name^='elem_assessment']").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta4(this);};});}
if(typeof(examName)!="undefined"&&examName!=""){return;}
var ta5=function(ota5){$(ota5).autocomplete({source:"requestHandler.php?elem_formAction=TypeAhead&mode=OcuMed",minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){this.value=""+ui.item.value;if(this.id!="blank_med"){}}}});};$("#tblOcMeds input[type=text], #blank_med").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta5(this);};});if(typeof(multiphy_typeahead)!="undefined"){multiphy_typeahead(5);}
if(typeof(referral_code_typeahead)!="undefined"){referral_code_typeahead();}
if(typeof(cn_ta_fu)!="undefined"){cn_ta_fu();}
if(typeof(cn_ta_clr_npsych)!="undefined"){cn_ta_clr_npsych();}
if(typeof(cn_ta_procedures)!="undefined"){cn_ta_procedures();}}
function rv_lens_used(){if(typeof(examName)!="undefined"&&examName=="Fundus"){if(typeof(arr_lens_used)!="undefined"){cn_ta_clr_npsych("#el_lens_used");}
sb_dx_typeahead();}}
function referral_code_typeahead(){var ta1=function(ota1){$(ota1).autocomplete({source:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=referralCode",minLength:2,autoFocus:true,open:function(){$(this).autocomplete('widget').zIndex(1000000);},change:function(event,ui){if(this.id.indexOf("elem_refer_code")!=-1){ohid=this.id.replace(/(txt|elem)/,"hid");if((!ui.item&&$.trim(this.value)!=""&&$.trim($("#"+ohid).val())=="")||$.trim(this.value).length<2){this.value="";$("#"+ohid).val("");}}},response:function(event,ui){if(this.id.indexOf("elem_refer_code")!=-1){ohid=this.id.replace(/(txt|elem)/,"hid");$("#"+ohid).val("");}},select:function(event,ui){ohid=this.id.replace(/(txt|elem)/,"hid");if(ui.item.value!=""){this.value=""+ui.item.value;$("#"+ohid).val(this.value);$(this).triggerHandler("mouseover");}}});};$(":input[type=text][id='elem_refer_code']").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta1(this);};});}
function cn_ta_procedures(){var ta5=function(ota5){$(ota5).autocomplete({source:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=getorder",minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){this.value=""+ui.item.value;this.onchange();set_qty_in_hand(this,arr_med_name,arr_item_no_qty,arr_thrash,arr_lot_no);}}});};$("#divPreOpMeds input[type=text], #divIntraVitrealMeds  input[type=text], #divPostOpMeds  input[type=text]").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta5(this);};});var ta6=function(ota6){$(":input[name=elem_providers]").autocomplete({source:function(request,response){$.getJSON(zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=getproviders",{term:jq_extractLast(request.term,1)},response);},search:function(){var term=jq_extractLast(this.value,1);var o=jq_getStarter(term);this.strter=o[0];if(o[1].length<2){return false;}},minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var t=jq_extractLast(this.value,2);var r=""+ui.item.value;if(this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t+""+r+",");$(this).triggerHandler("change");$(this).triggerHandler("blur");$(this).triggerHandler("click");return false;}}});};$(":input[name=elem_providers]").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta6(this);};});cn_ta_clr_npsych("#elem_iopType");}
function cn_ta_clr_npsych(str){var ta5=function(ota5){$(ota5).autocomplete({source:function(request,response){var oe=this.element[0];var tags=[];var flgSrch=0;if(oe&&oe.name&&oe.name.indexOf("eyeColorCc")!=-1){tags=["Amber","Black","Blue","Brown","Grey","Green","Hazel","Violet"];}else if(oe&&oe.name&&oe.name.indexOf("elem_mfocal")!=-1){tags=["Restor","Tecnis"];}else if(oe&&oe.name&&oe.name.indexOf("elem_descTa")!=-1){tags=["Squeezing","Holding lids","Taped lids","Unreliable","Unable"];flgSrch=1;}else if(oe&&oe.name&&$(oe).hasClass("iop_method")){tags=["Applanation","Pnuematic","Puff","Tactile","Tonopen"];}else if(oe&&oe.name&&oe.name.indexOf("el_lens_used")!=-1){tags=arr_lens_used;}else{tags=["Agitated","AAOx3","Confused","Flat","Cognitive Impairment","Too Young (Pediatric Patient)","Uncooperative"];}
var matcher=new RegExp(""+$.ui.autocomplete.escapeRegex(request.term),"i");response($.grep(tags,function(item){return flgSrch||matcher.test(item);}));},minLength:0,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var t=""+ui.item.value;if(this.name&&this.name.indexOf("elem_descTa")!=-1){var s=this.value,tid=this.id,t1;if(typeof(s)!="undefined"&&s!=""){t1=s+" "+t;$("#"+tid).val(t1);return false;}}else{this.value=""+t1;}}}});};if(typeof(str)=="undefined"||$.trim(str)==""){str="#elem_eyeColorCc, #elem_mfocalOd_pciol_opts, #elem_mfocalOs_pciol_opts";}
$(""+str).bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta5(this);};$(this).autocomplete("search","");});}
function multiphy_typeahead(id){if(typeof(zPath)!="undefined"&&zPath!=""){}else{zPath="";}
var obj;if(id=="2"){obj="txtCoPhyArr";}else if(id=="3"){obj="txtPCPMedHxArr";}else if(id=="4"){obj="txtPCPDemoArr";}else if(id=="5"){obj="elem_doctorName_refphy";}else if(id=="6"){obj="elem_fsta_phy_name";}else{obj="txtRefPhyArr";}
var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;var ta6=function(ota6){$(ota6).autocomplete({source:u+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=refPhy&w="+id,minLength:2,autoFocus:true,open:function(){$(this).autocomplete('widget').zIndex(1000000);},focus:function(event,ui){ohid=this.id.replace(/(txt|elem)/,"hid");if(typeof(reff_multi_add_popup)!="undefined"){reff_multi_add_popup($(this),document.getElementById(ohid),'WV');}return false;},change:function(event,ui){if(this.id.indexOf("elem_doctorName_refphy")!=-1){ohid=this.id.replace(/(txt|elem)/,"hid");if((!ui.item&&$.trim(this.value)!=""&&$.trim($("#"+ohid).val())=="")||$.trim(this.value).length<2){this.value="";$("#"+ohid).val("");}}},response:function(event,ui){if(this.id.indexOf("elem_doctorName_refphy")!=-1){ohid=this.id.replace(/(txt|elem)/,"hid");$("#"+ohid).val("");}},select:function(event,ui){ohid=this.id.replace(/(txt|elem)/,"hid");if(ui.item.value!=""){this.value=""+ui.item.value;$("#"+ohid).val(""+ui.item.refid);reff_multi_add_popup($(this),document.getElementById(ohid),'WV');if(obj=="elem_doctorName_refphy"){$(this).triggerHandler("mouseover");}
if(id=="6"&&ui.item.address){$(":input[name=elem_fsta_phy_address]").val(""+ui.item.address);}}}});};$(":input[type=text][id*='"+obj+"']").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta6(this);};});}
function getIcdContructed(ICD10,liter,sever,stage){var ICD10_tmp=ICD10;if(liter!=""&&typeof(liter)!="undefined"){var lit_w=6;if((ICD10_tmp.indexOf("-")!=-1&&(ICD10_tmp.indexOf("E1")!=-1||ICD10_tmp.indexOf("E0")!=-1)&&ICD10_tmp.indexOf(".9")==-1)){lit_w=7;}
if(ICD10_tmp.charAt(lit_w)=='-'){var tt=ICD10_tmp.substr(0,lit_w);var tt1=ICD10_tmp.substr(lit_w+1);ICD10_tmp=tt+liter+tt1;}else{var tt=ICD10_tmp.substr(0,5);var tt1=ICD10_tmp.substr(6);ICD10_tmp=tt+liter+tt1;}}
if(sever!=""&&typeof(sever)!="undefined"){ICD10_tmp=ICD10_tmp.replace('-',sever);}else if(stage!=""&&typeof(stage)!="undefined"){ICD10_tmp=ICD10_tmp.replace('-',stage);}
return ICD10_tmp;}
function icd10_split(val){var x=new RegExp(">>\s*");return val.split(x);}
function icd10_extractLast(term){return icd10_split(term).pop();}
function cn_resetasval(id,val,wh,otd){var sever_full=[],liter_full=[],stage_full=[];var sever=[],liter=[],stage=[];var t_sever=[],t_sever_full=[],t_stage=[],t_stage_full=[];var f_svr_stg_lid=0;var t_opt=0;if($("#dialogLSS").length>0){if(($("#dialogLSS table[id*=LSS_od0]").length>0||$("#dialogLSS table[id*=LSS0]").length>0)&&$("#dialogLSS table[id*=LSS1]").length<=0&&$("#dialogLSS table[id*=LSS2]").length<=0){t_opt=parseInt(t_opt)+1;}
var len_multi=$("#dialogLSS #olen").val();if(t_opt==1){if($(otd).attr("class")=='highlight'||$(otd).attr("class")=='highlight_2'||$(otd).attr("class")=='highlight highlight_2'){$(otd).removeClass("highlight highlight_2");}else{$(otd).addClass("highlight");}}else{if($("#dialogLSS table[id*=LSS_od0]").length>0||$("#dialogLSS table[id*=LSS0]").length>0||$("#dialogLSS table[id*=LSS1]").length>0||$("#dialogLSS table[id*=LSS2]").length>0){var otd_id=$(otd).attr('id');var otd_id_exp=otd_id.split('_');if(otd_id_exp[1]=='lat'){if($(otd).attr("class")=='highlight'||$(otd).attr("class")=='highlight_2'||$(otd).attr("class")=='highlight highlight_2'){$(otd).removeClass("highlight highlight_2");}else{if($("#dialogLSS table[id*=LSS]  td.doneLPU").length>0||$("#dialogLSS table[id*=LSk3] td.doneCF").length>0){}else{if($("#dialogLSS td[id*=txt_lat_1]").hasClass("highlight")==true&&val==1){$(otd).removeClass("highlight highlight_2");}else if($("#dialogLSS td[id*=txt_lat_2]").hasClass("highlight")==true&&val==2){$(otd).removeClass("highlight highlight_2");}else if($("#dialogLSS td[id*=txt_lat_2]").hasClass("highlight")==false&&val==2){$(otd).parent().parent().find("td.highlight").removeClass("highlight highlight_2");$(otd).addClass("highlight");}else if($("#dialogLSS td[id*=txt_lat_1]").hasClass("highlight")==false&&val==1){$(otd).parent().parent().find("td.highlight").removeClass("highlight highlight_2");$(otd).addClass("highlight");}else{$(otd).addClass("highlight");}}}
if($("#dialogLSS table[id*=LSS]  td.doneLPU").length>0||$("#dialogLSS table[id*=LSk3] td.doneCF").length>0){if($("#dialogLSS div.dvLss table[id=bigtbl1] td[id*=txt_lat_]").hasClass("highlight")==false){$("#dialogLSS div.dvLss table#bigtbl1").remove();$("#dialogLSS #olen").val(parseInt($("#dialogLSS #olen").val())-1);}
if($("#dialogLSS #olen").val()==0){$("#dialogLSS #olen").val(1);}
len_multi=$("#dialogLSS #olen").val();}else{var tot_lat=$("#dialogLSS div.dvLss table[id*=bigtbl]").find("table[id*=LSS0]").length;var tot_h_lat=$("#dialogLSS div.dvLss table[id*=bigtbl]").find("table[id*=LSS0] td.highlight").length;if($(otd).parents("table[id*=bigtbl]").find("table[id*=LSS0] td.highlight").length>0){if($("#dialogLSS td[id*=txt_lat_3]").hasClass("highlight")==true){if(val==3){$("#dialogLSS div.dvLss table#bigtbl1").remove();$("#dialogLSS table[id*=bigtbl] .highlight").removeClass("highlight highlight_2");$("#dialogLSS td[id*=txt_lat_3]").addClass("highlight");}else if(val<3){$("#dialogLSS td[id*=txt_lat_3]").removeClass("highlight highlight_2");$("#dialogLSS").append("");$("#dialogLSS div.dvLss table#bigtbl").clone().appendTo("#dialogLSS  div.dvLss");var len=$("#dialogLSS table[id*=bigtbl]").length;var inx=len-1;var oo=$("#dialogLSS table[id*=bigtbl]").get(inx);oo.id="bigtbl"+inx;$("#dialogLSS table[id*="+oo.id+"] td").removeClass("highlight highlight_2");$("#dialogLSS #olen").val(len);$($("#dialogLSS table[id*="+oo.id+"] td[id="+otd_id+"]")).data("vval",val);}}else if(tot_lat>1){}else{$("#dialogLSS").append("");$("#dialogLSS div.dvLss table#bigtbl").clone().appendTo("#dialogLSS  div.dvLss");var len=$("#dialogLSS table[id*=bigtbl]").length;var inx=len-1;var oo=$("#dialogLSS table[id*=bigtbl]").get(inx);oo.id="bigtbl"+inx;$("#dialogLSS table[id*="+oo.id+"] td").removeClass("highlight highlight_2");$("#dialogLSS #olen").val(len);$($("#dialogLSS table[id*="+oo.id+"] td[id="+otd_id+"]")).data("vval",val);}}}}else{$(otd).parents("table[id*=LSS]").find("td").removeClass("highlight highlight_2");$(otd).addClass("highlight");}}}
$(otd).data("vval",val);if($("#dialogLSS table[id*=LSS]  td.doneLPU").length>0||$("#dialogLSS table[id*=LSk3] td.doneCF").length>0){$("#dialogLSS table[id*=LSS] td").removeClass("doneLPU");}else{return;}
for(var k=0;k<len_multi;k++){var btid_indx=k;var btid_spx=k;if(btid_indx==0){btid_indx=0;btid_spx="";}
if($("#dialogLSS #bigtbl"+btid_spx).length<=0){continue;}
if(t_opt==1){var btid_indx_tmp=0;$('.highlight').each(function(){var txt_lat_id=$(this).attr('id');var txt_lat_id_exp=txt_lat_id.split('_');btid_indx_tmp=parseInt(btid_indx_tmp)+1;if(txt_lat_id_exp[1]=='lat'){liter[btid_indx_tmp]=$("#"+txt_lat_id).data("vval");liter_full[btid_indx_tmp]=$("#"+txt_lat_id).html();}
if(txt_lat_id_exp[1]=='sev'){sever[btid_indx_tmp]=$("#"+txt_lat_id).data("vval");sever_full[btid_indx_tmp]=$("#"+txt_lat_id).html();}
if(txt_lat_id_exp[1]=='stag'){stage[btid_indx_tmp]=$("#"+txt_lat_id).data("vval");stage_full[btid_indx_tmp]=$("#"+txt_lat_id).html();}});len_multi=btid_indx_tmp;}else{if($("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS1]").length>0&&$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS1] td.highlight").length>0){sever[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS1] td.highlight").data("vval");sever_full[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS1] td.highlight").html();}
if($("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS2]").length>0&&$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS2] td.highlight").length>0){stage[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS2] td.highlight").data("vval");stage_full[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS2] td.highlight").html();}
if($("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS0]").length>0&&$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS0] td.highlight").length>0){liter[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS0] td.highlight").data("vval");liter_full[btid_indx]=""+$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS0] td.highlight").html();}}}
if(f_svr_stg_lid==0&&$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS0]").length>0&&($("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS1]").length>0||$("#dialogLSS #bigtbl"+btid_spx+" table[id*=LSS2]").length>0)){f_svr_stg_lid=1;}
if(t_sever.length>sever.length){sever=t_sever;sever_full=t_sever_full;}else if(t_stage.length>stage.length){stage=t_stage;stage_full=t_stage_full;}}
var assess=$("#"+id).val();var oassess=$("#"+id).get(0);var valChkdb=$.trim($("#"+id).data("valbakdb"));var arr=assess.split("~~");index=$("#"+id).attr('id').match(/\d+$/);if(id.indexOf("elem_assessment_dxcode")==-1&&!$("#"+id).hasClass("dxallcodes")){hiddenOBJ=$("#elem_assessment_dxcode"+index);if(oassess.value.indexOf(";")==-1){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val('');}}}
var code='';var uV1=assessment=assess;var vARR1=uV1.split('[ICD-10: ');if(vARR1.length>1){ICD10_ARR1=vARR1[1].split(',');if(ICD10_ARR1.length>1){uV1=ICD10_ARR1[0];code=ICD10_ARR1[0];}}
if(typeof(valChkdb)=="string"&&valChkdb!=""){ICD10=""+valChkdb;}
if(typeof(ICD10)=='string'&&ICD10!=null){var ICD10_tmp=getIcdContructed(ICD10,liter[0],sever[0],stage[0]);dX_code=ICD10_tmp;var dx_code_modifier_text="";var dcmtmp="";if((typeof(showMode)!="undefined"&&showMode=='ap')||id.indexOf("elem_assessment_dxcode")!=-1||$("#"+id).hasClass("dxallcodes")){icd_value=oassess.value;NewdX_code=dX_code;dX_code=icd_value.replace(ICD10,NewdX_code);dX_code=dX_code.replace('>>','');vARR2=dX_code.split(' [ICD-10: ');if(vARR2.length>1){assessment=vARR2[0];}
if(len_multi>0){var str_as_m="";if(t_opt==1){for(var t_m=1;t_m<=len_multi;t_m++){var ICD10_tmp_m=getIcdContructed(ICD10,liter[t_m],sever[t_m],stage[t_m]);if(ICD10_tmp_m!=""){if(str_as_m!=""){str_as_m+=",";}
str_as_m+=ICD10_tmp_m;if(dx_code_modifier_text!=""){dx_code_modifier_text=$.trim(dx_code_modifier_text)+", ";}
var dcmtmp="";if(typeof(liter_full[t_m])!="undefined"&&liter_full[t_m]!=""){dcmtmp+=liter_full[t_m]+" ";}
if(typeof(sever_full[t_m])!="undefined"&&sever_full[t_m]!=""){dcmtmp+=sever_full[t_m]+" ";}
if(typeof(stage_full[t_m])!="undefined"&&stage_full[t_m]!=""){dcmtmp+=stage_full[t_m]+" ";}
dx_code_modifier_text+=dcmtmp;}}}else{for(var t_m=0;t_m<len_multi;t_m++){var ICD10_tmp_m=getIcdContructed(ICD10,liter[t_m],sever[t_m],stage[t_m]);if(ICD10_tmp_m!=""){if(str_as_m!=""){str_as_m+=",";}
str_as_m+=ICD10_tmp_m;if(dx_code_modifier_text!=""){dx_code_modifier_text=$.trim(dx_code_modifier_text)+", ";}
var dcmtmp="";if(typeof(liter_full[t_m])!="undefined"&&liter_full[t_m]!=""){dcmtmp+=liter_full[t_m]+" ";}
if(typeof(sever_full[t_m])!="undefined"&&sever_full[t_m]!=""){dcmtmp+=sever_full[t_m]+" ";}
if(typeof(stage_full[t_m])!="undefined"&&stage_full[t_m]!=""){dcmtmp+=stage_full[t_m]+" ";}
dx_code_modifier_text+=dcmtmp;}}}
if(str_as_m!=""){if(id.indexOf("elem_assessment_dxcode")!=-1&&icd_value.indexOf(",")!=-1&&icd_value.indexOf(">>")==-1){var check_dx_family_val=f_svr_stg_lid;if(check_dx_family_val=="0"){var tmp=icd_value.replace(ICD10,"");tmp=$.trim(tmp);tmp=tmp.replace(/,$/,"");var ar_t=tmp.split(",");var ar_as_m=str_as_m.split(",");if(ar_t.length<ar_as_m.length){str_as_m=str_as_m+","+tmp;}
if(ar_as_m.length>0){ar_as_m=jQuery.unique(ar_as_m);str_as_m=ar_as_m.join(", ");}}}
NewdX_code=str_as_m;}}
if(id.indexOf("elem_assessment_dxcode")!=-1||$("#"+id).hasClass("dxallcodes")){assessment=NewdX_code;}else{if(id.indexOf("elem_assessment")!=-1){assessment+="; "+dx_code_modifier_text;}
if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(NewdX_code);hiddenOBJ.attr("title",NewdX_code);hiddenOBJ.trigger("change");hiddenOBJ.trigger("blur");}}}
oassess.value=assessment;if(oassess.id.indexOf("elem_dxCode")!=-1&&oassess.value!=""&&oassess.value.indexOf(",")!=-1){var t_ar_su_dx=oassess.value.split(",");var t_su_dxid=$(oassess).data("dxid");if(typeof t_su_dxid=="undefined"){t_su_dxid="";}
t_su_dxid=$.trim(t_su_dxid);oassess.value="";$(oassess).data("dxid","");for(var tinx in t_ar_su_dx){var tdx=$.trim(t_ar_su_dx[tinx]);if(tdx!=""&&$("input[id*=elem_dxCode][value='']").length>0&&$("input[id*=elem_dxCode][value='"+tdx+"']").length<=0){var flgbrk=0;$("input[id*=elem_dxCode][value='']").each(function(){if($.trim(this.value)==""&&flgbrk==0){this.value=tdx;$(this).data("dxid",t_su_dxid);$(this).trigger("blur");flgbrk=1;}});}}}
if(id.indexOf("elem_assessment")!=-1&&liter&&typeof(liter)!="undefined"){var asindx=id.replace(/(elem_assessment_dxcode|elem_assessment)/gi,"");if($.inArray('3',liter)!=-1&&$.inArray("Both Eyes",liter_full)!=-1){if($("#elem_apOu"+asindx).is(':checked')==false){$("#elem_apOs"+asindx+", #elem_apOd"+asindx).prop("checked",false);$("#elem_apOu"+asindx).trigger("click");}}else if($.inArray('2',liter)!=-1&&$.inArray('1',liter)!=-1&&$.inArray("Left Eye",liter_full)!=-1&&$.inArray("Right Eye",liter_full)!=-1){if($("#elem_apOu"+asindx).is(':checked')==false){$("#elem_apOs"+asindx+", #elem_apOd"+asindx).prop("checked",false);$("#elem_apOu"+asindx).trigger("click");}}else if($.inArray('2',liter)!=-1&&$.inArray("Left Eye",liter_full)!=-1){if($("#elem_apOs"+asindx).is(':checked')==false){$("#elem_apOu"+asindx+", #elem_apOd"+asindx).prop("checked",false);$("#elem_apOs"+asindx).trigger("click");}}else if($.inArray('1',liter)!=-1&&$.inArray("Right Eye",liter_full)!=-1){if($("#elem_apOd"+asindx).is(':checked')==false){$("#elem_apOs"+asindx+", #elem_apOu"+asindx).prop("checked",false);$("#elem_apOd"+asindx).trigger("click");}}else{var teye1="",teye2="";if(($.inArray('1',liter)!=-1&&$.inArray("Right Upper Lid",liter_full)!=-1)||($.inArray('2',liter)!=-1&&$.inArray("Right Lower Lid",liter_full)!=-1)){teye2="1";}
if(($.inArray('4',liter)!=-1&&$.inArray("Left Upper Lid",liter_full)!=-1)||($.inArray('5',liter)!=-1&&$.inArray("Left Lower Lid",liter_full)!=-1)){teye1="1";}
if(teye1=="1"&&teye2=="1"){if($("#elem_apOu"+asindx).is(':checked')==false){$("#elem_apOu"+asindx).trigger("click");}}else if(teye1=="1"){if($("#elem_apOs"+asindx).is(':checked')==false){$("#elem_apOs"+asindx).trigger("click");}}else if(teye2=="1"){if($("#elem_apOd"+asindx).is(':checked')==false){$("#elem_apOd"+asindx).trigger("click");}}}}
var asid=id.replace("_dxcode","");if(id.indexOf("elem_assessment_dxcode")!=-1){oassess.title=assessment;var tv_as=$("#"+asid).val();var tv_asp=$("#"+id).val();var tv_asp_val="";if(tv_asp.indexOf("]>>")!=-1){if(tv_asp.indexOf(",")!=-1){var tv_asp_exp=tv_asp.split(",");if(tv_asp_exp.length>1){for(var ik=0;ik<tv_asp_exp.length;ik++){if(tv_asp_exp[ik].indexOf("[")==-1&&tv_asp_exp[ik].indexOf("]")==-1&&tv_asp_exp[ik].match(/[0-9]/)!==null){if(tv_asp_val!=""){tv_asp_val+=',';}
tv_asp_val+=tv_asp_exp[ik];}}
$("#"+id).val(tv_asp_val);}}}
if(typeof(tv_as)!="undefined"&&tv_as!=""){if(tv_as.indexOf(";")==-1){tv_as+=";";}else{var tmp_tv_as=tv_as.split(";");tv_as=tmp_tv_as[0]+";";}}
var tv_as_exp=tv_as.split('[ICD-10: ');if(tv_as_exp.length>1){tv_as=$.trim(tv_as_exp[0])+";";}else{if($("#pop_"+asid)){tv_as=$.trim($("#pop_"+asid).val())+";";}}
tv_as+=" "+dx_code_modifier_text;if($("#elem_ass_comm").val()!=""){tv_as+=";\n"+$("#elem_ass_comm").val();}
$("#"+asid).val(tv_as).triggerHandler("change");$("#"+asid).triggerHandler("blur");$("#"+asid).triggerHandler("keyup");}else{if(id.indexOf("elem_assessment")!=-1){if($("#elem_ass_comm").val()!=""){oassess.value=assessment+";\n"+$("#elem_ass_comm").val();}}}
if($("#LSk3")){var extra_dx_code_id="";$("input[name='elem_sub_dx']").each(function(){if($('#'+this.id).is(':checked')){extra_dx_code_id=this.id.replace("elem_sub_","");}});if(extra_dx_code_id>0){cn_set_sub_dx(extra_dx_code_id,'yes');}}
$(oassess).triggerHandler("change");$(oassess).triggerHandler("blur");$(oassess).triggerHandler("keyup");if(id.indexOf("elem_assessment_dxcode")!=-1&&icd_value.indexOf(",")!=-1){if($(oassess).val().indexOf("-")!=-1&&f_svr_stg_lid==0){$("#"+asid).triggerHandler("click");}}}else{if(typeof(showMode)!="undefined"&&showMode=='ap'){if(vARR1.length>1){oassess.value=vARR1[0];$(oassess).triggerHandler("change");$(oassess).triggerHandler("blur");}else{if(oassess.value.indexOf(";")==-1){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(code);}}
tmp_val=""+ui.item.value;var t=jq_extractLast(oassess.value,2,oassess);var r=""+tmp_val;r=cn_adjustSearchValue(r,t[3]);if(oassess.strter!=""){r=$.trim(oassess.strter+" "+r);}
oassess.value=$.trim(""+t[0]+""+r+t[1]);$(oassess).triggerHandler("change");$(oassess).triggerHandler("blur");$(oassess).triggerHandler("click");}}else{oassess.value=assessment;$(oassess).triggerHandler("change");$(oassess).triggerHandler("blur");$(oassess).triggerHandler("click");}}}
function epost_addTypeAhead(wh,zpth){var wh=(typeof(wh)!="undefined"&&wh!="")?wh:".epost textarea";var zPath1=(typeof(zpth)!="undefined"&&zpth!="")?zpth:zPath;var ta8=function(ota8){$(ota8).autocomplete({source:function(request,response){$.getJSON(zPath1+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead",{term:jq_extractLast(request.term,1,this.element[0])},response);},search:function(){var term=jq_extractLast(this.value,1,this);var o=jq_getStarter(term);this.strter=o[0];},minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){var t=jq_extractLast(this.value,2,this);var r=""+ui.item.value;r=cn_adjustSearchValue(r,t[3]);if(typeof(this.strter)!="undefined"&&this.strter!=""){r=$.trim(this.strter+" "+r);}
this.value=$.trim(""+t[0]+""+r+t[1]);$(this).triggerHandler("blur");return false;}}});};$(""+wh).bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta8(this);};});}
function sb_dx_typeahead(){if(typeof(zPath)!="undefined"&&zPath!=""){}else{zPath="";}
var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=getICD10Data";$(".dxallcodes, textarea[name^='elem_assessment_dxcode']").each(function(indx){bind_autocomp($(this),url);});}
function sb_addTypeAhead(){if(typeof(zPath)!="undefined"&&zPath!=""){}else{zPath="";}
var ta7=function(ota7){$(ota7).autocomplete({source:function(request,response){$.ajax({url:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=cptdropdown",dataType:"json",data:{term:request.term},success:function(data){response($.map(data,function(item){var tmp_Lbl=tmp_Val="";if(typeof(item)=="object"){tmp_Lbl=item.label?item.label:item.value;tmp_Val=item.value;}else{tmp_Lbl=item;tmp_Val=item;}
return{label:tmp_Lbl,value:tmp_Val}}));}});},minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){this.value=""+ui.item.value;this.onblur();}}});};$(".cptcode").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta7(this);};});var tmp=$("#hid_icd10").val();if(typeof(tmp)!="undefined"&&tmp==1){sb_dx_typeahead();}else{var ta8=function(ota8){$(ota8).autocomplete({source:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=dxdropdown",minLength:2,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){this.value=""+ui.item.value;this.onblur();}}});};$(".dxallcodes, textarea[name^='elem_assessment_dxcode']").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta8(this);};});}
var ta9=function(ota9){$(ota9).autocomplete({source:zPath+"/chart_notes/requestHandler.php?elem_formAction=TypeAhead&mode=moddropdown",minLength:1,autoFocus:true,focus:function(event,ui){return false;},select:function(event,ui){if(ui.item.value!=""){this.value=""+ui.item.value;this.onblur();}}});};$(".modcode").bind("focus",function(event){if(!$(this).hasClass("ui-autocomplete-input")){ta9(this);};});}
if($.ui&&$.ui.autocomplete){$.ui.autocomplete.prototype._renderItem=function(ul,item){arr=item.label.split("~~");var clss="";if(arr[1]=='commu'){clss="text-warning";}
if(arr[1]=='phy'){clss="text-success";}
if(arr[1]=='dyn'){clss="text-primary";}
if(clss!=""){var term=this.term,formattedLabel="<span class=\'"+clss+"\'>"+arr[0]+"</span>";}else{var term=this.term,formattedLabel=item.label;}
return $("<li></li>").data("item.autocomplete",item).append("<a>"+formattedLabel+"</a>").appendTo(ul);};}
var ei_arrEv=new Array("click","keyup","keydown","keypress");var ei_conName=[];ei_detechIndicator=function(dvId){for(var i in ei_arrEv){$("#"+dvId).unbind(""+ei_arrEv[i],ei_checkEvent).removeClass("bggrey");}
if((typeof ei_conName[dvId]!="undefined")&&(ei_conName[dvId]!="")){var oCon=gebi(ei_conName[dvId]);if(oCon){oCon.value="1";}}}
ei_checkEvent=function(){var e=window.event;if(e){}else{return;}
var eo=e.srcElement;var efrm=eo.type;var etype=e.type;var flgCanvas=false;if(eo.tagName=="CANVAS"){$(eo).parent("div[id*=divCanvas]").triggerHandler("mouseout");var val=$("input[name='hidCanvasWNL']").val();if(typeof(val)!="undefined"&&val.indexOf("no")!=-1){flgCanvas=true;}}
if((efrm=="text")||(efrm=="textarea")||(efrm=="select-one")||(efrm=="checkbox")||(efrm=="radio")||flgCanvas==true){var dvId=$(eo).parents(".tab-pane").attr("id");ei_detechIndicator(dvId);}}
ei_attachIndicator=function(conName,sttsElem){if(typeof conName!="undefined"){ei_conName[conName]=""+sttsElem;}
var len=ei_arrEv.length;for(var i=0;i<len;i++){$("#"+conName).bind(""+ei_arrEv[i],ei_checkEvent);}}
function ei_attachIndicator_eom(){var ed=$("#elem_editMode_load").val();var ch=$("#elem_chng_divEom").val();var ch2=$("#elem_chng_divEom2").val();var ch3=$("#elem_chng_divEom3").val();if(ed==0||ch==0){ei_attachIndicator('divEom','elem_chng_divEom');}
if(ed==0||ch2==0){ei_attachIndicator('divEom2','elem_chng_divEom2');}
if(ed==0||ch3==0){ei_attachIndicator('divEom3','elem_chng_divEom3');}}
function ev_attachIndicator_iop(md){var strClss="";strClss=$("#elem_chng_iop").val()=="0"?"greyAll_v2":"";$("#divIopElem :input,#hdr_iop :input").addClass(""+strClss);$("#divIopElem :input,#hdr_iop :input, #divIopElem label[for],#hdr_iop label[for]").bind("keyup mouseup",function(){var tmp=$("#elem_ci_iop").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_iop").val(tmp);$("#divIopElem :input,#hdr_iop :input").removeClass("greyAll_v2");$("#elem_chng_iop").val(1);});var ptrn="";if($("#elem_chng_divIop_Od").val()!="1"){ptrn+="#divIop :input[name*='Od_'], "+"#divIop :input[name*='_od'],"+"#divIop :input[name*='Od'],"+"#divIop :input[name*='od_']";}
if($("#elem_chng_divIop_Os").val()!="1"){ptrn+=(ptrn!="")?",":"";ptrn+="#divIop :input[name*='Os_'], "+"#divIop :input[name*='_os'],"+"#divIop :input[name*='Os'],"+"#divIop :input[name*='os_']";}
$(""+ptrn).addClass("greyAll_v2").bind("keyup mouseup",function(){var tmp=$("#elem_ci_gonio").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_gonio").val(tmp);$(this).removeClass("greyAll_v2");var eye="";var cnm=$(this).attr("name");if(cnm.toLowerCase().indexOf("od_")!=-1||cnm.toLowerCase().indexOf("_od")!=-1){eye="od";}else if(cnm.toLowerCase().indexOf("os_")!=-1||cnm.toLowerCase().indexOf("_os")!=-1){eye="os";}else if(cnm.toLowerCase().indexOf("od")!=-1||cnm.toLowerCase().indexOf("od")!=-1){eye="od";}else if(cnm.toLowerCase().indexOf("os")!=-1||cnm.toLowerCase().indexOf("os")!=-1){eye="os";}
newET_setGray_Exe("divIop",eye);});$("#divIop label[for*='od_'], #divIop label[for*='os_'] ").bind("keyup mouseup",function(){var idelem=$(this).attr("for");if(idelem&&typeof(idelem)!="undefined"){$("#"+idelem).triggerHandler("mouseup");}});var ptrn="";if($("#elem_chng_divIop3_Od").val()!="1"){ptrn+="#divIop3 :input[name*='Od_'],"+"#divIop3 :input[name*='_od'],"+"#divIop3 :input[name*='Od'],"+"#divIop3 :input[name*='od_']";}
if($("#elem_chng_divIop3_Os").val()!="1"){ptrn+=(ptrn!="")?",":"";ptrn+="#divIop3 :input[name*='Os_'],"+"#divIop3 :input[name*='_os'],"+"#divIop3 :input[name*='Os'],"+"#divIop3 :input[name*='os_']";}
$(""+ptrn).addClass("greyAll_v2").bind("keyup mouseup",function(){var tmp=$("#elem_ci_gonio").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_gonio").val(tmp);$(this).removeClass("greyAll_v2");var eye="";var cnm=$(this).attr("name");if(cnm.toLowerCase().indexOf("od_")!=-1||cnm.toLowerCase().indexOf("_od")!=-1){eye="od";}else if(cnm.toLowerCase().indexOf("os_")!=-1||cnm.toLowerCase().indexOf("_os")!=-1){eye="os";}else if(cnm.toLowerCase().indexOf("od")!=-1||cnm.toLowerCase().indexOf("od")!=-1){eye="od";}else if(cnm.toLowerCase().indexOf("os")!=-1||cnm.toLowerCase().indexOf("os")!=-1){eye="os";}
newET_setGray_Exe("divIop3",eye);});strClss="";strClss=$("#elem_chng_dilation").val()=="0"?"greyAll_v2":"";$("#divDilation :input").addClass(""+strClss);$("#divDilation :input, #divDilation label[for]").bind("keyup mouseup",function(){var tmp=$("#elem_ci_dilation").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_dilation").val(tmp);$("#divDilation :input").removeClass("greyAll_v2");$("#elem_chng_dilation").val(1);});strClss="";strClss=$("#elem_chng_OOD").val()=="0"?"greyAll_v2":"";$("#divOOD :input").addClass(""+strClss);$("#divOOD :input, #divOOD label[for]").bind("keyup mouseup",function(){var tmp=$("#elem_ci_OOD").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_OOD").val(tmp);$("#divOOD :input").removeClass("greyAll_v2");$("#elem_chng_OOD").val(1);});}
var icd10_unique_obj_id='';function icd10_split(val){return val.split(/>>\s*/);}
function icd10_extractLast(term){return icd10_split(term).pop();}
function icd10_extractICD10(str){ICD10='';vARR=str.split('[ICD-10: ');if(vARR.length>1){ICD10_ARR=vARR[1].split(',');if(ICD10_ARR.length>1){ICD10=ICD10_ARR[0];}}
return ICD10;}
function bind_autocomp(obj,getDataFilePath,showMode,hiddenOBJ){var flg_LitSev=0;if(typeof(showMode)=='undefined'){showMode='';}
obj.bind("focus",function(){if($(obj).attr('id')!=icd10_unique_obj_id){icd10_unique_obj_id=$(obj).attr('id');delete(uV);delete(vARR);delete(ICD10_ARR);delete(ICD10);delete(uV1);delete(vARR1);delete(ICD10_ARR1);delete(laterality);delete(dX_code);delete(NewdX_code);}});obj.bind("click",function(){fv=obj.val();if(fv.substr(-1,1)=='-'&&fv.substr(-2,2)!='--'&&fv.substr(-3,3)!='-X-'&&fv.substr(-3,3)!='-x-'){fv=fv.replace('-','');}else if(fv.substr(-2,2)=='--'){fv=fv.replace('--','');}else if(fv.substr(-3,3)!='-x-'||fv.substr(-3,3)!='-X-'){fv=fv.replace('-x-','');fv=fv.replace('-X-','');}
obj.val(fv);obj.keydown();});var autoConfig={source:function(request,response){uV=request.term;vARR=uV.split('[ICD-10: ');if(vARR.length>1){ICD10_ARR=vARR[1].split(',');if(ICD10_ARR.length>1){ICD10=""+ICD10_ARR[0];request.term=""+ICD10;}}else{delete ICD10;if($("#tblSuperbill").length>0&&""+uV.indexOf("-")!=-1){ICD10=""+uV;}}
flg_LitSev=0;var str_data="term="+request.term;var oe=this.element[0];if(oe.name.indexOf("elem_assessment_dxcode")!=-1||$(oe).hasClass("dxallcodes")){str_data+="&show_pop=1";}
var chart_dos="";if(typeof($("#elem_dos").val())!="undefined"&&(typeof(sb_testName)=="undefined"||sb_testName=="")&&(oe.name.indexOf("elem_assessment_dxcode")!=-1||$(oe).hasClass("dxallcodes"))){chart_dos=$("#elem_dos").val();}else if(typeof($("#elem_examDate").val())!="undefined"){chart_dos=$("#elem_examDate").val();}else if(typeof($("#dos_id").val())!="undefined"){chart_dos=$("#dos_id").val();}else if(typeof($("#date_of_service").val())!="undefined"){chart_dos=$("#date_of_service").val();}else if(typeof($("#elem_chart_DOS").val())!="undefined"){chart_dos=$("#elem_chart_DOS").val();}
if(chart_dos!=""){str_data+="&chart_dos="+chart_dos;}
if(typeof($(oe).data("val1stsrch"))=="undefined"){$(oe).data("val1stsrch",request.term);}
if((typeof(ICD10)!='undefined'&&typeof(ICD10)=='string'&&""+ICD10.substr(-1)=='-')||($(oe).val().indexOf('>>')>0)){var str_dx_id="";if(typeof($(oe).data("dxid"))!="undefined"){var srch_dxid=$.trim($(oe).data("dxid"));if(srch_dxid!=""){str_data+="&dxid="+srch_dxid;}}}
$.ajax({url:getDataFilePath,data:str_data,dataType:"json",success:function(availableTags){if(typeof(availableTags.flg_LitSev)!="undefined"&&(availableTags.flg_LitSev==1||availableTags.flg_LitSev==0)){flg_LitSev=availableTags.flg_LitSev;if(typeof(availableTags.icd10_dxdb)!="undefined"){$(oe).data("valbakdb",availableTags.icd10_dxdb);}
if(typeof(availableTags.srchd_code)!="undefined"){$(oe).data("valsrchd",availableTags.srchd_code);}
if(typeof(availableTags.icd10_dxdesc)!="undefined"){$(oe).data("valdxdesc",availableTags.icd10_dxdesc);}
availableTags=availableTags.results;}
var tmp=0;if(vARR.length>1||($("#tblSuperbill").length>0&&""+uV.indexOf("-")!=-1)){request.term='';}
if(flg_LitSev==1){response(availableTags);tmp=1;}
if(tmp==0){response($.ui.autocomplete.filter(availableTags,icd10_extractLast(request.term)));}}});},response:function(event,ui){if(flg_LitSev){if(cn_isFulldxAdded(this)){}else{$("#"+this.id).removeData("val1stsrch");if($("#dialogLSS").length>0){$("#dialogLSS").remove();}
var rr="";for(var i=0;i<3;i++){var ee="",ee1="";var lat_ct=0;for(var x in ui['content'][i]){lat_ct=parseInt(lat_ct)+1;var lat_ct_show="";var tmp=""+ui['content'][i][x];if(typeof(tmp)=="undefined"||tmp==""||tmp=="undefined"){continue;}
var arr_tmp=tmp.split("-");var showtxt=$.trim(arr_tmp[0]);var showval=$.trim(arr_tmp[1]);var fldid=""+this.id;if(i==0){lat_ct_show="txt_lat";}else if(i==1){lat_ct_show="txt_sev";}else if(i==2){lat_ct_show="txt_stag";}
ee+="<span id='txt_span_latt' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\"></span>";if(i==0){if(showtxt.toLowerCase().indexOf("lid")!=-1){if(showtxt.toLowerCase().indexOf("right")!=-1){ee+="<tr><td  id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"'  onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}else{ee1+="<tr><td  id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}
continue;}}
ee+="<tr><td  id='"+lat_ct_show+"_"+lat_ct+"' dbid='"+showval+"' onclick=\"cn_resetasval('"+fldid+"', '"+showval+"','"+i+"', this);\">"+showtxt+"</td></tr>";}
if(ee!=""){var hd="";if(i==0){hd="Eye";}else if(i==1){hd="Stage";}else if(i==2){hd="Encounter";}
if(i==0&&ee1!=""){ee="<table id='LSS_od"+i+"' >"+"<tr><td><b>Right Eye</b></td></tr>"+ee+""+"</table>";rr+="<td>"+ee+"</td>";ee1="<table id='LSS_os"+i+"' >"+"<tr><td><b>Left Eye</b></td></tr>"+ee1+"</table>";rr+="<td>"+ee1+"</td>";}else{ee="<table id='LSS"+i+"' >"+"<tr><td><b>"+hd+"</b></td></tr>"+ee+"</table>";rr+="<td>"+ee+"</td>";}
if(i==1||i==2){break;}}}
if(rr!=""){var js_icd_data_str="";var js_icd_data_ee="";var full_dx_val=$.trim($("#"+fldid).data("valbakdb"));var final_dx_val=full_dx_val.toLowerCase();if(typeof(js_icd_data_arr)!="undefined"&&typeof(js_icd_data_arr[final_dx_val])!="undefined"){for(var k=0;k<js_icd_data_arr[final_dx_val].length;k++){js_icd_data_str+=js_icd_data_arr[final_dx_val][k];}}
if(js_icd_data_str!=""){js_icd_data_ee="<table id='LSk3'><tr><td style='padding:0px 0px 4px 0px;'><input type='hidden' id='fldid_chk' name='fldid_chk' value='"+fldid+"' ><b>Causative Factors</b></td></tr>"+js_icd_data_str+"</table>";}
var obj_comm_div="";if(fldid.indexOf("elem_assessment_dxcode")!=-1){var fldid_comm_id=fldid.replace("_dxcode","");var obj_comm_exp=($("#"+fldid_comm_id).val()).split(';');var obj_comm_val="";if(typeof(obj_comm_exp[2])!="undefined"){for(l=1;l<obj_comm_exp.length;l++){var obj_comm_exp_chk="";if(obj_comm_exp[l]!=""&&typeof(obj_comm_exp[l])!="undefined"){obj_comm_exp_chk=$.trim(obj_comm_exp[l].toLowerCase());if(l==1&&obj_comm_exp_chk!='ou'&&obj_comm_exp_chk!='od'&&obj_comm_exp_chk!='os'){}else{if(obj_comm_val!=''){obj_comm_val+=';';}
obj_comm_val+=obj_comm_exp[l];}}}}
var comm_width="410px";if(js_icd_data_ee!=""){comm_width="630px";}
obj_comm_div="<table id='dvLssComm'style='padding:5px 0px 5px 0px;'><tr><td><b>Comment</b></td></tr><tr><td><textarea class='input_text_10' name='elem_ass_comm' id='elem_ass_comm' style='width:"+comm_width+"; height:40px;'>"+obj_comm_val+"</textarea></td></tr></table>";}
if(fldid.indexOf("elem_assessment_dxcode")!=-1||fldid.indexOf("elem_assessment")!=-1){var show_ass_id=fldid.replace("elem_assessment_dxcode","elem_assessment");if($("#"+show_ass_id).val()==""){var show_ass_val=($("#"+fldid).val()).split(';');}else{var show_ass_val=($("#"+show_ass_id).val()).split(';');}
show_ass_val=(show_ass_val[0]).split('[');}else{var show_ass_id=fldid;var show_ass_val=($("#"+show_ass_id).val()).split('[');}
rr="<div class=\"dvLss\"><table id=\"bigtbl\" border='0' width='100%'><tr valign='top'>"+rr+"</tr></table></div>";var dd="<div id=\"dialogLSS\" title=\"Select ICD 10 Dx code\">"+"<input type=\"hidden\" id=\"pop_ass_flag\" value=\"1\" ><textarea class=\"input_text_10\" id='pop_"+show_ass_id+"' name='pop_elem_assessment[]' style=\"width:410px;height:20px;\">"+show_ass_val[0]+"</textarea>"+
rr+"<input type=\"hidden\" id=\"olen\" value=\"1\" >"+
js_icd_data_ee+obj_comm_div+"</div>";var del_btn_val="Delete Dx code";if(fldid.indexOf("elem_assessment_dxcode")!=-1){del_btn_val="Delete Assessment and Dx code";}
var show_staging_link_val=show_staging_link(show_ass_id);$("body").append(dd);var obtns=[];if(show_staging_link_val!=""){obtns[obtns.length]={id:"dmb_staging_code",text:"Staging Code",click:function(){staging_div_view('show');}}}
obtns[obtns.length]={text:"Done",'class':"ui-btn-sucus",click:function(){if($("#dialogLSS table[id*=LSk3]").length>0){$("#dialogLSS table[id*=LSk3] td").addClass("doneCF");}
if($("#dialogLSS table[id*=LSS_o]").length>0){$("#dialogLSS table[id*=LSS_o] td").addClass("doneLPU");}
if($("#dialogLSS table[id*=LSS0]").length>0){$("#dialogLSS table[id*=LSS0] td").addClass("doneLPU");}else if($("#dialogLSS table[id*=LSS1]").length>0){$("#dialogLSS table[id*=LSS1] td").addClass("doneLPU");}else if($("#dialogLSS table[id*=LSS2]").length>0){$("#dialogLSS table[id*=LSS2] td").addClass("doneLPU");}
if($("#dialogLSS td.highlight").length>0){$("#dialogLSS td.highlight").eq(0).triggerHandler("click");}else{if($("#elem_ass_comm").val()!=""){$("#dialogLSS td [id=txt_span_latt]").eq(0).triggerHandler("click");}}
if($("#elem_ass_comm")){$("#elem_ass_comm").val('');}
$(this).dialog("close");}}
obtns[obtns.length]={id:"dmb_reset",text:"Reset",click:function(){reset_assessment(fldid);}}
if(fldid.indexOf("elem_assessment_dxcode")!=-1){obtns[obtns.length]={id:"dialog_add_mutli_dx",text:"Add Multiple Dx",display:"none",click:function(){$("#dialogLSS").append("");$("#dialogLSS div.dvLss table#bigtbl").clone().appendTo("#dialogLSS  div.dvLss");var len=$("#dialogLSS table[id*=bigtbl]").length;var inx=len-1;var oo=$("#dialogLSS table[id*=bigtbl]").get(inx);oo.id="bigtbl"+inx;$("#dialogLSS table[id*="+oo.id+"] td").removeClass("highlight highlight_2");$("#dialogLSS #olen").val(len);}}}
if(js_icd_data_ee!=""){var dialogLSS_width='700';}else{var dialogLSS_width='450';}
$("#dialogLSS").dialog({close:function(){if($("#elem_ass_comm")){$("#elem_ass_comm").val('');}},buttons:obtns,minWidth:dialogLSS_width});$("#dialog_add_mutli_dx").hide();$("#dmb_reset").css({"float":"right"});$("#dmb_staging_code").css({"float":"left","background":"none","color":"purple","border":"none","font-weight":"bold"});cn_typeahead();var SeverityArr=["Mild","Moderate","Severe","Indeterminate","Unspecified","Early","Intermediate","Adv atrophic w/o subfoveal Involvement","Adv atrophic w subfoveal Involvement","Active neovascularization","Inactive neovasculization","Inactive scar","w/ macular edema","w/ret neovaculaization","stable"];var StageArr=["Initial Encounter","Subsequent Encounter","Sequlae"];var StageArr_Sec=["Initial Encounter Closed Fracture","Initial Encounter Open Fracture","Subsequent Encounter for Fracture with Routine Healing","Subsequent Encounter for Fracture with Delayed Healing","Subsequent Encounter for Fracture with Non Union","Sequela"];var StageArr_Small=["Initial","Subsequent","Sequlae"];var StageArr_Sec_Small=["Closed","Open","Routine","Delayed","Union","Sequela"];if($("#dialog_add_mutli_dx").length>0){if(fldid.indexOf("elem_assessment_dxcode")!=-1){var tt=$("#"+fldid).val();var tt_as=fldid.replace("_dxcode","");var tt_as_v=$("#"+tt_as).val();var ar_tt_as_v=tt_as_v.split(";");var ar_tt_as_v_op=[];if(typeof(ar_tt_as_v[1])!="undefined"){var ar_tt_as_v_1=$.trim(""+ar_tt_as_v[1]);ar_tt_as_v_op=ar_tt_as_v_1.split(", ");}
if(tt.indexOf("[ICD-10:")==-1){var artt=tt.split(",");var lentt=artt.length;if(typeof(ar_tt_as_v_1)!="undefined"){if(""+ar_tt_as_v_1.toLowerCase().indexOf("lid")!=-1){lentt=1;}}}else{var artt=[tt];var lentt=1;}
for(var t1=0;t1<lentt;t1++){if(typeof(ar_tt_as_v_op[t1])!="undefined"&&ar_tt_as_v_op[t1]!=""){var tmpspx=(t1==0)?"":t1;var ar_tt_as_v_op_last=replace_cid10_extra_string(ar_tt_as_v_op[t1]);ar_tt_as_v_op_last=ar_tt_as_v_op_last.split(" ");var chk_stg_len=$("#dialogLSS table[id*=LSS1]").length;if((ar_tt_as_v_op_last[0]=="Right"||ar_tt_as_v_op_last[0]=="Left"||ar_tt_as_v_op_last[0]=="Both")&&typeof(ar_tt_as_v_op_last[1])=="undefined"&&chk_stg_len<1){}else if($.inArray(ar_tt_as_v_op[0],SeverityArr)!=-1){if(t1>0){$("#dialog_add_mutli_dx").trigger("click");}
if(typeof(ar_tt_as_v_op_last[0])!="undefined"&&ar_tt_as_v_op_last[0]!=""){$("#dialogLSS table[id*=bigtbl"+tmpspx+"] table[id*=LSS1] td").each(function(){var strchk=$(this).html();if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op_last[0].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{$(this).removeClass("highlight");}});}}else if($.inArray(ar_tt_as_v_op[0],StageArr)!=-1){if(t1>0){$("#dialog_add_mutli_dx").trigger("click");}
ar_tt_as_v_op_last[0]=replace_cid10_extra_string(ar_tt_as_v_op_last[0]);if(typeof(ar_tt_as_v_op_last[0])!="undefined"&&ar_tt_as_v_op_last[0]!=""){$("#dialogLSS table[id*=bigtbl"+tmpspx+"] table[id*=LSS2] td").each(function(){var strchk=$(this).html();strchk=replace_cid10_extra_string(strchk);if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op_last[0].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{$(this).removeClass("highlight");}});}}else if($.inArray(ar_tt_as_v_op[0],StageArr_Sec)!=-1){if(t1>0){$("#dialog_add_mutli_dx").trigger("click");}
ar_tt_as_v_op_last[0]=replace_cid10_extra_string(ar_tt_as_v_op[0]);if(typeof(ar_tt_as_v_op_last[0])!="undefined"&&ar_tt_as_v_op_last[0]!=""){$("#dialogLSS table[id*=bigtbl"+tmpspx+"] table[id*=LSS2] td").each(function(){var strchk=$(this).html();strchk=replace_cid10_extra_string(strchk);if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op_last[0].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{$(this).removeClass("highlight");}});}}else if(ar_tt_as_v_op[0].indexOf("Right eye category")!=-1||ar_tt_as_v_op[0].indexOf("Left eye category")!=-1){if(t1>0){$("#dialog_add_mutli_dx").trigger("click");}
for(var zt=0;zt<2;zt++){var lss_td_id=zt;if(typeof(ar_tt_as_v_op[t1])!="undefined"&&ar_tt_as_v_op[t1]!=""){$("#dialogLSS table[id*=bigtbl"+tmpspx+"] table[id*=LSS"+lss_td_id+"] td").each(function(){var strchk=$(this).html();if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op[t1].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{$(this).removeClass("highlight");}});}}}else{if(t1>0){$("#dialog_add_mutli_dx").trigger("click");}
for(var zt=0;zt<3;zt++){var lss_td_id=zt;if($.inArray(ar_tt_as_v_op_last[zt],StageArr_Small)!=-1||$.inArray(ar_tt_as_v_op_last[zt],StageArr_Sec_Small)!=-1){var lss_td_id=2;}
if(typeof(ar_tt_as_v_op_last[zt])!="undefined"&&ar_tt_as_v_op_last[zt]!=""){$("#dialogLSS table[id*=bigtbl"+tmpspx+"] table[id*=LSS"+lss_td_id+"] td").each(function(){var strchk=$(this).html();strchk=replace_cid10_extra_string(strchk);if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op_last[zt].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{$(this).removeClass("highlight");}});}}}}}
for(var t1=0;t1<3;t1++){if(typeof(ar_tt_as_v_op[t1])!="undefined"){var tmpspx=0;var ar_tt_as_v_op_last=replace_cid10_extra_string(ar_tt_as_v_op[t1]);ar_tt_as_v_op_last=ar_tt_as_v_op_last.split(" ");var chk_stg_len=$("#dialogLSS table[id*=LSS1]").length;if((ar_tt_as_v_op_last[0]=="Right"||ar_tt_as_v_op_last[0]=="Left"||ar_tt_as_v_op_last[0]=="Both")&&typeof(ar_tt_as_v_op_last[1])=="undefined"&&chk_stg_len<1){if(typeof(ar_tt_as_v_op[t1])!="undefined"&&ar_tt_as_v_op[t1]!=""){$("#dialogLSS table[id*=bigtbl] table[id*=LSS"+tmpspx+"] td").each(function(){var strchk=$(this).html();strchk=replace_cid10_extra_string(strchk);if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op[t1].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{}});}}}}
for(var t1=0;t1<4;t1++){var tmpspx=0;if(typeof(ar_tt_as_v_op[t1])!="undefined"){if(""+ar_tt_as_v_op[t1].toLowerCase().indexOf("lid")!=-1){if(typeof(ar_tt_as_v_op[t1])!="undefined"&&ar_tt_as_v_op[t1]!=""){$("#dialogLSS table[id*=bigtbl] table[id*=LSS_od"+tmpspx+"] td").each(function(){var strchk=$(this).html();if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op[t1].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{}});$("#dialogLSS table[id*=bigtbl] table[id*=LSS_os"+tmpspx+"] td").each(function(){var strchk=$(this).html();if(typeof(strchk)!="undefined"&&strchk!=""&&ar_tt_as_v_op[t1].indexOf(strchk)!=-1){var set_val=$(this).attr("dbid");$(this).addClass("highlight");$(this).data("vval",set_val);}else{}});}}}}}}}}
$(this).autocomplete("close");}
return false;},focus:function(){return false;},close:function(event,ui){if(obj){if((typeof(ICD10)!='undefined'&&typeof(ICD10)=='string'&&""+ICD10.substr(-1)=='-')||(obj.val().indexOf('>>')>0)){obj.autocomplete("search");}}},select:function(event,ui){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val('');}
uV1=ui.item.value;if(showMode=='mhx'&&uV1.indexOf('[ICD-10: ')>-1){uV=uV1;}
vARR1=uV1.split('[ICD-10: ');if(vARR1.length>1){ICD10_ARR1=vARR1[1].split(',');if(ICD10_ARR1.length>1){uV1=ICD10_ARR1[0];}}
laterality=uV1.substr((uV1.length-1),1);if(showMode!='ap'){if(uV1.indexOf('.')>0&&uV1.indexOf('-')<0){ICD10=uV1;}else if(uV1.length>=3&&uV1.indexOf('-')<0){ICD10=uV1;}}
if(laterality=='-'){laterality=false;var terms=icd10_split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(">>");}else if(typeof(ICD10)!='undefined'&&ICD10!=null&&typeof(ICD10)=='string'){dX_code=""+ICD10.replace('-',laterality);if(flg_LitSev){}else{FirstHyphen=dX_code.indexOf("-");if(FirstHyphen>=7){icd_value=this.value;NewdX_code=""+ICD10.replace('-',laterality);dX_code=icd_value.replace(ICD10,NewdX_code);dX_code=dX_code.replace('>>','');if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(NewdX_code);}}}
if(showMode=='ap'){icd_value=this.value;NewdX_code=""+ICD10.replace('-',laterality);dX_code=icd_value.replace(ICD10,NewdX_code);dX_code=dX_code.replace('>>','');if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(NewdX_code);}}
if(showMode=='mhx'&&dX_code.indexOf('-')==-1){var prob_arr_dX_code=uV.split('[ICD-10:');var prob_dX_code=prob_arr_dX_code[0]+' (ICD-10-CM '+dX_code+')';dX_code=prob_dX_code;}
this.value=dX_code;}else{if(showMode=='ap'){this.value=ui.item.value;if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val(uV1);}}else{FirstHyphen=ui.item.value.indexOf("-");if(FirstHyphen>=7){this.value=ui.item.value;}else{this.value=uV1;}}}
var dxid=(typeof(ui.item.id)!="undefined")?ui.item.id:"";if(dxid!=""){$(this).data("dxid",dxid);}
return false;}}
if(showMode=='mhx'){autoConfig['position']={my:"left bottom",at:"left top"}}
obj.bind("keydown",function(event){if(typeof(hiddenOBJ)!='undefined'&&hiddenOBJ.get(0)){hiddenOBJ.val('');}
if(event.keyCode===$.ui.keyCode.TAB&&$(this).data("ui-autocomplete").menu.active){event.preventDefault();}}).autocomplete(autoConfig);}
function cn_set_sub_dx(id,val_post){var nogo=1;if($("#fldid_chk")){$(".elem_sub_dx").each(function(){var chk_box_id=this.id;var chk_box_val=$('#'+chk_box_id).data("valbakdb");chk_box_val_exp=chk_box_val.split("-");if(chk_box_val_exp.length>1){var val=$("#dialogLSS #bigtbl table[id*=LSS0] td.highlight").data("vval");if(val!=null&&val!=""&&typeof(val)!="undefined"){chk_box_val=chk_box_val.replace('-',val);nogo=0;$('#'+chk_box_id).val(""+chk_box_val);}}else{if(typeof($('#LSS0').html())!="undefined"){var val=$("#dialogLSS #bigtbl table[id*=LSS0] td.highlight").data("vval");if(val!=null&&val!=""&&typeof(val)!="undefined"){nogo=0;}}else{nogo=0;}}});}
if(nogo==1){return;}
var ass_id=fldid_chk.value;if(ass_id.indexOf("elem_assessment")!=-1||ass_id.indexOf("elem_assessment_dxcode")!=-1){for(var j=1;j<=50;j++){var ass_new_id_num=j;if($('#elem_assessment'+ass_new_id_num).val()==""&&$('#elem_assessment_dxcode'+ass_new_id_num).val()==""){break;}}
var ass_id="elem_assessment"+ass_new_id_num;var ass_dx_id="elem_assessment_dxcode"+ass_new_id_num;var chk_box_id="elem_sub_"+id;var chk_box_val=$('#'+chk_box_id).val();var chk_box_desc_id="elem_sub_desc_"+id;var chk_box_desc_val=$('#'+chk_box_desc_id).val();if(val_post!="yes"){$(".elem_sub_dx").each(function(){if(this.id!=chk_box_id){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
if($('#'+chk_box_id).is(':checked')==true){$('label[for='+chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");if(val_post=="yes"){$('#'+ass_id).val(chk_box_desc_val);$('#'+ass_dx_id).val(chk_box_val);$("#"+ass_id).triggerHandler("change");$("#"+ass_id).triggerHandler("blur");}}else{$('label[for='+chk_box_id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");}}else{var chk_box_id="elem_sub_"+id;var chk_box_val=$('#'+chk_box_id).val();for(var k=1;k<13;k++){if(val_post!="yes"){$(".elem_sub_dx").each(function(){if($('#elem_dxCode_'+k).val()==this.value){$('#elem_dxCode_'+k).val('');}
if(this.id!=chk_box_id){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
var elem_dxCode=$('#elem_dxCode_'+k);var elem_dxCode_val=$('#elem_dxCode_'+k).val();if($('#'+chk_box_id).is(':checked')==true){$('label[for='+chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");if($('#elem_dxCode_'+k)&&elem_dxCode_val==""&&val_post=="yes"){$('#elem_dxCode_'+k).val(chk_box_val);return false;}}else{$('label[for='+chk_box_id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");if(elem_dxCode_val==chk_box_val&&val_post=="yes"){$('#elem_dxCode_'+k).val('');return false;}}}}}
function show_sec_icd(val){var show_icd="";if($('.'+val).css('display')=='none'){var show_icd=val;$('.icd10_data_td').css({"display":"none"});}
$('.icd10_data_td').css({"display":"none"});if(show_icd!=""){$('.'+show_icd).css({"display":"table-row"});}}
function fAlert(msg,title,actionToPerform,width,height,BtnCaption,ModalMode){if(typeof(title)=='undefined'||title=='')title='imwemr';if(typeof(width)=='undefined'||width=='')width='500px';if(typeof(height)=='undefined'||height=='')height='auto';if(typeof(BtnCaption)=='undefined'||BtnCaption=='')BtnCaption='OK';if(typeof(ModalMode)!='boolean')ModalMode=true;if(BtnCaption=='CLOSE'||BtnCaption=='Close'){closeBtn=false;}else{closeBtn=true;}
new window.top.Messi(msg,{'title':title,modal:ModalMode,'width':width,'closeButton':closeBtn,buttons:[{id:0,label:BtnCaption,val:'X'}],callback:function(){if(typeof(actionToPerform)=='string'&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')>=0){actionToPerform;}else if(typeof(actionToPerform)=='string'&&actionToPerform.indexOf('/*callmebeforeclosingmessi*/')<0){eval(actionToPerform);}else if(typeof(actionToPerform)=='object'){actionToPerform.focus();}}});}
function fancyConfirm(msg,title,YsAction,NoAction,width,height){if(typeof(YsAction)=='undefined'){YsAction=title;title='';}
if(typeof(title)=='undefined'||title=='')title='imwemr';if(typeof(width)=='undefined'||width=='')width='500px';if(typeof(NoAction)=='undefined'||NoAction=='')NoAction=false;if(YsAction.indexOf('window.top.')==-1&&YsAction.indexOf('top.')==0){YsAction="window."+YsAction;}
if(NoAction!=false&&NoAction.indexOf('window.top.')==-1&&NoAction.indexOf('top.')==0){NoAction="window."+NoAction;}
new window.top.Messi(msg,{'title':title,modal:true,'width':width,buttons:[{id:0,label:'Yes',val:'Y',"class":'btn-success'},{id:1,label:'No',val:'N',"class":'btn-danger'}],callback:function(val){if(val=='Y'){eval(YsAction);}else if(val=='N'&&NoAction!=false){eval(NoAction);}}});}
function getWcId(ind)
{switch(examName){case"EOM":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"Eom","div":"divEom","c":1,"tab":"Eom"};ct=ct.toLowerCase();if(ct=="1"||ct=="diveom"){wcid={"nm":"Eom","div":"divEom","c":1,"tab":"Eom"};}else if(ct=="3"||ct=="diveom3"||ct=="draw"){wcid={"nm":"Eom3","div":"divEom3","c":3,"tab":"Eom3","app":"app_eom_drawing_2","fod":"elem_eomDrawing_2"};}
break;case"Pupil":wcid={"nm":"Pupil","div":"divPupil","c":1};break;case"External":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"Ee","div":"divCon","c":1,"tab":"Con"};ct=ct.toLowerCase();if(ct==2||ct=="draw"||ct=="divdraw"){wcid={"nm":"Draw","div":"divDraw","c":2,"tab":"Draw","app":"app_ee_drawing","fod":"elem_externalOdDrawing"};}else{wcid={"nm":"Ee","div":"divCon","c":1,"tab":"Con"};}
break;case"LA":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"Lids","div":"div1","c":1};ct=ct.toLowerCase();if(ct=="1"||ct=="div1"||ct=="lids"||ct=="lid"){wcid={"nm":"Lids","div":"div1","c":1};}else if(ct=="2"||ct=="div2"||ct=="lesion"){wcid={"nm":"Lesion","div":"div2","c":2};}else if(ct=="3"||ct=="div3"||ct=="lidpos"||ct=="lidposition"){wcid={"nm":"LidPos","div":"div3","c":3};}else if(ct=="4"||ct=="div4"||ct=="lacsys"||ct=="lacrimal_system"){wcid={"nm":"LacSys","div":"div4","c":4};}else if(ct=="5"||ct=="div5"||ct=="draw"||ct=="drawing"){wcid={"nm":"Draw","div":"div5","c":5,"app":"app_la_drawing","fod":"elem_laDrawing"};}
break;case"SLE":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"Conj","div":"div1","c":1};ct=ct.toLowerCase();if(ct=="1"||ct=="div1"||ct=="conjunctiva"||ct=="conj"){wcid={"nm":"Conj","div":"div1","c":1};}else if(ct=="2"||ct=="div2"||ct=="cornea"||ct=="corn"){wcid={"nm":"Corn","div":"div2","c":2};}else if(ct=="3"||ct=="div3"||ct=="ant. chamber"||ct=="ant"||ct=="antchamber"){wcid={"nm":"Ant","div":"div3","c":3};}else if(ct=="4"||ct=="div4"||ct=="iris"){wcid={"nm":"Iris","div":"div4","c":4};}else if(ct=="5"||ct=="div5"||ct=="lens"){wcid={"nm":"Lens","div":"div5","c":5};}else if(ct=="6"||ct=="div6"||ct=="draw"||ct=="drawing"){wcid={"nm":"Draw","div":"div6","c":6,"app":"app_conjunctiva_od_drawing","fod":"elem_conjunctivaOdDrawing"};}
break;case"Fundus":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"Vitreous","div":"div1","c":1};ct=ct.toLowerCase();if(ct=="1"||ct=="div1"||ct=="vitreous"){wcid={"nm":"Vitreous","div":"div1","c":1};}else if(ct=="2"||ct=="div2"||ct=="macula"){wcid={"nm":"Macula","div":"div2","c":2};}else if(ct=="3"||ct=="div3"||ct=="peri"||ct=="periphery"){wcid={"nm":"Peri","div":"div3","c":3};}else if(ct=="4"||ct=="div4"||ct=="bv"||ct=="blood vessels"||ct=="blood"){wcid={"nm":"BV","div":"div4","c":4};}else if(ct=="5"||ct=="div5"||ct=="draw"||ct=="drawing"||ct=="drawrvma"||ct=="drawrvon"){wcid={"nm":"Draw","div":"div5","c":5,"app":"app_od_coords","fod":"elem_odDrawing"};if(ct=="drawrvma"){wcid.c=9;}
if(ct=="drawrvon"){wcid.c=8;}}else if(ct=="6"||ct=="div6"||ct=="optic"||ct=="opt.nev"){wcid={"nm":"Optic","div":"div6","c":6};}else if(ct=="7"||ct=="div7"||ct=="retinal"||ct=="ret"){wcid={"nm":"Retinal","div":"div7","c":7};}
break;case"Refractive Surgery":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"RefSurg","div":"div1","c":1};ct=ct.toLowerCase();break;case"Gonio":var ct=(typeof ind=="undefined")?getCurTab():ind;var wcid={"nm":"IOP","div":"divIop1","c":"Iop1"};ct=ct.toLowerCase();if(ct=="1"||ct=="diviop1"||ct=="iop"){wcid={"nm":"IOP","div":"divIop1","c":"Iop1"};}else if(ct=="2"||ct=="diviop"||ct=="gonio"){wcid={"nm":"Gonio","div":"divIop","c":"Iop"};}else if(ct=="3"||ct=="diviop3"||ct=="draw"||ct=="drawing"){wcid={"nm":"Draw","div":"divIop3","c":"Iop3","app":"app_drawing_OD","fod":"elem_Drawing_OD"};}
break;case"DrawPane":var wcid={"nm":"DrawPane","div":"divDraw","c":1,"app":"app_drawpane_drawing","fod":"elem_drawpaneDrawing"};break;case"DrawCL":var wcid={"nm":"DrawCL","div":"divDraw","c":1,"app":"app_draw_cl","fod":"elem_draw_cl"};break;default:top.fAlert("Error:Please set exam tab info.");break;}
return wcid;}
function changeTab(id,obj){$(".tab-pane").not(".la-advance").removeClass("active");$("#div"+id).addClass("active");if(id=="Pupil"||id=="Refractive Surgery"){return;}
setFlagCurTab();setNC();if(examName=="Fundus"){if(id=="7"){$(".emergency_status").show();}
else{$(".emergency_status").hide();}}
$("#btn_rprt_intr").addClass("hidden");if((id=="Eom3")||(id=="Iop3")||(id==5)||(id==6)||(id=="Draw")){var hid_drw_id="",dv_con="",exm_id="",exm_nm="";if(document.getElementById("hidEOMDrawingId0")){hid_drw_id="hidEOMDrawingId";dv_con="divconExam";exm_id="elem_eomId";exm_nm="EOM_DSU";}else if(document.getElementById("hidExternalDrawingId0")){hid_drw_id="hidExternalDrawingId";dv_con="divMaster";exm_id="elem_eeId";exm_nm="EXTERNAL_DSU";}else if(document.getElementById("hidLADrawingId0")){hid_drw_id="hidLADrawingId";dv_con="divMaster";exm_id="elem_laId";exm_nm="LA_DSU";}else if(document.getElementById("hidIOPDrawingId0")){hid_drw_id="hidIOPDrawingId";dv_con="divMaster";exm_id="elem_gonioId";exm_nm="IOP_GON_DSU";}else if(document.getElementById("hidSLEDrawingId0")){if(id==6){hid_drw_id="hidSLEDrawingId";dv_con="divMaster";exm_id="elem_sleId";exm_nm="SLE_DSU";}}else if(document.getElementById("hidFundusDrawingId0")){if(id==5){hid_drw_id="hidFundusDrawingId";dv_con="divMaster";exm_id="elem_rvId";exm_nm="FUNDUS_DSU";var org_key=typeof(obj)!="undefined"?$(obj).data("key_org"):"";chngDfDrwType(org_key);$("#btn_rprt_intr").removeClass("hidden");}}
AJAXLoadDarwingData_exe(hid_drw_id,dv_con,exm_id,exm_nm);}}
function setTestTypeInReport(){var tt="",dt="";dt=$("#elem_drawType").val();if(dt=="8"){tt="Optic Nerve Drawing";}
else if(dt=="9"){tt="Macula Drawing";}
else{tt="Retina Drawing";}
$("#ir_test_type").val(tt);$("#ir_test_type_label").text(tt);}
function report_gentr(){setTestTypeInReport();$("#rprtIntrModal").modal("show");}
function del_inter_report(){var chart_draw_inter_report_id=$("#chart_draw_inter_report_id").val();if(chart_draw_inter_report_id!=""){if(typeof(setProcessImg)!='undefined')setProcessImg("1");var strsave="elem_saveForm=del_inter_report&id="+chart_draw_inter_report_id;$.post(zPath+"/chart_notes/saveCharts.php",strsave,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0");if(data.res=="0"){$("#elem_assessment1, #elem_assessment_dxcode1, #ir_dxid, #elem_plan1, #ir_ordered_by, #ir_test_type, #chart_draw_inter_report_id, #ir_test_type_label").val("");setTestTypeInReport();$("#ir_ordered_by").val(data.orderby);$("#lbl_ordered_by").val(data.orderbyNm);}},"json");}}
var flg_chng_draw_type=0;function openExmTab(f){var o=getWcId(f);if(o.tab&&$("#tab"+o.tab).length>0){$("#tab"+o.tab).trigger("click");}else{var oc=o.c;if(examName=="Fundus"&&(o.c==5||o.c==8||o.c==9)){var exdttp=$("#elem_drawType").val();if(exdttp!=""&&exdttp!="0"&&exdttp!=o.c){oc=exdttp;flg_chng_draw_type=o.c;}else{}}
$("#tab"+oc).trigger("click");}}
function setPositive(){if(arrSubExams==null||typeof(arrSubExams)=="undefined")return;flg="0";var ln=arrSubExams.length;for(var i=0;i<ln;i++){var a=gebi("elem_pos"+arrSubExams[i]).value;if(a=="1"){flg="1";break;}}
gebi("elem_isPositive").value=flg;}
function no_exm_hd(o){return($(o).parents(".examhd").length>0)?false:true;}
function freezeElem_eom(val){var wc=getWcId();if(val==1){$("#"+wc.div+" :input").filter(function(){return no_exm_hd(this);}).prop("disabled",true);}else{$("#"+wc.div+" :input").filter(function(){return no_exm_hd(this);}).prop("disabled",false);}}
function freezeElem(f,chk)
{if(examName=="EOM"){freezeElem_eom(f);return;}
var ict=getCurTab();freezeExe(ict,f,chk);}
function setFlagCurTab()
{var wcid=getWcId();var flag=getYFlagCurTab();if(flag.Exam==true){$("#"+wcid.div+" #examFlag").css({"display":"inline-block"}).addClass("flagPos").removeClass("flagWnl");}else if(gebi("elem_wnl"+wcid.nm).value=="1"){$("#"+wcid.div+" #examFlag").css({"display":"inline-block"}).addClass("flagWnl").removeClass("flagPos");}else{$("#"+wcid.div+" #examFlag").hide();}
setWnlEyeFlag();}
function record_MultiMedia_Message(){if(finalize_flag==1){if(typeof(top.fAlert)!="undefined"){top.fAlert('Chart is finalized.');}}else{if(typeof(top.showRecordingControl)!="undefined"){top.showRecordingControl('exam_eom',$("#elem_formId").val(),$("#elem_patientId").val());}}}
function play_MultiMedia_Messages(){var x=examName;if(x=="EOM"){x="exam_eom";}
if(typeof(top.showMultiMediaMessage)!="undefined"){top.showMultiMediaMessage(x,$("#elem_formId").val());}}
function setNC_eom(flg){var wc=getWcId();var ct=wc.c;if(ct=="1"){var id="elem_examined_no_change";var nk="elem_noChange";}else{var id="elem_noChange"+ct;var nk="elem_noChange_draw";}
var o=gebi(id);if(o){var y=gebi(nk);y.checked=(o.value=="1")?true:false;if(flg==1&&y.checked==false){}else{freezeElem(o.value);}}}
function setNC(flg){if(examName=="EOM"){setNC_eom(flg);return;}
var wc=getWcId();var id="elem_nc"+wc.nm;var o=gebi(id);if(o){var nck=(wc.c>1)?wc.nm:"";var y=gebi("elem_noChange"+nck);y.checked=(o.value=="1")?true:false;utElem_capture(y);if(flg==1&&y.checked==false){}else{freezeElem(o.value);}}
oneEye_check();}
function setNC2_eom(o,fclear)
{if(fclear==1){$(":input").attr("disabled",false);return;}
var wcid=getWcId();var ct=wcid.c;if(ct==1)ct="";var nck=(ct==3)?"elem_noChange_draw":"elem_noChange";if(typeof(o)=="undefined")o=gebi(nck);var f=(o.checked==true)?"1":"0";var od=gebi("divEom"+ct);if(od){var ar=new Array("INPUT","TEXTAREA");for(var j=0;j<2;j++){var e=od.getElementsByTagName(ar[j]);var l=e.length;for(var i=0;i<l;i++)
{if(e[i].name==nck)continue;if((e[i].type=="checkbox")||(e[i].type=="radio")){e[i].disabled=(f=="1")?true:false;}else if((e[i].type=="textarea")||(e[i].type=="text")){e[i].readOnly=(f=="1")?true:false;if(f!="1"){e[i].disabled=false;}}}}}
if(ct==""){var ar2=new Array("elem_rightHeadTilt_Dis","elem_leftHeadTilt_Dis","elem_commentsDis","elem_rightHeadTilt_Near","elem_leftHeadTilt_Near","elem_commentsNear");var len=ar2.length;for(var i=0;i<len;i++){var o=gebi(ar2[i]);if(o){if((o.type=="textarea")||(o.type=="text")){o.readOnly=(f=="1")?true:false;}}}}
if(ct==""){gebi("elem_examined_no_change").value=f;}else{gebi("elem_noChange"+ct).value=f;}
if(ct==3){if(f==1){setAllDrawingToSave();}}}
function setNC2(a,b){if(examName=="EOM"){setNC2_eom(a,b);return;}
var wc=getWcId();var id="elem_nc"+wc.nm;var o=gebi(id);if(examName=="Gonio"){var nck=(wc.c!="Iop")?wc.nm:"";}else{var nck=(wc.c>1)?wc.nm:"";}
var o1=gebi("elem_noChange"+nck);if(o){o.value=(o1.checked==true)?"1":"0";freezeElem(o.value,1);var idDiv=getCurTab();if(newET_chkB4GrayExe(idDiv,"ou")){newET_setGray_Exe(idDiv,"ou");}
if(wc.nm=="Gonio"||(examName=="Gonio"&&wc.nm=="Draw")){var tmp=$("#elem_ci_gonio").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_gonio").val(tmp);}
if(wc.nm=="Draw"){if(o.value==1){setAllDrawingToSave();}}}
setNCMain();}
function setNCMain(){if(arrSubExams==null||typeof(arrSubExams)=="undefined")return;flg="1";var ln=arrSubExams.length;for(var i=0;i<ln;i++){var a=gebi("elem_nc"+arrSubExams[i]).value;if(a!="1"){flg="0";break;}}
gebi("elem_examined_no_change").value=flg;}
function getYFlagCurTab(def_ict){var sfx="_";var flag=flagOd=flagOs=false;var ict=(typeof(def_ict)!="undefined"&&def_ict!="")?def_ict:getCurTab();var p1="#"+ict+" :checked[name*=Od][class!=ignore4YF],#"+ict+" :checked[name*=od"+sfx+"][class!=ignore4YF],#"+ict+" :checked[name*="+sfx+"od][class!=ignore4YF]";var p2="#"+ict+" :input[type!=checkbox][type!=hidden][class!=ignore4YF][name*=Od], "+"#"+ict+" :input[type!=checkbox][type!=hidden][name*=od"+sfx+"], "+"#"+ict+" :input[type!=checkbox][type!=hidden][name*="+sfx+"od] ";if($(p1).not(".ignore4YF").length>0){flag=flagOd=true;}else{var oh=$(p2).not(".ignore4YF").filter(function(){var t=$.trim(this.value);if(t!=""&&t!="Comments:"){return 1;}return 0;});if(oh.length>0){flag=flagOd=true;}}
p1="#"+ict+" :checked[name*=Os][class!=ignore4YF],#"+ict+" :checked[name*=os"+sfx+"][class!=ignore4YF],#"+ict+" :checked[name*="+sfx+"os][class!=ignore4YF]";p2="#"+ict+" :input[type!=checkbox][type!=hidden][class!=ignore4YF][name*=Os], "+"#"+ict+" :input[type!=checkbox][type!=hidden][name*=os"+sfx+"], "+"#"+ict+" :input[type!=checkbox][type!=hidden][name*="+sfx+"os] ";if($(p1).not(".ignore4YF").length>0){flag=flagOs=true;}else{var oh=$(p2).not(".ignore4YF").filter(function(){var t=$.trim(this.value);if(t!=""&&t!="Comments:"){return 1;}return 0;});if(oh.length>0){flag=flagOs=true;}}
if(flagOd==false||flagOs==false){oWcid=getWcId(ict);if(oWcid.nm=="Draw"){if($("#"+ict+" input[name="+oWcid.fod+"][value!=''][value!='0-0-0:;']").length>0){flag=flagOd=flagOs=true;}else{var val=$("input[name='hidCanvasWNL']").val();if(typeof(val)!="undefined"&&val.indexOf("no")!=-1){flag=flagOd=flagOs=true;}}}}
return{"Exam":flag,"Od":flagOd,"Os":flagOs};}
function setwnl_eom()
{var wcid=getWcId();var ct=wcid.c;if(ct==1)ct="";var w=gebi("elem_wnl"+ct);var p=gebi("elem_isPositive"+ct);if(w.value=="1"){w.value="0";$("#"+wcid.div+" #examFlag").hide();if(ct==""){$("input[name='elem_eomFull'],input[name='elem_eomOrtho'],input[name='elem_ahp_no'],input[name='elem_nysta_no']").attr("checked",false).each(function(){utElem_capture(this);});$("input[name*=elem_duction_]").val("").each(function(){utElem_capture(this);});$(".headtilt input[type=text], .grid input[type=text][class!=apct]").val(function(indx){return(indx%2==0)?"":"";}).each(function(){utElem_capture(this);});$(".grid input[type=text][class=apct]").val("").each(function(){utElem_capture(this);});}}else{if((p.value=="0")||(p.value=="")){w.value="1";$("#"+wcid.div+" #examFlag").css({"display":"inline-block"}).addClass("flagWnl").removeClass("flagPos");if(ct==""){$("input[name='elem_eomFull'],input[name='elem_eomOrtho'],input[name='elem_ahp_no'],input[name='elem_nysta_no']").attr("checked","checked").each(function(){utElem_capture(this);});$("input[name*=elem_duction_]").val("0").each(function(){utElem_capture(this);});$(".headtilt input[type=text], .grid input[type=text][class!=apct]").val(function(indx){return(indx%2==0)?"ORTHO":"0";}).each(function(){utElem_capture(this);});$(".grid input[type=text][class=apct]").val("APCT").each(function(){utElem_capture(this);});}}}
callClickEv();if(ct==3){if(w.value==1){setAllDrawingToSave();}}}
function callClickEv(){var wcid=getWcId();var dvId=wcid.div;var oDiv=gebi(dvId);var e=oDiv.getElementsByTagName("TEXTAREA");if(e){e[0].click();}}
function setwnl(eye){if(examName=="EOM"){setwnl_eom();return;}
var wco=getWcId();var flag=getYFlagCurTab();var wcid=wco.nm;var seOd=gebi("elem_wnl"+wcid+"Od");var seOs=gebi("elem_wnl"+wcid+"Os");if(seOd.value=="")seOd.value="0";if(seOs.value=="")seOs.value="0";var tmp=(seOd.value=="0"||seOs.value=="0")?"1":"0";if(typeof(eye)=="undefined")eye="OU";if(flag.Exam==true){$("#"+wco.div+" #examFlag").css({"display":"inline-block"}).addClass("flagPos").removeClass("flagWnl");gebi("elem_isPositive").value=1;gebi("elem_pos"+wcid).value=1;gebi("elem_wnl").value=0;gebi("elem_wnl"+wcid).value=0;if(eye=="OU"||eye=="OD"){seOd.value=((seOd.value=="0")&&(flag.Od==false)&&(oneEye_eye!="OD"))?"1":"0";}
if(eye=="OU"||eye=="OS"){seOs.value=((seOs.value=="0")&&(flag.Os==false)&&(oneEye_eye!="OS"))?"1":"0";}}else if(gebi("elem_wnl"+wcid).value==1){gebi("elem_wnl"+wcid).value=0;if(eye=="OU"||eye=="OD"){seOd.value=0;}
if(eye=="OU"||eye=="OS"){seOs.value=0;}
$("#"+wco.div+" #examFlag").hide();}else{if((oneEye_issue!="")&&((oneEye_eye!=""))){gebi("elem_wnl").value=0;if(eye=="OU"||eye=="OD"){seOd.value=((seOd.value=="0")&&(oneEye_eye!="OD"))?"1":"0";}
if(eye=="OU"||eye=="OS"){seOs.value=((seOs.value=="0")&&(oneEye_eye!="OS"))?"1":"0";}}else{gebi("elem_pos"+wcid).value=0;if(eye=="OU"){seOd.value=seOs.value=tmp;}else if(eye=="OD"){seOd.value=(seOd.value=="0")?"1":"0";}else if(eye=="OS"){seOs.value=(seOs.value=="0")?"1":"0";}
if(seOd.value==1&&seOs.value==1){gebi("elem_wnl"+wcid).value=1;$("#"+wco.div+" #examFlag").css({"display":"inline-block"}).addClass("flagWnl").removeClass("flagPos");}else{gebi("elem_wnl"+wcid).value=0;$("#"+wco.div+" #examFlag").hide().removeClass("flagWnl");}}}
setWnlEyeFlag();if(!flag.Exam){setMainWNL();}
var idDiv=getCurTab();eye=eye.toLowerCase();if(newET_chkB4GrayExe(idDiv,eye)){newET_setGray_Exe(idDiv,eye);}
if(wco.nm=="Gonio"||(examName=="Gonio"&&wco.nm=="Draw")){var tmp=$("#elem_ci_gonio").val();tmp=(typeof tmp=="undefined")?1:parseInt(tmp)+1;$("#elem_ci_gonio").val(tmp);}
if(wco.nm=="Draw"){if(seOd.value=="1"||seOs.value=="1"){setAllDrawingToSave();}}}
var wnlOptTimer;function showEyeDD(val){if(val==-1){wnlOptTimer=clearTimeout(wnlOptTimer);}else if(val==0){if(wnlOptTimer==null){wnlOptTimer=setTimeout(function(){showEyeDD(0);},500);}else{$("#div_wnlOpts").hide();showEyeDD(-1);}}else{var wc=getWcId();var div=""+"<div id=\"div_wnlOpts\" class=\"wnlOpts\" onmouseover=\"showEyeDD(-1);\" onmouseout=\"showEyeDD(0)\" >"+"<a href=\"javascript:void(0);\" class=\"ou\" onclick=\"setwnl('OU')\">OU</a><br/>"+"<a href=\"javascript:void(0);\" class=\"od\" onclick=\"setwnl('OD')\">OD</a><br/>"+"<a href=\"javascript:void(0);\" class=\"os\" onclick=\"setwnl('OS')\">OS</a>"+"</div>";$("body").append(div);var pos=$("#"+wc.div+" input.wnl").length>0?$("#"+wc.div+" input.wnl").offset():$("#"+wc.div+" .wnl_btn").offset();$("#div_wnlOpts").show().css({'left':""+(pos.left-33)+"px",'top':""+pos.top+"px"});showEyeDD(-1);}}
function setMainWNL(){if(arrSubExams==null||typeof(arrSubExams)=="undefined")return;flg="1";var ln=arrSubExams.length;for(var i=0;i<ln;i++){var a=gebi("elem_wnl"+arrSubExams[i]).value;if(a!="1"){flg="0";break;}}
gebi("elem_wnl").value=flg;}
function setWnlEyeFlag(){var wcid=getWcId();var oWnl=gebi("elem_wnl"+wcid.nm);var seOd=gebi("elem_wnl"+wcid.nm+"Od");var seOs=gebi("elem_wnl"+wcid.nm+"Os");var flgOd=$("#"+wcid.div+" #flagWnlOd")[0];var flgOs=$("#"+wcid.div+" #flagWnlOs")[0];if(flgOd)flgOd.style.display=((oWnl.value=="0")&&(seOd.value=="1"))?"block":"none";if(flgOs)flgOs.style.display=((oWnl.value=="0")&&(seOs.value=="1"))?"block":"none";}
function getCurTab(){var ot=$(".tab-pane").not(".la-advance").filter(".active");if(ot.length>0){return ot.attr("id");}else if($(".tab-pane").length>0){$(".tab-pane").first().addClass("active");return getCurTab();}}
function getCurTabOfObj(o){if(typeof(o)!="undefined"&&o){return $(o).parents(".tab-pane").attr("id");}else{return'';}}
function npcCheckCb(obj){if(obj.checked==true){var oGrp=document.getElementsByName(""+obj.name);var len=oGrp.length;for(var i=0;i<len;i++){if((oGrp[i].checked==true)&&(oGrp[i].value!=obj.value)){oGrp[i].checked=false;utElem_capture(oGrp[i]);}}}}
function checkFunction(o)
{if(o.checked==true){if(o.name=="elem_ranSt[]"){var str="#elem_ranSt_fly, #elem_ranSt_nofly";if(o.id.indexOf("butter")!=-1){str="#elem_ranSt_butterfly, #elem_ranSt_nobutterfly";}
$(str).attr("checked",false).each(function(){utElem_capture(this);});o.checked=true;return;}
gebi("elem_eomOrtho").checked=false;utElem_capture(gebi("elem_eomOrtho"));if(o.name=="elem_eomControl[]"){$(":input[name*=elem_eomControl]").attr("checked",false).each(function(){utElem_capture(this);});o.checked=true;return;}
var nt=o.name;var ptrn="\\d$";var reg=new RegExp(ptrn,"g");var sn=nt;if(nt.match(reg)!=null)
{sn=nt.replace(reg,"");}
var u;if((nt.indexOf("AesoAexo")!=-1)||(nt.indexOf("VesoVexo")!=-1)){u=4;}else if((nt.indexOf("HyperHypo")!=-1)||(nt.indexOf("TrophiaPhoria")!=-1)||(nt.indexOf("EsoExo")!=-1)){u=2;}else if((nt.indexOf("NearFarBoth")!=-1)||(nt.indexOf("RightLeftAlter")!=-1)){u=3;}
for(var i=1;i<=u;i++)
{var snt=(i>1)?sn+i:sn;var t=gebi(snt);if(t){if((t.checked==true)&&(t.id!=o.id))
{t.checked=false;utElem_capture(t);}}}}}
function setExamFlag(){var wc=getWcId();var ps=$("#elem_isPositive").val();var wnl=$("#elem_wnl").val();if(ps==1){$("#"+wc.div+" #examFlag").css({"display":"inline-block"}).addClass("flagPos").removeClass("flagWnl");}
else if(wnl==1){$("#"+wc.div+" #examFlag").css({"display":"inline-block"}).addClass("flagWnl").removeClass("flagPos");}
else{$("#"+wc.div+" #examFlag").hide();}}
function setTabFlags(tab){var arr=(typeof tab!="undefined")?new Array(tab):arrSubExams;var len=arr.length;for(var i=0;i<len;i++){var oPos=gebi("elem_pos"+arr[i]);var tmp=arr[i];if(tmp=="Gonio")tmp="Iop";if(examName=="Fundus"&&tmp=="Draw"){var tid=$("#elem_drawType").val();if(tid=="8"){tmp="DrawON";}
else if(tid=="9"){tmp="DrawMA";}
else if(tid=="5"){tmp="Draw";}}
var oImg=gebi("flagimage_"+tmp);if(oPos&&oImg){oImg.style.display=((oPos.value=="1"))?"inline-block":"none";}}}
function checkNC1(obj){if(no_exm_hd(obj)&&(obj.disabled==true||obj.readOnly==true)){var wc=getWcId();var o=$("#"+wc.div+" input[id*=elem_noChange]")[0];if(o&&o.checked==true){o.checked=false;o.onclick();utElem_capture(o);}}else if(no_exm_hd(obj)&&examName=="EOM"){callClickEv();}}
function isNotEomField(name){var arrNotEomFields=["elem_eomFull","elem_eomOrtho","elem_color_sign_od","elem_color_od_1","elem_color_od_2","elem_color_sign_os","elem_color_os_1","elem_color_os_2","elem_comm_colorVis","elem_w4dot_distance","elem_w4dot_near","elem_comm_w4Dot","elem_ranSt[]","elem_ranSt_Dots9","elem_stereo_SecondsArc"];if(arrNotEomFields.indexOf(name)!=-1){return 1;}else{return 0;}}
function setYFlag(f)
{var wcid=getWcId();ct=wcid.c;if(ct=="1")ct="";if(f==true){$("#"+wcid.div+" #examFlag").css({"display":"inline-block"}).addClass("flagPos").removeClass("flagWnl");gebi("elem_posEom"+ct).value=gebi("elem_isPositive"+ct).value="1";gebi("elem_wnlEom"+ct).value=gebi("elem_wnl"+ct).value="0";}else{if(gebi("elem_wnl"+ct).value!="1"){$("#"+wcid.div+" #examFlag").hide();}
gebi("elem_posEom"+ct).value=gebi("elem_isPositive"+ct).value="0";}}
function yFinalCheck(){var wcid=getWcId();ct=wcid.c;if(ct==1)ct="";var odiv=gebi("divEom"+ct);var e=odiv.getElementsByTagName("*");var l=e.length;var f,ret=false,ret_2=0;for(var i=0;i<l;i++)
{f=e[i];if(typeof(f.name)=="undefined"||f.id.indexOf("-")!=-1||isNotEomField(f.name)){continue;}
if($("#elem_wnl"+ct).val()=="1"){if((f.type=="text"||f.type=="textarea")){if((f.name.indexOf("elem_duction_")!=-1&&f.value=="0")||($(f).hasClass("apct")&&f.value=="APCT")||(($(f).parents(".headtilt").length>0||$(f).parents(".grid").length>0)&&(f.value=="ORTHO"||f.value=="0"))){continue;}}else if(f.type=="checkbox"){if(f.name=="elem_nysta_no"||f.name=="elem_ahp_no"){continue;}}}else{if((($(f).hasClass("apct")&&f.value=="APCT")||(f.name.indexOf("elem_duction_")!=-1&&f.value=="0"))&&$("#elem_chng_divEom").val()!=1){continue;}}
if(f.type=="checkbox"){if(f.checked){ret=true;break;}}else if((f.type=="text")||(f.type=="textarea")){if((f.value!="")&&(f.value!="Comments")){ret=true;break;}}else if(f.name=="elem_eomDrawing_2"){if($.trim(f.value)!=""){ret=true;break;}}}
if(ret==false){oWcid=wcid;if(oWcid.nm=="Eom3"){if($("#divEom"+ct+" input[name="+oWcid.fod+"][value!=''][value!='0-0-0:;']").length>0){ret=true;}else{var val=$("input[name='hidCanvasWNL']").val();if(typeof(val)!="undefined"&&val.indexOf("no")!=-1){ret=true;}}}}
if(ret==false&&(ret_2==0||ret_2==3)){ret=false;}else{ret=true;}
return ret;}
function checkYFlagP(o){var cv=$.trim(o.value);var dv;dv=""+o.getAttribute("elementDefaultValue");if(typeof dv!="undefined"){dv=$.trim(dv);}
var tt;if(isNotEomField(o.name)){}else if(o.type=="checkbox"){if(o.checked){setYFlag(true);}else{tt=yFinalCheck();setYFlag(tt);}}else if((o.type=="textarea")||(o.type=="text")){if((cv!="")&&(cv!="Comments")&&(cv!="0")&&(cv!="ORTHO")){setYFlag(true);}else{tt=yFinalCheck();setYFlag(tt);}}else if(o.type=="radio"){if(cv!=dv){setYFlag(true);}else{tt=yFinalCheck();setYFlag(tt);}}else if(o.name=="elem_eomDrawing_2"){if($.trim(o.value)!=""){setYFlag(true);}else{tt=yFinalCheck();setYFlag(tt);}}
setTabFlags();}
function checkAbsent(obj,ddmnu,cls){var o,eye="";var enm=obj.name;if(obj.name.indexOf("Od")!=-1){eye="Od";}
if(obj.name.indexOf("Os")!=-1){eye="Os";}
if(eye==""){return;}
if(examName=="Pupil"){if(obj.checked){if(obj.name.indexOf("elem_apd")!=-1){var ar=['neg','trace','pos1','pos2','pos3','pos4','rapd'];if(obj.name.indexOf("neg")!=-1){$(":checked[name*=elem_apd"+eye+"_]").filter(function(){return(this.name.indexOf("neg")!=-1)?false:true;}).prop("checked",false);}else{$(":checked[name*=elem_apd"+eye+"_neg]").prop("checked",false);}}
checkwnls();}
return;}
var trid=$(obj).parents("tr").attr("id");if(typeof(trid)=="undefined"){o=$(obj).parents("tr");}
else{var trid=regReplace('\\d+$','',trid);if(trid.indexOf("d_Puncta")!=-1){trid="d_Puncta";}
o=$("tr[id*="+trid+"]");}
if((enm.toLowerCase().indexOf("absent")!=-1||obj.value=="-ve"||""+obj.value=="Absent")&&obj.checked==true){var str=(typeof(cls)!="undefined")?""+cls:":input";if(o){o.find(str).each(function(index){if(typeof(this.name)!="undefined"&&this.name.indexOf(eye)!=-1){if(this.name!=enm){if(this.type=="checkbox"){this.checked=false;}else{this.value="";}utElem_capture(this);}}});}}else{var str=(typeof(cls)!="undefined")?""+cls:":checked";if(o){o.find(str).each(function(index){if(typeof(this.name)!="undefined"&&this.name.indexOf(eye)!=-1){if(this.name.toLowerCase().indexOf("absent")!=-1||this.value=="-ve"||""+this.value=="Absent"){this.checked=false;utElem_capture(this);}}});}}
checkwnls();if(typeof(ddmnu)!="undefined"&&ddmnu!=""){checkSymClr(obj,ddmnu);}}
function checkSymClr(obj,id){}
function funReset_exam(dr){dr=dr||"";var wcid=getWcId();if(examName=="DrawPane"){resetDrawing(dr);return;}
$("#"+wcid.div+" :checked").attr("checked",false).each(function(){utElem_capture(this);});$("#"+wcid.div+" textarea,"+"#"+wcid.div+" :text,"+"#"+wcid.div+" select").not(".drwctrl").val("").each(function(){utElem_capture(this);});if((wcid.nm=="Draw")||(wcid.nm=="Eom3")){if($("div[id*=divCanvas]").length>0){resetDrawing(dr);}}
$("input[name=elem_wnl"+wcid.nm+"],"+"input[name=elem_wnl"+wcid.nm+"Od],"+"input[name=elem_wnl"+wcid.nm+"Os],"+"input[name=elem_pos"+wcid.nm+"]").val("0");$("#"+wcid.div+" input[name=elem_noChange]").attr("checked",false).triggerHandler("click");if(examName=="Gonio"){$("#hdr_iop :checked").attr("checked",false).each(function(){utElem_capture(this);});$("#hdr_iop textarea,"+"#hdr_iop :text,"+"#hdr_iop select").val("").each(function(){utElem_capture(this);});$("#"+wcid.div+" :input:not(.greyAll_v2)").eq(1).triggerHandler("keyup");if(wcid.div=="divIop1"){$("#divDilation :input:not(.greyAll_v2)").eq(1).triggerHandler("keyup");$("#divOOD :input:not(.greyAll_v2)").eq(1).triggerHandler("keyup");}}else if(examName=="SLE"){$("input[name=elem_penLight]").attr("checked",false);}else if(wcid.nm=="Pupil"){$("input[name=elem_pharmadilated]").attr("checked",false);}
if(wcid.nm=="Eom"||wcid.nm=="Eom3"){var ct=""+wcid.c;if(ct=="1")ct="";$("input[name=elem_wnl"+ct+"],"+"input[name=elem_isPositive"+ct+"]").val("0");}
$(".btnModifiers").removeClass("btnModifiersActive");checkwnls();}
function checkwnls_eom(){var tt=yFinalCheck();if(tt){var wcid=getWcId();ct=wcid.c;if(ct==3){$("#divEom3").triggerHandler("click");}}
setYFlag(tt);setTabFlags();}
function checkwnls(obj){if(examName=="EOM"){checkwnls_eom();return;}
if(typeof(obj)=="undefined"){var wco=getWcId();var flag=getYFlagCurTab();}else{var inx=getCurTabOfObj(obj);var wco=getWcId(inx);var flag=getYFlagCurTab(inx);}
var wcid=wco.nm;if(wcid=="DrawPane"||wcid=="DrawCL"){return;}
if(flag.Exam==true){$("#"+wco.div+" #examFlag").css({"display":"inline-block"}).addClass("flagPos").removeClass("flagWnl");gebi("elem_isPositive").value=1;gebi("elem_wnl").value=0;gebi("elem_wnl"+wcid).value=0;gebi("elem_pos"+wcid).value=1;var seOd=gebi("elem_wnl"+wcid+"Od");var seOs=gebi("elem_wnl"+wcid+"Os");if(seOd&&seOd.value=="")seOd.value="0";if(seOs&&seOs.value=="")seOs.value="0";if(seOd)seOd.value=((seOd.value=="1")&&(flag.Od==true))?"0":seOd.value;if(seOs)seOs.value=((seOs.value=="1")&&(flag.Os==true))?"0":seOs.value;}else if(gebi("elem_wnl"+wcid).value==1){$("#"+wco.div+" #examFlag").css({"display":"inline-block"}).addClass("flagWnl").removeClass("flagPos");}else{$("#"+wco.div+" #examFlag").hide();gebi("elem_isPositive").value=0;gebi("elem_wnl").value=0;gebi("elem_pos"+wcid).value=0;}
setWnlEyeFlag();if(!flag.Exam){setPositive();}
setTabFlags();}
var ar_check_bl;function check_bl(obj){if(ar_check_bl&&ar_check_bl.check){if(ar_check_bl.ar&&ar_check_bl.ar.indexOf(obj)==-1){ar_check_bl.ar[ar_check_bl.ar.length]=obj;}else{return;}}
var nm_2="";if(obj=="surgiAlt"){$("#elem_Od_"+obj+"").each(function(i){$("#elem_Os_"+obj+"").attr("checked",this.checked).each(function(){utElem_capture(this);});});}else{if($(".grp_"+obj).length>0){var x=".grp_"+obj;}else{var x="#d_"+obj;}
if(typeof(examName)!="undefined"&&(examName=="LA"||examName=="SLE"||examName=="Fundus")){var wc=getWcId();if(wc.div&&$.trim(wc.div)!=$.trim(x)){x="#"+wc.div+" "+x;}}
var ptrn=x+" :input[name*=Od_],"+
x+" :input[name*=_od],"+
x+" :input[name*=Od],"+
x+" :input[name*=od_]";$(ptrn).each(function(i){if(this.type=="button"){return;}
nm_2=this.name.replace(/Od/g,"Os");if($(x+" :input[name="+nm_2+"]").length==0){if(this.value=="RUL"){nm_2=nm_2.replace(/rul/g,"lul");}
else if(this.value=="RLL"){nm_2=nm_2.replace(/rll/g,"lll");}}
if($(this).parents(".divLesionModifier").length==1&&this.type=="checkbox"){var val_2=this.value;$(x+" :input[name="+nm_2+"][value='"+val_2+"']").prop("checked",this.checked).each(function(){utElem_capture(this);});}else{if(this.type=="checkbox"){$("#d_Entro :input[name=elem_entroOs_Absent]").hide();$(x+" :input[name="+nm_2+"]").prop("checked",this.checked).each(function(){utElem_capture(this);});}else{$(x+" :input[name="+nm_2+"]").val(this.value).each(function(){utElem_capture(this);});}}});}
if(nm_2!=""){var tmp=$(x+" :input[name="+nm_2+"]").eq(0).attr('type');var tmp2=""+$(x+" :input[name="+nm_2+"]").eq(0).attr('onclick');if(tmp=="checkbox"){if(tmp2.toLowerCase().indexOf("checkabsent")==-1&&tmp2.toLowerCase().indexOf("placs_checkSingle")==-1){$(x+" :input[name="+nm_2+"]").triggerHandler("click");}else{if($(x+" :checked").length>0){$(x+" :checked").each(function(){$(this).triggerHandler("click");});}else{$(x+" :input[name="+nm_2+"]").triggerHandler("click");}}}else{$(x+" :input[name="+nm_2+"]").triggerHandler("change");var tmp2=$(x+" :input[name="+nm_2+"]").eq(0).attr('onblur');if(typeof(tmp2)=="undefined"||$.trim(tmp2)==""){checkAbsent($(x+" :input[name="+nm_2+"]")[0]);}else{$(x+" :input[name="+nm_2+"]").triggerHandler("blur");}}
if(typeof(examName)!="undefined"&&examName=="Gonio"){$(x+" :input[name="+nm_2+"]").trigger("mouseup");}}}
function check_bl_strt(comastr){if(examName=="Pupil"){if($("#os_pr").html()=="PERRLA"){return;}}
var arr=comastr.split(",");var ln=arr.length;for(var i=0;i<ln;i++){check_bl(arr[i]);}}
function check_bilateral(wh){ar_check_bl={};ar_check_bl.check=true;ar_check_bl.ar=[];if(typeof(wh)!="undefined"&&wh!=""){if(wh=="lids_advc"){if($("#div6").hasClass("active")){$("#div6 .bilat").not(".bilat_all").trigger("click");}else if($("#div7").hasClass("active")){$("#div7 .bilat").not(".bilat_all").trigger("click");}}else if(wh=="lacri_advc"){$("#div8 .bilat").not(".bilat_all").trigger("click");}}else{var oTb=getCurTab();$("#"+oTb+" .bilat").not($(".la-advance .bilat, .bilat_all")).trigger("click");}
ar_check_bl.check=false;ar_check_bl.ar.length=0;}
function openSubGrp(obj){var obj_id="d_"+obj;var obj_cls="tr.grp_"+obj;if($("#d_"+obj+"").length==0){var t=$("tr.grp_"+obj+"").filter(".grp_handle").attr("id");if($("#"+t).length>0){obj_id=t;}}
if($("#"+obj_id+"").hasClass("sbGrpOpen")){$(""+obj_cls+"").removeClass("sbGrpOpen");$("#"+obj_id+" .glyphicon").addClass("glyphicon-menu-down").removeClass("glyphicon-menu-up");}else{$(""+obj_cls+"").addClass("sbGrpOpen");$("#"+obj_id+" .glyphicon").addClass("glyphicon-menu-up").removeClass("glyphicon-menu-down");}}
function freezeElemAll(f){$(":input").removeAttr("disabled");}
function freezeExe(ict,f,chk)
{if(finalize_flag==1&&isReviewable!=true){return;}
var ignore="";chk=(chk==1)?"1":"0";if(chk==1){if((oneEye_issue!="")&&(oneEye_eye!="")){ignore=""+oneEye_eye;}}
if(ignore=="OD"){if(f==true){$("#"+ict+" :input[name*='os_'],#"+ict+" :input[name*='Os'],").attr("disabled","disabled");}else{$("#"+ict+" :input[name*='os_'],#"+ict+" :input[name*='Os'],").removeAttr("disabled");}}else if(ignore=="OS"){if(f==true){$("#"+ict+" :input[name*='od_'],#"+ict+" :input[name*='Od'],").attr("disabled","disabled");}else{$("#"+ict+" :input[name*='od_'],#"+ict+" :input[name*='Od'],").removeAttr("disabled");}}else{if(f==true){$("#"+ict+" :input[type!='button'][type!='submit'][name!='elem_noChange']").filter(function(){return no_exm_hd(this);}).attr("disabled","disabled");}else{$("#"+ict+" :input[type!='button'][type!='submit'][name!='elem_noChange']").removeAttr("disabled");}}}
function setGridVal(c,obj){var divIndx=(obj.name.indexOf("_1")!=-1)?1:0;if(obj.value=="Comitant"){$("#Grid_"+c+" div.grid:eq("+divIndx+") td:eq(4) input[type=text]").each(function(index){var val_in=this.value;$("#Grid_"+c+" div.grid:eq("+divIndx+")  table:eq(0) td").each(function(index2){if(index2!=4&&index2!=0&&index2!=2&&index2!=6&&index2!=8){$(this).find("input[type=text]:eq("+index+")").val(""+val_in).each(function(indx){if(finalize_flag==1&&isReviewable!=1&&indx>0){return;}this.click();});}});});}else{var flgEmp=0;if($("#Grid_"+c+" div.grid:eq("+divIndx+")  table td input[type=text][value='0'][class!=apct]").length==18){flgEmp=1;}
$("#Grid_"+c+" div.grid:eq("+divIndx+")  table td input[type=text][class!=apct]").val(function(indx){if(flgEmp==1){return"";}else{return(indx%2==0)?"0":"ORTHO";}}).each(function(){if(finalize_flag==1&&isReviewable!=1&&indx>0){return;}this.click();});}}
function wv_get_simple_menu_js(mn_nm,id){var x=$("."+mn_nm+":eq(0)").prop("outerHTML");var trgtid=$("."+mn_nm+":eq(0) button").data("trgt-id");x=x.replace("data-trgt-id=\""+trgtid+"\"","data-trgt-id=\""+id+"\"");return x;}
function addGrid(){var counterGrid=parseInt($("input[name=elem_counterGrid]").val())+parseInt(1);$("input[name=elem_counterGrid]").val(counterGrid);var arr_grid_type=["Distance","Near"];var grid="<div id=\"Grid_"+counterGrid+"\" class=\"row gridrow\" >";for(var z in arr_grid_type){var labelGrid=arr_grid_type[z];var elem_gf="elem_gf_"+labelGrid+"_"+counterGrid+"[]";var elem_comm="elem_comm_"+labelGrid+"_"+counterGrid+"";var elem_apct="elem_apct_"+labelGrid+"_"+counterGrid+"";var elem_sc="elem_sc_"+labelGrid+"_"+counterGrid+"";var elem_cc="elem_cc_"+labelGrid+"_"+counterGrid+"";var elem_ccprisms="elem_ccprisms_"+labelGrid+"_"+counterGrid+"";var elem_bifocal="elem_bifocal_"+labelGrid+"_"+counterGrid+"";var indx=0;var add_btn="";if(labelGrid=="Near"){add_btn="<input type=\"button\" name=\"btn_delgrid\" value=\"Remove\"  class=\"dff_button_sm btn btn-sm btn-danger\" onclick=\"delGrid('"+counterGrid+"')\">";}
grid+="<div class=\"col-sm-6\">"+"<div class=\"exambox\">"+"<div class=\"grid\">"+"<div class=\"head\">"+"<div class=\"row\">"+"<div class=\"col-md-1\" ><h2>"+labelGrid+"</h2></div>"+"<div class=\"col-md-11 form-inline text-right\">"+"<input type=\"button\" name=\"btn_rst_"+z+"\" value=\"Set To Ortho\" class=\"dff_button_sm exambut\"  onclick=\"setGridVal('"+counterGrid+"',this)\">"+"<div class=\"input-group\">"+"<input type=\"text\" id=\""+elem_apct+"\" name=\""+elem_apct+"\" value=\"\" class=\"apct form-control\" onblur=\"checkYFlagP(this);\" >";grid+=wv_get_simple_menu_js("menu_apct",elem_apct);grid+="</div>";grid+="<input type=\"checkbox\" id=\""+elem_sc+"\" name=\""+elem_sc+"\" value=\"1\"  onclick=\"checkYFlagP(this);\" ><label for=\""+elem_sc+"\">SC</label>"+"<input type=\"checkbox\" id=\""+elem_cc+"\" name=\""+elem_cc+"\" value=\"1\"  onclick=\"checkYFlagP(this);\" ><label for=\""+elem_cc+"\">CC</label>"+"<input type=\"checkbox\" id=\""+elem_ccprisms+"\" name=\""+elem_ccprisms+"\" value=\"1\"  onclick=\"checkYFlagP(this);\" ><label for=\""+elem_ccprisms+"\">CC Prisms</label> ";if(labelGrid=="Near"){grid+="<input type=\"checkbox\" id=\""+elem_bifocal+"\" name=\""+elem_bifocal+"\" value=\"1\"  onclick=\"checkYFlagP(this);\" ><label for=\""+elem_bifocal+"\">Bifocal</label> ";}
grid+="<input type=\"button\" name=\"btn_comi_"+z+"\" value=\"Comitant\"  class=\"dff_button_sm exambut\" onclick=\"setGridVal('"+counterGrid+"',this)\">"+
add_btn+"</div>"+"</div>"+"</div>"+"<div class=\"clearfix\"></div>"+"<div class=\"pd10\">"+"<div class=\"row\">";grid+="<table class=\"table table-responsive\">";for(var tr=1;tr<=3;tr++){var csstr="";if(tr==3){csstr="class=\"lasttr\"";}
grid+="<tr "+csstr+" >";for(var td=1;td<=3;td++){if(td==3){var css="class=\"lasttd form-inline\"";}else{var css="class=\"form-inline\"";}
grid+="<td  "+css+" >";for(var inp=1;inp<=4;inp++){var elem_gf_id="elem_gf_"+labelGrid+"_"+counterGrid+"_"+indx;grid+="<div class=\"input-group\">";grid+="<input type=\"text\" id=\""+elem_gf_id+"\" name=\""+elem_gf+"\" value=\"\" onblur=\"checkYFlagP(this);checkFunction(this);\" class=\"form-control\" aria-label=\"...\" >";if(inp==2){grid+=wv_get_simple_menu_js("menu_grids_eso_"+labelGrid,elem_gf_id);}else if(inp==4){grid+=wv_get_simple_menu_js("menu_grids_hyper_"+labelGrid,elem_gf_id);}else{grid+=wv_get_simple_menu_js("menu_grids_num",elem_gf_id);}
grid+="</div>";if(inp==2){grid+="<br/>";}
indx++;}
grid+="</td>";}
grid+="</tr>";}
grid+="</table>";grid+="</div>";grid+="<div class=\"examcomt\"><textarea name=\""+elem_comm+"\" onblur=\"checkYFlagP(this);\" class=\"form-control\" ></textarea></div>"+"<div class=\"clearfix\"></div>";grid+=" </div>";grid+=" </div>";grid+=addHeadTilt(counterGrid,labelGrid);grid+=" </div></div>";}
grid+="</div>";$("#Grids").append(grid);wv_activate_menu_click();}
function addHeadTilt(counterHT,labelGrid){var coords="-1,-1,-1,25";var coords_sm="-1,-1,-1,25";var grid="";var labelHT=(labelGrid=="Distance")?"Right":"Left";var elem_ht="elem_ht_"+labelHT+"_"+counterHT+"[]";var elem_comm="elem_comm_"+labelHT+"_"+counterHT+"";var indx=0;grid+="<div class=\"headtilt\">"+"<div class=\"row\">"+"<table class=\"table table-responsive\">"+"<tr>"+"<td>"+"<h3>"+labelHT+" Head Tilt</h3>"+"</td>";tmpMenuAdd="Distance";grid+="<td class=\"form-inline\">";for(inp=1;inp<=4;inp++){elem_ht_id="elem_ht_"+labelHT+"_"+counterHT+"_"+indx;grid+="<input type=\"text\" id=\""+elem_ht_id+"\" name=\""+elem_ht+"\" value=\"\" onblur=\"checkYFlagP(this);checkFunction(this);\" class=\"form-control\">";grid+="<div class=\"input-group\">";if(inp==2){grid+=wv_get_simple_menu_js("menu_grids_eso_"+tmpMenuAdd,elem_ht_id);}else if(inp==4){grid+=wv_get_simple_menu_js("menu_grids_hyper_"+tmpMenuAdd,elem_ht_id);}else{grid+=wv_get_simple_menu_js("menu_grids_num",elem_ht_id);}
grid+="</div>";if(inp==2){grid+="<br/>";}
indx++;}
grid+="</td>";grid+="</tr></table>";grid+="</div>";grid+="<div class=\"examcomt\"><textarea name=\""+elem_comm+"\" class=\"form-control\" ></textarea></div>";grid+="</div>";return grid;}
function delGrid(cntr){$("#Grid_"+cntr).remove();}
function chk_Perrla(g){var e=document.getElementById("elem_perrla");if(typeof(g)!="undefined"&&g==-1){if(e.value=="1"){g=1;}else{return;}}
var od=os=false;if(window.opener.document.getElementById("phth_pros").value=="Prosthesis"||window.opener.document.getElementById("phth_pros").value=="Phthisis"){od=(window.opener.document.getElementById("is_od_os").value=="OD")?true:false;os=(window.opener.document.getElementById("is_od_os").value=="OS")?true:false;}
if(g!="1"){if(e.value=="0"){e.value="1";}else{e.value="0";}}
if(od==false){for(var i=1;i<=46;i++){var t=gebi('od_'+i);if(t){t.checked=(e.value=="1")?false:t.defaultChecked;t.disabled=(e.value=="1")?true:false;utElem_capture(t);}}
gebi('od_des').value=(e.value=="1")?"":gebi('od_des').defaultValue;gebi('od_des').disabled=(e.value=="1")?true:false;var t=gebi("elem_Od_surgiAlt");if(t){t.checked=(e.value=="1")?false:t.defaultChecked;t.disabled=(e.value=="1")?true:false;utElem_capture(t);}
gebi('od_pr').innerHTML=(e.value=="1")?'PERRLA':"&nbsp;";}
if(os==false){gebi('os_pr').innerHTML=(e.value=="1")?'PERRLA':"&nbsp;";for(var i=1;i<=46;i++){var t=gebi('os_'+i);if(t){t.disabled=(e.value=="1")?true:false;t.checked=(e.value=="1")?false:t.defaultChecked;utElem_capture(t);}}
if(gebi('os_des')){gebi('os_des').value=(e.value=="1")?"":gebi('od_des').defaultValue;gebi('os_des').disabled=(e.value=="1")?true:false;}
var t=gebi("elem_Os_surgiAlt");if(t){t.checked=(e.value=="1")?false:t.defaultChecked;t.disabled=(e.value=="1")?true:false;utElem_capture(t);}}
checkwnls();var idDiv="divPupil";if(newET_chkB4GrayExe(idDiv,"ou")){newET_setGray_Exe(idDiv,"ou");}}
function clickPhrma(obj){var oChk=oneEye_isSet(1);if(oChk){if(oChk.eye==obj.value){obj.value="";return;}else if(obj.value=="OU"){obj.value=(oChk.eye=="OD")?"OS":"OD";}}
var x=$("#elem_pharmadilated").prop("checked");if(obj.value!=""&&x!=true){$("#lblPharmaDilate").click();}}
function placs_displayModifier(ex,eye){if($("#divModifier"+ex+eye+"").css("display")==""||$("#divModifier"+ex+eye+"").css("display")=="block"){$("#divModifier"+ex+eye+"").hide();if($("#divModifier"+ex+eye+" :checked").length>0||$("#divModifier"+ex+eye+" input[type='text']").filter(function(){return!!this.value;}).length>0){if(!$("#btnMod_"+ex+eye).hasClass("btnModifiersActive")){$("#btnMod_"+ex+eye).addClass("btnModifiersActive");}}else{$("#btnMod_"+ex+eye).removeClass("btnModifiersActive");}}else{$(".divLesionModifier").hide();var ofst=$("#divModifier"+ex+eye+"").show();}}
function placs_reset(ex,eye){$("#divModifier"+ex+eye+" input").each(function(){if(this.type=='checkbox'){this.checked=false;utElem_capture(this);}else if(this.type=='text'&&this.value!=''){this.value='';utElem_capture(this);}});}
function placs_checkSingle(obj){if(obj.type=="checkbox"&&obj.checked==true){var nm=obj.name;var o=document.getElementsByName(nm);var ln=o.length;if(ln>1){for(var i=0;i<ln;i++){if(obj.value!=o[i].value){o[i].checked=false;utElem_capture(o[i]);}}}}}
function placs_showAdvance(){}
function trgat(obj,t){var trgtod=gebi("trgtOd").value;var trgtos=gebi("trgtOs").value;var oFlg=gebi("redflag");var oCtr=gebi("fieldsCount");var ctr=(oCtr&&(typeof oCtr.value!="undefined")&&(oCtr.value!=""))?""+oCtr.value:"";var arr=ctr.split(",");var len=arr.length;trgtod=((typeof trgtod!="undefined")&&(trgtod!=""))?trgtod:21;trgtos=((typeof trgtos!="undefined")&&(trgtos!=""))?trgtos:21;oFlg.style.visibility="hidden";var arrOd=new Array("elem_appOd","elem_puffOd","elem_XtOd","elem_ttOd");var arrOs=new Array("elem_appOs","elem_puffOs","elem_XtOs","elem_ttOs");outer:for(var i=0;i<len;i++){var od,os;for(var j=0;j<4;j++){if(i>0){od=gebi(arrOd[j]+""+i);os=gebi(arrOs[j]+""+i);}else{od=gebi(arrOd[j]);os=gebi(arrOs[j]);}
if(od&&(od.value!="")&&(od.value>od.value)){oFlg.style.visibility="visible";break outer;}
if(os&&(os.value!="")&&(os.value>trgtos)){oFlg.style.visibility="visible";break outer;}}}
if(obj){setPresureTime(obj.id,t);if(obj.value!=""){if(typeof(t)=="undefined")t="";var fld_mtd=$.trim($("#elem_appMethod"+t).val());if(fld_mtd==""&&(obj.name.indexOf("elem_appOd")!=-1||obj.name.indexOf("elem_appOs")!=-1)){if(typeof(iop_def_method)=="undefined"){iop_def_method="";}
$("#elem_appMethod"+t).val(""+iop_def_method);}}}}
function setPresureTime(id,t){var str="";if(id.indexOf("elem_app")!=-1){if(t){str="elem_appTime"+t;}else{str="elem_appTime"}}else if(id.indexOf("elem_puff")!=-1){if(t){str="elem_puffTime"+t;}else{str="elem_puffTime";}}else if(id.indexOf("elem_X")!=-1){if(t){str="elem_xTime"+t;}else{str="elem_xTime";}}else if(id.indexOf("elem_tt")!=-1){if(t){str="elem_ttTime"+t;}else{str="elem_ttTime";}}
var o=gebi(str);if(o&&($.trim(o.value)=="")){o.onclick();}}
function checkdatas(obj,val){var cls="";if(obj.name.indexOf("tt")!=-1){cls="tt";}else if(obj.name.indexOf("tx")!=-1){cls="tx";}else if(obj.name.indexOf("puff")!=-1){cls="tp";}else if(obj.name.indexOf("applanation")!=-1){cls="ta";}
if(isNaN(val)||val=="")val=0;val=parseInt(val)+parseInt(1);if(cls=="")return;if(val==0){val="1";}
if(obj.checked){$("#multiplePressure"+val+" ."+cls).removeClass("tabOff");}else{$("#multiplePressure"+val+" ."+cls).addClass("tabOff");$("#multiplePressure"+val+" ."+cls+" :input[type=text],"+"#multiplePressure"+val+" ."+cls+" textarea").val("");}}
function getFCInfo(){var arC=[];var cntr=0;var e_cntr=0;$(".mulPressure").each(function(){var id=$(this).attr("id");var num=""+id.replace(/multiplePressure/g,"");var eId=$("#"+id+" input[id*=elem_appOd]").eq(0).attr("id");var e_num=""+eId.replace(/elem_appOd/g,"");if(e_num=="")e_num=0;arC[arC.length]=e_num;if(parseInt(cntr)<parseInt(num))cntr=parseInt(num);if(parseInt(e_cntr)<parseInt(e_num))e_cntr=parseInt(e_num);});return{'divcntr':cntr,'e_cntr':e_cntr,"arC":arC};}
function multiplePressure(){var oFc=getFCInfo();var cntr=oFc.divcntr;var arC=oFc.arC;var e_cntr=oFc.e_cntr;var cur_cntr_dv=parseInt(cntr)+parseInt(1);var cur_cntr=parseInt(e_cntr)+parseInt(1);arC[arC.length]=cur_cntr;var str="";var str=''+'<div id="multiplePressure'+cur_cntr_dv+'" class="mulPressure ">'+'<div class="row">'+'<div class="col-sm-2 ">'+'<div class="form-group form-inline">'+'<label for="elem_appMethod'+cur_cntr+'">Method</label> '+'<input type="text" name="elem_appMethod'+cur_cntr+'"  id="elem_appMethod'+cur_cntr+'" value="" class="form-control iop_method" placeholder="Method">'+'</div>'+'</div>'+'<div class="col-sm-1">'+'<div class="input-group">'+'<div class="input-group-addon odcolo" >OD</div>'+'<input name="elem_appOd'+cur_cntr+'" type="text" id="elem_appOd'+cur_cntr+'" onBlur="trgat(this,\''+cur_cntr+'\')" value="" class="form-control" placeholder="">'+'</div>'+'</div>'+'<div class="col-sm-1">'+'<div class="input-group">'+'<div class="input-group-addon oscolo">OS</div>'+'<input name="elem_appOs'+cur_cntr+'" type="text" id="elem_appOs'+cur_cntr+'" onBlur="trgat(this,\''+cur_cntr+'\')" value="" class="form-control" placeholder="">'+'</div>'+'</div>'+'<div class="col-sm-1">'+'<div class="input-group">'+'<div class="input-group-addon"><span class="glyphicon glyphicon-time" aria-hidden="true"></span></div>'+'<input name="elem_appTime'+cur_cntr+'" type="text" id="elem_appTime'+cur_cntr+'" value="" onClick="this.value=currenttime();" class="form-control" placeholder="">'+'</div>'+'</div>'+'<div class="col-sm-6 form-horizontal">'+'<div class="form-group">'+'<label class="control-label col-sm-2" >Description</label>'+'<div class="col-sm-10">'+'<textarea name="elem_descTa'+cur_cntr+'" id="elem_descTa'+cur_cntr+'" rows="1" cols="31" class="form-control " ></textarea>'+'<input type="hidden" name="elem_descTa'+cur_cntr+'Prev" value="">'+'</div>'+'</div>'+'</div>'+'<div class="col-sm-1 text-center">'+'<figure><span class="glyphicon glyphicon-remove-sign" onclick="delImage2(this);"></span></figure>'+'</div>'+'</div>'+'</div>';$("#parentTD").append(str);$("#fieldsCount").val(function(){return(arC.length>1)?""+arC:"";});$("#divIopElem :input[type=text]").eq(1).triggerHandler("keyup");cn_ta_clr_npsych("#divIopElem .iop_method");cn_ta_clr_npsych("#divIopElem textarea[name*=elem_descTa]");cn_typeahead();oneEye_check();}
function delImage2(o){var id=$(o).parents(".mulPressure").attr("id");if(typeof(id)=="undefined"){return;}
var rid=id.replace(/multiplePressure/g,"");var ar=[];if(rid=="1"){$("#"+id+" :input[type=text],"+"#"+id+" textarea,").val("");$("#"+id+" :input[type=checkbox]").attr("checked",false);}else{$("#"+id).remove();}
var ofc=getFCInfo();$("#fieldsCount").val(function(){return(ofc.arC.length>1)?""+ofc.arC:"";});$("#divIopElem :input[type=text]").eq(1).triggerHandler("keyup");}
function addAnes(){var aneslen=$("#conAnes").attr("data-AnesLen");var curId=parseInt(aneslen)+1;$("#conAnes").attr("data-AnesLen",curId);var str_anes="";var td_c=1;var tr_lm=tr_lm_gl[0];for(var x in arr_db_anas){if(td_c==1){str_anes+="<tr>";}
var tvl=arr_db_anas[x];var tnm=mk_var_nm(tvl,"anes");var tvl_dis=tvl;if(tvl_dis.length>od_nm_ln){tvl_dis=tvl_dis.substr(0,(od_nm_ln-2))+"..";}
str_anes+="<td>";str_anes+="<input name=\""+tnm+"[]\" type=\"checkbox\" id=\""+tnm+"_"+curId+"\" value=\""+curId+"\" "+" onClick=\"checkAnsTime(this)\" >"+"<label for=\""+tnm+"_"+curId+"\" title=\""+tvl+"\">"+tvl_dis+"</label> ";str_anes+="</td>";td_c++;if(td_c>tr_lm){str_anes+="</tr>";td_c=1;}}
if(str_anes!=""){str_anes="<div class=\"dv_opthdrop col-lg-6 anelist\" ><table class=\"table-responsive\">"+str_anes+"</table></div>";}
var imgAnes="<span class=\"btnDelIop glyphicon glyphicon-remove-sign\" onClick=\"delAnes("+curId+")\"></span>";var str="<div id=\"tr_ans_"+curId+"\" class=\"row\" > "+" <div class=\"col-lg-1 \"><span class=\"iopanthead\">Anesthetic</span></div> "+
str_anes+"<div class=\"dv_opthdrop_time col-lg-5 anthsopt\" >  "+"<ul> <li class=\"form-inline\">"+"<input name=\"anes_other[]\" type=\"text\" id=\"anes_other"+curId+"\" value=\"Other\" "+"   onfocus=\"this.value=(this.value=='Other')?'':this.value;\""+"   onChange=\"checkAnsTime(this)\" class=\"form-control\" placeholder=\"Other\" > "+"<input name=\"dt_up[]\" id=\"dt_up"+curId+"\" type=\"text\" "+" value=\"\""+" class=\"form-control date-pick\" placeholder=\"Date\" size=\"10\"> "+"<input name=\"time_up[]\" id=\"time_up"+curId+"\" type=\"text\" "+" value=\"\""+" onClick=\"this.value=currenttime();\" class=\"form-control\" placeholder=\"Time\" size=\"6\">"+"</li> "+"<li class=\"ousml\"><input type=\"radio\" name=\"aneseye"+curId+"\" value=\"OU\" "+"id=\"aneseye_ou"+curId+"\"  "+" checked ><label for=\"aneseye_ou"+curId+"\"></label></li> "+"<li class=\"odsml\"><input type=\"radio\" name=\"aneseye"+curId+"\" value=\"OD\" "+"id=\"aneseye_od"+curId+"\"  "+" ><label for=\"aneseye_od"+curId+"\"></label></li> "+"<li class=\"ossml\"><input type=\"radio\" name=\"aneseye"+curId+"\" value=\"OS\" "+"id=\"aneseye_os"+curId+"\"  "+" ><label for=\"aneseye_os"+curId+"\"></label></li> "+"<li >"+imgAnes+"</li></ul>"+"</div>"+"</div>";$("#conAnes .divcontent").append(str);$("#divIopElem :input[type=text]").eq(1).triggerHandler("keyup");$(".date-pick").datepicker({dateFormat:top.z_js_dt_frmt});oneEye_check();}
function delAnes(id){$("#conAnes #tr_ans_"+id).remove();$("#divIopElem :input[type=text]").eq(1).trigger("keyup");}
function checkAnsTime(s){var arid=s.id.split("_");var id=arid[1]||"";id=id.replace(/other/,"");if(id==""){return;}
var o=gebi("time_up"+id),p=gebi("dt_up"+id);if(((s.type=="checkbox"&&s.checked==true)||(s.type=="text"&&s.value!=""))){if(($.trim(o.value)=="")){o.onclick();}
if(($.trim(p.value)=="")){p.value=$.datepicker.formatDate('mm-dd-yy',new Date());}}}
function addOOD(){var len=$("#conOOD").attr("data-OODLen");var curId=parseInt(len)+1;$("#conOOD").attr("data-OODLen",curId);var str_ood="";var td_c=1;var tr_lm=tr_lm_gl[2];for(var x in arr_db_ood){if(td_c==1){str_ood+="<tr>";}
var tvl=arr_db_ood[x];var tnm=mk_var_nm(tvl,"ood");var tvl_dis=tvl;if(tvl_dis.length>od_nm_ln){tvl_dis=tvl_dis.substr(0,od_nm_ln-2)+"..";}
str_ood+="<td>";str_ood+="<input name=\""+tnm+"[]\" type=\"checkbox\" id=\""+tnm+"_"+curId+"\" value=\""+curId+"\" "+" onClick=\"checkDTime(this)\" >"+"<label for=\""+tnm+"_"+curId+"\" title=\""+tvl+"\">"+tvl_dis+"</label> ";str_ood+="</td>";td_c++;if(td_c>tr_lm){str_ood+="</tr>";td_c=1;}}
if(str_ood!=""){str_ood="<div class=\"dv_opthdrop col-lg-5 anelist\"><table class=\"table-responsive\">"+str_ood+"</table></div>";}
var imgOOD="<span class=\"btnDelIop glyphicon glyphicon-remove-sign\" onClick=\"delOOD("+curId+",'OOD')\" ></span>";var str=""+"<div id=\"tr_OOD_"+curId+"\" class=\"row\" >"+"<div class=\"col-lg-2 \"><span class=\"iopanthead\">Other Ophthalmic Drops</span></div>"+
str_ood+"<div class=\"dv_opthdrop_time col-lg-5 anthsopt\">  "+"<ul> <li class=\"form-inline\">"+"<input type=\"text\" name=\"other_desc_ood[]\" id=\"other_desc_ood"+curId+"\" value=\"\" onchange=\"chkDOther(this)\" class=\"form-control\" placeholder=\"Other\"  > "+"<input type=\"text\" name=\"curdates_ood[]\" id=\"curdates_ood"+curId+"\" "+"  value=\"\" class=\"form-control date-pick\" placeholder=\"Date\" size=\"10\"> "+"<input type=\"text\" name=\"curtimes_ood[]\" id=\"curtimes_ood"+curId+"\" "+"  value=\"\" onClick=\"this.value=currenttime();\" class=\"form-control\" placeholder=\"Time\" size=\"6\"> "+"</li> "+"<li class=\"ousml\"><input type=\"radio\" name=\"oodeye"+curId+"\" value=\"OU\" "+"id=\"oodeye_ou"+curId+"\"  "+" checked ><label for=\"oodeye_ou"+curId+"\" ></label></li> "+"<li class=\"odsml\"><input type=\"radio\" name=\"oodeye"+curId+"\" value=\"OD\" "+"id=\"oodeye_od"+curId+"\"  "+" ><label for=\"oodeye_od"+curId+"\" ></label></li> "+"<li class=\"ossml\"><input type=\"radio\" name=\"oodeye"+curId+"\" value=\"OS\" "+"id=\"oodeye_os"+curId+"\"  "+" ><label for=\"oodeye_os"+curId+"\" ></label></li> "+"<li>"+imgOOD+"</li></ul> "+"</div>"+"</div>";$("#conOOD").append(str);$("#conOOD :input[type=text]").eq(1).triggerHandler("keyup");$(".date-pick").datepicker({dateFormat:top.z_js_dt_frmt});oneEye_check();}
function delOOD(id){$("#conOOD #tr_OOD_"+id).remove();$("#divOOD :input[type=text]").eq(1).triggerHandler("keyup");}
function checkDTime(s){var arid=s.id.split("_");var id=arid[1]||"";if(id==""&&s.id.indexOf("Other")!=-1){id=s.id.replace(/OtherOOD|Other/,"");}
if(id==""){return;}
timeOod="";var flg=$(s).parents("#divOOD").length;if(flg){timeOod="_ood";}else{}
var o=gebi("curtimes"+timeOod+id);var p=gebi("curdates"+timeOod+id);if((s.checked==true)){if($.trim(o.value)==""){o.onclick();}
if($.trim(p.value)==""){p.value=$.datepicker.formatDate('mm-dd-yy',new Date());}}}
function chkDOther(s){var x=s.id.replace(/other_desc/,"curtimes");if($("#"+x).val()==""){$("#"+x).triggerHandler("click");}
var y=x.replace(/curtimes/,"curdates");if($("#"+y).val()==""){$("#"+y).val($.datepicker.formatDate('mm-dd-yy',new Date()));}}
function addDilation(){var len=$("#conDilation").attr("data-DilateLen");var curId=parseInt(len)+1;$("#conDilation").attr("data-DilateLen",curId);var str_dilate="";var td_c=1;var tr_lm=tr_lm_gl[1];for(var x in arr_db_dilate){if(td_c==1){str_dilate+="<tr>";}
var tvl=arr_db_dilate[x];var tvl_dis=tvl;if(tvl_dis.length>od_nm_ln){tvl_dis=tvl_dis.substr(0,od_nm_ln-2)+"..";}
var tnm=mk_var_nm(tvl,"dltn");str_dilate+="<td>";str_dilate+="<input name=\""+tnm+"[]\" type=\"checkbox\" id=\""+tnm+"_"+curId+"\" value=\""+curId+"\" "+" onClick=\"checkDTime(this)\" >"+"<label for=\""+tnm+"_"+curId+"\" title=\""+tvl+"\">"+tvl_dis+"</label> ";str_dilate+="</td>";td_c++;if(td_c>tr_lm){str_dilate+="</tr>";td_c=1;}}
if(str_dilate!=""){str_dilate="<div class=\"dv_opthdrop col-lg-8 anelist\"><table class=\"table-responsive\">"+str_dilate+"</table></div>";}
var imgDilation="<span class=\"btnDelIop glyphicon glyphicon-remove-sign\" onClick=\"delDilation("+curId+")\" ></span>";var str=""+"<div id=\"tr_dilate_"+curId+"\" class=\"row\" >"+str_dilate+"<div class=\"dv_opthdrop_time col-lg-4\">  "+"<div class=\"othbox\"> <ul>"+"<li class=\"form-inline\"><input type=\"text\" name=\"other_desc[]\" id=\"other_desc"+curId+"\" value=\"\" onchange=\"chkDOther(this)\" class=\"form-control\" placeholder=\"Other\"> "+"<input type=\"text\" name=\"curdates[]\" id=\"curdates"+curId+"\" "+"  value=\"\" class=\"form-control date-pick\" placeholder=\"Date\" size=\"10\"> "+"<input type=\"text\" name=\"curtimes[]\" id=\"curtimes"+curId+"\" "+"  value=\"\" onClick=\"this.value=currenttime();\" class=\"form-control\" placeholder=\"Time\" size=\"6\"></li> "+"<li class=\"ousml\"><input type=\"radio\" name=\"dileye"+curId+"\" value=\"OU\"  id=\"dileye_ou"+curId+"\" checked /><label for=\"dileye_ou"+curId+"\"></label></li>"+"<li class=\"odsml\"><input type=\"radio\" name=\"dileye"+curId+"\" value=\"OD\"  id=\"dileye_od"+curId+"\" /><label for=\"dileye_od"+curId+"\"></label></li>"+"<li class=\"ossml\"><input type=\"radio\" name=\"dileye"+curId+"\" value=\"OS\" id=\"dileye_os"+curId+"\" /><label for=\"dileye_os"+curId+"\"></label></li>"+"<li >"+imgDilation+"</li>"+"</ul></div>"+"</div>"+"</div>";$("#conDilation").append(str);$("#divDilation :input[type=text]").eq(1).triggerHandler("keyup");$(".date-pick").datepicker({dateFormat:top.z_js_dt_frmt});oneEye_check();}
function delDilation(id){$("#conDilation #tr_dilate_"+id).remove();$("#divDilation :input[type=text]").eq(1).triggerHandler("keyup");}
function setNoDilation(flgload){var obj=$("#divDilation input[name=elem_noDilation]");if(obj.prop("checked")){$("#divDilation input[name=elem_revEyes]:eq(1)").prop("checked",true);}else{if(typeof(flgload)=="undefined"){$("#divDilation input").prop("disabled",false);}}}
function change_col(obj,textArea,theObj){if(obj.checked==true){$("#"+theObj).addClass('text-danger');$("#"+textArea).removeClass('hidden');}else{$("#"+theObj).removeClass('text-danger');$("#"+textArea).addClass('hidden');}}
function setDrawingCD(obj){if(obj.name=="elem_cdValOd"){document.getElementById("hidCDRationOD").value=obj.value}
else if(obj.name=="elem_cdValOs"){document.getElementById("hidCDRationOS").value=obj.value}}
function show_emergency_notes(flg){if(typeof(flg)=="undefined"){var flg=""+$("#div_emergency_status").css("display")=="block"?false:true;}
$("#div_emergency_status").modal({backdrop:false,show:flg});if($("#div_emergency_status :checked[type=checkbox]").length>0){$("#btn_emrg").removeClass("btn-default").addClass("btn-danger");}else{$("#btn_emrg").removeClass("btn-danger").addClass("btn-default");}}
function chkEmerAbsPrt(obj){if(obj.type=="checkbox"){if(obj.checked){if(obj.name!="elem_emerstt_comm_p2p_nodone"&&$("#div_emergency_status :checked[name=elem_emerstt_comm_p2p_nodone]").length<=0){$("#div_emergency_status input[name=elem_emerstt_comm_p2p_nodone]").prop("checked",true).triggerHandler("click");}}else{if(obj.name=="elem_emerstt_comm_p2p_nodone"){$("#div_emergency_status :checked[name!=elem_emerstt_comm_p2p_nodone]").each(function(){$(this).prop("checked",false).triggerHandler("click");});$("#div_emergency_status :input[name=elem_emerstt_lvlSeverityRetFind]").each(function(){$(this).val("").triggerHandler("change");});}}}
else if(obj.type=="select-one"){if(obj.value!=""&&$("#div_emergency_status :checked[name=elem_emerstt_comm_p2p_nodone]").length<=0){$("#div_emergency_status input[name=elem_emerstt_comm_p2p_nodone]").prop("checked",true).triggerHandler("click");}else{}}}
function set_exm_ext_arrow(){$(".fnd_exm_ext").each(function(){var cs=$(this).attr("class");var grp_cs=""+cs.replace(/fnd_exm_ext/g,"").trim();if(typeof(grp_cs)!="undefined"&&grp_cs!=""){var wo_cs=grp_cs.replace(/grp_/g,"");var op=$(this).prev();var flgopn=0;var ylw_css="exmhlgcol";if(!op.hasClass("exmhlgcol")){var c=0;do{flgstop=false;var td=op.find("td:nth-child(1)");var txt_nm=$.trim(""+td.html());if(typeof(txt_nm)=="undefined"||txt_nm==""){op=op.prev();flgstop=true;}
c++;if(c>=10){flgstop=false;}}while(flgstop);$("tr."+grp_cs+" :input").each(function(){if($(this).attr("type")=="checkbox"){if($(this).prop("checked")==true){flgopn=1;return false;}}else{if($(this).val()!=""){flgopn=1;return false;}}});op.addClass(" exmhlgcol grp_handle "+cs);var td=op.find("td:nth-child(1)");var txt_nm=""+td.html();var gm=(flgopn>0)?"glyphicon-menu-up":"glyphicon-menu-down";var h="<label >"+txt_nm+" <span class=\"glyphicon "+gm+"\"></span></label> ";td.html(h).addClass("grpbtn_ee").bind("click",function(){openSubGrp(wo_cs);});op.find(".bilat").next().html(h).addClass("grpbtn_ee").bind("click",function(){openSubGrp(wo_cs);});}else{if(op.hasClass("sbGrpOpen")||!op.hasClass(""+grp_cs)){ylw_css+=" sbGrpOpen ";}}
$(this).addClass(ylw_css);if(flgopn>0){$("tr."+grp_cs).addClass("sbGrpOpen");}}});}
function setPrevValues(){window.location.replace(window.location.href+"&prevVal=1");}
function b4_save_processing(){freezeElemAll(0);if(examName!="Pupil"&&examName!="Refractive Surgery"){saveCanvas();}}
function after_save_processing(d,dncls){try{if(window.opener&&typeof window.opener.AfterSave!='undefined'){window.opener.AfterSave(d);}}catch(e){}
if(typeof(dncls)!="undefined"&&dncls!=""){if(dncls=="IOPGRPH"){IOP_showGraphsAm(1);}}else{window.self.close();}}
function save_exam(dncls){if(examName=="Gonio"){var flgEr=0;$("#divIopElem .iophght .head").each(function(){if($(this).find(":checked").length>0&&$(this).find(":checked").hasClass("greyAll_v2")==false&&$.trim($(this).find(".iop_method").val())==""){if($(this).parent().find(".pd10 input[type=text]").filter(function(){return $.trim(this.value)!="";}).length){flgEr=1;$(this).find(".iop_method").focus();return false;}}});if(flgEr==1){top.fAlert("Please enter method in IOP!");return;}}
b4_save_processing();if(typeof(setProcessImg)!='undefined')setProcessImg("1");var strsave=$("form").serialize();strsave+="&savedby=ajax";$.post(zPath+"/chart_notes/saveCharts.php",strsave,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0");after_save_processing(data,dncls);},'json');}
function cancel_exam(){window.self.close();}
function reset_exam(){funReset_exam();}
function previous_exam(){setPrevValues();}
function purg_exam(){var m=confirm("Do you want to purge this exam? You can not undo it.");if(m){if(examName=="Gonio"){var wcid=getWcId();if(wcid.nm=="IOP"){$(":hidden[name=elem_purged_IOP]").val("1");}else{$(":hidden[name=elem_purged]").val("1");}}else{$(":hidden[name=elem_purged]").val("1");}
save_exam();}}
function docu_event_handler(e){var chk=e.target.nodeName;var eType=e.type;if($(e.target).parents(".div_idoc_drw").length>0){return;}
if(chk=="INPUT"||chk=="TEXTAREA"||((eType=="change"||eType=="keyup"||eType=="mousedown")&&chk=="SELECT")){var enm=e.target.name;var eid=e.target.id;if(e.target.type=="button"||e.target.type=="submit")return;checkNC1(e.target);utElem_capture(e);}else if(chk=="LABEL"){if((finalize_flag!="1"||isReviewable=="1")&&elem_per_vo!="1"){var disele=$(e.target).attr("for");var chkkx=$("#"+disele).prop("disabled");var chkky=$("#"+disele).attr("type");if(typeof(chkkx)!="undefined"&&chkkx==true&&typeof(chkky)!="undefined"&&chkky=="checkbox"){checkNC1($("#"+disele).get(0));utElem_capture($("#"+disele).get(0));}}}}
$(document).ready(function(){if(window.opener&&typeof(window.opener.top.keyCatcher)!="undefined"){document.onkeydown=window.opener.top.keyCatcher;}
if(examName=="Procedures"){}
else if(examName=="DrawPane"||examName=="DrawCL"){var hid_drw_id="hidDrawPaneDrawingId",dv_con="divMaster",exm_id="0",exm_nm="DRAWPANE_DSU";if(examName=="DrawCL"){hid_drw_id="hidDrawCLDrawingId";exm_nm="CL_DRAW_DSU";}
AJAXLoadDarwingData_exe(hid_drw_id,dv_con,exm_id,exm_nm);$("#img_load, #dvloading").hide().html("Processing..");}else{if(examName=="Refractive Surgery"){if(myflag=="1"&&finalize_flag!="1"){if($("input[name=elem_sphericalEqOd][value!='']").length>0){calcRSB('d');}
if($("input[name=elem_sphericalEqOs][value!='']").length>0){calcRSB('s');}}
setRefSxMode();$("#imgAblat,#imgNomo").draggable();$("#btnNomo").click(function(){$("#imgNomo").toggle();});$("#btnAblat").click(function(){$("#imgAblat").toggle();});}
$("body").bind("click keyup change mousedown",function(e){docu_event_handler(e)});utElem_setBgColor();if(examName=="EOM"){wv_activate_menu_click();ei_attachIndicator_eom();}else if(examName=="Gonio"){trgat();ev_attachIndicator_iop();setNoDilation(1);$("#elem_cor_date, .date-pick").datepicker({dateFormat:top.z_js_dt_frmt});cn_ta_clr_npsych("#divIopElem .iop_method");cn_ta_clr_npsych("#divIopElem textarea[name*=elem_descTa]");}else{newET_setGray_v3();}
if(finalize_flag=="1"){if(isReviewable==1){setReviewableFunction();}else{setfinalizedFunction();}}
if(examName=="Pupil"){chk_Perrla(-1);}
if(examName=="EOM"){if($("#elem_ncEom").val()=="1"){$("#elem_noChange")[0].onclick();}
setExamFlag();setTabFlags();}else{setNC(1);checkwnls();}
if(typeof(def_pg)!="undefined"&&def_pg!=""){if((examName!="LA"&&examName!="SLE"&&examName!="Fundus"&&examName!="Gonio")||def_pg=="draw"||def_pg=="Drawing"||def_pg=="drawrvon"||def_pg=="drawrvma"){openExmTab(def_pg);}}
if(examName=="SLE"){$("#elem_mfocalOd_pciol, #elem_mfocalOs_pciol").bind("click",function(){if(this.checked){$("#"+this.id+"_opts").show();}else{$("#"+this.id+"_opts").val("").hide();}});cn_ta_clr_npsych();}
cn_typeahead();if(examName=="LA"){$(".dacry input[type=text], .lacsci input[type=text], .ctmri input[type=text], .schirmer  input[type=text]").datepicker({dateFormat:"mm-dd-yy"});$(".divLesionModifier").draggable({handle:".examhd"});}
if(examName=="LA"||examName=="SLE"||examName=="Fundus"){set_exm_ext_arrow();}
$("input[type=submit][id=save],input[type=button][id=save],input[type=button][id=btnReset],input[type=button][id=btnPrev],input[type=button][id=btnPurg],input[type=button][id=btnRecal]").show();$('[data-toggle="tooltip"]').tooltip();$("#img_load, #dvloading").hide();}});
var oneEye_issue=oneEye_eye="";function oneEye_isSet(flagPu){var arrRet=null;if(flagPu==2){var oprph=$("#phth_pros");var oeye=$("#is_od_os");if(oprph.length>0&&oprph.val()!=""&&oeye.length>0&&oeye.val()!=""){issue=""+oprph.val();eye=""+oeye.val();arrRet={"issue":issue,"eye":eye};}}else{if(flagPu==1){if(window.opener){var tmp_iss=window.opener.$("#phth_pros").val();var tmp_eye=window.opener.$("#is_od_os").val();}}else{var tmp_iss=$("#phth_pros").val();var tmp_eye=$("#is_od_os").val();}
arrRet={"issue":tmp_iss,"eye":tmp_eye};}
return arrRet;}
function oneEye_disable(i){var elOu=",:input[id*='aneseye_ou'][type='radio'],:input[id*='dileye_ou'][type='radio'],:input[id*='oodeye_ou'][type='radio']";if(i=="OD"){idChk=":input[name*='od_'][type='checkbox'],:input[name*='od_'][type='radio']";idChk+=",:input[name*='Od'][type='radio'],:input[name*='Od'][type='checkbox']";idChk+=",:input[name*='_od'][type='checkbox'],:input[name*='_od'][type='radio'],:input[id*='_od'][type='radio']";idChk+=elOu;idElm=":input[name*='Od'][type!='checkbox'][type!='radio']";idElm+=",:input[name*='_od'][type!='checkbox'][type!='radio']";idElm+=",:input[name*='od_'][type!='checkbox'][type!='radio']";$(idChk).attr("disabled","disabled").removeAttr("checked");$(idElm).attr("disabled","disabled").val("");}else if(i=="OS"){idChk=":input[name*='os_'][type='checkbox'],:input[name*='os_'][type='radio']";idChk+=",:input[name*='_os'][type='checkbox'],:input[name*='_os'][type='radio']";idChk+=",:input[name*='Os'][type='radio'],:input[name*='Os'][type='checkbox'],:input[id*='_os'][type='radio']";idChk+=elOu;idElm=":input[name*='Os'][type!='checkbox'][type!='radio']";idElm+=",:input[name*='os_'][type!='checkbox'][type!='radio']";idElm+=",:input[name*='_os'][type!='checkbox'][type!='radio']";$(idChk).attr("disabled","disabled").removeAttr("checked");$(idElm).attr("disabled","disabled").val("");}}
function oneEye_display(wid,wtxt){wtxt=(typeof wtxt!="undefined")?""+wtxt:"";$("#"+wid).html(""+wtxt);}
function oneEye_setCN(flgTdClr){var oe_issue=$("#phth_pros");var oe_eye=$("#is_od_os");if(!oe_issue.length||!oe_eye.length){return;}
flgTdClr=(typeof flgTdClr=="undefined")?"1":flgTdClr;var strchartsumm_OD=new Array("#pupil_ref","#lidRefOd","#lesionRefOd","#lidPositionRefOd","#lacrimalRefOd","#iop_OD","#iopRefOd","#conjuctOd","#slecorneaOd","#antChamberOd","#sleIrsiOd","#sleLensOd","#vitreous_od","#macula_od","#periphery_od","#vessels_od","#opticNerve_od","#external_od","#cd_od");var strchartsumm_OS=new Array("#pupil_refOs","#lidRefOs","#lesionRefOs","#lidPositionRefOs","#lacrimalRefOs","#iop_OS","#iopRefOs","#conjuctOs","#slecorneaOs","#antChamberOs","#sleIrsiOs","#sleLensOs","#vitreous_os","#macula_os","#periphery_os","#vessels_os","#opticNerve_os","#external_os","#cd_os");var arrSe=new Array("","1","2","3","4","","Iop","1","2","3","4","5","1","2","3","4","6","","6");for(var i=0;i<19;i++){var tmpOd=$(strchartsumm_OD[i]);var tmpOs=$(strchartsumm_OS[i]);var tmpOdi=$(strchartsumm_OD[i]+i);var tmpOsi=$(strchartsumm_OS[i]+i);var tmpOdV=(tmpOdi.length!=0&&tmpOdi.val()!="")?tmpOdi.val():"&nbsp;";var tmpOsV=(tmpOsi.length!=0&&tmpOsi.val()!="")?tmpOsi.val():"&nbsp;";var tmp="";if(oe_issue.val()==""||oe_eye.val()==""){tmpOd.html(tmpOdV);tmpOs.html(tmpOsV);}else{if(oe_eye.val()=="OU"){tmpOd.html(tmpOdV);tmpOs.html(tmpOsV);}else if(oe_eye.val()=="OD"){tmpOd.html(tmpOdV);tmpOs.html(tmpOsV);}else if(oe_eye.val()=="OS"){tmpOd.html(tmpOdV);tmpOs.html(tmpOsV);}}
var flgOd=false;var flgOs=false;if(i==0){var vSe=$("#elem_se_Pupil").val();}else if(i>=1&&i<=4){var vSe=$("#elem_se_La").val();}else if(i==6){var vSe=$("#elem_se_Gonio").val();}else if(i>=7&&i<=11){var vSe=$("#elem_se_Sle").val();}else if(i>=12&&i<=15){var vSe=$("#elem_se_Rv").val();}else if(i==16||i==18){var vSe=$("#elem_se_Optic").val();}else if(i==17){var vSe=$("#elem_se_Ee").val();}
if(i!=5){if(vSe==""||vSe.indexOf(arrSe[i]+"_Od=0")!=-1){flgOd=true;}
if(vSe==""||vSe.indexOf(arrSe[i]+"_Os=0")!=-1){flgOs=true;}}
if(tmpOd.html()==""||tmpOd.html()=="&nbsp;"||flgOd==true){tmpOd.parent().addClass("bgSmoke");}else{tmpOd.parent().removeClass("bgSmoke");}
if(tmpOs.html()==""||tmpOs.html()=="&nbsp;"||flgOs==true){tmpOs.parent().addClass("bgSmoke");}else{tmpOs.parent().removeClass("bgSmoke");}}
var strFRSumm=$("#tr_fr_pupil,#tr_fr_ee,#tr_fr_la,#tr_fr_iop,#tr_fr_sle,#tr_fr_rv");if((oe_issue.val()!="")&&(oe_eye.val()!="")){strFRSumm.each(function(){if(oe_issue.val()=="Poor View"&&this.id!="tr_fr_sle"&&this.id!="tr_fr_rv"){$(this).hide();return;}
$(this).show();var tds=$(this).children();if(oe_eye.val()=="OU"){tds.eq(1).children().html(""+oe_issue.val()).addClass("css_oneEyeDesc");tds.eq(2).children().html(""+oe_issue.val()).addClass("css_oneEyeDesc");if(flgTdClr==1){tds.eq(1).addClass("bgWhite").removeClass("bgSmoke");tds.eq(2).addClass("bgWhite").removeClass("bgSmoke");}}else if(oe_eye.val()=="OD"){tds.eq(1).children().html(""+oe_issue.val()).addClass("css_oneEyeDesc");tds.eq(2).children().html("&nbsp;").removeClass("css_oneEyeDesc");if(flgTdClr==1){tds.eq(2).removeClass("bgWhite").addClass("bgSmoke");tds.eq(1).addClass("bgWhite").removeClass("bgSmoke");}}else if(oe_eye.val()=="OS"){tds.eq(1).children().html("&nbsp;").removeClass("css_oneEyeDesc");tds.eq(2).children().html(""+oe_issue.val()).addClass("css_oneEyeDesc");if(flgTdClr==1){tds.eq(1).removeClass("bgWhite").addClass("bgSmoke");tds.eq(2).addClass("bgWhite").removeClass("bgSmoke");}}});}else{strFRSumm.hide();}
var oVisElemsOd=$("#divVision :input[type!=hidden][name*=Od]");var oVisElemsOs=$("#divVision :input[type!=hidden][name*=Os]");oVisElemsOd.removeAttr("disabled");oVisElemsOs.removeAttr("disabled");var oVisElemsOd=$("#divVision :input[type!=hidden][name*=Od][name*=Txt],#divVision :input[type!=hidden][name*=Od][name*=OverrefV]");var oVisElemsOs=$("#divVision :input[type!=hidden][name*=Os][name*=Txt],#divVision :input[type!=hidden][name*=Os][name*=OverrefV]");oVisElemsOd.val(function(index,value){return(value!="")?this.value:"20/";});oVisElemsOs.val(function(index,value){return(value!="")?this.value:"20/";});}
function oneEye_check(){var oChk=oneEye_isSet(1);if(oChk&&(oChk.issue!="")&&(oChk.issue=="Phthisis"||oChk.issue=="Prosthesis")){wTxt=""+oChk.issue;oneEye_issue=""+oChk.issue;oneEye_eye=""+oChk.eye;oneEye_disable(oChk.eye);}}
function oneEye_isOpAllwd(eye){var ret=true;var iss="";if(typeof(eye)!="undefined"&&eye!=""){var oChk_oe=oneEye_isSet();var ignore_i="";if((oChk_oe!=null)&&(oChk_oe.issue!="")&&(oChk_oe.issue=="Phthisis"||oChk_oe.issue=="Prosthesis")){iss=oChk_oe.issue;ignore_i=oChk_oe.eye;if(ignore_i!=""){if(eye==ignore_i||ignore_i=="OU"){ret=false;}else{if(eye=="OU"){if(ignore_i=="OD"){eye="OS";}
else if(ignore_i=="OS"){eye="OD";}}}}}}
return{alwd:ret,eye:eye,iss:iss};}
function oneEye_checkinexam(){var ret=true;var oChk_oe=oneEye_isSet(1);if((oChk_oe!=null)&&(oChk_oe.issue!="")&&(oChk_oe.issue=="Phthisis"||oChk_oe.issue=="Prosthesis")){ignore_i=oChk_oe.eye;if(ignore_i=="OU"){ret=false;}}
return ret;}
function newET_setGray(ptrn){if(typeof ptrn!="undefined"&&ptrn!=""){$(""+ptrn).addClass("greyAll_v2").bind("click change",function(){var nm=$(this).attr('name');if(nm.indexOf("Od")!=-1){$(""+ptrn+"[name*='Od']").removeClass("greyAll_v2");}else{$(""+ptrn+"[name*='Os']").removeClass("greyAll_v2");}});}}
function newET_setGray_v2(arr,ptrnin){var ptrn="";if(typeof ptrnin!="undefined"){ptrn=""+ptrnin;}else{var len=arr.length;for(var i=0;i<len;i++){if(arr[i]!=""){if(newET_chkB4GrayExe(""+arr[i],"od")){if(ptrn!=""){ptrn+=",";}
ptrn+="#"+arr[i]+" :input[name*='Od_'],"+"#"+arr[i]+" :input[name*='_od'],"+"#"+arr[i]+" :input[name*='Od'],"+"#"+arr[i]+" :input[name*='od_']";}
if(newET_chkB4GrayExe(""+arr[i],"os")){if(ptrn!=""){ptrn+=",";}
ptrn+="#"+arr[i]+" :input[name*='Os_'],"+"#"+arr[i]+" :input[name*='_os'],"+"#"+arr[i]+" :input[name*='Os'],"+"#"+arr[i]+" :input[name*='os_']";}}}}
if(typeof ptrn!="undefined"&&ptrn!=""){var should_not_grey="input[type='button'],:input[name*=sc_elem], button, #elem_noChange, #elem_pharmadilated, #elem_pharmadilated_eye";$(""+ptrn).not(should_not_grey).addClass("greyAll_v2").bind("click change keyup",function(e){if(e&&e.type=="click"&&typeof(e.srcElement)!="undefined"&&e.srcElement.type=="select-one")return;var nm=$(this).attr('name');if(typeof(nm)=="undefined"||nm==""){return;}
if($(this).parents("div.tab-pane").length>0){var idDiv=$(this).parents("div.tab-pane").attr("id");if($("#"+idDiv).parents("div.tab-pane").length>0){idDiv=$("#"+idDiv).parents("div.tab-pane").attr("id");}}else if($(this).parents("div.subExam").length>0){var idDiv=$(this).parents("div.subExam").attr("id");}else{}
var eye="";$(this).removeClass("greyAll_v2");if(nm.toLowerCase().indexOf("od_")!=-1||nm.toLowerCase().indexOf("_od")!=-1){eye="od";}else if(nm.toLowerCase().indexOf("os_")!=-1||nm.toLowerCase().indexOf("_os")!=-1){eye="os";}else if(nm.toLowerCase().indexOf("od")!=-1){eye="od";}else if(nm.toLowerCase().indexOf("os")!=-1){eye="os";}
var is_sc_con_det="";if($(this).parents("#div_sc_con_detail").length>0){is_sc_con_det="#div_sc_con_detail";};if(newET_chkB4GrayExe(idDiv,eye,is_sc_con_det)){newET_setGray_Exe(idDiv,eye,is_sc_con_det);}});}}
function newET_chkB4GrayExe(divId,eye,flgscdet){if(typeof(flgscdet)=="undefined"||flgscdet==""){flgscdet="";}else{flgscdet=flgscdet+" ";}
var ret=true;if(eye=="od"){if($(flgscdet+"#elem_chng_"+divId+"_Od").val()=="1"){ret=false;}}else if(eye=="os"){if($(flgscdet+"#elem_chng_"+divId+"_Os").val()=="1"){ret=false;}}else if(eye=="ou"){if($(flgscdet+"#elem_chng_"+divId+"_Od").val()=="1"&&$(flgscdet+"#elem_chng_"+divId+"_Os").val()=="1"){ret=false;}}
return ret;}
function newET_setGray_Exe(divId,eye,flgscdet){if(typeof(flgscdet)=="undefined"||flgscdet==""){flgscdet="";}else{flgscdet=flgscdet+" ";}
var ptrn_2=flgscdet+"#"+divId+" :input";if(eye.toLowerCase().indexOf("od")!=-1||eye.toLowerCase().indexOf("ou")!=-1){var str=""+ptrn_2+"[name*='Od_'], "+""+ptrn_2+"[name*='_od'], "+""+ptrn_2+"[name*='Od'], "+""+ptrn_2+"[name*='od_'] ";$(""+str).removeClass("greyAll_v2");$(flgscdet+"#elem_chng_"+divId+"_Od").val("1");}
if(eye.toLowerCase().indexOf("os")!=-1||eye.toLowerCase().indexOf("ou")!=-1){var str=""+ptrn_2+"[name*='Os_'], "+""+ptrn_2+"[name*='_os'], "+""+ptrn_2+"[name*='Os'], "+""+ptrn_2+"[name*='os_'] ";$(""+str).removeClass("greyAll_v2");$(flgscdet+"#elem_chng_"+divId+"_Os").val("1");}}
function newET_setIndicators_Exe(divId,eye,val){if(eye.toLowerCase().indexOf("od")!=-1||eye.toLowerCase().indexOf("ou")!=-1){$("#elem_chng_"+divId+"_Od").val(""+val);}
if(eye.toLowerCase().indexOf("os")!=-1||eye.toLowerCase().indexOf("ou")!=-1){$("#elem_chng_"+divId+"_Os").val(""+val);}}
function newET_emptyGray(arr){var str="";var len=arr.length;for(var i=0;i<len;i++){if(str!=""){str+=", ";}
str+="#"+arr[i]+" .greyAll_v2";}
if(str!=""){$(""+str).each(function(){if($(this).is(":checkbox")){if($(this).attr('checked')){$(this).attr('checked',false);}}else{$(this).val('');}});}}
function newET_b4Done(){var obj=docNoChange();if(obj.divNC0.length>0){}}
function newET_bindEvDone(){$(":input[type='submit'][value='Done']").bind("click",function(){newET_b4Done();});}
function newET_drawingChanged(){var oDiv=getWcId("draw");var eye="ou";if(newET_chkB4GrayExe(oDiv.div,eye)){newET_setGray_Exe(oDiv.div,eye);}
if(typeof(examName)!="undefined"&&examName=="Gonio"){$("#divIop3 textarea").triggerHandler("keyup");}}
function newET_setGray_v3(flgfpu){var strPtrnGray="",parentid="",exmid="",srchin="";var ar_parentid=[],ar_exmid=[];if(typeof(examName)=="undefined"){examName="";}
if(typeof(flgfpu)!=""&&flgfpu==1||examName==""){ar_parentid=["#div_sc_con_detail"];var tmp=$(ar_parentid[0]+" div.subExam").attr("id");ar_exmid=[tmp];}else if(examName=="LA"||examName=="SLE"||examName=="Fundus"||examName=="Refractive Surgery"){strPtrnGray=$("#el_strPtrnGray").val();}else if(examName=="Pupil"){ar_parentid=["#divPupil"];ar_exmid=["divPupil"];}else if(examName=="External"){ar_parentid=["#divCon","#divDraw"];ar_exmid=["divCon","divDraw"];}
var ln=ar_parentid.length;for(var i=0;i<ln;i++){parentid=ar_parentid[i];exmid=ar_exmid[i];srchin=(parentid=="#div_sc_con_detail")?parentid+" ":"";var od=$(srchin+"#elem_chng_"+exmid+"_Od").val(),os=$(srchin+"#elem_chng_"+exmid+"_Os").val();if((od==""||od=="0")&&(os==""||os=="0")){strPtrnGray+=parentid+" :input,";}else{if((od==""||od=="0")){strPtrnGray+=parentid+" :input[name*='Od_'],"+parentid+" :input[name*='Od'],";}else if((os==""||os=="0")){strPtrnGray+=parentid+" :input[name*='Os_'],"+parentid+" :input[name*='Os'],";}}}
if(strPtrnGray!=""){strPtrnGray=strPtrnGray.replace(/,\s*$/,'');newET_setGray_v2("",""+strPtrnGray+"");}}
function showProcedure(id){var qry=(id!="")?"&chart_proc_id="+id:"";window.location.replace(zPath+"/chart_notes/onload_wv.php?elem_action=Procedures"+qry);}
function proc_showTabs(id){$("#elem_btnFinAmdmnt, #elem_btnDoneAmdmnt").addClass("hidden");if(id=="procnote"){getConsentForm();$("#elem_btnPrint").show();}else if(id=="amendment"){$("#elem_btnFinAmdmnt, #elem_btnDoneAmdmnt").removeClass("hidden");$("#elem_btnPrint").show();}else if(id=="consent_form"){getConsentForm();$("#elem_btnPrint").hide();var cfi=$("#curConfrmId").val();var fii=$("#proc_con_frm_id").val();if(typeof(cfi)!="undefined"&&typeof(fii)!="undefined"&&cfi!=""&&fii!=""&&cfi!="0"&&fii!="0"){$("#elem_btnPrint").show();}}else if(id=="op_report"){loadOpTemp();getConsentForm();$("#elem_btnPrint").hide();var pri=$("#proc_pn_rep_Id").val();if(typeof(pri)!="undefined"&&pri!=""&&pri!="0"){$("#elem_btnPrint").show();}}else{$("#elem_btnPrint").show();}}
function loadOpTemp(){var idProc=$(":input[name=elem_chart_procedures_id]").val();var s=$(":input[name=elem_OpTempId]").val();if(s=="0"){s="";}
var curOpId=$("#curOpId").val();var pd=$('#elem_pnData').redactor('code.get');if((s!=""&&curOpId!=s)||(curOpId!=""&&s!=""&&pd=="")){$("#curOpId").val(s);var e=$(":checked[name=elem_site]").val();if(typeof(e)=="undefined")e="";var selText='';selText=""+fun_mselect('#elem_dxCode','val');var spotDuration=$("#spot_duration").val();var spotSize=$("#spot_size").val();var power=$("#power").val();var shots=$("#shots").val();var total_energy=$("#total_energy").val();var degree_of_opening=$("#degree_of_opening").val();var exposure=$("#exposure").val();var count=$("#count").val();var url=zPath+"/chart_notes/onload_wv.php?elem_action=Procedures";$.get(url+"&elem_opNoteId="+s+"&elem_opNoteEye="+e+"&chart_procedures_id="+idProc+"&elem_opNotedxCode="+selText+"&elem_spotDuration="+spotDuration+"&elem_spotSize="+spotSize+"&elem_power="+power+"&elem_shots="+shots+"&elem_total_energy="+total_energy+"&elem_degree_of_opening="+degree_of_opening+"&elem_exposure="+exposure+"&elem_count="+count,function(data){if(data!=""){$('#elem_pnData').redactor('code.set',''+data);}});}}
function getConsentForm(flgtemp){var idProc=$(":input[name=elem_chart_procedures_id]").val();var s=$(":input[name=elem_consentForm]").val();var curConfrmId=$("#curConfrmId").val();var a=$("#consent_form  iframe").attr("src");var chartId=$("#elem_form_id").val();var site='';if($("#elem_site_ou").is(":checked")||$("#elem_site_od").is(":checked")||$("#elem_site_os").is(":checked")){document.getElementById('consent_form').src=document.getElementById('consent_form').src;if($("#elem_site_ou").is(":checked")){site='both eyes';}else if($("#elem_site_od").is(":checked")){site='right eye';}else if($("#elem_site_os").is(":checked")){site='left eye';}}
if((s!=""&&curConfrmId!=s)||(s!=""&&typeof(a)=="undefined")){$("#curConfrmId").val(s);var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;var hgt=parseInt($("#iframeConsentForm").css("height"));$("#consent_form  iframe").attr("src",u+"/patient_info/consent_forms/consentFormDetails.php?consent_form_id="+s+"&pop_procedure=1&chart_procedures_id="+idProc+"&pophgt="+hgt+"&site="+site+"&chartId="+chartId+"");}}
function set_lot_val(arr_lot_no,lot_obj_name,obj_item_id){if(typeof(arr_lot_no[obj_item_id])!='undefined'){var str_lot=arr_lot_no[obj_item_id];var str_split_arr="";if(str_lot.indexOf(",")>0){str_split_arr=str_lot.split(",");}else{$("input:text[name="+lot_obj_name+"]").val(str_lot);str_split_arr=str_lot.split(",");}}}
function set_value_qty_texts(arr_med_name,arr_item_no_qty,arr_thrash,arr_lot_no){$("#divPreOpMeds input[type='text']").each(function(){var curr_obj_ctr=this.name.substr(-1);$("input:text[name=elem_med_preop_lot_qty"+curr_obj_ctr+"]").val("");var medi_name=$.trim($("input:text[name=elem_PreOpMed"+curr_obj_ctr+"]").val());var opt_med_id=arr_med_name[medi_name];if(typeof(arr_item_no_qty[opt_med_id])!='undefined'){$("input:text[name=elem_med_preop_lot_qty"+curr_obj_ctr+"]").val(arr_item_no_qty[opt_med_id]);}
if(typeof(arr_lot_no)!='undefined'&&typeof(opt_med_id)!='undefined'){set_lot_val(arr_lot_no,"elem_PreOpMedLot"+curr_obj_ctr,opt_med_id);}});$("#divIntraVitrealMeds input[type='text']").each(function(){var curr_obj_ctr=this.name.substr(-1);var inter_medi_name=$.trim($("input:text[name=elem_IntraVitrealMeds"+curr_obj_ctr+"]").val());var opt_inter_med_id=arr_med_name[inter_medi_name];$("input:text[name=elem_med_intravitreal_lot_qty"+curr_obj_ctr+"]").val("");if(typeof(arr_item_no_qty[opt_inter_med_id])!='undefined'){$("input:text[name=elem_med_intravitreal_lot_qty"+curr_obj_ctr+"]").val(arr_item_no_qty[opt_inter_med_id]);}
if(typeof(arr_lot_no)!='undefined'&&typeof(opt_inter_med_id)!='undefined'){set_lot_val(arr_lot_no,"elem_IntraVitrealMedsLot"+curr_obj_ctr,opt_inter_med_id);}});$("#divPostOpMeds input[type='text']").each(function(){var lot_no=this.value;var curr_obj_ctr=this.name.substr(-1);$("input:text[name=elem_med_postop_lot_qty"+curr_obj_ctr+"]").val("");var post_medi_name=$.trim($("input:text[name=elem_PostOpMeds"+curr_obj_ctr+"]").val());var opt_post_med_id=arr_med_name[post_medi_name];if(typeof(arr_item_no_qty[opt_post_med_id])!='undefined'){$("input:text[name=elem_med_postop_lot_qty"+curr_obj_ctr+"]").val(arr_item_no_qty[opt_post_med_id]);}
if(typeof(arr_lot_no)!='undefined'&&typeof(post_medi_name)!='undefined'){set_lot_val(arr_lot_no,"elem_PostOpMedsLot"+curr_obj_ctr,opt_post_med_id);}});}
function botox_insertOldBtxVal(id){var url=zPath+"/chart_notes/onload_wv.php?elem_action=Procedures";url+="&btxid="+id;$.get(url,function(data){if(data&&data.id&&typeof(data.id)!="undefined"){if(data.btx_total&&typeof(data.btx_total)!="undefined"){$("#elem_botox_total").val(data.btx_total);}
if(data.lot&&typeof(data.lot)!="undefined"){$("#elem_botox_lot").val(data.lot);}
if(data.vis_sc_od&&typeof(data.vis_sc_od)!="undefined"){$("#elem_botox_sc_od").val(data.vis_sc_od);}
if(data.vis_cc_od&&typeof(data.vis_cc_od)!="undefined"){$("#elem_botox_cc_od").val(data.vis_cc_od);}
if(data.vis_othr_od&&typeof(data.vis_othr_od)!="undefined"){$("#elem_botox_other_od").val(data.vis_othr_od);}
if(data.vis_sc_os&&typeof(data.vis_sc_os)!="undefined"){$("#elem_botox_sc_os").val(data.vis_sc_os);}
if(data.vis_cc_os&&typeof(data.vis_cc_os)!="undefined"){$("#elem_botox_cc_os").val(data.vis_cc_os);}
if(data.vis_othr_os&&typeof(data.vis_othr_os)!="undefined"){$("#elem_botox_other_os").val(data.vis_othr_os);}
if(data.rd_injctn&&typeof(data.rd_injctn)!="undefined"){$(":input[name=elem_botox_inject_radio][value='"+data.rd_injctn+"']").prop("checked",true);}
else{$(":input[name=elem_botox_inject_radio]").prop("checked",false);}
if(data.rbdcs&&typeof(data.rbdcs)!="undefined"){$(":input[name=elem_botox_rbdcs][value='"+data.rbdcs+"']").prop("checked",true);}
else{$(":input[name=elem_botox_rbdcs]").prop("checked",false);}
if(data.drw_coords&&typeof(data.drw_coords)!="undefined"){setBottoxDrw_change(data.drw_coords);}}},'json');}
var setBottoxDrw_canvas;function setBottoxDrw_change(xjson){var ut=0;if($.trim(xjson)!=""){xjson=JSON.parse(xjson);setBottoxDrw_canvas.loadFromJSON(xjson,setBottoxDrw_canvas.renderAll.bind(setBottoxDrw_canvas),function(o,object){var t=object.getText();t=$.trim(t);if(t=="x"){}else{ut=parseFloat(ut)+parseFloat(t);}});if(isNaN(ut)){ut="";}$("#elem_botox_used").val(ut).trigger("change");$("#div_cnvs_bottox").trigger("mouseout");}}
function setBottoxDrw(){var c="div_cnvs_bottox";var ocan_all=$('#'+c+' canvas');var ocan=ocan_all[0];var canvas=this.__canvas=new fabric.Canvas(ocan,{perPixelTargetFind:true,targetFindTolerance:4});setBottoxDrw_canvas=canvas;fabric.Object.prototype.transparentCorners=false;canvas.selection=false;var calcUsed=function(){var ut=0;canvas.forEachObject(function(o){var t=o.getText();t=$.trim(t);if(t=="x"){}else{ut=parseFloat(ut)+parseFloat(t);}});if(isNaN(ut)){ut="";}$("#elem_botox_used").val(ut).trigger("change");};var addExamNmOnCanvas=function(o){var otgt=o.target;var e=o.e;var pointer=canvas.getPointer(e);var a=$(":checked[name=elem_btxds_opts]").val();var tlen=canvas.getObjects().length;if(typeof(tlen)=="undefined"){tlen=0;}
var sv=a;a="x";var uidx="ox"+tlen,uiddsg="odsg"+tlen;var fi=0;canvas.forEachObject(function(o){if(o.getFill()=="red"){var xid=o.get("unit");if(xid.indexOf("ox")!=-1){var dsgid=xid.replace("ox","odsg");canvas.forEachObject(function(o1){if(o1.get("unit")==dsgid){o1.setText(sv);}});fi=1;}}});if(fi==0){var tmp=new fabric.Citextb(a,{left:parseInt(pointer.x)-2,top:parseInt(pointer.y)-7,fontFamily:'Arial',fill:'#171717',fontSize:'14',selectable:false});canvas.add(tmp);tmp.set({unit:uidx});var tmp=new fabric.Citextb(sv,{left:parseInt(pointer.x)-2,top:parseInt(pointer.y)-7+15,fontFamily:'Arial',fill:'#171717',fontSize:'9',selectable:false});canvas.add(tmp);tmp.set({unit:uiddsg});}
calcUsed();};var delExamNmOnCanvas=function(){canvas.forEachObject(function(o){if(o.getFill()=="red"){var xid=o.get("unit");if(xid.indexOf("ox")!=-1){var dsgid=xid.replace("ox","odsg");canvas.forEachObject(function(o1){if(o1.get("unit")==dsgid){canvas.remove(o1);}});}
canvas.remove(o);}});calcUsed();};$('#'+c+" .upper-canvas").bind('contextmenu',function(e){delExamNmOnCanvas();e.preventDefault();return false;});canvas.on('mouse:over',function(e){var tx=e.target.getText();if($.trim(tx)=="x"){e.target.setFill('red');canvas.renderAll();}});canvas.on('mouse:down',function(e){addExamNmOnCanvas(e);});canvas.on('mouse:out',function(e){e.target.setFill('black');canvas.renderAll();});$("#"+c).on("mouseout",function(){$("#elem_cnvs_bottox_drw").val(ocan.toDataURL("image/png"));var s=""+JSON.stringify(canvas);$("#elem_cnvs_bottox_drw_coords").val(s);});var xjson=z_cnvs_bottox_drw_coords;if($.trim(xjson)!=""){xjson=JSON.parse(xjson);canvas.loadFromJSON(xjson,canvas.renderAll.bind(canvas),function(o,object){object.set({selectable:false});});$("#"+c).trigger("mouseout");}}
function setBottox(flgonload){var x=$("#elem_procedure option:selected").text();if(x.toLowerCase().indexOf("botox")!=-1){$("#tbl_pronote_med, #tbl_pronote_timeout, #dvcmt").hide();$("#divBottox, #divAddFields").removeClass("hidden");$("#elem_bottox_open_flg").val(1);$("#elem_lasik_open_flg").val(0);setBottoxDrw();$("#elem_botox_total,#elem_botox_used").on("change",function(){var tmp=tmp1=tmp2="";tmp1=$("#elem_botox_total").val();tmp2=$("#elem_botox_used").val();tmp=parseFloat(tmp1)-parseFloat(tmp2);if(isNaN(tmp)){tmp="";}$("#elem_botox_wasted").val(tmp);});$("#tbl_pronote_med :input[type=text], #tbl_pronote_timeout :input[type=text], #dvcmt :input[type=text]").val("");$("#tbl_pronote_timeout select").val("");$("#tbl_pronote_timeout :input[type=checkbox]").prop("checked",false);if(typeof(flgonload)=="undefined"||flgonload!=1){setBottoxVisual();}
$(":input[name^=elem_PreOpMed]").val('');$(":input[name^=elem_PostOpMeds]").val('');$(":input[name^=elem_IntraVitrealMeds]").val('');$("#dvTypeBtx").removeClass("hidden");$("#dvlids").removeClass("hidden");$("#dvPtOccu, #dvPtHobby, #div_lasik_proc").addClass("hidden");$("#elem_lot_expr_dt").datepicker({dateFormat:top.jQueryIntDateFormat});}else if(x.toLowerCase()=='lasik'){$("#tbl_pronote_med, #tbl_pronote_timeout, #dvcmt ").hide();$("#div_lasik_proc").removeClass("hidden");$("#divBottox, #divAddFields").addClass("hidden");$("#dvTypeBtx").addClass("hidden");$("#elem_lasik_open_flg").val(1);$("#div_lasik_proc :checkbox").bind("click",function(){single_chkbx(this);});$("#dvlids").addClass("hidden");$("#dvPtOccu, #dvPtHobby").removeClass("hidden");$(":input[name^=elem_PreOpMed]").val('');$(":input[name^=elem_PostOpMeds]").val('');$(":input[name^=elem_IntraVitrealMeds]").val('');}else{$("#tbl_pronote_med, #tbl_pronote_timeout, #dvcmt").show();$("#divBottox, #divAddFields, #div_lasik_proc").addClass("hidden");$("#elem_bottox_open_flg").val(0);$("#elem_lasik_open_flg").val(0);$("#dvTypeBtx").addClass("hidden");$("#dvlids").removeClass("hidden");$("#dvPtOccu, #dvPtHobby").addClass("hidden");}}
function setBottoxVisual(){var wo=window.opener.top.fmain;var v_sc=[],v_cc=[],v_sc_p=[],v_cc_p=[];var ars=["Od","Os"];for(var sv in ars){var s=ars[sv];for(var i=1;i<=3;i++){var oa=wo.$(":input[name=elem_visDis"+s+"Sel"+i+"]");var ob=wo.$(":input[name=elem_visDis"+s+"Txt"+i+"]");var a=oa.val();var b=ob.val();if(typeof(b)!="undefined"&&b!=""&&b!="20/"){if(a=="SC"){if(oa.hasClass("active")||ob.hasClass("active")){if((typeof(v_sc[s])=="undefined"||v_sc[s]=="")){v_sc[s]=b;}}
else{if((typeof(v_sc_p[s])=="undefined"||v_sc_p[s]=="")){v_sc_p[s]=b;}}}else if(a=="CC"){if(oa.hasClass("active")||ob.hasClass("active")){if((typeof(v_cc[s])=="undefined"||v_cc[s]=="")){v_cc[s]=b;}}
else{if((typeof(v_cc_p[s])=="undefined"||v_cc_p[s]=="")){v_cc_p[s]=b;}}}}}}
for(var sv in ars){var s=ars[sv];var sl=s.toLowerCase();$("#elem_botox_sc_"+sl).val(function(){if(typeof(v_sc[s])!="undefined"&&v_sc[s]!=""){return v_sc[s];}else if(typeof(v_sc_p[s])!="undefined"&&v_sc_p[s]!=""){return v_sc_p[s];}else{return"";}});$("#elem_botox_cc_"+sl).val(function(){if(typeof(v_cc[s])!="undefined"&&v_cc[s]!=""){return v_cc[s];}else if(typeof(v_cc_p[s])!="undefined"&&v_cc_p[s]!=""){return v_cc_p[s];}else{return"";}});}}
function check_selection_cpt(selected_cpt,sel_option){sel_option=$.trim(sel_option);var arsel_option=sel_option!=""?sel_option.split(" - "):[];arsel_option[0]=$.trim(arsel_option[0]);if(arsel_option[1]!=""){arsel_option[1]=$.trim(arsel_option[1]);}
var t_sel="";var ln=selected_cpt.length;for(var i=0;i<ln;i++){var t=$.trim(selected_cpt[i]);if(t!=""){if(t==$.trim(sel_option)){t_sel="selected";}else{var art=t.split(" - ");art[0]=$.trim(art[0]);if(art[0]!=""){art[1]=$.trim(art[1]);if(art[1]!=""){if(arsel_option[0]==art[0]&&arsel_option[1]==art[1]){t_sel="selected";}}else{}}}
if(t_sel=="selected"){break;}}}
return t_sel;}
function getProcedureInfo(flgOnLoad){if(typeof(flgOnLoad)=="undefined"||flgOnLoad==""){flgOnLoad="0";}
var cntCptGrid=$("#cntCptGrid").val();var a=$(":input[name=elem_procedure]").val();if(a!=""&&a!=0){if(flgOnLoad=="0"){$(":input[name^=elem_PreOpMed]").val('');$(":input[name^=elem_PostOpMeds]").val('');$(":input[name^=elem_IntraVitrealMeds]").val('');$("#laser_procedure_note,#spot_duration,#spot_size,#power,#shots,#total_energy,#degree_of_opening,#exposure,#count").val("");proc_showTabs('');for(var j=1;j<=cntCptGrid;j++){$("#elem_cptCode"+j).val("");$("#elem_mod_code"+j).val("");}}
var url=zPath+"/chart_notes/onload_wv.php?elem_action=Procedures";url+="&getProceduresInfo="+a;$.get(url,function(data){var cpt_opt_split=cptopt_split='';var cpt_options='';var a_cpt="";var all_cpts=new Array();var all_mods=new Array();var str_cpt_mod=$.trim(data.arr_cpt_mod);var option_val='';if(flgOnLoad=="1"){var selected_cpt=$("#cpt_multi_select").val();}
$("#cpt_multi_select").html('');$("#hid_str_cpt_mod").val('');if(str_cpt_mod){arr_cpt_mod=str_cpt_mod.split("~~");if(arr_cpt_mod.length>=1){cptopt_modifier="";var sel_option="",sel_option_dis="";for(var i=0;i<arr_cpt_mod.length;i++){cptopt_split=arr_cpt_mod[i].split("||");if($.trim(cptopt_split[0])){var cpt_desc="";var all_cpt_dec=cptopt_split[0].split(" - ");cptopt_split[0]=""+all_cpt_dec[0];if($.trim(all_cpt_dec[1])){cpt_desc=""+all_cpt_dec[1];}
a_cpt=arr_cpt_mod[i];all_cpts[i]=cptopt_split[0];all_mods[i]=cptopt_split[1];if($.trim(cptopt_split[1])){cptopt_modifier=" ("+$.trim(cptopt_split[1])+")";}
cpt_options+="<div id='' onclick='set_cpt_val(\""+a_cpt+"\")' style='border-bottom:1px solid blue;width:151px;cursor:pointer;'>&nbsp;"+cptopt_split[0]+cptopt_modifier+"</div>";sel_option=cptopt_split[0];sel_option_dis=cptopt_split[0];if(cpt_desc){sel_option_dis+=" - "+cpt_desc;}
if(cptopt_split[1]){sel_option=cptopt_split[0]+" - "+cptopt_split[1];sel_option_dis=sel_option_dis+" - "+cptopt_split[1];}
var t_sel="";if(flgOnLoad=="1"){t_sel=check_selection_cpt(selected_cpt,sel_option);}else{t_sel="selected";}
option_val+='<option '+t_sel+' value="'+sel_option+'">'+sel_option_dis+'</option>';}}
$("#hid_str_cpt_mod").val(''+str_cpt_mod);}
if(a_cpt.length>0){}
for(var j=1;j<=cntCptGrid;j++){}
$("#cpt_multi_select").html(option_val);}
fun_mselect("#cpt_multi_select","refresh");$('#cpt_multi_select').trigger('changed.bs.select');var dx_option="";if(data.dx_code!=""){if(flgOnLoad=="1"){var selected_dx=$("#elem_dxCode").val();}
var dx_split=$.trim(data.dx_code).split(";");if(dx_split.length>0){var dx_id_split=$.trim(data.dx_code_id).split(";");if(dx_id_split.length!=dx_split.length){dx_id_split=[];}
$.each(dx_split,function(index,dx_value){var dx_value=$.trim(dx_value)
if($.trim(dx_value)){var t_dx_value=dx_value;if(dx_id_split.length>0&&typeof(dx_id_split[index])!="undefined"&&dx_id_split[index]!=""){t_dx_value=t_dx_value+"@~@"+dx_id_split[index];}
var t_sel="";if(flgOnLoad=="1"){if(selected_dx.indexOf(t_dx_value)!=-1||selected_dx.indexOf(dx_value)!=-1){t_sel="selected";}}
else{t_sel="selected";}
dx_option+="<option "+t_sel+" value='"+t_dx_value+"'>"+dx_value+"</option>";}});}}
$("#elem_dxCode").html(dx_option);fun_mselect("#elem_dxCode","refresh");$('#elem_dxCode').trigger('changed.bs.select');if(flgOnLoad=="1"){return;}
if(data.pre_op_meds!=""){var arr=data.pre_op_meds.split("|");if(arr.length>0){for(var x in arr){var a=parseInt(x)+1;if(arr[x]!=""){$("input[name=elem_PreOpMed"+a+"]").val(arr[x]);}}}}
$("#div_laser_procedure_notes").hide();$("#div_intravitreal_meds,#lbl_intravitreal_meds").show();if(data.intraviteral_meds!=""&&data.laser_procedure_note!="1"){var arr=data.intraviteral_meds.split("|");if(arr.length>0){for(var x in arr){var a=parseInt(x)+1;if(arr[x]!=""){$("input[name=elem_IntraVitrealMeds"+a+"]").val(arr[x]);}}}
$("#laser_procedure_note,#spot_duration,#spot_size,#power,#shots,#total_energy,#degree_of_opening,#exposure,#count").html("");}else if(data.laser_procedure_note=="1"){$("#div_intravitreal_meds,#lbl_intravitreal_meds").hide();$("#div_laser_procedure_notes").show();$("#laser_procedure_note").val("1");$("#spot_duration").val(data.spot_duration);$("#spot_size").val(data.spot_size);$("#power").val(data.power);$("#shots").val(data.shots);$("#total_energy").val(data.total_energy);$("#degree_of_opening").val(data.degree_of_opening);$("#exposure").val(data.exposure);$("#count").val(data.count);}
if(data.post_op_meds!=""){var arr=data.post_op_meds.split("|");if(arr.length>0){for(var x in arr){var a=parseInt(x)+1;if(arr[x]!=""){$("input[name=elem_PostOpMeds"+a+"]").val(arr[x]);}}}}
if(data.time_out_request=="yes"){$("#elem_timeout").prop("checked",true).triggerHandler("click");}
if(data.consent_form_id!=""){var v=data.consent_form_id
var sel_form=data.consent_form_id_sel
var c_optval;if(v.indexOf(",")>0){v_arr=v.split(",");if(v_arr.length>1){c_optval='<option value=\'\'></option>';for(c=0;c<v_arr.length;c++){o_id=$.trim(v_arr[c]);if(typeof consent_arr[o_id]!="undefined"){c_optval+='<option value="'+o_id+'">'+consent_arr[o_id]+'</option>';}}}}else if($.trim(v)&&typeof consent_arr[v]!="undefined"){c_optval='<option selected="selected" value="'+v+'">'+consent_arr[v]+'</option>';sel_form=v;}else{c_optval='<option value=\'\'></option>';$.each(consent_arr,function(index,value){c_optval+='<option value="'+index+'">'+value+'</option>';;});sel_form="";}
$(":input[name=elem_consentForm]").html("");$(":input[name=elem_consentForm]").html(c_optval);$(":input[name=elem_consentForm]").val(sel_form);}else{var c_optval='<option value=\'\'></option>';$.each(consent_arr,function(index,value){c_optval+='<option value="'+index+'">'+value+'</option>';;});$(":input[name=elem_consentForm]").html("");$(":input[name=elem_consentForm]").html(c_optval);$("#consent_form  iframe").attr("src","");}
if(data.op_report_id!=""){var op_optval="";var op=data.op_report_id;var op_sel_form=data.op_report_id_sel;var c_optval;if(op.indexOf(",")>0){op_arr=op.split(",");if(op_arr.length>1){op_optval='<option value=\'0\'></option>';for(o=0;o<op_arr.length;o++){o_id=$.trim(op_arr[o]);if(typeof opnotes_arr[o_id]!="undefined"){op_optval+='<option value="'+o_id+'">'+opnotes_arr[o_id]+'</option>';}}}}else if($.trim(op)&&typeof opnotes_arr[op]!="undefined"){op_optval='<option selected="selected" value="'+op+'">'+opnotes_arr[op]+'</option>';op_sel_form=op;}else{op_optval='<option value=\'0\'></option>';$.each(opnotes_arr,function(index,value){op_optval+='<option value="'+index+'">'+value+'</option>';});op_sel_form="";}
$(":input[name=elem_OpTempId]").html("");$(":input[name=elem_OpTempId]").html(op_optval);$(":input[name=elem_OpTempId]").val(op_sel_form);}else{var op_optval;op_optval='<option value=\'0\'></option>';$.each(opnotes_arr,function(index,value){op_optval+='<option value="'+index+'">'+value+'</option>';});$(":input[name=elem_OpTempId]").html("");$(":input[name=elem_OpTempId]").html(op_optval);}
if(data.consent_signed){$("#consent_select").html("&nbsp;<img src='"+zPath+"/../library/images/flag_green.png' border='0' title='Saved'>");}else{$("#consent_select").html("&nbsp;<img src='"+zPath+"/../library/images/flag_red.png' border='0' title='Not Saved'>");}},"json");}}
var ogetprocdxcodes;function fill_codes_in_proc_sb(d){var ar_highlight=d.ar_highlight;var ar_dx=d.dx;var dx_option="";if(ar_dx&&ar_dx.length>0){var k=1;for(var z in ar_dx){if(ar_dx[z]&&typeof(ar_dx[z])!="undefined"&&ar_dx[z]!=""){var tardx=ar_dx[z].split(" :Dsc: ");var tdx=tardx[0];var tdsc=tardx[1];var tdxid=tardx[2];if(typeof(tdxid)=="undefined"||tdxid==""){tdxid="";}
dx_option+="<option value='"+tdx+"' selected>"+tdx+"</option>";$('#elem_dxCode_'+k).val(tdx).attr('title',tdsc).data("dxid",tdxid).tooltip();if(ar_highlight&&ar_highlight.length>0){if(ar_highlight.indexOf(tdx)!=-1){$('#elem_dxCode_'+k).addClass("el-highlight");}
else{for(var t in ar_highlight){if(typeof(ar_highlight[t])!="undefined"&&ar_highlight[t]!=""&&sb_check_dx_in_icd10(ar_highlight[t],tdx)){$('#elem_dxCode_'+k).addClass("el-highlight");break;}}}}
k++;}}}
var flg_btx=0;var unit="";var wunit="";var proc=$.trim($("#elem_procedure option:selected").html());if(proc!=''){proc=proc.toLowerCase();if(proc.indexOf("botox")!=-1){flg_btx=1;var btx_type=$("#dvTypeBtx :checked[type=radio][name=elem_typeBtx]").val();if(btx_type=="Medical"){unit=$("#elem_botox_used").val();unit=Math.round(unit);var tunit=$("#elem_botox_total").val();var wunit=tunit-unit;wunit=Math.round(wunit);}
else if(btx_type=="Cosmetic"){unit=$("#elem_botox_used").val();}}}
var j=1;var arcpt=fun_mselect("#cpt_multi_select","val");if(typeof(arcpt)!="object"){arcpt=[];}
for(var z in arcpt){if(typeof(arcpt[z])!="undefined"&&arcpt[z]!=""){var tmp=arcpt[z].split(" - ");var tmp_cpt=tmp[0];var tmp_md=tmp[1];if(typeof(tmp_cpt)!="undefined"&&tmp_cpt!=""){var flgRpt=0;do{if($('#elem_cptCode_'+j).length<=0){opAddCptRow("LASTINDX");}
$('#elem_cptCode_'+j).val(tmp_cpt).triggerHandler("blur");if(flg_btx==1&&tmp_cpt.match(/^j/i)){var tunit=(flgRpt==1&&tmp_md=="JW")?wunit:unit;if(tunit!=""&&tunit!="0"){if(typeof(j)!="undefined"&&$("#elem_procUnits_"+j).length>0){$("#elem_procUnits_"+j).data("unit",tunit);$("#elem_procUnits_"+j).val(tunit);}
flgRpt=(flgRpt==0&&wunit>0)?1:0;}}
if(typeof(tmp_md)!="undefined"&&tmp_md!=""){var ar_tmp_md=tmp_md.split(";");if(ar_tmp_md.length>0){for(var x in ar_tmp_md){if(typeof(ar_tmp_md[x])!="undefined"&&ar_tmp_md[x]!=""){var y=parseInt(x)+1;$("#elem_modCode_"+j+"_"+y).val(ar_tmp_md[x]);}}}}
if(dx_option!=""){$("#elem_dxCodeAssoc_"+j).html(dx_option);$('#elem_dxCodeAssoc_'+j).selectpicker('refresh');}
if(flgRpt==1){if(wunit!=""){tmp_md="JW";}}
j++;}while(flgRpt);}}}
getMxSB();}
function setSuperBillValue_onchange(){opRemAllCptRow(2);$(".dxallcodes").val("").removeClass("el-highlight");var ar_dx_code=[],ar_dx_code_id=[];var ardx=fun_mselect("#elem_dxCode","val");if(typeof(ardx)!="object"){ardx=[];}
var k=1;for(var z in ardx){if(typeof(ardx[z])!="undefined"&&ardx[z]!=""){var tmp_dx=ardx[z].split("@~@");var t_dx_id=$.trim(tmp_dx[1]);if(typeof(t_dx_id)=="undefined"||t_dx_id==""){t_dx_id="";}
var tmp_dx=ardx[z].split(" - ");var t_dx=$.trim(tmp_dx[0]);ar_dx_code[ar_dx_code.length]=t_dx;ar_dx_code_id[ar_dx_code_id.length]=t_dx_id;k++;}}
var eye=$(":checked[name=elem_site]").val();var lids="";$("#elem_lidsopt_rul, #elem_lidsopt_rll, #elem_lidsopt_lul, #elem_lidsopt_lll").each(function(){if(this.checked){lids+=""+this.value+",";}});var url=zPath+"/chart_notes/requestHandler.php";var prm={'elem_formAction':'get_procedure_dx_codes','eye':eye,'lids':lids,'dx':ar_dx_code,'dx_id':ar_dx_code_id};$.post(url,prm,function(xx){var flg_show_pop="0";var tmp=xx.getElementsByTagName("flg_show_pop")[0];if(tmp&&tmp.firstChild){flg_show_pop=tmp.firstChild.nodeValue;}
var strdx="";var tmp=xx.getElementsByTagName("ardx")[0];if(tmp&&tmp.firstChild){strdx=tmp.firstChild.nodeValue;}
var strdxhgt="";var tmp=xx.getElementsByTagName("arhighlight")[0];if(tmp&&tmp.firstChild){strdxhgt=tmp.firstChild.nodeValue;}
var str="";if(flg_show_pop!="1"){var oAsInfo=xx.getElementsByTagName("assess");str=get_dx_popup_lss(oAsInfo,'get_proc_dx_codes');if(str!=""){ogetprocdxcodes={};ogetprocdxcodes.ar_highlight=strdxhgt.split(",");}}
if(str==""){var d={};d.dx=strdx.split("!DX!");d.ar_highlight=strdxhgt.split(",");fill_codes_in_proc_sb(d);}},"xml");}
function checkDisTimeout(o){if(o.checked){$("#tbl_Timeout").removeClass("hidden");$("#elem_corrctsite_ou").prop("checked",$(":checked[id=elem_site_ou]").length);$("#elem_corrctsite_od").prop("checked",$(":checked[id=elem_site_od]").length);$("#elem_corrctsite_os").prop("checked",$(":checked[id=elem_site_os]").length);}else{$("#tbl_Timeout").addClass("hidden");}}
function saveProcedure(){var final_flg=$("#elem_finalized_status").val();if(elem_per_vo=="1"||final_flg==1){var pr=$("#elem_hidPrint").val();if(pr!="1"&&pr!="2"){window.close();return;}}
var msg="";var x1=$(":input[name=elem_procedure]").val();var x1Txt=$("#elem_procedure option:selected").text();msg+=(x1=="")?"- Procedure<br />":"";var y1=$(":checked[name=elem_site]");var yl1=$(":checked[name*=elem_lidsopt]");if(x1Txt.toLowerCase().indexOf("botox")==-1){msg+=(y1.length<=0&&yl1.length<=0)?"- Site/Lids<br />":"";}
if($(":checked[id=elem_timeout]").length>0&&x1Txt.toLowerCase().indexOf("botox")==-1&&x1Txt.toLowerCase()!="lasik"){x=$(":input[name=elem_corrctprocedure]").val();var x2=$(":input[name=elem_providers]").val();msg+=(x=="")?"- Correct Procedure<br />":"";var y2=$(":checked[name=elem_corrctsite]");var yl2=$(":checked[name*=elem_cor_lidsopt]");msg+=(y2.length<=0&&yl2.length<=0)?"- Correct Site/Correct Lids<br />":"";msg+=(x2=="")?"- Providers<br />":"";var warn_msg="";if(x1!=""&&x!=""&&x1!=x){warn_msg+="Procedure and Correct Procedure do not match.";}
if(y1.length>0&&y2.length>0&&y1.val()!=y2.val()){warn_msg+="Site and Correct Site do not match.";}
if(warn_msg!=""){var cfrm=confirm(""+warn_msg+"\nDo you want to continue?");if(cfrm==false){return;}}}
var is_sb_md=0;sb_dxids="";var oSB=isSuperBillMade();if(oSB.SBill==true){if(oSB.DXCodeComplete==false){msg+='&bull; Incomplete ICD-10 DX code(s) in Super bill<br>';}else{is_sb_md=1;sb_dxids=oSB.dxids;}}
if(msg!=""){displayConfirmYesNo_v2("Save checks","Please fill following values :-<br />"+msg.replace(/\\n/g,"<br/>"));return;}
var curConfrmId=$("#curConfrmId").val();var s=$(":input[name=elem_consentForm]").val();if(s!=""&&s!="0"&&curConfrmId==s){if(typeof(top.iframeConsentForm.$)!="undefined"){var phy_sign_var_from_consent="";if((top.iframeConsentForm.document.getElementById('hidd_phy_sign_var')!="")&&(top.iframeConsentForm.document.getElementById('hidd_phy_sign_var')==null)){phy_sign_var_from_consent=top.iframeConsentForm.$("#hidd_phy_sign_var").val();}
if($("#consent_form").hasClass("active")||(typeof(phy_sign_var_from_consent)!='undefined'&&typeof(phy_sign_var_from_consent)!=''&&typeof(phy_sign_var_from_consent)!==null)){if($('#hold_to_physician').val()!=""){top.iframeConsentForm.$("#hidd_hold_to_physician").val($('#hold_to_physician').val());}
top.iframeConsentForm.save_form('save_form',1);var ofrm=top.iframeConsentForm.document.consent_frm;var ln=ofrm.elements.length;var appdelem="";for(var i=0;i<ln;i++){if(ofrm.elements[i].name!=""){if((ofrm.elements[i].type=="checkbox"||ofrm.elements[i].type=="radio")&&ofrm.elements[i].checked==false){continue;}
appdelem+="<input type='hidden' name='"+ofrm.elements[i].name+"' value='"+ofrm.elements[i].value+"' />";}}
if(appdelem!=""){$('form[name=frmProcedure]').append(""+appdelem);}}}}
var curOpId=$("#curOpId").val();var s=$(":input[name=elem_OpTempId]").val();if(s!=""&&s!="0"&&curOpId==s){if(!$("#op_report").hasClass("active")){$("#op_report_id").val("");}}else{$("#op_report_id").val("");}
var re=check_qty_val();if(re==1){return false;}
$("#sb_dxids").val(sb_dxids);var strsave=$("form").serialize();strsave+="&savedby=ajax";var template_content=$('#elem_pnData').redactor('code.get');strsave+="&elem_pnData="+encodeURIComponent(template_content);strsave+="&is_sb_md="+is_sb_md;if(typeof(setProcessImg)!='undefined')setProcessImg("1");$.post(zPath+"/chart_notes/saveCharts.php",strsave,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0");if(data){if(data.up_iop_summery&&data.up_iop_summery==1){if(typeof(window.opener.top.fmain.loadExamsSummary)!="undefined"){window.opener.top.fmain.loadExamsSummary("iop_gon");}}
if(data.print_pdf&&data.print_pdf!=""){open_print_window(data.print_pdf);return;}}
top.window.close();},'json');}
function hold_dr_sig(){if($('#hold_to_physician').val()==''){$("<div class=\"alert alert-danger\"> Please select a physician.</div>").insertBefore("#hold_to_phy_div .modal-body");}else{$('#hidd_hold_to_physician').val($('#hold_to_physician').val());document.getElementById('elem_btnSave').click();$('#hold_to_phy_div .close').trigger("click");}}
function delProcedure(id){if(confirm("Are you sure to delete this procedure note? ")){var qry=(id!="")?"elem_saveForm=procedures_save&chart_del_id="+id:"";if(qry!=""){if(typeof(setProcessImg)!='undefined')setProcessImg("1");$.post(zPath+"/chart_notes/saveCharts.php",qry,function(data){window.close();});}}}
function finalizeProcedure(){var op_finalize=$("#elem_finalized_status").val()=="1"?"0":"1";var id=$("#elem_chart_procedures_id").val();if(typeof(id)=="undefined"||id==""){return;}
var qry="elem_saveForm=procedures_save&chart_finalize_id="+id+"&op_finalize="+op_finalize+" ";if(qry!=""){if(typeof(setProcessImg)!='undefined')setProcessImg("1");$.post(zPath+"/chart_notes/saveCharts.php",qry,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0");$("#elem_finalized_status").val(data.finalize);$("#elem_btnFinalize").html(""+data.btnfinalize).addClass("hidden");if(data.finalize=="1"){$("#elem_btnSave, #hold_btn, #del_btn").addClass("hidden");}else{$("#elem_btnSave, #hold_btn").removeClass("hidden");}
window.location.reload();},'json');}}
function print_procedure(flg){var tb=$('.nav-tabs li.active a').text();if(typeof(tb)!="undefined"&&(tb=="Consent Form"||tb=="Op Report")){var url="";if(tb=="Consent Form"){var cfi=$("#curConfrmId").val();var fii=$("#proc_con_frm_id").val();if(typeof(cfi)!="undefined"&&typeof(fii)!="undefined"&&cfi!=""&&fii!=""&&cfi!="0"&&fii!="0"){url=zPath+"/patient_info/consent_forms/print_consent_form.php?consent_form_id="+cfi+"&consent=yes&form_information_id="+fii;}}else if(tb=="Op Report"){var pri=$("#proc_pn_rep_Id").val();if(typeof(pri)!="undefined"&&pri!=""&&pri!="0"){url=zPath+"/chart_notes/progress_notes/load_file.php?elem_pnRepId="+pri+"&media_id=";}}
if(url!=""){window.location.replace(url);}
return;}
var amnd=$.trim($("#elem_amndmnt").val());var hid_pa_sign_by=$.trim($("#hid_pa_sign_by").val());if(amnd!=""){var id=$("#hid_pa_final_by").val();if(id==""||id=="0"){if(typeof(flg)=="undefined"){fancyConfirm("Amendment of this procedure note is not finalized. Do you want to print this? ","","print_procedure(true)");return;}}}
$("#elem_hidPrint").val("1");if($("#elem_btnSave").length>0&&!$("#elem_btnSave").hasClass("hidden")){$("#elem_btnSave").trigger("click");}
else{$("#elem_hidPrint").val("2");saveProcedure();}}
function checksignle(ob){$("#pt_site_lasik").html("").removeClass();single_chkbx(ob);refreshconsentIframe();refreshOpnotesiteval();var v=$(":checked[name=elem_site]").val();var cv=""+v.toLowerCase()+"col";$("#pt_site_lasik").html(v).addClass(" pt_info bg-info "+cv);}
function insertTimeIOP(){var x=$(":input[name=elem_iopType]").val();if(x==""){$(":input[name=elem_iopType]").val("TA");}
var o=document.getElementById("elem_iopTime");insertTime(o);}
function refreshconsentIframe(){var idProc=$(":input[name=elem_chart_procedures_id]").val();var s=$(":input[name=elem_consentForm]").val();var curConfrmId=$("#curConfrmId").val();var a=$("#consent_form  iframe").attr("src");var chartId=$("#elem_form_id").val();var site='';if($("#elem_site_ou").is(":checked")||$("#elem_site_od").is(":checked")||$("#elem_site_os").is(":checked")){document.getElementById('consent_form').src=document.getElementById('consent_form').src;if($("#elem_site_ou").is(":checked")){site='both eyes';}else if($("#elem_site_od").is(":checked")){site='right eye';}else if($("#elem_site_os").is(":checked")){site='left eye';}}
if((s!="")||typeof(a)=="undefined"){$("#curConfrmId").val(s);var u=(typeof(zPath_remote)!="undefined")?zPath_remote:zPath;var hgt=parseInt($("#iframeConsentForm").css("height"));$("#consent_form  iframe").attr("src",u+"/patient_info/consent_forms/consentFormDetails.php?consent_form_id="+s+"&pop_procedure=1&chart_procedures_id="+idProc+"&pophgt="+hgt+"&site="+site+"&chartId="+chartId+"");}}
function refreshOpnotesiteval(){var idProc=$(":input[name=elem_chart_procedures_id]").val();var s=$(":input[name=elem_OpTempId]").val();if(s=="0"){s="";}
var curOpId=$("#curOpId").val();var pd=$('#elem_pnData').redactor('code.get');if((s!="")||(s!=""&&pd=="")){$("#curOpId").val(s);var e=$(":checked[name=elem_site]").val();if(typeof(e)=="undefined")e="";var selText='';var selectedoptions=fun_mselect('#elem_dxCode',"val");$(selectedoptions).each(function(){if(document.getElementById($(this))!==undefined&&document.getElementById($(this))!==null){selText+=$(this).val()+';';}else{selText+="";}});var url=zPath+"/chart_notes/onload_wv.php?elem_action=Procedures";url+="&elem_opNoteId="+s+"&elem_opNoteEye="+e+"&chart_procedures_id="+idProc+"&elem_opNotedxCode="+selText;$.get(url,function(data){if(data!=""){$('#elem_pnData').redactor('code.set',''+selText);}});}}
function check_qty_val(){var arr_qty_obj={"elem_PreOpMed":"elem_med_preop_lot_qty","elem_IntraVitrealMeds":"elem_med_intravitreal_lot_qty","elem_PostOpMeds":"elem_med_postop_lot_qty"};var arr_lot_obj={"elem_PreOpMed":"elem_PreOpMedLot","elem_IntraVitrealMeds":"elem_IntraVitrealMedsLot","elem_PostOpMeds":"elem_PostOpMedsLot"};var ret=1;var error_msg=preop_med_name=intravitreal_med_name=postop_med_name="";var ln=$("#procnote span input[name*=elem_PreOpMed]").length;for(var i=1;i<=ln;i++){if($("input[name=elem_med_preop_lot_qty"+i+"]").val()!=""&&$.trim($("input[name=elem_PreOpMedLot"+i+"]").val())==""&&$("input[name=elem_med_preop_lot_qty"+i+"]").val()!="0"){preop_med_name=$("input[name=elem_PreOpMed"+i+"]").val();if(typeof(preop_med_name)!="undefined"&&preop_med_name!=""){error_msg+="\n Please enter Lot# for '"+preop_med_name+"'";$("input[name=elem_PreOpMedLot"+i+"]").css("border","1px solid red");}}}
var ln=$("#div_intravitreal_meds span input[name*=elem_IntraVitrealMeds]").length;for(var i=1;i<=ln;i++){if($("input[name=elem_med_intravitreal_lot_qty"+i+"]").val()!=""&&$.trim($("input[name=elem_IntraVitrealMedsLot"+i+"]").val())==""&&$("input[name=elem_med_intravitreal_lot_qty"+i+"]").val()!="0"){intravitreal_med_name=$("input[name=elem_IntraVitrealMeds"+i+"]").val();if(typeof(intravitreal_med_name)!="undefined"&&intravitreal_med_name!=""){error_msg+="\n Please enter Lot# for '"+intravitreal_med_name+"'";$("input[name=elem_IntraVitrealMedsLot"+i+"]").css("border","1px solid red");}}}
var ln=$("#procnote span input[name*=elem_PostOpMeds]").length;for(var i=1;i<=ln;i++){if($("input[name=elem_med_postop_lot_qty"+i+"]").val()!=""&&$.trim($("input[name=elem_PostOpMedsLot"+i+"]").val())==""&&$("input[name=elem_med_postop_lot_qty"+i+"]").val()!="0"){postop_med_name=$("input[name=elem_PostOpMeds"+i+"]").val();if(typeof(postop_med_name)!="undefined"&&postop_med_name!=""){error_msg+="\n Please enter Lot# for '"+postop_med_name+"'";$("input[name=elem_PostOpMedsLot"+i+"]").css("border","1px solid red");}}}
if(error_msg){displayConfirmYesNo_v2("Save checks",error_msg);return 1;}else{return 0;}}
function proc_add_med_fields(o){var flg=1;$(o).parent().parent().find("input").each(function(){if($.trim(this.value)==""){flg=0;}});if(flg==1){var on=o.name;var idxo=on.replace(/elem_PreOpMed|elem_PostOpMeds|elem_IntraVitrealMeds/,"");idx=parseInt(idxo)+1;if(on.indexOf("elem_PreOpMed")!=-1){var a="divPreOpMeds";var b="elem_PreOpMed"+idx;var c="elem_PreOpMedLot";var d="elem_med_preop_lot_qty";var e="elem_med_preop_lot_id"+idx;var f="elem_med_preop_lot_qty";}else if(on.indexOf("elem_PostOpMeds")!=-1){var a="divPostOpMeds";var b="elem_PostOpMeds"+idx;var c="elem_PostOpMedsLot";var d="elem_med_postop_lot_qty";var e="elem_med_postop_lot_id"+idx;var f="elem_med_postop_lot_qty";}else if(on.indexOf("elem_IntraVitrealMeds")!=-1){var a="divIntraVitrealMeds";var b="elem_IntraVitrealMeds"+idx;var c="elem_IntraVitrealMedsLot";var d="elem_med_intravitreal_lot_qty";var e="elem_med_intravitreal_lot_id"+idx;var f="elem_med_intravitreal_lot_qty";}
var h1="",h2="",h3="";h1="<span id=\""+a+"\"><input type=\"text\" name=\""+b+"\" value=\"\" class=\"form-control\" onchange=\"getMedName(this);\" ></span>";h2="<input type=\"text\" name=\""+c+idx+"\" value=\"\" class=\""+d+" form-control\" >"+"<input type=\"hidden\" name=\""+e+"\" value=\"\" >";h3="<input type=\"text\" readonly=\"\" name=\""+f+idx+"\" value=\"\" class=\"form-control\" >";$(o).parent().parent().append(h1);$("input[name="+c+idxo+"]").parent().append(h2);$("input[name="+f+idxo+"]").parent().append(h3);cn_ta_procedures();}}
function getMedName(fieldObj)
{if($.trim(fieldObj.value)==""){return;}
var med_upc=fieldObj.value;$.ajax({type:"GET",url:zPath+"/chart_notes/onload_wv.php?elem_action=Procedures&med_upc="+med_upc,success:function(resp){if(resp&&resp.indexOf("ERROR")==-1&&resp.indexOf("DOCTYPE")==-1){fieldObj.value=resp;}else{console.log(resp);}}});proc_add_med_fields(fieldObj);}
function set_qty_in_hand(obj,arr_med_name,arr_item_no_qty,arr_thrash,arr_lot_no){var arr_qty_obj={"elem_PreOpMed":"elem_med_preop_lot_qty","elem_IntraVitrealMeds":"elem_med_intravitreal_lot_qty","elem_PostOpMeds":"elem_med_postop_lot_qty"};var arr_lot_obj={"elem_PreOpMed":"elem_PreOpMedLot","elem_IntraVitrealMeds":"elem_IntraVitrealMedsLot","elem_PostOpMeds":"elem_PostOpMedsLot"};var curr_obj_ctr=obj.name.substr(-1);var obj_len=parseInt(obj.name.length)-parseInt(1);var cur_qty_obj=obj.name.substr(0,obj_len);var curent_qty_obj=arr_qty_obj[cur_qty_obj];var curent_lot_obj=arr_lot_obj[cur_qty_obj];$("input:text[name="+curent_qty_obj+curr_obj_ctr+"]").val("0");var medi_name=$.trim(obj.value);var opt_med_id=arr_med_name[medi_name];if(typeof(arr_item_no_qty[opt_med_id])!='undefined'){$("input:text[name="+curent_qty_obj+curr_obj_ctr+"]").val(arr_item_no_qty[opt_med_id]);if(typeof(arr_thrash[opt_med_id])!='undefined'&&arr_thrash[opt_med_id]<=arr_item_no_qty[opt_med_id]){top.fAlert(medi_name+" has reached threshold limit, please re-order")}}
var lot_obj_name=curent_lot_obj+curr_obj_ctr;set_lot_val(arr_lot_no,lot_obj_name,opt_med_id)}
function get_surgeon_sign(){var id=$("#el_post_op_surgeon").val();if(typeof(id)=="undefined"||id==""){top.fAlert("Please select surgeon.");return;}
var sgn=$("#el_surgeon_sign_path").val();if(sgn!=""){var s="<img src=\""+sgn+"\" alt=\"sign\" height=\"30\">";$("#div_sgn_sign").html(s);$("#el_surgeon_sign").val("1");$("#el_surgeon_sign_dos").val($("#el_surgeon_sign_dos").data("dtcr"));}}
function set_finalized_view(){$(".final_proc :input").each(function(){if($(this).parents("#amendment").length>0){return;}
var prop=(this.type!="text"&&this.type!="textarea")?"disabled":"readonly";$(this).prop(prop,true);if(this.id=="elem_startTime"||this.id=="elem_endTime"||this.id=="elem_iopOd"||this.id=="elem_iopOs"){$(this).prop("onclick",null).off("click");}
$(this).on("click",function(){fAlert("This Proc Note is finalized, please create an Amendment to document changes");this.blur();});});var hgt=parseInt($("#dvprocedure_note").css("height"))*0.4;$("#elem_amndmnt").css("cssText","height:"+hgt+"px !important");$('#elem_amndmnt').bind('focus',function(){get_operator_name_date();});$('#elem_amndmnt').on('blur',function(){remove_operator_name_date();});}
function saveProcedure_amnd(flgfin){if(elem_per_vo=="1"){return;}
if(typeof(flgfin)=="undefined"){flgfin="0";}
var strsave="elem_saveForm=proc_amedment_save";strsave+="&elem_amndmnt="+encodeURIComponent($("#elem_amndmnt").val());strsave+="&hid_pa_sign="+$("#hid_pa_sign").val();strsave+="&hid_fin="+flgfin;strsave+="&elem_chart_procedures_id="+$("#elem_chart_procedures_id").val();strsave+="&savedby=ajax";if(typeof(setProcessImg)!='undefined')setProcessImg("1");$.post(zPath+"/chart_notes/saveCharts.php",strsave,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0");top.window.close();});}
function finalizeProcedure_amnd(){if(elem_per_vo=="1"){return;}
var sign=$.trim($("#hid_pa_sign").val());var signby=$.trim($("#hid_pa_sign_by").val());var amndmnt=$.trim($("#elem_amndmnt").val());var msg="";if(amndmnt==""){msg+="<br/> - Amendments";}
if(sign==""||signby==""){msg+="<br/> - Signatures";}
if(msg!=""){fAlert("Please Enter followings:-"+msg);}else{saveProcedure_amnd(1);}}
function proc_get_phy_sign(){var phyid=$("#hid_pa_sign_by").val();var procid=$("#elem_chart_procedures_id").val();var finalby=$("#hid_pa_final_by").val();if(typeof(phyid)=="undefined"||phyid==""||typeof(procid)=="undefined"||procid==""||elem_per_vo=="1"||(typeof(finalby)!="undefined"&&finalby!=""&&finalby!="0")){return;}
var strsave="elem_formAction=getUserSign";strsave+="&req_ptwo=1";strsave+="&elem_form_id=0";strsave+="&procid="+procid;strsave+="&elem_physicianId="+phyid;strsave+="&num=1";$.post(zPath+"/chart_notes/requestHandler.php",strsave,function(dt){if(typeof(setProcessImg)!='undefined')setProcessImg("0");if(dt&&dt[1]&&dt[0]){var oT=gebi("td_signature_applet1");var oSP=gebi("hid_pa_sign");if(oT){if(oSP){oSP.value=""+dt[1];}
oT.innerHTML="<img src=\""+dt[0]+"\" alt=\"img\">";flgSave1=1;}}else{$("#td_signature_applet1").trigger("click");}},'json');}
function getAssessmentSign(num,n,coords,sdata,simg,cnfrm)
{var final_flg=($("#hid_pa_final_by").val()!=""&&$("#hid_pa_final_by").val()!="0")?1:0;if(elem_per_vo=="1"||final_flg==1){return;}
if(typeof(num)=="undefined"){num=1;}
var v1="td_signature_applet"+num;var v2="dv_ShowSign"+num;var v5="hid_pa_sign";if(typeof(n)=="undefined"){var w=parseInt(225*2.5);var h=parseInt(45*2.5);var opd=0;var tmp=$('#'+v1).position();if($("#"+v2).length<=0){var strpixls="";var img="<iframe id=\"ifrm_signApp"+num+"\" src=\"signApplet.php?sec=proc&final_flg="+final_flg+"&signType="+num+"\" border=\"0\" height=\"100%\" width=\"100%\" scrolling=\"0\"></iframe>";var str="<div id=\""+v2+"\" >"+
img+"</div>";$('#'+v1).append(str);$('#'+v2).css({'position':'absolute','width':''+w+"px",'height':''+h+"px",'background-color':'white','border':'1px solid black','z-Index':2,'overflow':'hidden'});}else{$("#"+v2).show();}
$("#"+v2).css({"left":tmp.left+"px","top":(opd+tmp.top-h)+"px"});}else if(n==1){var fid=$("#elem_chart_procedures_id").val();$('#'+v1+' img').remove();$("#"+v2).hide();var proId=(final_flg==1)?$('#hid_pa_sign_by').val():"";if(typeof(setProcessImg)!='undefined')setProcessImg(1,""+v1);var p={'elem_formAction':'GetSign','strpixls':''+coords+'','fid':''+fid,'signType':num,'final_flg':final_flg,'proId':proId,'sData':sdata,'sImg':simg};$.post('requestHandler.php',p,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,""+v1);if(data&&data.src&&data.src!=''){var u=zPath;$('#'+v1).append("<img src=\""+data.src+"\" alt=\"sign\" width=\"150\" height=\"30\" >");$('input[name='+v5+']').val(data.sign_path);}},"json");}else if(n==2){$("#"+v2).hide();}else if(n==3){}}
function showAllergys(v){if(v==1){$("#divAllergy").show();}else{$("#divAllergy").hide();}}
function get_operator_name_date()
{var final_flg=($("#hid_pa_final_by").val()!=""&&$("#hid_pa_final_by").val()!="0")?1:0;if(elem_per_vo=="1"||final_flg==1){return;}
var t=current_date(top._dtFormat,2,true)+' '+operator+': \n'+$("#elem_amndmnt").val();$("#elem_amndmnt").val(t);var el=$("#elem_amndmnt")[0];setTimeout(function(){set_caret_position("elem_amndmnt",21)},30);}
function remove_operator_name_date()
{var str_text=$("#elem_amndmnt").val();var match_string=current_date(top._dtFormat,2,true)+' '+operator+': \n';if(str_text==match_string)$("#elem_amndmnt").val('');}
$(document).ready(function(){$('.nav-tabs a').on('shown.bs.tab',function(event){var x=$(event.target).text();var y=$(event.relatedTarget).text();if(y=='Proc Note'){var chkds=$("input[name='elem_site']:checked");if(chkds.length==0&&x!='Amendment'){fAlert('Please select Site/Lids');$('.nav-tabs a[href="#procnote"]').tab('show');return false;}}
if(x=='Amendment'){if($(event.target).parent().hasClass("disabled")){$(event.relatedTarget).trigger("click");return false;}}});cn_ta_procedures();sb_addTypeAhead();cn_typeahead();proc_showTabs('proc_note');set_value_qty_texts(arr_med_name,arr_item_no_qty,arr_thrash);$("#elem_procedure").change(function(){getProcedureInfo();setTimeout(function(){set_value_qty_texts(arr_med_name,arr_item_no_qty,arr_thrash,arr_lot_no)},1500);setBottox();});getProcedureInfo(1);$('#cpt_multi_select, #elem_dxCode').selectpicker('render');setBottox(1);if($("#dvprocedure_note_sec").hasClass("final_proc")){set_finalized_view();}
$('#cpt_multi_select, #elem_dxCode').on('changed.bs.select',function(e,clickedIndex,isSelected,previousValue){var o=$(e.target).parents("div.bootstrap-select");var w=o[0].offsetWidth;o.removeClass("form-control").css({"width":w+"px"});o.find("span.filter-option").css({"white-space":"normal"});});$("[data-toggle='tooltip']").tooltip();});
function clearSuperBill(){opRemAllCptRow(3);$(".dxallcodes,#superbill input[name=elem_todaysCharges],#elem_levelComplexity,#elem_proc_only_visit,#elem_post_op_visit,#elem_visitCode").val("");if(""+$("#elem_flgIsPtNew").val()=="Yes_confirmed"){$("#elem_flgIsPtNew").val("New");}else if(""+$("#elem_flgIsPtNew").val()=="No_confirmed"){$("#elem_flgIsPtNew").val("Establish");}
$(".dxallcodes").tooltip("destroy");}
var z_flg_diabetes="",z_flg_diab_sb="";function sb_clearDiabetesAssessments(flgonlychk,clrtake){clrtake=(typeof(clrtake)!="undefined"&&clrtake=="1")?"1":"0";var pln="";var ret=0;var ar_dm_as=["Diabetes Type 1 No retinopathy","DM Type 1 Mild with ME","DM Type 1 Mod with ME","DM Type 1 Severe with ME","DM Type 1 Proliferative with ME","DM Type 1 Mild without ME","DM Type 1 Mod without ME","DM Type 1 Severe without ME","DM Type 1 Proliferative without ME","DM Type 1","DM Type 1 no retinopathy","Diabetes Type 1","Diabetes Type I","Diabetes 1","DM 1"];var ass_nm="textarea[id*=elem_assessment]";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
$(ass_nm).each(function(indx){if(this.id.toLowerCase().indexOf("dx")==-1){var tmp=$.trim(this.value);if($.trim(tmp)!=""){tmp=tmp.toLowerCase();var ar_tmp=tmp.split(";");tmp=$.trim(ar_tmp[0]);if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){}
else{if(clrtake==1){if(isDbTakeAssess(tmp)){this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");return;}}}
for(var t in ar_dm_as){var dm1=ar_dm_as[t].toLowerCase();var dm2=(ar_dm_as[t]=="Diabetes Type I")?"Diabetes Type II".toLowerCase():ar_dm_as[t].replace("1","2").toLowerCase();var flgdm1=false;var flgdm2=false;if(isDiabetesAssess(tmp,2)){flgdm1=(tmp.indexOf(dm1)!=-1)?true:false;flgdm2=(tmp.indexOf(dm2)!=-1)?true:false;}
if(tmp==dm1||flgdm1||tmp==dm2||flgdm2){if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){if(typeof(z_flg_diab_sb)=="undefined"||(z_flg_diab_sb!="2"&&z_flg_diab_sb!="3")){var tmp_dx_mod=$.trim(ar_tmp[1]);tmp_dx_mod=tmp_dx_mod.toLowerCase();if(typeof(tmp_dx_mod)!="undefined"&&tmp_dx_mod!=""){if(z_flg_diab_sb=="1"){if((tmp_dx_mod.indexOf("mild")!=-1||tmp_dx_mod.indexOf("mod")!=-1||tmp_dx_mod.indexOf("severe")!=-1||tmp_dx_mod.indexOf("proliferative")!=-1)){tmp=tmp+"; "+tmp_dx_mod;}}else{tmp=tmp+"; "+tmp_dx_mod;}}}
if(tmp!="DM Type 1".toLowerCase()&&tmp!="Diabetes Type 1".toLowerCase()&&tmp!="DM Type 2".toLowerCase()&&tmp!="Diabetes Type 2".toLowerCase()&&tmp!="Diabetes Type I".toLowerCase()&&tmp!="Diabetes Type II".toLowerCase()){ret=1;}
else{var neid=this.id.replace("elem_assessment","no_change_");if($("#"+neid).prop("checked")==true){ret=1;}}}else{this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");pln=$("#"+asplid).val();$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");if($.trim(pln)!=""){break;}}}}}}});if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){return ret;}else{return pln;}}
function sb_clearDbAsTaking(){var ass_nm="textarea[id*=elem_assessment]";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
$(ass_nm).each(function(indx){var tmp=$.trim(this.value);if($.trim(tmp)!=""){tmp=tmp.toLowerCase();var ar_tmp=tmp.split(";");tmp=$.trim(ar_tmp[0]);if(isDbTakeAssess(tmp)){this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");pln=$("#"+asplid).val();$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");return;}}});}
function sb_addAssessOption(a,b,c,d,e,f,g){if(typeof(addAssessOption)=="function"){addAssessOption(a,b,c,d,e,f,g);}else{if($("#assessplan .planbox .assnm[id*=elem_assessment][value='']").length>0){var tmpid=$("#assessplan .planbox .assnm[id*=elem_assessment][value='']")[0].id;$("#"+tmpid).val(a);var tmpdxid=tmpid.replace(/elem_assessment/g,"elem_assessment_dxcode");$("#"+tmpdxid).val(f);if((finalize_flag==0||isReviewable==1)&&elem_per_vo!="1"&&$("#hid_icd10").val()=="1"){a=encodeURI(a);f=encodeURI(f);var fid=$("#elem_masterId").val();if(typeof(setProcessImg)!='undefined')setProcessImg(1,"superbill");$.get(zPath+"/chart_notes/saveCharts.php?elem_saveForm=SET_DIABETES_IN_ASMNT&as="+a+"&dx="+f+"&fid="+fid,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"superbill");});}}else{}}}
function isDiabetesAssess(str,fstp){str=$.trim(str);if(fstp=="2"){var ar_str=str.split(";");if(ar_str.length>0){str=$.trim(ar_str[0]);}}
var ret=str.match(/^((diabetes|diabetes\s+mellitus|dm)\s+type\s+[1|2])/gi);str=str.toLowerCase();if(str=="diabetes 1"||str=="diabetes 2"||str=="dm 1"||str=="dm 2"||str=="diabetes type 1 no retinopathy"||str=="diabetes type 2 no retinopathy"){ret=str;}return ret;}
function isDbTakeAssess(s){return s.match(/Long\s+term\s+\(current\)\s+use\s+of/gi);}
function sb_getSeverityScaleObj(){return{text:"Severity Scale",id:"dmb_svrt_scl",click:function(){var x=""+"<div class=\"section\" id=\"svrt_scl_info\" >"+"<div id=\"staging_code_header\" class=\"purple_bar\">Severity Scale <span title=\"Close\"  onClick=\"$('#svrt_scl_info').remove();\" class=\"glyphicon glyphicon-remove pull-right\"  ></span> </div>"+"<div >"+"<ol type=\"a\">"+"<li><b>Mild</b> = microaneurysms"+"</li>"+"<li><b>Moderate</b> = more than just microaneurysms but less than severe NPDR"+"</li>"+"<li><b>Severe</b> = any of the following (4-2-1 rule) and no signs of PDR"+"<ol type=\"i\">"+"<li>Severe intraretinal hemorrhages and microaneurysms  in each of 4 quadrants </li>"+"<li>Definite venous beading in two or more quadrants </li>"+"<li>Moderate IRMA in one or more quadrants</li>"+"</ol>"+"</li>"+"<li><b>PDR</b>  = neovascularization or vitreous/pre-retinal hemorrhage"+"</li>"+"</ol>"+"</div>"+"</div>";$("#svrt_scl_info").remove();$("body").append(x);$("#svrt_scl_info").show();$("#svrt_scl_info").draggable({handle:"#staging_code_header"});}};}
function opSuperBill(flg_ids,flg_medComp){if(typeof(flg_ids)=="undefined"){z_flg_diab_sb="1";sb_checkDiabetes();return;}
sb_getProcId4del();clearSuperBill();var lenAssess=$("#assessplan .planbox").length;var strAssess="";var valAssess,valAssessDx,idAsmtDx;var oAssess,oAssessDx;var oNe,ores;for(var i=1;i<lenAssess;i++){oAssess=gebi("elem_assessment"+i);oNe=gebi("no_change_"+i);ores=gebi("elem_resolve"+i);oAssessDx=gebi("elem_assessment_dxcode"+i);valAssessDx=valAssess=idAsmtDx="";if(oAssess){valAssess=(typeof oAssess.value!="undefined")?oAssess.value:"";}
if(oAssessDx&&typeof oAssessDx.value!="undefined"&&$.trim(oAssessDx.value)!=""){valAssessDx=oAssessDx.value;idAsmtDx=$(oAssessDx).data("dxid");if(typeof idAsmtDx=="undefined"){idAsmtDx="";}}
if(oNe&&ores&&(valAssess!="")){if(((oNe.type=="checkbox"&&oNe.checked==false)&&(ores.type=="checkbox"&&ores.checked==false))||((oNe.type=="hidden"&&oNe.value==0)&&(ores.type=="hidden"&&ores.value==0))){strAssess+="&elem_assessment"+i+"="+valAssess;if(valAssessDx!=""){strAssess+="&elem_assessmentDx"+i+"="+valAssessDx;if(idAsmtDx!=""){strAssess+="&elem_asmtDxId"+i+"="+idAsmtDx;}}}}}
strAssess+="&elem_mxLen="+lenAssess;getDxCodesFromAssess(strAssess);}
function isTestOrderBySelected(){var oOp=document.getElementById("elem_opidTestOrdered");if(oOp&&oOp.value!=""){return true;}else{return false;}}
function opTestSuperBill(){if(typeof sb_testName=="undefined"){return;}
if(!isTestOrderBySelected()){top.fAlert("Please select order by.");var oOp=document.getElementById("elem_opidTestOrdered");if(oOp){oOp.focus();}
return;}
var test_eye="";if(sb_testName=="HRT"||sb_testName=="OCT"||sb_testName=="OCT-RNFL"||sb_testName=="GDX"){test_eye=""+$(":checked[name=elem_scanLaserEye]").val();}else if(sb_testName=="VF"||sb_testName=="VF_GL"){test_eye=""+$(":checked[name=elem_vfEye]").val();}else if(sb_testName=="Pachy"){test_eye=""+$(":checked[name=elem_pachyMeterEye]").val();}else if(sb_testName=="IVFA"){test_eye=""+$(":checked[name=elem_ivfa_od]").val();}else if(sb_testName=="ICG"){test_eye=""+$(":checked[name=elem_icg_od]").val();if(test_eye==1){test_eye="OU";}
else if(test_eye==2){test_eye="OD";}
else if(test_eye==3){test_eye="OS";}}else if(sb_testName=="Fundus"||sb_testName=="External"){test_eye=""+$(":checked[name=elem_photoEye]").val();}else if(sb_testName=="Topography"||sb_testName=="TestOther"||sb_testName=="TestLabs"){test_eye=""+$(":checked[name=elem_topoMeterEye]").val();}else if(sb_testName=="CellCount"){test_eye=""+$(":checked[name=elem_cellCntEye]").val();}else if(sb_testName=="A/Scan"||sb_testName=="iOLMaster"){var tod=""+$(":input[name=performedByOD]").val();var tos=""+$(":input[name=performedByOS]").val();var tod_2=""+$(":input[name=performedByPhyOD]").val();var tos_2=""+$(":input[name=phyTechListOS]").val();if(tod!=""||tod_2!=""){test_eye="OD";}
if(tos!=""||tos_2!=""){test_eye=(test_eye=="OD")?"OU":"OS";}}else if(sb_testName=="BScan"){test_eye=""+$(":checked[name=elem_bscanMeterEye]").val();}
var sb_testName_2=sb_testName;if(sb_testName=="OCT"){var a=$(":checked[name=elem_scanLaserOct]").val();if(a==2){sb_testName_2="OCT-Retina";}else if(a==3){sb_testName_2="OCT-Anterior Segment";}}else if(sb_testName=="External"){var a=$(":checked[name=elem_fundusDiscPhoto]").val();if(a==2){sb_testName_2="Anterior Segment Photos";}else{sb_testName_2="External Photos";}}else if(sb_testName=="iOLMaster"){sb_testName_2="IOL Master";}else if(sb_testName=="BScan"){sb_testName_2="B-Scan";}else if(sb_testName=="CellCount"){sb_testName_2="Cell Count";}else if(sb_testName=="VF_GL"){sb_testName_2="VF-GL";}else if(sb_testName=="TestLabs"){sb_testName_2="Laboratories";}
custom_test_variation_subid=0;if($('#hidd_test_cpt_preference_variation_id').get(0)!='undefined'){custom_test_variation_subid=$('#hidd_test_cpt_preference_variation_id').val();}
if(typeof(test_eye)=="undefined"||test_eye==""){test_eye="OU";}
$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=GetTestCptCodes&testname="+sb_testName_2+"&eye="+test_eye+"&variation_id="+custom_test_variation_subid,function(data){var obj=data.dx;if(obj!=null){var ln=obj.length;var y=1;if(ln>0){for(var x in obj){if(typeof(obj[x])!="undefined"&&obj[x]!=""){var ad=obj[x].split(" :Dsc: ");var dx=$.trim(ad[0]);var dx_dsc=$.trim(ad[1]);$("#elem_dxCode_"+y).val(dx).attr("title",dx_dsc).tooltip();y+=1;}if(y>12){break;}}if(y>1){$("#elem_dxCode_1").trigger("blur");}}}
var obj=data.cpt;if(obj==null||obj[0]==null){top.fAlert("No CPT code is specified for this Test.You can enter yourself.");}else{var strCptAlrdySel="";for(var x in obj){var ocpt=obj[x];if($.trim(ocpt["practice_code"])){var units=ocpt["units"];var ccodeDesc=ocpt["desc"];var arrMd=ocpt["modifier"];var cCpt=$.trim(ocpt["practice_code"]);var mxSbId=gebi("elem_mxSBId").value;var indxTbl=indxTblEmpty="";var cFlag=false;var eTblSb=gebi("tblSuperbill");var oRows=eTblSb.rows;var lenRows=oRows.length;for(var i=0;i<lenRows;i++){var tCptId=oRows[i].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var sCpt=$.trim(oCpt.value);if((indxTblEmpty=="")&&(sCpt=="")){indxTblEmpty=(i+1);}
if(oCpt&&(sCpt!="")&&(sCpt==cCpt)){indxTbl=""+i;}}
if(indxTbl!=""){strCptAlrdySel=""+cCpt+" ";continue;}
if(indxTblEmpty!=""){var oCpt=gebi("elem_cptCode_"+indxTblEmpty);oCpt.value=cCpt;oCpt.title=ccodeDesc;renew_title(oCpt,ccodeDesc);$("#elem_procUnits_"+indxTblEmpty).val(units);if(arrMd.length>0){for(var a=0;a<4;a++){if($.trim(arrMd[a])!=""){$("#elem_modCode_"+indxTblEmpty+"_"+(a+1)).val(arrMd[a]);}}}
if(typeof oCpt.onblur=="function"){checkDB4Code_flg=0;oCpt.onblur();}}else{var oVal={"cptCode":cCpt,"procId":"","units":units,"arrDx":new Array(),"arrMd":arrMd,"cptDesc":ccodeDesc};opAddCptRow(mxSbId,oVal);}}}
if(strCptAlrdySel!=""){window.status="CPT code ("+strCptAlrdySel+") already exists in super bill! ";}}},"json");}
function opProcedureSuperBill(){setSuperBillValue_onchange();}
function setMedComplexity(obj,flg){var val=obj.value;$("input[type=checkbox][id*=elem_chkMedComp_]").each(function(inx){if(obj.checked&&this.value!=val&&this.checked){this.checked=false;}});var val=$(":checked[id*=elem_chkMedComp_]").val();var oPrnt=top.fmain;if(typeof(wpage)!="undefined"&&wpage=="accSB"){oPrnt=top;}
var oComp=gebi("elem_levelComplexity");if(oComp){if(val==6){$("#elem_post_op_visit").val("1");oComp.value="";}else if(val==5){$("#elem_proc_only_visit").val("1");oComp.value="";}else{oComp.value=val;$("#elem_proc_only_visit").val("");$("#elem_post_op_visit").val("");}
var objCategory=gebi("elem_category");if($("#elem_flgIsPtNew").val()=="Yes_confirmed"||$("#elem_flgIsPtNew").val()=="No_confirmed"||$("#elem_flgIsPtNew").val()=="Establish"){if(typeof(flg_checkAssocPqri4All_checkvisitcode)!="undefined"&&flg_checkAssocPqri4All_checkvisitcode!=0&&flg_checkAssocPqri4All_checkvisitcode!=""){checkAssocPqri4All_checkvisitcode(flg_checkAssocPqri4All_checkvisitcode);}else{checkAssocPqri4All();}}}}
function getLOSfromCode(cd){var cd=cd.toString();if(cd=="Intermediate"){return 2;}else if(cd=="Comprehensive"){return 4;}else if((typeof cd!="undefined")&&(cd.length==5)){var lastDgt=cd.substring(4);return lastDgt;}
return"";}
function makeVisitCode(obj){var practiceBillCode=obj["elem_practiceBillCode"];var strCategory=obj["elem_category"];var levelOfService=obj["elem_levelOfService"];var visitCode=category="";if(strCategory!=null&&practiceBillCode!=null)
{category=getPatientCategoryCode(strCategory,practiceBillCode);}
if(practiceBillCode&&strCategory&&levelOfService)
{visitCode=practiceBillCode+category+levelOfService;}
var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var iscodeOk=visitCode.match(reg);return(iscodeOk)?visitCode:false;}
function sb_getVisitCodeCPTCost(vpbc){var parm="";var ar=["920","992"];var str_stop_dup="";for(var z in ar){var t=ar[z];var c=0;$(":input[type=checkbox][id*=lb_qlfy_lvl_code"+t+"]").each(function(){if(this.checked){var qd=$(this).val();if(typeof(qd)=="undefined"){qd="";}
if(qd!=""){if(str_stop_dup.indexOf(qd+",")==-1){str_stop_dup+=qd+",";parm+="&lb_qlfy_lvl_code"+t+"="+qd;c++;}}}});}
for(var z in ar){var t=ar[z];var tv="$0.00";$("label[id*=lb_rs_qlfy_def_"+t+"]").html(tv);$("label[id*=lb_rs_qlfy_ins_"+t+"]").html(tv);}
if(parm==""){$("label[id*=lb_rs_qlfy_ins_], #lb_rs_ins_v").html(tv).hide();return;}
var ins=$("#elem_masterCaseId").val();if(typeof(ins)=="undefined"){ins="";}
parm+="&elem_insCaseId="+ins;parm+="&elem_dos="+$("#elem_dos").val();var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=sb_getVisitCodeCPTCost"+parm;$.get(url,function(data){for(var x in data){var xd=x.replace("lb_qlfy_lvl_code","lb_rs_qlfy_def_");var xi=x.replace("lb_qlfy_lvl_code","lb_rs_qlfy_ins_");var tv=(data[x]&&data[x]["def"]&&typeof(data[x]["def"])!="undefined")?"$"+data[x]["def"]:"$0.00";$("label[id*="+xd+"]").html(tv).show();var tv=(data[x]&&data[x]["ins"]&&typeof(data[x]["ins"])!="undefined")?"$"+data[x]["ins"]:"$0.00";$("label[id*="+xi+"]").html(tv).show();}
var flg=0;$("label[id*=lb_rs_qlfy_ins_]").each(function(){var t=$(this).html();if(t!="$0.00"){flg=1;}});if(flg==0){$("label[id*=lb_rs_qlfy_ins_], #lb_rs_ins_v").html(tv).hide();}},"json");}
function confirmVisitCode_v3(){var oCat=gebi("elem_category");var oPBC=gebi("elem_practiceBillCode");var olvlHis=gebi("elem_levelHistory");var olvlComp=gebi("elem_levelComplexity");var olvlService=gebi("elem_levelOfService");var oPoeVC=gebi("elem_poe_visit_code");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");var close_flg=0;if((oPoeVC.value==sb_cpt_code_poe)){setVisitCode(oPoeVC.value);close_flg=1;}else if(typeof(opov.value)!="undefined"&&opov.value=="1"){close_flg=1;}
else if(typeof(opopv.value)!="undefined"&&opopv.value=="1"){setVisitCode(oPoeVC.value);close_flg=1;}
if(close_flg==1){$("#dialog-Mdc-cum-new-pt").remove();return;}
var objEye={"elem_category":oCat.value,"elem_practiceBillCode":oPBC.value,"elem_levelOfService":olvlService.value};var strVisitCodeEye=makeVisitCode(objEye);if(strVisitCodeEye&&(strVisitCodeEye!="-1")&&($.trim(strVisitCodeEye)!="")){var prmptComp=($.trim(olvlComp.value)=="")?1:0;var lvlInsert=5;if(oPBC.value=="920"){lvlInsert=4;}
if(lvlInsert==olvlService.value){confirmVisitCode_v2();}else{confirmVisitCode_v2();}}}
function confirmVisitCode_v2(){var oCat=gebi("elem_category");var olvlHis=gebi("elem_levelHistory");var olvlComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");var olvlSerEye=gebi("elem_levelOfServiceEye");var olvlSerEM=gebi("elem_levelOfServiceEM");var oExNotDoneEye=gebi("elem_strExmNotDoneEye");var oExNotDoneEM=gebi("elem_strExmNotDoneEM");var oElem_pls_sel_nq_em=gebi("elem_pls_sel_nq_em");var oElem_pls_sel_nq_eye=gebi("elem_pls_sel_nq_eye");var detailEye="";var detailEM="";var objEye={"elem_category":oCat.value,"elem_practiceBillCode":"920","elem_levelOfService":olvlSerEye.value};var strVisitCodeEye=makeVisitCode(objEye);if(strVisitCodeEye){var obj={"vCode":strVisitCodeEye,"elem_levelOfService":olvlSerEye.value,"elem_practiceBillCode":"920","elem_strExmNotDone":oExNotDoneEye.value,"elem_pls_sel_nq":oElem_pls_sel_nq_eye.value};detailEye=getVisitCodeDetail(obj);}
var str_tbl_hdr_em=["",""];if($("#elem_practiceBillCode").val()=="992"){var objEM={"elem_category":oCat.value,"elem_practiceBillCode":"992","elem_levelOfService":olvlSerEM.value};var strVisitCodeEM=makeVisitCode(objEM);if(strVisitCodeEM){var obj={"vCode":strVisitCodeEM,"elem_levelOfService":olvlSerEM.value,"elem_practiceBillCode":"992","elem_strExmNotDone":oExNotDoneEM.value,"elem_pls_sel_nq":oElem_pls_sel_nq_em.value};detailEM=getVisitCodeDetail(obj);}
str_tbl_hdr_em[0]="<td width=\"1\"></td><td width=\"550\" valign=\"top\"><b>E/M Code</b></td>";str_tbl_hdr_em[1]="<td width=\"3\" height=\"1\" ><div style=\"background-color:gray;width:1px;height:100%;\"></div></td><td valign=\"top\" id=\"td_em_cd\">"+detailEM+"</td>";}
if(($.trim(detailEM)=="")&&($.trim(detailEye)=="")){return;}
var msg="<table class=\"table table-bordered\"  border=\"0\" width=\"100%\" >"+"<tr><td width=\"550\" valign=\"top\"><b>Eye Code</b></td>"+str_tbl_hdr_em[0]+"</tr>"+"<tr><td valign=\"top\" id=\"td_eye_cd\">"+detailEye+"</td>"+str_tbl_hdr_em[1]+"</tr>"+"</table>";var title="Assessed Service Level";var btn1="0";var btn2="0";if(typeof top.fmain=="undefined"){var func=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?"decideLevelofService2":"decideLevelofService2";}else{var func=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?"top.fmain.decideLevelofService2":"top.fmain.decideLevelofService2";}
var oArr={};if(olvlSerEye.value!="0"){oArr["Current Eye Code"]="Eye Code";}
if($("#elem_practiceBillCode").val()=="992"){if(olvlSerEM.value!="0"){oArr["Current E/M Code"]="EM Code";}
var pLeft=100;}else{var pLeft=200;}
var misc=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?new Array(oArr):new Array({"OK":"OK"});var btnhtm="";var len=misc.length;for(var i=0;i<len;i++)
{var tmp=misc[i];for(x in tmp)
{btnhtm+="<input type=\"button\" value=\""+x+"\" onClick=\"window."+func+"('"+tmp[x]+"')\" class=\"btn btn-success\">&nbsp;";}}
btnhtm+='<input type="button" value="Cancel" onClick="window.'+func+'(-1)" class="btn btn-danger">';msg=msg+"<div id=\"module_buttons\" class=\"pt10 row\"><div class=\"col-sm-12 text-center\"><div class=\"form-group\">"+btnhtm+"</div></div></div>";if($("#div_as_srv_lvl").length<=0){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});}
$("#div_as_srv_lvl").html(msg);sb_getVisitCodeCPTCost();var pTop=60;$("#div_as_srv_lvl").find("tr").css({"background-color":"white"});$("#div_as_srv_lvl").find("input[id*=lb_qlfy_lvl_code]").bind("click",function(){var d=this.checked;var f=this.name;var e=this.id;$("input[type=checkbox][name*="+f+"]").each(function(index){if(this.id==e){$(this).prop("checked",d);}else{$(this).prop("checked",false);}});var clr=(d)?"red":"transparent";$("label[for*="+f+"]").each(function(index){if($(this).attr("for")==e){$(this).css({"border":"1px solid "+clr});}else{$(this).css({"border":"1px solid transparent"});}});if(this.value=="Procedure only visit"){$("#elem_proc_only_visit").val("1");}else{$("#elem_proc_only_visit").val("");}
if(this.value=="Post Op Visit"){$("#elem_post_op_visit").val("1");}else{$("#elem_post_op_visit").val("");}
if(d){opRemAllCptRow(3);checkAssocPqri4All();}else{sb_getVisitCodeCPTCost();}
stopClickBubble();});$("#div_as_srv_lvl #td_eye_cd .seprtr").each(function(ii){$(this).css({"width":"200px"});});if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});var lalign=($("#div_as_srv_lvl").find("input[type=button][value='OK']").length>0)?"50%":"70%";}}
function sb_get_vc_opt(vcd,vpbc,vcat){var vcat_in="";if(vcat=="New"){vcat_in="0";}else if(vcat=="Establish"){vcat_in="1";}
if(vpbc=="920"){var ar=["Intermediate - "+vpbc+vcat_in+"2","Comprehensive - "+vpbc+vcat_in+"4"];}else{var ar=["992"+vcat_in+"1","992"+vcat_in+"2","992"+vcat_in+"3","992"+vcat_in+"4","992"+vcat_in+"5"];}
var ret="<label class=\"lbl_asl_1\">Qualify for: </label><div class=\"seprtr\"><label for=\"lb_qlfy_lvl_code"+vpbc+"_0\">None</label></div>";ret="";for(var z in ar){var sel=(vcd==ar[z])?"checked":"";var tmp=ar[z].replace(/(Intermediate\s+\-\s+|Comprehensive\s+\-\s+)/g,"");ret+="<div class=\"seprtr\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+tmp+"\" "+sel+" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+ar[z]+"</label></div>";}
if($("#elem_practiceBillCode").val()=="920"){z=z+1;ret+="<div class=\"seprtr\" style=\"float:right; text-align:left;\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+"Procedure only visit"+"\" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+"Procedure only visit"+"</label></div>";z=z+1;ret+="<br/><div class=\"seprtr\" style=\"float:right;text-align:left;\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+"Post Op Visit"+"\" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+"Post Op Visit"+"</label></div>";}
if(ret!=""){ret="<label class=\"lbl_asl_1\">Qualify for: </label>"+ret;ret+="<br><label class=\"lbl_asl_1\" id=\"lb_rs_def_v\">Default Fees: </label><label id=\"lb_rs_qlfy_def_"+vpbc+"\" >Loading..</label>"+"<br><label class=\"lbl_asl_1\" id=\"lb_rs_ins_v\">Ins. Contract Fees: </label><label id=\"lb_rs_qlfy_ins_"+vpbc+"\">Loading..</label>";}
return ret;}
function getVisitCodeDetail(obj){var oPBC=obj["elem_practiceBillCode"];var objCategory=gebi("elem_category");var vCode_cpt=vCode=obj["vCode"];var pls_sel_nq=obj["elem_pls_sel_nq"];var msg="";if(vCode!=false){var oLoS=obj["elem_levelOfService"];var oNotDoneExm=obj["elem_strExmNotDone"];var arrNotDoneExm=(typeof oNotDoneExm!="undefined")?oNotDoneExm.split(","):new Array();var nxtVCode=(oLoS<"5"&&pls_sel_nq=="")?eval(vCode)+1:eval(vCode);if(oPBC=="920"){if(oLoS=="2"){vCode="Intermediate";}else if(oLoS=="4"){vCode="Comprehensive";}
nxtVCode=(oLoS<="1")?"Intermediate":"Comprehensive";}else{if(pls_sel_nq==""){if(nxtVCode==99201){nxtVCode="99202";}else if(nxtVCode==99211){nxtVCode="99212";}}}
if(pls_sel_nq!=""){nxtVCode=vCode;}
var nxtLos=getLOSfromCode(nxtVCode);if((oLoS=="0")){vCode="None";vCode_cpt="";}else{vCode_cpt=" - "+vCode_cpt;}
if(vCode==nxtVCode&&pls_sel_nq==""){nxtVCode="None";}
if(oPBC=="992"){vCode_cpt="";}
msg=""+"<br>"+sb_get_vc_opt(vCode+""+vCode_cpt,oPBC,objCategory.value)+"";msg+="<br>";if(((oLoS<"5")&&(vCode!="Comprehensive"))||(pls_sel_nq!="")){var tmp_list="";var arrExmCate=new Array();var len=arrNotDoneExm.length;for(var i=0;i<len;i++){if((typeof arrNotDoneExm[i]!="undefined")&&(arrNotDoneExm[i]!="")){if((arrNotDoneExm[i].indexOf("Fundus Exams")!=-1)||(arrNotDoneExm[i].indexOf("SLE")!=-1)||(arrNotDoneExm[i].indexOf("L&A")!=-1)){if(arrNotDoneExm[i].indexOf("-")!=-1){var arrTmpCate=arrNotDoneExm[i].split("-");var key=$.trim(arrTmpCate[0]);var val=$.trim(arrTmpCate[1]);if(typeof arrExmCate[key]=="undefined"){arrExmCate[key]=new Array();}
arrExmCate[key].push(val);}}else{tmp_list+="<br>   - "+arrNotDoneExm[i];}}}
for(var i in arrExmCate){tmp_list+="<br>   - "+i;var len2=arrExmCate[i].length;for(var j=0;j<len2;j++){var strSubCate=$.trim(arrExmCate[i][j]);if(strSubCate!=""){strSubCate=strSubCate.replace(/;/g,", ");tmp_list+="<br>&nbsp;&nbsp;&nbsp;&nbsp;- "+strSubCate;}}}
if(tmp_list!=""){msg+="<br>List items that must be completed to qualify for level - "+nxtVCode+"";msg+="<div class=\"dv_ls_todo_exm\">"+tmp_list+"</div>";}}
msg+="";}
return msg;}
function checkCurrRowId(currRowId){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;for(var i=0;i<lastRow;i++){var tId="elem_trSB"+(i+1);var temp=gebi(tId);if(temp==null){currRowId=(i+1);break;}}
return currRowId;}
function getRealIndx(id,strTr,strTbl){if(typeof strTbl=="undefined"){strTbl="tblSuperbill";strTr="elem_trSB";}
var rowId=strTr+id;var tbl=gebi(strTbl);var lastRow=tbl.rows.length;var i=0;for(i=0;i<lastRow;i++){var temp=tbl.rows[i];if(rowId==temp.id){return i;break;}}
if(id=="LASTINDX"){return i-1;}
return 0;}
function editSBRowValues(oVal){var strCpt=oVal.cptCode;var arrMd=new Array();arrMd=oVal.arrMd;if($.trim(strCpt)!=""){var mxId=gebi("elem_mxSBId").value;var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;for(var i=0;i<mxId;i++){var tId="elem_cptCode_"+(i+1);var temp=gebi(tId);if(temp&&(temp.value!="")&&(typeof temp.value!="undefined")&&($.trim(temp.value)==$.trim(strCpt))){for(var j=1;j<=4;j++){var oMd=gebi("elem_modCode_"+(i+1)+"_"+j);if(oMd){oMd.value=(typeof arrMd[j-1]!="undefined")?""+arrMd[j-1]:"";}}}}}}
function Save_form(i,cnfrm){if(typeof(del_proc_noti)=="undefined"||del_proc_noti=="0"||del_proc_noti==""){cnfrm=true;}
if(typeof(cnfrm)=="undefined"){var str="top.Save_form('"+i+"',true)";if(typeof(top.fmain)!="undefined"){if(typeof(top.fmain.ifrm_FolderContent)!="undefined"&&typeof(top.fmain.ifrm_FolderContent.Save_form)=="function"){var str="top.fmain.ifrm_FolderContent.Save_form('"+i+"',true)";}else{var str="top.fmain.Save_form('"+i+"',true)";}}
top.fancyConfirm("Would you like to delete the selected CPT row from superbill ?","",""+str);}
else{opRemCptRow(i);if(document.getElementById('save_form')){document.getElementById('save_form').value='1';document.frmSuperBill.submit();}}}
function opAddCptRow(indx,oVal,flagStpGtMx,fRindx,sup_enc_chk){var enc_chk=false;if(sup_enc_chk==1){enc_chk=true;}
var cptCode="";var procId="";var units="1";var arrDx=new Array();var arrMd=new Array();var tmp="";var cptDesc="";flagStpGtMx=(typeof flagStpGtMx!="undefined")?flagStpGtMx:0;if(typeof sb_pdiv=="undefined"&&gebi("divWorkView")){sb_pdiv="divWorkView";}
if(typeof oVal!="undefined"&&oVal!=""){cptCode=oVal.cptCode;procId=oVal.procId;units=oVal.units;arrDx=oVal.arrDx;arrMd=oVal.arrMd;cptDesc=(typeof oVal.cptDesc!="undefined")?oVal.cptDesc:"";}
var w_dx=$(".dxcodeshd td").eq(2).prop("width");var oTbl=$("#tblSuperbill").get(0);var lastRow=oTbl.rows.length;var currRowId=lastRow+1;var elemId;if(indx=="new"){indx=lastRow;}
var rIndx=(fRindx==1)?indx:getRealIndx(indx);rIndx=parseInt(rIndx);var row=oTbl.insertRow(rIndx+1);currRowId=checkCurrRowId(currRowId);row.id="elem_trSB"+currRowId;var cellCpt=row.insertCell(0);$(cellCpt).addClass("cpt_td");cellCpt.innerHTML=""+"<div class=\"input-group\">"+"<label class=\"pointer input-group-addon text-center contno\" onclick=\"sb_swap_vals(this)\">"
+currRowId+"</label>"+"<input type=\"text\" id=\"elem_cptCode_"+currRowId+"\" name=\"elem_cptCode_"+currRowId+"\" value=\""+cptCode+"\" title=\""+cptDesc+"\" class=\"cptcode form-control\" onblur=\"checkCptCodesChart(this);\">"+"<input type=\"hidden\" id=\"elem_procedureId_"+currRowId+"\" name=\"elem_procedureId_"+currRowId+"\" value=\""+procId+"\">"+"<input type=\"hidden\" id=\"elem_procedureOrder_"+currRowId+"\" name=\"elem_procedureOrder_"+currRowId+"\" value=\""+(rIndx+1)+"\">"+"</div>";var cellUnits=row.insertCell(1);$(cellUnits).addClass("unit");cellUnits.innerHTML="<input type=\"text\" id=\"elem_procUnits_"+currRowId+"\"  name=\"elem_procUnits_"+currRowId+"\" value=\""+units+"\" class=\"cptunit form-control\" onchange=\"checkProcUnitsChart(this);\">";var dxw=$("#elem_trSB1 .dx").attr("width");var cellDx=row.insertCell(2);elemId="elem_dxCodeAssoc_"+currRowId;cellDx.innerHTML="<select  id=\""+elemId+"\" name=\""+elemId+"[]\" multiple=\"multiple\" data-width=\"100%\" class=\"diagText_all_css minimal selectpicker dropupalways\" data-actions-box=\"true\" title=\"\">"+"</select>";cellDx.width=dxw;var dxCdId=elemId;for(var i=1;i<=4;i++){var cellMod=row.insertCell(i+2);$(cellMod).addClass("md");elemId="elem_modCode_"+currRowId+"_"+i;tmp=(typeof arrMd[i-1]!="undefined")?""+arrMd[i-1]:"";cellMod.innerHTML=""+"<div class=\"input-group\"><input type=\"text\" id=\""+elemId+"\" name=\""+elemId+"\" value=\""+tmp+"\" class=\"form-control modcode\" onblur=\"checkModCodesChart(this);\"></div>"+"";}
var cellLast=row.insertCell(7);$(cellMod).prop("valign","middle");cellLast.innerHTML="<span class=\"glyphicon glyphicon-remove\" onclick=\"Save_form('"+currRowId+"');\" title=\"Delete\" ></span> "+"<span class=\"glyphicon glyphicon-plus\" onclick=\"opAddCptRow('"+currRowId+"')\" title=\"Insert\"  ></span> ";if(flagStpGtMx!=1){var objsbnr=getMxSB(1);}
gebi("elem_cptCode_"+currRowId).onblur();sb_addTypeAhead();sb_crt_dx_dropdown("#"+dxCdId,'',arrDx);fun_mselect("#"+dxCdId,'render');fun_mselect("#"+dxCdId,'onchange',function(){dx_assoc_cpt(this);});fun_mselect("#"+dxCdId,'width');sb_reorder_srno();sb_add_menu();}
function sb_reorder_srno(){$("#tblSuperbill tr").each(function(i){$(this).find(".contno").html(""+(i+1)+"");});}
var st_sb_dx=ed_sb_dx=st_sb_rw=ed_sb_rw=0;function sb_swap_vals(obj){if(typeof(elem_per_vo)=="undefined"){elem_per_vo="0";}
if(typeof(finalize_flag)=="undefined"){finalize_flag="0";}
if(typeof(isReviewable)=="undefined"){isReviewable="0";}
if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
var id=($(obj).parents("#tblSuperbill").length>0)?"tblSuperbill":$(obj).parents("table").attr("id");if(id=="tblSuperbill"){var num=""+$(obj).parents("tr").attr("id");num=parseInt(num.replace(/elem_trSB/,""));if(st_sb_rw==0){st_sb_rw=num;obj.style.color="red";return;}else{ed_sb_rw=num;}
if((st_sb_rw!=0)&&(ed_sb_rw!=0)){$("#tblSuperbill tr").each(function(i){$(this).find("td:first-child .contno").css("color","white");});var tcv=$("#elem_cptCode_"+ed_sb_rw).val();var tct=$("#elem_cptCode_"+ed_sb_rw).attr("title");var tcvd=$("#elem_cptCode_"+ed_sb_rw).attr("valid_dxcodes");var tcpv=$("#elem_procedureId_"+ed_sb_rw).val();var tcov=$("#elem_procedureOrder_"+ed_sb_rw).val();var tcuv=$("#elem_procUnits_"+ed_sb_rw).val();var tcm1v=$("#elem_modCode_"+ed_sb_rw+"_1").val();var tcm1t=$("#elem_modCode_"+ed_sb_rw+"_1").attr("title");var tcm2v=$("#elem_modCode_"+ed_sb_rw+"_2").val();var tcm2t=$("#elem_modCode_"+ed_sb_rw+"_2").attr("title");var tcm3v=$("#elem_modCode_"+ed_sb_rw+"_3").val();var tcm3t=$("#elem_modCode_"+ed_sb_rw+"_3").attr("title");var tcm4v=$("#elem_modCode_"+ed_sb_rw+"_4").val();var tcm4t=$("#elem_modCode_"+ed_sb_rw+"_4").attr("title");var tcdxv=""+fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'val');var tcdxt=""+fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'title');$("#elem_cptCode_"+ed_sb_rw).val($("#elem_cptCode_"+st_sb_rw).val());$("#elem_cptCode_"+ed_sb_rw).attr("title",$("#elem_cptCode_"+st_sb_rw).attr("title"));$("#elem_cptCode_"+ed_sb_rw).attr("valid_dxcodes",$("#elem_cptCode_"+st_sb_rw).attr("valid_dxcodes"));$("#elem_procedureId_"+ed_sb_rw).val($("#elem_procedureId_"+st_sb_rw).val());$("#elem_procedureOrder_"+ed_sb_rw).val($("#elem_procedureOrder_"+st_sb_rw).val());$("#elem_procUnits_"+ed_sb_rw).val($("#elem_procUnits_"+st_sb_rw).val());$("#elem_modCode_"+ed_sb_rw+"_1").val($("#elem_modCode_"+st_sb_rw+"_1").val());$("#elem_modCode_"+ed_sb_rw+"_1").attr("title",$("#elem_modCode_"+st_sb_rw+"_1").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_2").val($("#elem_modCode_"+st_sb_rw+"_2").val());$("#elem_modCode_"+ed_sb_rw+"_2").attr("title",$("#elem_modCode_"+st_sb_rw+"_2").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_3").val($("#elem_modCode_"+st_sb_rw+"_3").val());$("#elem_modCode_"+ed_sb_rw+"_3").attr("title",$("#elem_modCode_"+st_sb_rw+"_3").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_4").val($("#elem_modCode_"+st_sb_rw+"_4").val());$("#elem_modCode_"+ed_sb_rw+"_4").attr("title",$("#elem_modCode_"+st_sb_rw+"_4").attr("title"));var scdxv=""+fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'val');var scdxt=""+fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'title');fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'select',scdxv,scdxt);$("#elem_cptCode_"+st_sb_rw).val(tcv);$("#elem_cptCode_"+st_sb_rw).attr("title",tct);renew_title("#elem_cptCode_"+st_sb_rw,tct);$("#elem_cptCode_"+st_sb_rw).attr("valid_dxcodes",tcvd);$("#elem_procedureId_"+st_sb_rw).val(tcpv);$("#elem_procedureOrder_"+st_sb_rw).val(tcov);$("#elem_procUnits_"+st_sb_rw).val(tcuv);$("#elem_modCode_"+st_sb_rw+"_1").val(tcm1v);$("#elem_modCode_"+st_sb_rw+"_1").attr("title",tcm1t);renew_title("#elem_modCode_"+st_sb_rw+"_1",tcm1t);$("#elem_modCode_"+st_sb_rw+"_2").val(tcm2v);$("#elem_modCode_"+st_sb_rw+"_2").attr("title",tcm2t);renew_title("#elem_modCode_"+st_sb_rw+"_2",tcm2t);$("#elem_modCode_"+st_sb_rw+"_3").val(tcm3v);$("#elem_modCode_"+st_sb_rw+"_3").attr("title",tcm3t);renew_title("#elem_modCode_"+st_sb_rw+"_3",tcm3t);$("#elem_modCode_"+st_sb_rw+"_4").val(tcm4v);$("#elem_modCode_"+st_sb_rw+"_4").attr("title",tcm4t);renew_title("#elem_modCode_"+st_sb_rw+"_4",tcm4t);fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'select',tcdxv,tcdxt);getMxSB();st_sb_rw=ed_sb_rw=0;}}else{var num=parseInt($(obj).html());if(st_sb_dx==0){st_sb_dx=num;obj.style.color="red";return;}else{ed_sb_dx=num;}
if((st_sb_dx!=0)&&(ed_sb_dx!=0)){$("#tblSBDX tr").each(function(i){$(this).find("th").css({"color":"black"});});var tv=$("#elem_dxCode_"+ed_sb_dx).val();var tt=$("#elem_dxCode_"+ed_sb_dx).attr("title");var tlv=$("#lit_diagText_"+ed_sb_dx).val();var tdocv=$("#dx_oldCode_"+ed_sb_dx).val();$("#elem_dxCode_"+ed_sb_dx).val($("#elem_dxCode_"+st_sb_dx).val());$("#elem_dxCode_"+ed_sb_dx).attr("title",$("#elem_dxCode_"+st_sb_dx).attr("title"));$("#lit_diagText_"+ed_sb_dx).val($("#lit_diagText_"+st_sb_dx).val());$("#dx_oldCode_"+ed_sb_dx).val($("#dx_oldCode_"+st_sb_dx).val());$("#elem_dxCode_"+st_sb_dx).val(tv);$("#elem_dxCode_"+st_sb_dx).attr("title",tt);renew_title("#elem_dxCode_"+st_sb_dx,tt);$("#lit_diagText_"+st_sb_dx).val(tlv);$("#dx_oldCode_"+st_sb_dx).val(tdocv);st_sb_dx=ed_sb_dx=0;}}}
function emptyFirstRowSB(){for(var i=1;i<=4;i++){if(i==1){var cptCode=gebi("elem_cptCode_"+i);var procid=gebi("elem_procedureId_"+i);var units=gebi("elem_procUnits_"+i);cptCode.value=cptCode.title="";procid.value="";units.value="1";sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+i,flgSetEmpty=1);renew_title(cptCode,"");}
if(i<=4){var mdCode=gebi("elem_modCode_1_"+i);mdCode.value="";}}}
function opRemAllCptRow(n){if(typeof(n)=="undefined")n=1;var tbl=gebi("tblSuperbill");if(!tbl)return;var lastRow=tbl.rows.length;for(var i=lastRow-1;i>=0;i--){if(i==0){emptyFirstRowSB();break;}else{tbl.deleteRow(i);}}
if(n>1){for(var i=1;i<n;i++){opAddCptRow("LASTINDX");}}
var objsbnr=getMxSB();}
function opRemCptRow(indx){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;var rIndx=getRealIndx(indx);if(typeof(indx)!="undefined"){var v=$("#elem_procedureId_"+indx).val();if(typeof(v)!="undefined"&&v!=""){var y=$("#elem_proc_del_id").val();if(y!=""){y+=",";}
$("#elem_proc_del_id").val(y+v);}}
if(indx>1){tbl.deleteRow(rIndx);}else{emptyFirstRowSB();}
var objsbnr=getMxSB();setSBTodayCharges();sb_reorder_srno();}
function getMxSB(flgAdd){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;var str="";var mx=0;var strCode="";var strUnit="";var tmpUnit="";var isCptElemVacant=1;var oCpt,flagLastRow=0;var checkId="";for(var i=0;i<lastRow;i++){var temp=tbl.rows[i];str+=""+temp.id+",";var id=temp.id.replace(/elem_trSB/,"");mx=(id>mx)?id:mx;var cptId=temp.id.replace(/elem_trSB/,"elem_cptCode_");var unitId=temp.id.replace(/elem_trSB/,"elem_procUnits_");oCpt=gebi(cptId);var oUnit=gebi(unitId);checkId+=id+", ";if(oCpt&&(typeof oCpt.value!="undefined")&&($.trim(oCpt.value)!="")){strCode+=(strCode!="")?","+oCpt.value:""+oCpt.value;tmpUnit=(oUnit&&(typeof oUnit.value!="undefined")&&($.trim(oUnit.value)!=""))?oUnit.value:1;strUnit+=(strUnit!="")?","+tmpUnit:""+tmpUnit;flagLastRow=i;var proOrdrId=temp.id.replace(/elem_trSB/,"elem_procedureOrder_");proOrdrId=gebi(proOrdrId);proOrdrId.value=(i+1);}else{flagLastRow=0;}}
lastRow=((typeof lastRow!="undefined"))?lastRow:4;mx=(mx>lastRow)?mx:lastRow;strCode=$.trim(strCode);strCode=strCode.replace(/,$/,"");strUnit=$.trim(strUnit);strUnit=strUnit.replace(/,$/,"");gebi("elem_mxSBId").value=mx;gebi("elem_procOrder").value=strCode;gebi("elem_procUnitOrder").value=strUnit;if(flgAdd==1&&flagLastRow!=0){if(sup_enc==1){opAddCptRow("LASTINDX",'','','',sup_enc);}else{opAddCptRow("LASTINDX");}}}
function checkChiefComplaintDetailed(){var ret="false";var c=getRvsDoneSt();if(c>=3){ret="true";}
return ret;}
var zChiefCompElemName="";function decideChiefComp(val){if(val=="1"){}else if(val=="0"){var oElem=gebi(zChiefCompElemName);if(oElem){oElem.value="";}}
zPqriElemName="";var objsbnr=getMxSB();setSBTodayCharges();}
function getCptDescJs(cptCode){var ret="";cptCode=$.trim(cptCode);if((cptCode!="")&&(typeof arrCptCodeDescActive[0]!="undefined")){for(var x in arrCptCodeDescActive[0]){if(arrCptCodeDescActive[0][x]==cptCode){ret=x;break;}}}
return ret;}
var sb_cw4WD_flgnoalert="";function sb_checknwarn4WrongDxcode(obj){var flgnoalert=sb_cw4WD_flgnoalert;if(typeof(flgnoalert)=="undefined"||flgnoalert==""){flgnoalert=0;}
var v_icd_10=$("#hid_icd10").val();var indx=obj.id.replace(/elem_cptCode_|elem_dxCodeAssoc_/g,"");var valid_dxCode="",cur_dxCode="";if(obj.id.indexOf("elem_cptCode_")!=-1){var proc_code=$.trim(""+obj.value);valid_dxCode=obj.getAttribute("valid_dxcodes");cur_dxCode=""+fun_mselect("#elem_dxCodeAssoc_"+indx,'val');}else{var proc_code=$("#elem_cptCode_"+indx).val();valid_dxCode=$("#elem_cptCode_"+indx).attr("valid_dxcodes");cur_dxCode=""+fun_mselect(obj,'val');}
if(typeof(valid_dxCode)!="undefined"){valid_dxCode=""+valid_dxCode;}
if(typeof(proc_code)!="undefined"){proc_code=""+proc_code;}
if(proc_code==""){var strtitle="";$("#elem_dxCodeAssoc_"+indx).find('option').each(function(){if(cur_dxCode.indexOf(""+$(this).val())!=-1){strtitle+=this.text+" - "+$(this).data("desc")+"\n";}});fun_mselect("#elem_dxCodeAssoc_"+indx,"settitle",strtitle);return;}
if(v_icd_10=="1"){if(valid_dxCode&&valid_dxCode!="null"&&valid_dxCode!=""&&typeof(valid_dxCode)!="undefined"&&cur_dxCode&&cur_dxCode!="null"&&typeof(cur_dxCode)!="undefined"&&cur_dxCode!=""){var ar_valid_dxCode=valid_dxCode.toLowerCase().split(",");var ar_cur_dxCode=cur_dxCode.split(",");var ar_wrong_dx=[];if(ar_cur_dxCode.length>0&&valid_dxCode.length>0){for(var x in ar_cur_dxCode){var tmp=$.trim(ar_cur_dxCode[x]);if(tmp=="")continue;var arr_tmp=tmp.split("**");if(arr_tmp[0]&&""+arr_tmp[0]!=""){arr_tmp[0]=$.trim(""+arr_tmp[0]).toLowerCase();if(ar_valid_dxCode.indexOf(""+arr_tmp[0])==-1){if(v_icd_10=="1"){var q1=""+arr_tmp[0].slice(0,-1)+"-";var q2=""+arr_tmp[0].slice(0,-2)+"--";var q3=""+arr_tmp[0].slice(0,-3)+"-x-";if(ar_valid_dxCode.indexOf(""+q1)!=-1||ar_valid_dxCode.indexOf(""+q2)!=-1||ar_valid_dxCode.indexOf(""+q3)!=-1){continue;}}
ar_wrong_dx[ar_wrong_dx.length]=""+arr_tmp[0];fun_mselect("#elem_dxCodeAssoc_"+indx,"unselect",tmp);}}}}
if(ar_wrong_dx.length>0&&flgnoalert==0){var dx_alert=ar_wrong_dx.join();dx_alert=dx_alert.toUpperCase();top.fAlert("Dx code(s) "+dx_alert+" can not be applied for procedure "+proc_code+".");}}}
if(v_icd_10!="1"){var arcurdx=""+fun_mselect("#elem_dxCodeAssoc_"+indx,'val');if(arcurdx&&arcurdx!="null"&&arcurdx!=""){var tmp_arcurdx=arcurdx.split(",");var lm=4;if(tmp_arcurdx.length>lm){if(flgnoalert==0){top.fAlert("You cannot select more than 4 Dx codes for a procedure.");}
for(var x in tmp_arcurdx){var tmp=$.trim(tmp_arcurdx[x]);if(tmp=="")continue;var arr_tmp=tmp.split("**");if(arr_tmp[0]&&""+arr_tmp[0]!=""){if(x>=lm){fun_mselect("#elem_dxCodeAssoc_"+indx,"unselect",tmp);}}}}}}
sb_setDxCodeTitle($("#elem_dxCodeAssoc_"+indx)[0]);}
function sb_setDxCodeTitle(obj){var strtitle="";var cur_dxCode=""+fun_mselect(obj,'val');$(obj).find('option').each(function(){if(cur_dxCode.indexOf(""+$(this).val())!=-1){var tmp=(typeof($(this).data("desc"))!="undefined")?" - "+$(this).data("desc"):"";strtitle+=this.text+""+tmp+"\n";}});fun_mselect(obj,"settitle",strtitle);}
function sb_getProcId4del(){var flg=0;var str="";$("#superbill :hidden[name*=elem_procedureId_]").filter(function(){return this.value!=='';}).each(function(){if(str!=""){str+=",";}str+=""+this.value;});var s=$("#elem_proc_del_id").val();if(typeof(s)!="undefined"&&s!=""){if(str!=""){str+=",";}
str+=s;}
$("#elem_proc_del_id").val(str);}
var flgMultiVisitCodeShowOnce=[],flgcheckingMVC=0,flgMultiVisitCodeShowOnce_2=[];function checkCptCodesChart(obj,fOk){if(document.getElementById('tat_table'))return;var cptCd=$.trim(obj.value);var cptCdFull=$.trim(obj.value);if((obj.value!="")&&(cptCd.length>=2)){if(typeof fOk=="undefined"){var indx=cptCd.lastIndexOf("~!~");cptCd=(indx!=-1)?$.trim(cptCd.substring(0,indx)):cptCd;obj.value=cptCd;checkDB4Code(obj,"Cpt");return;}
if((typeof sb_testName=="undefined"||sb_testName=="")&&(typeof examName=="undefined"||examName!="Procedures")){var pTop=200;var pLeft=300;if(typeof gebi("elem_masterPtVisit")!="undefined"){var typeVisit=gebi("elem_masterPtVisit").value;}else{var typeVisit="";}
var cpt4cd=obj.getAttribute("cpt4code");var prcBillCd=$("#elem_practiceBillCode").val();if((prcBillCd=="992"&&((cpt4cd=="99205")||(cpt4cd=="99204")||(cpt4cd=="99203")||(cpt4cd=="99202")||(cpt4cd=="99201")||(cpt4cd=="99215")||(cpt4cd=="99214")||(cpt4cd=="99213")||(cpt4cd=="99212")||(cpt4cd=="99211")))||(cpt4cd=="92004")||(cpt4cd=="92002")||(cpt4cd=="92014")||(cpt4cd=="92012")){if(setVisitProcedure_nochk==1){setVisitProcedure_nochk=0;}else{obj.value="";decideLevelofService2_obj_id=obj.id;checkAssocPqri4All_checkvisitcode(cpt4cd);getMxSB();setSBTodayCharges();return;}}
if(($.trim(typeVisit).toUpperCase()=="FOLLOW-UP")&&((cpt4cd=="99205")||(cpt4cd=="99204")||(cpt4cd=="99203")||(cpt4cd=="99215")||(cpt4cd=="99214")||(cpt4cd=="99213")||(cpt4cd=="99245")||(cpt4cd=="99244")||(cpt4cd=="99243")||(cpt4cd=="92005")||(cpt4cd=="92004")||(cpt4cd=="92003")||(cpt4cd=="92015")||(cpt4cd=="92014")||(cpt4cd=="92013"))){var msgFollowUp="Visit Type is Follow-up.<br>Are you sure you want to code to next level?";if((obj.value!="")&&((cpt4cd=="99204")||(cpt4cd=="99205")||(cpt4cd=="99214")||(cpt4cd=="99215")||(cpt4cd=="99244")||(cpt4cd=="99245"))){var chkStr=checkChiefComplaintDetailed();if(chkStr=="false"){var msgFollowUp="1. You have not detailed minimum requirements of 4 points of the chief complaint<br>"+"2. Visit Type is Follow-up and you are coding to next level.<br>"+"Are you sure you would like to use the selected visit code? ";}}
zChiefCompElemName=obj.name;var title="Visit code comfirmation";var msg=""+msgFollowUp+"<BR>";var btn1="Yes";var btn2="No";var func="decideChiefComp";var oDiv;displayConfirmYesNo_v2(title,msg,btn1,btn2,func,0);}else if(($.trim(typeVisit).toUpperCase()=="CEE")&&((cpt4cd=="99201")||(cpt4cd=="99202")||(cpt4cd=="99203")||(cpt4cd=="99211")||(cpt4cd=="99212")||(cpt4cd=="99213")||(cpt4cd=="99241")||(cpt4cd=="99242")||(cpt4cd=="99243")||(cpt4cd=="92001")||(cpt4cd=="92002")||(cpt4cd=="92003")||(cpt4cd=="92011")||(cpt4cd=="92012")||(cpt4cd=="92013"))){}else{if((obj.value!="")&&((cpt4cd=="99204")||(cpt4cd=="99205")||(cpt4cd=="99214")||(cpt4cd=="99215")||(cpt4cd=="99244")||(cpt4cd=="99245"))){var chkStr=checkChiefComplaintDetailed();if(chkStr=="false"){zChiefCompElemName=obj.name;var msgPrompt="You have not detailed minimum requirements of 4 points of the chief complaint<br>"+"Are you sure you would like to use the selected visit code?";var title="Chief Complaint Requirement";var msg=""+msgPrompt+"<BR>";var btn1="Yes";var btn2="No";var func="decideChiefComp";var oDiv;displayConfirmYesNo_v2(title,msg,btn1,btn2,func,0);}}}
var tmp=chk_multi_visit_code_exist(obj);}
remif_multi_Ophtha_code_exist(obj);sb_checknwarn4WrongDxcode(obj);}else{obj.value=obj.title=obj.cpt4code="";obj.setAttribute("valid_dxcodes","");if($("#superbill .cptcode").filter(function(){return this.value!=='';}).length==0&&$("#superbill :hidden[name*=elem_procedureId_]").filter(function(){return this.value!=='';}).length>0){flg=confirm("You have removed all CPTs of this super bill ! Are you sure?");if(flg){sb_getProcId4del();}}}
var objsbnr=getMxSB(1);setSBTodayCharges();}
function chk_multi_visit_code_exist(obj){if(typeof(sb_multi_vst_cd_noalert)!="undefined"&&sb_multi_vst_cd_noalert==1){return true;}
if(obj.value!=""){var visit_code_arr=["92001","92011","92002","92012","92004","92014","99201","99202","99203","99204","99205","99241","99242","99243","99244","99245","99211","99212","99213","99214","99215"];var a=visit_code_arr.indexOf(obj.value);if(a!=-1){var cvc=0;var cvc_flg=0,cvc_flg_2=0;var strCptCodes="";var tmp_arCptCodes=[];$(".cptcode").each(function(){var tmp="";var tmp=$.trim($(this).attr("cpt4code"));if(typeof(tmp)=="undefined"||tmp==""){tmp=$.trim(this.value);}
if(tmp!=""){var a=visit_code_arr.indexOf(tmp);if(a!=-1){cvc=cvc+1;if(flgMultiVisitCodeShowOnce.indexOf(tmp+cvc)==-1){flgMultiVisitCodeShowOnce[flgMultiVisitCodeShowOnce.length]=tmp+cvc;cvc_flg=1;}
if(flgMultiVisitCodeShowOnce_2.indexOf(tmp+cvc)==-1){cvc_flg_2=1;if(strCptCodes!=""){strCptCodes+=",";}
strCptCodes+="'"+tmp+"'";tmp_arCptCodes[tmp_arCptCodes.length]=tmp;flgMultiVisitCodeShowOnce_2[flgMultiVisitCodeShowOnce_2.length]=tmp+cvc;}}}});if(cvc>=2&&cvc_flg==1){top.fAlert("Visit Code already exists for DOS "+$("#elem_dos").val());}else if(strCptCodes!=""&&cvc_flg_2==1){if(flgcheckingMVC==0){flgcheckingMVC=1;var url=zPath+"/chart_notes/requestHandler.php";var params="elem_formAction=checkMultiVisitCode";params+="&elem_strCptCodes="+strCptCodes;params+="&elem_superbillDOS="+$("#elem_dos").val();params+="&elem_encounterId="+$("#elem_masterEncounterId").val();$.get(url,params,function(data){if(data=="1"){top.fAlert("Visit Code already exists for DOS "+$("#elem_dos").val());}
flgcheckingMVC=0;});}}}}}
function has_ophtha_code(o){if($.trim(o.value)==""){return false;}
var code_arr=["92201","92202","92225","92226"];var obj4cd=$(o).attr("cpt4code");if(typeof(obj4cd)=="undefined"||obj4cd==""){obj4cd=$.trim(o.value);}
var a=code_arr.indexOf(obj4cd);return(a!=-1)?true:false;}
function chk_multi_Ophtha_code_exist(){var cvc=0,ret=false;$(".cptcode").each(function(){if(has_ophtha_code(this)){cvc=cvc+1;}});if(cvc>=2){ret=true;}
return ret;}
function remif_multi_Ophtha_code_exist(obj){if(has_ophtha_code(obj)){var res=chk_multi_Ophtha_code_exist();if(res==true){top.fAlert("Ophthalmoscopy Code already exists in this superbill!");obj.value=obj.title=obj.cpt4code="";}}}
function checkProcUnitsChart(obj){if(obj.name.indexOf("elem_procUnits_")!=-1){var n=$.trim(obj.value);obj.value=n;if((n=="")||!isFinite(n)||(n<=0)){top.fAlert("Units can not be less than zero.");obj.value="1";}
var idCpt=obj.name.replace(/elem_procUnits_/g,"elem_cptCode_");var oCpt=gebi(idCpt);if(oCpt&&($.trim(oCpt.value)!="")){var objsbnr=getMxSB();setSBTodayCharges();}}}
function show_asmt_site(obj,dx,fop){var ch=$(obj)[0].id;if(typeof(ch)=="undefined"||ch.indexOf("elem_assessment_dxcode")==-1){return;}
var op=0;if(typeof(fop)!='undefined'&&fop!=''){op=fop;}else{op=(typeof(dx)!='undefined'&&dx!=''&&dx.indexOf("-")==-1)?1:0;}
var indx=ch.replace(/elem_assessment_dxcode/,"");if(op==1){$("#el_amst_site"+indx).parent().removeClass("hidden");$("#elem_assessment"+indx).parent().removeClass("col-sm-12").addClass("col-sm-11");var s="";if($("#elem_apOu"+indx).prop("checked")){s="OU";}
else if($("#elem_apOd"+indx).prop("checked")){s="OD";}
else if($("#elem_apOs"+indx).prop("checked")){s="OS";}
$("#el_amst_site"+indx).val(""+s);}else{$("#el_amst_site"+indx).parent().addClass("hidden");$("#elem_assessment"+indx).parent().addClass("col-sm-12").removeClass("col-sm-11");$("#el_amst_site"+indx).val("");}}
function checkDXCodesChart(obj){if(document.getElementById('tat_table'))return;var dxCd=$.trim(obj.value);var icd10=$("#hid_icd10").val();if(icd10==1){if(dxCd==""){obj.title="";}}
var fOk=false;if((dxCd!="")&&(dxCd.length>=3)){if(dxCd.indexOf("-")==-1){$(obj).removeClass('mandatory');}else{}
checkDB4Code(obj,"Dx");}else{obj.value=obj.title="";$(obj).removeData("dxid");renew_title(obj,'');if(obj.id.indexOf("elem_dxCode")!=-1){sb_crt_dx_dropdown();}}}
function checkModCodesChart(obj){if(document.getElementById('tat_table'))return;var mdCd=$.trim(obj.value);var fOk=false;if((mdCd!="")&&(mdCd.length>=2)){checkDB4Code(obj,"Md");}else{obj.value="";setSBTodayCharges();}}
function checkSBDxCodeFilled(obj,num){var oDx=gebi("elem_dxCode_"+num);if(obj.checked==true){if(oDx){obj.checked=($.trim(oDx.value)!="")?true:false;}else{obj.checked=false;}}}
function insertExamsDoneSB(arrED){var mxSbId=gebi("elem_mxSBId").value;var eTblSb=$("#tblSuperbill").get(0);var lenArrED=arrED.length;var arrDxCodesNotUsed=new Array();for(var j=0;j<lenArrED;j++){if((typeof arrED[j]!="undefined")){var flag=true;var oRows=eTblSb.rows;var lenTbl=oRows.length;var cTryAgain=0;for(var b=0;b<lenTbl;b++){if(oRows[b]){var tCptId=oRows[b].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var cCpt=(oCpt)?$.trim(oCpt.value):null;if(oCpt&&(cCpt!="")&&(cCpt==arrED[j]["cpt"])){var tMdId=tCptId.replace(/elem_cptCode_/,"elem_modCode_");var curMd="",insrtMd="";for(var inMd=1;inMd<=4;inMd++){var oMd=gebi(tMdId+"_"+inMd);curMd+=((oMd)&&(typeof oMd.value!=""))?oMd.value:"";insrtMd+=(typeof arrED[j]["modifier"+inMd]!="undefined")?arrED[j]["modifier"+inMd]:"";}
var tUntId=tCptId.replace(/elem_cptCode_/,"elem_procUnits_");var curUnt="",insrtUnt="";var oUnt=gebi(tUntId);curUnt=((oUnt)&&(typeof oUnt.value!=""))?oUnt.value:"";insrtUnt=(typeof arrED[j]["units"]!="undefined")?arrED[j]["units"]:"";if(insrtMd==curMd&&curUnt==insrtUnt){if(cCpt=="92133"&&arrED[j]["norepeat"]==0){cTryAgain=cTryAgain+1;}else if(cCpt.indexOf("J")!=-1&&curMd=="JW"){}else{flag=false;break;}}}}}
if(cTryAgain>=2){flag=false;}
if(flag==true){var v_prc_o_visit=$("#elem_proc_only_visit").val();v_prc_o_visit=(typeof(v_prc_o_visit)!="undefined"&&v_prc_o_visit==1)?0:1;for(var k=v_prc_o_visit;k<lenTbl;k++){var rowId=oRows[k].id.replace(/elem_trSB/,"");var tCptId="elem_cptCode_"+rowId;var oCpt=gebi(tCptId);if(oCpt&&(($.trim(oCpt.value)==""))){oCpt.value=arrED[j]["cpt"];oCpt.title=arrED[j]["cptDesc"];if(typeof(arrED[j]["valid_dxcodes"])!="undefined"&&arrED[j]["valid_dxcodes"]!=""){oCpt.setAttribute("valid_dxcodes",""+arrED[j]["valid_dxcodes"]);}
var oMod=gebi("elem_modCode_"+(rowId)+"_1");if(oMod&&(typeof arrED[j]["modifier1"]!="undefined")){oMod.value=arrED[j]["modifier1"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_2");if(oMod&&(typeof arrED[j]["modifier2"]!="undefined")){oMod.value=arrED[j]["modifier2"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_3");if(oMod&&(typeof arrED[j]["modifier3"]!="undefined")){oMod.value=arrED[j]["modifier3"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_4");if(oMod&&(typeof arrED[j]["modifier4"]!="undefined")){oMod.value=arrED[j]["modifier4"];}
var ounits=gebi("elem_procUnits_"+(rowId));if(ounits&&(typeof arrED[j]["units"]!="undefined")){ounits.value=arrED[j]["units"];}
var dxcntr=1;while(true){if(typeof(arrED[j]["dx"+dxcntr])!="undefined"){var indEmptyDxCd=null;var flgSet=false;for(var d=1;d<=12;d++){var oDx=gebi("elem_dxCode_"+d);if(oDx&&($.trim(oDx.value)!="")){var tdx=$.trim(oDx.value);var tdxId=$(oDx).data("dxid");if(typeof tdxId=="undefined"){tdxId="";}
var tdx1=tdx,tdx2=tdx,tdx3=tdx;if(arrED[j]["dx"+dxcntr].indexOf("-")!=-1){var tdx1=""+tdx.slice(0,-1)+"-";var tdx2=""+tdx.slice(0,-2)+"--";var tdx3=""+tdx.slice(0,-3)+"-x-";}
if(tdx==arrED[j]["dx"+dxcntr]||tdx1==arrED[j]["dx"+dxcntr]||tdx2==arrED[j]["dx"+dxcntr]||tdx3==arrED[j]["dx"+dxcntr]){var flgDxIdNM=1;if(tdxId!=""&&typeof arrED[j]["dx"+dxcntr+"Id"]!="undefined"&&$.trim(arrED[j]["dx"+dxcntr+"Id"])!=$.trim(tdxId)){flgDxIdNM=0;}
var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDxElem&&flgDxIdNM==1){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["dx"+dxcntr]));flgSet=true;break;}}}else if(oDx&&($.trim(oDx.value)=="")&&(indEmptyDxCd==null)){indEmptyDxCd=d;}}
if((flgSet==false)){if(indEmptyDxCd!=null){var oDx=gebi("elem_dxCode_"+indEmptyDxCd);var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDx){oDx.value=""+arrED[j]["dx"+dxcntr];var ttitle=(typeof arrED[j]["dx"+dxcntr+"Desc"]!="undefined")?""+arrED[j]["dx"+dxcntr+"Desc"]:"";renew_title(oDx,ttitle);var tdxid=(typeof arrED[j]["dx"+dxcntr+"Id"]!="undefined")?arrED[j]["dx"+dxcntr+"Id"]:"";$(oDx).data("dxid",tdxid);$(oDx).triggerHandler("blur");if(oDxElem){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["dx"+dxcntr]));flgSet=true;}}}else{var tmp=(typeof arrED[j]["dx"+dxcntr+"Desc"]!="undefined")?""+arrED[j]["dx"+dxcntr+"Desc"]:"";arrDxCodesNotUsed[arrDxCodesNotUsed.length]=new Array(arrED[j]["dx"+dxcntr],tmp);}}}else{break;}
dxcntr=dxcntr+1;if(dxcntr>50){break;}}
for(var ia=1;ia<=4;ia++){if(typeof arrED[j]["adx"+ia]!="undefined"&&arrED[j]["adx"+ia]!=""){for(var d=1;d<=12;d++){var oDx=gebi("elem_dxCode_"+d);if(oDx&&($.trim(oDx.value)!="")){var flgMtch=0;if($("#hid_icd10").val()=="1"){var p0=$.trim(""+arrED[j]["adx"+ia].toLowerCase());var q=q0=$.trim(""+oDx.value.toLowerCase());var q1=""+q0.slice(0,-1)+"-";var q2=""+q0.slice(0,-2)+"--";var q3=""+q0.slice(0,-3)+"-x-";if(q0==p0||q1==p0||q2==p0||q3==p0){flgMtch=1;}}else{if(($.trim(oDx.value)==arrED[j]["adx"+ia])){flgMtch=1;}}
if(flgMtch==1){var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDxElem){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["adx"+ia]));break;}}}}}}
if(sup_enc==1){opAddCptRow("LASTINDX",'','','',sup_enc);}else{opAddCptRow("LASTINDX");}
break;}}}}}
setSBTodayCharges();if(arrDxCodesNotUsed.length>0){}
var objsbnr=getMxSB(1);}
function getSelPQRICodes(actn){var oDiv=gebi("divChoosePqriCodes");if(actn==0){oDiv.style.display="none";return;}
var mxSbId=gebi("elem_mxSBId").value;var selectedCode=gebi("elem_procOrder").value;var oElems=oDiv.getElementsByTagName("INPUT");var len=oElems.length;var arrChoosenPqri=new Array();for(var i=0;i<len;i++){if((oElems[i].type=="checkbox")&&(oElems[i].checked==true)){var tmpCode=oElems[i].value;var tmpDx=oElems[i].getAttribute("dx");if(selectedCode.indexOf(tmpCode)==-1){arrChoosenPqri[arrChoosenPqri.length]=[tmpCode,tmpDx];}}}
oDiv.style.display="none";if(arrChoosenPqri.length>0){for(var x in arrChoosenPqri){var cpt=arrChoosenPqri[x][0];var dx=arrChoosenPqri[x][1];var tmpDesc=getCptDescJs(cpt);var oVal={"cptCode":cpt,"procId":"","units":1,"arrDx":[dx],"arrMd":new Array(),"cptDesc":tmpDesc};if(sup_enc==1){opAddCptRow(1,oVal,1,'',sup_enc);}else{opAddCptRow(1,oVal,1);}}}
var objsbnr=getMxSB(1);}
var setVisitProcedure_nochk=0;function setVisitProcedure(ccode)
{var mxSbId=gebi("elem_mxSBId").value;if(!isVisitCodeUsed(ccode)){return;}
var arrED=new Array();var arrtemp=new Array();arrtemp["cpt"]=ccode;arrED[arrED.length]=arrtemp;var cFlag=false;var eTblSb=gebi("tblSuperbill");var oRows=eTblSb.rows;var lenRows=oRows.length;for(var i=0;i<lenRows;i++){if(typeof oRows[i].id=="undefined"||oRows[i].id==""){continue;}
var tCptId=oRows[i].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var sCpt=$.trim(oCpt.value);if((sCpt=="92001")||(sCpt=="92011")||(sCpt=="92002")||(sCpt=="92012")||(sCpt=="92004")||(sCpt=="92014")||(sCpt=="99201")||(sCpt=="99202")||(sCpt=="99203")||(sCpt=="99204")||(sCpt=="99205")||(sCpt=="99241")||(sCpt=="99242")||(sCpt=="99243")||(sCpt=="99244")||(sCpt=="99245")||(sCpt=="99211")||(sCpt=="99212")||(sCpt=="99213")||(sCpt=="99214")||(sCpt=="99215")){sCpt="";}
if(oCpt&&(sCpt=="")){oCpt.value=ccode;oCpt.title=getCptDescJs(ccode);cFlag=true;setVisitProcedure_nochk=1;if(typeof oCpt.onblur=="function"){oCpt.onblur();}
for(var j=1;j<=12;j++){var oEDx=gebi("elem_dxCode_"+j);if(oEDx.value!=""){if(sb_objRefraction.isRef==1&&sb_objRefraction.dxCode==oEDx.value){continue;}
var oT=gebi("elem_dxCodeAssoc_"+(i+1));if(oT){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(i+1),'',new Array(oEDx.value));}}}
break;}}
if(cFlag==false){var arrDx=new Array();for(var i=0;i<12;i++){var oEDx=gebi("elem_dxCode_"+(i+1));if(oEDx.value!=""){if(sb_objRefraction.isRef==1&&sb_objRefraction.dxCode==oEDx.value){continue;}
arrDx[arrDx.length]=""+oEDx.value;}}
var ccodeDesc=getCptDescJs(ccode);var oVal={"cptCode":ccode,"procId":"","units":1,"arrDx":arrDx,"arrMd":new Array(),"cptDesc":ccodeDesc};opAddCptRow(mxSbId,oVal);}}
var decodePatientCategory=1;function getPatientCategoryCode(str,pracbillcode)
{category=false;if((decodePatientCategory==1)&&(str!=null))
{switch(str)
{case"New":case"0":category="0";break;case"Establish":case"1":category="1";break;case"Consult":case"2":case"4":category="4";if(pracbillcode==920){var newpt=$("#elem_ptcategory_consult").val();category=1;if(newpt==0||newpt=="New"){category="0";}}
break;}}
return category;}
function decideNewPatient(obj)
{var val=obj.value;if($("input[type=checkbox][id*=el_sb_pt_type_]").length>0){$("input[type=checkbox][id*=el_sb_pt_type_]").each(function(inx){if(obj.checked&&this.value!=val&&this.checked){this.checked=false;}});var val=$(":checked[id*=el_sb_pt_type_]").val();if(typeof(val)=="undefined"||val==""){val="No_confirmed";}}
var ctop=top;if(top.fmain){ctop=top.fmain;}
var objCategory=gebi("elem_category");if((val=="1")||(val=="Yes")||(val=="Yes_confirmed"))
{objCategory.value="New";decodePatientCategory=1;}
else
{objCategory.value="Establish";decodePatientCategory=1;}
if((val=="Yes_confirmed")||(val=="No_confirmed")){$("#elem_flgIsPtNew").val(val);var oPBC=gebi("elem_practiceBillCode");var oComp=gebi("elem_levelComplexity");if((oComp&&oComp.value!="")||oPBC.value=="920"||$("#elem_post_op_visit").val()=="1"||$("#elem_proc_only_visit").val()=="1"){if(typeof(flg_checkAssocPqri4All_checkvisitcode)!="undefined"&&flg_checkAssocPqri4All_checkvisitcode!=0&&flg_checkAssocPqri4All_checkvisitcode!=""){checkAssocPqri4All_checkvisitcode(flg_checkAssocPqri4All_checkvisitcode);}else{checkAssocPqri4All();}}
return;}
if((val=="Yes")||(val=="No")){confirmVisitCode_v3();}else{confirmVisitCode_v2();}}
var decideLevelofService2_obj_id;function decideLevelofService2(val)
{if((val!="-1")&&($.trim(val)!="")&&($.trim(val)!="OK")){if(val=="Eye Code"){val=$(":checked[id*=lb_qlfy_lvl_code920]").eq(0).val();}else if(val=="EM Code"){val=$(":checked[id*=lb_qlfy_lvl_code992]").eq(0).val();}
setVisitCode(val,decideLevelofService2_obj_id);}
decideLevelofService2_obj_id="";$("#dialog-Mdc-cum-new-pt").remove();}
function getVisitCode()
{var objPracticeBillCode=gebi("elem_practiceBillCode");var objCategory=gebi("elem_category");var objLevelOfService=gebi("elem_levelOfService");var objVisitCode=gebi("elem_visitCode");var visitCode=category="";if(objCategory.value!=null&&objPracticeBillCode!=null)
{category=getPatientCategoryCode(objCategory.value,objPracticeBillCode.value);}
if(objPracticeBillCode&&objCategory&&objLevelOfService&&objVisitCode)
{visitCode=objPracticeBillCode.value+category+objLevelOfService.value;}
var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var iscodeOk=visitCode.match(reg);return(iscodeOk)?visitCode:false;}
function setVisitCode(val,flg_chk_mlti){var objVisitCode=gebi("elem_visitCode");var vCode=(typeof val!="undefined")?val:false;if(vCode!=false){if(typeof(flg_chk_mlti)!="undefined"&&flg_chk_mlti!=""){setVisitProcedure_nochk=1;checkDB4Code_chk_versions=1;$("#"+flg_chk_mlti).val(vCode).triggerHandler("blur");}
else{checkDB4Code_chk_versions=1;objVisitCode.value=vCode;objVisitCode.onchange();}
var objsbnr=getMxSB();setSBTodayCharges();fun_mselect('.selectpicker','width');}}
function isVisitCodeUsed(cCd){if(typeof(sb_multi_vst_cd_noalert)!="undefined"&&sb_multi_vst_cd_noalert==1){return true;}
var selectedCode=gebi("elem_procOrder").value;if(selectedCode.indexOf(cCd)!=-1)
{top.fAlert("CPT Code "+cCd+" is already selected.");return false;}
return true;}
function setVisitCodeFinal(objElem)
{var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var matched=objElem.value.match(reg);if(matched)
{if(isVisitCodeUsed(objElem.value)){setVisitProcedure(objElem.value);}}else if(objElem.value==sb_cpt_code_poe){setVisitProcedure(objElem.value);}}
function getWantedDxCodes(flgnw){var oDivDxCode=gebi("divChooseDxCodes");var oElem=oDivDxCode.getElementsByTagName("INPUT");var len=oElem.length;var strdx="",dsc_tmp="";var arr=new Array(),arr_id=new Array();for(i=0;i<len;i++){if(oElem[i].name.indexOf("Lat")!=-1||oElem[i].name.indexOf("Svr")!=-1||oElem[i].name.indexOf("Stg")!=-1){continue;}
var t_dxid=$.trim($(oElem[i]).data("dxid"));if(typeof(t_dxid)=="undefined"||t_dxid==""){t_dxid="";}
if((oElem[i].type=="checkbox")&&(oElem[i].checked==true)){if(($.trim(oElem[i].value)!=""&&(arr.indexOf(oElem[i].value)==-1||(t_dxid!=""&&arr_id.indexOf(t_dxid)==-1)))&&$(oElem[i]).parents("tr").css("display")!="none"){arr[arr.length]=oElem[i].value;arr_id[arr_id.length]=t_dxid;}}else if((oElem[i].type=="text")&&(oElem[i].value!="")){if(arr.indexOf(oElem[i].value)==-1||(t_dxid!=""&&arr_id.indexOf(t_dxid)==-1)){arr[arr.length]=oElem[i].value;arr_id[arr_id.length]=t_dxid;}}}
if(arr.length>12){top.fAlert("You can choose maximum twelve dx codes.");}else{for(var i=0,j=0;j<12;j++){var oDxCode=gebi("elem_dxCode_"+(i+1));var tmp=((typeof arr[j]!="undefined"))?$.trim(arr[j]):"";var tmp_dxid=((typeof arr_id[j]!="undefined"))?$.trim(arr_id[j]):"";if((oDxCode)&&(($.trim(oDxCode.value)=="")||(typeof oDxCode.value=="undefined"))&&((typeof tmp!="undefined")&&(tmp!=""))){dx_exist=0;$("input[name^='elem_dxCode_']").each(function(index,element){if($(this).val()!=""&&$(this).val()==tmp&&$(this).data("dxid")==tmp_dxid){dx_exist=1;}});if(dx_exist==0){oDxCode.value=tmp;$(oDxCode).data("dxid",tmp_dxid);if(strdx!=""){strdx+=",";}
strdx+=tmp;i++;}}else{}}
oDivDxCode.style.display="none";setTimeout(function(){set_dx_code_titles();},100);if(typeof(flgnw)!="undefined"&&flgnw=="get_proc_dx_codes"){ogetprocdxcodes.dx=strdx.split(",");fill_codes_in_proc_sb(ogetprocdxcodes);}else{checkAssocPqri4All();}}}
function isSuperBillMade(){var SBill=false;var DXCodeOK=false;var DXCodeAssocOK=true;var CptNotAssoc="";var DXCodeComplete=true;var dxids="";var c_ophth_cd=0;var tbl=$("#tblSuperbill").get(0);if(tbl){var len=(gebi("elem_mxSBId"))?gebi("elem_mxSBId").value:0;var lastRow=(tbl.length>0)?tbl.rows.length:0;len=(typeof len=="undefined")?0:len;for(var i=0;i<len;i++){var tmp=gebi("elem_trSB"+(i+1));if(tmp==null){continue;}
var temp=gebi("elem_cptCode_"+(i+1));if(($.trim(temp.value)!="")){SBill=true;var tempAssoc=false;var elemDxAssoc=$("#elem_dxCodeAssoc_"+(i+1));var valDxAssoc=""+fun_mselect("#elem_dxCodeAssoc_"+(i+1),'val');if(valDxAssoc!=null&&typeof(valDxAssoc)!="undefined"&&$.trim(valDxAssoc)!=""&&valDxAssoc.indexOf("-")==-1){tempAssoc=true;}
if(tempAssoc==false){DXCodeAssocOK=false;CptNotAssoc+="\n\t-"+temp.value+"";}
if(has_ophtha_code(temp)){c_ophth_cd=c_ophth_cd+1;}}}
if(SBill==true){for(var i=0;i<12;i++){var oDxCode=$("#elem_dxCode_"+(i+1));var t=$.trim(oDxCode.val());var tdx="";if((t!="")){DXCodeOK=true;if(t.indexOf("-")!=-1){DXCodeComplete=false;}
var dxid=oDxCode.data("dxid");if(typeof(dxid)!="undefined"&&dxid!=""){tdx=dxid;}}
dxids=dxids+""+tdx+";";}}
var mul_ophth_cd=(c_ophth_cd>=2)?true:false;}
return{"SBill":SBill,"DXCodeOK":DXCodeOK,"DXCodeAssocOK":DXCodeAssocOK,"CptNotAssoc":CptNotAssoc,"DXCodeComplete":DXCodeComplete,"dxids":dxids,"mul_ophth_cd":mul_ophth_cd};}
function promptMedDecCom(opSB){var flg=0;if(opSB=="1"){flg=1;}
var oPrnt=top.fmain;var strPrnt="top.fmain";if(typeof(wpage)!="undefined"&&wpage=="accSB"){oPrnt=top;strPrnt="top";}
var msg=""+"<label style=\"width:250px;display:inline-block;\"><b>Medical Decision Complexity :</b> </label>"+"<div id=\"divmdc\" style=\"\">"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Strght\" value=\"1\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Strght\" >Straight Forward</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Low\" value=\"2\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Low\" >Low Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Moderate\" value=\"3\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Moderate\" >Moderate Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_High\" value=\"4\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_High\" >High Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_procovisit\" value=\"5\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_procovisit\" >Procedure only Visit</label><br/>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_postopvisit\" value=\"6\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_postopvisit\" style=\"float:right;margin-top:10px;\" >Post Op Visit</label>"+"</div>"+"";return""+msg;}
function sb_check_dx_in_icd10(str_n,str_h){flgMtch=0;if($("#hid_icd10").val()=="1"){var p0=$.trim(""+str_n.toLowerCase());var q=q0=$.trim(""+str_h.toLowerCase());var q1=""+q0.slice(0,-1)+"-";var q2=""+q0.slice(0,-2)+"--";var q3=""+q0.slice(0,-3)+"-x-";var p1=""+p0.slice(0,-1)+"-";var p2=""+p0.slice(0,-2)+"--";var p3=""+p0.slice(0,-3)+"-x-";if(q0==p0||q1==p0||q2==p0||q3==p0||q0==p1||q0==p2||q0==p3){flgMtch=1;}
else if(q0.indexOf(p0)!=-1||q1.indexOf(p0)!=-1||q2.indexOf(p0)!=-1||q3.indexOf(p0)!=-1||p0.indexOf(q0)!=-1||p1.indexOf(q0)!=-1||p2.indexOf(q0)!=-1||p3.indexOf(q0)!=-1){flgMtch=1;}}
return flgMtch;}
function sb_crt_dx_dropdown(objid,flgSetEmpty,arrmoresel,olddx){var all_rec=new Array;var all_rec_title=new Array;var all_rec_old=new Array;var all_rec_id=new Array;var ptrnChckd=".dxallcodes[id*=elem_dxCode_]";$(""+ptrnChckd).each(function(){if($(this).val()!=""){all_rec.push($(this).val());var tdsc=$(this).attr("data-original-title");if(typeof(tdsc)=="undefined"||$.trim(tdsc)==""){tdsc=$(this).attr("title");if(typeof(tdsc)=="undefined"){tdsc="";}}
all_rec_title.push(tdsc);var tmpid=$(this).attr("id");var oldid=tmpid.replace("elem_dxCode","dx_oldCode");all_rec_old.push($("#"+oldid).val());var tdxid=$(this).data("dxid");if(typeof(tdxid)=="undefined"){tdxid="";}
all_rec_id.push(tdxid);}else{all_rec.push('');all_rec_title.push('');all_rec_old.push('');all_rec_id.push('');}});var txtRec="";var txtRecTitle="";var txtRecOld="";var txtRecId="";var all_rec_tmp=[];var all_rec_title_tmp=[];var all_rec_old_tmp=[];var all_rec_id_tmp=[];for(var s=0;s<12;s++){var tmpRec=$.trim(all_rec[s]);var tmpRecid=$.trim(all_rec_id[s]);var tmpRecTitle=$.trim(all_rec_title[s]);var tchk=tmpRec+tmpRecTitle+",";var tmpRecOld=$.trim(all_rec_old[s]);if(tmpRec!=""&&txtRec.indexOf(tchk)==-1){txtRec+=tchk;all_rec_tmp[s]=tmpRec;all_rec_id_tmp[s]=tmpRecid;all_rec_title_tmp[s]=tmpRecTitle;all_rec_old_tmp[s]=tmpRecOld;}}
all_rec=all_rec_tmp;all_rec_title=all_rec_title_tmp;all_rec_old=all_rec_old_tmp;all_rec_id=all_rec_id_tmp;var ptrn="select.diagText_all_css";if(typeof(objid)=="string"&&objid!=""){ptrn=objid;}
$(""+ptrn).each(function(){if(this.type!="select-multiple"){return true;}
var all_opt_data="";var dd_title="";if(flgSetEmpty!=1){var sel_val_arr=fun_mselect(this,'val');}
if(typeof(arrmoresel)!="undefined"&&arrmoresel!=""&&arrmoresel.length>0){if(typeof(sel_val_arr)=="undefined"||sel_val_arr==null||sel_val_arr==''){var sel_val_arr=[];}
sel_val_arr=sel_val_arr.concat(arrmoresel);}
if(typeof sel_val_arr!="undefined"&&sel_val_arr!=null&&sel_val_arr!=''){for(x in all_rec){if(all_rec[x]!=""){var sel_opt="";var yy=parseInt(x)+1;var chk_sel_rec=all_rec[x]+'**'+yy;var chk_sel_rec2=all_rec[x];if(typeof(olddx)!="undefined"&&olddx==1){var chk_sel_rec_old=all_rec_old[x]+'**'+yy;var chk_sel_rec2_old=all_rec_old[x];if($.inArray(chk_sel_rec_old,sel_val_arr)!=-1||$.inArray(chk_sel_rec2_old,sel_val_arr)!=-1){sel_opt="selected";}}else{if($.inArray(chk_sel_rec,sel_val_arr)!=-1||$.inArray(chk_sel_rec2,sel_val_arr)!=-1){sel_opt="selected";}else{for(var cc in sel_val_arr){var str_n=""+sel_val_arr[cc].split("**")[0];if(sb_check_dx_in_icd10(str_n,chk_sel_rec2)){sel_opt="selected";}}}}
var chk_title=all_rec_title[x];if(typeof(chk_title)=="undefined"){chk_title="";}
if(sel_opt=="selected"){dd_title+=""+all_rec[x]+" - "+chk_title+"\n";}
all_opt_data+='<option value="'+chk_sel_rec+'" '+sel_opt+' data-desc="'+chk_title+'"  >'+all_rec[x]+'</option>';}}}else{for(x in all_rec){if(all_rec[x]!=""){var yy=parseInt(x)+1;var chk_title=all_rec_title[x];if(typeof(chk_title)=="undefined"){chk_title="";}
all_opt_data+='<option value="'+all_rec[x]+'**'+yy+'" data-desc="'+chk_title+'" >'+all_rec[x]+'</option>';}}}
var tmpid=$(this).attr("id");$("#"+tmpid).attr("title",dd_title).attr("data-original-title",dd_title).html(all_opt_data);fun_mselect("#"+tmpid,'refresh');if(dd_title==""){fun_mselect("#"+tmpid,'settitle','');}});fun_mselect('.selectpicker','width');}
function sb_set_dx_typeahead_icd10(action){getDataFilePath="../common/getICD10data.php";for(var j=1;j<=12;j++){if(document.getElementById('enc_icd10').value==1){bind_autocomp($("#elem_dxCode_"+j),getDataFilePath);$('.diagText_span_'+j).css({"display":"table-cell"});}}}
function sb_copy_dx_codes(flgfrst){sb_cw4WD_flgnoalert=1;var copyvalues=[];$(".cptcode").each(function(){var id=this.id;var val=$.trim(this.value);var indx=id.replace("elem_cptCode_","");if(indx=="1"){copyvalues=fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'val');if(typeof(flgfrst)!="undefined"&&flgfrst==1){copyvalues.length=1;}}else{if(val==""){}else{if(copyvalues.length>0){fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'select',copyvalues);}}
fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'render');}
sb_checknwarn4WrongDxcode(this);});fun_mselect('.selectpicker','width');sb_cw4WD_flgnoalert="";}
function icd10_charts_popup(show_pop,obj,str,input_id){var str_val=(str.toLowerCase()).replace(">>","");if(show_pop==1){if(js_icd10_charts_data_arr){if($("#dialog-msg-charts").length<=0){$("body").append(js_icd10_charts_data_arr[str_val]);}
if(str_val=='congenital'){var wid=815;}else{var wid=500;}
$("#dialog-msg-charts").show().dialog({modal:true,width:wid,buttons:{Done:function(){icd10_charts_popup(0,'','',input_id);},Cancel:function(){$(this).dialog("destroy");$("#dialog-msg-charts").remove();}}});}}else{if(obj.id){var charts_chk_box_id=obj.id;if(($('#dialog-msg-heading').val()).toLowerCase()=="congenital"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_cong").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}else{if(obj.value.toLowerCase()=="unspecified"){if($('#'+charts_chk_box_id).is(':checked')==true){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"gray","font-weight":"normal"}).removeClass("highlight");this.checked=false;});}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else if(obj.value.toLowerCase()=="alternating"){if($('#'+charts_chk_box_id).is(':checked')==true){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});$(".alternating_css").each(function(){$('label[for='+this.id+']').css({"color":"gray","font-weight":"normal"}).removeClass("highlight");this.checked=false;});}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else{if($('#elem_sub_unspecified').is(':checked')==true){if(obj.value.toLowerCase()!="monocular"&&obj.value.toLowerCase()!="alternating"){$(".unspecified_css").each(function(){this.checked=false;});return;}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else if($('#elem_sub_alternating').is(':checked')==true){if(obj.value.toLowerCase()=="left"||obj.value.toLowerCase()=="right"){$(".alternating_css").each(function(){this.checked=false;});return;}else{if(obj.value.toLowerCase()=="monocular"){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}}}
if(obj.value.toLowerCase()=="unspecified"||obj.value.toLowerCase()=="monocular"||obj.value.toLowerCase()=="alternating"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts1").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
if(obj.value.toLowerCase()=="a"||obj.value.toLowerCase()=="v"||obj.value.toLowerCase()=="intermittent"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts2").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
if(obj.value.toLowerCase()=="right"||obj.value.toLowerCase()=="left"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts3").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}}}else{var charts_val1="";var charts_val2="";var charts_val3="";var main_charts_val=$('#dialog-msg-heading').val();main_charts_val=main_charts_val.toLowerCase();if(main_charts_val=="congenital"){var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var ass_dx_id="elem_assessment_dxcode"+full_ass_id;$(".elem_sub_cong").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){var charts_val_ass_dx=$('#'+charts_chk_box_id).val();var charts_val_ass=$('#'+charts_chk_box_id+"_desc").val();$('#'+ass_id).val(charts_val_ass);$('#'+ass_dx_id).val(charts_val_ass_dx);$("#dialog-msg-charts").remove();return;}});}else{var selected_opt_arr=new Array();var arr_i=0;selected_opt_arr[arr_i]=main_charts_val;$(".elem_sub_charts1").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val1=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val1;}});$(".elem_sub_charts2").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val2=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val2;}});$(".elem_sub_charts3").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val3=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val3;}});for(var j=0;j<=js_icd10_charts_all_data_arr[main_charts_val].length;j++){var dx_flag_cont=0;if(typeof(js_icd10_charts_all_data_arr[main_charts_val][j])!="undefined"){var dx_org_val=js_icd10_charts_all_data_arr[main_charts_val][j].split('>>>');}else{var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var v=$("#"+ass_id).val();if(typeof(v)=="undefined"){v="";}
if(v!=""){v=v.replace(/>/g,'');$("#"+ass_id).val(v);}
$("#dialog-msg-charts").remove();return;}
var dx_org_val=js_icd10_charts_all_data_arr[main_charts_val][j].split('>>>');var dx_org_val_desc_spt=dx_org_val[0].split(',');var dx_org_val_desc="";for(var g=0;g<dx_org_val_desc_spt.length;g++){dx_org_val_desc+=dx_org_val_desc_spt[g];}
var dx_org_val_desc_exp=dx_org_val_desc.split(' ');if(dx_org_val[1]!=""){var dx_org_val_code=dx_org_val[1];for(var k=0;k<=dx_org_val_desc_exp.length;k++){var dx_org_val_desc_exp_final=dx_org_val_desc_exp[k];for(var l=0;l<selected_opt_arr.length;l++){if(selected_opt_arr[l]!=""){if(selected_opt_arr[l]==dx_org_val_desc_exp_final){dx_flag_cont=parseInt(dx_flag_cont)+1;}}}}}
if(selected_opt_arr.length==dx_flag_cont){var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var ass_dx_id="elem_assessment_dxcode"+full_ass_id;var elem_sub_ass_comm="";if($('#elem_sub_ass_comm').val()!=""){elem_sub_ass_comm=" ; \n"+$('#elem_sub_ass_comm').val();}
$('#'+ass_id).val(dx_org_val[0]+elem_sub_ass_comm);$('#'+ass_dx_id).val(dx_org_val_code);$("#dialog-msg-charts").remove();$("#"+ass_id).triggerHandler("click");$("#"+ass_id).triggerHandler("blur");$("#"+ass_id).triggerHandler("change");$("#"+ass_id).triggerHandler("keyup");return;}}}}}}
function isVisitCodeExits(){if(typeof(sb_cpt_code_poe)=="undefined"){sb_cpt_code_poe="";}
var allVisCd=["999",""+sb_cpt_code_poe,"92002","92012","92004","92014","99201","99202","99203","99204","99205","99211","99212","99213","99214","99215","99241","99242","99243","99244","99245","99024"];var ret=-1;var ln=$(".cptcode").length;for(var i=0;i<ln;i++){var v=$(".cptcode").eq(i).val();if(v!=""){if(allVisCd=="")continue;if(jQuery.inArray(v,allVisCd)!=-1){return 1;}else{ret=0;}}}
return ret;}
var set_multi_version_cpt_id;function set_multi_version_cpt(s){if(s==1&&typeof(set_multi_version_cpt_id)!="undefined"&&set_multi_version_cpt_id!=""){var x=$("#dialog-confirm :checked[name=el_multi_version_cpts]").val();if(typeof(x)!="undefined"&&x!=""){$("#"+set_multi_version_cpt_id).val(x).triggerHandler("blur");}}}
var checkDB4Code_flg=0;checkDB4Code_chk_versions="";function checkDB4Code(obj,str,type,cnfrm){if(cnfrm&&typeof(obj)=="string"){obj=document.getElementById(obj);}
if($.trim(obj.value).length==0||checkDB4Code_flg==1)
{return;}
var chk_versions=checkDB4Code_chk_versions;var type_chk=type;if(type_chk=="account"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode="diag1Text_";var elem_asDx="diag1Text_";}else if(type_chk=="superbill"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode=obj.name;var elem_asDx=obj.name;var elem_assessment_dxcode=obj.name;}else if(type_chk=="Procedures"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode=obj.name;var elem_asDx=obj.name;var elem_assessment_dxcode=obj.name;}else{var url=(typeof(wpage)!="undefined"&&wpage=="accSB")?zPath+"/chart_notes/requestHandler.php":zPath+"/chart_notes/requestHandler.php";var elem_dxCode="elem_dxCode_";var elem_asDx="elem_asDx";var elem_assessment_dxcode="elem_assessment_dxcode";}
var params={"elem_formAction":str,"elem_desc":encodeURI(obj.value),"check_versions":chk_versions};var icd10=($("#hid_icd10").length>0)?$("#hid_icd10").val():$("#enc_icd10").val();if(icd10==1){params.ICD10=1;}
if(typeof(setProcessImg)!='undefined')setProcessImg("1","tblSuperbill");if(checkDB4Code_flg==0){checkDB4Code_flg=1;}
if((obj.name.indexOf(elem_dxCode)==-1)&&(obj.name.indexOf(elem_asDx)==-1)&&(obj.name.indexOf(elem_assessment_dxcode)==-1)&&type_chk!="account"){$.post(url,params,function(data){checkDB4Code_chk_versions="";if(typeof(setProcessImg)!='undefined')setProcessImg("0","tblSuperbill");checkDB4Code_flg=0;var strTmp=data.code;strTmp=(strTmp)?$.trim(strTmp):"";if(strTmp!=""){if(str=="Cpt"&&data.all_version&&data.all_version.length>0){var msg="";for(var x in data.all_version){if(typeof(data.all_version[x])!="undefined"&&data.all_version[x]!=""){msg+="<div class=\"radio radio-inline\"><input type=\"radio\" name=\"el_multi_version_cpts\" id=\"el_multi_version_cpts"+x+"\" value=\""+data.all_version[x]+"\" ><label for=\"el_multi_version_cpts"+x+"\">"+data.all_version[x]+"</label></div>";}}
if(msg!=""){set_multi_version_cpt_id=obj.id;obj.value="";displayConfirmYesNo_v2("Multiple versions of CPT exists. Choose one.",""+msg,"Insert","","set_multi_version_cpt","",0);return;}}
obj.value=strTmp;if(data.desc)obj.title=data.desc;if(str=="Cpt"){if(data.units){var unitId=obj.name.replace(/elem_cptCode_/i,"elem_procUnits_");var tmp=$("#"+unitId).data("unit");if(typeof(tmp)!="undefined"&&tmp!=""){data.units=tmp;}
$("#"+unitId).val(""+data.units);}
var mId=obj.name.replace(/elem_cptCode_/i,"elem_modCode_");var tmod="";for(var m=1,n=0;m<=4;m++){var t=$.trim($("#"+mId+"_"+m).val());if(tmod.indexOf(t)!=-1){$("#"+mId+"_"+m).val("");}
if(data.mod&&data.mod[n]){if(typeof(t)=="undefined"||t==""){$("#"+mId+"_"+m).val(""+data.mod[n]);tmod+=""+data.mod[n]+",";n++;}else{if(t==data.mod[n]){tmod+=""+data.mod[n]+",";n++;}}}}
if(data.cpt4_code){obj.setAttribute("cpt4code",data.cpt4_code);}
if(data.dx_codes){obj.setAttribute("valid_dxcodes",data.dx_codes);}else{obj.setAttribute("valid_dxcodes","");}
checkCptCodesChart(obj,1);}else if(str=="Md"){setSBTodayCharges();}}else{if(typeof(cnfrm)=="undefined"){if(top.fmain){top.fancyConfirm("Entered Text Does not match with any code.<br />Do you want to use this?",'','','top.fmain.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
else{top.fancyConfirm("Entered Text Does not match with any code.<br />Do you want to use this?",'','','top.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
return;}
else{obj.value=obj.title=obj.cpt4code="";obj.setAttribute("valid_dxcodes","");}}},'json');}
else{var dxid=$(obj).data("dxid");if(typeof(dxid)!="undefined"){dxid=$.trim(dxid);if($.trim(dxid)!=""&&$.trim(dxid)!="0"){params.dxid=dxid;}}
$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","tblSuperbill");checkDB4Code_flg=0;var xmlDoc=data;var arrDxCode=xmlDoc.getElementsByTagName("dxcode");var arrDxCodeDesc=xmlDoc.getElementsByTagName("dxcodedesc");var arrPqriCode=xmlDoc.getElementsByTagName("pqri");var arrDxCode_multi=xmlDoc.getElementsByTagName("otherdxCodes_multi");var arrDxCode_incomp=xmlDoc.getElementsByTagName("incomplete");var oDxCode=(arrDxCode.length>0)?xmlDoc.getElementsByTagName("dxcode")[0]:null;var oDxCodeDesc=(arrDxCodeDesc.length>0)?xmlDoc.getElementsByTagName("dxcodedesc")[0]:null;var oPqriCode=(arrPqriCode.length>0)?xmlDoc.getElementsByTagName("pqri")[0]:null;var oDxCode_multi=(arrDxCode_multi.length>0)?xmlDoc.getElementsByTagName("otherdxCodes_multi")[0]:null;var oDxCode_incomp=(arrDxCode_incomp.length>0)?arrDxCode_incomp[0]:null;if((oDxCode)&&(oDxCode.firstChild)){var tDx=$.trim(oDxCode.firstChild.data);if(type_chk!="account"&&type_chk!="superbill"){if((obj.name.indexOf("elem_asDx")!=-1)||(obj.name.indexOf("elem_assessment_dxcode")!=-1)){if(oDxCode_multi&&oDxCode_multi.firstChild.data){tDx=oDxCode_multi.firstChild.data+", "+tDx;}
obj.value=""+tDx;if(obj.name.indexOf("elem_asDx")!=-1){var tmp=$(obj).data("asindx");if(typeof(tmp)!="undefined"&&tmp!=""){var as_dx_id=tmp;}else{var as_dx_id=obj.name.replace(/(elem_asDx)/g,"");as_dx_id=as_dx_id.replace("_0","");as_dx_id=parseInt(as_dx_id)+1;}
$("#elem_assessment_dxcode"+as_dx_id).val(""+tDx);}else{var op=$.trim(oDxCode_incomp.firstChild.data);op=(op=="1")?"0":"1";show_asmt_site(obj,'',op);}
return;}}
fExists=false;for(var i=1;i<=12;i++){var oDxChk=document.getElementById("elem_dxCode"+i);if((oDxChk)&&($.trim(tDx)!="")&&(oDxChk.value==tDx)){fExists=true;if(oDxCodeDesc.firstChild){if($.trim(oDxCodeDesc.firstChild.data)!=""){renew_title(oDxChk,""+oDxCodeDesc.firstChild.data);}}}}
if(fExists==false){obj.value=tDx;if(oDxCodeDesc.firstChild){if($.trim(oDxCodeDesc.firstChild.data)!=""){renew_title(obj,""+oDxCodeDesc.firstChild.data);}}}}else{if($.trim(obj.value).substr(-2,2)=='>>'){return;}
$(obj).removeData("dxid");renew_title(obj,"");if(typeof(cnfrm)=="undefined"){if(top.fmain){top.fancyConfirm("Entered Text Does not match with any DxCode.<br />Do you want to use this?",'','','top.fmain.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
else{top.fancyConfirm("Entered Text Does not match with any DxCode.<br />Do you want to use this?",'','','top.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}}
else{obj.value=obj.title="";}
return;}
if(obj.value!=""){var oPCodes=oPqriCode.childNodes;var len=oPCodes.length;var arrPqriCodes=new Array();var tmpCpt=[];for(var i=0;i<len;i++){if(oPCodes[i].firstChild){tmpCpt[tmpCpt.length]=oPCodes[i].firstChild.data;}}
if(tmpCpt.length>0){arrPqriCodes[obj.value]=tmpCpt;PqriSetter(arrPqriCodes);}}
sb_crt_dx_dropdown();},"xml");}}
function getRefInfoJs(giveonly){var arr=new Array();var len=$("#Vision #MR div[id*=row_mr_]").length;for(var i=1;i<=len;i++){var othr=(i>1)?"Other":"";var sfx=(i>2)?"_"+i:"";var ar1=new Array("elem_visMr"+othr+"OdS"+sfx,"elem_visMr"+othr+"OdC"+sfx,"elem_visMr"+othr+"OdA"+sfx,"elem_visMr"+othr+"OsS"+sfx,"elem_visMr"+othr+"OsC"+sfx,"elem_visMr"+othr+"OsA"+sfx,"elem_visMr"+othr+"OdAdd"+sfx,"elem_visMr"+othr+"OsAdd"+sfx,"elem_mrNoneGiven"+i);arr[arr.length]=ar1;}
var dx="";var flag=0;var eye="";for(var z in arr){var flg=isVisElemDone(arr[z]);if(flg){if(typeof(giveonly)!="undefined"&&giveonly=="1"){if($(":checked[name='"+arr[z][8]+"']").length<=0||!$(":checked[name='"+arr[z][8]+"']").hasClass("active")){continue;}}
flag=1;var add=gebi(arr[z][6]);var ads=gebi(arr[z][7]);var sd=gebi(arr[z][0]);var ss=gebi(arr[z][3]);if(eye==""){if(sd&&sd.value!=""){eye="OD";}
if(ss&&ss.value!=""){eye=(eye=="OD")?"OU":"OS";}}
if((add&&($.trim(add.value)!="")&&($.trim(add.value)!="+"))||(ads&&($.trim(ads.value)!="")&&($.trim(ads.value)!="+"))){dx="367.4";break;}else if((sd&&(sd.value!="-")&&(sd.value.indexOf("-")!=-1))||(ss&&(ss.value!="-")&&(ss.value.indexOf("-")!=-1))){dx="367.1";break;}else if((sd&&(sd.value!="+")&&(sd.value!=""))||(ss&&(ss.value!="+")&&(ss.value!=""))){dx="367.0";break;}}}
return{"flag":flag,"dx":dx,"eye":eye};}
function isAssessmentDone(){var lenAssess=$("#assessplan .planbox").length;for(var i=1;i<lenAssess;i++){var oAssess=gebi("elem_assessment"+i);if((oAssess)&&($.trim(oAssess.value)!="")){return true;}}
return false;}
function checkAssocPqri4All_getParam(cptcd){var params="elem_formAction=PQRI";params+="&elem_formId="+gebi("elem_masterId").value;for(var i=1,j=1;i<=12;i++,j++){var oDx=gebi("elem_dxCode_"+i);if(oDx&&(oDx.value!="")){params+="&elem_dxCode"+j+"="+oDx.value;}}
if(typeof getDCFA_strApId!="undefined"){params+="&elem_apid="+getDCFA_strApId;}
if($("#Vision").length>0){var oRefInfo=getRefInfoJs(sb_refGivenOnly);if(oRefInfo.flag==1){params+="&elem_refraction=1";params+="&elem_refractionDx="+oRefInfo.dx;params+="&elem_vision=1";params+="&elem_visionEye="+oRefInfo.eye;}else{var arrVisDis=new Array("elem_visDisOdSel1","elem_visDisOdSel2","elem_visDisOsSel1","elem_visDisOsSel2","elem_visDisOdTxt1","elem_visDisOdTxt2","elem_visDisOsTxt1","elem_visDisOsTxt2","elem_disDesc");var vis=(isVisElemDone(arrVisDis))?"1":"0";if(vis=="1"){params+="&elem_vision="+vis;params+="&elem_refraction=0";}else{params+="&elem_vision=0";params+="&elem_refraction=0";}}}else{params+="&elem_vision=db";params+="&elem_refraction=db";}
var oComp=gebi("elem_levelComplexity");if(oComp){var tmp=(typeof oComp.value!="undefined")?$.trim(oComp.value):"";params+="&elem_levelComplexity="+tmp;}
var opov=gebi("elem_proc_only_visit");if(opov){var tmp=(typeof opov.value!="undefined")?$.trim(opov.value):"";params+="&elem_proc_only_visit="+tmp;}
var opopv=gebi("elem_post_op_visit");if(opopv){var tmp=(typeof opopv.value!="undefined")?$.trim(opopv.value):"";params+="&elem_post_op_visit="+tmp;}
var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd){var tmp=(typeof oPrBillCd.value!="undefined")?$.trim(oPrBillCd.value):"";params+="&elem_practiceBillCode="+tmp;}
if(typeof getRvsDoneSt!="undefined"){var rvsSt=getRvsDoneSt();params+="&elem_rvs="+rvsSt;}else{params+="&elem_rvs=db";}
var oCCHx=gebi("elem_ccHx");var oCC=gebi("elem_ccompliant");if(oCCHx&&oCC){var strCCHx=oCC.value;var ptrn="\\s*A\\s*((\\d)+\\s*(years|months|days)\\s*old\\s*)?(Male|Female|male|female)\\s*with\\s*history\\s*of\\s*(\\r)?\\s*";strCCHx=regReplace(ptrn,"",strCCHx);if($.trim(strCCHx)==""&&oCCHx&&$.trim(oCCHx.value)!=""){strCCHx=regReplace(ptrn,"",oCCHx.value);}
params+="&elem_ccHx="+strCCHx;}else{params+="&elem_ccHx=db";}
if(typeof(isAssessmentDone)!="undefined"){var strAss=(isAssessmentDone())?"1":"0";params+="&elem_assessment="+strAss;}else{params+="&elem_assessment=db";}
var oNpsych=gebi("elem_neuroPsych");if(oNpsych){var strNpsych=($.trim(oNpsych.value)!="")?"1":"0";params+="&elem_neuroPsych="+strNpsych;}else{params+="&elem_neuroPsych=db";}
var oSBCaseId=gebi("elem_sb_insuranceCaseId");if(oSBCaseId&&(typeof oSBCaseId.value!="undefined")&&(oSBCaseId.value!="")&&(oSBCaseId.value!="0")){params+="&elem_insCaseId="+oSBCaseId.value;}else{var oMasterCaseId=gebi("elem_masterCaseId");if(oMasterCaseId&&(typeof oMasterCaseId.value!="undefined")){params+="&elem_insCaseId="+oMasterCaseId.value;}}
var oDOS=gebi("elem_dos");if(oDOS&&(typeof oDOS.value!="undefined")){params+="&elem_dos="+oDOS.value;}
var oPhyId=$("div.divsign :input[name*=elem_physicianId][value!=''][type!=text]");if(oPhyId&&oPhyId.length>0&&typeof(oPhyId.val())!="undefined"){params+="&elem_doctorId="+oPhyId.val();}
flgMergeSB=1;if(typeof(wpage)!="undefined"&&wpage=="accSB"){flgMergeSB=0;}
params+="&flgMergeSB="+flgMergeSB;var isnewpt=""+$("#elem_flgIsPtNew").val();params+="&elem_flgIsPtNew="+isnewpt;if($(":input[type=checkbox][id*=lb_qlfy_lvl_code]").length>0){var str_vc_check="";$(":checked[id*=lb_qlfy_lvl_code]").each(function(ini){str_vc_check+="&"+this.name+"="+this.value;});params+=str_vc_check;}else if(typeof(cptcd)!="undefined"&&cptcd!=""){var type_cpt="";if(cptcd.indexOf("992")!=-1){type_cpt="992";}else if(cptcd.indexOf("920")!=-1){type_cpt="920";}
if(type_cpt!=""){params+="&lb_qlfy_lvl_code"+type_cpt+"="+cptcd;}}
var v_icd10=""+$("#hid_icd10").val();params+="&elem_v_icd10="+v_icd10;return params;}
var flg_checkAssocPqri4All_checkvisitcode=0;function checkAssocPqri4All_checkvisitcode(cptcd){if(cptcd==""){return;}
if(cptcd.indexOf("920")!=-1){type_cpt="920";}else if(cptcd.indexOf("992")!=-1){type_cpt="992";}else{return;}
var isnewpt="Establish";if(typeof(cptcd)!="undefined"&&cptcd!=""){var isnewpt_t=cptcd.substr(-2,1);isnewpt=(isnewpt_t==0)?"Yes_confirmed":"No_confirmed";$("#elem_flgIsPtNew").val(isnewpt);}
flg_checkAssocPqri4All_checkvisitcode=cptcd;var prompt_msg="";if($("#elem_flgIsPtNew").val()=="New"){var ctop=top;var stop="top";if(top.fmain){ctop=top.fmain;stop="top.fmain";}
prompt_msg+="<label style=\"width:250px;display:inline-block;\"><b>Is this a New Patient?</b></label><div id=\"divisnwpt\">"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_new\" value=\"Yes_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_new\">Yes</label>"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_estb\" value=\"No_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_estb\">No</label></div>";}
var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if(oComp&&$.trim(oComp.value)==""&&(opov&&$.trim(opov.value)=="")&&(opopv&&$.trim(opopv.value)=="")){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\"  height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span  class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});return;}
var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var params=checkAssocPqri4All_getParam(cptcd);params+="&el_manual_insert_visitcode=1";if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var xmlDoc=data;var oAutoCode=xmlDoc.getElementsByTagName("autocode")[0];var oAutos=(oAutoCode!=null)?oAutoCode.childNodes:null;var lenAutos=(oAutos!=null)?oAutos.length:0;var ptcategory="";var practicebillcode="";var ptlevelhistory="";var ptlevelcomp="";var ptservicelevel="";var ptcategory_consult="";var pt_levelofservice_eye="";var pt_levelofservice_em="";var pt_strexamdone_eye="";var pt_strexamnotdone_eye="";var pt_strexamdone_em="";var pt_strexamnotdone_em="";var poe_visit_code="";var pls_sel_nq_em="",pls_sel_nq_eye="";for(var i=0;i<lenAutos;i++){var oData=oAutos[i];if(oData.firstChild){if(oData.nodeName=="ptcategory"){ptcategory=""+oData.firstChild.data;}else if(oData.nodeName=="practicebillcode"){practicebillcode=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelhistory"){ptlevelhistory=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelcomp"){ptlevelcomp=""+oData.firstChild.data;}else if(oData.nodeName=="ptservicelevel"){ptservicelevel=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_eye"){pt_levelofservice_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_em"){pt_levelofservice_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_eye"){pt_strexamdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_eye"){pt_strexamnotdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_em"){pt_strexamdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_em"){pt_strexamnotdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="poe_visit_code"){poe_visit_code=""+oData.firstChild.data;}else if(oData.nodeName=="ptcategory_consult"){ptcategory_consult=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_em"){pls_sel_nq_em=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_eye"){pls_sel_nq_eye=""+oData.firstChild.data;}}}
gebi("elem_category").value=ptcategory;gebi("elem_practiceBillCode").value=practicebillcode;gebi("elem_levelHistory").value=ptlevelhistory;gebi("elem_levelComplexity").value=ptlevelcomp;gebi("elem_levelOfService").value=ptservicelevel;gebi("elem_ptcategory_consult").value=ptcategory_consult;gebi("elem_levelOfServiceEye").value=pt_levelofservice_eye;gebi("elem_levelOfServiceEM").value=pt_levelofservice_em;gebi("elem_strExmDoneEye").value=pt_strexamdone_eye;gebi("elem_strExmNotDoneEye").value=pt_strexamnotdone_eye;gebi("elem_strExmDoneEM").value=pt_strexamdone_em;gebi("elem_strExmNotDoneEM").value=pt_strexamnotdone_em;gebi("elem_poe_visit_code").value=poe_visit_code;gebi("elem_pls_sel_nq_em").value=pls_sel_nq_em;gebi("elem_pls_sel_nq_eye").value=pls_sel_nq_eye;if(setVisitProcedure_nochk==0){}else{var los_t=cptcd.substr(-1,1);if(cptcd.indexOf("920")!=-1){if(gebi("elem_strExmNotDoneEye").value==""){$("#dialog-Mdc-cum-new-pt").remove();return;}}else if(cptcd.indexOf("992")!=-1){if(gebi("elem_strExmNotDoneEM").value==""){$("#dialog-Mdc-cum-new-pt").remove();return;}}}
var prompt_msg="";var oPrBillCd=gebi("elem_practiceBillCode");var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){if(oComp||opov||opopv){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";if($("#dialog-Mdc-cum-new-pt").length>0){$("#dialog-Mdc-cum-new-pt").remove();}
$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"&&oPrBillCd=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});if((oComp&&oComp.value!="")||(opov&&opov.value!="")||(opopv&&opopv.value!="")){var tmp=(oComp.value=="")?"5":oComp.value;if(opov&&opov.value!=""){tmp=5;}
else if(opopv&&opopv.value!=""){tmp=6;}
$("input[id*=elem_chkMedComp_][value='"+tmp+"']").prop("checked",true);}}
confirmVisitCode_v3();},"xml");}
function setSBTodayCharges(){var oTodaysCharges=gebi("elem_todaysCharges");var oProcOrder=gebi("elem_procOrder");var oProcUnitOrder=gebi("elem_procUnitOrder");if(!oProcOrder||(typeof oProcOrder.value=="undefined")||($.trim(oProcOrder.value)=="")){if(oTodaysCharges){oTodaysCharges.value="";}
return;}
var mod_50="";$("#superbill .modcode").each(function(){if(typeof(this.value)!='undefined'&&$.trim(this.value)=="50"){var cid=this.id.replace(/elem_modCode/,'elem_cptCode');cid=cid.replace(/_\d$/,"");if($("#"+cid).length>0){var cpt=$("#"+cid).val();if(cpt!=""){if(mod_50.indexOf(cpt)==-1){mod_50+=""+cpt+",";}}}}});var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var insCaseId="";if(typeof gebi("elem_masterCaseId")!="undefined"){var insCaseId=gebi("elem_masterCaseId").value;}
var vDos="";if(typeof gebi("elem_dos")!="undefined"){var vDos=gebi("elem_dos").value;}
var vVIP=($("#vipSuperBill:checked").length>0)?1:0;params="elem_formAction=todayCharges";params+="&elem_insCaseId="+insCaseId;params+="&elem_strCptCodes="+oProcOrder.value;params+="&elem_dos="+vDos;params+="&elem_strCptUnits="+oProcUnitOrder.value;params+="&elem_vVIP="+vVIP;params+="&elem_mod50="+mod_50;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");str=""+data;if(oTodaysCharges){oTodaysCharges.value=""+str;}
$(".amount").html(""+str);});}
function getLSSHtml(obj,attr,type,asindx){var str_lss_tmp="";if(obj){var oLat=obj.attributes.getNamedItem(attr);vLat=(oLat)?""+oLat.nodeValue:"";var arrvLat=vLat.split(",");if(arrvLat.length>0){for(var vt in arrvLat){if(arrvLat[vt]!=""){var tmpLat=arrvLat[vt].split(" - ");str_lss_tmp+="<input type=\"checkbox\" id=\"elem_asDx"+type+"_"+vt+"\" name=\"elem_asDx"+type+"\" value=\""+tmpLat[1]+"\" onclick=\"icd10_restdxcodesinpopup(this)\" style=\"display:none;\" data-asindx=\""+asindx+"\" >"+"<label style=\"cursor:pointer;color:purple;margin-left:10px;padding:2px;border:2px solid transparent;\" for=\"elem_asDx"+type+"_"+vt+"\">"+tmpLat[0]+"</label>&nbsp;";}}}}
return str_lss_tmp;}
var sb_objRefraction={};function checkAssocPqri4All(){flg_checkAssocPqri4All_checkvisitcode=0;var prompt_msg="";if($("#elem_flgIsPtNew").val()=="New"){var ctop=top;var stop="top";if(top.fmain){ctop=top.fmain;stop="top.fmain";}
prompt_msg+="<label style=\"width:250px;display:inline-block;\"><b>Is this a New Patient?</b></label><div id=\"divisnwpt\">"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_new\" value=\"Yes_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_new\">Yes</label>"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_estb\" value=\"No_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_estb\">No</label></div>";}
if($("#poeModal").length<=0){var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if((oComp&&$.trim(oComp.value)=="")&&(opov&&$.trim(opov.value)=="")&&(opopv&&$.trim(opopv.value)=="")){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"padding:0px;\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\" ></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});return;}
var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var params=checkAssocPqri4All_getParam();if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if($("textarea[name=commentsForPatient]").val()=="debug123"){console.log(data);}
if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var xmlDoc=data;var arrCptCodes=new Array();var arrDxCodes=new Array();var arrExamDone=new Array();var arrExamTesting=new Array();sb_objRefraction.isRef=0;var tsb_ids="";var oTestSbInfo=xmlDoc.getElementsByTagName("testing_sb");var oTSB=(oTestSbInfo!=null&&oTestSbInfo[0]&&oTestSbInfo[0].childNodes)?oTestSbInfo[0].childNodes:null;var lenTSB=(oTSB!=null)?oTSB.length:0;for(var a=0;a<lenTSB;a++){var oSBNode=oTSB[a];if(oSBNode==null)continue;var osb_id=oSBNode.attributes.getNamedItem("id");if(osb_id)tsb_ids+=""+osb_id.nodeValue+",";var oCpts=oSBNode.childNodes;var lenCpts=(oCpts)?oCpts.length:0;for(var b=0;b<lenCpts;b++){var arrTmp=new Array();var oCptNode=oCpts[b];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var c=0;c<lenCptData;c++){var oData=oCptData[c];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="code"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";var oUnits=oData.attributes.getNamedItem("units");arrTmp["units"]=(typeof oUnits!="undefined")?oUnits.nodeValue:"";arrTmp["norepeat"]="1";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}else if(oData.nodeName=="dx"){var oDxNum=oData.attributes.getNamedItem("num");var oDxId=oData.attributes.getNamedItem("dxid");var dxId=(typeof oDxNum!="undefined"&&oDxNum)?oDxNum.nodeValue:"";var dxCdId=(typeof oDxId!="undefined"&&oDxId)?oDxId.nodeValue:"";if(dxId!=""){var idDx="dx"+dxId;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";arrTmp[idDx+"Id"]=(typeof dxCdId!="undefined")?dxCdId:"";}}else if(oData.nodeName=="modifier"){var oModNum=oData.attributes.getNamedItem("num");var modId=(typeof oModNum!="undefined")?oModNum.nodeValue:"";if(modId!=""){var idMod="modifier"+modId;arrTmp[""+idMod]=""+oData.firstChild.data;}}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}}
if(tsb_ids!=""){tsb_ids=tsb_ids.replace(/,\s*$/g,"");gebi("elem_sb_tsbIds").value=""+tsb_ids;}
var oCptInfo=xmlDoc.getElementsByTagName("allcptcode")[0];var oCpts=(oCptInfo!=null)?oCptInfo.childNodes:null;var lenCpts=(oCpts!=null)?oCpts.length:0;for(var i=0;i<lenCpts;i++){var arrTmp=new Array();var oCptNode=oCpts[i];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var j=0;j<lenCptData;j++){var oData=oCptData[j];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="cptcode"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";arrTmp["norepeat"]="0";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}
else if(oData.nodeName=="units"){arrTmp["units"]=""+oData.firstChild.data;}
else if(oData.nodeName=="modifier1"){arrTmp["modifier1"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier2"){arrTmp["modifier2"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier3"){arrTmp["modifier3"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier4"){arrTmp["modifier4"]=""+oData.firstChild.data;}else if(oData.nodeName=="dx1"||oData.nodeName=="dx2"||oData.nodeName=="dx3"||oData.nodeName=="dx4"||oData.nodeName=="dx5"||oData.nodeName=="dx6"||oData.nodeName=="dx7"||oData.nodeName=="dx8"||oData.nodeName=="dx9"||oData.nodeName=="dx10"||oData.nodeName=="dx11"||oData.nodeName=="dx12"){var idDx=oData.nodeName;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=""+(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";}else if(oData.nodeName=="adx1"||oData.nodeName=="adx2"||oData.nodeName=="adx3"||oData.nodeName=="adx4"){var idDx=oData.nodeName;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=""+(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}
var arProcDxInfo=[];var oProcSbInfo=xmlDoc.getElementsByTagName("proc_sb");var oPSB=(oProcSbInfo!=null&&oProcSbInfo[0]&&oProcSbInfo[0].childNodes)?oProcSbInfo[0].childNodes:null;var lenPSB=(oPSB!=null)?oPSB.length:0;for(var a=0;a<lenPSB;a++){var oSBNode=oPSB[a];if(oSBNode==null)continue;if(oSBNode.tagName=="dx_info"){var oDxs=oSBNode.childNodes;var lenDxs=(oDxs)?oDxs.length:0;for(var b=0;b<lenDxs;b++){var oDxNode=oDxs[b];var tmpDx=""+oDxNode.firstChild.data;var tmpDxDesc=oDxNode.attributes.getNamedItem("desc");if(tmpDx!=""){arProcDxInfo[tmpDx]=""+(typeof tmpDxDesc!="undefined")?tmpDxDesc.nodeValue:"";}}}else{var oCpts=oSBNode.childNodes;var lenCpts=(oCpts)?oCpts.length:0;for(var b=0;b<lenCpts;b++){var arrTmp=new Array();var oCptNode=oCpts[b];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var c=0;c<lenCptData;c++){var oData=oCptData[c];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="code"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";var oUnits=oData.attributes.getNamedItem("units");arrTmp["units"]=(typeof oUnits!="undefined")?oUnits.nodeValue:"";arrTmp["norepeat"]="1";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}else if(oData.nodeName=="dx"){var oDxNum=oData.attributes.getNamedItem("num");var oDxId=oData.attributes.getNamedItem("dxid");var dxId=(typeof oDxNum!="undefined"&&oDxNum)?""+oDxNum.nodeValue:"";var dxCdId=(typeof oDxId!="undefined"&&oDxId)?""+oDxId.nodeValue:"";if(dxId!=""){var idDx="dx"+dxId;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=(typeof oDxDesc!="undefined")?""+oDxDesc.nodeValue:"";arrTmp[idDx+"Id"]=(typeof dxCdId!="undefined")?dxCdId:"";}}else if(oData.nodeName=="modifier"){var oModNum=oData.attributes.getNamedItem("num");var modId=""+(typeof oModNum!="undefined")?oModNum.nodeValue:"";if(modId!=""){var idMod="modifier"+modId;arrTmp[""+idMod]=""+oData.firstChild.data;}}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}}}
var oAutoCode=xmlDoc.getElementsByTagName("autocode")[0];var oAutos=(oAutoCode!=null)?oAutoCode.childNodes:null;var lenAutos=(oAutos!=null)?oAutos.length:0;var ptcategory="";var practicebillcode="";var ptlevelhistory="";var ptlevelcomp="";var ptservicelevel="";var ptcategory_consult="";var pt_levelofservice_eye="";var pt_levelofservice_em="";var pt_strexamdone_eye="";var pt_strexamnotdone_eye="";var pt_strexamdone_em="";var pt_strexamnotdone_em="";var poe_visit_code="";var pls_sel_nq_em="",pls_sel_nq_eye="";for(var i=0;i<lenAutos;i++){var oData=oAutos[i];if(oData.firstChild){if(oData.nodeName=="ptcategory"){ptcategory=""+oData.firstChild.data;}else if(oData.nodeName=="practicebillcode"){practicebillcode=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelhistory"){ptlevelhistory=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelcomp"){ptlevelcomp=""+oData.firstChild.data;}else if(oData.nodeName=="ptservicelevel"){ptservicelevel=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_eye"){pt_levelofservice_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_em"){pt_levelofservice_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_eye"){pt_strexamdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_eye"){pt_strexamnotdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_em"){pt_strexamdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_em"){pt_strexamnotdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="poe_visit_code"){poe_visit_code=""+oData.firstChild.data;}else if(oData.nodeName=="ptcategory_consult"){ptcategory_consult=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_em"){pls_sel_nq_em=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_eye"){pls_sel_nq_eye=""+oData.firstChild.data;}}}
gebi("elem_category").value=ptcategory;gebi("elem_practiceBillCode").value=practicebillcode;gebi("elem_levelHistory").value=ptlevelhistory;gebi("elem_levelComplexity").value=ptlevelcomp;gebi("elem_levelOfService").value=ptservicelevel;gebi("elem_ptcategory_consult").value=ptcategory_consult;gebi("elem_levelOfServiceEye").value=pt_levelofservice_eye;gebi("elem_levelOfServiceEM").value=pt_levelofservice_em;gebi("elem_strExmDoneEye").value=pt_strexamdone_eye;gebi("elem_strExmNotDoneEye").value=pt_strexamnotdone_eye;gebi("elem_strExmDoneEM").value=pt_strexamdone_em;gebi("elem_strExmNotDoneEM").value=pt_strexamnotdone_em;gebi("elem_poe_visit_code").value=poe_visit_code;gebi("elem_pls_sel_nq_em").value=pls_sel_nq_em;gebi("elem_pls_sel_nq_eye").value=pls_sel_nq_eye;var oDxInfo=xmlDoc.getElementsByTagName("eleminfo")[0];var oElems=(oDxInfo!=null)?oDxInfo.childNodes:null;var lenElems=(oElems!=null)?oElems.length:0;var arrDxInfo=new Array();for(var i=0;i<lenElems;i++){var oPqri=oElems[i].childNodes;var lenPqri=oPqri.length;var thisDxCode="";var tmpCptCode=new Array();for(var j=0;j<lenPqri;j++){var node=oPqri[j];if(node.nodeName=="dxcode"){thisDxCode=(node.firstChild)?node.firstChild.data:"";var oDxDesc=node.attributes.getNamedItem("desc");arrDxInfo[thisDxCode]=(typeof oDxDesc!="undefined")?""+oDxDesc.nodeValue:"";}
else if(node.nodeName=="pqri"){var cptNodes=node.childNodes;var lencptNodes=cptNodes.length;for(var k=0;k<lencptNodes;k++){var tmpCpt=cptNodes[k].firstChild;if(tmpCpt){var tmpStr=(tmpCptCode.length>0)?tmpCptCode.join(","):"";if(tmpStr.indexOf(tmpCpt.data)==-1){tmpCptCode[tmpCptCode.length]=tmpCpt.data;}}}}}
if(tmpCptCode.length>0){arrCptCodes[thisDxCode]=tmpCptCode;}}
if($("#elem_proc_only_visit").val()=="1"){opRemAllCptRow(3);}
insertExamsDoneSB(arrExamDone);PqriSetter(arrCptCodes);var oAssist=gebi("elem_buttonAssist");if(oAssist){oAssist.style.visibility="visible";}
confirmVisitCode_v3();var ocstInfo=xmlDoc.getElementsByTagName("cl_supply_total")[0];if((ocstInfo!=null)&&(ocstInfo.firstChild)){var tmpCst=ocstInfo.firstChild.data;if(parseInt(tmpCst)>0){var oTd_cst=gebi("td_clsupplytotal");if(oTd_cst){oTd_cst.innerHTML="CL order: "+tmpCst;}}}
var strAllDx="";var flgEmptyDx=0;for(var i=1;i<=12;i++){var oDxElem=gebi("elem_dxCode_"+i);if(oDxElem){var tmp=$.trim(oDxElem.value);if((typeof tmp!="undefined")&&(tmp!="")){if(typeof arrDxInfo[tmp]!="undefined"){oDxElem.title=arrDxInfo[tmp];}
strAllDx+=tmp+", ";}else{oDxElem.title="";flgEmptyDx=1;}}}
if(flgEmptyDx==1){for(var x in arProcDxInfo){if(strAllDx.indexOf(x)==-1){for(var i=1;i<=12;i++){var oDxElem=gebi("elem_dxCode_"+i);if(oDxElem){var tmp=$.trim(oDxElem.value);if((typeof tmp!="undefined")&&(tmp!="")){}else{oDxElem.value=x;oDxElem.title=arProcDxInfo[x];break;}}}}}}
sb_crt_dx_dropdown();},"xml");}
function icd10_pre_restdxcodesinpopup(len){for(var h=0;h<=len;h++){for(var mg=0;mg<=10;mg++){var dx_code_id="elem_asDx"+h+"_"+mg;if($("#"+dx_code_id).length>0){if(typeof($("#"+dx_code_id).data("valbakdb"))!='undefined'&&$("#"+dx_code_id).data("valbakdb")!=null){var dx_code_db_val=$("#"+dx_code_id).data("valbakdb");var dx_code_cur_val=$("#"+dx_code_id).val();var dx_str_len=String(dx_code_db_val).length;var dx_sss_val="";for(var k=0;k<=dx_str_len;k++){var x=dx_code_cur_val[k];if(x=="-"){x='Y';}
if(dx_code_db_val[k]!=x){dx_sss_val+=dx_code_cur_val[k]+',';}}
var isDbtsCode=0;if(dx_str_len==8&&(dx_code_cur_val.indexOf("E10.")!=-1||dx_code_cur_val.indexOf("E11.")!=-1)){isDbtsCode=1;dx_sss_val="";for(var k=0;k<=dx_str_len;k++){var x=dx_code_cur_val[k];if(x=="-"){x='0';}
if(dx_code_db_val[k]!=x){dx_sss_val+=dx_code_cur_val[k]+',';}}
var arx=dx_sss_val.split(",");var arx_ln=arx.length;var dx_sss_val_tmp="";for(var t=0;t<arx_ln;t++){if(typeof(arx[t])!="undefined"&&arx[t]!=""){dx_sss_val_tmp=arx[t]+","+dx_sss_val_tmp;}}
if(dx_sss_val_tmp!=""){dx_sss_val=dx_sss_val_tmp;}}
var dx_sss_val_exp=dx_sss_val.split(',');if(dx_sss_val_exp.length>2){for(var g=0;g<=10;g++){var chk_lat_id='elem_asDxLat'+h+'_'+mg+'_'+g;var chk_stg_id='elem_asDxStg'+h+'_'+mg+'_'+g;var chk_svr_id='elem_asDxSvr'+h+'_'+mg+'_'+g;if($("#"+chk_lat_id)&&$("#"+chk_lat_id).val()==dx_sss_val_exp[0]){$("#"+chk_lat_id).prop("checked",true);$("label[for="+chk_lat_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}else{if($("#"+chk_lat_id)&&typeof(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()])!='undefined'){if(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()]==1&&$("#"+chk_lat_id).val()==3){$("label[for="+chk_lat_id+"]").css("display",'none');}}}
if($("#"+chk_stg_id)&&$("#"+chk_stg_id).val()==dx_sss_val_exp[1]){$("#"+chk_stg_id).prop("checked",true);$("label[for="+chk_stg_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}
if(typeof(dx_sss_val_exp[2])!="undefined"&&dx_sss_val_exp[2]!=""){if(isDbtsCode==1){if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[2]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}else{if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[1]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}}else{for(var g=0;g<=10;g++){var chk_lat_id='elem_asDxLat'+h+'_'+mg+'_'+g;var chk_stg_id='elem_asDxStg'+h+'_'+mg+'_'+g;var chk_svr_id='elem_asDxSvr'+h+'_'+mg+'_'+g;if($("#"+chk_lat_id)&&$("#"+chk_lat_id).val()==dx_sss_val_exp[0]){$("#"+chk_lat_id).prop("checked",true);$("label[for="+chk_lat_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}else{if($("#"+chk_lat_id)&&typeof(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()])!='undefined'){if(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()]==1&&$("#"+chk_lat_id).val()==3){$("label[for="+chk_lat_id+"]").css("display",'none');}}}
if($("#"+chk_stg_id)&&$("#"+chk_stg_id).val()==dx_sss_val_exp[0]){$("#"+chk_stg_id).prop("checked",true);$("label[for="+chk_stg_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}
if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[0]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}}}}}}
function disDbtsProlifOptions(){$("#dx_sel_tbl :checked[id*=elem_asDx][data-valbak]").each(function(){var x=$(this).val();if(typeof(x)!="undefined"&&(x.indexOf("E10.")!=-1||x.indexOf("E11.")!=-1)&&x.length==8){var id=$(this).attr("id");var ids=id.replace(/elem_asDx/,"elem_asDxSvr");var svr=0;$("#dx_sel_tbl input[id*="+ids+"]").each(function(){if(this.checked){svr=this.value;}});var flg=0;if(svr==0||svr==5){flg=1;}
ids=ids+"_3";if($("#"+ids).length>0){var idst=id.replace(/elem_asDx/,"elem_asDxStg");$("#dx_sel_tbl label[for*="+idst+"]").each(function(){var a=$(this).html();if(a==2||a==3||a==4||a==5){if(flg==0){$(this).hide();}else{$(this).show();}}});}}});}
function PqriSetter(arrPqriCodes){var strHtml="";for(var z in arrPqriCodes){var tmpDx=z;var tmpCpt=arrPqriCodes[tmpDx];var len=tmpCpt.length;var lim=4;var cntr=lim+1;strHtml+="<div class=\"bgColor_pupil\"><b>Dx Code: "+tmpDx+"</b></div>";strHtml+="<table>";for(var i=0;i<len;i++){if(cntr>lim){strHtml+="<tr>";cntr=1;}
if(cntr<=lim){strHtml+="<td><input type=\"checkbox\" dx=\""+tmpDx+"\" name=\"elem_selPqri"+i+"\" value=\""+tmpCpt[i]+"\" onmousedown=\"stopClickBubble();\" >"+tmpCpt[i]+"</td>";cntr+=1;}
if(cntr>lim){strHtml+="</tr>";}}
strHtml+="</table>";}
if(strHtml!=""){var oPromptDiv=gebi("divChoosePqriCodes");if(oPromptDiv){oPromptDiv.style.backgroundColor="#FFDDCC";oPromptDiv.style.width="300px";strHtml="<table >"+"<tr><th >PQRI Codes</th></tr>"+"<tr><td>Select PQRI codes to display in Super Bill:-</td></tr>"+"<tr><td>"+strHtml+"</td></tr>";strHtml+="<tr><td style='text-align:center;'>"+"<input name=\"button\" type=\"button\" id=\"elem_pqricBtn\" class=\"dff_button\" "+"value=\"Insert\" onmousedown=\"stopClickBubble();\" onclick=\"getSelPQRICodes()\"> "+"<input name=\"button\" type=\"button\" id=\"elem_pqrixBtn\" class=\"dff_button\" "+"value=\"Cancel\" onmousedown=\"stopClickBubble();\" onclick=\"getSelPQRICodes(0)\">"+"</td></tr>";strHtml+="</table>";oPromptDiv.innerHTML=""+strHtml;oPromptDiv.style.display="block";var thisScrollTop=gebi("divWorkView").scrollTop;if(thisScrollTop==0){}else{oPromptDiv.style.top=(thisScrollTop+100)+"px";}
oPromptDiv.focus();stopClickBubble();}}}
function get_dx_popup_lss(oAsInfo,funcname){funcname=(typeof(funcname)!="undefined"&&funcname!="")?funcname:"";var str="";var cck=0;var strUni="",strUniDesc="";var arrdxth=new Array();var len=oAsInfo.length;for(var i=0;i<len;i++){var tAss=oAsInfo[i];var name=tAss.getElementsByTagName("name")[0].firstChild.nodeValue;var asindx=tAss.getElementsByTagName("name")[0].attributes.getNamedItem("indx").nodeValue;var arrdx=tAss.getElementsByTagName("dx");var ln2=arrdx.length;var tmp="";var chk_str_lss_tmp="";if(typeof arrdx[0]!="undefined"){chk_str_lss_tmp=getLSSHtml(arrdx[0],"strLat","Lat"+i+"_0",asindx);}
var dup_dx_row=0;if(chk_str_lss_tmp.indexOf("RUL")!=-1&&ln2<2){ln2=2;dup_dx_row=1;}
if(ln2>0){for(var k=0;k<ln2;k++){if(dup_dx_row>0){kf=0;}else{kf=k;}
var tdx=arrdx[kf].firstChild.nodeValue;var odxcat=arrdx[kf].attributes.getNamedItem("cat");var vdxcat=(odxcat)?" - "+odxcat.nodeValue:"";var odxid=arrdx[kf].attributes.getNamedItem("dxid");var vdxid=(odxid)?""+odxid.nodeValue:"";flgDisable="";if(strUni.indexOf(tdx+name)==-1||dup_dx_row>0){strUni+=tdx+name+",";}else{continue;}
var ck="";if((cck<12)&&(flgDisable!="disabled")){ck="checked";cck+=1;}
var str_lss="";var str_as_nm="";var str_as_sr_nm="";var tdx_db="";if(""+$("#hid_icd10").val()=="1"){str_as_nm=name;var str_lss_tmp="";str_lss_tmp=getLSSHtml(arrdx[kf],"strLat","Lat"+i+"_"+k,asindx);str_lss+="<td title=\"Laterality\">"+str_lss_tmp+"</td>";str_lss_tmp=getLSSHtml(arrdx[kf],"strStg","Stg"+i+"_"+k,asindx);str_lss+="<td title=\"Staging\">"+str_lss_tmp+"</td>";str_lss_tmp=getLSSHtml(arrdx[kf],"strSvr","Svr"+i+"_"+k,asindx);str_lss+="<td title=\"Severity\">"+str_lss_tmp+"</td>";str_as_sr_nm="<td>"+(i+1)+".</td>";var odxicd10bak=arrdx[kf].attributes.getNamedItem("strICD10Dx");tdx_db=(odxicd10bak)?""+odxicd10bak.nodeValue:"";}
var dx_code_box="";dx_code_box="<span class=\"checkbox\"><input type=\"checkbox\" id=\"elem_asDx"+i+"_"+k+"\" name=\"elem_asDx"+i+"_"+k+"\" value=\""+tdx+"\"  data-valbak=\""+tdx+"\"  data-valbakdb=\""+tdx_db+"\" data-asindx=\""+asindx+"\" data-dxid=\""+vdxid+"\"   "+ck+" "+flgDisable+" > <label for=\"elem_asDx"+i+"_"+k+"\">"+tdx+"</label>"+vdxcat+"</span>";if(dup_dx_row>0&&k>0){tmp+="<tr style=\"display:none;\" id=\"elem_asDx"+i+"_"+k+"_tr\">";}else{tmp+="<tr id=\"elem_asDx"+i+"_"+k+"_tr\">";}
tmp+=str_as_sr_nm+"<td class=\"small\">"+str_as_nm+"</td>"+"<td>"+dx_code_box+"</td>"+
str_lss+"</tr>";}}else{var str_as_nm="Enter Dx Code:";str_lss="";var str_as_sr_nm="";if(""+$("#hid_icd10").val()=="1"){str_as_nm=""+name;str_lss="<td></td><td></td><td></td>";str_as_sr_nm="<td>"+(i+1)+".</td>";}
tmp+="<tr>"+str_as_sr_nm+"<td class=\"small\">"+str_as_nm+"</td>"+"<td>"+"<input type=\"text\" placeholder=\"Enter Dx Code:\" name=\"elem_asDx"+i+"_0\" id=\"elem_asDx"+i+"_0\" data-asindx=\""+asindx+"\" value=\"\" class=\"dxallcodes form-control\" size=\"15\" onmousedown=\"stopClickBubble();\" onblur=\"checkDXCodesChart(this);stopClickBubble();\">"+"</td>"+str_lss+"</tr>";arrdxth[arrdxth.length]="elem_asDx"+i+"_0";}
if($.trim(tmp)!=""){if($("#hid_icd10").val()==1){str+=""+tmp;}else{str+="<tr><td colspan=\"2\"><b>"+name+"</b></td></tr>";str+=""+tmp;}}}
if(str!=""){var oDivDxCode=document.getElementById("divChooseDxCodes");oDivDxCode.innerHTML="";oDivDxCode.style.display="block";oDivDxCode.style.width="300px";var clsstbl="";if(""+$("#hid_icd10").val()=="1"){str="<tr class=\"grythead\"><td>#</td><td>Assessment</td><td>ICD10</td><td>Site</td><td>Staging</td><td>Severity</td></tr>"+str;oDivDxCode.style.width="90%";oDivDxCode.style.left="80px";clsstbl=" class=\"icd10\" ";}
var strInnerHTML="<table id=\"dx_sel_tbl\" class=\"table table-bordered table-responsive\" >"+"<tr class=\"head\"><th class='section_header1' >Dx Codes : Display in Super Bill</th></tr>";if(""+$("#hid_icd10").val()!="1"){strInnerHTML+="<tr><td></td></tr>";}
strInnerHTML+="<tr ><td  valign=\"top\" >";strInnerHTML+="<div onmousedown=\"stopClickBubble();\"><table "+clsstbl+" onmousedown=\"stopClickBubble();\"  >"+str+"</table></div>";strInnerHTML+="</td></tr>";strInnerHTML+="<tr id=\"module_buttons\" class=\"ad_modal_footer\"><td align=\"center\"><input name=\"button\" class=\"btn btn-success\" type=\"button\" id=\"elem_dxcBtn\"  value=\"Done\" onclick=\"getWantedDxCodes('"+funcname+"')\" onmousedown=\"stopClickBubble();\">"+"&nbsp;&nbsp;&nbsp;&nbsp;<input name=\"button\" class=\"btn btn-danger\" type=\"button\" id=\"elem_dxcanBtn\"  value=\"Cancel\" onclick=\"$('#divChooseDxCodes').hide();\" >"+"</td></tr>";strInnerHTML+="</table>";oDivDxCode.innerHTML=""+strInnerHTML;if($("#superbill #dx_sel_tbl div").height()<$("#superbill #dx_sel_tbl div table").outerHeight()){var tmphgt=($("#superbill #dx_sel_tbl div table").outerHeight()<600)?$("#superbill #dx_sel_tbl div table").outerHeight():600;$("#superbill #dx_sel_tbl div").height(tmphgt+"px");}
$(oDivDxCode).draggable({handle:".section_header"});var t=arrdxth.length;if(t>0){sb_addTypeAhead();}
icd10_pre_restdxcodesinpopup(len);disDbtsProlifOptions();}
return str;}
var getDCFA_strApId;function getDxCodesFromAssess(strAses){strAses=$.trim(strAses);if(strAses==""){return;}
var imgPath_tmp=zPath;var url=imgPath_tmp+"/chart_notes/requestHandler.php";var params="elem_formAction=getDxFrmAses";if(typeof(document.getElementById('hid_icd10'))!="undefined"){params+="&ICD_type="+$("#hid_icd10").val();}
params+=strAses;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var str="";var xmlDoc=data;var oShowPop=xmlDoc.getElementsByTagName("prompt_user")[0];var flagShowPop=(oShowPop)?oShowPop.firstChild.nodeValue:0;var oAsInfo=xmlDoc.getElementsByTagName("assess");var len=oAsInfo.length;var oApId=xmlDoc.getElementsByTagName("apid")[0];if(oApId&&oApId.firstChild){getDCFA_strApId=oApId.firstChild.nodeValue;}
if(typeof sb_pdiv=="undefined"){sb_pdiv="";}
if(flagShowPop==1){str=get_dx_popup_lss(oAsInfo);}else{var j=0;for(var i=0;(j<len)&&(i<12);i++){var vdx=vdxid="";var tAss=oAsInfo[j];vdx=tAss.getElementsByTagName("dx")[0].firstChild.nodeValue;vdx=(typeof vdx!="undefined")?vdx:"";if(vdx!=""){var odxid=tAss.getElementsByTagName("dx")[0].attributes.getNamedItem("dxid");vdxid=(odxid&&typeof odxid!="undefined"&&typeof odxid.nodeValue!="undefined")?odxid.nodeValue:"";}
flgD=true;if(vdx!=""){for(var k=1;k<=12;k++){var oC=gebi("elem_dxCode_"+(k));var cdxid=$(oC).data("dxid");if(typeof cdxid=="undefined"){cdxid="";}
cdxid=$.trim(cdxid);if(oC&&(oC.value!="")&&(oC.value==vdx)){if(cdxid!=""&&vdxid!=""&&vdxid!=cdxid){}else{flgD=false;j++;break;}}}}
if(flgD==true){var oT=gebi("elem_dxCode_"+(i+1));if(oT&&(($.trim(oT.value)=="")||(typeof oT.value=="undefined"))){oT.value=vdx;$(oT).data("dxid",vdxid);j++;}else{}}}
setTimeout(function(){set_dx_code_titles();},100);}
if(str==""){checkAssocPqri4All();}
if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");},"xml");}
function set_dx_code_titles(){var ar_dx=[],tdx="",tdxid="",flg=0;$(".dxallcodes").each(function(indx){tdx=$.trim(this.value);tdxid=$(this).data("dxid");if(typeof(tdxid)!="undefined"){tdxid=$.trim(tdxid);}
if(tdx!=""){ar_dx[ar_dx.length]=""+tdx+","+tdxid+","+this.id;flg++;}});if(flg>0){$.post(zPath+"/chart_notes/requestHandler.php",{"elem_formAction":"get_dx_titles","req_ptwo":"1","ar_dx[]":ar_dx},function(d){if(typeof(d)!="undefined"){for(var x in d){if(typeof(d[x])!="undefined"){renew_title($("#"+x)[0],""+d[x]);}}}},"json");}}
function is_dxcode_row_exists(valbakdb,tdxid,objVal,objhtml,trId){if(typeof valbakdb=="undefined"||typeof objVal=="undefined"||objVal==""){return 0;}
if(typeof tdxid=="undefined"){tdxid="";}
var ret=0;var retObj="";var flgChk=1;if($("#"+trId).find("td[title='Laterality'] :checked").length<2){flgChk=0;}
$("#dx_sel_tbl tr span input[type=checkbox]").each(function(){if(ret==1){return false;}
var tvalbakdb=$(this).data("valbakdb");if(valbakdb!=""&&tvalbakdb==valbakdb){var ftt=1;if(tdxid!=""){ftt=0;var tmpdxid=$(this).data("dxid");if(tdxid==tmpdxid){ftt=1;}}
if(ftt==1){var objtr=$(this).parent().parent().parent();var tmptrid=objtr.attr("id");if(typeof(trId)!="undefined"&&trId!=""){if(trId==tmptrid||$("#"+tmptrid+":visible").length==0){return true;}}
var objchecked=objtr.find("td[title='Laterality'] :checked");if(objchecked.length>0){objchecked.each(function(){if(this.value==objVal){ret=1;return false;}});}else{retObj=objtr.attr("id");}}}});if(retObj!=""&&flgChk==0){ret=0;retObj="";}
return{'ret':ret,'retObj':retObj};}
function icd10_restdxcodesinpopup(obj){var objVal=$("label[for*="+obj.id+"]").html();if(objVal=='RUL'||objVal=='RLL'||objVal=='LUL'||objVal=='LLL'||objVal=='R'||objVal=='L'||objVal=='B'){if(obj.checked==true){var tmpres=0;var objCurRow=$(obj).parent().parent();var chk_dx_id=objCurRow.find("span input[type=checkbox]");if(chk_dx_id.length>0){var tdxid=chk_dx_id.data("dxid");var valbakdb=chk_dx_id.data("valbakdb");var tmpres=is_dxcode_row_exists(valbakdb,tdxid,obj.value,objVal,$(objCurRow).attr("id"));if(tmpres.ret==1){$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});return;}
else if(tmpres.retObj!=""){$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});$("#"+tmpres.retObj).find(":checkbox[value='"+obj.value+"']").prop("checked",true).triggerHandler("click");return;}}
var cont_lat_Sel=0;for(var i=0;i<4;i++){var ele_chk_id=(obj.id).substr(0,((obj.id).length-1));var final_ele_chk_id=ele_chk_id+i;if(document.getElementById(final_ele_chk_id)){if(document.getElementById(final_ele_chk_id).checked==true){cont_lat_Sel=parseInt(cont_lat_Sel)+1;}}}
if(cont_lat_Sel>1){var new_ele_obj_name=(obj.name).substr(0,((obj.name).length-1));var last_obj_id="";$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});for(var i=0;i<20;i++){var current_trgtid=obj.name.replace(/(Lat|Svr|Stg)/g,"")+'_tr';var curr_tr_data=$("#"+current_trgtid).html();var chk_new_tr_id=new_ele_obj_name.replace(/(Lat|Svr|Stg)/g,"")+i+'_tr';if(typeof($("#"+chk_new_tr_id).html())=="undefined"){var old_obj_id_num=(obj.name).substr(((obj.name).length-3),((obj.name).length));var old_obj_id_num_exp=old_obj_id_num.split('_');var new_obj_id=old_obj_id_num_exp[0]+'_'+i;var final_data='<tr id="'+chk_new_tr_id+'">'+curr_tr_data+'</tr>';var obj_id_rep=new RegExp(old_obj_id_num,"g");final_data=final_data.replace(obj_id_rep,new_obj_id);$(final_data).insertAfter($("#"+last_obj_id));var new_tr_obj=obj.id.replace(old_obj_id_num,new_obj_id);obj=document.getElementById(new_tr_obj);$("label[for*="+obj.name+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});$("#"+obj.id).prop("checked",true);$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});break;}
last_obj_id=chk_new_tr_id;}}else{$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}else{$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});}}else{$("label[for*="+obj.name+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});if(obj.checked){$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});$(":checked[name="+obj.name+"][id!="+obj.id+"]").prop("checked",false);}}
var trgtid=obj.name.replace(/(Lat|Svr|Stg)/g,"");var trgtval=$("#"+trgtid).val();var valChk=$.trim($("#"+trgtid).data("valbak"));var valChkdb=$.trim($("#"+trgtid).data("valbakdb"));if(valChk.length==valChkdb.length){var valChkdb_tmp=""+valChkdb.replace(/-/g,"\\w");var rex=new RegExp(""+valChkdb_tmp,"gi");var rez=valChk.match(rex);if(rez){valChk=valChkdb;}}
$("#"+trgtid).prop("checked",true);var setVal=(obj.checked)?obj.value:"-";var isDbtsCode=0;if(valChkdb.length==8&&(valChkdb.indexOf("E10.")!=-1||valChkdb.indexOf("E11.")!=-1)){isDbtsCode=1;}
var trgtvalNew="";if(obj.id.indexOf("Lat")!=-1){if(isDbtsCode==1){if(valChkdb.charAt(7)=='-'){var tt=trgtval.substr(0,7);var tt1=trgtval.substr(8);trgtvalNew=tt+setVal;}}else{if(valChk.charAt(6)=='-'){var tt=trgtval.substr(0,6);var tt1=trgtval.substr(7);trgtvalNew=tt+setVal+tt1;}else{if(valChk.substr(-3,3)!='-X-'||valChk.substr(-3,3)!='-x-'){var tt=trgtval.substr(0,5);var tt1=trgtval.substr(6);trgtvalNew=tt+setVal+tt1;}}}}else{if(isDbtsCode==1){if(obj.id.indexOf("Stg")!=-1){if(valChkdb.charAt(6)=='-'){var tt=trgtval.substr(0,6);var tt1=trgtval.substr(7);trgtvalNew=tt+setVal+tt1;}}else if(obj.id.indexOf("Svr")!=-1){if(valChkdb.charAt(5)=='-'){var tt=trgtval.substr(0,5);var tt1=trgtval.substr(6);trgtvalNew=tt+setVal+tt1;}}}else{if(valChk.indexOf("-")!=-1&&valChk.indexOf("--")==-1&&valChk.indexOf("-X-")==-1&&valChk.indexOf("-x-")==-1){trgtvalNew=valChk.replace('-',setVal);}else{if(valChk.indexOf("--")!=-1){var tt=trgtval.substr(0,7);trgtvalNew=tt+setVal;}else if(valChk.indexOf("-X-")!=-1||valChk.indexOf("-x-")!=-1){var tt=trgtval.substr(0,7);trgtvalNew=tt+setVal;}}}}
if(trgtvalNew!=""){$("#"+trgtid).val(""+trgtvalNew);var asindx=$("#"+trgtid).data("asindx");$("label[for="+trgtid+"]").html(""+trgtvalNew);var tm=""+trgtid.replace("elem_asDx","").split("_");if(""+tm[0]!=""){var tmp_asindx=(asindx&&asindx!="")?asindx:parseInt(tm[0])+1;var tmid="elem_assessment_dxcode"+tmp_asindx;if($("#"+tmid).length>0&&""+$("#"+tmid).val()!=""){if(""+$("#"+tmid).val().indexOf(",")!=-1||""+$("#"+tmid).val().indexOf(";")!=-1){var arrtmp=($("#"+tmid).val().indexOf(",")!=-1)?$("#"+tmid).val().split(","):$("#"+tmid).val().split(";");if(arrtmp.length>0){var strdx="";var flgin=0;for(var t in arrtmp){arrtmp[t]=$.trim(arrtmp[t]);if(arrtmp[t]!=""){if($("#"+tmid).val().indexOf("-")!=-1){var inx=valChk.indexOf("-");var ck=valChk.substring(0,inx);if(arrtmp[t].indexOf(ck)!=-1){if(strdx!=""){strdx+=", ";}
strdx+=trgtvalNew;}else{if(strdx!=""){strdx+=", ";}
strdx+=arrtmp[t];}
flgin=1;}else{if(strdx!=""){strdx+=", ";}
if($.trim(arrtmp[t])!=$.trim(trgtvalNew)){strdx+=arrtmp[t];}else{flgin=1;}}}}
if(flgin==0){if(strdx!=""){strdx+=", ";}
strdx+=trgtvalNew;}}
$("#"+tmid).val(strdx).trigger("keyup");}else{var tdx=$("#"+tmid).val();var tdx_1=tdx.slice(0,-1);var tdx_2=trgtvalNew.slice(0,-1);if(tdx_1==tdx_2&&tdx.indexOf("-")!=-1){tdx=trgtvalNew;}else{tdx=tdx+", "+trgtvalNew;}
$("#"+tmid).val(tdx).trigger("keyup");}}else{$("#"+tmid).val(trgtvalNew).trigger("keyup");}}
var asdx="";var x=trgtid.match(/elem_asDx\d+/);$("#dx_sel_tbl :checked[id*="+x+"][data-valbak]").each(function(){if(typeof(this.value)!="undefined"&&this.value!=""&&asdx.indexOf(this.value)==-1){if(asdx!=""){asdx+=", ";}asdx+=this.value;}});$("#"+tmid).val(asdx).trigger("keyup");}
disDbtsProlifOptions();}
function replace_cid10_extra_string(val){val=val.replace('Right Eye','Right');val=val.replace('Left Eye','Left');val=val.replace('Both Eyes','Both');val=val.replace('Initial Encounter Closed Fracture','Closed');val=val.replace('Initial Encounter Open Fracture','Open');val=val.replace('Subsequent Encounter for Fracture with Routine Healing','Routine');val=val.replace('Subsequent Encounter for Fracture with Delayed Healing','Delayed');val=val.replace('Subsequent Encounter for Fracture with Non Union','Union');val=val.replace('Initial Encounter','Initial');val=val.replace('Subsequent Encounter','Subsequent');val=val.replace('Adv atrophic w/o subfoveal Involvement','w/osubfoveal');val=val.replace('Adv atrophic w subfoveal Involvement','wsubfoveal');val=val.replace('Active neovascularization','Active');val=val.replace('Inactive neovasculization','Inactive');val=val.replace('AdInactive scar','scar');val=val.replace('w/ macular edema','edema');val=val.replace('w/ret neovaculaization','neovaculaization');return val;}
function getRvsDoneLevel(str){var arrLoc=new Array("Right Eye","Left Eye","Both Eyes","Right Eyelids","Left Eyelids","RUL","RLL","LUL","LLL","Peripheral vision","Paraxial vision","Central vision","Head","left side of head","right side of head","left side of face","right side of face","fore head","scalp","selLocOpt","selLocOther");var arrQuality=new Array("Stabbing","Dull","Aching","Doing well","Feels improvement","Tolerating","Quality~Worsening","Quality~Stable","Resolved","No changes noted","New","Quality~Increased","Quality~Decreased","Initially improved then worsened","Quality~Burning","distorted","dry","foggy","ghosting","Quality~glare","hazy","Quality~itching","pressure","scratchy","sharp","throbbing","watery","Quality~patient unsure","since surgery","since birth","since childhood","since last visit","many years","otherQty");var arrSeverity=new Array("Mild","Moderate","Severe","None",'Severity~Intermittent','Severity~Constant',"Decreased","Increased","Worsening","scale1To10","rvs_other_svrity");var arrTimeOnset=new Array("selectNo-","selectDate-","elem_sp_surtype","elem_sp_surdate","other_onset","many years","Patient unsure","Since surgery","Since birth","Since childhood","Since last visit");var arrContext=new Array("Reading","driving","outside","inside","otherContext");var arrModFact=new Array("MF~inside","outdoors","night","distance vision than near","near vision than distance","when transition from dark to light","when transition from light to dark","in dim light","early in the day","late in the day","with intensive visual activity (readingcomma computer)","with daily activities","makesBetter-","makesWorse-","otherFactors","rvs_painrelievedby");var arrAssocSign=new Array("Pain","Itching","Burning","Headache","Redness","Light sensitivity","Irritation","Blurry Vision","Halos","Foreign body sensation","Sharp",'ASAS~Dull',"Ache","Headaches","Eye pain","double vision","flashes","floater","ocular redness","glare","dizziness or light-headedness","weakness","tearing","high ocular pressure","none","otherSymptoms");var arrDoe=new Array("DoE~Intermittent","DoE~Uncertain","selectDoE","Sudden","Gradual","Constant","otherDoe","onSetDate");var arrVis=new Array("Blurry","Improved","Worse","Stable","rvsdet_otherVision");var arrDip=new Array("Dip~None","Dip~Mild","Dip~Improved","Dip~Worse");var arrMed=new Array("is following medication instructions","is not taking medications","ran out of meds","has finished meds as instructed","needs med refill","rvs_ranoutmeds","rvs_needs_med_refill");var arrCI=new Array("otherFollowCareInstruct");var arrOther=new Array("rvs_followup_detail_other");var arrParNeg=["no eye Pain","no Itching","no Tearing","no Flashes","no floaters","no Glare","no Red Eye","no Headache","no Dryness","no Distortion","no Change in Amsler Grid","no Ocular Trauma","no Pain with Eye Movement","no Loss of Consciousness","no Visual Phenomenon","no Pain or Tearing","no ShadowcommaCurtain or Veil","no Flashescommafloatercommashadowcommacurtain or Veil","no FevercommaWeight LosscommaScalp TendernesscommaHeadache or Jaw Claudication","other_par_neg"];var arrAll=[arrLoc,arrQuality,arrSeverity,arrTimeOnset,arrContext,arrModFact,arrAssocSign,arrDoe,arrMed];var arr_txt_fields=["rvs_needs_med_refill","rvs_ranoutmeds","rvs_other_svrity","otherQty","other_onset","selLocOther","otherSymptoms","otherFactors","otherContext","scale1To10","otherDoe","selLocOther"];var ret=1;var cntr=0;if($.trim(str)!=""){var arrStr=str.split(",");if(arrStr.length>0){for(var x in arrStr){var t=(typeof(arrStr[x])!="undefined"&&arrStr[x]!="")?arrStr[x]:"";if(t!=""&&t.indexOf("-")!=-1){var art=t.split("-");if(arr_txt_fields.indexOf(art[0])!=-1){arrStr[x]=art[0];}else if(art[0]=="selectNo"||art[0]=="selectDate"){arrStr[x]=art[0]+"-";}}}}
var len=arrAll.length;for(var i=0;i<len;i++){var arin=arrAll[i];for(var x in arin){if(-1!=arrStr.indexOf(arin[x])){cntr+=1;break;}}
if(cntr>=4){break;}}}
ret=(cntr>=4)?3:2;return ret;}
function getRvsDoneSt(){var cntrRet=0;if((complaint1.toString()!="")||(complaint2.toString()!="")||(complaint3.toString()!="")){cntrRet=1;if(complaint1.toString()!=""){cntr=getRvsDoneLevel(""+complaint1);if(cntr>cntrRet){cntrRet=cntr;}}
if(complaint2.toString()!=""){cntr=getRvsDoneLevel(""+complaint2);if(cntr>cntrRet){cntrRet=cntr;}}
if(complaint3.toString()!=""){cntr=getRvsDoneLevel(""+complaint3);if(cntr>cntrRet){cntrRet=cntr;}}}else{var ar=["-Vision Problem: Difficulty in","\r\n-Glare Problem: ","\r\n-Other Vision Problem: ","\r\n-Patient Comments: ","\r\n-Irritation Lids: ","\r\n-Irritation Ocular: ","\r\n-Post Segment: ","\r\n-Flashing Lights: ","\r\n-Floaters: ","\r\n-Amsler Grid: ","\r\n-Double vision: ","\r\n-Temporal Arteritis symptoms: ","\r\n-Loss of vision: ","\r\n-Headaches: ","\r\n-Migraine Headaches: ","\r\n-Post Op: ","\r\n-Follow Up: "];var s=$("#elem_ccompliant").val();if(typeof(s)=="undefined"){s="";}
for(var x in ar){if(s.toLowerCase().indexOf(ar[x].toLowerCase())!=-1){cntrRet=1;}}
if(cntrRet==0){var arrElemNames=new Array("elem_vpDis[]","elem_vpMidDis[]","elem_vpNear[]","elem_vpGlare[]","elem_vpOther[]","elem_irrLidsExt[]","elem_irrOcu[]","elem_postSegSpots","elem_postSegFL[]","elem_postSegFloat[]","elem_postSegAmsler[]","elem_neuroDblVis[]","elem_neuroTAS[]","elem_neuroMigHead[]","elem_neuroMigHeadAura[]","elem_neuroVisLoss[]","elem_fuFollowUp[]","elem_fuPostOp[]","elem_neuroHeadaches[]");for(var x in arrElemNames){var elem=document.getElementsByName(arrElemNames[x]);var len=elem.length;for(var i=0;i<len;i++){if(elem[i].checked==true){cntrRet=1;break;}}}}
if(cntrRet==0){var arT=["elem_vpDisOther","elem_vpMidDisOther","elem_vpNearOther","elem_vpOtherOther","vpComment","elem_irrLidsExtOther","elem_irrOcuOther","elem_neuroTASOther","elem_neuroMigHeadAuraOther","elem_neuroVisLossOther","elem_fuPostOp_other","elem_fuFollowUp_other"];for(var x in arT){var t=$("#"+arT[x]).val();if(t!=""&&typeof(t)!="undefined"){cntrRet=1;}}}}
return(typeof cntrRet!="undefined")?cntrRet:0;return 0;}
var sb_chkDia_inx;var sb_dm_popup_old;var call_CHECK_DIABETES;function sb_checkDiabetes(dib_type,obj,num,hgl,com){if((finalize_flag!=0&&isReviewable!=1)||elem_per_vo=="1"||$("#hid_icd10").val()!="1"){if(z_flg_diab_sb=="1"){opSuperBill(1);}
return;}
if(z_flg_diab_sb=="1"){var flgDMCodeEntered=sb_clearDiabetesAssessments(1);if(flgDMCodeEntered==1){opSuperBill(1);return;}}
if(typeof(hgl)!="undefined"&&hgl=="1"){var chk=$(obj).hasClass("highlight");if(chk==true){$(obj).removeClass("highlight");return;}
var stg=$(obj).html();if(num=="1"){if(sb_dm_popup_old){$("#dialog-msg-diab td[onclick]").removeClass("highlight");}}else if(num=="t1"||num=="t2"){}else{if(stg=="Right"||stg=="Left"){if($("#tbl_dbts_2").length<=0){var x=0;if(x==0){var clone_htm=$("#tbl_dbts_1").html();clone_htm="<table id=\"tbl_dbts_2\" cellpadding=\"2\" style=\"width:100%;\">"+clone_htm+"</table>";$(clone_htm).insertAfter("#tbl_dbts_1");$("#tbl_dbts_2 td[onclick]").removeClass("highlight");}}else{var x=0;$("#dialog-msg-diab td.highlight").each(function(){if($(this).html()!=""&&$(this).html()==stg){x+=1;}});if(x>0){return;}}}else if(stg=="Both"){var both_tbl_id=$(obj).parents("table[id*=tbl_dbts_]").attr("id");if(both_tbl_id=="tbl_dbts_2"){$("#tbl_dbts_1").remove();$("#tbl_dbts_2").attr("id","tbl_dbts_1");}else{$("#tbl_dbts_2").remove();}}
$(obj).parent().parent().parent().parent().find("td[onclick]").removeClass("highlight");}
sb_chkDia_inx=num;$(obj).addClass("highlight");if(stg=="Proliferative"){$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_trd").show();$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_wo_me").show();}else if(stg=="Mild"||stg=="Mod"||stg=="Severe"){$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_trd").hide();$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_wo_me").show();}
return;}
if(typeof(obj)!="undefined"){var dx_org=$("#dialog-msg-diab").data("dxcode");var assess_org=$("#dialog-msg-diab").data("assess");var assess=[],dx=[],eye=[];var assess_take=[],dx_take=[],eye_take=[];$("#dialog-msg-diab td.highlight").each(function(){var a=$(this).data("md");var b=$(this).html();if(a=="t1"||a=="t2"){var assess_t=""+$(this).data("asmt");var dx_t=""+$(this).data("dx");assess_take[assess_take.length]=assess_t;dx_take[dx_take.length]=dx_t;return;}
var tbl_id=""+$(this).parents("table[id*=tbl_dbts_]").attr("id");if(typeof(assess[tbl_id])=="undefined"){assess[tbl_id]="";}
if(typeof(dx[tbl_id])=="undefined"){dx[tbl_id]="";}
if(typeof(eye[tbl_id])=="undefined"){eye[tbl_id]="";}
var assess_t=""+assess[tbl_id];var dx_t=""+dx[tbl_id];var eye_t=""+eye[tbl_id];if(sb_dm_popup_old!=1){if((b.indexOf("E1")!=-1&&b.indexOf(".9")!=-1)||(b.indexOf("Diabetes Type 1 No retinopathy")!=-1)||(b.indexOf("Diabetes Type 2 No retinopathy")!=-1)){dx_t=$("#dbts_icd10_dx_1").html();assess_t=b;}else{var w1="";var a1="";if(a.indexOf("s")!=-1){a1="s";w1="5";}else if(a.indexOf("e")!=-1){a1="e";w1="6";}else if(a.indexOf("l")!=-1){a1="l";w1="7";}else{a1="";w1="100";}
if(a1!=""){if(dx_t==""){dx_t=dx_org;}
a=a.replace(a1,"");var dx1=dx_t.substr(0,w1);var dx3=dx_t.substr(parseInt(w1)+1);dx_t=dx1+a+dx3;if(a1!="l"){assess_t=assess_t+" "+b;}else{if(b=="Right"){eye_t="OD";}
else if(b=="Left"){eye_t="OS";}
else if(b=="Both"){eye_t="OU";}}}}}else{assess_t=$("#dbts_icd10_"+num).html();dx_t=b;}
if(assess_t!=""){assess[tbl_id]=assess_t;}
if(dx_t!=""){dx[tbl_id]=dx_t;}
if(eye_t!=""){eye[tbl_id]=eye_t;}});var udx;var pl=sb_clearDiabetesAssessments(udx,1);var assess_t=assess_org;var eye_t="",dx_t="";com=$.trim(com);for(var x in assess){if(assess[x]&&typeof(assess[x])!="undefined"&&assess[x]!=""){var as=$.trim(assess[x]);as_cd=dx[x];if(typeof(eye[x])!="undefined"&&eye[x]!=""){if(eye_t==""){eye_t=eye[x];}else{if((eye[x]=="OD"&&eye_t=="OS")||(eye[x]=="OS"&&eye_t=="OD")){eye_t="OU";}}
if(eye[x]=="OD"){as="Right "+as;}
if(eye[x]=="OS"){as="Left "+as;}
if(eye[x]=="OU"){as="Both "+as;}}
if(sb_dm_popup_old!=1){if(as.indexOf("No retinopathy")==-1){if(assess_t.indexOf(";")==-1){assess_t=assess_t+"; ";}else{assess_t=assess_t+", ";}
assess_t=assess_t+""+as;}else{assess_t=as;}}else{assess_t=as;}
if(typeof(as_cd)!="undefined"&&as_cd!=""){if(dx_t!=""){dx_t=dx_t+", ";}
dx_t=dx_t+as_cd;}}}
if(typeof(eye_t)=="undefined"){eye_t="";}
if(typeof(com)!="undefined"&&com!=""){if(assess_t!=""){assess_t=assess_t+"; \n"+com;}}
if(typeof(pl)=="undefined"){pl="";}
if(typeof(dx_t)=="undefined"){dx_t="";}
if(typeof(assess_t)!="undefined"&&assess_t!=""){sb_addAssessOption(""+assess_t,""+pl,0,""+eye_t,"",""+dx_t,"");}
if(assess_take.length>0){for(var z in assess_take){if(typeof(assess_take[z])!="undefined"&&assess_take[z]!=""){sb_addAssessOption(""+assess_take[z],"",0,"","",""+dx_take[z],"");}}}
$("#dialog-msg-diab").dialog("destroy");$("#dialog-msg-diab").remove();if(z_flg_diab_sb=="1"){opSuperBill(1);}
return;}
var dib_type_qry="";if(typeof(dib_type)!="undefined"){$("#dialog-msg-diab").dialog("destroy");$("#dialog-msg-diab").remove();dib_type_qry="&set_diabetes_type="+dib_type;}
var dib_type_as="";var ass_nm="#assessplan textarea[name*='elem_assessment[]']";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
var ass_nm_w_dm="";var ass_nm_w_dm_take="";$(""+ass_nm).each(function(){var as=$.trim(this.value).toLowerCase();var mtch=isDiabetesAssess(as,z_flg_diab_sb);if(mtch){dib_type_as="&get_diabetes_assess="+mtch+"&as="+as;ass_nm_w_dm=this.id;}
if(isDbTakeAssess(as)){if(as.indexOf("insulin")!=-1){ass_nm_w_dm_take+="t1";}
if(as.indexOf("hypoglycemic")!=-1){ass_nm_w_dm_take+="t2";}}});if(ass_nm_w_dm_take!=""){dib_type_as+="&dm_asmt_take="+ass_nm_w_dm_take;}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,"assessplan");if($("#dialog-msg-diab").length>0){$("#dialog-msg-diab").remove();$("#dialog-msg-diab").dialog("destroy");}
if(typeof(call_CHECK_DIABETES)!="undefined"&&call_CHECK_DIABETES==1){return;}
call_CHECK_DIABETES=1;var turl=zPath+"/chart_notes/requestHandler.php?elem_formAction=CHECK_DIABETES&z_flg_diab_sb="+z_flg_diab_sb+dib_type_qry+dib_type_as;$.get(turl,function(data){call_CHECK_DIABETES=0;if(typeof(setProcessImg)!='undefined')setProcessImg(0,"assessplan");if(z_flg_diab_sb==""){}else{sb_dm_popup_old=data.flgShowOldPop
if(data.msg=="DIABETES TYPE POPUP"||data.msg=="DIABETES TYPE 1 POPUP"||data.msg=="DIABETES TYPE 2 POPUP"){$("body").append(data.html);if(data.show_pop_up_h_option){$("#dialog-msg-diab td[id]").each(function(){if($(this).html().toLowerCase().indexOf(data.show_pop_up_h_option.toLowerCase())!=-1){$(this).css({"background-color":"Yellow"});}});}
var obtns=[];if(data.msg!="DIABETES TYPE POPUP"){if(sb_dm_popup_old!=1){obtns[obtns.length]=sb_getSeverityScaleObj();}
obtns[obtns.length]={text:"Done",click:function(){var cm=$("#dialog-msg-diab #ta_dbts_icd10_cm").val();if($("#dialog-msg-diab td.highlight").length>0){sb_checkDiabetes('',$("#dialog-msg-diab td.highlight")[0],sb_chkDia_inx,'',cm);}else if(cm!=""){if(typeof(ass_nm_w_dm)!="undefined"&&ass_nm_w_dm!=""){var nm=ass_nm_w_dm.replace("elem_assessment","");var x=$("#elem_assessment"+nm+"").val();if(x!=""){var arx=x.split(";");x=arx[0];}x=(typeof(x)!="undefined"&&x!="")?x+";"+cm:cm;$("#elem_assessment"+nm+"").val(x).trigger("blur");$("#dialog-msg-diab").dialog("close");}else{$("#dialog-msg-diab").dialog("close");}}}};}
obtns[obtns.length]={text:"Cancel",click:function(){$("#dialog-msg-diab").dialog("close");$("#svrt_scl_info").remove();}}
if(data.msg!="DIABETES TYPE POPUP"){obtns[obtns.length]={id:"dmb_reset",text:"Reset",click:function(){$("#dialog-msg-diab textarea").val("");$("#dialog-msg-diab td[onclick]").removeClass("highlight");if(typeof(ass_nm_w_dm)!="undefined"&&ass_nm_w_dm!=""){var nm=ass_nm_w_dm.replace("elem_assessment","");$("#elem_assessment"+nm+",#elem_assessment_dxcode"+nm+",#elem_plan"+nm).val("").trigger("blur");$("#elem_apOu"+nm+",#elem_apOd"+nm+",#elem_apOs"+nm+",#elem_resolve"+nm+",#no_change_"+nm).prop("checked",false).triggerHandler("click");}sb_clearDbAsTaking();}};}
$("#dialog-msg-diab").dialog({modal:false,width:600,buttons:obtns,close:function(event,ui){$(this).dialog("destroy");$("#dialog-msg-diab").remove();if(z_flg_diab_sb=="1"&&z_flg_diab_sb!="2"){opSuperBill(1);};}});$("#dmb_reset").css({"float":"right"});$("#dmb_svrt_scl").css({"float":"left","background":"none","color":"purple","border":"none","font-weight":"bold"});return;}}
if(data.assess&&typeof(data.assess)!="undefined"&&data.assess!=""){var as_cd=(data.assess_code&&typeof(data.assess_code)!="undefined"&&data.assess_code!="")?""+data.assess_code:"";if(!sb_clearDiabetesAssessments(1)){sb_clearDiabetesAssessments();sb_addAssessOption(""+data.assess,"",0,"","",""+as_cd,"");}}
if(z_flg_diab_sb=="1"){opSuperBill(1);}},"json");}
function printPlanFun(ocu){var final_flag="",form_id="";if(document.getElementById('hidd_final_flag')){final_flag=document.getElementById('hidd_final_flag').value;}
if(document.getElementById('hidd_final_flag')){form_id=document.getElementById('hidd_formId').value;}
if(typeof(form_id)=="undefined"||form_id==""){form_id=$("#form_id").val();}
if(typeof(final_flag)=="undefined"||final_flag==""){final_flag=0;}
if(typeof(ocu)=="undefined"){ocu=0;}
medication=null;$.ajax({url:zPath+"/chart_notes/requestHandler.php?elem_formAction=chart_plan_print&final_flag="+final_flag+"&form_id="+form_id+"&medication="+medication+"&ocu="+ocu,success:function(resp){if(resp){if(top.fmain&&top.fmain.showOtherForms){top.fmain.showOtherForms(zPath+'/../library/html_to_pdf/createPdf.php?file_location='+resp,'print_plan_win','1000','400');}
else{window.open(zPath+'/../library/html_to_pdf/createPdf.php?file_location='+resp,'print_plan_win','toolbar=0,width=1000,height=400,resizable=1');}}else{top.fAlert('No Medication Exists');}}});}
function dx_assoc_cpt(o){var v_icd_10=$("#hid_icd10").val();if(v_icd_10!="1"&&v_icd_10!="10"){var arcurdx=""+fun_mselect(this,"val");if(arcurdx&&arcurdx!="null"&&arcurdx!=""){var tmp_arcurdx=arcurdx.split(",");var lm=4;if(tmp_arcurdx.length>lm){top.fAlert("You cannot select more than 4 Dx codes for a procedure.");return false;}}}
sb_checknwarn4WrongDxcode(o);fun_mselect('.selectpicker','width');}
function dx_assist(){var a=$("#superbill .dxallcodes").filter(function(){return $.trim(this.value)!=""?1:0;}).length;var b=$("#tblSuperbill .cptcode").filter(function(){return $.trim(this.value)!=""?1:0;}).length;if(a==0||b==0){top.fAlert("Please enter CPT and DX codes in superbill.");return;}
var ar=[];var str_cpt="";$("#tblSuperbill .cptcode").each(function(){if(typeof(this.value)!="undefined"&&$.trim(this.value)!=""){ar[this.id]=this.value;str_cpt+=""+this.id+"="+encodeURIComponent(this.value)+"&";}});var param="elem_formAction=get_valid_dx_codes&"+str_cpt;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.get(zPath+"/chart_notes/requestHandler.php",param,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");if(d){for(var a in d){if(a&&d[a]){var x=$.trim(d[a]);if(x!=""){var chk_all="";var ax=x.split(",");var l=ax.length;for(var i=0;i<l;i++){if(typeof(ax[i])!="undefined"&&ax[i]!=""){var chk=$.trim(ax[i]);$("#superbill .dxallcodes").each(function(){var t=$.trim(this.value);if(typeof(t)!="undefined"&&t!=""){var q1=""+t.slice(0,-1)+"-";var q2=""+t.slice(0,-2)+"--";var q3=""+t.slice(0,-3)+"-x-";if(t==chk||q1==chk||q2==chk||q3==chk){if(chk_all!=""){chk_all+=",";}chk_all+=t;return false;}}});}}
if(chk_all!=""){var cdx=a.replace("elem_cptCode_","elem_dxCodeAssoc_");fun_mselect("#"+cdx,"select",chk_all);$("#"+a).triggerHandler("blur");}}}}}},"json");}
function sb_add_menu(o,h,t){if(typeof(o)!="undefined"){if(!$(o).hasClass("dropdown-toggle")){if(typeof(h)=="undefined"){var g="";if($(o).parent().hasClass("menu_cpt")){g='menu_cpt';}else if($(o).parent().hasClass("menu_mod")){g='menu_mod';}
if(g!=""){if($("#superbill ."+g+"_ul").length<=0){if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=get_sb_menu&wh="+g+"&req_ptwo=1",function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");if(typeof(d)!="undefined"&&d!=""){sb_add_menu(o,d,1);}});}else{var d=$("#superbill ."+g+"_ul").get(0).outerHTML;if(typeof(d)!="undefined"&&d!=""){sb_add_menu(o,d);}}
return;}}else{var trgtid=''+$(o).parent().parent().find(".form-control").attr("id");$(o).parent().append(h);if(($("#hid_save_section").length>0&&$("#hid_save_section").val()=="accounts")||1==1){$(o).parent().addClass("dropup");}
$(o).attr("data-toggle","dropdown");$(o).attr("data-trgt-id",trgtid);$(o).addClass("dropdown-toggle");$(o).unbind("click",'sb_add_menu');$(o).dropdown();$(o).parent().find("a").bind("click",function(e){if(!$(this).hasClass("cat")){var t=$(o).data("trgt-id");$("#"+t).val($(this).data("val")).trigger("blur");$(o).parent().find("ul.dropdown-menu-active").removeClass("dropdown-menu-active").toggle();$(o).dropdown("toggle");}else{$(this).next('ul').addClass("dropdown-menu-active").toggle();}
e.stopPropagation();e.preventDefault();});if(typeof(t)!="undefined"&&t=="1"){$(o).dropdown("toggle");}}}}else{for(var i=0;i<2;i++){var m=e=t="";if(i==0){m="menu_cpt";t="tr[id*=elem_trSB] .cpt_td .input-group";e=".cptcode";}else if(i==1){m="menu_mod";t="tr[id*=elem_trSB] .md .input-group";e=".modcode";}
var s='<div class="input-group-btn menu '+m+' "><button type="button" class="btn" onclick="sb_add_menu(this)" ><span class="caret"></span></button></div>';$(""+t+"").each(function(){if($(this).find("div").length==0){$(this).find(e).after(s);}});if(typeof(sb_testName)!="undefined"&&sb_testName!=""){$(""+e+"").parent().find(".btn").css({"height":"26px"});}}}}/*VERSION NO. 0*/