
function clearSuperBill(){opRemAllCptRow(3);$(".dxallcodes,#superbill input[name=elem_todaysCharges],#elem_levelComplexity,#elem_proc_only_visit,#elem_post_op_visit,#elem_visitCode").val("");if(""+$("#elem_flgIsPtNew").val()=="Yes_confirmed"){$("#elem_flgIsPtNew").val("New");}else if(""+$("#elem_flgIsPtNew").val()=="No_confirmed"){$("#elem_flgIsPtNew").val("Establish");}
$(".dxallcodes").tooltip("destroy");}
var z_flg_diabetes="",z_flg_diab_sb="";function sb_clearDiabetesAssessments(flgonlychk,clrtake){clrtake=(typeof(clrtake)!="undefined"&&clrtake=="1")?"1":"0";var pln="";var ret=0;var ar_dm_as=["Diabetes Type 1 No retinopathy","DM Type 1 Mild with ME","DM Type 1 Mod with ME","DM Type 1 Severe with ME","DM Type 1 Proliferative with ME","DM Type 1 Mild without ME","DM Type 1 Mod without ME","DM Type 1 Severe without ME","DM Type 1 Proliferative without ME","DM Type 1","DM Type 1 no retinopathy","Diabetes Type 1","Diabetes Type I","Diabetes 1","DM 1"];var ass_nm="textarea[id*=elem_assessment]";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
$(ass_nm).each(function(indx){if(this.id.toLowerCase().indexOf("dx")==-1){var tmp=$.trim(this.value);if($.trim(tmp)!=""){tmp=tmp.toLowerCase();var ar_tmp=tmp.split(";");tmp=$.trim(ar_tmp[0]);if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){}
else{if(clrtake==1){if(isDbTakeAssess(tmp)){this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");return;}}}
for(var t in ar_dm_as){var dm1=ar_dm_as[t].toLowerCase();var dm2=(ar_dm_as[t]=="Diabetes Type I")?"Diabetes Type II".toLowerCase():ar_dm_as[t].replace("1","2").toLowerCase();var flgdm1=false;var flgdm2=false;if(isDiabetesAssess(tmp,2)){flgdm1=(tmp.indexOf(dm1)!=-1)?true:false;flgdm2=(tmp.indexOf(dm2)!=-1)?true:false;}
if(tmp==dm1||flgdm1||tmp==dm2||flgdm2){if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){if(typeof(z_flg_diab_sb)=="undefined"||(z_flg_diab_sb!="2"&&z_flg_diab_sb!="3")){var tmp_dx_mod=$.trim(ar_tmp[1]);tmp_dx_mod=tmp_dx_mod.toLowerCase();if(typeof(tmp_dx_mod)!="undefined"&&tmp_dx_mod!=""){if(z_flg_diab_sb=="1"){if((tmp_dx_mod.indexOf("mild")!=-1||tmp_dx_mod.indexOf("mod")!=-1||tmp_dx_mod.indexOf("severe")!=-1||tmp_dx_mod.indexOf("proliferative")!=-1)){tmp=tmp+"; "+tmp_dx_mod;}}else{tmp=tmp+"; "+tmp_dx_mod;}}}
if(tmp!="DM Type 1".toLowerCase()&&tmp!="Diabetes Type 1".toLowerCase()&&tmp!="DM Type 2".toLowerCase()&&tmp!="Diabetes Type 2".toLowerCase()&&tmp!="Diabetes Type I".toLowerCase()&&tmp!="Diabetes Type II".toLowerCase()){ret=1;}
else{var neid=this.id.replace("elem_assessment","no_change_");if($("#"+neid).prop("checked")==true){ret=1;}}}else{this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");pln=$("#"+asplid).val();$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");if($.trim(pln)!=""){break;}}}}}}});if(typeof(flgonlychk)!="undefined"&&flgonlychk==1){return ret;}else{return pln;}}
function sb_clearDbAsTaking(){var ass_nm="textarea[id*=elem_assessment]";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
$(ass_nm).each(function(indx){var tmp=$.trim(this.value);if($.trim(tmp)!=""){tmp=tmp.toLowerCase();var ar_tmp=tmp.split(";");tmp=$.trim(ar_tmp[0]);if(isDbTakeAssess(tmp)){this.value='';var asdxid=this.id.replace("elem_assessment","elem_assessment_dxcode");$("#"+asdxid).val('');var asplid=this.id.replace("elem_assessment","elem_plan");pln=$("#"+asplid).val();$("#"+asplid).val('');var indxid=this.id.replace("elem_assessment","");$("#elem_apOu"+indxid).prop("checked",false);$("#elem_apOd"+indxid).prop("checked",false);$("#elem_apOs"+indxid).prop("checked",false);$("#no_change_"+indxid).prop("checked",false).triggerHandler("click");$("#elem_resolve"+indxid).prop("checked",false).triggerHandler("click");return;}}});}
function sb_addAssessOption(a,b,c,d,e,f,g){if(typeof(addAssessOption)=="function"){addAssessOption(a,b,c,d,e,f,g);}else{if($("#assessplan .planbox .assnm[id*=elem_assessment][value='']").length>0){var tmpid=$("#assessplan .planbox .assnm[id*=elem_assessment][value='']")[0].id;$("#"+tmpid).val(a);var tmpdxid=tmpid.replace(/elem_assessment/g,"elem_assessment_dxcode");$("#"+tmpdxid).val(f);if((finalize_flag==0||isReviewable==1)&&elem_per_vo!="1"&&$("#hid_icd10").val()=="1"){a=encodeURI(a);f=encodeURI(f);var fid=$("#elem_masterId").val();if(typeof(setProcessImg)!='undefined')setProcessImg(1,"superbill");$.get(zPath+"/chart_notes/saveCharts.php?elem_saveForm=SET_DIABETES_IN_ASMNT&as="+a+"&dx="+f+"&fid="+fid,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg(0,"superbill");});}}else{}}}
function isDiabetesAssess(str,fstp){str=$.trim(str);if(fstp=="2"){var ar_str=str.split(";");if(ar_str.length>0){str=$.trim(ar_str[0]);}}
var ret=str.match(/^((diabetes|diabetes\s+mellitus|dm)\s+type\s+[1|2])/gi);str=str.toLowerCase();if(str=="diabetes 1"||str=="diabetes 2"||str=="dm 1"||str=="dm 2"||str=="diabetes type 1 no retinopathy"||str=="diabetes type 2 no retinopathy"){ret=str;}return ret;}
function isDbTakeAssess(s){return s.match(/Long\s+term\s+\(current\)\s+use\s+of/gi);}
function sb_getSeverityScaleObj(){return{text:"Severity Scale",id:"dmb_svrt_scl",click:function(){var x=""+"<div class=\"section\" id=\"svrt_scl_info\" >"+"<div id=\"staging_code_header\" class=\"purple_bar\">Severity Scale <span title=\"Close\"  onClick=\"$('#svrt_scl_info').remove();\" class=\"glyphicon glyphicon-remove pull-right\"  ></span> </div>"+"<div >"+"<ol type=\"a\">"+"<li><b>Mild</b> = microaneurysms"+"</li>"+"<li><b>Moderate</b> = more than just microaneurysms but less than severe NPDR"+"</li>"+"<li><b>Severe</b> = any of the following (4-2-1 rule) and no signs of PDR"+"<ol type=\"i\">"+"<li>Severe intraretinal hemorrhages and microaneurysms  in each of 4 quadrants </li>"+"<li>Definite venous beading in two or more quadrants </li>"+"<li>Moderate IRMA in one or more quadrants</li>"+"</ol>"+"</li>"+"<li><b>PDR</b>  = neovascularization or vitreous/pre-retinal hemorrhage"+"</li>"+"</ol>"+"</div>"+"</div>";$("#svrt_scl_info").remove();$("body").append(x);$("#svrt_scl_info").show();$("#svrt_scl_info").draggable({handle:"#staging_code_header"});}};}
function opSuperBill(flg_ids,flg_medComp){if(typeof(flg_ids)=="undefined"){z_flg_diab_sb="1";sb_checkDiabetes();return;}
sb_getProcId4del();clearSuperBill();var lenAssess=$("#assessplan .planbox").length;var strAssess="";var valAssess,valAssessDx,idAsmtDx;var oAssess,oAssessDx;var oNe,ores;for(var i=1;i<lenAssess;i++){oAssess=gebi("elem_assessment"+i);oNe=gebi("no_change_"+i);ores=gebi("elem_resolve"+i);oAssessDx=gebi("elem_assessment_dxcode"+i);valAssessDx=valAssess=idAsmtDx="";if(oAssess){valAssess=(typeof oAssess.value!="undefined")?oAssess.value:"";}
if(oAssessDx&&typeof oAssessDx.value!="undefined"&&$.trim(oAssessDx.value)!=""){valAssessDx=oAssessDx.value;idAsmtDx=$(oAssessDx).data("dxid");if(typeof idAsmtDx=="undefined"){idAsmtDx="";}}
if(oNe&&ores&&(valAssess!="")){if(((oNe.type=="checkbox"&&oNe.checked==false)&&(ores.type=="checkbox"&&ores.checked==false))||((oNe.type=="hidden"&&oNe.value==0)&&(ores.type=="hidden"&&ores.value==0))){strAssess+="&elem_assessment"+i+"="+valAssess;if(valAssessDx!=""){strAssess+="&elem_assessmentDx"+i+"="+valAssessDx;if(idAsmtDx!=""){strAssess+="&elem_asmtDxId"+i+"="+idAsmtDx;}}}}}
strAssess+="&elem_mxLen="+lenAssess;getDxCodesFromAssess(strAssess);}
function isTestOrderBySelected(){var oOp=document.getElementById("elem_opidTestOrdered");if(oOp&&oOp.value!=""){return true;}else{return false;}}
function opTestSuperBill(){if(typeof sb_testName=="undefined"){return;}
if(!isTestOrderBySelected()){top.fAlert("Please select order by.");var oOp=document.getElementById("elem_opidTestOrdered");if(oOp){oOp.focus();}
return;}
var test_eye="";if(sb_testName=="HRT"||sb_testName=="OCT"||sb_testName=="OCT-RNFL"||sb_testName=="GDX"){test_eye=""+$(":checked[name=elem_scanLaserEye]").val();}else if(sb_testName=="VF"||sb_testName=="VF_GL"){test_eye=""+$(":checked[name=elem_vfEye]").val();}else if(sb_testName=="Pachy"){test_eye=""+$(":checked[name=elem_pachyMeterEye]").val();}else if(sb_testName=="IVFA"){test_eye=""+$(":checked[name=elem_ivfa_od]").val();}else if(sb_testName=="ICG"){test_eye=""+$(":checked[name=elem_icg_od]").val();if(test_eye==1){test_eye="OU";}
else if(test_eye==2){test_eye="OD";}
else if(test_eye==3){test_eye="OS";}}else if(sb_testName=="Fundus"||sb_testName=="External"){test_eye=""+$(":checked[name=elem_photoEye]").val();}else if(sb_testName=="Topography"||sb_testName=="TestOther"||sb_testName=="TestLabs"){test_eye=""+$(":checked[name=elem_topoMeterEye]").val();}else if(sb_testName=="CellCount"){test_eye=""+$(":checked[name=elem_cellCntEye]").val();}else if(sb_testName=="A/Scan"||sb_testName=="iOLMaster"){var tod=""+$(":input[name=performedByOD]").val();var tos=""+$(":input[name=performedByOS]").val();var tod_2=""+$(":input[name=performedByPhyOD]").val();var tos_2=""+$(":input[name=phyTechListOS]").val();if(tod!=""||tod_2!=""){test_eye="OD";}
if(tos!=""||tos_2!=""){test_eye=(test_eye=="OD")?"OU":"OS";}}else if(sb_testName=="BScan"){test_eye=""+$(":checked[name=elem_bscanMeterEye]").val();}
var sb_testName_2=sb_testName;if(sb_testName=="OCT"){var a=$(":checked[name=elem_scanLaserOct]").val();if(a==2){sb_testName_2="OCT-Retina";}else if(a==3){sb_testName_2="OCT-Anterior Segment";}}else if(sb_testName=="External"){var a=$(":checked[name=elem_fundusDiscPhoto]").val();if(a==2){sb_testName_2="Anterior Segment Photos";}else{sb_testName_2="External Photos";}}else if(sb_testName=="iOLMaster"){sb_testName_2="IOL Master";}else if(sb_testName=="BScan"){sb_testName_2="B-Scan";}else if(sb_testName=="CellCount"){sb_testName_2="Cell Count";}else if(sb_testName=="VF_GL"){sb_testName_2="VF-GL";}else if(sb_testName=="TestLabs"){sb_testName_2="Laboratories";}
custom_test_variation_subid=0;if($('#hidd_test_cpt_preference_variation_id').get(0)!='undefined'){custom_test_variation_subid=$('#hidd_test_cpt_preference_variation_id').val();}
if(typeof(test_eye)=="undefined"||test_eye==""){test_eye="OU";}
$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=GetTestCptCodes&testname="+sb_testName_2+"&eye="+test_eye+"&variation_id="+custom_test_variation_subid,function(data){var obj=data.dx;if(obj!=null){var ln=obj.length;var y=1;if(ln>0){for(var x in obj){if(typeof(obj[x])!="undefined"&&obj[x]!=""){var ad=obj[x].split(" :Dsc: ");var dx=$.trim(ad[0]);var dx_dsc=$.trim(ad[1]);$("#elem_dxCode_"+y).val(dx).attr("title",dx_dsc).tooltip();y+=1;}if(y>12){break;}}if(y>1){$("#elem_dxCode_1").trigger("blur");}}}
var obj=data.cpt;if(obj==null||obj[0]==null){top.fAlert("No CPT code is specified for this Test.You can enter yourself.");}else{var strCptAlrdySel="";for(var x in obj){var ocpt=obj[x];if($.trim(ocpt["practice_code"])){var units=ocpt["units"];var ccodeDesc=ocpt["desc"];var arrMd=ocpt["modifier"];var cCpt=$.trim(ocpt["practice_code"]);var mxSbId=gebi("elem_mxSBId").value;var indxTbl=indxTblEmpty="";var cFlag=false;var eTblSb=gebi("tblSuperbill");var oRows=eTblSb.rows;var lenRows=oRows.length;for(var i=0;i<lenRows;i++){var tCptId=oRows[i].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var sCpt=$.trim(oCpt.value);if((indxTblEmpty=="")&&(sCpt=="")){indxTblEmpty=(i+1);}
if(oCpt&&(sCpt!="")&&(sCpt==cCpt)){indxTbl=""+i;}}
if(indxTbl!=""){strCptAlrdySel=""+cCpt+" ";continue;}
if(indxTblEmpty!=""){var oCpt=gebi("elem_cptCode_"+indxTblEmpty);oCpt.value=cCpt;oCpt.title=ccodeDesc;renew_title(oCpt,ccodeDesc);$("#elem_procUnits_"+indxTblEmpty).val(units);if(arrMd.length>0){for(var a=0;a<4;a++){if($.trim(arrMd[a])!=""){$("#elem_modCode_"+indxTblEmpty+"_"+(a+1)).val(arrMd[a]);}}}
if(typeof oCpt.onblur=="function"){checkDB4Code_flg=0;oCpt.onblur();}}else{var oVal={"cptCode":cCpt,"procId":"","units":units,"arrDx":new Array(),"arrMd":arrMd,"cptDesc":ccodeDesc};opAddCptRow(mxSbId,oVal);}}}
if(strCptAlrdySel!=""){window.status="CPT code ("+strCptAlrdySel+") already exists in super bill! ";}}},"json");}
function opProcedureSuperBill(){setSuperBillValue_onchange();}
function setMedComplexity(obj,flg){var val=obj.value;$("input[type=checkbox][id*=elem_chkMedComp_]").each(function(inx){if(obj.checked&&this.value!=val&&this.checked){this.checked=false;}});var val=$(":checked[id*=elem_chkMedComp_]").val();var oPrnt=top.fmain;if(typeof(wpage)!="undefined"&&wpage=="accSB"){oPrnt=top;}
var oComp=gebi("elem_levelComplexity");if(oComp){if(val==6){$("#elem_post_op_visit").val("1");oComp.value="";}else if(val==5){$("#elem_proc_only_visit").val("1");oComp.value="";}else{oComp.value=val;$("#elem_proc_only_visit").val("");$("#elem_post_op_visit").val("");}
var objCategory=gebi("elem_category");if($("#elem_flgIsPtNew").val()=="Yes_confirmed"||$("#elem_flgIsPtNew").val()=="No_confirmed"||$("#elem_flgIsPtNew").val()=="Establish"){if(typeof(flg_checkAssocPqri4All_checkvisitcode)!="undefined"&&flg_checkAssocPqri4All_checkvisitcode!=0&&flg_checkAssocPqri4All_checkvisitcode!=""){checkAssocPqri4All_checkvisitcode(flg_checkAssocPqri4All_checkvisitcode);}else{checkAssocPqri4All();}}}}
function getLOSfromCode(cd){var cd=cd.toString();if(cd=="Intermediate"){return 2;}else if(cd=="Comprehensive"){return 4;}else if((typeof cd!="undefined")&&(cd.length==5)){var lastDgt=cd.substring(4);return lastDgt;}
return"";}
function makeVisitCode(obj){var practiceBillCode=obj["elem_practiceBillCode"];var strCategory=obj["elem_category"];var levelOfService=obj["elem_levelOfService"];var visitCode=category="";if(strCategory!=null&&practiceBillCode!=null)
{category=getPatientCategoryCode(strCategory,practiceBillCode);}
if(practiceBillCode&&strCategory&&levelOfService)
{visitCode=practiceBillCode+category+levelOfService;}
var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var iscodeOk=visitCode.match(reg);return(iscodeOk)?visitCode:false;}
function sb_getVisitCodeCPTCost(vpbc){var parm="";var ar=["920","992"];var str_stop_dup="";for(var z in ar){var t=ar[z];var c=0;$(":input[type=checkbox][id*=lb_qlfy_lvl_code"+t+"]").each(function(){if(this.checked){var qd=$(this).val();if(typeof(qd)=="undefined"){qd="";}
if(qd!=""){if(str_stop_dup.indexOf(qd+",")==-1){str_stop_dup+=qd+",";parm+="&lb_qlfy_lvl_code"+t+"="+qd;c++;}}}});}
for(var z in ar){var t=ar[z];var tv="$0.00";$("label[id*=lb_rs_qlfy_def_"+t+"]").html(tv);$("label[id*=lb_rs_qlfy_ins_"+t+"]").html(tv);}
if(parm==""){$("label[id*=lb_rs_qlfy_ins_], #lb_rs_ins_v").html(tv).hide();return;}
var ins=$("#elem_masterCaseId").val();if(typeof(ins)=="undefined"){ins="";}
parm+="&elem_insCaseId="+ins;parm+="&elem_dos="+$("#elem_dos").val();var url=zPath+"/chart_notes/requestHandler.php?elem_formAction=sb_getVisitCodeCPTCost"+parm;$.get(url,function(data){for(var x in data){var xd=x.replace("lb_qlfy_lvl_code","lb_rs_qlfy_def_");var xi=x.replace("lb_qlfy_lvl_code","lb_rs_qlfy_ins_");var tv=(data[x]&&data[x]["def"]&&typeof(data[x]["def"])!="undefined")?"$"+data[x]["def"]:"$0.00";$("label[id*="+xd+"]").html(tv).show();var tv=(data[x]&&data[x]["ins"]&&typeof(data[x]["ins"])!="undefined")?"$"+data[x]["ins"]:"$0.00";$("label[id*="+xi+"]").html(tv).show();}
var flg=0;$("label[id*=lb_rs_qlfy_ins_]").each(function(){var t=$(this).html();if(t!="$0.00"){flg=1;}});if(flg==0){$("label[id*=lb_rs_qlfy_ins_], #lb_rs_ins_v").html(tv).hide();}},"json");}
function confirmVisitCode_v3(){var oCat=gebi("elem_category");var oPBC=gebi("elem_practiceBillCode");var olvlHis=gebi("elem_levelHistory");var olvlComp=gebi("elem_levelComplexity");var olvlService=gebi("elem_levelOfService");var oPoeVC=gebi("elem_poe_visit_code");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");var close_flg=0;if((oPoeVC.value==sb_cpt_code_poe)){setVisitCode(oPoeVC.value);close_flg=1;}else if(typeof(opov.value)!="undefined"&&opov.value=="1"){close_flg=1;}
else if(typeof(opopv.value)!="undefined"&&opopv.value=="1"){setVisitCode(oPoeVC.value);close_flg=1;}
if(close_flg==1){$("#dialog-Mdc-cum-new-pt").remove();return;}
var objEye={"elem_category":oCat.value,"elem_practiceBillCode":oPBC.value,"elem_levelOfService":olvlService.value};var strVisitCodeEye=makeVisitCode(objEye);if(strVisitCodeEye&&(strVisitCodeEye!="-1")&&($.trim(strVisitCodeEye)!="")){var prmptComp=($.trim(olvlComp.value)=="")?1:0;var lvlInsert=5;if(oPBC.value=="920"){lvlInsert=4;}
if(lvlInsert==olvlService.value){confirmVisitCode_v2();}else{confirmVisitCode_v2();}}}
function confirmVisitCode_v2(){var oCat=gebi("elem_category");var olvlHis=gebi("elem_levelHistory");var olvlComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");var olvlSerEye=gebi("elem_levelOfServiceEye");var olvlSerEM=gebi("elem_levelOfServiceEM");var oExNotDoneEye=gebi("elem_strExmNotDoneEye");var oExNotDoneEM=gebi("elem_strExmNotDoneEM");var oElem_pls_sel_nq_em=gebi("elem_pls_sel_nq_em");var oElem_pls_sel_nq_eye=gebi("elem_pls_sel_nq_eye");var detailEye="";var detailEM="";var objEye={"elem_category":oCat.value,"elem_practiceBillCode":"920","elem_levelOfService":olvlSerEye.value};var strVisitCodeEye=makeVisitCode(objEye);if(strVisitCodeEye){var obj={"vCode":strVisitCodeEye,"elem_levelOfService":olvlSerEye.value,"elem_practiceBillCode":"920","elem_strExmNotDone":oExNotDoneEye.value,"elem_pls_sel_nq":oElem_pls_sel_nq_eye.value};detailEye=getVisitCodeDetail(obj);}
var str_tbl_hdr_em=["",""];if($("#elem_practiceBillCode").val()=="992"){var objEM={"elem_category":oCat.value,"elem_practiceBillCode":"992","elem_levelOfService":olvlSerEM.value};var strVisitCodeEM=makeVisitCode(objEM);if(strVisitCodeEM){var obj={"vCode":strVisitCodeEM,"elem_levelOfService":olvlSerEM.value,"elem_practiceBillCode":"992","elem_strExmNotDone":oExNotDoneEM.value,"elem_pls_sel_nq":oElem_pls_sel_nq_em.value};detailEM=getVisitCodeDetail(obj);}
str_tbl_hdr_em[0]="<td width=\"1\"></td><td width=\"550\" valign=\"top\"><b>E/M Code</b></td>";str_tbl_hdr_em[1]="<td width=\"3\" height=\"1\" ><div style=\"background-color:gray;width:1px;height:100%;\"></div></td><td valign=\"top\" id=\"td_em_cd\">"+detailEM+"</td>";}
if(($.trim(detailEM)=="")&&($.trim(detailEye)=="")){return;}
var msg="<table class=\"table table-bordered\"  border=\"0\" width=\"100%\" >"+"<tr><td width=\"550\" valign=\"top\"><b>Eye Code</b></td>"+str_tbl_hdr_em[0]+"</tr>"+"<tr><td valign=\"top\" id=\"td_eye_cd\">"+detailEye+"</td>"+str_tbl_hdr_em[1]+"</tr>"+"</table>";var title="Assessed Service Level";var btn1="0";var btn2="0";if(typeof top.fmain=="undefined"){var func=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?"decideLevelofService2":"decideLevelofService2";}else{var func=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?"top.fmain.decideLevelofService2":"top.fmain.decideLevelofService2";}
var oArr={};if(olvlSerEye.value!="0"){oArr["Current Eye Code"]="Eye Code";}
if($("#elem_practiceBillCode").val()=="992"){if(olvlSerEM.value!="0"){oArr["Current E/M Code"]="EM Code";}
var pLeft=100;}else{var pLeft=200;}
var misc=((olvlSerEye.value!="0")||(olvlSerEM.value!="0"))?new Array(oArr):new Array({"OK":"OK"});var btnhtm="";var len=misc.length;for(var i=0;i<len;i++)
{var tmp=misc[i];for(x in tmp)
{btnhtm+="<input type=\"button\" value=\""+x+"\" onClick=\"window."+func+"('"+tmp[x]+"')\" class=\"btn btn-success\">&nbsp;";}}
btnhtm+='<input type="button" value="Cancel" onClick="window.'+func+'(-1)" class="btn btn-danger">';msg=msg+"<div id=\"module_buttons\" class=\"pt10 row\"><div class=\"col-sm-12 text-center\"><div class=\"form-group\">"+btnhtm+"</div></div></div>";if($("#div_as_srv_lvl").length<=0){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});}
$("#div_as_srv_lvl").html(msg);sb_getVisitCodeCPTCost();var pTop=60;$("#div_as_srv_lvl").find("tr").css({"background-color":"white"});$("#div_as_srv_lvl").find("input[id*=lb_qlfy_lvl_code]").bind("click",function(){var d=this.checked;var f=this.name;var e=this.id;$("input[type=checkbox][name*="+f+"]").each(function(index){if(this.id==e){$(this).prop("checked",d);}else{$(this).prop("checked",false);}});var clr=(d)?"red":"transparent";$("label[for*="+f+"]").each(function(index){if($(this).attr("for")==e){$(this).css({"border":"1px solid "+clr});}else{$(this).css({"border":"1px solid transparent"});}});if(this.value=="Procedure only visit"){$("#elem_proc_only_visit").val("1");}else{$("#elem_proc_only_visit").val("");}
if(this.value=="Post Op Visit"){$("#elem_post_op_visit").val("1");}else{$("#elem_post_op_visit").val("");}
if(d){opRemAllCptRow(3);checkAssocPqri4All();}else{sb_getVisitCodeCPTCost();}
stopClickBubble();});$("#div_as_srv_lvl #td_eye_cd .seprtr").each(function(ii){$(this).css({"width":"200px"});});if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});var lalign=($("#div_as_srv_lvl").find("input[type=button][value='OK']").length>0)?"50%":"70%";}}
function sb_get_vc_opt(vcd,vpbc,vcat){var vcat_in="";if(vcat=="New"){vcat_in="0";}else if(vcat=="Establish"){vcat_in="1";}
if(vpbc=="920"){var ar=["Intermediate - "+vpbc+vcat_in+"2","Comprehensive - "+vpbc+vcat_in+"4"];}else{var ar=["992"+vcat_in+"1","992"+vcat_in+"2","992"+vcat_in+"3","992"+vcat_in+"4","992"+vcat_in+"5"];}
var ret="<label class=\"lbl_asl_1\">Qualify for: </label><div class=\"seprtr\"><label for=\"lb_qlfy_lvl_code"+vpbc+"_0\">None</label></div>";ret="";for(var z in ar){var sel=(vcd==ar[z])?"checked":"";var tmp=ar[z].replace(/(Intermediate\s+\-\s+|Comprehensive\s+\-\s+)/g,"");ret+="<div class=\"seprtr\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+tmp+"\" "+sel+" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+ar[z]+"</label></div>";}
if($("#elem_practiceBillCode").val()=="920"){z=z+1;ret+="<div class=\"seprtr\" style=\"float:right; text-align:left;\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+"Procedure only visit"+"\" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+"Procedure only visit"+"</label></div>";z=z+1;ret+="<br/><div class=\"seprtr\" style=\"float:right;text-align:left;\"><input type=\"checkbox\" name=\"lb_qlfy_lvl_code"+vpbc+"\" id=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\" value=\""+"Post Op Visit"+"\" ><label for=\"lb_qlfy_lvl_code"+vpbc+"_"+z+"\">"+"Post Op Visit"+"</label></div>";}
if(ret!=""){ret="<label class=\"lbl_asl_1\">Qualify for: </label>"+ret;ret+="<br><label class=\"lbl_asl_1\" id=\"lb_rs_def_v\">Default Fees: </label><label id=\"lb_rs_qlfy_def_"+vpbc+"\" >Loading..</label>"+"<br><label class=\"lbl_asl_1\" id=\"lb_rs_ins_v\">Ins. Contract Fees: </label><label id=\"lb_rs_qlfy_ins_"+vpbc+"\">Loading..</label>";}
return ret;}
function getVisitCodeDetail(obj){var oPBC=obj["elem_practiceBillCode"];var objCategory=gebi("elem_category");var vCode_cpt=vCode=obj["vCode"];var pls_sel_nq=obj["elem_pls_sel_nq"];var msg="";if(vCode!=false){var oLoS=obj["elem_levelOfService"];var oNotDoneExm=obj["elem_strExmNotDone"];var arrNotDoneExm=(typeof oNotDoneExm!="undefined")?oNotDoneExm.split(","):new Array();var nxtVCode=(oLoS<"5"&&pls_sel_nq=="")?eval(vCode)+1:eval(vCode);if(oPBC=="920"){if(oLoS=="2"){vCode="Intermediate";}else if(oLoS=="4"){vCode="Comprehensive";}
nxtVCode=(oLoS<="1")?"Intermediate":"Comprehensive";}else{if(pls_sel_nq==""){if(nxtVCode==99201){nxtVCode="99202";}else if(nxtVCode==99211){nxtVCode="99212";}}}
if(pls_sel_nq!=""){nxtVCode=vCode;}
var nxtLos=getLOSfromCode(nxtVCode);if((oLoS=="0")){vCode="None";vCode_cpt="";}else{vCode_cpt=" - "+vCode_cpt;}
if(vCode==nxtVCode&&pls_sel_nq==""){nxtVCode="None";}
if(oPBC=="992"){vCode_cpt="";}
msg=""+"<br>"+sb_get_vc_opt(vCode+""+vCode_cpt,oPBC,objCategory.value)+"";msg+="<br>";if(((oLoS<"5")&&(vCode!="Comprehensive"))||(pls_sel_nq!="")){var tmp_list="";var arrExmCate=new Array();var len=arrNotDoneExm.length;for(var i=0;i<len;i++){if((typeof arrNotDoneExm[i]!="undefined")&&(arrNotDoneExm[i]!="")){if((arrNotDoneExm[i].indexOf("Fundus Exams")!=-1)||(arrNotDoneExm[i].indexOf("SLE")!=-1)||(arrNotDoneExm[i].indexOf("L&A")!=-1)){if(arrNotDoneExm[i].indexOf("-")!=-1){var arrTmpCate=arrNotDoneExm[i].split("-");var key=$.trim(arrTmpCate[0]);var val=$.trim(arrTmpCate[1]);if(typeof arrExmCate[key]=="undefined"){arrExmCate[key]=new Array();}
arrExmCate[key].push(val);}}else{tmp_list+="<br>   - "+arrNotDoneExm[i];}}}
for(var i in arrExmCate){tmp_list+="<br>   - "+i;var len2=arrExmCate[i].length;for(var j=0;j<len2;j++){var strSubCate=$.trim(arrExmCate[i][j]);if(strSubCate!=""){strSubCate=strSubCate.replace(/;/g,", ");tmp_list+="<br>&nbsp;&nbsp;&nbsp;&nbsp;- "+strSubCate;}}}
if(tmp_list!=""){msg+="<br>List items that must be completed to qualify for level - "+nxtVCode+"";msg+="<div class=\"dv_ls_todo_exm\">"+tmp_list+"</div>";}}
msg+="";}
return msg;}
function checkCurrRowId(currRowId){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;for(var i=0;i<lastRow;i++){var tId="elem_trSB"+(i+1);var temp=gebi(tId);if(temp==null){currRowId=(i+1);break;}}
return currRowId;}
function getRealIndx(id,strTr,strTbl){if(typeof strTbl=="undefined"){strTbl="tblSuperbill";strTr="elem_trSB";}
var rowId=strTr+id;var tbl=gebi(strTbl);var lastRow=tbl.rows.length;var i=0;for(i=0;i<lastRow;i++){var temp=tbl.rows[i];if(rowId==temp.id){return i;break;}}
if(id=="LASTINDX"){return i-1;}
return 0;}
function editSBRowValues(oVal){var strCpt=oVal.cptCode;var arrMd=new Array();arrMd=oVal.arrMd;if($.trim(strCpt)!=""){var mxId=gebi("elem_mxSBId").value;var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;for(var i=0;i<mxId;i++){var tId="elem_cptCode_"+(i+1);var temp=gebi(tId);if(temp&&(temp.value!="")&&(typeof temp.value!="undefined")&&($.trim(temp.value)==$.trim(strCpt))){for(var j=1;j<=4;j++){var oMd=gebi("elem_modCode_"+(i+1)+"_"+j);if(oMd){oMd.value=(typeof arrMd[j-1]!="undefined")?""+arrMd[j-1]:"";}}}}}}
function Save_form(i,cnfrm){if(typeof(del_proc_noti)=="undefined"||del_proc_noti=="0"||del_proc_noti==""){cnfrm=true;}
if(typeof(cnfrm)=="undefined"){var str="top.Save_form('"+i+"',true)";if(typeof(top.fmain)!="undefined"){if(typeof(top.fmain.ifrm_FolderContent)!="undefined"&&typeof(top.fmain.ifrm_FolderContent.Save_form)=="function"){var str="top.fmain.ifrm_FolderContent.Save_form('"+i+"',true)";}else{var str="top.fmain.Save_form('"+i+"',true)";}}
top.fancyConfirm("Would you like to delete the selected CPT row from superbill ?","",""+str);}
else{opRemCptRow(i);if(document.getElementById('save_form')){document.getElementById('save_form').value='1';document.frmSuperBill.submit();}}}
function opAddCptRow(indx,oVal,flagStpGtMx,fRindx,sup_enc_chk){var enc_chk=false;if(sup_enc_chk==1){enc_chk=true;}
var cptCode="";var procId="";var units="1";var arrDx=new Array();var arrMd=new Array();var tmp="";var cptDesc="";flagStpGtMx=(typeof flagStpGtMx!="undefined")?flagStpGtMx:0;if(typeof sb_pdiv=="undefined"&&gebi("divWorkView")){sb_pdiv="divWorkView";}
if(typeof oVal!="undefined"&&oVal!=""){cptCode=oVal.cptCode;procId=oVal.procId;units=oVal.units;arrDx=oVal.arrDx;arrMd=oVal.arrMd;cptDesc=(typeof oVal.cptDesc!="undefined")?oVal.cptDesc:"";}
var w_dx=$(".dxcodeshd td").eq(2).prop("width");var oTbl=$("#tblSuperbill").get(0);var lastRow=oTbl.rows.length;var currRowId=lastRow+1;var elemId;if(indx=="new"){indx=lastRow;}
var rIndx=(fRindx==1)?indx:getRealIndx(indx);rIndx=parseInt(rIndx);var row=oTbl.insertRow(rIndx+1);currRowId=checkCurrRowId(currRowId);row.id="elem_trSB"+currRowId;var cellCpt=row.insertCell(0);$(cellCpt).addClass("cpt_td");cellCpt.innerHTML=""+"<div class=\"input-group\">"+"<label class=\"pointer input-group-addon text-center contno\" onclick=\"sb_swap_vals(this)\">"
+currRowId+"</label>"+"<input type=\"text\" id=\"elem_cptCode_"+currRowId+"\" name=\"elem_cptCode_"+currRowId+"\" value=\""+cptCode+"\" title=\""+cptDesc+"\" class=\"cptcode form-control\" onblur=\"checkCptCodesChart(this);\">"+"<input type=\"hidden\" id=\"elem_procedureId_"+currRowId+"\" name=\"elem_procedureId_"+currRowId+"\" value=\""+procId+"\">"+"<input type=\"hidden\" id=\"elem_procedureOrder_"+currRowId+"\" name=\"elem_procedureOrder_"+currRowId+"\" value=\""+(rIndx+1)+"\">"+"</div>";var cellUnits=row.insertCell(1);$(cellUnits).addClass("unit");cellUnits.innerHTML="<input type=\"text\" id=\"elem_procUnits_"+currRowId+"\"  name=\"elem_procUnits_"+currRowId+"\" value=\""+units+"\" class=\"cptunit form-control\" onchange=\"checkProcUnitsChart(this);\">";var dxw=$("#elem_trSB1 .dx").attr("width");var cellDx=row.insertCell(2);elemId="elem_dxCodeAssoc_"+currRowId;cellDx.innerHTML="<select  id=\""+elemId+"\" name=\""+elemId+"[]\" multiple=\"multiple\" data-width=\"100%\" class=\"diagText_all_css minimal selectpicker dropupalways\" data-actions-box=\"true\" title=\"\">"+"</select>";cellDx.width=dxw;var dxCdId=elemId;for(var i=1;i<=4;i++){var cellMod=row.insertCell(i+2);$(cellMod).addClass("md");elemId="elem_modCode_"+currRowId+"_"+i;tmp=(typeof arrMd[i-1]!="undefined")?""+arrMd[i-1]:"";cellMod.innerHTML=""+"<div class=\"input-group\"><input type=\"text\" id=\""+elemId+"\" name=\""+elemId+"\" value=\""+tmp+"\" class=\"form-control modcode\" onblur=\"checkModCodesChart(this);\"></div>"+"";}
var cellLast=row.insertCell(7);$(cellMod).prop("valign","middle");cellLast.innerHTML="<span class=\"glyphicon glyphicon-remove\" onclick=\"Save_form('"+currRowId+"');\" title=\"Delete\" ></span> "+"<span class=\"glyphicon glyphicon-plus\" onclick=\"opAddCptRow('"+currRowId+"')\" title=\"Insert\"  ></span> ";if(flagStpGtMx!=1){var objsbnr=getMxSB(1);}
gebi("elem_cptCode_"+currRowId).onblur();sb_addTypeAhead();sb_crt_dx_dropdown("#"+dxCdId,'',arrDx);fun_mselect("#"+dxCdId,'render');fun_mselect("#"+dxCdId,'onchange',function(){dx_assoc_cpt(this);});fun_mselect("#"+dxCdId,'width');sb_reorder_srno();sb_add_menu();}
function sb_reorder_srno(){$("#tblSuperbill tr").each(function(i){$(this).find(".contno").html(""+(i+1)+"");});}
var st_sb_dx=ed_sb_dx=st_sb_rw=ed_sb_rw=0;function sb_swap_vals(obj){if(typeof(elem_per_vo)=="undefined"){elem_per_vo="0";}
if(typeof(finalize_flag)=="undefined"){finalize_flag="0";}
if(typeof(isReviewable)=="undefined"){isReviewable="0";}
if((elem_per_vo=="1")||((finalize_flag=="1")&&(isReviewable!="1"))){return;}
var id=($(obj).parents("#tblSuperbill").length>0)?"tblSuperbill":$(obj).parents("table").attr("id");if(id=="tblSuperbill"){var num=""+$(obj).parents("tr").attr("id");num=parseInt(num.replace(/elem_trSB/,""));if(st_sb_rw==0){st_sb_rw=num;obj.style.color="red";return;}else{ed_sb_rw=num;}
if((st_sb_rw!=0)&&(ed_sb_rw!=0)){$("#tblSuperbill tr").each(function(i){$(this).find("td:first-child .contno").css("color","white");});var tcv=$("#elem_cptCode_"+ed_sb_rw).val();var tct=$("#elem_cptCode_"+ed_sb_rw).attr("title");var tcvd=$("#elem_cptCode_"+ed_sb_rw).attr("valid_dxcodes");var tcpv=$("#elem_procedureId_"+ed_sb_rw).val();var tcov=$("#elem_procedureOrder_"+ed_sb_rw).val();var tcuv=$("#elem_procUnits_"+ed_sb_rw).val();var tcm1v=$("#elem_modCode_"+ed_sb_rw+"_1").val();var tcm1t=$("#elem_modCode_"+ed_sb_rw+"_1").attr("title");var tcm2v=$("#elem_modCode_"+ed_sb_rw+"_2").val();var tcm2t=$("#elem_modCode_"+ed_sb_rw+"_2").attr("title");var tcm3v=$("#elem_modCode_"+ed_sb_rw+"_3").val();var tcm3t=$("#elem_modCode_"+ed_sb_rw+"_3").attr("title");var tcm4v=$("#elem_modCode_"+ed_sb_rw+"_4").val();var tcm4t=$("#elem_modCode_"+ed_sb_rw+"_4").attr("title");var tcdxv=""+fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'val');var tcdxt=""+fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'title');$("#elem_cptCode_"+ed_sb_rw).val($("#elem_cptCode_"+st_sb_rw).val());$("#elem_cptCode_"+ed_sb_rw).attr("title",$("#elem_cptCode_"+st_sb_rw).attr("title"));$("#elem_cptCode_"+ed_sb_rw).attr("valid_dxcodes",$("#elem_cptCode_"+st_sb_rw).attr("valid_dxcodes"));$("#elem_procedureId_"+ed_sb_rw).val($("#elem_procedureId_"+st_sb_rw).val());$("#elem_procedureOrder_"+ed_sb_rw).val($("#elem_procedureOrder_"+st_sb_rw).val());$("#elem_procUnits_"+ed_sb_rw).val($("#elem_procUnits_"+st_sb_rw).val());$("#elem_modCode_"+ed_sb_rw+"_1").val($("#elem_modCode_"+st_sb_rw+"_1").val());$("#elem_modCode_"+ed_sb_rw+"_1").attr("title",$("#elem_modCode_"+st_sb_rw+"_1").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_2").val($("#elem_modCode_"+st_sb_rw+"_2").val());$("#elem_modCode_"+ed_sb_rw+"_2").attr("title",$("#elem_modCode_"+st_sb_rw+"_2").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_3").val($("#elem_modCode_"+st_sb_rw+"_3").val());$("#elem_modCode_"+ed_sb_rw+"_3").attr("title",$("#elem_modCode_"+st_sb_rw+"_3").attr("title"));$("#elem_modCode_"+ed_sb_rw+"_4").val($("#elem_modCode_"+st_sb_rw+"_4").val());$("#elem_modCode_"+ed_sb_rw+"_4").attr("title",$("#elem_modCode_"+st_sb_rw+"_4").attr("title"));var scdxv=""+fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'val');var scdxt=""+fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'title');fun_mselect("#elem_dxCodeAssoc_"+ed_sb_rw,'select',scdxv,scdxt);$("#elem_cptCode_"+st_sb_rw).val(tcv);$("#elem_cptCode_"+st_sb_rw).attr("title",tct);renew_title("#elem_cptCode_"+st_sb_rw,tct);$("#elem_cptCode_"+st_sb_rw).attr("valid_dxcodes",tcvd);$("#elem_procedureId_"+st_sb_rw).val(tcpv);$("#elem_procedureOrder_"+st_sb_rw).val(tcov);$("#elem_procUnits_"+st_sb_rw).val(tcuv);$("#elem_modCode_"+st_sb_rw+"_1").val(tcm1v);$("#elem_modCode_"+st_sb_rw+"_1").attr("title",tcm1t);renew_title("#elem_modCode_"+st_sb_rw+"_1",tcm1t);$("#elem_modCode_"+st_sb_rw+"_2").val(tcm2v);$("#elem_modCode_"+st_sb_rw+"_2").attr("title",tcm2t);renew_title("#elem_modCode_"+st_sb_rw+"_2",tcm2t);$("#elem_modCode_"+st_sb_rw+"_3").val(tcm3v);$("#elem_modCode_"+st_sb_rw+"_3").attr("title",tcm3t);renew_title("#elem_modCode_"+st_sb_rw+"_3",tcm3t);$("#elem_modCode_"+st_sb_rw+"_4").val(tcm4v);$("#elem_modCode_"+st_sb_rw+"_4").attr("title",tcm4t);renew_title("#elem_modCode_"+st_sb_rw+"_4",tcm4t);fun_mselect("#elem_dxCodeAssoc_"+st_sb_rw,'select',tcdxv,tcdxt);getMxSB();st_sb_rw=ed_sb_rw=0;}}else{var num=parseInt($(obj).html());if(st_sb_dx==0){st_sb_dx=num;obj.style.color="red";return;}else{ed_sb_dx=num;}
if((st_sb_dx!=0)&&(ed_sb_dx!=0)){$("#tblSBDX tr").each(function(i){$(this).find("th").css({"color":"black"});});var tv=$("#elem_dxCode_"+ed_sb_dx).val();var tt=$("#elem_dxCode_"+ed_sb_dx).attr("title");var tlv=$("#lit_diagText_"+ed_sb_dx).val();var tdocv=$("#dx_oldCode_"+ed_sb_dx).val();$("#elem_dxCode_"+ed_sb_dx).val($("#elem_dxCode_"+st_sb_dx).val());$("#elem_dxCode_"+ed_sb_dx).attr("title",$("#elem_dxCode_"+st_sb_dx).attr("title"));$("#lit_diagText_"+ed_sb_dx).val($("#lit_diagText_"+st_sb_dx).val());$("#dx_oldCode_"+ed_sb_dx).val($("#dx_oldCode_"+st_sb_dx).val());$("#elem_dxCode_"+st_sb_dx).val(tv);$("#elem_dxCode_"+st_sb_dx).attr("title",tt);renew_title("#elem_dxCode_"+st_sb_dx,tt);$("#lit_diagText_"+st_sb_dx).val(tlv);$("#dx_oldCode_"+st_sb_dx).val(tdocv);st_sb_dx=ed_sb_dx=0;}}}
function emptyFirstRowSB(){for(var i=1;i<=4;i++){if(i==1){var cptCode=gebi("elem_cptCode_"+i);var procid=gebi("elem_procedureId_"+i);var units=gebi("elem_procUnits_"+i);cptCode.value=cptCode.title="";procid.value="";units.value="1";sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+i,flgSetEmpty=1);renew_title(cptCode,"");}
if(i<=4){var mdCode=gebi("elem_modCode_1_"+i);mdCode.value="";}}}
function opRemAllCptRow(n){if(typeof(n)=="undefined")n=1;var tbl=gebi("tblSuperbill");if(!tbl)return;var lastRow=tbl.rows.length;for(var i=lastRow-1;i>=0;i--){if(i==0){emptyFirstRowSB();break;}else{tbl.deleteRow(i);}}
if(n>1){for(var i=1;i<n;i++){opAddCptRow("LASTINDX");}}
var objsbnr=getMxSB();}
function opRemCptRow(indx){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;var rIndx=getRealIndx(indx);if(typeof(indx)!="undefined"){var v=$("#elem_procedureId_"+indx).val();if(typeof(v)!="undefined"&&v!=""){var y=$("#elem_proc_del_id").val();if(y!=""){y+=",";}
$("#elem_proc_del_id").val(y+v);}}
if(indx>1){tbl.deleteRow(rIndx);}else{emptyFirstRowSB();}
var objsbnr=getMxSB();setSBTodayCharges();sb_reorder_srno();}
function getMxSB(flgAdd){var tbl=gebi("tblSuperbill");var lastRow=tbl.rows.length;var str="";var mx=0;var strCode="";var strUnit="";var tmpUnit="";var isCptElemVacant=1;var oCpt,flagLastRow=0;var checkId="";for(var i=0;i<lastRow;i++){var temp=tbl.rows[i];str+=""+temp.id+",";var id=temp.id.replace(/elem_trSB/,"");mx=(id>mx)?id:mx;var cptId=temp.id.replace(/elem_trSB/,"elem_cptCode_");var unitId=temp.id.replace(/elem_trSB/,"elem_procUnits_");oCpt=gebi(cptId);var oUnit=gebi(unitId);checkId+=id+", ";if(oCpt&&(typeof oCpt.value!="undefined")&&($.trim(oCpt.value)!="")){strCode+=(strCode!="")?","+oCpt.value:""+oCpt.value;tmpUnit=(oUnit&&(typeof oUnit.value!="undefined")&&($.trim(oUnit.value)!=""))?oUnit.value:1;strUnit+=(strUnit!="")?","+tmpUnit:""+tmpUnit;flagLastRow=i;var proOrdrId=temp.id.replace(/elem_trSB/,"elem_procedureOrder_");proOrdrId=gebi(proOrdrId);proOrdrId.value=(i+1);}else{flagLastRow=0;}}
lastRow=((typeof lastRow!="undefined"))?lastRow:4;mx=(mx>lastRow)?mx:lastRow;strCode=$.trim(strCode);strCode=strCode.replace(/,$/,"");strUnit=$.trim(strUnit);strUnit=strUnit.replace(/,$/,"");gebi("elem_mxSBId").value=mx;gebi("elem_procOrder").value=strCode;gebi("elem_procUnitOrder").value=strUnit;if(flgAdd==1&&flagLastRow!=0){if(sup_enc==1){opAddCptRow("LASTINDX",'','','',sup_enc);}else{opAddCptRow("LASTINDX");}}}
function checkChiefComplaintDetailed(){var ret="false";var c=getRvsDoneSt();if(c>=3){ret="true";}
return ret;}
var zChiefCompElemName="";function decideChiefComp(val){if(val=="1"){}else if(val=="0"){var oElem=gebi(zChiefCompElemName);if(oElem){oElem.value="";}}
zPqriElemName="";var objsbnr=getMxSB();setSBTodayCharges();}
function getCptDescJs(cptCode){var ret="";cptCode=$.trim(cptCode);if((cptCode!="")&&(typeof arrCptCodeDescActive[0]!="undefined")){for(var x in arrCptCodeDescActive[0]){if(arrCptCodeDescActive[0][x]==cptCode){ret=x;break;}}}
return ret;}
var sb_cw4WD_flgnoalert="";function sb_checknwarn4WrongDxcode(obj){var flgnoalert=sb_cw4WD_flgnoalert;if(typeof(flgnoalert)=="undefined"||flgnoalert==""){flgnoalert=0;}
var v_icd_10=$("#hid_icd10").val();var indx=obj.id.replace(/elem_cptCode_|elem_dxCodeAssoc_/g,"");var valid_dxCode="",cur_dxCode="";if(obj.id.indexOf("elem_cptCode_")!=-1){var proc_code=$.trim(""+obj.value);valid_dxCode=obj.getAttribute("valid_dxcodes");cur_dxCode=""+fun_mselect("#elem_dxCodeAssoc_"+indx,'val');}else{var proc_code=$("#elem_cptCode_"+indx).val();valid_dxCode=$("#elem_cptCode_"+indx).attr("valid_dxcodes");cur_dxCode=""+fun_mselect(obj,'val');}
if(typeof(valid_dxCode)!="undefined"){valid_dxCode=""+valid_dxCode;}
if(typeof(proc_code)!="undefined"){proc_code=""+proc_code;}
if(proc_code==""){var strtitle="";$("#elem_dxCodeAssoc_"+indx).find('option').each(function(){if(cur_dxCode.indexOf(""+$(this).val())!=-1){strtitle+=this.text+" - "+$(this).data("desc")+"\n";}});fun_mselect("#elem_dxCodeAssoc_"+indx,"settitle",strtitle);return;}
if(v_icd_10=="1"){if(valid_dxCode&&valid_dxCode!="null"&&valid_dxCode!=""&&typeof(valid_dxCode)!="undefined"&&cur_dxCode&&cur_dxCode!="null"&&typeof(cur_dxCode)!="undefined"&&cur_dxCode!=""){var ar_valid_dxCode=valid_dxCode.toLowerCase().split(",");var ar_cur_dxCode=cur_dxCode.split(",");var ar_wrong_dx=[];if(ar_cur_dxCode.length>0&&valid_dxCode.length>0){for(var x in ar_cur_dxCode){var tmp=$.trim(ar_cur_dxCode[x]);if(tmp=="")continue;var arr_tmp=tmp.split("**");if(arr_tmp[0]&&""+arr_tmp[0]!=""){arr_tmp[0]=$.trim(""+arr_tmp[0]).toLowerCase();if(ar_valid_dxCode.indexOf(""+arr_tmp[0])==-1){if(v_icd_10=="1"){var q1=""+arr_tmp[0].slice(0,-1)+"-";var q2=""+arr_tmp[0].slice(0,-2)+"--";var q3=""+arr_tmp[0].slice(0,-3)+"-x-";if(ar_valid_dxCode.indexOf(""+q1)!=-1||ar_valid_dxCode.indexOf(""+q2)!=-1||ar_valid_dxCode.indexOf(""+q3)!=-1){continue;}}
ar_wrong_dx[ar_wrong_dx.length]=""+arr_tmp[0];fun_mselect("#elem_dxCodeAssoc_"+indx,"unselect",tmp);}}}}
if(ar_wrong_dx.length>0&&flgnoalert==0){var dx_alert=ar_wrong_dx.join();dx_alert=dx_alert.toUpperCase();top.fAlert("Dx code(s) "+dx_alert+" can not be applied for procedure "+proc_code+".");}}}
if(v_icd_10!="1"){var arcurdx=""+fun_mselect("#elem_dxCodeAssoc_"+indx,'val');if(arcurdx&&arcurdx!="null"&&arcurdx!=""){var tmp_arcurdx=arcurdx.split(",");var lm=4;if(tmp_arcurdx.length>lm){if(flgnoalert==0){top.fAlert("You cannot select more than 4 Dx codes for a procedure.");}
for(var x in tmp_arcurdx){var tmp=$.trim(tmp_arcurdx[x]);if(tmp=="")continue;var arr_tmp=tmp.split("**");if(arr_tmp[0]&&""+arr_tmp[0]!=""){if(x>=lm){fun_mselect("#elem_dxCodeAssoc_"+indx,"unselect",tmp);}}}}}}
sb_setDxCodeTitle($("#elem_dxCodeAssoc_"+indx)[0]);}
function sb_setDxCodeTitle(obj){var strtitle="";var cur_dxCode=""+fun_mselect(obj,'val');$(obj).find('option').each(function(){if(cur_dxCode.indexOf(""+$(this).val())!=-1){var tmp=(typeof($(this).data("desc"))!="undefined")?" - "+$(this).data("desc"):"";strtitle+=this.text+""+tmp+"\n";}});fun_mselect(obj,"settitle",strtitle);}
function sb_getProcId4del(){var flg=0;var str="";$("#superbill :hidden[name*=elem_procedureId_]").filter(function(){return this.value!=='';}).each(function(){if(str!=""){str+=",";}str+=""+this.value;});var s=$("#elem_proc_del_id").val();if(typeof(s)!="undefined"&&s!=""){if(str!=""){str+=",";}
str+=s;}
$("#elem_proc_del_id").val(str);}
var flgMultiVisitCodeShowOnce=[],flgcheckingMVC=0,flgMultiVisitCodeShowOnce_2=[];function checkCptCodesChart(obj,fOk){if(document.getElementById('tat_table'))return;var cptCd=$.trim(obj.value);var cptCdFull=$.trim(obj.value);if((obj.value!="")&&(cptCd.length>=2)){if(typeof fOk=="undefined"){var indx=cptCd.lastIndexOf("~!~");cptCd=(indx!=-1)?$.trim(cptCd.substring(0,indx)):cptCd;obj.value=cptCd;checkDB4Code(obj,"Cpt");return;}
if((typeof sb_testName=="undefined"||sb_testName=="")&&(typeof examName=="undefined"||examName!="Procedures")){var pTop=200;var pLeft=300;if(typeof gebi("elem_masterPtVisit")!="undefined"){var typeVisit=gebi("elem_masterPtVisit").value;}else{var typeVisit="";}
var cpt4cd=obj.getAttribute("cpt4code");var prcBillCd=$("#elem_practiceBillCode").val();if((prcBillCd=="992"&&((cpt4cd=="99205")||(cpt4cd=="99204")||(cpt4cd=="99203")||(cpt4cd=="99202")||(cpt4cd=="99201")||(cpt4cd=="99215")||(cpt4cd=="99214")||(cpt4cd=="99213")||(cpt4cd=="99212")||(cpt4cd=="99211")))||(cpt4cd=="92004")||(cpt4cd=="92002")||(cpt4cd=="92014")||(cpt4cd=="92012")){if(setVisitProcedure_nochk==1){setVisitProcedure_nochk=0;}else{obj.value="";decideLevelofService2_obj_id=obj.id;checkAssocPqri4All_checkvisitcode(cpt4cd);getMxSB();setSBTodayCharges();return;}}
if(($.trim(typeVisit).toUpperCase()=="FOLLOW-UP")&&((cpt4cd=="99205")||(cpt4cd=="99204")||(cpt4cd=="99203")||(cpt4cd=="99215")||(cpt4cd=="99214")||(cpt4cd=="99213")||(cpt4cd=="99245")||(cpt4cd=="99244")||(cpt4cd=="99243")||(cpt4cd=="92005")||(cpt4cd=="92004")||(cpt4cd=="92003")||(cpt4cd=="92015")||(cpt4cd=="92014")||(cpt4cd=="92013"))){var msgFollowUp="Visit Type is Follow-up.<br>Are you sure you want to code to next level?";if((obj.value!="")&&((cpt4cd=="99204")||(cpt4cd=="99205")||(cpt4cd=="99214")||(cpt4cd=="99215")||(cpt4cd=="99244")||(cpt4cd=="99245"))){var chkStr=checkChiefComplaintDetailed();if(chkStr=="false"){var msgFollowUp="1. You have not detailed minimum requirements of 4 points of the chief complaint<br>"+"2. Visit Type is Follow-up and you are coding to next level.<br>"+"Are you sure you would like to use the selected visit code? ";}}
zChiefCompElemName=obj.name;var title="Visit code comfirmation";var msg=""+msgFollowUp+"<BR>";var btn1="Yes";var btn2="No";var func="decideChiefComp";var oDiv;displayConfirmYesNo_v2(title,msg,btn1,btn2,func,0);}else if(($.trim(typeVisit).toUpperCase()=="CEE")&&((cpt4cd=="99201")||(cpt4cd=="99202")||(cpt4cd=="99203")||(cpt4cd=="99211")||(cpt4cd=="99212")||(cpt4cd=="99213")||(cpt4cd=="99241")||(cpt4cd=="99242")||(cpt4cd=="99243")||(cpt4cd=="92001")||(cpt4cd=="92002")||(cpt4cd=="92003")||(cpt4cd=="92011")||(cpt4cd=="92012")||(cpt4cd=="92013"))){}else{if((obj.value!="")&&((cpt4cd=="99204")||(cpt4cd=="99205")||(cpt4cd=="99214")||(cpt4cd=="99215")||(cpt4cd=="99244")||(cpt4cd=="99245"))){var chkStr=checkChiefComplaintDetailed();if(chkStr=="false"){zChiefCompElemName=obj.name;var msgPrompt="You have not detailed minimum requirements of 4 points of the chief complaint<br>"+"Are you sure you would like to use the selected visit code?";var title="Chief Complaint Requirement";var msg=""+msgPrompt+"<BR>";var btn1="Yes";var btn2="No";var func="decideChiefComp";var oDiv;displayConfirmYesNo_v2(title,msg,btn1,btn2,func,0);}}}
var tmp=chk_multi_visit_code_exist(obj);}
remif_multi_Ophtha_code_exist(obj);sb_checknwarn4WrongDxcode(obj);}else{obj.value=obj.title=obj.cpt4code="";obj.setAttribute("valid_dxcodes","");if($("#superbill .cptcode").filter(function(){return this.value!=='';}).length==0&&$("#superbill :hidden[name*=elem_procedureId_]").filter(function(){return this.value!=='';}).length>0){flg=confirm("You have removed all CPTs of this super bill ! Are you sure?");if(flg){sb_getProcId4del();}}}
var objsbnr=getMxSB(1);setSBTodayCharges();}
function chk_multi_visit_code_exist(obj){if(typeof(sb_multi_vst_cd_noalert)!="undefined"&&sb_multi_vst_cd_noalert==1){return true;}
if(obj.value!=""){var visit_code_arr=["92001","92011","92002","92012","92004","92014","99201","99202","99203","99204","99205","99241","99242","99243","99244","99245","99211","99212","99213","99214","99215"];var a=visit_code_arr.indexOf(obj.value);if(a!=-1){var cvc=0;var cvc_flg=0,cvc_flg_2=0;var strCptCodes="";var tmp_arCptCodes=[];$(".cptcode").each(function(){var tmp="";var tmp=$.trim($(this).attr("cpt4code"));if(typeof(tmp)=="undefined"||tmp==""){tmp=$.trim(this.value);}
if(tmp!=""){var a=visit_code_arr.indexOf(tmp);if(a!=-1){cvc=cvc+1;if(flgMultiVisitCodeShowOnce.indexOf(tmp+cvc)==-1){flgMultiVisitCodeShowOnce[flgMultiVisitCodeShowOnce.length]=tmp+cvc;cvc_flg=1;}
if(flgMultiVisitCodeShowOnce_2.indexOf(tmp+cvc)==-1){cvc_flg_2=1;if(strCptCodes!=""){strCptCodes+=",";}
strCptCodes+="'"+tmp+"'";tmp_arCptCodes[tmp_arCptCodes.length]=tmp;flgMultiVisitCodeShowOnce_2[flgMultiVisitCodeShowOnce_2.length]=tmp+cvc;}}}});if(cvc>=2&&cvc_flg==1){top.fAlert("Visit Code already exists for DOS "+$("#elem_dos").val());}else if(strCptCodes!=""&&cvc_flg_2==1){if(flgcheckingMVC==0){flgcheckingMVC=1;var url=zPath+"/chart_notes/requestHandler.php";var params="elem_formAction=checkMultiVisitCode";params+="&elem_strCptCodes="+strCptCodes;params+="&elem_superbillDOS="+$("#elem_dos").val();params+="&elem_encounterId="+$("#elem_masterEncounterId").val();$.get(url,params,function(data){if(data=="1"){top.fAlert("Visit Code already exists for DOS "+$("#elem_dos").val());}
flgcheckingMVC=0;});}}}}}
function has_ophtha_code(o){if($.trim(o.value)==""){return false;}
var code_arr=["92201","92202","92225","92226"];var obj4cd=$(o).attr("cpt4code");if(typeof(obj4cd)=="undefined"||obj4cd==""){obj4cd=$.trim(o.value);}
var a=code_arr.indexOf(obj4cd);return(a!=-1)?true:false;}
function chk_multi_Ophtha_code_exist(){var cvc=0,ret=false;$(".cptcode").each(function(){if(has_ophtha_code(this)){cvc=cvc+1;}});if(cvc>=2){ret=true;}
return ret;}
function remif_multi_Ophtha_code_exist(obj){if(has_ophtha_code(obj)){var res=chk_multi_Ophtha_code_exist();if(res==true){top.fAlert("Ophthalmoscopy Code already exists in this superbill!");obj.value=obj.title=obj.cpt4code="";}}}
function checkProcUnitsChart(obj){if(obj.name.indexOf("elem_procUnits_")!=-1){var n=$.trim(obj.value);obj.value=n;if((n=="")||!isFinite(n)||(n<=0)){top.fAlert("Units can not be less than zero.");obj.value="1";}
var idCpt=obj.name.replace(/elem_procUnits_/g,"elem_cptCode_");var oCpt=gebi(idCpt);if(oCpt&&($.trim(oCpt.value)!="")){var objsbnr=getMxSB();setSBTodayCharges();}}}
function show_asmt_site(obj,dx,fop){var ch=$(obj)[0].id;if(typeof(ch)=="undefined"||ch.indexOf("elem_assessment_dxcode")==-1){return;}
var op=0;if(typeof(fop)!='undefined'&&fop!=''){op=fop;}else{op=(typeof(dx)!='undefined'&&dx!=''&&dx.indexOf("-")==-1)?1:0;}
var indx=ch.replace(/elem_assessment_dxcode/,"");if(op==1){$("#el_amst_site"+indx).parent().removeClass("hidden");$("#elem_assessment"+indx).parent().removeClass("col-sm-12").addClass("col-sm-11");var s="";if($("#elem_apOu"+indx).prop("checked")){s="OU";}
else if($("#elem_apOd"+indx).prop("checked")){s="OD";}
else if($("#elem_apOs"+indx).prop("checked")){s="OS";}
$("#el_amst_site"+indx).val(""+s);}else{$("#el_amst_site"+indx).parent().addClass("hidden");$("#elem_assessment"+indx).parent().addClass("col-sm-12").removeClass("col-sm-11");$("#el_amst_site"+indx).val("");}}
function checkDXCodesChart(obj){if(document.getElementById('tat_table'))return;var dxCd=$.trim(obj.value);var icd10=$("#hid_icd10").val();if(icd10==1){if(dxCd==""){obj.title="";}}
var fOk=false;if((dxCd!="")&&(dxCd.length>=3)){if(dxCd.indexOf("-")==-1){$(obj).removeClass('mandatory');}else{}
checkDB4Code(obj,"Dx");}else{obj.value=obj.title="";$(obj).removeData("dxid");renew_title(obj,'');if(obj.id.indexOf("elem_dxCode")!=-1){sb_crt_dx_dropdown();}}}
function checkModCodesChart(obj){if(document.getElementById('tat_table'))return;var mdCd=$.trim(obj.value);var fOk=false;if((mdCd!="")&&(mdCd.length>=2)){checkDB4Code(obj,"Md");}else{obj.value="";setSBTodayCharges();}}
function checkSBDxCodeFilled(obj,num){var oDx=gebi("elem_dxCode_"+num);if(obj.checked==true){if(oDx){obj.checked=($.trim(oDx.value)!="")?true:false;}else{obj.checked=false;}}}
function insertExamsDoneSB(arrED){var mxSbId=gebi("elem_mxSBId").value;var eTblSb=$("#tblSuperbill").get(0);var lenArrED=arrED.length;var arrDxCodesNotUsed=new Array();for(var j=0;j<lenArrED;j++){if((typeof arrED[j]!="undefined")){var flag=true;var oRows=eTblSb.rows;var lenTbl=oRows.length;var cTryAgain=0;for(var b=0;b<lenTbl;b++){if(oRows[b]){var tCptId=oRows[b].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var cCpt=(oCpt)?$.trim(oCpt.value):null;if(oCpt&&(cCpt!="")&&(cCpt==arrED[j]["cpt"])){var tMdId=tCptId.replace(/elem_cptCode_/,"elem_modCode_");var curMd="",insrtMd="";for(var inMd=1;inMd<=4;inMd++){var oMd=gebi(tMdId+"_"+inMd);curMd+=((oMd)&&(typeof oMd.value!=""))?oMd.value:"";insrtMd+=(typeof arrED[j]["modifier"+inMd]!="undefined")?arrED[j]["modifier"+inMd]:"";}
var tUntId=tCptId.replace(/elem_cptCode_/,"elem_procUnits_");var curUnt="",insrtUnt="";var oUnt=gebi(tUntId);curUnt=((oUnt)&&(typeof oUnt.value!=""))?oUnt.value:"";insrtUnt=(typeof arrED[j]["units"]!="undefined")?arrED[j]["units"]:"";if(insrtMd==curMd&&curUnt==insrtUnt){if(cCpt=="92133"&&arrED[j]["norepeat"]==0){cTryAgain=cTryAgain+1;}else if(cCpt.indexOf("J")!=-1&&curMd=="JW"){}else{flag=false;break;}}}}}
if(cTryAgain>=2){flag=false;}
if(flag==true){var v_prc_o_visit=$("#elem_proc_only_visit").val();v_prc_o_visit=(typeof(v_prc_o_visit)!="undefined"&&v_prc_o_visit==1)?0:1;for(var k=v_prc_o_visit;k<lenTbl;k++){var rowId=oRows[k].id.replace(/elem_trSB/,"");var tCptId="elem_cptCode_"+rowId;var oCpt=gebi(tCptId);if(oCpt&&(($.trim(oCpt.value)==""))){oCpt.value=arrED[j]["cpt"];oCpt.title=arrED[j]["cptDesc"];if(typeof(arrED[j]["valid_dxcodes"])!="undefined"&&arrED[j]["valid_dxcodes"]!=""){oCpt.setAttribute("valid_dxcodes",""+arrED[j]["valid_dxcodes"]);}
var oMod=gebi("elem_modCode_"+(rowId)+"_1");if(oMod&&(typeof arrED[j]["modifier1"]!="undefined")){oMod.value=arrED[j]["modifier1"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_2");if(oMod&&(typeof arrED[j]["modifier2"]!="undefined")){oMod.value=arrED[j]["modifier2"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_3");if(oMod&&(typeof arrED[j]["modifier3"]!="undefined")){oMod.value=arrED[j]["modifier3"];}
var oMod=gebi("elem_modCode_"+(rowId)+"_4");if(oMod&&(typeof arrED[j]["modifier4"]!="undefined")){oMod.value=arrED[j]["modifier4"];}
var ounits=gebi("elem_procUnits_"+(rowId));if(ounits&&(typeof arrED[j]["units"]!="undefined")){ounits.value=arrED[j]["units"];}
var dxcntr=1;while(true){if(typeof(arrED[j]["dx"+dxcntr])!="undefined"){var indEmptyDxCd=null;var flgSet=false;for(var d=1;d<=12;d++){var oDx=gebi("elem_dxCode_"+d);if(oDx&&($.trim(oDx.value)!="")){var tdx=$.trim(oDx.value);var tdxId=$(oDx).data("dxid");if(typeof tdxId=="undefined"){tdxId="";}
var tdx1=tdx,tdx2=tdx,tdx3=tdx;if(arrED[j]["dx"+dxcntr].indexOf("-")!=-1){var tdx1=""+tdx.slice(0,-1)+"-";var tdx2=""+tdx.slice(0,-2)+"--";var tdx3=""+tdx.slice(0,-3)+"-x-";}
if(tdx==arrED[j]["dx"+dxcntr]||tdx1==arrED[j]["dx"+dxcntr]||tdx2==arrED[j]["dx"+dxcntr]||tdx3==arrED[j]["dx"+dxcntr]){var flgDxIdNM=1;if(tdxId!=""&&typeof arrED[j]["dx"+dxcntr+"Id"]!="undefined"&&$.trim(arrED[j]["dx"+dxcntr+"Id"])!=$.trim(tdxId)){flgDxIdNM=0;}
var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDxElem&&flgDxIdNM==1){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["dx"+dxcntr]));flgSet=true;break;}}}else if(oDx&&($.trim(oDx.value)=="")&&(indEmptyDxCd==null)){indEmptyDxCd=d;}}
if((flgSet==false)){if(indEmptyDxCd!=null){var oDx=gebi("elem_dxCode_"+indEmptyDxCd);var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDx){oDx.value=""+arrED[j]["dx"+dxcntr];var ttitle=(typeof arrED[j]["dx"+dxcntr+"Desc"]!="undefined")?""+arrED[j]["dx"+dxcntr+"Desc"]:"";renew_title(oDx,ttitle);var tdxid=(typeof arrED[j]["dx"+dxcntr+"Id"]!="undefined")?arrED[j]["dx"+dxcntr+"Id"]:"";$(oDx).data("dxid",tdxid);$(oDx).triggerHandler("blur");if(oDxElem){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["dx"+dxcntr]));flgSet=true;}}}else{var tmp=(typeof arrED[j]["dx"+dxcntr+"Desc"]!="undefined")?""+arrED[j]["dx"+dxcntr+"Desc"]:"";arrDxCodesNotUsed[arrDxCodesNotUsed.length]=new Array(arrED[j]["dx"+dxcntr],tmp);}}}else{break;}
dxcntr=dxcntr+1;if(dxcntr>50){break;}}
for(var ia=1;ia<=4;ia++){if(typeof arrED[j]["adx"+ia]!="undefined"&&arrED[j]["adx"+ia]!=""){for(var d=1;d<=12;d++){var oDx=gebi("elem_dxCode_"+d);if(oDx&&($.trim(oDx.value)!="")){var flgMtch=0;if($("#hid_icd10").val()=="1"){var p0=$.trim(""+arrED[j]["adx"+ia].toLowerCase());var q=q0=$.trim(""+oDx.value.toLowerCase());var q1=""+q0.slice(0,-1)+"-";var q2=""+q0.slice(0,-2)+"--";var q3=""+q0.slice(0,-3)+"-x-";if(q0==p0||q1==p0||q2==p0||q3==p0){flgMtch=1;}}else{if(($.trim(oDx.value)==arrED[j]["adx"+ia])){flgMtch=1;}}
if(flgMtch==1){var oDxElem=gebi("elem_dxCodeAssoc_"+(rowId));if(oDxElem){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(rowId),'',new Array(arrED[j]["adx"+ia]));break;}}}}}}
if(sup_enc==1){opAddCptRow("LASTINDX",'','','',sup_enc);}else{opAddCptRow("LASTINDX");}
break;}}}}}
setSBTodayCharges();if(arrDxCodesNotUsed.length>0){}
var objsbnr=getMxSB(1);}
function getSelPQRICodes(actn){var oDiv=gebi("divChoosePqriCodes");if(actn==0){oDiv.style.display="none";return;}
var mxSbId=gebi("elem_mxSBId").value;var selectedCode=gebi("elem_procOrder").value;var oElems=oDiv.getElementsByTagName("INPUT");var len=oElems.length;var arrChoosenPqri=new Array();for(var i=0;i<len;i++){if((oElems[i].type=="checkbox")&&(oElems[i].checked==true)){var tmpCode=oElems[i].value;var tmpDx=oElems[i].getAttribute("dx");if(selectedCode.indexOf(tmpCode)==-1){arrChoosenPqri[arrChoosenPqri.length]=[tmpCode,tmpDx];}}}
oDiv.style.display="none";if(arrChoosenPqri.length>0){for(var x in arrChoosenPqri){var cpt=arrChoosenPqri[x][0];var dx=arrChoosenPqri[x][1];var tmpDesc=getCptDescJs(cpt);var oVal={"cptCode":cpt,"procId":"","units":1,"arrDx":[dx],"arrMd":new Array(),"cptDesc":tmpDesc};if(sup_enc==1){opAddCptRow(1,oVal,1,'',sup_enc);}else{opAddCptRow(1,oVal,1);}}}
var objsbnr=getMxSB(1);}
var setVisitProcedure_nochk=0;function setVisitProcedure(ccode)
{var mxSbId=gebi("elem_mxSBId").value;if(!isVisitCodeUsed(ccode)){return;}
var arrED=new Array();var arrtemp=new Array();arrtemp["cpt"]=ccode;arrED[arrED.length]=arrtemp;var cFlag=false;var eTblSb=gebi("tblSuperbill");var oRows=eTblSb.rows;var lenRows=oRows.length;for(var i=0;i<lenRows;i++){if(typeof oRows[i].id=="undefined"||oRows[i].id==""){continue;}
var tCptId=oRows[i].id.replace(/elem_trSB/,"elem_cptCode_");var oCpt=gebi(tCptId);var sCpt=$.trim(oCpt.value);if((sCpt=="92001")||(sCpt=="92011")||(sCpt=="92002")||(sCpt=="92012")||(sCpt=="92004")||(sCpt=="92014")||(sCpt=="99201")||(sCpt=="99202")||(sCpt=="99203")||(sCpt=="99204")||(sCpt=="99205")||(sCpt=="99241")||(sCpt=="99242")||(sCpt=="99243")||(sCpt=="99244")||(sCpt=="99245")||(sCpt=="99211")||(sCpt=="99212")||(sCpt=="99213")||(sCpt=="99214")||(sCpt=="99215")){sCpt="";}
if(oCpt&&(sCpt=="")){oCpt.value=ccode;oCpt.title=getCptDescJs(ccode);cFlag=true;setVisitProcedure_nochk=1;if(typeof oCpt.onblur=="function"){oCpt.onblur();}
for(var j=1;j<=12;j++){var oEDx=gebi("elem_dxCode_"+j);if(oEDx.value!=""){if(sb_objRefraction.isRef==1&&sb_objRefraction.dxCode==oEDx.value){continue;}
var oT=gebi("elem_dxCodeAssoc_"+(i+1));if(oT){sb_crt_dx_dropdown("#elem_dxCodeAssoc_"+(i+1),'',new Array(oEDx.value));}}}
break;}}
if(cFlag==false){var arrDx=new Array();for(var i=0;i<12;i++){var oEDx=gebi("elem_dxCode_"+(i+1));if(oEDx.value!=""){if(sb_objRefraction.isRef==1&&sb_objRefraction.dxCode==oEDx.value){continue;}
arrDx[arrDx.length]=""+oEDx.value;}}
var ccodeDesc=getCptDescJs(ccode);var oVal={"cptCode":ccode,"procId":"","units":1,"arrDx":arrDx,"arrMd":new Array(),"cptDesc":ccodeDesc};opAddCptRow(mxSbId,oVal);}}
var decodePatientCategory=1;function getPatientCategoryCode(str,pracbillcode)
{category=false;if((decodePatientCategory==1)&&(str!=null))
{switch(str)
{case"New":case"0":category="0";break;case"Establish":case"1":category="1";break;case"Consult":case"2":case"4":category="4";if(pracbillcode==920){var newpt=$("#elem_ptcategory_consult").val();category=1;if(newpt==0||newpt=="New"){category="0";}}
break;}}
return category;}
function decideNewPatient(obj)
{var val=obj.value;if($("input[type=checkbox][id*=el_sb_pt_type_]").length>0){$("input[type=checkbox][id*=el_sb_pt_type_]").each(function(inx){if(obj.checked&&this.value!=val&&this.checked){this.checked=false;}});var val=$(":checked[id*=el_sb_pt_type_]").val();if(typeof(val)=="undefined"||val==""){val="No_confirmed";}}
var ctop=top;if(top.fmain){ctop=top.fmain;}
var objCategory=gebi("elem_category");if((val=="1")||(val=="Yes")||(val=="Yes_confirmed"))
{objCategory.value="New";decodePatientCategory=1;}
else
{objCategory.value="Establish";decodePatientCategory=1;}
if((val=="Yes_confirmed")||(val=="No_confirmed")){$("#elem_flgIsPtNew").val(val);var oPBC=gebi("elem_practiceBillCode");var oComp=gebi("elem_levelComplexity");if((oComp&&oComp.value!="")||oPBC.value=="920"||$("#elem_post_op_visit").val()=="1"||$("#elem_proc_only_visit").val()=="1"){if(typeof(flg_checkAssocPqri4All_checkvisitcode)!="undefined"&&flg_checkAssocPqri4All_checkvisitcode!=0&&flg_checkAssocPqri4All_checkvisitcode!=""){checkAssocPqri4All_checkvisitcode(flg_checkAssocPqri4All_checkvisitcode);}else{checkAssocPqri4All();}}
return;}
if((val=="Yes")||(val=="No")){confirmVisitCode_v3();}else{confirmVisitCode_v2();}}
var decideLevelofService2_obj_id;function decideLevelofService2(val)
{if((val!="-1")&&($.trim(val)!="")&&($.trim(val)!="OK")){if(val=="Eye Code"){val=$(":checked[id*=lb_qlfy_lvl_code920]").eq(0).val();}else if(val=="EM Code"){val=$(":checked[id*=lb_qlfy_lvl_code992]").eq(0).val();}
setVisitCode(val,decideLevelofService2_obj_id);}
decideLevelofService2_obj_id="";$("#dialog-Mdc-cum-new-pt").remove();}
function getVisitCode()
{var objPracticeBillCode=gebi("elem_practiceBillCode");var objCategory=gebi("elem_category");var objLevelOfService=gebi("elem_levelOfService");var objVisitCode=gebi("elem_visitCode");var visitCode=category="";if(objCategory.value!=null&&objPracticeBillCode!=null)
{category=getPatientCategoryCode(objCategory.value,objPracticeBillCode.value);}
if(objPracticeBillCode&&objCategory&&objLevelOfService&&objVisitCode)
{visitCode=objPracticeBillCode.value+category+objLevelOfService.value;}
var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var iscodeOk=visitCode.match(reg);return(iscodeOk)?visitCode:false;}
function setVisitCode(val,flg_chk_mlti){var objVisitCode=gebi("elem_visitCode");var vCode=(typeof val!="undefined")?val:false;if(vCode!=false){if(typeof(flg_chk_mlti)!="undefined"&&flg_chk_mlti!=""){setVisitProcedure_nochk=1;checkDB4Code_chk_versions=1;$("#"+flg_chk_mlti).val(vCode).triggerHandler("blur");}
else{checkDB4Code_chk_versions=1;objVisitCode.value=vCode;objVisitCode.onchange();}
var objsbnr=getMxSB();setSBTodayCharges();fun_mselect('.selectpicker','width');}}
function isVisitCodeUsed(cCd){if(typeof(sb_multi_vst_cd_noalert)!="undefined"&&sb_multi_vst_cd_noalert==1){return true;}
var selectedCode=gebi("elem_procOrder").value;if(selectedCode.indexOf(cCd)!=-1)
{top.fAlert("CPT Code "+cCd+" is already selected.");return false;}
return true;}
function setVisitCodeFinal(objElem)
{var ptrn="^[0-9]{5}$";var reg=new RegExp(ptrn,"g");var matched=objElem.value.match(reg);if(matched)
{if(isVisitCodeUsed(objElem.value)){setVisitProcedure(objElem.value);}}else if(objElem.value==sb_cpt_code_poe){setVisitProcedure(objElem.value);}}
function getWantedDxCodes(flgnw){var oDivDxCode=gebi("divChooseDxCodes");var oElem=oDivDxCode.getElementsByTagName("INPUT");var len=oElem.length;var strdx="",dsc_tmp="";var arr=new Array(),arr_id=new Array();for(i=0;i<len;i++){if(oElem[i].name.indexOf("Lat")!=-1||oElem[i].name.indexOf("Svr")!=-1||oElem[i].name.indexOf("Stg")!=-1){continue;}
var t_dxid=$.trim($(oElem[i]).data("dxid"));if(typeof(t_dxid)=="undefined"||t_dxid==""){t_dxid="";}
if((oElem[i].type=="checkbox")&&(oElem[i].checked==true)){if(($.trim(oElem[i].value)!=""&&(arr.indexOf(oElem[i].value)==-1||(t_dxid!=""&&arr_id.indexOf(t_dxid)==-1)))&&$(oElem[i]).parents("tr").css("display")!="none"){arr[arr.length]=oElem[i].value;arr_id[arr_id.length]=t_dxid;}}else if((oElem[i].type=="text")&&(oElem[i].value!="")){if(arr.indexOf(oElem[i].value)==-1||(t_dxid!=""&&arr_id.indexOf(t_dxid)==-1)){arr[arr.length]=oElem[i].value;arr_id[arr_id.length]=t_dxid;}}}
if(arr.length>12){top.fAlert("You can choose maximum twelve dx codes.");}else{for(var i=0,j=0;j<12;j++){var oDxCode=gebi("elem_dxCode_"+(i+1));var tmp=((typeof arr[j]!="undefined"))?$.trim(arr[j]):"";var tmp_dxid=((typeof arr_id[j]!="undefined"))?$.trim(arr_id[j]):"";if((oDxCode)&&(($.trim(oDxCode.value)=="")||(typeof oDxCode.value=="undefined"))&&((typeof tmp!="undefined")&&(tmp!=""))){dx_exist=0;$("input[name^='elem_dxCode_']").each(function(index,element){if($(this).val()!=""&&$(this).val()==tmp&&$(this).data("dxid")==tmp_dxid){dx_exist=1;}});if(dx_exist==0){oDxCode.value=tmp;$(oDxCode).data("dxid",tmp_dxid);if(strdx!=""){strdx+=",";}
strdx+=tmp;i++;}}else{}}
oDivDxCode.style.display="none";setTimeout(function(){set_dx_code_titles();},100);if(typeof(flgnw)!="undefined"&&flgnw=="get_proc_dx_codes"){ogetprocdxcodes.dx=strdx.split(",");fill_codes_in_proc_sb(ogetprocdxcodes);}else{checkAssocPqri4All();}}}
function isSuperBillMade(){var SBill=false;var DXCodeOK=false;var DXCodeAssocOK=true;var CptNotAssoc="";var DXCodeComplete=true;var dxids="";var c_ophth_cd=0;var tbl=$("#tblSuperbill").get(0);if(tbl){var len=(gebi("elem_mxSBId"))?gebi("elem_mxSBId").value:0;var lastRow=(tbl.length>0)?tbl.rows.length:0;len=(typeof len=="undefined")?0:len;for(var i=0;i<len;i++){var tmp=gebi("elem_trSB"+(i+1));if(tmp==null){continue;}
var temp=gebi("elem_cptCode_"+(i+1));if(($.trim(temp.value)!="")){SBill=true;var tempAssoc=false;var elemDxAssoc=$("#elem_dxCodeAssoc_"+(i+1));var valDxAssoc=""+fun_mselect("#elem_dxCodeAssoc_"+(i+1),'val');if(valDxAssoc!=null&&typeof(valDxAssoc)!="undefined"&&$.trim(valDxAssoc)!=""&&valDxAssoc.indexOf("-")==-1){tempAssoc=true;}
if(tempAssoc==false){DXCodeAssocOK=false;CptNotAssoc+="\n\t-"+temp.value+"";}
if(has_ophtha_code(temp)){c_ophth_cd=c_ophth_cd+1;}}}
if(SBill==true){for(var i=0;i<12;i++){var oDxCode=$("#elem_dxCode_"+(i+1));var t=$.trim(oDxCode.val());var tdx="";if((t!="")){DXCodeOK=true;if(t.indexOf("-")!=-1){DXCodeComplete=false;}
var dxid=oDxCode.data("dxid");if(typeof(dxid)!="undefined"&&dxid!=""){tdx=dxid;}}
dxids=dxids+""+tdx+";";}}
var mul_ophth_cd=(c_ophth_cd>=2)?true:false;}
return{"SBill":SBill,"DXCodeOK":DXCodeOK,"DXCodeAssocOK":DXCodeAssocOK,"CptNotAssoc":CptNotAssoc,"DXCodeComplete":DXCodeComplete,"dxids":dxids,"mul_ophth_cd":mul_ophth_cd};}
function promptMedDecCom(opSB){var flg=0;if(opSB=="1"){flg=1;}
var oPrnt=top.fmain;var strPrnt="top.fmain";if(typeof(wpage)!="undefined"&&wpage=="accSB"){oPrnt=top;strPrnt="top";}
var msg=""+"<label style=\"width:250px;display:inline-block;\"><b>Medical Decision Complexity :</b> </label>"+"<div id=\"divmdc\" style=\"\">"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Strght\" value=\"1\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Strght\" >Straight Forward</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Low\" value=\"2\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Low\" >Low Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_Moderate\" value=\"3\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_Moderate\" >Moderate Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_High\" value=\"4\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_High\" >High Complexity</label>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_procovisit\" value=\"5\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_procovisit\" >Procedure only Visit</label><br/>"+"<input type=\"checkbox\" id=\"elem_chkMedComp_postopvisit\" value=\"6\" onclick=\""+strPrnt+".setMedComplexity(this,"+flg+")\"><label for=\"elem_chkMedComp_postopvisit\" style=\"float:right;margin-top:10px;\" >Post Op Visit</label>"+"</div>"+"";return""+msg;}
function sb_check_dx_in_icd10(str_n,str_h){flgMtch=0;if($("#hid_icd10").val()=="1"){var p0=$.trim(""+str_n.toLowerCase());var q=q0=$.trim(""+str_h.toLowerCase());var q1=""+q0.slice(0,-1)+"-";var q2=""+q0.slice(0,-2)+"--";var q3=""+q0.slice(0,-3)+"-x-";var p1=""+p0.slice(0,-1)+"-";var p2=""+p0.slice(0,-2)+"--";var p3=""+p0.slice(0,-3)+"-x-";if(q0==p0||q1==p0||q2==p0||q3==p0||q0==p1||q0==p2||q0==p3){flgMtch=1;}
else if(q0.indexOf(p0)!=-1||q1.indexOf(p0)!=-1||q2.indexOf(p0)!=-1||q3.indexOf(p0)!=-1||p0.indexOf(q0)!=-1||p1.indexOf(q0)!=-1||p2.indexOf(q0)!=-1||p3.indexOf(q0)!=-1){flgMtch=1;}}
return flgMtch;}
function sb_crt_dx_dropdown(objid,flgSetEmpty,arrmoresel,olddx){var all_rec=new Array;var all_rec_title=new Array;var all_rec_old=new Array;var all_rec_id=new Array;var ptrnChckd=".dxallcodes[id*=elem_dxCode_]";$(""+ptrnChckd).each(function(){if($(this).val()!=""){all_rec.push($(this).val());var tdsc=$(this).attr("data-original-title");if(typeof(tdsc)=="undefined"||$.trim(tdsc)==""){tdsc=$(this).attr("title");if(typeof(tdsc)=="undefined"){tdsc="";}}
all_rec_title.push(tdsc);var tmpid=$(this).attr("id");var oldid=tmpid.replace("elem_dxCode","dx_oldCode");all_rec_old.push($("#"+oldid).val());var tdxid=$(this).data("dxid");if(typeof(tdxid)=="undefined"){tdxid="";}
all_rec_id.push(tdxid);}else{all_rec.push('');all_rec_title.push('');all_rec_old.push('');all_rec_id.push('');}});var txtRec="";var txtRecTitle="";var txtRecOld="";var txtRecId="";var all_rec_tmp=[];var all_rec_title_tmp=[];var all_rec_old_tmp=[];var all_rec_id_tmp=[];for(var s=0;s<12;s++){var tmpRec=$.trim(all_rec[s]);var tmpRecid=$.trim(all_rec_id[s]);var tmpRecTitle=$.trim(all_rec_title[s]);var tchk=tmpRec+tmpRecTitle+",";var tmpRecOld=$.trim(all_rec_old[s]);if(tmpRec!=""&&txtRec.indexOf(tchk)==-1){txtRec+=tchk;all_rec_tmp[s]=tmpRec;all_rec_id_tmp[s]=tmpRecid;all_rec_title_tmp[s]=tmpRecTitle;all_rec_old_tmp[s]=tmpRecOld;}}
all_rec=all_rec_tmp;all_rec_title=all_rec_title_tmp;all_rec_old=all_rec_old_tmp;all_rec_id=all_rec_id_tmp;var ptrn="select.diagText_all_css";if(typeof(objid)=="string"&&objid!=""){ptrn=objid;}
$(""+ptrn).each(function(){if(this.type!="select-multiple"){return true;}
var all_opt_data="";var dd_title="";if(flgSetEmpty!=1){var sel_val_arr=fun_mselect(this,'val');}
if(typeof(arrmoresel)!="undefined"&&arrmoresel!=""&&arrmoresel.length>0){if(typeof(sel_val_arr)=="undefined"||sel_val_arr==null||sel_val_arr==''){var sel_val_arr=[];}
sel_val_arr=sel_val_arr.concat(arrmoresel);}
if(typeof sel_val_arr!="undefined"&&sel_val_arr!=null&&sel_val_arr!=''){for(x in all_rec){if(all_rec[x]!=""){var sel_opt="";var yy=parseInt(x)+1;var chk_sel_rec=all_rec[x]+'**'+yy;var chk_sel_rec2=all_rec[x];if(typeof(olddx)!="undefined"&&olddx==1){var chk_sel_rec_old=all_rec_old[x]+'**'+yy;var chk_sel_rec2_old=all_rec_old[x];if($.inArray(chk_sel_rec_old,sel_val_arr)!=-1||$.inArray(chk_sel_rec2_old,sel_val_arr)!=-1){sel_opt="selected";}}else{if($.inArray(chk_sel_rec,sel_val_arr)!=-1||$.inArray(chk_sel_rec2,sel_val_arr)!=-1){sel_opt="selected";}else{for(var cc in sel_val_arr){var str_n=""+sel_val_arr[cc].split("**")[0];if(sb_check_dx_in_icd10(str_n,chk_sel_rec2)){sel_opt="selected";}}}}
var chk_title=all_rec_title[x];if(typeof(chk_title)=="undefined"){chk_title="";}
if(sel_opt=="selected"){dd_title+=""+all_rec[x]+" - "+chk_title+"\n";}
all_opt_data+='<option value="'+chk_sel_rec+'" '+sel_opt+' data-desc="'+chk_title+'"  >'+all_rec[x]+'</option>';}}}else{for(x in all_rec){if(all_rec[x]!=""){var yy=parseInt(x)+1;var chk_title=all_rec_title[x];if(typeof(chk_title)=="undefined"){chk_title="";}
all_opt_data+='<option value="'+all_rec[x]+'**'+yy+'" data-desc="'+chk_title+'" >'+all_rec[x]+'</option>';}}}
var tmpid=$(this).attr("id");$("#"+tmpid).attr("title",dd_title).attr("data-original-title",dd_title).html(all_opt_data);fun_mselect("#"+tmpid,'refresh');if(dd_title==""){fun_mselect("#"+tmpid,'settitle','');}});fun_mselect('.selectpicker','width');}
function sb_set_dx_typeahead_icd10(action){getDataFilePath="../common/getICD10data.php";for(var j=1;j<=12;j++){if(document.getElementById('enc_icd10').value==1){bind_autocomp($("#elem_dxCode_"+j),getDataFilePath);$('.diagText_span_'+j).css({"display":"table-cell"});}}}
function sb_copy_dx_codes(flgfrst){sb_cw4WD_flgnoalert=1;var copyvalues=[];$(".cptcode").each(function(){var id=this.id;var val=$.trim(this.value);var indx=id.replace("elem_cptCode_","");if(indx=="1"){copyvalues=fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'val');if(typeof(flgfrst)!="undefined"&&flgfrst==1){copyvalues.length=1;}}else{if(val==""){}else{if(copyvalues.length>0){fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'select',copyvalues);}}
fun_mselect("select[id=elem_dxCodeAssoc_"+indx+"]",'render');}
sb_checknwarn4WrongDxcode(this);});fun_mselect('.selectpicker','width');sb_cw4WD_flgnoalert="";}
function icd10_charts_popup(show_pop,obj,str,input_id){var str_val=(str.toLowerCase()).replace(">>","");if(show_pop==1){if(js_icd10_charts_data_arr){if($("#dialog-msg-charts").length<=0){$("body").append(js_icd10_charts_data_arr[str_val]);}
if(str_val=='congenital'){var wid=815;}else{var wid=500;}
$("#dialog-msg-charts").show().dialog({modal:true,width:wid,buttons:{Done:function(){icd10_charts_popup(0,'','',input_id);},Cancel:function(){$(this).dialog("destroy");$("#dialog-msg-charts").remove();}}});}}else{if(obj.id){var charts_chk_box_id=obj.id;if(($('#dialog-msg-heading').val()).toLowerCase()=="congenital"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_cong").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}else{if(obj.value.toLowerCase()=="unspecified"){if($('#'+charts_chk_box_id).is(':checked')==true){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"gray","font-weight":"normal"}).removeClass("highlight");this.checked=false;});}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else if(obj.value.toLowerCase()=="alternating"){if($('#'+charts_chk_box_id).is(':checked')==true){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});$(".alternating_css").each(function(){$('label[for='+this.id+']').css({"color":"gray","font-weight":"normal"}).removeClass("highlight");this.checked=false;});}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else{if($('#elem_sub_unspecified').is(':checked')==true){if(obj.value.toLowerCase()!="monocular"&&obj.value.toLowerCase()!="alternating"){$(".unspecified_css").each(function(){this.checked=false;});return;}else{$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}else if($('#elem_sub_alternating').is(':checked')==true){if(obj.value.toLowerCase()=="left"||obj.value.toLowerCase()=="right"){$(".alternating_css").each(function(){this.checked=false;});return;}else{if(obj.value.toLowerCase()=="monocular"){$(".unspecified_css").each(function(){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"});});}}}}
if(obj.value.toLowerCase()=="unspecified"||obj.value.toLowerCase()=="monocular"||obj.value.toLowerCase()=="alternating"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts1").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
if(obj.value.toLowerCase()=="a"||obj.value.toLowerCase()=="v"||obj.value.toLowerCase()=="intermittent"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts2").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}
if(obj.value.toLowerCase()=="right"||obj.value.toLowerCase()=="left"){$('label[for='+charts_chk_box_id+']').css({"color":"red","font-weight":"bold"}).addClass("highlight");$(".elem_sub_charts3").each(function(){if(this.id!=charts_chk_box_id||$('#'+charts_chk_box_id).is(':checked')==false){$('label[for='+this.id+']').css({"color":"purple","font-weight":"normal"}).removeClass("highlight");this.checked=false;}});}}}else{var charts_val1="";var charts_val2="";var charts_val3="";var main_charts_val=$('#dialog-msg-heading').val();main_charts_val=main_charts_val.toLowerCase();if(main_charts_val=="congenital"){var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var ass_dx_id="elem_assessment_dxcode"+full_ass_id;$(".elem_sub_cong").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){var charts_val_ass_dx=$('#'+charts_chk_box_id).val();var charts_val_ass=$('#'+charts_chk_box_id+"_desc").val();$('#'+ass_id).val(charts_val_ass);$('#'+ass_dx_id).val(charts_val_ass_dx);$("#dialog-msg-charts").remove();return;}});}else{var selected_opt_arr=new Array();var arr_i=0;selected_opt_arr[arr_i]=main_charts_val;$(".elem_sub_charts1").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val1=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val1;}});$(".elem_sub_charts2").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val2=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val2;}});$(".elem_sub_charts3").each(function(){var charts_chk_box_id=this.id;if($('#'+charts_chk_box_id).is(':checked')==true){charts_val3=$('#'+charts_chk_box_id).val();arr_i++;selected_opt_arr[arr_i]=charts_val3;}});for(var j=0;j<=js_icd10_charts_all_data_arr[main_charts_val].length;j++){var dx_flag_cont=0;if(typeof(js_icd10_charts_all_data_arr[main_charts_val][j])!="undefined"){var dx_org_val=js_icd10_charts_all_data_arr[main_charts_val][j].split('>>>');}else{var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var v=$("#"+ass_id).val();if(typeof(v)=="undefined"){v="";}
if(v!=""){v=v.replace(/>/g,'');$("#"+ass_id).val(v);}
$("#dialog-msg-charts").remove();return;}
var dx_org_val=js_icd10_charts_all_data_arr[main_charts_val][j].split('>>>');var dx_org_val_desc_spt=dx_org_val[0].split(',');var dx_org_val_desc="";for(var g=0;g<dx_org_val_desc_spt.length;g++){dx_org_val_desc+=dx_org_val_desc_spt[g];}
var dx_org_val_desc_exp=dx_org_val_desc.split(' ');if(dx_org_val[1]!=""){var dx_org_val_code=dx_org_val[1];for(var k=0;k<=dx_org_val_desc_exp.length;k++){var dx_org_val_desc_exp_final=dx_org_val_desc_exp[k];for(var l=0;l<selected_opt_arr.length;l++){if(selected_opt_arr[l]!=""){if(selected_opt_arr[l]==dx_org_val_desc_exp_final){dx_flag_cont=parseInt(dx_flag_cont)+1;}}}}}
if(selected_opt_arr.length==dx_flag_cont){var full_ass_id=input_id.replace("elem_assessment_dxcode","");full_ass_id=full_ass_id.replace("elem_assessment","");var ass_id="elem_assessment"+full_ass_id;var ass_dx_id="elem_assessment_dxcode"+full_ass_id;var elem_sub_ass_comm="";if($('#elem_sub_ass_comm').val()!=""){elem_sub_ass_comm=" ; \n"+$('#elem_sub_ass_comm').val();}
$('#'+ass_id).val(dx_org_val[0]+elem_sub_ass_comm);$('#'+ass_dx_id).val(dx_org_val_code);$("#dialog-msg-charts").remove();$("#"+ass_id).triggerHandler("click");$("#"+ass_id).triggerHandler("blur");$("#"+ass_id).triggerHandler("change");$("#"+ass_id).triggerHandler("keyup");return;}}}}}}
function isVisitCodeExits(){if(typeof(sb_cpt_code_poe)=="undefined"){sb_cpt_code_poe="";}
var allVisCd=["999",""+sb_cpt_code_poe,"92002","92012","92004","92014","99201","99202","99203","99204","99205","99211","99212","99213","99214","99215","99241","99242","99243","99244","99245","99024"];var ret=-1;var ln=$(".cptcode").length;for(var i=0;i<ln;i++){var v=$(".cptcode").eq(i).val();if(v!=""){if(allVisCd=="")continue;if(jQuery.inArray(v,allVisCd)!=-1){return 1;}else{ret=0;}}}
return ret;}
var set_multi_version_cpt_id;function set_multi_version_cpt(s){if(s==1&&typeof(set_multi_version_cpt_id)!="undefined"&&set_multi_version_cpt_id!=""){var x=$("#dialog-confirm :checked[name=el_multi_version_cpts]").val();if(typeof(x)!="undefined"&&x!=""){$("#"+set_multi_version_cpt_id).val(x).triggerHandler("blur");}}}
var checkDB4Code_flg=0;checkDB4Code_chk_versions="";function checkDB4Code(obj,str,type,cnfrm){if(cnfrm&&typeof(obj)=="string"){obj=document.getElementById(obj);}
if($.trim(obj.value).length==0||checkDB4Code_flg==1)
{return;}
var chk_versions=checkDB4Code_chk_versions;var type_chk=type;if(type_chk=="account"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode="diag1Text_";var elem_asDx="diag1Text_";}else if(type_chk=="superbill"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode=obj.name;var elem_asDx=obj.name;var elem_assessment_dxcode=obj.name;}else if(type_chk=="Procedures"){var url=zPath+"/chart_notes/requestHandler.php";var elem_dxCode=obj.name;var elem_asDx=obj.name;var elem_assessment_dxcode=obj.name;}else{var url=(typeof(wpage)!="undefined"&&wpage=="accSB")?zPath+"/chart_notes/requestHandler.php":zPath+"/chart_notes/requestHandler.php";var elem_dxCode="elem_dxCode_";var elem_asDx="elem_asDx";var elem_assessment_dxcode="elem_assessment_dxcode";}
var params={"elem_formAction":str,"elem_desc":encodeURI(obj.value),"check_versions":chk_versions};var icd10=($("#hid_icd10").length>0)?$("#hid_icd10").val():$("#enc_icd10").val();if(icd10==1){params.ICD10=1;}
if(typeof(setProcessImg)!='undefined')setProcessImg("1","tblSuperbill");if(checkDB4Code_flg==0){checkDB4Code_flg=1;}
if((obj.name.indexOf(elem_dxCode)==-1)&&(obj.name.indexOf(elem_asDx)==-1)&&(obj.name.indexOf(elem_assessment_dxcode)==-1)&&type_chk!="account"){$.post(url,params,function(data){checkDB4Code_chk_versions="";if(typeof(setProcessImg)!='undefined')setProcessImg("0","tblSuperbill");checkDB4Code_flg=0;var strTmp=data.code;strTmp=(strTmp)?$.trim(strTmp):"";if(strTmp!=""){if(str=="Cpt"&&data.all_version&&data.all_version.length>0){var msg="";for(var x in data.all_version){if(typeof(data.all_version[x])!="undefined"&&data.all_version[x]!=""){msg+="<div class=\"radio radio-inline\"><input type=\"radio\" name=\"el_multi_version_cpts\" id=\"el_multi_version_cpts"+x+"\" value=\""+data.all_version[x]+"\" ><label for=\"el_multi_version_cpts"+x+"\">"+data.all_version[x]+"</label></div>";}}
if(msg!=""){set_multi_version_cpt_id=obj.id;obj.value="";displayConfirmYesNo_v2("Multiple versions of CPT exists. Choose one.",""+msg,"Insert","","set_multi_version_cpt","",0);return;}}
obj.value=strTmp;if(data.desc)obj.title=data.desc;if(str=="Cpt"){if(data.units){var unitId=obj.name.replace(/elem_cptCode_/i,"elem_procUnits_");var tmp=$("#"+unitId).data("unit");if(typeof(tmp)!="undefined"&&tmp!=""){data.units=tmp;}
$("#"+unitId).val(""+data.units);}
var mId=obj.name.replace(/elem_cptCode_/i,"elem_modCode_");var tmod="";for(var m=1,n=0;m<=4;m++){var t=$.trim($("#"+mId+"_"+m).val());if(tmod.indexOf(t)!=-1){$("#"+mId+"_"+m).val("");}
if(data.mod&&data.mod[n]){if(typeof(t)=="undefined"||t==""){$("#"+mId+"_"+m).val(""+data.mod[n]);tmod+=""+data.mod[n]+",";n++;}else{if(t==data.mod[n]){tmod+=""+data.mod[n]+",";n++;}}}}
if(data.cpt4_code){obj.setAttribute("cpt4code",data.cpt4_code);}
if(data.dx_codes){obj.setAttribute("valid_dxcodes",data.dx_codes);}else{obj.setAttribute("valid_dxcodes","");}
checkCptCodesChart(obj,1);}else if(str=="Md"){setSBTodayCharges();}}else{if(typeof(cnfrm)=="undefined"){if(top.fmain){top.fancyConfirm("Entered Text Does not match with any code.<br />Do you want to use this?",'','','top.fmain.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
else{top.fancyConfirm("Entered Text Does not match with any code.<br />Do you want to use this?",'','','top.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
return;}
else{obj.value=obj.title=obj.cpt4code="";obj.setAttribute("valid_dxcodes","");}}},'json');}
else{var dxid=$(obj).data("dxid");if(typeof(dxid)!="undefined"){dxid=$.trim(dxid);if($.trim(dxid)!=""&&$.trim(dxid)!="0"){params.dxid=dxid;}}
$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","tblSuperbill");checkDB4Code_flg=0;var xmlDoc=data;var arrDxCode=xmlDoc.getElementsByTagName("dxcode");var arrDxCodeDesc=xmlDoc.getElementsByTagName("dxcodedesc");var arrPqriCode=xmlDoc.getElementsByTagName("pqri");var arrDxCode_multi=xmlDoc.getElementsByTagName("otherdxCodes_multi");var arrDxCode_incomp=xmlDoc.getElementsByTagName("incomplete");var oDxCode=(arrDxCode.length>0)?xmlDoc.getElementsByTagName("dxcode")[0]:null;var oDxCodeDesc=(arrDxCodeDesc.length>0)?xmlDoc.getElementsByTagName("dxcodedesc")[0]:null;var oPqriCode=(arrPqriCode.length>0)?xmlDoc.getElementsByTagName("pqri")[0]:null;var oDxCode_multi=(arrDxCode_multi.length>0)?xmlDoc.getElementsByTagName("otherdxCodes_multi")[0]:null;var oDxCode_incomp=(arrDxCode_incomp.length>0)?arrDxCode_incomp[0]:null;if((oDxCode)&&(oDxCode.firstChild)){var tDx=$.trim(oDxCode.firstChild.data);if(type_chk!="account"&&type_chk!="superbill"){if((obj.name.indexOf("elem_asDx")!=-1)||(obj.name.indexOf("elem_assessment_dxcode")!=-1)){if(oDxCode_multi&&oDxCode_multi.firstChild.data){tDx=oDxCode_multi.firstChild.data+", "+tDx;}
obj.value=""+tDx;if(obj.name.indexOf("elem_asDx")!=-1){var tmp=$(obj).data("asindx");if(typeof(tmp)!="undefined"&&tmp!=""){var as_dx_id=tmp;}else{var as_dx_id=obj.name.replace(/(elem_asDx)/g,"");as_dx_id=as_dx_id.replace("_0","");as_dx_id=parseInt(as_dx_id)+1;}
$("#elem_assessment_dxcode"+as_dx_id).val(""+tDx);}else{var op=$.trim(oDxCode_incomp.firstChild.data);op=(op=="1")?"0":"1";show_asmt_site(obj,'',op);}
return;}}
fExists=false;for(var i=1;i<=12;i++){var oDxChk=document.getElementById("elem_dxCode"+i);if((oDxChk)&&($.trim(tDx)!="")&&(oDxChk.value==tDx)){fExists=true;if(oDxCodeDesc.firstChild){if($.trim(oDxCodeDesc.firstChild.data)!=""){renew_title(oDxChk,""+oDxCodeDesc.firstChild.data);}}}}
if(fExists==false){obj.value=tDx;if(oDxCodeDesc.firstChild){if($.trim(oDxCodeDesc.firstChild.data)!=""){renew_title(obj,""+oDxCodeDesc.firstChild.data);}}}}else{if($.trim(obj.value).substr(-2,2)=='>>'){return;}
$(obj).removeData("dxid");renew_title(obj,"");if(typeof(cnfrm)=="undefined"){if(top.fmain){top.fancyConfirm("Entered Text Does not match with any DxCode.<br />Do you want to use this?",'','','top.fmain.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}
else{top.fancyConfirm("Entered Text Does not match with any DxCode.<br />Do you want to use this?",'','','top.checkDB4Code("'+obj.id+'","'+str+'", "'+type+'",true)');}}
else{obj.value=obj.title="";}
return;}
if(obj.value!=""){var oPCodes=oPqriCode.childNodes;var len=oPCodes.length;var arrPqriCodes=new Array();var tmpCpt=[];for(var i=0;i<len;i++){if(oPCodes[i].firstChild){tmpCpt[tmpCpt.length]=oPCodes[i].firstChild.data;}}
if(tmpCpt.length>0){arrPqriCodes[obj.value]=tmpCpt;PqriSetter(arrPqriCodes);}}
sb_crt_dx_dropdown();},"xml");}}
function getRefInfoJs(giveonly){var arr=new Array();var len=$("#Vision #MR div[id*=row_mr_]").length;for(var i=1;i<=len;i++){var othr=(i>1)?"Other":"";var sfx=(i>2)?"_"+i:"";var ar1=new Array("elem_visMr"+othr+"OdS"+sfx,"elem_visMr"+othr+"OdC"+sfx,"elem_visMr"+othr+"OdA"+sfx,"elem_visMr"+othr+"OsS"+sfx,"elem_visMr"+othr+"OsC"+sfx,"elem_visMr"+othr+"OsA"+sfx,"elem_visMr"+othr+"OdAdd"+sfx,"elem_visMr"+othr+"OsAdd"+sfx,"elem_mrNoneGiven"+i);arr[arr.length]=ar1;}
var dx="";var flag=0;var eye="";for(var z in arr){var flg=isVisElemDone(arr[z]);if(flg){if(typeof(giveonly)!="undefined"&&giveonly=="1"){if($(":checked[name='"+arr[z][8]+"']").length<=0||!$(":checked[name='"+arr[z][8]+"']").hasClass("active")){continue;}}
flag=1;var add=gebi(arr[z][6]);var ads=gebi(arr[z][7]);var sd=gebi(arr[z][0]);var ss=gebi(arr[z][3]);if(eye==""){if(sd&&sd.value!=""){eye="OD";}
if(ss&&ss.value!=""){eye=(eye=="OD")?"OU":"OS";}}
if((add&&($.trim(add.value)!="")&&($.trim(add.value)!="+"))||(ads&&($.trim(ads.value)!="")&&($.trim(ads.value)!="+"))){dx="367.4";break;}else if((sd&&(sd.value!="-")&&(sd.value.indexOf("-")!=-1))||(ss&&(ss.value!="-")&&(ss.value.indexOf("-")!=-1))){dx="367.1";break;}else if((sd&&(sd.value!="+")&&(sd.value!=""))||(ss&&(ss.value!="+")&&(ss.value!=""))){dx="367.0";break;}}}
return{"flag":flag,"dx":dx,"eye":eye};}
function isAssessmentDone(){var lenAssess=$("#assessplan .planbox").length;for(var i=1;i<lenAssess;i++){var oAssess=gebi("elem_assessment"+i);if((oAssess)&&($.trim(oAssess.value)!="")){return true;}}
return false;}
function checkAssocPqri4All_getParam(cptcd){var params="elem_formAction=PQRI";params+="&elem_formId="+gebi("elem_masterId").value;for(var i=1,j=1;i<=12;i++,j++){var oDx=gebi("elem_dxCode_"+i);if(oDx&&(oDx.value!="")){params+="&elem_dxCode"+j+"="+oDx.value;}}
if(typeof getDCFA_strApId!="undefined"){params+="&elem_apid="+getDCFA_strApId;}
if($("#Vision").length>0){var oRefInfo=getRefInfoJs(sb_refGivenOnly);if(oRefInfo.flag==1){params+="&elem_refraction=1";params+="&elem_refractionDx="+oRefInfo.dx;params+="&elem_vision=1";params+="&elem_visionEye="+oRefInfo.eye;}else{var arrVisDis=new Array("elem_visDisOdSel1","elem_visDisOdSel2","elem_visDisOsSel1","elem_visDisOsSel2","elem_visDisOdTxt1","elem_visDisOdTxt2","elem_visDisOsTxt1","elem_visDisOsTxt2","elem_disDesc");var vis=(isVisElemDone(arrVisDis))?"1":"0";if(vis=="1"){params+="&elem_vision="+vis;params+="&elem_refraction=0";}else{params+="&elem_vision=0";params+="&elem_refraction=0";}}}else{params+="&elem_vision=db";params+="&elem_refraction=db";}
var oComp=gebi("elem_levelComplexity");if(oComp){var tmp=(typeof oComp.value!="undefined")?$.trim(oComp.value):"";params+="&elem_levelComplexity="+tmp;}
var opov=gebi("elem_proc_only_visit");if(opov){var tmp=(typeof opov.value!="undefined")?$.trim(opov.value):"";params+="&elem_proc_only_visit="+tmp;}
var opopv=gebi("elem_post_op_visit");if(opopv){var tmp=(typeof opopv.value!="undefined")?$.trim(opopv.value):"";params+="&elem_post_op_visit="+tmp;}
var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd){var tmp=(typeof oPrBillCd.value!="undefined")?$.trim(oPrBillCd.value):"";params+="&elem_practiceBillCode="+tmp;}
if(typeof getRvsDoneSt!="undefined"){var rvsSt=getRvsDoneSt();params+="&elem_rvs="+rvsSt;}else{params+="&elem_rvs=db";}
var oCCHx=gebi("elem_ccHx");var oCC=gebi("elem_ccompliant");if(oCCHx&&oCC){var strCCHx=oCC.value;var ptrn="\\s*A\\s*((\\d)+\\s*(years|months|days)\\s*old\\s*)?(Male|Female|male|female)\\s*with\\s*history\\s*of\\s*(\\r)?\\s*";strCCHx=regReplace(ptrn,"",strCCHx);if($.trim(strCCHx)==""&&oCCHx&&$.trim(oCCHx.value)!=""){strCCHx=regReplace(ptrn,"",oCCHx.value);}
params+="&elem_ccHx="+strCCHx;}else{params+="&elem_ccHx=db";}
if(typeof(isAssessmentDone)!="undefined"){var strAss=(isAssessmentDone())?"1":"0";params+="&elem_assessment="+strAss;}else{params+="&elem_assessment=db";}
var oNpsych=gebi("elem_neuroPsych");if(oNpsych){var strNpsych=($.trim(oNpsych.value)!="")?"1":"0";params+="&elem_neuroPsych="+strNpsych;}else{params+="&elem_neuroPsych=db";}
var oSBCaseId=gebi("elem_sb_insuranceCaseId");if(oSBCaseId&&(typeof oSBCaseId.value!="undefined")&&(oSBCaseId.value!="")&&(oSBCaseId.value!="0")){params+="&elem_insCaseId="+oSBCaseId.value;}else{var oMasterCaseId=gebi("elem_masterCaseId");if(oMasterCaseId&&(typeof oMasterCaseId.value!="undefined")){params+="&elem_insCaseId="+oMasterCaseId.value;}}
var oDOS=gebi("elem_dos");if(oDOS&&(typeof oDOS.value!="undefined")){params+="&elem_dos="+oDOS.value;}
var oPhyId=$("div.divsign :input[name*=elem_physicianId][value!=''][type!=text]");if(oPhyId&&oPhyId.length>0&&typeof(oPhyId.val())!="undefined"){params+="&elem_doctorId="+oPhyId.val();}
flgMergeSB=1;if(typeof(wpage)!="undefined"&&wpage=="accSB"){flgMergeSB=0;}
params+="&flgMergeSB="+flgMergeSB;var isnewpt=""+$("#elem_flgIsPtNew").val();params+="&elem_flgIsPtNew="+isnewpt;if($(":input[type=checkbox][id*=lb_qlfy_lvl_code]").length>0){var str_vc_check="";$(":checked[id*=lb_qlfy_lvl_code]").each(function(ini){str_vc_check+="&"+this.name+"="+this.value;});params+=str_vc_check;}else if(typeof(cptcd)!="undefined"&&cptcd!=""){var type_cpt="";if(cptcd.indexOf("992")!=-1){type_cpt="992";}else if(cptcd.indexOf("920")!=-1){type_cpt="920";}
if(type_cpt!=""){params+="&lb_qlfy_lvl_code"+type_cpt+"="+cptcd;}}
var v_icd10=""+$("#hid_icd10").val();params+="&elem_v_icd10="+v_icd10;return params;}
var flg_checkAssocPqri4All_checkvisitcode=0;function checkAssocPqri4All_checkvisitcode(cptcd){if(cptcd==""){return;}
if(cptcd.indexOf("920")!=-1){type_cpt="920";}else if(cptcd.indexOf("992")!=-1){type_cpt="992";}else{return;}
var isnewpt="Establish";if(typeof(cptcd)!="undefined"&&cptcd!=""){var isnewpt_t=cptcd.substr(-2,1);isnewpt=(isnewpt_t==0)?"Yes_confirmed":"No_confirmed";$("#elem_flgIsPtNew").val(isnewpt);}
flg_checkAssocPqri4All_checkvisitcode=cptcd;var prompt_msg="";if($("#elem_flgIsPtNew").val()=="New"){var ctop=top;var stop="top";if(top.fmain){ctop=top.fmain;stop="top.fmain";}
prompt_msg+="<label style=\"width:250px;display:inline-block;\"><b>Is this a New Patient?</b></label><div id=\"divisnwpt\">"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_new\" value=\"Yes_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_new\">Yes</label>"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_estb\" value=\"No_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_estb\">No</label></div>";}
var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if(oComp&&$.trim(oComp.value)==""&&(opov&&$.trim(opov.value)=="")&&(opopv&&$.trim(opopv.value)=="")){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\"  height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span  class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});return;}
var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var params=checkAssocPqri4All_getParam(cptcd);params+="&el_manual_insert_visitcode=1";if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var xmlDoc=data;var oAutoCode=xmlDoc.getElementsByTagName("autocode")[0];var oAutos=(oAutoCode!=null)?oAutoCode.childNodes:null;var lenAutos=(oAutos!=null)?oAutos.length:0;var ptcategory="";var practicebillcode="";var ptlevelhistory="";var ptlevelcomp="";var ptservicelevel="";var ptcategory_consult="";var pt_levelofservice_eye="";var pt_levelofservice_em="";var pt_strexamdone_eye="";var pt_strexamnotdone_eye="";var pt_strexamdone_em="";var pt_strexamnotdone_em="";var poe_visit_code="";var pls_sel_nq_em="",pls_sel_nq_eye="";for(var i=0;i<lenAutos;i++){var oData=oAutos[i];if(oData.firstChild){if(oData.nodeName=="ptcategory"){ptcategory=""+oData.firstChild.data;}else if(oData.nodeName=="practicebillcode"){practicebillcode=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelhistory"){ptlevelhistory=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelcomp"){ptlevelcomp=""+oData.firstChild.data;}else if(oData.nodeName=="ptservicelevel"){ptservicelevel=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_eye"){pt_levelofservice_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_em"){pt_levelofservice_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_eye"){pt_strexamdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_eye"){pt_strexamnotdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_em"){pt_strexamdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_em"){pt_strexamnotdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="poe_visit_code"){poe_visit_code=""+oData.firstChild.data;}else if(oData.nodeName=="ptcategory_consult"){ptcategory_consult=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_em"){pls_sel_nq_em=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_eye"){pls_sel_nq_eye=""+oData.firstChild.data;}}}
gebi("elem_category").value=ptcategory;gebi("elem_practiceBillCode").value=practicebillcode;gebi("elem_levelHistory").value=ptlevelhistory;gebi("elem_levelComplexity").value=ptlevelcomp;gebi("elem_levelOfService").value=ptservicelevel;gebi("elem_ptcategory_consult").value=ptcategory_consult;gebi("elem_levelOfServiceEye").value=pt_levelofservice_eye;gebi("elem_levelOfServiceEM").value=pt_levelofservice_em;gebi("elem_strExmDoneEye").value=pt_strexamdone_eye;gebi("elem_strExmNotDoneEye").value=pt_strexamnotdone_eye;gebi("elem_strExmDoneEM").value=pt_strexamdone_em;gebi("elem_strExmNotDoneEM").value=pt_strexamnotdone_em;gebi("elem_poe_visit_code").value=poe_visit_code;gebi("elem_pls_sel_nq_em").value=pls_sel_nq_em;gebi("elem_pls_sel_nq_eye").value=pls_sel_nq_eye;if(setVisitProcedure_nochk==0){}else{var los_t=cptcd.substr(-1,1);if(cptcd.indexOf("920")!=-1){if(gebi("elem_strExmNotDoneEye").value==""){$("#dialog-Mdc-cum-new-pt").remove();return;}}else if(cptcd.indexOf("992")!=-1){if(gebi("elem_strExmNotDoneEM").value==""){$("#dialog-Mdc-cum-new-pt").remove();return;}}}
var prompt_msg="";var oPrBillCd=gebi("elem_practiceBillCode");var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){if(oComp||opov||opopv){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\"></div>"+"</div>";if($("#dialog-Mdc-cum-new-pt").length>0){$("#dialog-Mdc-cum-new-pt").remove();}
$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"&&oPrBillCd=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});if((oComp&&oComp.value!="")||(opov&&opov.value!="")||(opopv&&opopv.value!="")){var tmp=(oComp.value=="")?"5":oComp.value;if(opov&&opov.value!=""){tmp=5;}
else if(opopv&&opopv.value!=""){tmp=6;}
$("input[id*=elem_chkMedComp_][value='"+tmp+"']").prop("checked",true);}}
confirmVisitCode_v3();},"xml");}
function setSBTodayCharges(){var oTodaysCharges=gebi("elem_todaysCharges");var oProcOrder=gebi("elem_procOrder");var oProcUnitOrder=gebi("elem_procUnitOrder");if(!oProcOrder||(typeof oProcOrder.value=="undefined")||($.trim(oProcOrder.value)=="")){if(oTodaysCharges){oTodaysCharges.value="";}
return;}
var mod_50="";$("#superbill .modcode").each(function(){if(typeof(this.value)!='undefined'&&$.trim(this.value)=="50"){var cid=this.id.replace(/elem_modCode/,'elem_cptCode');cid=cid.replace(/_\d$/,"");if($("#"+cid).length>0){var cpt=$("#"+cid).val();if(cpt!=""){if(mod_50.indexOf(cpt)==-1){mod_50+=""+cpt+",";}}}}});var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var insCaseId="";if(typeof gebi("elem_masterCaseId")!="undefined"){var insCaseId=gebi("elem_masterCaseId").value;}
var vDos="";if(typeof gebi("elem_dos")!="undefined"){var vDos=gebi("elem_dos").value;}
var vVIP=($("#vipSuperBill:checked").length>0)?1:0;params="elem_formAction=todayCharges";params+="&elem_insCaseId="+insCaseId;params+="&elem_strCptCodes="+oProcOrder.value;params+="&elem_dos="+vDos;params+="&elem_strCptUnits="+oProcUnitOrder.value;params+="&elem_vVIP="+vVIP;params+="&elem_mod50="+mod_50;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");str=""+data;if(oTodaysCharges){oTodaysCharges.value=""+str;}
$(".amount").html(""+str);});}
function getLSSHtml(obj,attr,type,asindx){var str_lss_tmp="";if(obj){var oLat=obj.attributes.getNamedItem(attr);vLat=(oLat)?""+oLat.nodeValue:"";var arrvLat=vLat.split(",");if(arrvLat.length>0){for(var vt in arrvLat){if(arrvLat[vt]!=""){var tmpLat=arrvLat[vt].split(" - ");str_lss_tmp+="<input type=\"checkbox\" id=\"elem_asDx"+type+"_"+vt+"\" name=\"elem_asDx"+type+"\" value=\""+tmpLat[1]+"\" onclick=\"icd10_restdxcodesinpopup(this)\" style=\"display:none;\" data-asindx=\""+asindx+"\" >"+"<label style=\"cursor:pointer;color:purple;margin-left:10px;padding:2px;border:2px solid transparent;\" for=\"elem_asDx"+type+"_"+vt+"\">"+tmpLat[0]+"</label>&nbsp;";}}}}
return str_lss_tmp;}
var sb_objRefraction={};function checkAssocPqri4All(){flg_checkAssocPqri4All_checkvisitcode=0;var prompt_msg="";if($("#elem_flgIsPtNew").val()=="New"){var ctop=top;var stop="top";if(top.fmain){ctop=top.fmain;stop="top.fmain";}
prompt_msg+="<label style=\"width:250px;display:inline-block;\"><b>Is this a New Patient?</b></label><div id=\"divisnwpt\">"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_new\" value=\"Yes_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_new\">Yes</label>"+"<input type=\"checkbox\" name=\"el_sb_pt_type\" id=\"el_sb_pt_type_estb\" value=\"No_confirmed\" onclick=\""+stop+".decideNewPatient(this)\"><label for=\"el_sb_pt_type_estb\">No</label></div>";}
if($("#poeModal").length<=0){var oPrBillCd=gebi("elem_practiceBillCode");if(oPrBillCd&&$.trim(oPrBillCd.value)=="992"){var oComp=gebi("elem_levelComplexity");var opov=gebi("elem_proc_only_visit");var opopv=gebi("elem_post_op_visit");if((oComp&&$.trim(oComp.value)=="")&&(opov&&$.trim(opov.value)=="")&&(opopv&&$.trim(opopv.value)=="")){str_prmpt_tmp=promptMedDecCom(1);if(prompt_msg!=""){prompt_msg+="<br/>";}
prompt_msg+=str_prmpt_tmp;}}}
if(prompt_msg!=""){var htm="<div id=\"dialog-Mdc-cum-new-pt\">"+"<div style=\"padding:0px;\">"+"<table class=\"table\" height=\"30\"><tr class='purple_bar'><th>Assessed Service Level<span class=\"glyphicon glyphicon-remove pull-right\" title=\"close\"></span></th></tr></table>"+
prompt_msg+"</div>"+"<div id=\"div_as_srv_lvl\" ></div>"+"</div>";$("#dialog-Mdc-cum-new-pt").remove();$("body").append(htm);if($("#elem_practiceBillCode").val()=="920"){$("#dialog-Mdc-cum-new-pt").css({"width":"60%","left":"250px"});}
$("#dialog-Mdc-cum-new-pt").draggable({"handle":"th"});$("#dialog-Mdc-cum-new-pt th span[title=close]").bind("click",function(){$("#dialog-Mdc-cum-new-pt").remove();});$("#dialog-Mdc-cum-new-pt th").css({"cursor":"move"});return;}
var imgPath_tmp=(typeof(imgPath_remote)!="undefined")?imgPath_remote:imgPath;var url=imgPath_tmp+"/interface/chart_notes/requestHandler.php";var params=checkAssocPqri4All_getParam();if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if($("textarea[name=commentsForPatient]").val()=="debug123"){console.log(data);}
if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var xmlDoc=data;var arrCptCodes=new Array();var arrDxCodes=new Array();var arrExamDone=new Array();var arrExamTesting=new Array();sb_objRefraction.isRef=0;var tsb_ids="";var oTestSbInfo=xmlDoc.getElementsByTagName("testing_sb");var oTSB=(oTestSbInfo!=null&&oTestSbInfo[0]&&oTestSbInfo[0].childNodes)?oTestSbInfo[0].childNodes:null;var lenTSB=(oTSB!=null)?oTSB.length:0;for(var a=0;a<lenTSB;a++){var oSBNode=oTSB[a];if(oSBNode==null)continue;var osb_id=oSBNode.attributes.getNamedItem("id");if(osb_id)tsb_ids+=""+osb_id.nodeValue+",";var oCpts=oSBNode.childNodes;var lenCpts=(oCpts)?oCpts.length:0;for(var b=0;b<lenCpts;b++){var arrTmp=new Array();var oCptNode=oCpts[b];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var c=0;c<lenCptData;c++){var oData=oCptData[c];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="code"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";var oUnits=oData.attributes.getNamedItem("units");arrTmp["units"]=(typeof oUnits!="undefined")?oUnits.nodeValue:"";arrTmp["norepeat"]="1";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}else if(oData.nodeName=="dx"){var oDxNum=oData.attributes.getNamedItem("num");var oDxId=oData.attributes.getNamedItem("dxid");var dxId=(typeof oDxNum!="undefined"&&oDxNum)?oDxNum.nodeValue:"";var dxCdId=(typeof oDxId!="undefined"&&oDxId)?oDxId.nodeValue:"";if(dxId!=""){var idDx="dx"+dxId;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";arrTmp[idDx+"Id"]=(typeof dxCdId!="undefined")?dxCdId:"";}}else if(oData.nodeName=="modifier"){var oModNum=oData.attributes.getNamedItem("num");var modId=(typeof oModNum!="undefined")?oModNum.nodeValue:"";if(modId!=""){var idMod="modifier"+modId;arrTmp[""+idMod]=""+oData.firstChild.data;}}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}}
if(tsb_ids!=""){tsb_ids=tsb_ids.replace(/,\s*$/g,"");gebi("elem_sb_tsbIds").value=""+tsb_ids;}
var oCptInfo=xmlDoc.getElementsByTagName("allcptcode")[0];var oCpts=(oCptInfo!=null)?oCptInfo.childNodes:null;var lenCpts=(oCpts!=null)?oCpts.length:0;for(var i=0;i<lenCpts;i++){var arrTmp=new Array();var oCptNode=oCpts[i];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var j=0;j<lenCptData;j++){var oData=oCptData[j];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="cptcode"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";arrTmp["norepeat"]="0";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}
else if(oData.nodeName=="units"){arrTmp["units"]=""+oData.firstChild.data;}
else if(oData.nodeName=="modifier1"){arrTmp["modifier1"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier2"){arrTmp["modifier2"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier3"){arrTmp["modifier3"]=""+oData.firstChild.data;}else if(oData.nodeName=="modifier4"){arrTmp["modifier4"]=""+oData.firstChild.data;}else if(oData.nodeName=="dx1"||oData.nodeName=="dx2"||oData.nodeName=="dx3"||oData.nodeName=="dx4"||oData.nodeName=="dx5"||oData.nodeName=="dx6"||oData.nodeName=="dx7"||oData.nodeName=="dx8"||oData.nodeName=="dx9"||oData.nodeName=="dx10"||oData.nodeName=="dx11"||oData.nodeName=="dx12"){var idDx=oData.nodeName;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=""+(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";}else if(oData.nodeName=="adx1"||oData.nodeName=="adx2"||oData.nodeName=="adx3"||oData.nodeName=="adx4"){var idDx=oData.nodeName;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=""+(typeof oDxDesc!="undefined")?oDxDesc.nodeValue:"";}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}
var arProcDxInfo=[];var oProcSbInfo=xmlDoc.getElementsByTagName("proc_sb");var oPSB=(oProcSbInfo!=null&&oProcSbInfo[0]&&oProcSbInfo[0].childNodes)?oProcSbInfo[0].childNodes:null;var lenPSB=(oPSB!=null)?oPSB.length:0;for(var a=0;a<lenPSB;a++){var oSBNode=oPSB[a];if(oSBNode==null)continue;if(oSBNode.tagName=="dx_info"){var oDxs=oSBNode.childNodes;var lenDxs=(oDxs)?oDxs.length:0;for(var b=0;b<lenDxs;b++){var oDxNode=oDxs[b];var tmpDx=""+oDxNode.firstChild.data;var tmpDxDesc=oDxNode.attributes.getNamedItem("desc");if(tmpDx!=""){arProcDxInfo[tmpDx]=""+(typeof tmpDxDesc!="undefined")?tmpDxDesc.nodeValue:"";}}}else{var oCpts=oSBNode.childNodes;var lenCpts=(oCpts)?oCpts.length:0;for(var b=0;b<lenCpts;b++){var arrTmp=new Array();var oCptNode=oCpts[b];var oCptData=oCptNode.childNodes;var lenCptData=oCptData.length;for(var c=0;c<lenCptData;c++){var oData=oCptData[c];var tmpCpt="";if(oData.firstChild){if(oData.nodeName=="code"){arrTmp["cpt"]=""+oData.firstChild.data;tmpCpt=""+oData.firstChild.data;var oCptDesc=oData.attributes.getNamedItem("desc");arrTmp["cptDesc"]=(typeof oCptDesc!="undefined")?oCptDesc.nodeValue:"";var oUnits=oData.attributes.getNamedItem("units");arrTmp["units"]=(typeof oUnits!="undefined")?oUnits.nodeValue:"";arrTmp["norepeat"]="1";var oIsRef=oData.attributes.getNamedItem("isRef");if(oIsRef&&typeof(oIsRef.nodeValue)!="undefined"){arrTmp["isRef"]=""+oIsRef.nodeValue;}
var o_valid_dx_code=oData.attributes.getNamedItem("valid_dxcodes");if(o_valid_dx_code&&typeof(o_valid_dx_code.nodeValue)!="undefined"){arrTmp["valid_dxcodes"]=""+o_valid_dx_code.nodeValue;}}else if(oData.nodeName=="dx"){var oDxNum=oData.attributes.getNamedItem("num");var oDxId=oData.attributes.getNamedItem("dxid");var dxId=(typeof oDxNum!="undefined"&&oDxNum)?""+oDxNum.nodeValue:"";var dxCdId=(typeof oDxId!="undefined"&&oDxId)?""+oDxId.nodeValue:"";if(dxId!=""){var idDx="dx"+dxId;arrTmp[idDx]=""+oData.firstChild.data;var oDxDesc=oData.attributes.getNamedItem("desc");arrTmp[idDx+"Desc"]=(typeof oDxDesc!="undefined")?""+oDxDesc.nodeValue:"";arrTmp[idDx+"Id"]=(typeof dxCdId!="undefined")?dxCdId:"";}}else if(oData.nodeName=="modifier"){var oModNum=oData.attributes.getNamedItem("num");var modId=""+(typeof oModNum!="undefined")?oModNum.nodeValue:"";if(modId!=""){var idMod="modifier"+modId;arrTmp[""+idMod]=""+oData.firstChild.data;}}}}
if((typeof arrTmp["cpt"]!="undefined")&&(arrTmp["cpt"]!="")){arrExamDone[arrExamDone.length]=arrTmp;if(arrTmp["isRef"]=="1"){sb_objRefraction.isRef=1;sb_objRefraction.dxCode=""+arrTmp["dx1"];}}}}}
var oAutoCode=xmlDoc.getElementsByTagName("autocode")[0];var oAutos=(oAutoCode!=null)?oAutoCode.childNodes:null;var lenAutos=(oAutos!=null)?oAutos.length:0;var ptcategory="";var practicebillcode="";var ptlevelhistory="";var ptlevelcomp="";var ptservicelevel="";var ptcategory_consult="";var pt_levelofservice_eye="";var pt_levelofservice_em="";var pt_strexamdone_eye="";var pt_strexamnotdone_eye="";var pt_strexamdone_em="";var pt_strexamnotdone_em="";var poe_visit_code="";var pls_sel_nq_em="",pls_sel_nq_eye="";for(var i=0;i<lenAutos;i++){var oData=oAutos[i];if(oData.firstChild){if(oData.nodeName=="ptcategory"){ptcategory=""+oData.firstChild.data;}else if(oData.nodeName=="practicebillcode"){practicebillcode=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelhistory"){ptlevelhistory=""+oData.firstChild.data;}else if(oData.nodeName=="ptlevelcomp"){ptlevelcomp=""+oData.firstChild.data;}else if(oData.nodeName=="ptservicelevel"){ptservicelevel=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_eye"){pt_levelofservice_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_levelofservice_em"){pt_levelofservice_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_eye"){pt_strexamdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_eye"){pt_strexamnotdone_eye=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamdone_em"){pt_strexamdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="pt_strexamnotdone_em"){pt_strexamnotdone_em=""+oData.firstChild.data;}else if(oData.nodeName=="poe_visit_code"){poe_visit_code=""+oData.firstChild.data;}else if(oData.nodeName=="ptcategory_consult"){ptcategory_consult=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_em"){pls_sel_nq_em=""+oData.firstChild.data;}else if(oData.nodeName=="pls_sel_nq_eye"){pls_sel_nq_eye=""+oData.firstChild.data;}}}
gebi("elem_category").value=ptcategory;gebi("elem_practiceBillCode").value=practicebillcode;gebi("elem_levelHistory").value=ptlevelhistory;gebi("elem_levelComplexity").value=ptlevelcomp;gebi("elem_levelOfService").value=ptservicelevel;gebi("elem_ptcategory_consult").value=ptcategory_consult;gebi("elem_levelOfServiceEye").value=pt_levelofservice_eye;gebi("elem_levelOfServiceEM").value=pt_levelofservice_em;gebi("elem_strExmDoneEye").value=pt_strexamdone_eye;gebi("elem_strExmNotDoneEye").value=pt_strexamnotdone_eye;gebi("elem_strExmDoneEM").value=pt_strexamdone_em;gebi("elem_strExmNotDoneEM").value=pt_strexamnotdone_em;gebi("elem_poe_visit_code").value=poe_visit_code;gebi("elem_pls_sel_nq_em").value=pls_sel_nq_em;gebi("elem_pls_sel_nq_eye").value=pls_sel_nq_eye;var oDxInfo=xmlDoc.getElementsByTagName("eleminfo")[0];var oElems=(oDxInfo!=null)?oDxInfo.childNodes:null;var lenElems=(oElems!=null)?oElems.length:0;var arrDxInfo=new Array();for(var i=0;i<lenElems;i++){var oPqri=oElems[i].childNodes;var lenPqri=oPqri.length;var thisDxCode="";var tmpCptCode=new Array();for(var j=0;j<lenPqri;j++){var node=oPqri[j];if(node.nodeName=="dxcode"){thisDxCode=(node.firstChild)?node.firstChild.data:"";var oDxDesc=node.attributes.getNamedItem("desc");arrDxInfo[thisDxCode]=(typeof oDxDesc!="undefined")?""+oDxDesc.nodeValue:"";}
else if(node.nodeName=="pqri"){var cptNodes=node.childNodes;var lencptNodes=cptNodes.length;for(var k=0;k<lencptNodes;k++){var tmpCpt=cptNodes[k].firstChild;if(tmpCpt){var tmpStr=(tmpCptCode.length>0)?tmpCptCode.join(","):"";if(tmpStr.indexOf(tmpCpt.data)==-1){tmpCptCode[tmpCptCode.length]=tmpCpt.data;}}}}}
if(tmpCptCode.length>0){arrCptCodes[thisDxCode]=tmpCptCode;}}
if($("#elem_proc_only_visit").val()=="1"){opRemAllCptRow(3);}
insertExamsDoneSB(arrExamDone);PqriSetter(arrCptCodes);var oAssist=gebi("elem_buttonAssist");if(oAssist){oAssist.style.visibility="visible";}
confirmVisitCode_v3();var ocstInfo=xmlDoc.getElementsByTagName("cl_supply_total")[0];if((ocstInfo!=null)&&(ocstInfo.firstChild)){var tmpCst=ocstInfo.firstChild.data;if(parseInt(tmpCst)>0){var oTd_cst=gebi("td_clsupplytotal");if(oTd_cst){oTd_cst.innerHTML="CL order: "+tmpCst;}}}
var strAllDx="";var flgEmptyDx=0;for(var i=1;i<=12;i++){var oDxElem=gebi("elem_dxCode_"+i);if(oDxElem){var tmp=$.trim(oDxElem.value);if((typeof tmp!="undefined")&&(tmp!="")){if(typeof arrDxInfo[tmp]!="undefined"){oDxElem.title=arrDxInfo[tmp];}
strAllDx+=tmp+", ";}else{oDxElem.title="";flgEmptyDx=1;}}}
if(flgEmptyDx==1){for(var x in arProcDxInfo){if(strAllDx.indexOf(x)==-1){for(var i=1;i<=12;i++){var oDxElem=gebi("elem_dxCode_"+i);if(oDxElem){var tmp=$.trim(oDxElem.value);if((typeof tmp!="undefined")&&(tmp!="")){}else{oDxElem.value=x;oDxElem.title=arProcDxInfo[x];break;}}}}}}
sb_crt_dx_dropdown();},"xml");}
function icd10_pre_restdxcodesinpopup(len){for(var h=0;h<=len;h++){for(var mg=0;mg<=10;mg++){var dx_code_id="elem_asDx"+h+"_"+mg;if($("#"+dx_code_id).length>0){if(typeof($("#"+dx_code_id).data("valbakdb"))!='undefined'&&$("#"+dx_code_id).data("valbakdb")!=null){var dx_code_db_val=$("#"+dx_code_id).data("valbakdb");var dx_code_cur_val=$("#"+dx_code_id).val();var dx_str_len=String(dx_code_db_val).length;var dx_sss_val="";for(var k=0;k<=dx_str_len;k++){var x=dx_code_cur_val[k];if(x=="-"){x='Y';}
if(dx_code_db_val[k]!=x){dx_sss_val+=dx_code_cur_val[k]+',';}}
var isDbtsCode=0;if(dx_str_len==8&&(dx_code_cur_val.indexOf("E10.")!=-1||dx_code_cur_val.indexOf("E11.")!=-1)){isDbtsCode=1;dx_sss_val="";for(var k=0;k<=dx_str_len;k++){var x=dx_code_cur_val[k];if(x=="-"){x='0';}
if(dx_code_db_val[k]!=x){dx_sss_val+=dx_code_cur_val[k]+',';}}
var arx=dx_sss_val.split(",");var arx_ln=arx.length;var dx_sss_val_tmp="";for(var t=0;t<arx_ln;t++){if(typeof(arx[t])!="undefined"&&arx[t]!=""){dx_sss_val_tmp=arx[t]+","+dx_sss_val_tmp;}}
if(dx_sss_val_tmp!=""){dx_sss_val=dx_sss_val_tmp;}}
var dx_sss_val_exp=dx_sss_val.split(',');if(dx_sss_val_exp.length>2){for(var g=0;g<=10;g++){var chk_lat_id='elem_asDxLat'+h+'_'+mg+'_'+g;var chk_stg_id='elem_asDxStg'+h+'_'+mg+'_'+g;var chk_svr_id='elem_asDxSvr'+h+'_'+mg+'_'+g;if($("#"+chk_lat_id)&&$("#"+chk_lat_id).val()==dx_sss_val_exp[0]){$("#"+chk_lat_id).prop("checked",true);$("label[for="+chk_lat_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}else{if($("#"+chk_lat_id)&&typeof(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()])!='undefined'){if(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()]==1&&$("#"+chk_lat_id).val()==3){$("label[for="+chk_lat_id+"]").css("display",'none');}}}
if($("#"+chk_stg_id)&&$("#"+chk_stg_id).val()==dx_sss_val_exp[1]){$("#"+chk_stg_id).prop("checked",true);$("label[for="+chk_stg_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}
if(typeof(dx_sss_val_exp[2])!="undefined"&&dx_sss_val_exp[2]!=""){if(isDbtsCode==1){if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[2]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}else{if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[1]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}}else{for(var g=0;g<=10;g++){var chk_lat_id='elem_asDxLat'+h+'_'+mg+'_'+g;var chk_stg_id='elem_asDxStg'+h+'_'+mg+'_'+g;var chk_svr_id='elem_asDxSvr'+h+'_'+mg+'_'+g;if($("#"+chk_lat_id)&&$("#"+chk_lat_id).val()==dx_sss_val_exp[0]){$("#"+chk_lat_id).prop("checked",true);$("label[for="+chk_lat_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}else{if($("#"+chk_lat_id)&&typeof(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()])!='undefined'){if(js_icd10_bilateral_arr[dx_code_db_val.toLowerCase()]==1&&$("#"+chk_lat_id).val()==3){$("label[for="+chk_lat_id+"]").css("display",'none');}}}
if($("#"+chk_stg_id)&&$("#"+chk_stg_id).val()==dx_sss_val_exp[0]){$("#"+chk_stg_id).prop("checked",true);$("label[for="+chk_stg_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}
if($("#"+chk_svr_id)&&$("#"+chk_svr_id).val()==dx_sss_val_exp[0]){$("#"+chk_svr_id).prop("checked",true);$("label[for="+chk_svr_id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}}}}}}}
function disDbtsProlifOptions(){$("#dx_sel_tbl :checked[id*=elem_asDx][data-valbak]").each(function(){var x=$(this).val();if(typeof(x)!="undefined"&&(x.indexOf("E10.")!=-1||x.indexOf("E11.")!=-1)&&x.length==8){var id=$(this).attr("id");var ids=id.replace(/elem_asDx/,"elem_asDxSvr");var svr=0;$("#dx_sel_tbl input[id*="+ids+"]").each(function(){if(this.checked){svr=this.value;}});var flg=0;if(svr==0||svr==5){flg=1;}
ids=ids+"_3";if($("#"+ids).length>0){var idst=id.replace(/elem_asDx/,"elem_asDxStg");$("#dx_sel_tbl label[for*="+idst+"]").each(function(){var a=$(this).html();if(a==2||a==3||a==4||a==5){if(flg==0){$(this).hide();}else{$(this).show();}}});}}});}
function PqriSetter(arrPqriCodes){var strHtml="";for(var z in arrPqriCodes){var tmpDx=z;var tmpCpt=arrPqriCodes[tmpDx];var len=tmpCpt.length;var lim=4;var cntr=lim+1;strHtml+="<div class=\"bgColor_pupil\"><b>Dx Code: "+tmpDx+"</b></div>";strHtml+="<table>";for(var i=0;i<len;i++){if(cntr>lim){strHtml+="<tr>";cntr=1;}
if(cntr<=lim){strHtml+="<td><input type=\"checkbox\" dx=\""+tmpDx+"\" name=\"elem_selPqri"+i+"\" value=\""+tmpCpt[i]+"\" onmousedown=\"stopClickBubble();\" >"+tmpCpt[i]+"</td>";cntr+=1;}
if(cntr>lim){strHtml+="</tr>";}}
strHtml+="</table>";}
if(strHtml!=""){var oPromptDiv=gebi("divChoosePqriCodes");if(oPromptDiv){oPromptDiv.style.backgroundColor="#FFDDCC";oPromptDiv.style.width="300px";strHtml="<table >"+"<tr><th >PQRI Codes</th></tr>"+"<tr><td>Select PQRI codes to display in Super Bill:-</td></tr>"+"<tr><td>"+strHtml+"</td></tr>";strHtml+="<tr><td style='text-align:center;'>"+"<input name=\"button\" type=\"button\" id=\"elem_pqricBtn\" class=\"dff_button\" "+"value=\"Insert\" onmousedown=\"stopClickBubble();\" onclick=\"getSelPQRICodes()\"> "+"<input name=\"button\" type=\"button\" id=\"elem_pqrixBtn\" class=\"dff_button\" "+"value=\"Cancel\" onmousedown=\"stopClickBubble();\" onclick=\"getSelPQRICodes(0)\">"+"</td></tr>";strHtml+="</table>";oPromptDiv.innerHTML=""+strHtml;oPromptDiv.style.display="block";var thisScrollTop=gebi("divWorkView").scrollTop;if(thisScrollTop==0){}else{oPromptDiv.style.top=(thisScrollTop+100)+"px";}
oPromptDiv.focus();stopClickBubble();}}}
function get_dx_popup_lss(oAsInfo,funcname){funcname=(typeof(funcname)!="undefined"&&funcname!="")?funcname:"";var str="";var cck=0;var strUni="",strUniDesc="";var arrdxth=new Array();var len=oAsInfo.length;for(var i=0;i<len;i++){var tAss=oAsInfo[i];var name=tAss.getElementsByTagName("name")[0].firstChild.nodeValue;var asindx=tAss.getElementsByTagName("name")[0].attributes.getNamedItem("indx").nodeValue;var arrdx=tAss.getElementsByTagName("dx");var ln2=arrdx.length;var tmp="";var chk_str_lss_tmp="";if(typeof arrdx[0]!="undefined"){chk_str_lss_tmp=getLSSHtml(arrdx[0],"strLat","Lat"+i+"_0",asindx);}
var dup_dx_row=0;if(chk_str_lss_tmp.indexOf("RUL")!=-1&&ln2<2){ln2=2;dup_dx_row=1;}
if(ln2>0){for(var k=0;k<ln2;k++){if(dup_dx_row>0){kf=0;}else{kf=k;}
var tdx=arrdx[kf].firstChild.nodeValue;var odxcat=arrdx[kf].attributes.getNamedItem("cat");var vdxcat=(odxcat)?" - "+odxcat.nodeValue:"";var odxid=arrdx[kf].attributes.getNamedItem("dxid");var vdxid=(odxid)?""+odxid.nodeValue:"";flgDisable="";if(strUni.indexOf(tdx+name)==-1||dup_dx_row>0){strUni+=tdx+name+",";}else{continue;}
var ck="";if((cck<12)&&(flgDisable!="disabled")){ck="checked";cck+=1;}
var str_lss="";var str_as_nm="";var str_as_sr_nm="";var tdx_db="";if(""+$("#hid_icd10").val()=="1"){str_as_nm=name;var str_lss_tmp="";str_lss_tmp=getLSSHtml(arrdx[kf],"strLat","Lat"+i+"_"+k,asindx);str_lss+="<td title=\"Laterality\">"+str_lss_tmp+"</td>";str_lss_tmp=getLSSHtml(arrdx[kf],"strStg","Stg"+i+"_"+k,asindx);str_lss+="<td title=\"Staging\">"+str_lss_tmp+"</td>";str_lss_tmp=getLSSHtml(arrdx[kf],"strSvr","Svr"+i+"_"+k,asindx);str_lss+="<td title=\"Severity\">"+str_lss_tmp+"</td>";str_as_sr_nm="<td>"+(i+1)+".</td>";var odxicd10bak=arrdx[kf].attributes.getNamedItem("strICD10Dx");tdx_db=(odxicd10bak)?""+odxicd10bak.nodeValue:"";}
var dx_code_box="";dx_code_box="<span class=\"checkbox\"><input type=\"checkbox\" id=\"elem_asDx"+i+"_"+k+"\" name=\"elem_asDx"+i+"_"+k+"\" value=\""+tdx+"\"  data-valbak=\""+tdx+"\"  data-valbakdb=\""+tdx_db+"\" data-asindx=\""+asindx+"\" data-dxid=\""+vdxid+"\"   "+ck+" "+flgDisable+" > <label for=\"elem_asDx"+i+"_"+k+"\">"+tdx+"</label>"+vdxcat+"</span>";if(dup_dx_row>0&&k>0){tmp+="<tr style=\"display:none;\" id=\"elem_asDx"+i+"_"+k+"_tr\">";}else{tmp+="<tr id=\"elem_asDx"+i+"_"+k+"_tr\">";}
tmp+=str_as_sr_nm+"<td class=\"small\">"+str_as_nm+"</td>"+"<td>"+dx_code_box+"</td>"+
str_lss+"</tr>";}}else{var str_as_nm="Enter Dx Code:";str_lss="";var str_as_sr_nm="";if(""+$("#hid_icd10").val()=="1"){str_as_nm=""+name;str_lss="<td></td><td></td><td></td>";str_as_sr_nm="<td>"+(i+1)+".</td>";}
tmp+="<tr>"+str_as_sr_nm+"<td class=\"small\">"+str_as_nm+"</td>"+"<td>"+"<input type=\"text\" placeholder=\"Enter Dx Code:\" name=\"elem_asDx"+i+"_0\" id=\"elem_asDx"+i+"_0\" data-asindx=\""+asindx+"\" value=\"\" class=\"dxallcodes form-control\" size=\"15\" onmousedown=\"stopClickBubble();\" onblur=\"checkDXCodesChart(this);stopClickBubble();\">"+"</td>"+str_lss+"</tr>";arrdxth[arrdxth.length]="elem_asDx"+i+"_0";}
if($.trim(tmp)!=""){if($("#hid_icd10").val()==1){str+=""+tmp;}else{str+="<tr><td colspan=\"2\"><b>"+name+"</b></td></tr>";str+=""+tmp;}}}
if(str!=""){var oDivDxCode=document.getElementById("divChooseDxCodes");oDivDxCode.innerHTML="";oDivDxCode.style.display="block";oDivDxCode.style.width="300px";var clsstbl="";if(""+$("#hid_icd10").val()=="1"){str="<tr class=\"grythead\"><td>#</td><td>Assessment</td><td>ICD10</td><td>Site</td><td>Staging</td><td>Severity</td></tr>"+str;oDivDxCode.style.width="90%";oDivDxCode.style.left="80px";clsstbl=" class=\"icd10\" ";}
var strInnerHTML="<table id=\"dx_sel_tbl\" class=\"table table-bordered table-responsive\" >"+"<tr class=\"head\"><th class='section_header1' >Dx Codes : Display in Super Bill</th></tr>";if(""+$("#hid_icd10").val()!="1"){strInnerHTML+="<tr><td></td></tr>";}
strInnerHTML+="<tr ><td  valign=\"top\" >";strInnerHTML+="<div onmousedown=\"stopClickBubble();\"><table "+clsstbl+" onmousedown=\"stopClickBubble();\"  >"+str+"</table></div>";strInnerHTML+="</td></tr>";strInnerHTML+="<tr id=\"module_buttons\" class=\"ad_modal_footer\"><td align=\"center\"><input name=\"button\" class=\"btn btn-success\" type=\"button\" id=\"elem_dxcBtn\"  value=\"Done\" onclick=\"getWantedDxCodes('"+funcname+"')\" onmousedown=\"stopClickBubble();\">"+"&nbsp;&nbsp;&nbsp;&nbsp;<input name=\"button\" class=\"btn btn-danger\" type=\"button\" id=\"elem_dxcanBtn\"  value=\"Cancel\" onclick=\"$('#divChooseDxCodes').hide();\" >"+"</td></tr>";strInnerHTML+="</table>";oDivDxCode.innerHTML=""+strInnerHTML;if($("#superbill #dx_sel_tbl div").height()<$("#superbill #dx_sel_tbl div table").outerHeight()){var tmphgt=($("#superbill #dx_sel_tbl div table").outerHeight()<600)?$("#superbill #dx_sel_tbl div table").outerHeight():600;$("#superbill #dx_sel_tbl div").height(tmphgt+"px");}
$(oDivDxCode).draggable({handle:".section_header"});var t=arrdxth.length;if(t>0){sb_addTypeAhead();}
icd10_pre_restdxcodesinpopup(len);disDbtsProlifOptions();}
return str;}
var getDCFA_strApId;function getDxCodesFromAssess(strAses){strAses=$.trim(strAses);if(strAses==""){return;}
var imgPath_tmp=zPath;var url=imgPath_tmp+"/chart_notes/requestHandler.php";var params="elem_formAction=getDxFrmAses";if(typeof(document.getElementById('hid_icd10'))!="undefined"){params+="&ICD_type="+$("#hid_icd10").val();}
params+=strAses;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.post(url,params,function(data){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");var str="";var xmlDoc=data;var oShowPop=xmlDoc.getElementsByTagName("prompt_user")[0];var flagShowPop=(oShowPop)?oShowPop.firstChild.nodeValue:0;var oAsInfo=xmlDoc.getElementsByTagName("assess");var len=oAsInfo.length;var oApId=xmlDoc.getElementsByTagName("apid")[0];if(oApId&&oApId.firstChild){getDCFA_strApId=oApId.firstChild.nodeValue;}
if(typeof sb_pdiv=="undefined"){sb_pdiv="";}
if(flagShowPop==1){str=get_dx_popup_lss(oAsInfo);}else{var j=0;for(var i=0;(j<len)&&(i<12);i++){var vdx=vdxid="";var tAss=oAsInfo[j];vdx=tAss.getElementsByTagName("dx")[0].firstChild.nodeValue;vdx=(typeof vdx!="undefined")?vdx:"";if(vdx!=""){var odxid=tAss.getElementsByTagName("dx")[0].attributes.getNamedItem("dxid");vdxid=(odxid&&typeof odxid!="undefined"&&typeof odxid.nodeValue!="undefined")?odxid.nodeValue:"";}
flgD=true;if(vdx!=""){for(var k=1;k<=12;k++){var oC=gebi("elem_dxCode_"+(k));var cdxid=$(oC).data("dxid");if(typeof cdxid=="undefined"){cdxid="";}
cdxid=$.trim(cdxid);if(oC&&(oC.value!="")&&(oC.value==vdx)){if(cdxid!=""&&vdxid!=""&&vdxid!=cdxid){}else{flgD=false;j++;break;}}}}
if(flgD==true){var oT=gebi("elem_dxCode_"+(i+1));if(oT&&(($.trim(oT.value)=="")||(typeof oT.value=="undefined"))){oT.value=vdx;$(oT).data("dxid",vdxid);j++;}else{}}}
setTimeout(function(){set_dx_code_titles();},100);}
if(str==""){checkAssocPqri4All();}
if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");},"xml");}
function set_dx_code_titles(){var ar_dx=[],tdx="",tdxid="",flg=0;$(".dxallcodes").each(function(indx){tdx=$.trim(this.value);tdxid=$(this).data("dxid");if(typeof(tdxid)!="undefined"){tdxid=$.trim(tdxid);}
if(tdx!=""){ar_dx[ar_dx.length]=""+tdx+","+tdxid+","+this.id;flg++;}});if(flg>0){$.post(zPath+"/chart_notes/requestHandler.php",{"elem_formAction":"get_dx_titles","req_ptwo":"1","ar_dx[]":ar_dx},function(d){if(typeof(d)!="undefined"){for(var x in d){if(typeof(d[x])!="undefined"){renew_title($("#"+x)[0],""+d[x]);}}}},"json");}}
function is_dxcode_row_exists(valbakdb,tdxid,objVal,objhtml,trId){if(typeof valbakdb=="undefined"||typeof objVal=="undefined"||objVal==""){return 0;}
if(typeof tdxid=="undefined"){tdxid="";}
var ret=0;var retObj="";var flgChk=1;if($("#"+trId).find("td[title='Laterality'] :checked").length<2){flgChk=0;}
$("#dx_sel_tbl tr span input[type=checkbox]").each(function(){if(ret==1){return false;}
var tvalbakdb=$(this).data("valbakdb");if(valbakdb!=""&&tvalbakdb==valbakdb){var ftt=1;if(tdxid!=""){ftt=0;var tmpdxid=$(this).data("dxid");if(tdxid==tmpdxid){ftt=1;}}
if(ftt==1){var objtr=$(this).parent().parent().parent();var tmptrid=objtr.attr("id");if(typeof(trId)!="undefined"&&trId!=""){if(trId==tmptrid||$("#"+tmptrid+":visible").length==0){return true;}}
var objchecked=objtr.find("td[title='Laterality'] :checked");if(objchecked.length>0){objchecked.each(function(){if(this.value==objVal){ret=1;return false;}});}else{retObj=objtr.attr("id");}}}});if(retObj!=""&&flgChk==0){ret=0;retObj="";}
return{'ret':ret,'retObj':retObj};}
function icd10_restdxcodesinpopup(obj){var objVal=$("label[for*="+obj.id+"]").html();if(objVal=='RUL'||objVal=='RLL'||objVal=='LUL'||objVal=='LLL'||objVal=='R'||objVal=='L'||objVal=='B'){if(obj.checked==true){var tmpres=0;var objCurRow=$(obj).parent().parent();var chk_dx_id=objCurRow.find("span input[type=checkbox]");if(chk_dx_id.length>0){var tdxid=chk_dx_id.data("dxid");var valbakdb=chk_dx_id.data("valbakdb");var tmpres=is_dxcode_row_exists(valbakdb,tdxid,obj.value,objVal,$(objCurRow).attr("id"));if(tmpres.ret==1){$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});return;}
else if(tmpres.retObj!=""){$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});$("#"+tmpres.retObj).find(":checkbox[value='"+obj.value+"']").prop("checked",true).triggerHandler("click");return;}}
var cont_lat_Sel=0;for(var i=0;i<4;i++){var ele_chk_id=(obj.id).substr(0,((obj.id).length-1));var final_ele_chk_id=ele_chk_id+i;if(document.getElementById(final_ele_chk_id)){if(document.getElementById(final_ele_chk_id).checked==true){cont_lat_Sel=parseInt(cont_lat_Sel)+1;}}}
if(cont_lat_Sel>1){var new_ele_obj_name=(obj.name).substr(0,((obj.name).length-1));var last_obj_id="";$("#"+obj.id).prop("checked",false);$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});for(var i=0;i<20;i++){var current_trgtid=obj.name.replace(/(Lat|Svr|Stg)/g,"")+'_tr';var curr_tr_data=$("#"+current_trgtid).html();var chk_new_tr_id=new_ele_obj_name.replace(/(Lat|Svr|Stg)/g,"")+i+'_tr';if(typeof($("#"+chk_new_tr_id).html())=="undefined"){var old_obj_id_num=(obj.name).substr(((obj.name).length-3),((obj.name).length));var old_obj_id_num_exp=old_obj_id_num.split('_');var new_obj_id=old_obj_id_num_exp[0]+'_'+i;var final_data='<tr id="'+chk_new_tr_id+'">'+curr_tr_data+'</tr>';var obj_id_rep=new RegExp(old_obj_id_num,"g");final_data=final_data.replace(obj_id_rep,new_obj_id);$(final_data).insertAfter($("#"+last_obj_id));var new_tr_obj=obj.id.replace(old_obj_id_num,new_obj_id);obj=document.getElementById(new_tr_obj);$("label[for*="+obj.name+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});$("#"+obj.id).prop("checked",true);$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});break;}
last_obj_id=chk_new_tr_id;}}else{$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});}}else{$("label[for*="+obj.id+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});}}else{$("label[for*="+obj.name+"]").css({"color":"purple","border":"2px solid transparent","background-color":"transparent"});if(obj.checked){$("label[for="+obj.id+"]").css({"color":"Red","border":"2px solid blue","background-color":"white"});$(":checked[name="+obj.name+"][id!="+obj.id+"]").prop("checked",false);}}
var trgtid=obj.name.replace(/(Lat|Svr|Stg)/g,"");var trgtval=$("#"+trgtid).val();var valChk=$.trim($("#"+trgtid).data("valbak"));var valChkdb=$.trim($("#"+trgtid).data("valbakdb"));if(valChk.length==valChkdb.length){var valChkdb_tmp=""+valChkdb.replace(/-/g,"\\w");var rex=new RegExp(""+valChkdb_tmp,"gi");var rez=valChk.match(rex);if(rez){valChk=valChkdb;}}
$("#"+trgtid).prop("checked",true);var setVal=(obj.checked)?obj.value:"-";var isDbtsCode=0;if(valChkdb.length==8&&(valChkdb.indexOf("E10.")!=-1||valChkdb.indexOf("E11.")!=-1)){isDbtsCode=1;}
var trgtvalNew="";if(obj.id.indexOf("Lat")!=-1){if(isDbtsCode==1){if(valChkdb.charAt(7)=='-'){var tt=trgtval.substr(0,7);var tt1=trgtval.substr(8);trgtvalNew=tt+setVal;}}else{if(valChk.charAt(6)=='-'){var tt=trgtval.substr(0,6);var tt1=trgtval.substr(7);trgtvalNew=tt+setVal+tt1;}else{if(valChk.substr(-3,3)!='-X-'||valChk.substr(-3,3)!='-x-'){var tt=trgtval.substr(0,5);var tt1=trgtval.substr(6);trgtvalNew=tt+setVal+tt1;}}}}else{if(isDbtsCode==1){if(obj.id.indexOf("Stg")!=-1){if(valChkdb.charAt(6)=='-'){var tt=trgtval.substr(0,6);var tt1=trgtval.substr(7);trgtvalNew=tt+setVal+tt1;}}else if(obj.id.indexOf("Svr")!=-1){if(valChkdb.charAt(5)=='-'){var tt=trgtval.substr(0,5);var tt1=trgtval.substr(6);trgtvalNew=tt+setVal+tt1;}}}else{if(valChk.indexOf("-")!=-1&&valChk.indexOf("--")==-1&&valChk.indexOf("-X-")==-1&&valChk.indexOf("-x-")==-1){trgtvalNew=valChk.replace('-',setVal);}else{if(valChk.indexOf("--")!=-1){var tt=trgtval.substr(0,7);trgtvalNew=tt+setVal;}else if(valChk.indexOf("-X-")!=-1||valChk.indexOf("-x-")!=-1){var tt=trgtval.substr(0,7);trgtvalNew=tt+setVal;}}}}
if(trgtvalNew!=""){$("#"+trgtid).val(""+trgtvalNew);var asindx=$("#"+trgtid).data("asindx");$("label[for="+trgtid+"]").html(""+trgtvalNew);var tm=""+trgtid.replace("elem_asDx","").split("_");if(""+tm[0]!=""){var tmp_asindx=(asindx&&asindx!="")?asindx:parseInt(tm[0])+1;var tmid="elem_assessment_dxcode"+tmp_asindx;if($("#"+tmid).length>0&&""+$("#"+tmid).val()!=""){if(""+$("#"+tmid).val().indexOf(",")!=-1||""+$("#"+tmid).val().indexOf(";")!=-1){var arrtmp=($("#"+tmid).val().indexOf(",")!=-1)?$("#"+tmid).val().split(","):$("#"+tmid).val().split(";");if(arrtmp.length>0){var strdx="";var flgin=0;for(var t in arrtmp){arrtmp[t]=$.trim(arrtmp[t]);if(arrtmp[t]!=""){if($("#"+tmid).val().indexOf("-")!=-1){var inx=valChk.indexOf("-");var ck=valChk.substring(0,inx);if(arrtmp[t].indexOf(ck)!=-1){if(strdx!=""){strdx+=", ";}
strdx+=trgtvalNew;}else{if(strdx!=""){strdx+=", ";}
strdx+=arrtmp[t];}
flgin=1;}else{if(strdx!=""){strdx+=", ";}
if($.trim(arrtmp[t])!=$.trim(trgtvalNew)){strdx+=arrtmp[t];}else{flgin=1;}}}}
if(flgin==0){if(strdx!=""){strdx+=", ";}
strdx+=trgtvalNew;}}
$("#"+tmid).val(strdx).trigger("keyup");}else{var tdx=$("#"+tmid).val();var tdx_1=tdx.slice(0,-1);var tdx_2=trgtvalNew.slice(0,-1);if(tdx_1==tdx_2&&tdx.indexOf("-")!=-1){tdx=trgtvalNew;}else{tdx=tdx+", "+trgtvalNew;}
$("#"+tmid).val(tdx).trigger("keyup");}}else{$("#"+tmid).val(trgtvalNew).trigger("keyup");}}
var asdx="";var x=trgtid.match(/elem_asDx\d+/);$("#dx_sel_tbl :checked[id*="+x+"][data-valbak]").each(function(){if(typeof(this.value)!="undefined"&&this.value!=""&&asdx.indexOf(this.value)==-1){if(asdx!=""){asdx+=", ";}asdx+=this.value;}});$("#"+tmid).val(asdx).trigger("keyup");}
disDbtsProlifOptions();}
function replace_cid10_extra_string(val){val=val.replace('Right Eye','Right');val=val.replace('Left Eye','Left');val=val.replace('Both Eyes','Both');val=val.replace('Initial Encounter Closed Fracture','Closed');val=val.replace('Initial Encounter Open Fracture','Open');val=val.replace('Subsequent Encounter for Fracture with Routine Healing','Routine');val=val.replace('Subsequent Encounter for Fracture with Delayed Healing','Delayed');val=val.replace('Subsequent Encounter for Fracture with Non Union','Union');val=val.replace('Initial Encounter','Initial');val=val.replace('Subsequent Encounter','Subsequent');val=val.replace('Adv atrophic w/o subfoveal Involvement','w/osubfoveal');val=val.replace('Adv atrophic w subfoveal Involvement','wsubfoveal');val=val.replace('Active neovascularization','Active');val=val.replace('Inactive neovasculization','Inactive');val=val.replace('AdInactive scar','scar');val=val.replace('w/ macular edema','edema');val=val.replace('w/ret neovaculaization','neovaculaization');return val;}
function getRvsDoneLevel(str){var arrLoc=new Array("Right Eye","Left Eye","Both Eyes","Right Eyelids","Left Eyelids","RUL","RLL","LUL","LLL","Peripheral vision","Paraxial vision","Central vision","Head","left side of head","right side of head","left side of face","right side of face","fore head","scalp","selLocOpt","selLocOther");var arrQuality=new Array("Stabbing","Dull","Aching","Doing well","Feels improvement","Tolerating","Quality~Worsening","Quality~Stable","Resolved","No changes noted","New","Quality~Increased","Quality~Decreased","Initially improved then worsened","Quality~Burning","distorted","dry","foggy","ghosting","Quality~glare","hazy","Quality~itching","pressure","scratchy","sharp","throbbing","watery","Quality~patient unsure","since surgery","since birth","since childhood","since last visit","many years","otherQty");var arrSeverity=new Array("Mild","Moderate","Severe","None",'Severity~Intermittent','Severity~Constant',"Decreased","Increased","Worsening","scale1To10","rvs_other_svrity");var arrTimeOnset=new Array("selectNo-","selectDate-","elem_sp_surtype","elem_sp_surdate","other_onset","many years","Patient unsure","Since surgery","Since birth","Since childhood","Since last visit");var arrContext=new Array("Reading","driving","outside","inside","otherContext");var arrModFact=new Array("MF~inside","outdoors","night","distance vision than near","near vision than distance","when transition from dark to light","when transition from light to dark","in dim light","early in the day","late in the day","with intensive visual activity (readingcomma computer)","with daily activities","makesBetter-","makesWorse-","otherFactors","rvs_painrelievedby");var arrAssocSign=new Array("Pain","Itching","Burning","Headache","Redness","Light sensitivity","Irritation","Blurry Vision","Halos","Foreign body sensation","Sharp",'ASAS~Dull',"Ache","Headaches","Eye pain","double vision","flashes","floater","ocular redness","glare","dizziness or light-headedness","weakness","tearing","high ocular pressure","none","otherSymptoms");var arrDoe=new Array("DoE~Intermittent","DoE~Uncertain","selectDoE","Sudden","Gradual","Constant","otherDoe","onSetDate");var arrVis=new Array("Blurry","Improved","Worse","Stable","rvsdet_otherVision");var arrDip=new Array("Dip~None","Dip~Mild","Dip~Improved","Dip~Worse");var arrMed=new Array("is following medication instructions","is not taking medications","ran out of meds","has finished meds as instructed","needs med refill","rvs_ranoutmeds","rvs_needs_med_refill");var arrCI=new Array("otherFollowCareInstruct");var arrOther=new Array("rvs_followup_detail_other");var arrParNeg=["no eye Pain","no Itching","no Tearing","no Flashes","no floaters","no Glare","no Red Eye","no Headache","no Dryness","no Distortion","no Change in Amsler Grid","no Ocular Trauma","no Pain with Eye Movement","no Loss of Consciousness","no Visual Phenomenon","no Pain or Tearing","no ShadowcommaCurtain or Veil","no Flashescommafloatercommashadowcommacurtain or Veil","no FevercommaWeight LosscommaScalp TendernesscommaHeadache or Jaw Claudication","other_par_neg"];var arrAll=[arrLoc,arrQuality,arrSeverity,arrTimeOnset,arrContext,arrModFact,arrAssocSign,arrDoe,arrMed];var arr_txt_fields=["rvs_needs_med_refill","rvs_ranoutmeds","rvs_other_svrity","otherQty","other_onset","selLocOther","otherSymptoms","otherFactors","otherContext","scale1To10","otherDoe","selLocOther"];var ret=1;var cntr=0;if($.trim(str)!=""){var arrStr=str.split(",");if(arrStr.length>0){for(var x in arrStr){var t=(typeof(arrStr[x])!="undefined"&&arrStr[x]!="")?arrStr[x]:"";if(t!=""&&t.indexOf("-")!=-1){var art=t.split("-");if(arr_txt_fields.indexOf(art[0])!=-1){arrStr[x]=art[0];}else if(art[0]=="selectNo"||art[0]=="selectDate"){arrStr[x]=art[0]+"-";}}}}
var len=arrAll.length;for(var i=0;i<len;i++){var arin=arrAll[i];for(var x in arin){if(-1!=arrStr.indexOf(arin[x])){cntr+=1;break;}}
if(cntr>=4){break;}}}
ret=(cntr>=4)?3:2;return ret;}
function getRvsDoneSt(){var cntrRet=0;if((complaint1.toString()!="")||(complaint2.toString()!="")||(complaint3.toString()!="")){cntrRet=1;if(complaint1.toString()!=""){cntr=getRvsDoneLevel(""+complaint1);if(cntr>cntrRet){cntrRet=cntr;}}
if(complaint2.toString()!=""){cntr=getRvsDoneLevel(""+complaint2);if(cntr>cntrRet){cntrRet=cntr;}}
if(complaint3.toString()!=""){cntr=getRvsDoneLevel(""+complaint3);if(cntr>cntrRet){cntrRet=cntr;}}}else{var ar=["-Vision Problem: Difficulty in","\r\n-Glare Problem: ","\r\n-Other Vision Problem: ","\r\n-Patient Comments: ","\r\n-Irritation Lids: ","\r\n-Irritation Ocular: ","\r\n-Post Segment: ","\r\n-Flashing Lights: ","\r\n-Floaters: ","\r\n-Amsler Grid: ","\r\n-Double vision: ","\r\n-Temporal Arteritis symptoms: ","\r\n-Loss of vision: ","\r\n-Headaches: ","\r\n-Migraine Headaches: ","\r\n-Post Op: ","\r\n-Follow Up: "];var s=$("#elem_ccompliant").val();if(typeof(s)=="undefined"){s="";}
for(var x in ar){if(s.toLowerCase().indexOf(ar[x].toLowerCase())!=-1){cntrRet=1;}}
if(cntrRet==0){var arrElemNames=new Array("elem_vpDis[]","elem_vpMidDis[]","elem_vpNear[]","elem_vpGlare[]","elem_vpOther[]","elem_irrLidsExt[]","elem_irrOcu[]","elem_postSegSpots","elem_postSegFL[]","elem_postSegFloat[]","elem_postSegAmsler[]","elem_neuroDblVis[]","elem_neuroTAS[]","elem_neuroMigHead[]","elem_neuroMigHeadAura[]","elem_neuroVisLoss[]","elem_fuFollowUp[]","elem_fuPostOp[]","elem_neuroHeadaches[]");for(var x in arrElemNames){var elem=document.getElementsByName(arrElemNames[x]);var len=elem.length;for(var i=0;i<len;i++){if(elem[i].checked==true){cntrRet=1;break;}}}}
if(cntrRet==0){var arT=["elem_vpDisOther","elem_vpMidDisOther","elem_vpNearOther","elem_vpOtherOther","vpComment","elem_irrLidsExtOther","elem_irrOcuOther","elem_neuroTASOther","elem_neuroMigHeadAuraOther","elem_neuroVisLossOther","elem_fuPostOp_other","elem_fuFollowUp_other"];for(var x in arT){var t=$("#"+arT[x]).val();if(t!=""&&typeof(t)!="undefined"){cntrRet=1;}}}}
return(typeof cntrRet!="undefined")?cntrRet:0;return 0;}
var sb_chkDia_inx;var sb_dm_popup_old;var call_CHECK_DIABETES;function sb_checkDiabetes(dib_type,obj,num,hgl,com){if((finalize_flag!=0&&isReviewable!=1)||elem_per_vo=="1"||$("#hid_icd10").val()!="1"){if(z_flg_diab_sb=="1"){opSuperBill(1);}
return;}
if(z_flg_diab_sb=="1"){var flgDMCodeEntered=sb_clearDiabetesAssessments(1);if(flgDMCodeEntered==1){opSuperBill(1);return;}}
if(typeof(hgl)!="undefined"&&hgl=="1"){var chk=$(obj).hasClass("highlight");if(chk==true){$(obj).removeClass("highlight");return;}
var stg=$(obj).html();if(num=="1"){if(sb_dm_popup_old){$("#dialog-msg-diab td[onclick]").removeClass("highlight");}}else if(num=="t1"||num=="t2"){}else{if(stg=="Right"||stg=="Left"){if($("#tbl_dbts_2").length<=0){var x=0;if(x==0){var clone_htm=$("#tbl_dbts_1").html();clone_htm="<table id=\"tbl_dbts_2\" cellpadding=\"2\" style=\"width:100%;\">"+clone_htm+"</table>";$(clone_htm).insertAfter("#tbl_dbts_1");$("#tbl_dbts_2 td[onclick]").removeClass("highlight");}}else{var x=0;$("#dialog-msg-diab td.highlight").each(function(){if($(this).html()!=""&&$(this).html()==stg){x+=1;}});if(x>0){return;}}}else if(stg=="Both"){var both_tbl_id=$(obj).parents("table[id*=tbl_dbts_]").attr("id");if(both_tbl_id=="tbl_dbts_2"){$("#tbl_dbts_1").remove();$("#tbl_dbts_2").attr("id","tbl_dbts_1");}else{$("#tbl_dbts_2").remove();}}
$(obj).parent().parent().parent().parent().find("td[onclick]").removeClass("highlight");}
sb_chkDia_inx=num;$(obj).addClass("highlight");if(stg=="Proliferative"){$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_trd").show();$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_wo_me").show();}else if(stg=="Mild"||stg=="Mod"||stg=="Severe"){$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_trd").hide();$(obj).parents("table[id*=tbl_dbts_]").find("#tbl_wo_me").show();}
return;}
if(typeof(obj)!="undefined"){var dx_org=$("#dialog-msg-diab").data("dxcode");var assess_org=$("#dialog-msg-diab").data("assess");var assess=[],dx=[],eye=[];var assess_take=[],dx_take=[],eye_take=[];$("#dialog-msg-diab td.highlight").each(function(){var a=$(this).data("md");var b=$(this).html();if(a=="t1"||a=="t2"){var assess_t=""+$(this).data("asmt");var dx_t=""+$(this).data("dx");assess_take[assess_take.length]=assess_t;dx_take[dx_take.length]=dx_t;return;}
var tbl_id=""+$(this).parents("table[id*=tbl_dbts_]").attr("id");if(typeof(assess[tbl_id])=="undefined"){assess[tbl_id]="";}
if(typeof(dx[tbl_id])=="undefined"){dx[tbl_id]="";}
if(typeof(eye[tbl_id])=="undefined"){eye[tbl_id]="";}
var assess_t=""+assess[tbl_id];var dx_t=""+dx[tbl_id];var eye_t=""+eye[tbl_id];if(sb_dm_popup_old!=1){if((b.indexOf("E1")!=-1&&b.indexOf(".9")!=-1)||(b.indexOf("Diabetes Type 1 No retinopathy")!=-1)||(b.indexOf("Diabetes Type 2 No retinopathy")!=-1)){dx_t=$("#dbts_icd10_dx_1").html();assess_t=b;}else{var w1="";var a1="";if(a.indexOf("s")!=-1){a1="s";w1="5";}else if(a.indexOf("e")!=-1){a1="e";w1="6";}else if(a.indexOf("l")!=-1){a1="l";w1="7";}else{a1="";w1="100";}
if(a1!=""){if(dx_t==""){dx_t=dx_org;}
a=a.replace(a1,"");var dx1=dx_t.substr(0,w1);var dx3=dx_t.substr(parseInt(w1)+1);dx_t=dx1+a+dx3;if(a1!="l"){assess_t=assess_t+" "+b;}else{if(b=="Right"){eye_t="OD";}
else if(b=="Left"){eye_t="OS";}
else if(b=="Both"){eye_t="OU";}}}}}else{assess_t=$("#dbts_icd10_"+num).html();dx_t=b;}
if(assess_t!=""){assess[tbl_id]=assess_t;}
if(dx_t!=""){dx[tbl_id]=dx_t;}
if(eye_t!=""){eye[tbl_id]=eye_t;}});var udx;var pl=sb_clearDiabetesAssessments(udx,1);var assess_t=assess_org;var eye_t="",dx_t="";com=$.trim(com);for(var x in assess){if(assess[x]&&typeof(assess[x])!="undefined"&&assess[x]!=""){var as=$.trim(assess[x]);as_cd=dx[x];if(typeof(eye[x])!="undefined"&&eye[x]!=""){if(eye_t==""){eye_t=eye[x];}else{if((eye[x]=="OD"&&eye_t=="OS")||(eye[x]=="OS"&&eye_t=="OD")){eye_t="OU";}}
if(eye[x]=="OD"){as="Right "+as;}
if(eye[x]=="OS"){as="Left "+as;}
if(eye[x]=="OU"){as="Both "+as;}}
if(sb_dm_popup_old!=1){if(as.indexOf("No retinopathy")==-1){if(assess_t.indexOf(";")==-1){assess_t=assess_t+"; ";}else{assess_t=assess_t+", ";}
assess_t=assess_t+""+as;}else{assess_t=as;}}else{assess_t=as;}
if(typeof(as_cd)!="undefined"&&as_cd!=""){if(dx_t!=""){dx_t=dx_t+", ";}
dx_t=dx_t+as_cd;}}}
if(typeof(eye_t)=="undefined"){eye_t="";}
if(typeof(com)!="undefined"&&com!=""){if(assess_t!=""){assess_t=assess_t+"; \n"+com;}}
if(typeof(pl)=="undefined"){pl="";}
if(typeof(dx_t)=="undefined"){dx_t="";}
if(typeof(assess_t)!="undefined"&&assess_t!=""){sb_addAssessOption(""+assess_t,""+pl,0,""+eye_t,"",""+dx_t,"");}
if(assess_take.length>0){for(var z in assess_take){if(typeof(assess_take[z])!="undefined"&&assess_take[z]!=""){sb_addAssessOption(""+assess_take[z],"",0,"","",""+dx_take[z],"");}}}
$("#dialog-msg-diab").dialog("destroy");$("#dialog-msg-diab").remove();if(z_flg_diab_sb=="1"){opSuperBill(1);}
return;}
var dib_type_qry="";if(typeof(dib_type)!="undefined"){$("#dialog-msg-diab").dialog("destroy");$("#dialog-msg-diab").remove();dib_type_qry="&set_diabetes_type="+dib_type;}
var dib_type_as="";var ass_nm="#assessplan textarea[name*='elem_assessment[]']";if(typeof(wpage)!="undefined"&&wpage=="accSB"){ass_nm=".assnm";}
var ass_nm_w_dm="";var ass_nm_w_dm_take="";$(""+ass_nm).each(function(){var as=$.trim(this.value).toLowerCase();var mtch=isDiabetesAssess(as,z_flg_diab_sb);if(mtch){dib_type_as="&get_diabetes_assess="+mtch+"&as="+as;ass_nm_w_dm=this.id;}
if(isDbTakeAssess(as)){if(as.indexOf("insulin")!=-1){ass_nm_w_dm_take+="t1";}
if(as.indexOf("hypoglycemic")!=-1){ass_nm_w_dm_take+="t2";}}});if(ass_nm_w_dm_take!=""){dib_type_as+="&dm_asmt_take="+ass_nm_w_dm_take;}
if(typeof(setProcessImg)!='undefined')setProcessImg(1,"assessplan");if($("#dialog-msg-diab").length>0){$("#dialog-msg-diab").remove();$("#dialog-msg-diab").dialog("destroy");}
if(typeof(call_CHECK_DIABETES)!="undefined"&&call_CHECK_DIABETES==1){return;}
call_CHECK_DIABETES=1;var turl=zPath+"/chart_notes/requestHandler.php?elem_formAction=CHECK_DIABETES&z_flg_diab_sb="+z_flg_diab_sb+dib_type_qry+dib_type_as;$.get(turl,function(data){call_CHECK_DIABETES=0;if(typeof(setProcessImg)!='undefined')setProcessImg(0,"assessplan");if(z_flg_diab_sb==""){}else{sb_dm_popup_old=data.flgShowOldPop
if(data.msg=="DIABETES TYPE POPUP"||data.msg=="DIABETES TYPE 1 POPUP"||data.msg=="DIABETES TYPE 2 POPUP"){$("body").append(data.html);if(data.show_pop_up_h_option){$("#dialog-msg-diab td[id]").each(function(){if($(this).html().toLowerCase().indexOf(data.show_pop_up_h_option.toLowerCase())!=-1){$(this).css({"background-color":"Yellow"});}});}
var obtns=[];if(data.msg!="DIABETES TYPE POPUP"){if(sb_dm_popup_old!=1){obtns[obtns.length]=sb_getSeverityScaleObj();}
obtns[obtns.length]={text:"Done",click:function(){var cm=$("#dialog-msg-diab #ta_dbts_icd10_cm").val();if($("#dialog-msg-diab td.highlight").length>0){sb_checkDiabetes('',$("#dialog-msg-diab td.highlight")[0],sb_chkDia_inx,'',cm);}else if(cm!=""){if(typeof(ass_nm_w_dm)!="undefined"&&ass_nm_w_dm!=""){var nm=ass_nm_w_dm.replace("elem_assessment","");var x=$("#elem_assessment"+nm+"").val();if(x!=""){var arx=x.split(";");x=arx[0];}x=(typeof(x)!="undefined"&&x!="")?x+";"+cm:cm;$("#elem_assessment"+nm+"").val(x).trigger("blur");$("#dialog-msg-diab").dialog("close");}else{$("#dialog-msg-diab").dialog("close");}}}};}
obtns[obtns.length]={text:"Cancel",click:function(){$("#dialog-msg-diab").dialog("close");$("#svrt_scl_info").remove();}}
if(data.msg!="DIABETES TYPE POPUP"){obtns[obtns.length]={id:"dmb_reset",text:"Reset",click:function(){$("#dialog-msg-diab textarea").val("");$("#dialog-msg-diab td[onclick]").removeClass("highlight");if(typeof(ass_nm_w_dm)!="undefined"&&ass_nm_w_dm!=""){var nm=ass_nm_w_dm.replace("elem_assessment","");$("#elem_assessment"+nm+",#elem_assessment_dxcode"+nm+",#elem_plan"+nm).val("").trigger("blur");$("#elem_apOu"+nm+",#elem_apOd"+nm+",#elem_apOs"+nm+",#elem_resolve"+nm+",#no_change_"+nm).prop("checked",false).triggerHandler("click");}sb_clearDbAsTaking();}};}
$("#dialog-msg-diab").dialog({modal:false,width:600,buttons:obtns,close:function(event,ui){$(this).dialog("destroy");$("#dialog-msg-diab").remove();if(z_flg_diab_sb=="1"&&z_flg_diab_sb!="2"){opSuperBill(1);};}});$("#dmb_reset").css({"float":"right"});$("#dmb_svrt_scl").css({"float":"left","background":"none","color":"purple","border":"none","font-weight":"bold"});return;}}
if(data.assess&&typeof(data.assess)!="undefined"&&data.assess!=""){var as_cd=(data.assess_code&&typeof(data.assess_code)!="undefined"&&data.assess_code!="")?""+data.assess_code:"";if(!sb_clearDiabetesAssessments(1)){sb_clearDiabetesAssessments();sb_addAssessOption(""+data.assess,"",0,"","",""+as_cd,"");}}
if(z_flg_diab_sb=="1"){opSuperBill(1);}},"json");}
function printPlanFun(ocu){var final_flag="",form_id="";if(document.getElementById('hidd_final_flag')){final_flag=document.getElementById('hidd_final_flag').value;}
if(document.getElementById('hidd_final_flag')){form_id=document.getElementById('hidd_formId').value;}
if(typeof(form_id)=="undefined"||form_id==""){form_id=$("#form_id").val();}
if(typeof(final_flag)=="undefined"||final_flag==""){final_flag=0;}
if(typeof(ocu)=="undefined"){ocu=0;}
medication=null;$.ajax({url:zPath+"/chart_notes/requestHandler.php?elem_formAction=chart_plan_print&final_flag="+final_flag+"&form_id="+form_id+"&medication="+medication+"&ocu="+ocu,success:function(resp){if(resp){if(top.fmain&&top.fmain.showOtherForms){top.fmain.showOtherForms(zPath+'/../library/html_to_pdf/createPdf.php?file_location='+resp,'print_plan_win','1000','400');}
else{window.open(zPath+'/../library/html_to_pdf/createPdf.php?file_location='+resp,'print_plan_win','toolbar=0,width=1000,height=400,resizable=1');}}else{top.fAlert('No Medication Exists');}}});}
function dx_assoc_cpt(o){var v_icd_10=$("#hid_icd10").val();if(v_icd_10!="1"&&v_icd_10!="10"){var arcurdx=""+fun_mselect(this,"val");if(arcurdx&&arcurdx!="null"&&arcurdx!=""){var tmp_arcurdx=arcurdx.split(",");var lm=4;if(tmp_arcurdx.length>lm){top.fAlert("You cannot select more than 4 Dx codes for a procedure.");return false;}}}
sb_checknwarn4WrongDxcode(o);fun_mselect('.selectpicker','width');}
function dx_assist(){var a=$("#superbill .dxallcodes").filter(function(){return $.trim(this.value)!=""?1:0;}).length;var b=$("#tblSuperbill .cptcode").filter(function(){return $.trim(this.value)!=""?1:0;}).length;if(a==0||b==0){top.fAlert("Please enter CPT and DX codes in superbill.");return;}
var ar=[];var str_cpt="";$("#tblSuperbill .cptcode").each(function(){if(typeof(this.value)!="undefined"&&$.trim(this.value)!=""){ar[this.id]=this.value;str_cpt+=""+this.id+"="+encodeURIComponent(this.value)+"&";}});var param="elem_formAction=get_valid_dx_codes&"+str_cpt;if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.get(zPath+"/chart_notes/requestHandler.php",param,function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");if(d){for(var a in d){if(a&&d[a]){var x=$.trim(d[a]);if(x!=""){var chk_all="";var ax=x.split(",");var l=ax.length;for(var i=0;i<l;i++){if(typeof(ax[i])!="undefined"&&ax[i]!=""){var chk=$.trim(ax[i]);$("#superbill .dxallcodes").each(function(){var t=$.trim(this.value);if(typeof(t)!="undefined"&&t!=""){var q1=""+t.slice(0,-1)+"-";var q2=""+t.slice(0,-2)+"--";var q3=""+t.slice(0,-3)+"-x-";if(t==chk||q1==chk||q2==chk||q3==chk){if(chk_all!=""){chk_all+=",";}chk_all+=t;return false;}}});}}
if(chk_all!=""){var cdx=a.replace("elem_cptCode_","elem_dxCodeAssoc_");fun_mselect("#"+cdx,"select",chk_all);$("#"+a).triggerHandler("blur");}}}}}},"json");}
function sb_add_menu(o,h,t){if(typeof(o)!="undefined"){if(!$(o).hasClass("dropdown-toggle")){if(typeof(h)=="undefined"){var g="";if($(o).parent().hasClass("menu_cpt")){g='menu_cpt';}else if($(o).parent().hasClass("menu_mod")){g='menu_mod';}
if(g!=""){if($("#superbill ."+g+"_ul").length<=0){if(typeof(setProcessImg)!='undefined')setProcessImg("1","superbill");$.get(zPath+"/chart_notes/requestHandler.php?elem_formAction=get_sb_menu&wh="+g+"&req_ptwo=1",function(d){if(typeof(setProcessImg)!='undefined')setProcessImg("0","superbill");if(typeof(d)!="undefined"&&d!=""){sb_add_menu(o,d,1);}});}else{var d=$("#superbill ."+g+"_ul").get(0).outerHTML;if(typeof(d)!="undefined"&&d!=""){sb_add_menu(o,d);}}
return;}}else{var trgtid=''+$(o).parent().parent().find(".form-control").attr("id");$(o).parent().append(h);if(($("#hid_save_section").length>0&&$("#hid_save_section").val()=="accounts")||1==1){$(o).parent().addClass("dropup");}
$(o).attr("data-toggle","dropdown");$(o).attr("data-trgt-id",trgtid);$(o).addClass("dropdown-toggle");$(o).unbind("click",'sb_add_menu');$(o).dropdown();$(o).parent().find("a").bind("click",function(e){if(!$(this).hasClass("cat")){var t=$(o).data("trgt-id");$("#"+t).val($(this).data("val")).trigger("blur");$(o).parent().find("ul.dropdown-menu-active").removeClass("dropdown-menu-active").toggle();$(o).dropdown("toggle");}else{$(this).next('ul').addClass("dropdown-menu-active").toggle();}
e.stopPropagation();e.preventDefault();});if(typeof(t)!="undefined"&&t=="1"){$(o).dropdown("toggle");}}}}else{for(var i=0;i<2;i++){var m=e=t="";if(i==0){m="menu_cpt";t="tr[id*=elem_trSB] .cpt_td .input-group";e=".cptcode";}else if(i==1){m="menu_mod";t="tr[id*=elem_trSB] .md .input-group";e=".modcode";}
var s='<div class="input-group-btn menu '+m+' "><button type="button" class="btn" onclick="sb_add_menu(this)" ><span class="caret"></span></button></div>';$(""+t+"").each(function(){if($(this).find("div").length==0){$(this).find(e).after(s);}});if(typeof(sb_testName)!="undefined"&&sb_testName!=""){$(""+e+"").parent().find(".btn").css({"height":"26px"});}}}}